{
  "sha": "4fa0265edea0940b865678d93749e224547dd36a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGZhMDI2NWVkZWEwOTQwYjg2NTY3OGQ5Mzc0OWUyMjQ1NDdkZDM2YQ==",
  "commit": {
    "author": {
      "name": "\u0420\u0443\u0441\u043b\u0430\u043d \u0418\u0436\u0431\u0443\u043b\u0430\u0442\u043e\u0432",
      "email": "lrn1986@gmail.com",
      "date": "2019-02-28T10:25:41Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-06-06T17:49:10Z"
    },
    "message": "Apply substitute-path to relative filenames as well\n\nWhen source file path is relative to the build directory (which\nis considered a good practice and is enforced in certain buildsystems,\nsuch as meson), gdb only applies substitute-path to the build directory\npath. Then gdb appends the source file path to the rewritten build\ndirectory path, and tries to access that.\n\nThis fails if either two of the following conditions are true:\na) The user didn't specify substitute-path for the build directory.\n   This is highly likely, since path substitution for build directories\n   is not documented anywhere, and since gdb does not tell[0] the user\n   the path to the build directory, just the source file path.\nb) The source file path changed.\n   This can also easily happen, since a source path that is relative\n   to the build directory can include any number of directory names\n   that are not part of the program source tree (starting with the\n   name of the root directory of the source tree). Gdb will not apply\n   substitute-path to that relative path, thus there is no way for\n   the user to tell gdb about these changes.\n\nThis commit changes the code to apply substitute-path to all filenames,\nboth relative and absolute. This way it is possible to do things like:\n\nset substitute-path ../foobar-1.0 /src/my/foobar-1.0\n\nwhich is completely in line with the user expectations.\n\nThis might break unusual cases where build directory path is also\nrelative (is that even possible?) and happens to match the path\nto the source directory (i.e. happens to match a substitution rule).\n\n[0]: There's a \"maintenance info symtabs\" command that does show the names\n     of the build directories, but normal users are not required to\n     know or use that.\n\ngdb/ChangeLog\n2019-06-06  \u0420\u0443\u0441\u043b\u0430\u043d \u0418\u0436\u0431\u0443\u043b\u0430\u0442\u043e\u0432 <lrn1986@gmail.com>\n\n\t* source.c (find_and_open_source): Also rewrite relative file\n\tnames.",
    "tree": {
      "sha": "93af1dabffe5e4ac056340d3dfa16b4dadc4f2d8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/93af1dabffe5e4ac056340d3dfa16b4dadc4f2d8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4fa0265edea0940b865678d93749e224547dd36a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4fa0265edea0940b865678d93749e224547dd36a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4fa0265edea0940b865678d93749e224547dd36a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4fa0265edea0940b865678d93749e224547dd36a/comments",
  "author": {
    "login": "LRN",
    "id": 91705,
    "node_id": "MDQ6VXNlcjkxNzA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/91705?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LRN",
    "html_url": "https://github.com/LRN",
    "followers_url": "https://api.github.com/users/LRN/followers",
    "following_url": "https://api.github.com/users/LRN/following{/other_user}",
    "gists_url": "https://api.github.com/users/LRN/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LRN/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LRN/subscriptions",
    "organizations_url": "https://api.github.com/users/LRN/orgs",
    "repos_url": "https://api.github.com/users/LRN/repos",
    "events_url": "https://api.github.com/users/LRN/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LRN/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1a3da2cd6175e8f25cec95fc685d4f0f43bf6807",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1a3da2cd6175e8f25cec95fc685d4f0f43bf6807",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1a3da2cd6175e8f25cec95fc685d4f0f43bf6807"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 9,
    "deletions": 9
  },
  "files": [
    {
      "sha": "efe461884eb34e39b9454b074f3ee6f8293a11d1",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4fa0265edea0940b865678d93749e224547dd36a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4fa0265edea0940b865678d93749e224547dd36a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=4fa0265edea0940b865678d93749e224547dd36a",
      "patch": "@@ -1,3 +1,8 @@\n+2019-06-06  \u0420\u0443\u0441\u043b\u0430\u043d \u0418\u0436\u0431\u0443\u043b\u0430\u0442\u043e\u0432 <lrn1986@gmail.com>\n+\n+\t* source.c (find_and_open_source): Also rewrite relative file\n+\tnames.\n+\n 2019-04-26  Amos Bird  <amosbird@gmail.com>\n \n \t* annotate.c (annotate_thread_exited): Add \"thread-exited\""
    },
    {
      "sha": "00052e67cb9d3adf21b1fe3d18ef515a669ab9f2",
      "filename": "gdb/source.c",
      "status": "modified",
      "additions": 4,
      "deletions": 9,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4fa0265edea0940b865678d93749e224547dd36a/gdb/source.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4fa0265edea0940b865678d93749e224547dd36a/gdb/source.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source.c?ref=4fa0265edea0940b865678d93749e224547dd36a",
      "patch": "@@ -1025,16 +1025,11 @@ find_and_open_source (const char *filename,\n \t}\n     }\n \n-  gdb::unique_xmalloc_ptr<char> rewritten_filename;\n-  if (IS_ABSOLUTE_PATH (filename))\n-    {\n-      /* If filename is absolute path, try the source path\n-\t substitution on it.  */\n-      rewritten_filename = rewrite_source_path (filename);\n+  gdb::unique_xmalloc_ptr<char> rewritten_filename\n+    = rewrite_source_path (filename);\n \n-      if (rewritten_filename != NULL)\n-\tfilename = rewritten_filename.get ();\n-    }\n+  if (rewritten_filename != NULL)\n+    filename = rewritten_filename.get ();\n \n   result = openp (path, OPF_SEARCH_IN_PATH | OPF_RETURN_REALPATH, filename,\n \t\t  OPEN_MODE, fullname);"
    }
  ]
}