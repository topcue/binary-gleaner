{
  "sha": "c45a683f8f9195bf7cc53bc645a20092c7155629",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzQ1YTY4M2Y4ZjkxOTViZjdjYzUzYmM2NDVhMjAwOTJjNzE1NTYyOQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-20T22:41:26Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-20T22:41:26Z"
    },
    "message": "[gdb] Change register_test to use std::function arg\n\nChange register_test to use std::function arg, such that we can do:\n...\n  register_test (test_name, [=] () { SELF_CHECK (...); });\n...\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "93e96b2d5fbccefbef3314c948b5db93da1be70b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/93e96b2d5fbccefbef3314c948b5db93da1be70b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c45a683f8f9195bf7cc53bc645a20092c7155629",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c45a683f8f9195bf7cc53bc645a20092c7155629",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c45a683f8f9195bf7cc53bc645a20092c7155629",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c45a683f8f9195bf7cc53bc645a20092c7155629/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6f265beb28a7465c9e75fdb169d15a87f9a3a5d6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6f265beb28a7465c9e75fdb169d15a87f9a3a5d6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6f265beb28a7465c9e75fdb169d15a87f9a3a5d6"
    }
  ],
  "stats": {
    "total": 47,
    "additions": 25,
    "deletions": 22
  },
  "files": [
    {
      "sha": "1b38ac39edf9fe523f3b79f610e6394e552b4d8f",
      "filename": "gdb/unittests/intrusive_list-selftests.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c45a683f8f9195bf7cc53bc645a20092c7155629/gdb/unittests/intrusive_list-selftests.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c45a683f8f9195bf7cc53bc645a20092c7155629/gdb/unittests/intrusive_list-selftests.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/unittests/intrusive_list-selftests.c?ref=c45a683f8f9195bf7cc53bc645a20092c7155629",
      "patch": "@@ -754,7 +754,7 @@ struct intrusive_list_test\n \n template <typename ListType>\n static void\n-test_intrusive_list ()\n+test_intrusive_list_1 ()\n {\n   intrusive_list_test<ListType> tests;\n \n@@ -804,8 +804,8 @@ test_node_is_linked ()\n static void\n test_intrusive_list ()\n {\n-  test_intrusive_list<item_with_base_list> ();\n-  test_intrusive_list<item_with_member_list> ();\n+  test_intrusive_list_1<item_with_base_list> ();\n+  test_intrusive_list_1<item_with_member_list> ();\n   test_node_is_linked ();\n }\n "
    },
    {
      "sha": "55f530ad98e7f796e1edb58990bfe4e0dad742e7",
      "filename": "gdbsupport/selftest.cc",
      "status": "modified",
      "additions": 21,
      "deletions": 18,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c45a683f8f9195bf7cc53bc645a20092c7155629/gdbsupport/selftest.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c45a683f8f9195bf7cc53bc645a20092c7155629/gdbsupport/selftest.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/selftest.cc?ref=c45a683f8f9195bf7cc53bc645a20092c7155629",
      "patch": "@@ -21,6 +21,7 @@\n #include \"common-debug.h\"\n #include \"selftest.h\"\n #include <map>\n+#include <functional>\n \n namespace selftests\n {\n@@ -30,22 +31,6 @@ namespace selftests\n \n static std::map<std::string, std::unique_ptr<selftest>> tests;\n \n-/* A selftest that calls the test function without arguments.  */\n-\n-struct simple_selftest : public selftest\n-{\n-  simple_selftest (self_test_function *function_)\n-  : function (function_)\n-  {}\n-\n-  void operator() () const override\n-  {\n-    function ();\n-  }\n-\n-  self_test_function *function;\n-};\n-\n /* See selftest.h.  */\n \n void\n@@ -57,12 +42,30 @@ register_test (const std::string &name, selftest *test)\n   tests[name] = std::unique_ptr<selftest> (test);\n }\n \n+/* A selftest that calls the test function without arguments.  */\n+\n+struct lambda_selftest : public selftest\n+{\n+  lambda_selftest (std::function<void(void)> function_)\n+  {\n+    function  = function_;\n+  }\n+\n+  void operator() () const override\n+  {\n+    function ();\n+  }\n+\n+  std::function<void(void)> function;\n+};\n+\n /* See selftest.h.  */\n \n void\n-register_test (const std::string &name, self_test_function *function)\n+register_test (const std::string &name,\n+\t       std::function<void(void)> function)\n {\n-  register_test (name, new simple_selftest (function));\n+  register_test (name, new lambda_selftest (function));\n }\n \n /* See selftest.h.  */"
    },
    {
      "sha": "b75e01e197fcb561e68c75263019ea22b968770b",
      "filename": "gdbsupport/selftest.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c45a683f8f9195bf7cc53bc645a20092c7155629/gdbsupport/selftest.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c45a683f8f9195bf7cc53bc645a20092c7155629/gdbsupport/selftest.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/selftest.h?ref=c45a683f8f9195bf7cc53bc645a20092c7155629",
      "patch": "@@ -44,7 +44,7 @@ extern void register_test (const std::string &name, selftest *test);\n /* Register a new self-test.  */\n \n extern void register_test (const std::string &name,\n-\t\t\t   self_test_function *function);\n+\t\t\t   std::function<void(void)> function);\n \n /* Run all the self tests.  This print a message describing the number\n    of test and the number of failures."
    }
  ]
}