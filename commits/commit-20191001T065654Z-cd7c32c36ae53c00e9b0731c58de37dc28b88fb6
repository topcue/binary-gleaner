{
  "sha": "cd7c32c36ae53c00e9b0731c58de37dc28b88fb6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2Q3YzMyYzM2YWU1M2MwMGU5YjA3MzFjNThkZTM3ZGMyOGI4OGZiNg==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-09-29T16:26:23Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-10-01T06:56:54Z"
    },
    "message": "Fix leak due to assigning a xstrdup-ed string to the std::string gdb_datadir\n\nValgrind reports the following leak:\n==32623== 56 bytes in 1 blocks are definitely lost in loss record 1,099 of 6,654\n==32623==    at 0x4835753: malloc (vg_replace_malloc.c:307)\n==32623==    by 0x25CF67: xmalloc (alloc.c:60)\n==32623==    by 0x65FBD9: xstrdup (xstrdup.c:34)\n==32623==    by 0x413D9E: captured_main_1(captured_main_args*) (main.c:553)\n==32623==    by 0x414FFA: captured_main (main.c:1172)\n==32623==    by 0x414FFA: gdb_main(captured_main_args*) (main.c:1197)\n==32623==    by 0x22531A: main (gdb.c:32)\n\nCommit f2aec7f6d14 changed gdb_datadir to std::string.\nSo, xstrdup-ing the result of relocate_gdb_directory (returning a std::string)\nis not needed and creates a leak.\n\nFix the leak by removing the xstrdup and the not needed c_str ().\nAlso removes a useless conversion of gdb_datadir to std::string.\n\ngdb/ChangeLog\n2019-10-01  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* main.c (relocate_gdbinit_path_maybe_in_datadir): Remove std::string\n\tconversion of gdb_datadir.\n\t(captured_main_1): Remove xstrdup when assigning to gdb_datadir,\n\tremove not needed c_str ().",
    "tree": {
      "sha": "d5e98784a3f96cffc47448f1f0d716bcf8757002",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d5e98784a3f96cffc47448f1f0d716bcf8757002"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "8fe0f950f4c0438e684a532add46dc99ee32165c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8fe0f950f4c0438e684a532add46dc99ee32165c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8fe0f950f4c0438e684a532add46dc99ee32165c"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 10,
    "deletions": 5
  },
  "files": [
    {
      "sha": "72855150de421eccc4c88186b0e782dc7715c20a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=cd7c32c36ae53c00e9b0731c58de37dc28b88fb6",
      "patch": "@@ -1,3 +1,10 @@\n+2019-10-01  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* main.c (relocate_gdbinit_path_maybe_in_datadir): Remove std::string\n+\tconversion of gdb_datadir.\n+\t(captured_main_1): Remove xstrdup when assigning to gdb_datadir,\n+\tremove not needed c_str ().\n+\n 2019-09-30  Ali Tamur <tamur@google.com>\n \n \t* dwarf2read.c (skip_one_die): Handle DW_FORM_strx forms."
    },
    {
      "sha": "14d9e7965384ccde20cf2dd0738b2ad3afa5baac",
      "filename": "gdb/main.c",
      "status": "modified",
      "additions": 3,
      "deletions": 5,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6/gdb/main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cd7c32c36ae53c00e9b0731c58de37dc28b88fb6/gdb/main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/main.c?ref=cd7c32c36ae53c00e9b0731c58de37dc28b88fb6",
      "patch": "@@ -214,8 +214,7 @@ relocate_gdbinit_path_maybe_in_datadir (const std::string& file)\n       size_t start = datadir_len;\n       for (; IS_DIR_SEPARATOR (file[start]); ++start)\n \t;\n-      relocated_path = (std::string (gdb_datadir) + SLASH_STRING\n-\t\t\t+ file.substr (start));\n+      relocated_path = gdb_datadir + SLASH_STRING + file.substr (start);\n     }\n   else\n     {\n@@ -549,9 +548,8 @@ captured_main_1 (struct captured_main_args *context)\n     = xstrdup (relocate_gdb_directory (DEBUGDIR,\n \t\t\t\t     DEBUGDIR_RELOCATABLE).c_str ());\n \n-  gdb_datadir\n-    = xstrdup (relocate_gdb_directory (GDB_DATADIR,\n-\t\t\t\t     GDB_DATADIR_RELOCATABLE).c_str ());\n+  gdb_datadir = relocate_gdb_directory (GDB_DATADIR,\n+\t\t\t\t\tGDB_DATADIR_RELOCATABLE);\n \n #ifdef WITH_PYTHON_PATH\n   {"
    }
  ]
}