{
  "sha": "b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjYzYTVlMzhlZmEyZGM2ZGY0NmVhZmIwYmJhZDNmNDg0NzJlMWJlZg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-27T15:41:37Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-03-05T17:21:40Z"
    },
    "message": "bfd/binutils: support for gdb target descriptions in the core file\n\nThis commit lays the ground work for allowing GDB to write its target\ndescription into a generated core file.\n\nThe goal of this work is to allow a user to connect to a remote\ntarget, capture a core file from within GDB, then pass the executable\nand core file to another user and have the user be able to examine the\nstate of the machine without needing to connect to a running target.\n\nDifferent remote targets can have different register sets and this\ninformation is communicated from the target to GDB in the target\ndescription.\n\nIt is possible for a user to extract the target description from GDB\nand pass this along with the core file so that when the core file is\nused the target description can be fed back into GDB, however this is\nnot a great user experience.\n\nIt would be nicer, I think, if GDB could write the target description\ndirectly into the core file, and then make use of this description\nwhen loading a core file.\n\nThis commit performs the binutils/bfd side of this task, adding the\nboiler plate functions to access the target description from within a\ncore file note, and reserving a new number for a note containing the\ntarget description.  Later commits will extend GDB to make use of\nthis.\n\nThe new note is given the name 'GDB' and a type NT_GDB_TDESC.  This\nshould hopefully protect us if there's ever a reuse of the number\nassigned to NT_GDB_TDESC by some other core file producer.  It should\nalso, hopefully, make it clearer to users that this note carries GDB\nspecific information.\n\nbfd/ChangeLog:\n\n\t* elf-bfd.h (elfcore_write_gdb_tdesc): Declare new function.\n\t* elf.c (elfcore_grok_gdb_tdesc): New function.\n\t(elfcore_grok_note): Handle NT_GDB_TDESC.\n\t(elfcore_write_gdb_tdesc): New function.\n\t(elfcore_write_register_note): Handle NT_GDB_TDESC.\n\nbinutils/ChangeLog:\n\n\t* readelf.c (get_note_type): Handle NT_GDB_TDESC.\n\ninclude/ChangeLog:\n\n\t* elf/common.h (NT_GDB_TDESC): Define.",
    "tree": {
      "sha": "6736ac46845d5d413310f0bb49608a7174abe7aa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6736ac46845d5d413310f0bb49608a7174abe7aa"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f3a5df7bd65bea1840d00bd65d5eee7e339ca8da",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f3a5df7bd65bea1840d00bd65d5eee7e339ca8da",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f3a5df7bd65bea1840d00bd65d5eee7e339ca8da"
    }
  ],
  "stats": {
    "total": 62,
    "additions": 62,
    "deletions": 0
  },
  "files": [
    {
      "sha": "31d0714da2700eddae0ee9019392b05ae6d4b147",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -1,3 +1,12 @@\n+2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* elf-bfd.h (elfcore_write_gdb_tdesc): Declare new function.\n+\t* elf.c (elfcore_grok_gdb_tdesc): New function.\n+\t(elfcore_grok_note): Handle NT_GDB_TDESC.\n+\t(elfcore_write_gdb_tdesc): New function.\n+\t(elfcore_write_register_note): Handle NT_GDB_TDESC.\n+\n 2021-03-05  Nick Clifton  <nickc@redhat.com>\n \n \tPR 27521"
    },
    {
      "sha": "69e18036a49730e89e9374952d3a6a4e2e0ef6b3",
      "filename": "bfd/elf-bfd.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/bfd/elf-bfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/bfd/elf-bfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf-bfd.h?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -2798,6 +2798,8 @@ extern char *elfcore_write_aarch_pauth\n   (bfd *, char *, int *, const void *, int);\n extern char *elfcore_write_arc_v2\n   (bfd *, char *, int *, const void *, int);\n+extern char *elfcore_write_gdb_tdesc\n+  (bfd *, char *, int *, const void *, int);\n extern char *elfcore_write_lwpstatus\n   (bfd *, char *, int *, long, int, const void *);\n extern char *elfcore_write_register_note"
    },
    {
      "sha": "2d66e9b999f57303a21c973108e64d04dc61154b",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 35,
      "deletions": 0,
      "changes": 35,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -9912,6 +9912,15 @@ elfcore_grok_arc_v2 (bfd *abfd, Elf_Internal_Note *note)\n   return elfcore_make_note_pseudosection (abfd, \".reg-arc-v2\", note);\n }\n \n+/* Convert NOTE into a bfd_section called \".gdb-tdesc\".  Return TRUE if\n+   successful otherwise, return FALSE.  */\n+\n+static bfd_boolean\n+elfcore_grok_gdb_tdesc (bfd *abfd, Elf_Internal_Note *note)\n+{\n+  return elfcore_make_note_pseudosection (abfd, \".gdb-tdesc\", note);\n+}\n+\n #if defined (HAVE_PRPSINFO_T)\n typedef prpsinfo_t   elfcore_psinfo_t;\n #if defined (HAVE_PRPSINFO32_T)\t\t/* Sparc64 cross Sparc32 */\n@@ -10570,6 +10579,13 @@ elfcore_grok_note (bfd *abfd, Elf_Internal_Note *note)\n       else\n \treturn TRUE;\n \n+    case NT_GDB_TDESC:\n+      if (note->namesz == 4\n+          && strcmp (note->namedata, \"GDB\") == 0)\n+        return elfcore_grok_gdb_tdesc (abfd, note);\n+      else\n+        return TRUE;\n+\n     case NT_PRPSINFO:\n     case NT_PSINFO:\n       if (bed->elf_backend_grok_psinfo)\n@@ -11951,6 +11967,23 @@ elfcore_write_arc_v2 (bfd *abfd,\n \t\t\t     note_name, NT_ARC_V2, arc_v2, size);\n }\n \n+/* Write the target description (a string) pointed to by TDESC, length\n+   SIZE, into the note buffer BUF, and update *BUFSIZ.  ABFD is the bfd the\n+   note is being written into.  Return a pointer to the new start of the\n+   note buffer, to replace BUF which may no longer be valid.  */\n+\n+char *\n+elfcore_write_gdb_tdesc (bfd *abfd,\n+\t\t\t char *buf,\n+\t\t\t int *bufsiz,\n+\t\t\t const void *tdesc,\n+\t\t\t int size)\n+{\n+  const char *note_name = \"GDB\";\n+  return elfcore_write_note (abfd, buf, bufsiz,\n+                             note_name, NT_GDB_TDESC, tdesc, size);\n+}\n+\n char *\n elfcore_write_register_note (bfd *abfd,\n \t\t\t     char *buf,\n@@ -12035,6 +12068,8 @@ elfcore_write_register_note (bfd *abfd,\n     return elfcore_write_aarch_pauth (abfd, buf, bufsiz, data, size);\n   if (strcmp (section, \".reg-arc-v2\") == 0)\n     return elfcore_write_arc_v2 (abfd, buf, bufsiz, data, size);\n+  if (strcmp (section, \".gdb-tdesc\") == 0)\n+    return elfcore_write_gdb_tdesc (abfd, buf, bufsiz, data, size);\n   return NULL;\n }\n "
    },
    {
      "sha": "80b6ea6a4c7d05c62c6a42a6ef48c63cbadfcb57",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* readelf.c (get_note_type): Handle NT_GDB_TDESC.\n+\n 2021-03-05  Nick Clifton  <nickc@redhat.com>\n \n \tPR 27387"
    },
    {
      "sha": "fe58ebf6ac4130ff1a7ad4a868d3e6400f7a868f",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -18499,6 +18499,8 @@ get_note_type (Filedata * filedata, unsigned e_type)\n \treturn _(\"NT_PRPSINFO (prpsinfo structure)\");\n       case NT_TASKSTRUCT:\n \treturn _(\"NT_TASKSTRUCT (task structure)\");\n+      case NT_GDB_TDESC:\n+        return _(\"NT_GDB_TDESC (GDB XML target description)\");\n       case NT_PRXFPREG:\n \treturn _(\"NT_PRXFPREG (user_xfpregs structure)\");\n       case NT_PPC_VMX:"
    },
    {
      "sha": "08c45673be65efeac406ce4c67684d4a1f08edc4",
      "filename": "include/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/include/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/include/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/ChangeLog?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* elf/common.h (NT_GDB_TDESC): Define.\n+\n 2021-03-03  Alan Modra  <amodra@gmail.com>\n \n \t* coff/internal.h: Delete obsolete relocation defines.  Move used"
    },
    {
      "sha": "e6e9c278faa50276b908a23724040273608041b3",
      "filename": "include/elf/common.h",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/include/elf/common.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b63a5e38efa2dc6df46eafb0bbad3f48472e1bef/include/elf/common.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/elf/common.h?ref=b63a5e38efa2dc6df46eafb0bbad3f48472e1bef",
      "patch": "@@ -677,6 +677,10 @@\n #define NT_SIGINFO\t0x53494749\t/* Fields of siginfo_t.  */\n #define NT_FILE\t\t0x46494c45\t/* Description of mapped files.  */\n \n+/* The range 0xff000000 to 0xffffffff is set aside for notes that don't\n+   originate from any particular operating system.  */\n+#define NT_GDB_TDESC\t0xff000000\t/* Contains copy of GDB's target description XML.  */\n+\n /* Note segments for core files on dir-style procfs systems.  */\n \n #define NT_PSTATUS\t10\t\t/* Has a struct pstatus */"
    }
  ]
}