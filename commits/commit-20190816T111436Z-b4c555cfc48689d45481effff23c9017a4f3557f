{
  "sha": "b4c555cfc48689d45481effff23c9017a4f3557f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjRjNTU1Y2ZjNDg2ODlkNDU0ODFlZmZmZjIzYzkwMTdhNGYzNTU3Zg==",
  "commit": {
    "author": {
      "name": "Martin Liska",
      "email": "mliska@suse.cz",
      "date": "2019-08-16T11:14:36Z"
    },
    "committer": {
      "name": "Martin Liska",
      "email": "mliska@suse.cz",
      "date": "2019-08-16T11:14:36Z"
    },
    "message": "Fix detection of missing plugin for LTO objects.\n\n2019-08-16  Martin Liska  <mliska@suse.cz>\n\n\tPR ld/24912\n\t* elflink.c: Report error only for not relocatable.\n\t* linker.c (_bfd_generic_link_add_one_symbol): Do not handle\n\there lto_slim_object as it's handled in caller.\n2019-08-16  Martin Liska  <mliska@suse.cz>\n\n\tPR ld/24912\n\t* object.cc (big_endian>::do_layout): Do not report error,\n\tbut only set a flag.\n\t(big_endian>::do_add_symbols): Report error only for when\n\trelocatable.",
    "tree": {
      "sha": "76f2178975c851a0e79f65b265a02ddfa3a8caa3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/76f2178975c851a0e79f65b265a02ddfa3a8caa3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b4c555cfc48689d45481effff23c9017a4f3557f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unknown_key",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEE6I4wzqqylQBfXaRhTcGC3A+nN4UFAl1WkCIACgkQTcGC3A+n\nN4UlnQf9FircW1Y9taPqrg5ql5g64R7HlmqPAbjgdzIWsOLFzUJ2rtRPgbUjpSU2\nVLRRPqlQSBurluD0RjyeiPn069lmtaCbOASDzOrzTAbBL32eRidvHN0O1G2y8X/o\nFrhIYmkVUbNNu3VLTcCarvwR8kbWzFzCSvVpUVrrt2PJ5FE7taPkXespcwWMHrkM\nQDMJRnkfTddDtEpyLC1RCOYmUQE9P0WktagODn6N742mt6CzP5YH+60uuoIo1ecT\nDD5dVnQ0IMHwK1QZHVZru8b+GM4uXGCwfIzvtSQlRygXXmqbkuyOIsLvpLM2QBk/\nU0v9ONX/UVl+JAwM6LKGQPrtgWSPaQ==\n=qRus\n-----END PGP SIGNATURE-----",
      "payload": "tree 76f2178975c851a0e79f65b265a02ddfa3a8caa3\nparent aa7ca1bb443e8c2baad17392f395d1556fecfafa\nauthor Martin Liska <mliska@suse.cz> 1565954076 +0200\ncommitter Martin Liska <mliska@suse.cz> 1565954076 +0200\n\nFix detection of missing plugin for LTO objects.\n\n2019-08-16  Martin Liska  <mliska@suse.cz>\n\n\tPR ld/24912\n\t* elflink.c: Report error only for not relocatable.\n\t* linker.c (_bfd_generic_link_add_one_symbol): Do not handle\n\there lto_slim_object as it's handled in caller.\n2019-08-16  Martin Liska  <mliska@suse.cz>\n\n\tPR ld/24912\n\t* object.cc (big_endian>::do_layout): Do not report error,\n\tbut only set a flag.\n\t(big_endian>::do_add_symbols): Report error only for when\n\trelocatable.\n"
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4c555cfc48689d45481effff23c9017a4f3557f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b4c555cfc48689d45481effff23c9017a4f3557f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4c555cfc48689d45481effff23c9017a4f3557f/comments",
  "author": {
    "login": "marxin",
    "id": 2658545,
    "node_id": "MDQ6VXNlcjI2NTg1NDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marxin",
    "html_url": "https://github.com/marxin",
    "followers_url": "https://api.github.com/users/marxin/followers",
    "following_url": "https://api.github.com/users/marxin/following{/other_user}",
    "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marxin/subscriptions",
    "organizations_url": "https://api.github.com/users/marxin/orgs",
    "repos_url": "https://api.github.com/users/marxin/repos",
    "events_url": "https://api.github.com/users/marxin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marxin/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "marxin",
    "id": 2658545,
    "node_id": "MDQ6VXNlcjI2NTg1NDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2658545?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marxin",
    "html_url": "https://github.com/marxin",
    "followers_url": "https://api.github.com/users/marxin/followers",
    "following_url": "https://api.github.com/users/marxin/following{/other_user}",
    "gists_url": "https://api.github.com/users/marxin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marxin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marxin/subscriptions",
    "organizations_url": "https://api.github.com/users/marxin/orgs",
    "repos_url": "https://api.github.com/users/marxin/repos",
    "events_url": "https://api.github.com/users/marxin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marxin/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "aa7ca1bb443e8c2baad17392f395d1556fecfafa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa7ca1bb443e8c2baad17392f395d1556fecfafa",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/aa7ca1bb443e8c2baad17392f395d1556fecfafa"
    }
  ],
  "stats": {
    "total": 48,
    "additions": 26,
    "deletions": 22
  },
  "files": [
    {
      "sha": "868796a8c1077e3d1637f398584056df66051347",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c555cfc48689d45481effff23c9017a4f3557f/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c555cfc48689d45481effff23c9017a4f3557f/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=b4c555cfc48689d45481effff23c9017a4f3557f",
      "patch": "@@ -1,3 +1,10 @@\n+2019-08-16  Martin Liska  <mliska@suse.cz>\n+\n+\tPR ld/24912\n+\t* elflink.c: Report error only for not relocatable.\n+\t* linker.c (_bfd_generic_link_add_one_symbol): Do not handle\n+\there lto_slim_object as it's handled in caller.\n+\n 2019-08-16  Alan Modra  <amodra@gmail.com>\n \n \t* elf32-ppc.c (ppc_elf_relocate_section): Optimize unaligned relocs."
    },
    {
      "sha": "16d83bb7a3035357bb47260800c83085bc039fa6",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c555cfc48689d45481effff23c9017a4f3557f/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c555cfc48689d45481effff23c9017a4f3557f/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=b4c555cfc48689d45481effff23c9017a4f3557f",
      "patch": "@@ -4401,7 +4401,8 @@ elf_link_add_object_symbols (bfd *abfd, struct bfd_link_info *info)\n       goto error_free_vers;\n     }\n \n-  if (abfd->lto_slim_object)\n+  if (!bfd_link_relocatable (info)\n+      && abfd->lto_slim_object)\n     {\n       _bfd_error_handler\n \t(_(\"%pB: plugin needed to handle lto object\"), abfd);"
    },
    {
      "sha": "1b71fcf8f0d59f0de0363300394425e7ad7ee676",
      "filename": "bfd/linker.c",
      "status": "modified",
      "additions": 6,
      "deletions": 18,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c555cfc48689d45481effff23c9017a4f3557f/bfd/linker.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c555cfc48689d45481effff23c9017a4f3557f/bfd/linker.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/linker.c?ref=b4c555cfc48689d45481effff23c9017a4f3557f",
      "patch": "@@ -1421,24 +1421,12 @@ _bfd_generic_link_add_one_symbol (struct bfd_link_info *info,\n   else if (bfd_is_com_section (section))\n     {\n       row = COMMON_ROW;\n-      static bfd_boolean report_plugin_err = TRUE;\n-      if (!bfd_link_relocatable (info) && report_plugin_err)\n-\t{\n-\t  if (abfd->lto_slim_object)\n-\t    {\n-\t      report_plugin_err = FALSE;\n-\t      _bfd_error_handler\n-\t\t(_(\"%pB: plugin needed to handle lto object\"), abfd);\n-\t    }\n-\t  else if (name[0] == '_'\n-\t\t   && name[1] == '_'\n-\t\t   && strcmp (name + (name[2] == '_'), \"__gnu_lto_slim\") == 0)\n-\t    {\n-\t      report_plugin_err = FALSE;\n-\t      _bfd_error_handler\n-\t\t(_(\"%pB: plugin needed to handle lto object\"), abfd);\n-\t    }\n-\t}\n+      if (!bfd_link_relocatable (info)\n+\t  && name[0] == '_'\n+\t  && name[1] == '_'\n+\t  && strcmp (name + (name[2] == '_'), \"__gnu_lto_slim\") == 0)\n+\t_bfd_error_handler\n+\t  (_(\"%pB: plugin needed to handle lto object\"), abfd);\n     }\n   else\n     row = DEF_ROW;"
    },
    {
      "sha": "6fe991d80d0c1e8d0669f80b5d73afbbbc1f2f03",
      "filename": "gold/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c555cfc48689d45481effff23c9017a4f3557f/gold/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c555cfc48689d45481effff23c9017a4f3557f/gold/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/ChangeLog?ref=b4c555cfc48689d45481effff23c9017a4f3557f",
      "patch": "@@ -1,3 +1,11 @@\n+2019-08-16  Martin Liska  <mliska@suse.cz>\n+\n+\tPR ld/24912\n+\t* object.cc (big_endian>::do_layout): Do not report error,\n+\tbut only set a flag.\n+\t(big_endian>::do_add_symbols): Report error only for when\n+\trelocatable.\n+\n 2019-08-02  Alan Modra  <amodra@gmail.com>\n \n \t* powerpc.cc (Target_powerpc::Scan::get_reference_flags): Set"
    },
    {
      "sha": "d505ce4752002b2bb2966f3ec1f94a7df4ec65e1",
      "filename": "gold/object.cc",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c555cfc48689d45481effff23c9017a4f3557f/gold/object.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c555cfc48689d45481effff23c9017a4f3557f/gold/object.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/object.cc?ref=b4c555cfc48689d45481effff23c9017a4f3557f",
      "patch": "@@ -1887,8 +1887,7 @@ Sized_relobj_file<size, big_endian>::do_layout(Symbol_table* symtab,\n \t  const unsigned char* pcontents = this->section_contents(i, &contents_len, false);\n \t  struct lto_section lsection = *(const lto_section*)pcontents;\n \t  if (lsection.slim_object)\n-\t    gold_info(_(\"%s: plugin needed to handle lto object\"),\n-\t\t      this->name().c_str());\n+\t    layout->set_lto_slim_object ();\n \t}\n     }\n \n@@ -2127,7 +2126,8 @@ Sized_relobj_file<size, big_endian>::do_add_symbols(Symbol_table* symtab,\n \n   this->symbols_.resize(symcount);\n \n-  if (layout->is_lto_slim_object ())\n+  if (!parameters->options().relocatable()\n+      && layout->is_lto_slim_object ())\n     gold_info(_(\"%s: plugin needed to handle lto object\"),\n \t      this->name().c_str());\n "
    }
  ]
}