{
  "sha": "d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDhmMjdjNjAxOGFkYmIzMmEzZWJiYTM5YTVhYmFjNDRhNmI5ZTY3Yw==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-09T14:49:07Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-08-28T12:33:55Z"
    },
    "message": "gdb/fortran: Don't include module symbols when searching for types\n\nCurrently the 'info types' command will return symbols that correspond\nto Fortran modules.  This is because the symbols are created with\ndomain MODULE_DOMAIN and address_class LOC_TYPEDEF.  The address_class\nLOC_TYPEDEF is the same address_class used for type symbols which is\nwhy the modules show up when listing types.\n\nThis commit explicitly prevents symbols in the MODULE_DOMAIN from\nappearing when we search for symbols in the TYPES_DOMAIN, this\nprevents the Fortran module symbols from appearing in the output of\n'info types'.\n\ngdb/ChangeLog:\n\n\t* symtab.c (search_symbols): Don't include MODULE_DOMAIN symbols\n\twhen searching for types.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.fortran/info-types.exp: Add module.\n\t* gdb.fortran/info-types.f90: Update expected results.",
    "tree": {
      "sha": "a5f5fecd2027826bd2b9cea0a51a9530b54b53cb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a5f5fecd2027826bd2b9cea0a51a9530b54b53cb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1f20c35ea4a0095e6a9d9b7819f6c437a0c4cfc1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1f20c35ea4a0095e6a9d9b7819f6c437a0c4cfc1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1f20c35ea4a0095e6a9d9b7819f6c437a0c4cfc1"
    }
  ],
  "stats": {
    "total": 28,
    "additions": 26,
    "deletions": 2
  },
  "files": [
    {
      "sha": "a82f7c64ae89e0972b5cb649c5015193527bd5d3",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
      "patch": "@@ -1,3 +1,8 @@\n+2019-08-28  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* symtab.c (search_symbols): Don't include MODULE_DOMAIN symbols\n+\twhen searching for types.\n+\n 2019-08-28  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* f-lang.c (f_language_defn): Use f_print_typedef."
    },
    {
      "sha": "88e34de05be4ff70838bc79cfb236ab37a1edb11",
      "filename": "gdb/symtab.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.c?ref=d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
      "patch": "@@ -4659,7 +4659,8 @@ search_symbols (const char *regexp, enum search_domain kind,\n \t\t\t\t      || treg_matches_sym_type_name (*treg,\n \t\t\t\t\t\t\t\t     sym)))\n \t\t\t      || (kind == TYPES_DOMAIN\n-\t\t\t\t  && SYMBOL_CLASS (sym) == LOC_TYPEDEF))))\n+\t\t\t\t  && SYMBOL_CLASS (sym) == LOC_TYPEDEF\n+\t\t\t\t  && SYMBOL_DOMAIN (sym) != MODULE_DOMAIN))))\n \t\t    {\n \t\t      /* match */\n \t\t      result.emplace_back (i, sym);"
    },
    {
      "sha": "3939a747c5b61315d9b62d35e107477b849dca56",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
      "patch": "@@ -1,3 +1,8 @@\n+2019-08-28  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.fortran/info-types.exp: Add module.\n+\t* gdb.fortran/info-types.f90: Update expected results.\n+\n 2019-08-28  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.fortran/info-types.exp: New file."
    },
    {
      "sha": "81e67395e8aeeeb4a46e8707d9a2beeadf0c3065",
      "filename": "gdb/testsuite/gdb.fortran/info-types.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/testsuite/gdb.fortran/info-types.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/testsuite/gdb.fortran/info-types.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.fortran/info-types.exp?ref=d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
      "patch": "@@ -42,4 +42,6 @@ gdb_test \"info types\" \\\n \t \"\\[\\t \\]+${character1}\" \\\n \t \"\\[\\t \\]+${integer4}\" \\\n \t \"\\[\\t \\]+${logical4}\" \\\n-\t \"16:\\[\\t \\]+Type s1;\" ]\n+\t \"20:\\[\\t \\]+Type __vtype_mod1_M1t1;\" \\\n+\t \"17:\\[\\t \\]+Type m1t1;\" \\\n+\t \"22:\\[\\t \\]+Type s1;\" ]"
    },
    {
      "sha": "0e27e1ddf088f16919b6ffde3848c0fe6983ba06",
      "filename": "gdb/testsuite/gdb.fortran/info-types.f90",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/testsuite/gdb.fortran/info-types.f90",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d8f27c6018adbb32a3ebba39a5abac44a6b9e67c/gdb/testsuite/gdb.fortran/info-types.f90",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.fortran/info-types.f90?ref=d8f27c6018adbb32a3ebba39a5abac44a6b9e67c",
      "patch": "@@ -13,13 +13,24 @@\n ! You should have received a copy of the GNU General Public License\n ! along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n+module mod1\n+  type :: m1t1\n+     integer :: b\n+  end type m1t1\n+end module mod1\n+\n program info_types_test\n+  use mod1\n+\n   type :: s1\n      integer :: a\n   end type s1\n \n   logical :: l\n   type (s1) :: var_a\n+  type (m1t1) :: var_b\n+\n   var_a%a = 1\n+  var_b%b = 2\n   l = .FALSE.\n end program info_types_test"
    }
  ]
}