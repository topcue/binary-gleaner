{
  "sha": "fa639f555afbe6bf670c27d161c42974740987cb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmE2MzlmNTU1YWZiZTZiZjY3MGMyN2QxNjFjNDI5NzQ3NDA5ODdjYg==",
  "commit": {
    "author": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-12-14T18:06:38Z"
    },
    "committer": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-12-19T12:41:44Z"
    },
    "message": "Don't compare types of enum fields\n\nComparing types of enum fields results in a crash, because they don't\nhave a type.\n\nIt can be reproduced by comparing the types of 2 instances of the same\nenum type in different objects:\n\nenum.h:\n\n    enum e\n    {\n      zero,\n      one,\n    };\n\nenum-1.c:\n\n    #include <enum.h>\n    int func();\n    enum e e1;\n    int main()\n    {\n      return e1 + func();\n    }\n\nenum-2.c:\n\n    #include <enum.h>\n    enum e e2;\n    int func()\n    {\n      return e2;\n    }\n\n$ gcc -g -oenum enum-1.c enum-2.c\n$ gdb -q enum.exe\nReading symbols from enum.exe...\n(gdb) py print(gdb.parse_and_eval(\"e1\").type==gdb.parse_and_eval(\"e2\").type)\n\nThread 1 received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 6184.0x1cc4]\ncheck_typedef (type=0x0) at C:/src/repos/binutils-gdb.git/gdb/gdbtypes.c:2745\n2745      while (type->code () == TYPE_CODE_TYPEDEF)\n\ngdb/ChangeLog:\n\n2020-12-19  Hannes Domani  <ssbssa@yahoo.de>\n\n\tPR exp/27070\n\t* gdbtypes.c (check_types_equal): Don't compare types of enum fields.\n\ngdb/testsuite/ChangeLog:\n\n2020-12-19  Hannes Domani  <ssbssa@yahoo.de>\n\n\tPR exp/27070\n\t* gdb.python/compare-enum-type-a.c: New test.\n\t* gdb.python/compare-enum-type-b.c: New test.\n\t* gdb.python/compare-enum-type.exp: New file.\n\t* gdb.python/compare-enum-type.h: New test.",
    "tree": {
      "sha": "8e8057a2a6ee3edbc469f20e434efb88d1876f78",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8e8057a2a6ee3edbc469f20e434efb88d1876f78"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/fa639f555afbe6bf670c27d161c42974740987cb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fa639f555afbe6bf670c27d161c42974740987cb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/fa639f555afbe6bf670c27d161c42974740987cb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fa639f555afbe6bf670c27d161c42974740987cb/comments",
  "author": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0455b7d325801142694c0a222acb08c7e2739f7d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0455b7d325801142694c0a222acb08c7e2739f7d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0455b7d325801142694c0a222acb08c7e2739f7d"
    }
  ],
  "stats": {
    "total": 120,
    "additions": 119,
    "deletions": 1
  },
  "files": [
    {
      "sha": "b379fcf24d5e617ac5c81be139e58cf595a06a4a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -1,3 +1,8 @@\n+2020-12-19  Hannes Domani  <ssbssa@yahoo.de>\n+\n+\tPR exp/27070\n+\t* gdbtypes.c (check_types_equal): Don't compare types of enum fields.\n+\n 2020-12-19  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* configure.ac: Move the static libs vs. source-highlight"
    },
    {
      "sha": "569e7a3e65902c917cdb8f7125e7aaf57ab6eb38",
      "filename": "gdb/gdbtypes.c",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/gdbtypes.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/gdbtypes.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbtypes.c?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -4175,7 +4175,9 @@ check_types_equal (struct type *type1, struct type *type2,\n \t    case FIELD_LOC_KIND_ENUMVAL:\n \t      if (FIELD_ENUMVAL (*field1) != FIELD_ENUMVAL (*field2))\n \t\treturn false;\n-\t      break;\n+\t      /* Don't compare types of enum fields, because they don't\n+\t\t have a type.  */\n+\t      continue;\n \t    case FIELD_LOC_KIND_PHYSADDR:\n \t      if (FIELD_STATIC_PHYSADDR (*field1)\n \t\t  != FIELD_STATIC_PHYSADDR (*field2))"
    },
    {
      "sha": "5b504526560dece92a0196babd8dc6612d17599a",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -1,3 +1,11 @@\n+2020-12-19  Hannes Domani  <ssbssa@yahoo.de>\n+\n+\tPR exp/27070\n+\t* gdb.python/compare-enum-type-a.c: New test.\n+\t* gdb.python/compare-enum-type-b.c: New test.\n+\t* gdb.python/compare-enum-type.exp: New file.\n+\t* gdb.python/compare-enum-type.h: New test.\n+\n 2020-12-18  Hannes Domani  <ssbssa@yahoo.de>\n \n \t* gdb.python/py-format-string.exp: Add tests for address keyword."
    },
    {
      "sha": "be04d29c3cdd15e62c422bb7aaa945efffba4132",
      "filename": "gdb/testsuite/gdb.python/compare-enum-type-a.c",
      "status": "added",
      "additions": 28,
      "deletions": 0,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type-a.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type-a.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/compare-enum-type-a.c?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -0,0 +1,28 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+#include \"compare-enum-type.h\"\n+\n+int func (void);\n+\n+enum e e1;\n+\n+int\n+main (void)\n+{\n+  return e1 + func ();\n+}"
    },
    {
      "sha": "622f490983d69cd17053440672586bd0bc00148a",
      "filename": "gdb/testsuite/gdb.python/compare-enum-type-b.c",
      "status": "added",
      "additions": 26,
      "deletions": 0,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type-b.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type-b.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/compare-enum-type-b.c?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -0,0 +1,26 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+#include \"compare-enum-type.h\"\n+\n+enum e e2;\n+\n+int\n+func (void)\n+{\n+  return e2;\n+}"
    },
    {
      "sha": "f05dcfe15b5ae0b0c543bc605578b0f7d24affe8",
      "filename": "gdb/testsuite/gdb.python/compare-enum-type.exp",
      "status": "added",
      "additions": 27,
      "deletions": 0,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/compare-enum-type.exp?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -0,0 +1,27 @@\n+# Copyright 2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# Test if enum type comparison succeeds (PR exp/27070).\n+\n+standard_testfile -a.c -b.c\n+\n+if { [prepare_for_testing \"failed to prepare\" \"compare-enum-type\" \\\n+\t  [list $srcfile $srcfile2]] } {\n+    return\n+}\n+\n+if { [skip_python_tests] } { continue }\n+\n+gdb_test \"py print(gdb.parse_and_eval('e1').type == gdb.parse_and_eval('e2').type)\" \"True\""
    },
    {
      "sha": "f149fc1a7e3053a9962f950840aec1e5e50cfd2d",
      "filename": "gdb/testsuite/gdb.python/compare-enum-type.h",
      "status": "added",
      "additions": 22,
      "deletions": 0,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa639f555afbe6bf670c27d161c42974740987cb/gdb/testsuite/gdb.python/compare-enum-type.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/compare-enum-type.h?ref=fa639f555afbe6bf670c27d161c42974740987cb",
      "patch": "@@ -0,0 +1,22 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+enum e\n+{\n+  zero,\n+  one,\n+};"
    }
  ]
}