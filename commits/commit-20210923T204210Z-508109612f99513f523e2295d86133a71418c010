{
  "sha": "508109612f99513f523e2295d86133a71418c010",
  "node_id": "C_kwDOANOeidoAKDUwODEwOTYxMmY5OTUxM2Y1MjNlMjI5NWQ4NjEzM2E3MTQxOGMwMTA",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-23T20:42:10Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-23T20:42:10Z"
    },
    "message": "[gdb/testsuite] Fix probe test in gdb.base/break-interp.exp\n\nWhen running test-case gdb.base/break-interp.exp on ubuntu 18.04.5, we have:\n...\n (gdb) bt^M\n #0  0x00007eff7ad5ae12 in ?? () from break-interp-LDprelinkNOdebugNO^M\n #1  0x00007eff7ad71f50 in ?? () from break-interp-LDprelinkNOdebugNO^M\n #2  0x00007eff7ad59128 in ?? () from break-interp-LDprelinkNOdebugNO^M\n #3  0x00007eff7ad58098 in ?? () from break-interp-LDprelinkNOdebugNO^M\n #4  0x0000000000000002 in ?? ()^M\n #5  0x00007fff505d7a32 in ?? ()^M\n #6  0x00007fff505d7a94 in ?? ()^M\n #7  0x0000000000000000 in ?? ()^M\n (gdb) FAIL: gdb.base/break-interp.exp: ldprelink=NO: ldsepdebug=NO: \\\n         first backtrace: dl bt\n...\n\nUsing the backtrace, the test-case tries to establish that we're stopped in\ndl_main.\n\nHowever, the backtrace only shows an address, because:\n- the dynamic linker contains no minimal symbols and no debug info, and\n- gdb is build without --with-separate-debug-dir so it can't find the\n  corresponding .debug file, which does contain the mimimal symbols and\n  debug info.\n\nAs in \"[gdb/testsuite] Improve probe detection in gdb.base/break-probes.exp\",\nfix this by doing info probes and grepping for the address.\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "9f80385f7be6f7c0a2361cf1f5adad5035e12a05",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9f80385f7be6f7c0a2361cf1f5adad5035e12a05"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/508109612f99513f523e2295d86133a71418c010",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/508109612f99513f523e2295d86133a71418c010",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/508109612f99513f523e2295d86133a71418c010",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/508109612f99513f523e2295d86133a71418c010/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d264c39e8b3eba663c8f09f228ca44eb36eac778",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d264c39e8b3eba663c8f09f228ca44eb36eac778",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d264c39e8b3eba663c8f09f228ca44eb36eac778"
    }
  ],
  "stats": {
    "total": 34,
    "additions": 33,
    "deletions": 1
  },
  "files": [
    {
      "sha": "fd2b166de5dc7c0504df0e1bce0013223fad17e5",
      "filename": "gdb/testsuite/gdb.base/break-interp.exp",
      "status": "modified",
      "additions": 33,
      "deletions": 1,
      "changes": 34,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/508109612f99513f523e2295d86133a71418c010/gdb/testsuite/gdb.base/break-interp.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/508109612f99513f523e2295d86133a71418c010/gdb/testsuite/gdb.base/break-interp.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/break-interp.exp?ref=508109612f99513f523e2295d86133a71418c010",
      "patch": "@@ -84,6 +84,16 @@ gdb_test_multiple $test $test {\n }\n \n set interp_system [section_get [standard_output_file $binfile_test] .interp]\n+clean_restart $interp_system\n+set dl_main_found 0\n+gdb_test_multiple \"info addr dl_main\" \"\" {\n+    -re -wrap \"Symbol \\\"dl_main\\\" is a function at address $hex\\\\.\" {\n+\tset dl_main_found 1\n+    }\n+    -re -wrap \"No symbol \\\"dl_main\\\" in current context\\\\.\" {\n+    }\n+}\n+\n set interp_system_debug [system_debug_get $interp_system]\n verbose -log \"$interp_system has debug $interp_system_debug\"\n \n@@ -381,6 +391,7 @@ proc test_attach {file displacement {relink_args \"\"}} {\n \n proc test_ld {file ifmain trynosym displacement} {\n     global srcdir subdir gdb_prompt expect_out inferior_exited_re solib_bp\n+    global hex dl_main_found\n \n     # First test normal `file'-command loaded $FILE with symbols.\n \n@@ -413,7 +424,28 @@ proc test_ld {file ifmain trynosym displacement} {\n \n     with_test_prefix \"first backtrace\" {\n \tgdb_test_no_output \"set verbose off\"\n-\tgdb_test \"bt\" \"#0 +\\[^\\r\\n\\]*\\\\m(__GI_)?$solib_bp\\\\M.*\" \"dl bt\"\n+\tgdb_test_multiple \"bt\" \"dl bt\" {\n+\t    -re -wrap \"#0 +\\[^\\r\\n\\]*\\\\m(__GI_)?$solib_bp\\\\M.*\" {\n+\t\tpass $gdb_test_name\n+\t    }\n+\t    -re -wrap \"#0  ($hex) .*\" {\n+\t\tif { $dl_main_found } {\n+\t\t    fail $gdb_test_name\n+\t\t} else {\n+\t\t    set pc $expect_out(1,string)\n+\t\t    regsub \"0x0*\" $pc \"\" pc\n+\t\t    gdb_test \"p /x 0x$pc\" \".*\"\n+\t\t    gdb_test_multiple \"info probes stap rtld\" $gdb_test_name {\n+\t\t\t-re -wrap \"(?:init_start|init_complete) +0x0*$pc .*\" {\n+\t\t\t    pass $gdb_test_name\n+\t\t\t}\n+\t\t\t-re -wrap \"\" {\n+\t\t\t    fail $gdb_test_name\n+\t\t\t}\n+\t\t    }\n+\t\t}\n+\t    }\n+\t}\n \tgdb_test_no_output \"set verbose on\"\n     }\n "
    }
  ]
}