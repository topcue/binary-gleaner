{
  "sha": "dc42e902cc54af2b7e7b54a1171d562f867342d5",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGM0MmU5MDJjYzU0YWYyYjdlN2I1NGExMTcxZDU2MmY4NjczNDJkNQ==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-05-21T21:14:05Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-05-21T22:46:07Z"
    },
    "message": "gdb/fortran: Handle gdbarch_floatformat_for_type returning nullptr\n\nIn this commit:\n\n  commit 34d11c682fd96c7dbe3ebd6cd9033e65d51ec7a3\n  Date:   Fri May 3 15:23:55 2019 +0100\n\n      gdb/fortran: Use floatformats_ia64_quad for fortran 16-byte floats\n\nGDB was changed such that the Fortran's 16-byte float format was\nobtained by calling gdbarch_floatformat_for_type instead of just using\ngdbarch_long_double_format as it was before.\n\nThe problem with this default_floatformat_for_type can return NULL in\nsome cases, and the code introduced in 34d11c682f didn't consider\nthis.\n\nThis commit introduces several alternative strategies for finding a\nsuitable 16-byte floating point type.  First GDB calls\ngdbarch_floatformat_for_type (this was what 34d11c682f added), if this\nreturns null GDB will use gdbarch_long_double_format if it is the\ncorrect size (this was the format used before 34d11c682f).  Finally,\nif neither of the above provides a suitable type then GDB will create\na new dummy type.\n\nThis final dummy type is unlikely to provide an correct debug\nexperience as far as examining the 16-byte floats, but it should\nprevent GDB crashing.\n\ngdb/ChangeLog:\n\n\tPR gdb/18644:\n\t* f-lang.c (build_fortran_types): Handle the case where\n\tgdbarch_floatformat_for_type returns a nullptr.",
    "tree": {
      "sha": "8548eb6cc33516114da33611af60aa2ee2ee15d3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8548eb6cc33516114da33611af60aa2ee2ee15d3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/dc42e902cc54af2b7e7b54a1171d562f867342d5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dc42e902cc54af2b7e7b54a1171d562f867342d5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/dc42e902cc54af2b7e7b54a1171d562f867342d5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dc42e902cc54af2b7e7b54a1171d562f867342d5/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b474a2022dc14fea0dd8ea4cc66b813486132075",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b474a2022dc14fea0dd8ea4cc66b813486132075",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b474a2022dc14fea0dd8ea4cc66b813486132075"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 16,
    "deletions": 2
  },
  "files": [
    {
      "sha": "b0b7503b28433e1e42dcc54943ec22f5dbf4e846",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dc42e902cc54af2b7e7b54a1171d562f867342d5/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dc42e902cc54af2b7e7b54a1171d562f867342d5/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=dc42e902cc54af2b7e7b54a1171d562f867342d5",
      "patch": "@@ -1,3 +1,9 @@\n+2019-05-21  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\tPR gdb/18644:\n+\t* f-lang.c (build_fortran_types): Handle the case where\n+\tgdbarch_floatformat_for_type returns a nullptr.\n+\n 2019-05-21  Tom de Vries  <tdevries@suse.de>\n \n \tPR cli/24587"
    },
    {
      "sha": "e612eeda7f7fe0ad7b8c1f2dd8603b093d0f322a",
      "filename": "gdb/f-lang.c",
      "status": "modified",
      "additions": 10,
      "deletions": 2,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dc42e902cc54af2b7e7b54a1171d562f867342d5/gdb/f-lang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dc42e902cc54af2b7e7b54a1171d562f867342d5/gdb/f-lang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/f-lang.c?ref=dc42e902cc54af2b7e7b54a1171d562f867342d5",
      "patch": "@@ -728,8 +728,16 @@ build_fortran_types (struct gdbarch *gdbarch)\n     = arch_float_type (gdbarch, gdbarch_double_bit (gdbarch),\n \t\t       \"real*8\", gdbarch_double_format (gdbarch));\n   auto fmt = gdbarch_floatformat_for_type (gdbarch, \"real(kind=16)\", 128);\n-  builtin_f_type->builtin_real_s16\n-    = arch_float_type (gdbarch, 128, \"real*16\", fmt);\n+  if (fmt != nullptr)\n+    builtin_f_type->builtin_real_s16\n+      = arch_float_type (gdbarch, 128, \"real*16\", fmt);\n+  else if (gdbarch_long_double_bit (gdbarch) == 128)\n+    builtin_f_type->builtin_real_s16\n+      = arch_float_type (gdbarch, gdbarch_long_double_bit (gdbarch),\n+\t\t\t \"real*16\", gdbarch_long_double_format (gdbarch));\n+  else\n+    builtin_f_type->builtin_real_s16\n+      = arch_type (gdbarch, TYPE_CODE_ERROR, 128, \"real*16\");\n \n   builtin_f_type->builtin_complex_s8\n     = arch_complex_type (gdbarch, \"complex*8\","
    }
  ]
}