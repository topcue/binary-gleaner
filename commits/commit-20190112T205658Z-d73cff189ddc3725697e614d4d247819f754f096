{
  "sha": "d73cff189ddc3725697e614d4d247819f754f096",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDczY2ZmMTg5ZGRjMzcyNTY5N2U2MTRkNGQyNDc4MTlmNzU0ZjA5Ng==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2018-12-31T13:37:09Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-01-12T20:56:58Z"
    },
    "message": "Implement help/show values for 'set|show style'.\n\nCurrently, the behaviour is:\n  (gdb) show style\n  (gdb) set style\n  (gdb) show style address\n  (gdb) set style address\n  (gdb)\n\nWith this patch, the behaviour is:\n  (gdb) show style\n  style address background:  The \"address\" background color is: none\n  style address foreground:  The \"address\" foreground color is: blue\n  style address intensity:  The \"address\" display intensity is: normal\n  enabled:  CLI output styling is enabled.\n  style filename background:  The \"filename\" background color is: none\n  style filename foreground:  The \"filename\" foreground color is: green\n  style filename intensity:  The \"filename\" display intensity is: normal\n  style function background:  The \"function\" background color is: none\n  style function foreground:  The \"function\" foreground color is: yellow\n  style function intensity:  The \"function\" display intensity is: normal\n  style variable background:  The \"variable\" background color is: none\n  style variable foreground:  The \"variable\" foreground color is: cyan\n  style variable intensity:  The \"variable\" display intensity is: normal\n  (gdb) set style\n  \"set style\" must be followed by an appropriate subcommand.\n  List of set style subcommands:\n\n  set style address -- Address display styling\n  set style enabled -- Set whether CLI styling is enabled\n  set style filename -- Filename display styling\n  set style function -- Function name display styling\n  set style variable -- Variable name display styling\n\n  Type \"help set style\" followed by set style subcommand name for full documentation.\n  Type \"apropos word\" to search for commands related to \"word\".\n  Command name abbreviations are allowed if unambiguous.\n  (gdb) show style address\n  background:  The \"filename\" background color is: none\n  foreground:  The \"filename\" foreground color is: green\n  intensity:  The \"filename\" display intensity is: normal\n  (gdb) set style address\n  List of set style address subcommands:\n\n  set style address background -- Set the background color for this property\n  set style address foreground -- Set the foreground color for this property\n  set style address intensity -- Set the display intensity color for this property\n\n  Type \"help set style address\" followed by set style address subcommand name for full documentation.\n  Type \"apropos word\" to search for commands related to \"word\".\n  Command name abbreviations are allowed if unambiguous.\n  (gdb)\n\ngdb/ChangeLog\n\t* cli/cli-style.h (class cli_style_option): <add_setshow_commands>\n\tRemove arg prefixname, add do_set and do_show.\n\tAdd member functions set_list and show_list.\n\t* cli/cli-style.c (class cli_style_option): Update accordingly.\n\t(style_set_list): Move to file scope.\n\t(style_show_list): Likewise.\n\t(set_style): Call help_list.\n\t(show_style): Call cmd_show_list.\n\t(_initialize_cli_style): New macro STYLE_ADD_SETSHOW_COMMANDS.\n\tUpdate to use the new macro.",
    "tree": {
      "sha": "65ffa0063199581de0f877d0ab7f5dab47b414df",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/65ffa0063199581de0f877d0ab7f5dab47b414df"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d73cff189ddc3725697e614d4d247819f754f096",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d73cff189ddc3725697e614d4d247819f754f096",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d73cff189ddc3725697e614d4d247819f754f096",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d73cff189ddc3725697e614d4d247819f754f096/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "4ce8c66d19abec8a768add7f6102e856157a3952",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4ce8c66d19abec8a768add7f6102e856157a3952",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4ce8c66d19abec8a768add7f6102e856157a3952"
    }
  ],
  "stats": {
    "total": 128,
    "additions": 74,
    "deletions": 54
  },
  "files": [
    {
      "sha": "18a2dbb80143031e571437d4082968837a4a12dd",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d73cff189ddc3725697e614d4d247819f754f096/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d73cff189ddc3725697e614d4d247819f754f096/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=d73cff189ddc3725697e614d4d247819f754f096",
      "patch": "@@ -1,3 +1,16 @@\n+2019-01-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* cli/cli-style.h (class cli_style_option): <add_setshow_commands>\n+\tRemove arg prefixname, add do_set and do_show.\n+\tAdd member functions set_list and show_list.\n+\t* cli/cli-style.c (class cli_style_option): Update accordingly.\n+\t(style_set_list): Move to file scope.\n+\t(style_show_list): Likewise.\n+\t(set_style): Call help_list.\n+\t(show_style): Call cmd_show_list.\n+\t(_initialize_cli_style): New macro STYLE_ADD_SETSHOW_COMMANDS.\n+\tUpdate to use the new macro.\n+\n 2019-10-12  Joel Brobecker  <brobecker@adacore.com>\n \n \t* ada-lang.c (_initialize_ada_language): Expand the help text"
    },
    {
      "sha": "234cc410dda9706a90bbe95e479e1160c5ef7ebe",
      "filename": "gdb/cli/cli-style.c",
      "status": "modified",
      "additions": 51,
      "deletions": 48,
      "changes": 99,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d73cff189ddc3725697e614d4d247819f754f096/gdb/cli/cli-style.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d73cff189ddc3725697e614d4d247819f754f096/gdb/cli/cli-style.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-style.c?ref=d73cff189ddc3725697e614d4d247819f754f096",
      "patch": "@@ -114,20 +114,6 @@ cli_style_option::style () const\n \n /* See cli-style.h.  */\n \n-void\n-cli_style_option::do_set (const char *args, int from_tty)\n-{\n-}\n-\n-/* See cli-style.h.  */\n-\n-void\n-cli_style_option::do_show (const char *args, int from_tty)\n-{\n-}\n-\n-/* See cli-style.h.  */\n-\n void\n cli_style_option::do_show_foreground (struct ui_file *file, int from_tty,\n \t\t\t\t      struct cmd_list_element *cmd,\n@@ -168,12 +154,15 @@ void\n cli_style_option::add_setshow_commands (const char *name,\n \t\t\t\t\tenum command_class theclass,\n \t\t\t\t\tconst char *prefix_doc,\n-\t\t\t\t\tconst char *prefixname,\n \t\t\t\t\tstruct cmd_list_element **set_list,\n-\t\t\t\t\tstruct cmd_list_element **show_list)\n+\t\t\t\t\tvoid (*do_set) (const char *args,\n+\t\t\t\t\t\t\tint from_tty),\n+\t\t\t\t\tstruct cmd_list_element **show_list,\n+\t\t\t\t\tvoid (*do_show) (const char *args,\n+\t\t\t\t\t\t\t int from_tty))\n {\n-  m_set_prefix = std::string (\"set \") + prefixname + \" \";\n-  m_show_prefix = std::string (\"show \") + prefixname + \" \";\n+  m_set_prefix = std::string (\"set style \") + name + \" \";\n+  m_show_prefix = std::string (\"show style \") + name + \" \";\n \n   add_prefix_cmd (name, no_class, do_set, prefix_doc, &m_set_list,\n \t\t  m_set_prefix.c_str (), 0, set_list);\n@@ -198,23 +187,29 @@ cli_style_option::add_setshow_commands (const char *name,\n \t\t\t&m_set_list, &m_show_list, (void *) name);\n   add_setshow_enum_cmd (\"intensity\", theclass, cli_intensities,\n \t\t\t&m_intensity,\n-\t\t\t_(\"Set the display intensity color for this property\"),\n-\t\t\t_(\"\\\n-Show the display intensity color for this property\"),\n+\t\t\t_(\"Set the display intensity for this property\"),\n+\t\t\t_(\"Show the display intensity for this property\"),\n \t\t\tnullptr,\n \t\t\tnullptr,\n \t\t\tdo_show_intensity,\n \t\t\t&m_set_list, &m_show_list, (void *) name);\n }\n \n+static cmd_list_element *style_set_list;\n+static cmd_list_element *style_show_list;\n+\n static void\n set_style (const char *arg, int from_tty)\n {\n+  printf_unfiltered (_(\"\\\"set style\\\" must be followed \"\n+\t\t       \"by an appropriate subcommand.\\n\"));\n+  help_list (style_set_list, \"set style \", all_commands, gdb_stdout);\n }\n \n static void\n show_style (const char *arg, int from_tty)\n {\n+  cmd_show_list (style_show_list, from_tty, \"\");\n }\n \n static void\n@@ -236,9 +231,6 @@ show_style_enabled (struct ui_file *file, int from_tty,\n void\n _initialize_cli_style ()\n {\n-  static cmd_list_element *style_set_list;\n-  static cmd_list_element *style_show_list;\n-\n   add_prefix_cmd (\"style\", no_class, set_style, _(\"\\\n Style-specific settings\\n\\\n Configure various style-related variables, such as colors\"),\n@@ -255,32 +247,43 @@ If enabled, output to the terminal is styled.\"),\n \t\t\t   set_style_enabled, show_style_enabled,\n \t\t\t   &style_set_list, &style_show_list);\n \n-  file_name_style.add_setshow_commands (\"filename\", no_class,\n-\t\t\t\t\t_(\"\\\n+#define STYLE_ADD_SETSHOW_COMMANDS(STYLE, NAME, PREFIX_DOC)\t  \\\n+  STYLE.add_setshow_commands (NAME, no_class, PREFIX_DOC,\t\t\\\n+\t\t\t      &style_set_list,\t\t\t\t\\\n+\t\t\t      [] (const char *args, int from_tty)\t\\\n+\t\t\t      {\t\t\t\t\t\t\\\n+\t\t\t\thelp_list\t\t\t\t\\\n+\t\t\t\t  (STYLE.set_list (),\t\t\t\\\n+\t\t\t\t   \"set style \" NAME \" \",\t\t\\\n+\t\t\t\t   all_commands,\t\t\t\\\n+\t\t\t\t   gdb_stdout);\t\t\t\t\\\n+\t\t\t      },\t\t\t\t\t\\\n+\t\t\t      &style_show_list,\t\t\t\t\\\n+\t\t\t      [] (const char *args, int from_tty)\t\\\n+\t\t\t      {\t\t\t\t\t\t\\\n+\t\t\t\tcmd_show_list\t\t\t\t\\\n+\t\t\t\t  (STYLE.show_list (),\t\t\t\\\n+\t\t\t\t   from_tty,\t\t\t\t\\\n+\t\t\t\t   \"\");\t\t\t\t\t\\\n+\t\t\t      })\n+\n+  STYLE_ADD_SETSHOW_COMMANDS (file_name_style, \"filename\",\n+\t\t\t      _(\"\\\n Filename display styling\\n\\\n-Configure filename colors and display intensity.\"),\n-\t\t\t\t\t\"style filename\",\n-\t\t\t\t\t&style_set_list,\n-\t\t\t\t\t&style_show_list);\n-  function_name_style.add_setshow_commands (\"function\", no_class,\n-\t\t\t\t\t    _(\"\\\n+Configure filename colors and display intensity.\"));\n+\n+  STYLE_ADD_SETSHOW_COMMANDS (function_name_style, \"function\",\n+\t\t\t      _(\"\\\n Function name display styling\\n\\\n-Configure function name colors and display intensity\"),\n-\t\t\t\t\t    \"style function\",\n-\t\t\t\t\t    &style_set_list,\n-\t\t\t\t\t    &style_show_list);\n-  variable_name_style.add_setshow_commands (\"variable\", no_class,\n-\t\t\t\t\t    _(\"\\\n+Configure function name colors and display intensity\"));\n+\n+  STYLE_ADD_SETSHOW_COMMANDS (variable_name_style, \"variable\",\n+\t\t\t      _(\"\\\n Variable name display styling\\n\\\n-Configure variable name colors and display intensity\"),\n-\t\t\t\t\t    \"style variable\",\n-\t\t\t\t\t    &style_set_list,\n-\t\t\t\t\t    &style_show_list);\n-  address_style.add_setshow_commands (\"address\", no_class,\n-\t\t\t\t      _(\"\\\n+Configure variable name colors and display intensity\"));\n+\n+  STYLE_ADD_SETSHOW_COMMANDS (address_style, \"address\",\n+\t\t\t      _(\"\\\n Address display styling\\n\\\n-Configure address colors and display intensity\"),\n-\t\t\t\t      \"style address\",\n-\t\t\t\t      &style_set_list,\n-\t\t\t\t      &style_show_list);\n+Configure address colors and display intensity\"));\n }"
    },
    {
      "sha": "07830f9dfd350d39985d34e552822eb36c7931ba",
      "filename": "gdb/cli/cli-style.h",
      "status": "modified",
      "additions": 10,
      "deletions": 6,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d73cff189ddc3725697e614d4d247819f754f096/gdb/cli/cli-style.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d73cff189ddc3725697e614d4d247819f754f096/gdb/cli/cli-style.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-style.h?ref=d73cff189ddc3725697e614d4d247819f754f096",
      "patch": "@@ -38,9 +38,17 @@ class cli_style_option\n   void add_setshow_commands (const char *name,\n \t\t\t     enum command_class theclass,\n \t\t\t     const char *prefix_doc,\n-\t\t\t     const char *prefixname,\n \t\t\t     struct cmd_list_element **set_list,\n-\t\t\t     struct cmd_list_element **show_list);\n+\t\t\t     void (*do_set) (const char *args, int from_tty),\n+\t\t\t     struct cmd_list_element **show_list,\n+\t\t\t     void (*do_show) (const char *args, int from_tty));\n+\n+  /* Return the 'set style NAME' command list, that can be used\n+     to build a lambda DO_SET to call add_setshow_commands.  */\n+  struct cmd_list_element *set_list () { return m_set_list; };\n+\n+  /* Same as SET_LIST but for the show command list.  */\n+  struct cmd_list_element *show_list () { return m_show_list; };\n \n private:\n \n@@ -59,10 +67,6 @@ class cli_style_option\n   struct cmd_list_element *m_set_list = nullptr;\n   struct cmd_list_element *m_show_list = nullptr;\n \n-  /* Callback to set a value.  */\n-  static void do_set (const char *args, int from_tty);\n-  /* Callback to show a value.  */\n-  static void do_show (const char *args, int from_tty);\n   /* Callback to show the foreground.  */\n   static void do_show_foreground (struct ui_file *file, int from_tty,\n \t\t\t\t  struct cmd_list_element *cmd,"
    }
  ]
}