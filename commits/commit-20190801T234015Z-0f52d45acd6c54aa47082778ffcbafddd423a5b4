{
  "sha": "0f52d45acd6c54aa47082778ffcbafddd423a5b4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MGY1MmQ0NWFjZDZjNTRhYTQ3MDgyNzc4ZmZjYmFmZGRkNDIzYTViNA==",
  "commit": {
    "author": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-08-01T23:40:15Z"
    },
    "committer": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-08-01T23:40:15Z"
    },
    "message": "RISC-V: Fix lui relax failure with relro.\n\n\tbfd/ChangeLog\n\tIlia Diachkov  <ilia.diachkov@optimitech.com>\n\t* elfnn-riscv.c (_bfd_riscv_relax_lui): Set lui relax safety area to\n\ttwo pages in relro presence.",
    "tree": {
      "sha": "17c5756dd4bd6a5f6a84f7124d221be02abc0a1c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/17c5756dd4bd6a5f6a84f7124d221be02abc0a1c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0f52d45acd6c54aa47082778ffcbafddd423a5b4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0f52d45acd6c54aa47082778ffcbafddd423a5b4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0f52d45acd6c54aa47082778ffcbafddd423a5b4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0f52d45acd6c54aa47082778ffcbafddd423a5b4/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "0eba165a74cdb039a5e6ed86e0396d80f68ca22c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0eba165a74cdb039a5e6ed86e0396d80f68ca22c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0eba165a74cdb039a5e6ed86e0396d80f68ca22c"
    }
  ],
  "stats": {
    "total": 14,
    "additions": 12,
    "deletions": 2
  },
  "files": [
    {
      "sha": "ae30d7e94b9b7fc5ed4eecbec26c2a43fd606b78",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0f52d45acd6c54aa47082778ffcbafddd423a5b4/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0f52d45acd6c54aa47082778ffcbafddd423a5b4/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=0f52d45acd6c54aa47082778ffcbafddd423a5b4",
      "patch": "@@ -1,3 +1,8 @@\n+2019-08-01  Ilia Diachkov  <ilia.diachkov@optimitech.com>\n+\n+\t* elfnn-riscv.c (_bfd_riscv_relax_lui): Set lui relax safety area to\n+\ttwo pages in relro presence.\n+\n 2019-08-01  Max Filippov  <jcmvbkbc@gmail.com>\n \n \t* elf32-xtensa.c (insn_num_slots, get_rsr_lend_opcode)"
    },
    {
      "sha": "706dcb923f113bb9553ad7877afc09c1015c908a",
      "filename": "bfd/elfnn-riscv.c",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0f52d45acd6c54aa47082778ffcbafddd423a5b4/bfd/elfnn-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0f52d45acd6c54aa47082778ffcbafddd423a5b4/bfd/elfnn-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-riscv.c?ref=0f52d45acd6c54aa47082778ffcbafddd423a5b4",
      "patch": "@@ -3562,11 +3562,16 @@ _bfd_riscv_relax_lui (bfd *abfd,\n     }\n \n   /* Can we relax LUI to C.LUI?  Alignment might move the section forward;\n-     account for this assuming page alignment at worst.  */\n+     account for this assuming page alignment at worst. In the presence of \n+     RELRO segment the linker aligns it by one page size, therefore sections\n+     after the segment can be moved more than one page. */\n+\n   if (use_rvc\n       && ELFNN_R_TYPE (rel->r_info) == R_RISCV_HI20\n       && VALID_RVC_LUI_IMM (RISCV_CONST_HIGH_PART (symval))\n-      && VALID_RVC_LUI_IMM (RISCV_CONST_HIGH_PART (symval + ELF_MAXPAGESIZE)))\n+      && VALID_RVC_LUI_IMM (RISCV_CONST_HIGH_PART (symval)\n+\t\t\t    + (link_info->relro ? 2 * ELF_MAXPAGESIZE\n+\t\t\t       : ELF_MAXPAGESIZE)))\n     {\n       /* Replace LUI with C.LUI if legal (i.e., rd != x0 and rd != x2/sp).  */\n       bfd_vma lui = bfd_get_32 (abfd, contents + rel->r_offset);"
    }
  ]
}