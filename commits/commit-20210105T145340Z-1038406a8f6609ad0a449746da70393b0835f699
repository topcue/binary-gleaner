{
  "sha": "1038406a8f6609ad0a449746da70393b0835f699",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTAzODQwNmE4ZjY2MDlhZDBhNDQ5NzQ2ZGE3MDM5M2IwODM1ZjY5OQ==",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-01-05T13:25:56Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-01-05T14:53:40Z"
    },
    "message": "libctf: rip out BFD_DEPENDENCIES / BFD_LIBADD\n\nThis complex morass inherited from libopcodes, which endeavours to\nimplement the effect of specifying ../bfd/libbfd.la in _LIBADD without\nactually doing so, appears to be working around a libtool bug which as\nfar as I can see is no longer present (i.e., the install directory no\nlonger appears in -L arguments in libtool link-mode invocations, so\nthere is no danger of picking up old libbfds or other dependent\nlibraries).\n\nReplaced with a simple reference to libbfd.la in the appropriate place.\nAlso adjusted things a little more so that libctf.la and libctf-nobfd.la\nare self-contained, even when linking statically.  This opens up the\npossibility of running libtool to link against libctf from inside the\n(upcoming) testsuite.\n\nlibctf/ChangeLog\n2021-01-05  Nick Alcock  <nick.alcock@oracle.com>\n\n\t* configure.ac (BFD_LIBADD): Remove.\n\t(BFD_DEPENDENCIES): Likewise. Remove associated cases.\n\t(SHARED_LIBADD): Rename to...\n\t(CTF_LIBADD): ... this.  Stick in a suitable libiberty even when\n\tlinking statically.\n\t* Makefile.am (libctf_nobfd_la_LIBADD): Adjust accordingly.\n\tlibctf uses libintl.\n\t(libctf_la_LIBADD): Reference libbfd.la directly, not via\n\tBFD_LIBADD.\n\t(libctf_la_DEPENDENCIES): Remove.\n\t* Makefile.in: Regenerate.\n\t* configure: Likewise.",
    "tree": {
      "sha": "633a10646d1fff39581ac6008535f43f9393ebf0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/633a10646d1fff39581ac6008535f43f9393ebf0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1038406a8f6609ad0a449746da70393b0835f699",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1038406a8f6609ad0a449746da70393b0835f699",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1038406a8f6609ad0a449746da70393b0835f699",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1038406a8f6609ad0a449746da70393b0835f699/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "37002871ac2111eb3c88f44659c3c67d2fde1997",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/37002871ac2111eb3c88f44659c3c67d2fde1997",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/37002871ac2111eb3c88f44659c3c67d2fde1997"
    }
  ],
  "stats": {
    "total": 101,
    "additions": 36,
    "deletions": 65
  },
  "files": [
    {
      "sha": "7e4997eb95620865bd3e7b8618e6fd1812b00cee",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1038406a8f6609ad0a449746da70393b0835f699/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1038406a8f6609ad0a449746da70393b0835f699/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=1038406a8f6609ad0a449746da70393b0835f699",
      "patch": "@@ -1,3 +1,18 @@\n+2021-01-05  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* configure.ac (BFD_LIBADD): Remove.\n+\t(BFD_DEPENDENCIES): Likewise. Remove associated cases.\n+\t(SHARED_LIBADD): Rename to...\n+\t(CTF_LIBADD): ... this.  Stick in a suitable libiberty even when\n+\tlinking statically.\n+\t* Makefile.am (libctf_nobfd_la_LIBADD): Adjust accordingly.\n+\tlibctf uses libintl.\n+\t(libctf_la_LIBADD): Reference libbfd.la directly, not via\n+\tBFD_LIBADD.\n+\t(libctf_la_DEPENDENCIES): Remove.\n+\t* Makefile.in: Regenerate.\n+\t* configure: Likewise.\n+\n 2021-01-05  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* ctf-decl.c (ctf_decl_push): Exclude slices from the decl stack."
    },
    {
      "sha": "a66ccc1a218d043bf49f9840320cc3ff2bfb1eff",
      "filename": "libctf/Makefile.am",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1038406a8f6609ad0a449746da70393b0835f699/libctf/Makefile.am",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1038406a8f6609ad0a449746da70393b0835f699/libctf/Makefile.am",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/Makefile.am?ref=1038406a8f6609ad0a449746da70393b0835f699",
      "patch": "@@ -39,7 +39,7 @@ include_HEADERS =\n noinst_LTLIBRARIES = libctf.la libctf-nobfd.la\n endif\n \n-libctf_nobfd_la_LIBADD = @SHARED_LIBADD@ $(ZLIB)\n+libctf_nobfd_la_LIBADD = @CTF_LIBADD@ $(LIBINTL) $(ZLIB)\n libctf_nobfd_la_LDFLAGS = -version-info 0:0:0 @SHARED_LDFLAGS@ @VERSION_FLAGS@\n libctf_nobfd_la_CPPFLAGS = $(AM_CPPFLAGS) -DNOBFD=1\n libctf_nobfd_la_SOURCES = ctf-archive.c ctf-dump.c ctf-create.c ctf-decl.c ctf-error.c \\\n@@ -50,8 +50,7 @@ if NEED_CTF_QSORT_R\n libctf_nobfd_la_SOURCES += ctf-qsort_r.c\n endif\n \n-libctf_la_LIBADD = @BFD_LIBADD@ $(libctf_nobfd_la_LIBADD)\n+libctf_la_LIBADD = ../bfd/libbfd.la $(libctf_nobfd_la_LIBADD)\n libctf_la_CPPFLAGS = $(AM_CPPFLAGS) -DNOBFD=0\n-libctf_la_DEPENDENCIES = @BFD_DEPENDENCIES@\n libctf_la_LDFLAGS = $(libctf_nobfd_la_LDFLAGS)\n libctf_la_SOURCES = $(libctf_nobfd_la_SOURCES) ctf-open-bfd.c"
    },
    {
      "sha": "0ee67fcc0107b6a6ac3527d6ef16efc6aec0d217",
      "filename": "libctf/Makefile.in",
      "status": "modified",
      "additions": 7,
      "deletions": 8,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1038406a8f6609ad0a449746da70393b0835f699/libctf/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1038406a8f6609ad0a449746da70393b0835f699/libctf/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/Makefile.in?ref=1038406a8f6609ad0a449746da70393b0835f699",
      "patch": "@@ -163,7 +163,8 @@ am__uninstall_files_from_dir = { \\\n am__installdirs = \"$(DESTDIR)$(libdir)\" \"$(DESTDIR)$(includedir)\"\n LTLIBRARIES = $(lib_LTLIBRARIES) $(noinst_LTLIBRARIES)\n am__DEPENDENCIES_1 =\n-libctf_nobfd_la_DEPENDENCIES = $(am__DEPENDENCIES_1)\n+libctf_nobfd_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \\\n+\t$(am__DEPENDENCIES_1)\n am__libctf_nobfd_la_SOURCES_DIST = ctf-archive.c ctf-dump.c \\\n \tctf-create.c ctf-decl.c ctf-error.c ctf-hash.c ctf-labels.c \\\n \tctf-dedup.c ctf-link.c ctf-lookup.c ctf-open.c ctf-sha1.c \\\n@@ -189,7 +190,8 @@ libctf_nobfd_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \\\n \t-o $@\n @INSTALL_LIBBFD_FALSE@am_libctf_nobfd_la_rpath =\n @INSTALL_LIBBFD_TRUE@am_libctf_nobfd_la_rpath = -rpath $(libdir)\n-am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1)\n+am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)\n+libctf_la_DEPENDENCIES = ../bfd/libbfd.la $(am__DEPENDENCIES_2)\n am__libctf_la_SOURCES_DIST = ctf-archive.c ctf-dump.c ctf-create.c \\\n \tctf-decl.c ctf-error.c ctf-hash.c ctf-labels.c ctf-dedup.c \\\n \tctf-link.c ctf-lookup.c ctf-open.c ctf-sha1.c ctf-string.c \\\n@@ -307,15 +309,14 @@ AUTOCONF = @AUTOCONF@\n AUTOHEADER = @AUTOHEADER@\n AUTOMAKE = @AUTOMAKE@\n AWK = @AWK@\n-BFD_DEPENDENCIES = @BFD_DEPENDENCIES@\n-BFD_LIBADD = @BFD_LIBADD@\n CATALOGS = @CATALOGS@\n CATOBJEXT = @CATOBJEXT@\n CC = @CC@\n CCDEPMODE = @CCDEPMODE@\n CFLAGS = @CFLAGS@\n CPP = @CPP@\n CPPFLAGS = @CPPFLAGS@\n+CTF_LIBADD = @CTF_LIBADD@\n CYGPATH_W = @CYGPATH_W@\n DATADIRNAME = @DATADIRNAME@\n DEFS = @DEFS@\n@@ -370,7 +371,6 @@ RANLIB = @RANLIB@\n SED = @SED@\n SET_MAKE = @SET_MAKE@\n SHARED_LDFLAGS = @SHARED_LDFLAGS@\n-SHARED_LIBADD = @SHARED_LIBADD@\n SHELL = @SHELL@\n STRIP = @STRIP@\n USE_NLS = @USE_NLS@\n@@ -453,16 +453,15 @@ AM_CFLAGS = -std=gnu99 @ac_libctf_warn_cflags@ @warn@ @c_warn@ @WARN_PEDANTIC@ @\n @INSTALL_LIBBFD_FALSE@include_HEADERS = \n @INSTALL_LIBBFD_TRUE@include_HEADERS = $(INCDIR)/ctf.h $(INCDIR)/ctf-api.h\n @INSTALL_LIBBFD_FALSE@noinst_LTLIBRARIES = libctf.la libctf-nobfd.la\n-libctf_nobfd_la_LIBADD = @SHARED_LIBADD@ $(ZLIB)\n+libctf_nobfd_la_LIBADD = @CTF_LIBADD@ $(LIBINTL) $(ZLIB)\n libctf_nobfd_la_LDFLAGS = -version-info 0:0:0 @SHARED_LDFLAGS@ @VERSION_FLAGS@\n libctf_nobfd_la_CPPFLAGS = $(AM_CPPFLAGS) -DNOBFD=1\n libctf_nobfd_la_SOURCES = ctf-archive.c ctf-dump.c ctf-create.c \\\n \tctf-decl.c ctf-error.c ctf-hash.c ctf-labels.c ctf-dedup.c \\\n \tctf-link.c ctf-lookup.c ctf-open.c ctf-sha1.c ctf-string.c \\\n \tctf-subr.c ctf-types.c ctf-util.c $(am__append_1)\n-libctf_la_LIBADD = @BFD_LIBADD@ $(libctf_nobfd_la_LIBADD)\n+libctf_la_LIBADD = ../bfd/libbfd.la $(libctf_nobfd_la_LIBADD)\n libctf_la_CPPFLAGS = $(AM_CPPFLAGS) -DNOBFD=0\n-libctf_la_DEPENDENCIES = @BFD_DEPENDENCIES@\n libctf_la_LDFLAGS = $(libctf_nobfd_la_LDFLAGS)\n libctf_la_SOURCES = $(libctf_nobfd_la_SOURCES) ctf-open-bfd.c\n all: config.h"
    },
    {
      "sha": "0a09b352b02db9127547fc7057f2c961108ac85b",
      "filename": "libctf/configure",
      "status": "modified",
      "additions": 7,
      "deletions": 29,
      "changes": 36,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1038406a8f6609ad0a449746da70393b0835f699/libctf/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1038406a8f6609ad0a449746da70393b0835f699/libctf/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/configure?ref=1038406a8f6609ad0a449746da70393b0835f699",
      "patch": "@@ -636,9 +636,7 @@ am__EXEEXT_TRUE\n LTLIBOBJS\n LIBOBJS\n VERSION_FLAGS\n-BFD_DEPENDENCIES\n-BFD_LIBADD\n-SHARED_LIBADD\n+CTF_LIBADD\n SHARED_LDFLAGS\n NEED_CTF_QSORT_R_FALSE\n NEED_CTF_QSORT_R_TRUE\n@@ -11520,7 +11518,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11523 \"configure\"\n+#line 11521 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -11626,7 +11624,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 11629 \"configure\"\n+#line 11627 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -13339,10 +13337,9 @@ $as_echo \"#define HAVE_O_CLOEXEC 1\" >>confdefs.h\n fi\n \n # Horrible hacks to build DLLs on Windows and a shared library elsewhere.\n-SHARED_LIBADD=\n+\n+CTF_LIBADD=\"-L`pwd`/../libiberty -liberty\"\n SHARED_LDFLAGS=\n-BFD_LIBADD=\n-BFD_DEPENDENCIES=\n if test \"$enable_shared\" = \"yes\"; then\n # When building a shared libctf, link against the pic version of libiberty\n # so that apps that use libctf won't need libiberty just to satisfy any\n@@ -13354,39 +13351,20 @@ if test \"$enable_shared\" = \"yes\"; then\n # since libbfd may not pull in the entirety of libiberty.\n   x=`sed -n -e 's/^[ \t]*PICFLAG[ \t]*=[ \t]*//p' < ../libiberty/Makefile | sed -n '$p'`\n   if test -n \"$x\"; then\n-    SHARED_LIBADD=\"-L`pwd`/../libiberty/pic -liberty\"\n+    CTF_LIBADD=\"-L`pwd`/../libiberty/pic -liberty\"\n   fi\n \n   case \"${host}\" in\n   # More hacks to build DLLs on Windows.\n     *-*-cygwin*)\n       SHARED_LDFLAGS=\"-no-undefined\"\n-      SHARED_LIBADD=\"-L`pwd`/../libiberty -liberty -L`pwd`/../intl -lintl -lcygwin\"\n-      BFD_LIBADD=\"-L`pwd`/../bfd -lbfd\"\n-      ;;\n-\n-    *-*-darwin*)\n-      BFD_LIBADD=\"-Wl,`pwd`/../bfd/.libs/libbfd.dylib\"\n-      BFD_DEPENDENCIES=\"../bfd/libbfd.la\"\n-      ;;\n-    *)\n-      case \"$host_vendor\" in\n-\thp)\n-\t  BFD_LIBADD=\"-Wl,`pwd`/../bfd/.libs/libbfd.sl\"\n-\t  ;;\n-\t*)\n-\t  BFD_LIBADD=\"-Wl,`pwd`/../bfd/.libs/libbfd.so\"\n-\t  ;;\n-      esac\n-      BFD_DEPENDENCIES=\"../bfd/libbfd.la\"\n+      CTF_LIBADD=\"$CTF_LIBADD -L`pwd`/../intl -lintl -lcygwin\"\n       ;;\n   esac\n fi\n \n \n \n-\n-\n # Use a version script, if possible, or an -export-symbols-regex otherwise.\n VERSION_FLAGS='-export-symbols-regex ctf_.*'\n if $LD --help 2>&1 | grep -- --version-script >/dev/null; then"
    },
    {
      "sha": "bbdfd63e7c99ca55db22872419241efc0f7ec70e",
      "filename": "libctf/configure.ac",
      "status": "modified",
      "additions": 5,
      "deletions": 25,
      "changes": 30,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1038406a8f6609ad0a449746da70393b0835f699/libctf/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1038406a8f6609ad0a449746da70393b0835f699/libctf/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/configure.ac?ref=1038406a8f6609ad0a449746da70393b0835f699",
      "patch": "@@ -170,10 +170,9 @@ if test $ac_cv_libctf_macro_O_CLOEXEC = yes; then\n fi\n \n # Horrible hacks to build DLLs on Windows and a shared library elsewhere.\n-SHARED_LIBADD=\n+\n+CTF_LIBADD=\"-L`pwd`/../libiberty -liberty\"\n SHARED_LDFLAGS=\n-BFD_LIBADD=\n-BFD_DEPENDENCIES=\n if test \"$enable_shared\" = \"yes\"; then\n # When building a shared libctf, link against the pic version of libiberty\n # so that apps that use libctf won't need libiberty just to satisfy any\n@@ -187,38 +186,19 @@ changequote(,)dnl\n   x=`sed -n -e 's/^[ \t]*PICFLAG[ \t]*=[ \t]*//p' < ../libiberty/Makefile | sed -n '$p'`\n changequote([,])dnl\n   if test -n \"$x\"; then\n-    SHARED_LIBADD=\"-L`pwd`/../libiberty/pic -liberty\"\n+    CTF_LIBADD=\"-L`pwd`/../libiberty/pic -liberty\"\n   fi\n \n   case \"${host}\" in\n   # More hacks to build DLLs on Windows.\n     *-*-cygwin*)\n       SHARED_LDFLAGS=\"-no-undefined\"\n-      SHARED_LIBADD=\"-L`pwd`/../libiberty -liberty -L`pwd`/../intl -lintl -lcygwin\"\n-      BFD_LIBADD=\"-L`pwd`/../bfd -lbfd\"\n-      ;;\n-\n-    *-*-darwin*)\n-      BFD_LIBADD=\"-Wl,`pwd`/../bfd/.libs/libbfd.dylib\"\n-      BFD_DEPENDENCIES=\"../bfd/libbfd.la\"\n-      ;;\n-    *)\n-      case \"$host_vendor\" in\n-\thp)\n-\t  BFD_LIBADD=\"-Wl,`pwd`/../bfd/.libs/libbfd.sl\"\n-\t  ;;\n-\t*)\n-\t  BFD_LIBADD=\"-Wl,`pwd`/../bfd/.libs/libbfd.so\"\n-\t  ;;\n-      esac\n-      BFD_DEPENDENCIES=\"../bfd/libbfd.la\"\n+      CTF_LIBADD=\"$CTF_LIBADD -L`pwd`/../intl -lintl -lcygwin\"\n       ;;\n   esac\n fi\n AC_SUBST(SHARED_LDFLAGS)\n-AC_SUBST(SHARED_LIBADD)\n-AC_SUBST(BFD_LIBADD)\n-AC_SUBST(BFD_DEPENDENCIES)\n+AC_SUBST(CTF_LIBADD)\n \n # Use a version script, if possible, or an -export-symbols-regex otherwise.\n VERSION_FLAGS='-export-symbols-regex ctf_.*'"
    }
  ]
}