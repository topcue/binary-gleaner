{
  "sha": "faa17681ccf5b45a14424c184d867a390d9e8086",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmFhMTc2ODFjY2Y1YjQ1YTE0NDI0YzE4NGQ4NjdhMzkwZDllODA4Ng==",
  "commit": {
    "author": {
      "name": "Iain Buclaw",
      "email": "ibuclaw@gdcproject.org",
      "date": "2020-02-05T11:25:09Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-02-07T21:06:02Z"
    },
    "message": "Make gdb_flush also flush the wrap buffer\n\nThis changes gdb_flush to also flush the internal wrap buffer.  A few\nplaces needed to continue using the previous approach, so this also\nintroduces ui_file_flush for those.\n\n2020-02-05  Iain Buclaw  <ibuclaw@gdcproject.org>\n\n        * gdb/event-loop.c (gdb_wait_for_event): Update.\n        * gdb/printcmd.c (printf_command): Update.\n        * gdb/remote-fileio.c (remote_fileio_func_write): Update.\n        * gdb/remote-sim.c (gdb_os_flush_stdout): Update.\n        (gdb_os_flush_stderr): Update.\n        * gdb/remote.c (remote_console_output): Update.\n        * gdb/ui-file.c (gdb_flush): Rename to...\n        (ui_file_flush): ...this.\n        (stderr_file::write): Update.\n        (stderr_file::puts): Update.\n        * gdb/ui-file.h (gdb_flush): Rename to...\n        (ui_file_flush): ...this.\n        * gdb/utils.c (gdb_flush): Add function.\n        * gdb/utils.h (gdb_flush): Add declaration.\n\nChange-Id: I7ca143d30f03dc39f218f6e880eb9bca9e15af39",
    "tree": {
      "sha": "63260d1dcb10d65f984fffebca177c520eb3ac04",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/63260d1dcb10d65f984fffebca177c520eb3ac04"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/faa17681ccf5b45a14424c184d867a390d9e8086",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/faa17681ccf5b45a14424c184d867a390d9e8086",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/faa17681ccf5b45a14424c184d867a390d9e8086",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/faa17681ccf5b45a14424c184d867a390d9e8086/comments",
  "author": {
    "login": "ibuclaw",
    "id": 397929,
    "node_id": "MDQ6VXNlcjM5NzkyOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ibuclaw",
    "html_url": "https://github.com/ibuclaw",
    "followers_url": "https://api.github.com/users/ibuclaw/followers",
    "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}",
    "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions",
    "organizations_url": "https://api.github.com/users/ibuclaw/orgs",
    "repos_url": "https://api.github.com/users/ibuclaw/repos",
    "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ibuclaw/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5abbbe1d13e03496af5564b997f3c3a2e79b4d73",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5abbbe1d13e03496af5564b997f3c3a2e79b4d73",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5abbbe1d13e03496af5564b997f3c3a2e79b4d73"
    }
  ],
  "stats": {
    "total": 56,
    "additions": 44,
    "deletions": 12
  },
  "files": [
    {
      "sha": "f3667bba13a9b3752953d961dd8a6e5eb6955cb8",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -1,3 +1,20 @@\n+2020-02-05  Iain Buclaw  <ibuclaw@gdcproject.org>\n+\n+        * gdb/event-loop.c (gdb_wait_for_event): Update.\n+        * gdb/printcmd.c (printf_command): Update.\n+        * gdb/remote-fileio.c (remote_fileio_func_write): Update.\n+        * gdb/remote-sim.c (gdb_os_flush_stdout): Update.\n+        (gdb_os_flush_stderr): Update.\n+        * gdb/remote.c (remote_console_output): Update.\n+        * gdb/ui-file.c (gdb_flush): Rename to...\n+        (ui_file_flush): ...this.\n+        (stderr_file::write): Update.\n+        (stderr_file::puts): Update.\n+        * gdb/ui-file.h (gdb_flush): Rename to...\n+        (ui_file_flush): ...this.\n+        * gdb/utils.c (gdb_flush): Add function.\n+        * gdb/utils.h (gdb_flush): Add declaration.\n+\n 2020-02-07  Tom Tromey  <tromey@adacore.com>\n \n \tPR breakpoints/24915:"
    },
    {
      "sha": "fbe6aa43249e11b8dcd95bc40880e1c3363d42e0",
      "filename": "gdb/event-loop.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/event-loop.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/event-loop.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/event-loop.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -750,8 +750,8 @@ gdb_wait_for_event (int block)\n   int num_found = 0;\n \n   /* Make sure all output is done before getting another event.  */\n-  gdb_flush (gdb_stdout);\n-  gdb_flush (gdb_stderr);\n+  ui_file_flush (gdb_stdout);\n+  ui_file_flush (gdb_stderr);\n \n   if (gdb_notifier.num_fds == 0)\n     return -1;"
    },
    {
      "sha": "1bfc28ea09965872f438a2e18951f6ba836d62c7",
      "filename": "gdb/event-top.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/event-top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/event-top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/event-top.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -416,7 +416,7 @@ display_gdb_prompt (const char *new_prompt)\n       /* Don't use a _filtered function here.  It causes the assumed\n          character position to be off, since the newline we read from\n          the user is not accounted for.  */\n-      fputs_unfiltered (actual_gdb_prompt.c_str (), gdb_stdout);\n+      fprintf_unfiltered (gdb_stdout, \"%s\", actual_gdb_prompt.c_str ());\n       gdb_flush (gdb_stdout);\n     }\n }"
    },
    {
      "sha": "cee0c8803552caae3d19206d0794951da138e646",
      "filename": "gdb/printcmd.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/printcmd.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/printcmd.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/printcmd.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -2720,7 +2720,7 @@ printf_command (const char *arg, int from_tty)\n   ui_printf (arg, gdb_stdout);\n   reset_terminal_style (gdb_stdout);\n   wrap_here (\"\");\n-  gdb_flush (gdb_stdout);\n+  ui_file_flush (gdb_stdout);\n }\n \n /* Implement the \"eval\" command.  */"
    },
    {
      "sha": "40add06509ed56e37a8701447b2182f749dc2093",
      "filename": "gdb/remote-fileio.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/remote-fileio.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/remote-fileio.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote-fileio.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -641,7 +641,7 @@ remote_fileio_func_write (remote_target *remote, char *buf)\n       case FIO_FD_CONSOLE_OUT:\n \tui_file_write (target_fd == 1 ? gdb_stdtarg : gdb_stdtargerr,\n \t\t       (char *) buffer, length);\n-\tgdb_flush (target_fd == 1 ? gdb_stdtarg : gdb_stdtargerr);\n+\tui_file_flush (target_fd == 1 ? gdb_stdtarg : gdb_stdtargerr);\n \tret = length;\n \tbreak;\n       default:"
    },
    {
      "sha": "ce13517a997c73f59a1dad5180a484e380fef79c",
      "filename": "gdb/remote-sim.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/remote-sim.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/remote-sim.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote-sim.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -360,7 +360,7 @@ gdb_os_write_stdout (host_callback *p, const char *buf, int len)\n static void\n gdb_os_flush_stdout (host_callback *p)\n {\n-  gdb_flush (gdb_stdtarg);\n+  ui_file_flush (gdb_stdtarg);\n }\n \n /* GDB version of os_write_stderr callback.  */\n@@ -385,7 +385,7 @@ gdb_os_write_stderr (host_callback *p, const char *buf, int len)\n static void\n gdb_os_flush_stderr (host_callback *p)\n {\n-  gdb_flush (gdb_stdtargerr);\n+  ui_file_flush (gdb_stdtargerr);\n }\n \n /* GDB version of printf_filtered callback.  */"
    },
    {
      "sha": "11ec857e125c208e40c183e38d9a4bff6e84af61",
      "filename": "gdb/remote.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/remote.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/remote.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -6847,7 +6847,7 @@ remote_console_output (const char *msg)\n       tb[1] = 0;\n       fputs_unfiltered (tb, gdb_stdtarg);\n     }\n-  gdb_flush (gdb_stdtarg);\n+  ui_file_flush (gdb_stdtarg);\n }\n \n struct stop_reply : public notif_event"
    },
    {
      "sha": "2d9a3789786e2df992c582e52ff11cc6543a2826",
      "filename": "gdb/ui-file.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/ui-file.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/ui-file.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ui-file.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -91,7 +91,7 @@ null_file::write_async_safe (const char *buf, long sizeof_buf)\n \f\n \n void\n-gdb_flush (struct ui_file *file)\n+ui_file_flush (struct ui_file *file)\n {\n   file->flush ();\n }\n@@ -315,7 +315,7 @@ stdio_file::can_emit_style_escape ()\n void\n stderr_file::write (const char *buf, long length_buf)\n {\n-  gdb_flush (gdb_stdout);\n+  ui_file_flush (gdb_stdout);\n   stdio_file::write (buf, length_buf);\n }\n \n@@ -325,7 +325,7 @@ stderr_file::write (const char *buf, long length_buf)\n void\n stderr_file::puts (const char *linebuffer)\n {\n-  gdb_flush (gdb_stdout);\n+  ui_file_flush (gdb_stdout);\n   stdio_file::puts (linebuffer);\n }\n "
    },
    {
      "sha": "b0bc3f23421c1a9357daf061722ffdf61418f742",
      "filename": "gdb/ui-file.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/ui-file.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/ui-file.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ui-file.h?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -100,7 +100,7 @@ class null_file : public ui_file\n /* A preallocated null_file stream.  */\n extern null_file null_stream;\n \n-extern void gdb_flush (ui_file *);\n+extern void ui_file_flush (ui_file *);\n \n extern int ui_file_isatty (struct ui_file *);\n "
    },
    {
      "sha": "b7222962270edd00e0f7fabc3125764992420cd9",
      "filename": "gdb/utils.c",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/utils.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/utils.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/utils.c?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -1544,6 +1544,15 @@ flush_wrap_buffer (struct ui_file *stream)\n     }\n }\n \n+/* See utils.h.  */\n+\n+void\n+gdb_flush (struct ui_file *stream)\n+{\n+  flush_wrap_buffer (stream);\n+  ui_file_flush (stream);\n+}\n+\n /* Indicate that if the next sequence of characters overflows the line,\n    a newline should be inserted here rather than when it hits the end.\n    If INDENT is non-null, it is a string to be printed to indent the"
    },
    {
      "sha": "3434ff1caa25046dd4a781701ccc22b247c054f6",
      "filename": "gdb/utils.h",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/utils.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/faa17681ccf5b45a14424c184d867a390d9e8086/gdb/utils.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/utils.h?ref=faa17681ccf5b45a14424c184d867a390d9e8086",
      "patch": "@@ -320,6 +320,12 @@ extern struct ui_file **current_ui_gdb_stdin_ptr (void);\n extern struct ui_file **current_ui_gdb_stderr_ptr (void);\n extern struct ui_file **current_ui_gdb_stdlog_ptr (void);\n \n+/* Flush STREAM.  This is a wrapper for ui_file_flush that also\n+   flushes any output pending from uses of the *_filtered output\n+   functions; that output is kept in a special buffer so that\n+   pagination and styling are handled properly.  */\n+extern void gdb_flush (struct ui_file *);\n+\n /* The current top level's ui_file streams.  */\n \n /* Normal results */"
    }
  ]
}