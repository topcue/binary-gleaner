{
  "sha": "1845e254645efbc02248345ccdb557d265dd8ae1",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTg0NWUyNTQ2NDVlZmJjMDIyNDgzNDVjY2RiNTU3ZDI2NWRkOGFlMQ==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-05-05T15:50:17Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-05-07T21:20:47Z"
    },
    "message": "gdb/guile: perform tilde expansion when sourcing guile scripts\n\nBefore this patch:\n\n  (gdb) source ~/script.scm\n  ERROR: In procedure apply-smob/1:\n  ERROR: In procedure primitive-load-path: Unable to find file \"~/script.scm\" in load path\n  Error while executing Scheme code.\n  (gdb)\n\nThis is because the path is not tilde expanded.  In contrast, when\nsourcing a .py or .gdb script the path is tilde expanded.\n\nThis commit fixes this oversight, and allows the above source command\nto work as expected.\n\nThe tilde expansion is done in the generic GDB code before we call the\nsourcer function for any particular extension language.\n\ngdb/ChangeLog:\n\n\t* cli/cli-cmds.c: Add 'gdbsupport/gdb_tilde_expand.h'\n\tinclude.\n\t(source_script_with_search): Perform tilde expansion.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.guile/guile.exp: Add an extra test.",
    "tree": {
      "sha": "f0edd8445b6289107098a9807c1a51dcf4650271",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f0edd8445b6289107098a9807c1a51dcf4650271"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1845e254645efbc02248345ccdb557d265dd8ae1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1845e254645efbc02248345ccdb557d265dd8ae1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1845e254645efbc02248345ccdb557d265dd8ae1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1845e254645efbc02248345ccdb557d265dd8ae1/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a3237c7cc7de4b3ea44d8874a0c90dff1f4d31dc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a3237c7cc7de4b3ea44d8874a0c90dff1f4d31dc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a3237c7cc7de4b3ea44d8874a0c90dff1f4d31dc"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 28,
    "deletions": 2
  },
  "files": [
    {
      "sha": "41fe042d184f68cdce39e841315b52bc1b8c3748",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=1845e254645efbc02248345ccdb557d265dd8ae1",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-07  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* cli/cli-cmds.c: Add 'gdbsupport/gdb_tilde_expand.h'\n+\tinclude.\n+\t(source_script_with_search): Perform tilde expansion.\n+\n 2021-05-07  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* target-descriptions.c (struct target_desc_info) <filename>:"
    },
    {
      "sha": "62948f5fc7bef7cb131c456806d00d2970c94539",
      "filename": "gdb/cli/cli-cmds.c",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/cli/cli-cmds.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/cli/cli-cmds.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-cmds.c?ref=1845e254645efbc02248345ccdb557d265dd8ae1",
      "patch": "@@ -54,6 +54,7 @@\n \n #include \"extension.h\"\n #include \"gdbsupport/pathstuff.h\"\n+#include \"gdbsupport/gdb_tilde_expand.h\"\n \n #ifdef TUI\n #include \"tui/tui.h\"\t/* For tui_active et.al.  */\n@@ -737,8 +738,16 @@ source_script_with_search (const char *file, int from_tty, int search_path)\n      anyway so that error messages show the actual file used.  But only do\n      this if we (may have) used search_path, as printing the full path in\n      errors for the non-search case can be more noise than signal.  */\n-  source_script_from_stream (opened->stream.get (), file,\n-\t\t\t     search_path ? opened->full_path.get () : file);\n+  const char *file_to_open;\n+  gdb::unique_xmalloc_ptr<char> tilde_expanded_file;\n+  if (search_path)\n+    file_to_open = opened->full_path.get ();\n+  else\n+    {\n+      tilde_expanded_file = gdb_tilde_expand_up (file);\n+      file_to_open = tilde_expanded_file.get ();\n+    }\n+  source_script_from_stream (opened->stream.get (), file, file_to_open);\n }\n \n /* Wrapper around source_script_with_search to export it to main.c"
    },
    {
      "sha": "afdd887c72b4867c9e618e139587472eb76b9881",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=1845e254645efbc02248345ccdb557d265dd8ae1",
      "patch": "@@ -1,3 +1,7 @@\n+2021-05-07  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.guile/guile.exp: Add an extra test.\n+\n 2021-05-07  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.base/ptype-offsets.exp: Replace use of send_gdb with"
    },
    {
      "sha": "0fb82284f465b5b0b6d0f02a2aa74a98e7615e28",
      "filename": "gdb/testsuite/gdb.guile/guile.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/testsuite/gdb.guile/guile.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1845e254645efbc02248345ccdb557d265dd8ae1/gdb/testsuite/gdb.guile/guile.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.guile/guile.exp?ref=1845e254645efbc02248345ccdb557d265dd8ae1",
      "patch": "@@ -82,3 +82,10 @@ gdb_test_no_output \"guile (define a (execute \\\"help\\\" #:to-string #t))\" \\\n \n gdb_test \"guile (print a)\" \"= .*aliases -- User-defined aliases of other commands.*\" \\\n     \"verify help to uiout\"\n+\n+# Verify that we can source a guile script using ~ for the HOME directory.\n+save_vars { env(HOME) } {\n+    set env(HOME) $srcdir/$subdir\n+    clean_restart\n+    gdb_test \"source ~/source2.scm\" \"yes\"\n+}"
    }
  ]
}