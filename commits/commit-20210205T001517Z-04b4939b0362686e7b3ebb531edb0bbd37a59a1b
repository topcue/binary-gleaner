{
  "sha": "04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDRiNDkzOWIwMzYyNjg2ZTdiM2ViYjUzMWVkYjBiYmQzN2E1OWExYg==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2015-06-16T15:44:48Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-02-05T00:15:17Z"
    },
    "message": "gdb: riscv: enable sim integration\n\nNow the simulator can be loaded via gdb using \"target sim\".",
    "tree": {
      "sha": "dc22e1672494f5271721ef6df42c41b4dae3afc8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/dc22e1672494f5271721ef6df42c41b4dae3afc8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b9249c461c72b35dd9b6f274406c336f6a68ae98",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b9249c461c72b35dd9b6f274406c336f6a68ae98",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b9249c461c72b35dd9b6f274406c336f6a68ae98"
    }
  ],
  "stats": {
    "total": 184,
    "additions": 184,
    "deletions": 0
  },
  "files": [
    {
      "sha": "d729b0e28d57befdf87719de0f71b3b4152ded2f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
      "patch": "@@ -1,3 +1,7 @@\n+2021-02-04  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* configure.tgt (riscv*-*-*): Set gdb_sim.\n+\n 2021-02-04  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* target.c (target_is_non_stop_p): Return bool."
    },
    {
      "sha": "5440780065f0284a777e401aeb93cb6b1250cc1b",
      "filename": "gdb/configure.tgt",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/gdb/configure.tgt",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/gdb/configure.tgt",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure.tgt?ref=04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
      "patch": "@@ -554,6 +554,7 @@ riscv*-*-linux*)\n riscv*-*-*)\n \t# Target: RISC-V architecture\n \tgdb_target_obs=\"\"\n+\tgdb_sim=../sim/riscv/libsim.a\n \t;;\n \n rl78-*-elf)"
    },
    {
      "sha": "32a0928a78619e21ecdc7c8b168bfa21f14a7de6",
      "filename": "include/gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/include/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/include/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/gdb/ChangeLog?ref=04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
      "patch": "@@ -1,3 +1,7 @@\n+2021-02-04  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* sim-riscv.h: New file.\n+\n 2021-01-07  Mike Frysinger  <vapier@gentoo.org>\n \n \t* remote-sim.h (sim_memory_map): Define."
    },
    {
      "sha": "23e5f766aa6c8c693f2f4388af0965b391750066",
      "filename": "include/gdb/sim-riscv.h",
      "status": "added",
      "additions": 99,
      "deletions": 0,
      "changes": 99,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/include/gdb/sim-riscv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/include/gdb/sim-riscv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/gdb/sim-riscv.h?ref=04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
      "patch": "@@ -0,0 +1,99 @@\n+/* This file defines the interface between the RISC-V simulator and GDB.\n+\n+   Copyright (C) 2005-2021 Free Software Foundation, Inc.\n+   Contributed by Mike Frysinger.\n+\n+   This file is part of GDB.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+/* Order has to match gdb riscv-tdep list.  */\n+enum sim_riscv_regnum {\n+  SIM_RISCV_ZERO_REGNUM = 0,\n+  SIM_RISCV_RA_REGNUM,\n+  SIM_RISCV_SP_REGNUM,\n+  SIM_RISCV_GP_REGNUM,\n+  SIM_RISCV_TP_REGNUM,\n+  SIM_RISCV_T0_REGNUM,\n+  SIM_RISCV_T1_REGNUM,\n+  SIM_RISCV_T2_REGNUM,\n+  SIM_RISCV_S0_REGNUM,\n+#define SIM_RISCV_FP_REGNUM SIM_RISCV_S0_REGNUM\n+  SIM_RISCV_S1_REGNUM,\n+  SIM_RISCV_A0_REGNUM,\n+  SIM_RISCV_A1_REGNUM,\n+  SIM_RISCV_A2_REGNUM,\n+  SIM_RISCV_A3_REGNUM,\n+  SIM_RISCV_A4_REGNUM,\n+  SIM_RISCV_A5_REGNUM,\n+  SIM_RISCV_A6_REGNUM,\n+  SIM_RISCV_A7_REGNUM,\n+  SIM_RISCV_S2_REGNUM,\n+  SIM_RISCV_S3_REGNUM,\n+  SIM_RISCV_S4_REGNUM,\n+  SIM_RISCV_S5_REGNUM,\n+  SIM_RISCV_S6_REGNUM,\n+  SIM_RISCV_S7_REGNUM,\n+  SIM_RISCV_S8_REGNUM,\n+  SIM_RISCV_S9_REGNUM,\n+  SIM_RISCV_S10_REGNUM,\n+  SIM_RISCV_S11_REGNUM,\n+  SIM_RISCV_T3_REGNUM,\n+  SIM_RISCV_T4_REGNUM,\n+  SIM_RISCV_T5_REGNUM,\n+  SIM_RISCV_T6_REGNUM,\n+  SIM_RISCV_PC_REGNUM,\n+  SIM_RISCV_FT0_REGNUM,\n+#define SIM_RISCV_FIRST_FP_REGNUM SIM_RISCV_FT0_REGNUM\n+  SIM_RISCV_FT1_REGNUM,\n+  SIM_RISCV_FT2_REGNUM,\n+  SIM_RISCV_FT3_REGNUM,\n+  SIM_RISCV_FT4_REGNUM,\n+  SIM_RISCV_FT5_REGNUM,\n+  SIM_RISCV_FT6_REGNUM,\n+  SIM_RISCV_FT7_REGNUM,\n+  SIM_RISCV_FS0_REGNUM,\n+  SIM_RISCV_FS1_REGNUM,\n+  SIM_RISCV_FA0_REGNUM,\n+  SIM_RISCV_FA1_REGNUM,\n+  SIM_RISCV_FA2_REGNUM,\n+  SIM_RISCV_FA3_REGNUM,\n+  SIM_RISCV_FA4_REGNUM,\n+  SIM_RISCV_FA5_REGNUM,\n+  SIM_RISCV_FA6_REGNUM,\n+  SIM_RISCV_FA7_REGNUM,\n+  SIM_RISCV_FS2_REGNUM,\n+  SIM_RISCV_FS3_REGNUM,\n+  SIM_RISCV_FS4_REGNUM,\n+  SIM_RISCV_FS5_REGNUM,\n+  SIM_RISCV_FS6_REGNUM,\n+  SIM_RISCV_FS7_REGNUM,\n+  SIM_RISCV_FS8_REGNUM,\n+  SIM_RISCV_FS9_REGNUM,\n+  SIM_RISCV_FS10_REGNUM,\n+  SIM_RISCV_FS11_REGNUM,\n+  SIM_RISCV_FT8_REGNUM,\n+  SIM_RISCV_FT9_REGNUM,\n+  SIM_RISCV_FT10_REGNUM,\n+  SIM_RISCV_FT11_REGNUM,\n+#define SIM_RISCV_LAST_FP_REGNUM SIM_RISCV_FT11_REGNUM\n+\n+#define SIM_RISCV_FIRST_CSR_REGNUM SIM_RISCV_LAST_FP_REGNUM + 1\n+#define DECLARE_CSR(name, num, ...) SIM_RISCV_ ## num ## _REGNUM,\n+#include \"opcode/riscv-opc.h\"\n+#undef DECLARE_CSR\n+#define SIM_RISCV_LAST_CSR_REGNUM SIM_RISCV_LAST_REGNUM - 1\n+\n+  SIM_RISCV_LAST_REGNUM\n+};"
    },
    {
      "sha": "9eaffee34421ad0d1efb664dc8fa6f216ac485c2",
      "filename": "sim/riscv/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/sim/riscv/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/sim/riscv/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/riscv/ChangeLog?ref=04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
      "patch": "@@ -1,3 +1,9 @@\n+2021-02-04  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* sim-main.c: Include gdb/sim-riscv.h.\n+\t(reg_fetch, reg_store): Define.\n+\t(initialize_cpu): Assign reg_fetch & reg_store.\n+\n 2021-02-04  Mike Frysinger  <vapier@gentoo.org>\n \n \t* Makefile.in, configure.ac, interp.c, machs.c, machs.h,"
    },
    {
      "sha": "8185bfc18f0f72aba0babb95b5cdba44f2486920",
      "filename": "sim/riscv/sim-main.c",
      "status": "modified",
      "additions": 70,
      "deletions": 0,
      "changes": 70,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/sim/riscv/sim-main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/04b4939b0362686e7b3ebb531edb0bbd37a59a1b/sim/riscv/sim-main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/riscv/sim-main.c?ref=04b4939b0362686e7b3ebb531edb0bbd37a59a1b",
      "patch": "@@ -31,6 +31,8 @@\n \n #include \"opcode/riscv.h\"\n \n+#include \"gdb/sim-riscv.h\"\n+\n #include \"targ-vals.h\"\n \f\n #define TRACE_REG(cpu, reg) \\\n@@ -1019,6 +1021,72 @@ pc_set (sim_cpu *cpu, sim_cia pc)\n   cpu->pc = pc;\n }\n \n+static int\n+reg_fetch (sim_cpu *cpu, int rn, unsigned char *buf, int len)\n+{\n+  if (len <= 0 || len > sizeof (unsigned_word))\n+    return -1;\n+\n+  switch (rn)\n+    {\n+    case SIM_RISCV_ZERO_REGNUM:\n+      memset (buf, 0, len);\n+      return len;\n+    case SIM_RISCV_RA_REGNUM ... SIM_RISCV_T6_REGNUM:\n+      memcpy (buf, &cpu->regs[rn], len);\n+      return len;\n+    case SIM_RISCV_FIRST_FP_REGNUM ... SIM_RISCV_LAST_FP_REGNUM:\n+      memcpy (buf, &cpu->fpregs[rn - SIM_RISCV_FIRST_FP_REGNUM], len);\n+      return len;\n+    case SIM_RISCV_PC_REGNUM:\n+      memcpy (buf, &cpu->pc, len);\n+      return len;\n+\n+#define DECLARE_CSR(name, num, ...) \\\n+    case SIM_RISCV_ ## num ## _REGNUM: \\\n+      memcpy (buf, &cpu->csr.name, len); \\\n+      return len;\n+#include \"opcode/riscv-opc.h\"\n+#undef DECLARE_CSR\n+\n+    default:\n+      return -1;\n+    }\n+}\n+\n+static int\n+reg_store (sim_cpu *cpu, int rn, unsigned char *buf, int len)\n+{\n+  if (len <= 0 || len > sizeof (unsigned_word))\n+    return -1;\n+\n+  switch (rn)\n+    {\n+    case SIM_RISCV_ZERO_REGNUM:\n+      /* Ignore writes.  */\n+      return len;\n+    case SIM_RISCV_RA_REGNUM ... SIM_RISCV_T6_REGNUM:\n+      memcpy (&cpu->regs[rn], buf, len);\n+      return len;\n+    case SIM_RISCV_FIRST_FP_REGNUM ... SIM_RISCV_LAST_FP_REGNUM:\n+      memcpy (&cpu->fpregs[rn - SIM_RISCV_FIRST_FP_REGNUM], buf, len);\n+      return len;\n+    case SIM_RISCV_PC_REGNUM:\n+      memcpy (&cpu->pc, buf, len);\n+      return len;\n+\n+#define DECLARE_CSR(name, num, ...) \\\n+    case SIM_RISCV_ ## num ## _REGNUM: \\\n+      memcpy (&cpu->csr.name, buf, len); \\\n+      return len;\n+#include \"opcode/riscv-opc.h\"\n+#undef DECLARE_CSR\n+\n+    default:\n+      return -1;\n+    }\n+}\n+\n /* Initialize the state for a single cpu.  Usuaully this involves clearing all\n    registers back to their reset state.  Should also hook up the fetch/store\n    helper functions too.  */\n@@ -1032,6 +1100,8 @@ initialize_cpu (SIM_DESC sd, SIM_CPU *cpu, int mhartid)\n \n   CPU_PC_FETCH (cpu) = pc_get;\n   CPU_PC_STORE (cpu) = pc_set;\n+  CPU_REG_FETCH (cpu) = reg_fetch;\n+  CPU_REG_STORE (cpu) = reg_store;\n \n   if (!riscv_hash[0])\n     {"
    }
  ]
}