{
  "sha": "2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
  "node_id": "C_kwDOANOeidoAKDJmZWQ5ZGI0MGIxMTc5ZjYyYzZmYjBmMmNhY2ZiMGRiNmI1MGFmNDY",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-07-22T19:33:42Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-09-30T19:21:48Z"
    },
    "message": "gdbsupport: make gdb_mkostemp_cloexec return a scoped_fd\n\nThis encourages the callers to use automatic file descriptor management.\n\nChange-Id: I137a81df6f3607b457e28c35aafde8ed6f3a3344",
    "tree": {
      "sha": "d47c517c106ec8bc88b6733d2b26f54f50dfec7c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d47c517c106ec8bc88b6733d2b26f54f50dfec7c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "13084383e8955c2ff7017ac8839301688a9ee34d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/13084383e8955c2ff7017ac8839301688a9ee34d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/13084383e8955c2ff7017ac8839301688a9ee34d"
    }
  ],
  "stats": {
    "total": 25,
    "additions": 13,
    "deletions": 12
  },
  "files": [
    {
      "sha": "141eede11fe250a63806533070fed7b7366574fc",
      "filename": "gdb/darwin-nat.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/darwin-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/darwin-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/darwin-nat.c?ref=2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
      "patch": "@@ -1833,7 +1833,7 @@ copy_shell_to_cache (const char *shell, const std::string &new_name)\n \t   new_dir.c_str (), safe_strerror (errno));\n \n   gdb::char_vector temp_name = make_temp_filename (new_name);\n-  scoped_fd to_fd (gdb_mkostemp_cloexec (&temp_name[0]));\n+  scoped_fd to_fd = gdb_mkostemp_cloexec (&temp_name[0]);\n   gdb::unlinker unlink_file_on_error (temp_name.data ());\n \n   if (to_fd.get () < 0)"
    },
    {
      "sha": "e92def7590bfab75c9087dba636eb9afe5e06b8a",
      "filename": "gdb/dwarf2/index-write.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/dwarf2/index-write.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/dwarf2/index-write.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/index-write.c?ref=2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
      "patch": "@@ -1538,8 +1538,8 @@ struct index_wip_file\n \n     filename_temp = make_temp_filename (filename);\n \n-    scoped_fd out_file_fd (gdb_mkostemp_cloexec (filename_temp.data (),\n-\t\t\t\t\t\t O_BINARY));\n+    scoped_fd out_file_fd = gdb_mkostemp_cloexec (filename_temp.data (),\n+\t\t\t\t\t\t  O_BINARY);\n     if (out_file_fd.get () == -1)\n       perror_with_name ((\"mkstemp\"));\n "
    },
    {
      "sha": "ff8d093794f51fdc389c59ca514d6277ae8f291c",
      "filename": "gdb/unittests/scoped_fd-selftests.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/unittests/scoped_fd-selftests.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/unittests/scoped_fd-selftests.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/unittests/scoped_fd-selftests.c?ref=2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
      "patch": "@@ -32,7 +32,7 @@ static void\n test_destroy ()\n {\n   char filename[] = \"scoped_fd-selftest-XXXXXX\";\n-  int fd = gdb_mkostemp_cloexec (filename);\n+  int fd = gdb_mkostemp_cloexec (filename).release ();\n   SELF_CHECK (fd >= 0);\n \n   unlink (filename);\n@@ -51,7 +51,7 @@ static void\n test_release ()\n {\n   char filename[] = \"scoped_fd-selftest-XXXXXX\";\n-  int fd = gdb_mkostemp_cloexec (filename);\n+  int fd = gdb_mkostemp_cloexec (filename).release ();\n   SELF_CHECK (fd >= 0);\n \n   unlink (filename);\n@@ -71,7 +71,7 @@ test_to_file ()\n {\n   char filename[] = \"scoped_fd-selftest-XXXXXX\";\n \n-  ::scoped_fd sfd (gdb_mkostemp_cloexec (filename));\n+  ::scoped_fd sfd = gdb_mkostemp_cloexec (filename);\n   SELF_CHECK (sfd.get () >= 0);\n \n   unlink (filename);"
    },
    {
      "sha": "76d6c417ad05599d7591b986027a6957638578e5",
      "filename": "gdb/unittests/scoped_mmap-selftests.c",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/unittests/scoped_mmap-selftests.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdb/unittests/scoped_mmap-selftests.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/unittests/scoped_mmap-selftests.c?ref=2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
      "patch": "@@ -89,11 +89,12 @@ static void\n test_normal ()\n {\n   char filename[] = \"scoped_mmapped_file-selftest-XXXXXX\";\n-  int fd = gdb_mkostemp_cloexec (filename);\n-  SELF_CHECK (fd >= 0);\n+  {\n+    scoped_fd fd = gdb_mkostemp_cloexec (filename);\n+    SELF_CHECK (fd.get () >= 0);\n \n-  SELF_CHECK (write (fd, \"Hello!\", 7) == 7);\n-  close (fd);\n+    SELF_CHECK (write (fd.get (), \"Hello!\", 7) == 7);\n+  }\n \n   gdb::unlinker unlink_test_file (filename);\n "
    },
    {
      "sha": "10e9eba15059d72826b4b7205076bd0502d37a33",
      "filename": "gdbsupport/filestuff.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdbsupport/filestuff.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2fed9db40b1179f62c6fb0f2cacfb0db6b50af46/gdbsupport/filestuff.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/filestuff.h?ref=2fed9db40b1179f62c6fb0f2cacfb0db6b50af46",
      "patch": "@@ -54,11 +54,11 @@ extern scoped_fd gdb_open_cloexec (const char *filename, int flags,\n /* Like mkstemp, but ensures that the file descriptor is\n    close-on-exec.  */\n \n-static inline int\n+static inline scoped_fd\n gdb_mkostemp_cloexec (char *name_template, int flags = 0)\n {\n   /* gnulib provides a mkostemp replacement if needed.  */\n-  return mkostemp (name_template, flags | O_CLOEXEC);\n+  return scoped_fd (mkostemp (name_template, flags | O_CLOEXEC));\n }\n \n /* Convenience wrapper for the above, which takes the filename as an"
    }
  ]
}