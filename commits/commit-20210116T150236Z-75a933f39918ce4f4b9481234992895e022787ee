{
  "sha": "75a933f39918ce4f4b9481234992895e022787ee",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzVhOTMzZjM5OTE4Y2U0ZjRiOTQ4MTIzNDk5Mjg5NWUwMjI3ODdlZQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-01-16T15:00:09Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-01-16T15:02:36Z"
    },
    "message": "ld/elf/x86: Don't compare IFUNC address in the shared object\n\nOn x86, glibc 2.33 starts to issue a fatal error message when calling\nIFUNC function defined in the unrelocated executable from a shared\nlibrary.\n\n1. Update x86 ELF linker to always convert IFUNC function defined in\nposition-dependent executable (PDE) to the normal function.  GOT in PDE\nwill be updated by R_*_IRELATIVE at run-time.\n2. Update PR ld/23169 tests not to compare function address of external\nIFUNC function in the shared object to avoid calling the IFUNC function\ndefined in the unrelocated executable.\n3. Remove pr23169e tests which call the IFUNC function defined in the\nunrelocated position-independent executable from a shared library.\n\nbfd/\n\n\tPR ld/23169\n\t* elfxx-x86.c (_bfd_x86_elf_link_fixup_ifunc_symbol): Don't\n\tcheck pointer_equality_needed.\n\nld/\n\n\tPR ld/23169\n\t* testsuite/ld-ifunc/ifunc.exp: Replace pr23169c.rd with\n\tpr23169a.rd for pr23169c and pr23169f.  Remove pr23169e tests.\n\t* testsuite/ld-ifunc/pr23169a.c (foo): Don't compare function\n\taddress.",
    "tree": {
      "sha": "fc7399127a449f992c5b4e5009ab9aec0faa7c30",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fc7399127a449f992c5b4e5009ab9aec0faa7c30"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/75a933f39918ce4f4b9481234992895e022787ee",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/75a933f39918ce4f4b9481234992895e022787ee",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/75a933f39918ce4f4b9481234992895e022787ee",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/75a933f39918ce4f4b9481234992895e022787ee/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "68b007788a6cc5376708af42bc220f540e8c4b8a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/68b007788a6cc5376708af42bc220f540e8c4b8a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/68b007788a6cc5376708af42bc220f540e8c4b8a"
    }
  ],
  "stats": {
    "total": 41,
    "additions": 18,
    "deletions": 23
  },
  "files": [
    {
      "sha": "dbb240ad612933016f50c612bd048b7c92c0f9ad",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/75a933f39918ce4f4b9481234992895e022787ee/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/75a933f39918ce4f4b9481234992895e022787ee/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=75a933f39918ce4f4b9481234992895e022787ee",
      "patch": "@@ -1,3 +1,9 @@\n+2021-01-16  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/23169\n+\t* elfxx-x86.c (_bfd_x86_elf_link_fixup_ifunc_symbol): Don't\n+\tcheck pointer_equality_needed.\n+\n 2021-01-15  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* elf-linker-x86.h (elf_linker_x86_params): Add"
    },
    {
      "sha": "93ad38c5eb0a9f212b11efcf05d5aee171587be0",
      "filename": "bfd/elfxx-x86.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/75a933f39918ce4f4b9481234992895e022787ee/bfd/elfxx-x86.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/75a933f39918ce4f4b9481234992895e022787ee/bfd/elfxx-x86.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-x86.c?ref=75a933f39918ce4f4b9481234992895e022787ee",
      "patch": "@@ -1711,8 +1711,7 @@ _bfd_x86_elf_link_fixup_ifunc_symbol (struct bfd_link_info *info,\n       && h->def_regular\n       && h->dynindx != -1\n       && h->plt.offset != (bfd_vma) -1\n-      && h->type == STT_GNU_IFUNC\n-      && h->pointer_equality_needed)\n+      && h->type == STT_GNU_IFUNC)\n     {\n       asection *plt_s;\n       bfd_vma plt_offset;"
    },
    {
      "sha": "8a20eba94a23bbffaac719b6546603d4cfcbd768",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/75a933f39918ce4f4b9481234992895e022787ee/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/75a933f39918ce4f4b9481234992895e022787ee/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=75a933f39918ce4f4b9481234992895e022787ee",
      "patch": "@@ -1,3 +1,11 @@\n+2021-01-16  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/23169\n+\t* testsuite/ld-ifunc/ifunc.exp: Replace pr23169c.rd with\n+\tpr23169a.rd for pr23169c and pr23169f.  Remove pr23169e tests.\n+\t* testsuite/ld-ifunc/pr23169a.c (foo): Don't compare function\n+\taddress.\n+\n 2021-01-15  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* NEWS: Mention -z report-relative-reloc."
    },
    {
      "sha": "9d3ace6521639383393ad647ad6c63276a806d9e",
      "filename": "ld/testsuite/ld-ifunc/ifunc.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 20,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/75a933f39918ce4f4b9481234992895e022787ee/ld/testsuite/ld-ifunc/ifunc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/75a933f39918ce4f4b9481234992895e022787ee/ld/testsuite/ld-ifunc/ifunc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-ifunc/ifunc.exp?ref=75a933f39918ce4f4b9481234992895e022787ee",
      "patch": "@@ -640,7 +640,7 @@ run_cc_link_tests [list \\\n \t\"$NOPIE_LDFLAGS -Wl,--no-as-needed tmpdir/libpr23169a.so\" \\\n \t\"-fPIE -O2 -g\" \\\n \t{ pr23169b.c pr23169c.c } \\\n-\t{{readelf {--dyn-syms} pr23169c.rd} \\\n+\t{{readelf {--dyn-syms} pr23169a.rd} \\\n \t {readelf {-r -W} pr23169b.rd}} \\\n \t\"pr23169c\" \\\n     ] \\\n@@ -653,21 +653,12 @@ run_cc_link_tests [list \\\n \t {readelf {-r -W} pr23169b.rd}} \\\n \t\"pr23169d\" \\\n     ] \\\n-    [list \\\n-\t\"Build pr23169e\" \\\n-\t\"-pie -Wl,--no-as-needed,-z,now tmpdir/libpr23169b.so\" \\\n-\t\"-fPIE -O2 -g\" \\\n-\t{ pr23169b.c pr23169c.c } \\\n-\t{{readelf {--dyn-syms} pr23169c.rd} \\\n-\t {readelf {-r -W} pr23169b.rd}} \\\n-\t\"pr23169e\" \\\n-    ] \\\n     [list \\\n \t\"Build pr23169f\" \\\n \t\"$NOPIE_LDFLAGS -Wl,--no-as-needed,-z,now tmpdir/libpr23169b.so\" \\\n \t\"-fPIE -O2 -g\" \\\n \t{ pr23169b.c pr23169c.c } \\\n-\t{{readelf {--dyn-syms} pr23169c.rd} \\\n+\t{{readelf {--dyn-syms} pr23169a.rd} \\\n \t {readelf {-r -W} pr23169b.rd}} \\\n \t\"pr23169f\" \\\n     ] \\\n@@ -774,15 +765,6 @@ run_ld_link_exec_tests [list \\\n \t\"pass.out\" \\\n \t\"$NOPIE_CFLAGS -O2 -g\" \\\n     ] \\\n-    [list \\\n-\t\"Run pr23169e\" \\\n-\t\"-pie -Wl,--no-as-needed,-z,now tmpdir/libpr23169b.so\" \\\n-\t\"\" \\\n-\t{ pr23169b.c pr23169c.c } \\\n-\t\"pr23169e\" \\\n-\t\"pass.out\" \\\n-\t\"-fPIE -O2 -g\" \\\n-    ] \\\n     [list \\\n \t\"Run pr23169f\" \\\n \t\"$NOPIE_LDFLAGS -Wl,--no-as-needed,-z,now tmpdir/libpr23169b.so\" \\"
    },
    {
      "sha": "8beed283bc88d38a19cf6f9ed2ab8f73eb970600",
      "filename": "ld/testsuite/ld-ifunc/pr23169a.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/75a933f39918ce4f4b9481234992895e022787ee/ld/testsuite/ld-ifunc/pr23169a.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/75a933f39918ce4f4b9481234992895e022787ee/ld/testsuite/ld-ifunc/pr23169a.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-ifunc/pr23169a.c?ref=75a933f39918ce4f4b9481234992895e022787ee",
      "patch": "@@ -4,6 +4,6 @@ extern int func (void);\n void\n foo (void)\n {\n-  if (func_p != &func || func_p () != 0xbadbeef)\n+  if (func () != 0xbadbeef || func_p () != 0xbadbeef)\n     __builtin_abort ();\n }"
    }
  ]
}