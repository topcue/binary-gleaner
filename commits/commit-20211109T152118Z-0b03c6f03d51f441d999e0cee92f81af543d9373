{
  "sha": "0b03c6f03d51f441d999e0cee92f81af543d9373",
  "node_id": "C_kwDOANOeidoAKDBiMDNjNmYwM2Q1MWY0NDFkOTk5ZTBjZWU5MmY4MWFmNTQzZDkzNzM",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-05-12T18:39:22Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-11-09T15:21:18Z"
    },
    "message": "Fix build on rhES5\n\nThe rhES5 build failed due to an upstream import a while back.  The\nbug here is that, while the 'personality' function exists,\nADDR_NO_RANDOMIZE is only defined in <linux/personality.h>, not\n<sys/personality.h>.\n\nHowever, <linux/personality.h> does not declare the 'personality'\nfunction, and <sys/personality.h> and <linux/personality.h> cannot\nboth be included.\n\nThis patch restores one of the removed configure checks and updates\nthe code to check it.\n\nWe had this as a local patch at AdaCore, because it seemed like there\nwas no interest upstream.  However, now it turns out that this fixes\nPR build/28555, so I'm sending it now.",
    "tree": {
      "sha": "f23e058934e5ab2f3da8a79c47ce66bd65c3aea2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f23e058934e5ab2f3da8a79c47ce66bd65c3aea2"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0b03c6f03d51f441d999e0cee92f81af543d9373",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0b03c6f03d51f441d999e0cee92f81af543d9373",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0b03c6f03d51f441d999e0cee92f81af543d9373",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0b03c6f03d51f441d999e0cee92f81af543d9373/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "469ca94170aa4f14cc3b3dc9e7d8c02bb17f8c91",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/469ca94170aa4f14cc3b3dc9e7d8c02bb17f8c91",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/469ca94170aa4f14cc3b3dc9e7d8c02bb17f8c91"
    }
  ],
  "stats": {
    "total": 69,
    "additions": 69,
    "deletions": 0
  },
  "files": [
    {
      "sha": "773a0ba91efdb7cf0f9556b6907b4bb61853db05",
      "filename": "gdb/config.in",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdb/config.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdb/config.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/config.in?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -96,6 +96,10 @@\n /* define if the compiler supports basic C++11 syntax */\n #undef HAVE_CXX11\n \n+/* Define to 1 if you have the declaration of `ADDR_NO_RANDOMIZE', and to 0 if\n+   you don't. */\n+#undef HAVE_DECL_ADDR_NO_RANDOMIZE\n+\n /* Define to 1 if you have the declaration of `asprintf', and to 0 if you\n    don't. */\n #undef HAVE_DECL_ASPRINTF"
    },
    {
      "sha": "6e2dfb766c86bba816c217ba580ab3df5d1cf293",
      "filename": "gdb/configure",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdb/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdb/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -13863,6 +13863,22 @@ fi\n done\n \n \n+  # This is needed for RHEL 5 and uclibc-ng < 1.0.39.\n+  # These did not define ADDR_NO_RANDOMIZE in sys/personality.h,\n+  # only in linux/personality.h.\n+  ac_fn_c_check_decl \"$LINENO\" \"ADDR_NO_RANDOMIZE\" \"ac_cv_have_decl_ADDR_NO_RANDOMIZE\" \"#include <sys/personality.h>\n+\"\n+if test \"x$ac_cv_have_decl_ADDR_NO_RANDOMIZE\" = xyes; then :\n+  ac_have_decl=1\n+else\n+  ac_have_decl=0\n+fi\n+\n+cat >>confdefs.h <<_ACEOF\n+#define HAVE_DECL_ADDR_NO_RANDOMIZE $ac_have_decl\n+_ACEOF\n+\n+\n   ac_fn_c_check_decl \"$LINENO\" \"strstr\" \"ac_cv_have_decl_strstr\" \"$ac_includes_default\"\n if test \"x$ac_cv_have_decl_strstr\" = xyes; then :\n   ac_have_decl=1"
    },
    {
      "sha": "27999fd19df6a67c27c4736ff95136db86d54266",
      "filename": "gdb/nat/linux-personality.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdb/nat/linux-personality.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdb/nat/linux-personality.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/linux-personality.c?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -22,6 +22,10 @@\n \n #include <sys/personality.h>\n \n+# if !HAVE_DECL_ADDR_NO_RANDOMIZE\n+#  define ADDR_NO_RANDOMIZE 0x0040000\n+# endif /* ! HAVE_DECL_ADDR_NO_RANDOMIZE */\n+\n /* See comment on nat/linux-personality.h.  */\n \n maybe_disable_address_space_randomization::"
    },
    {
      "sha": "39ddc7c0edb82fbaca32d1f7a2afedcc46b1a4a0",
      "filename": "gdbserver/config.in",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbserver/config.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbserver/config.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/config.in?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -31,6 +31,10 @@\n /* define if the compiler supports basic C++11 syntax */\n #undef HAVE_CXX11\n \n+/* Define to 1 if you have the declaration of `ADDR_NO_RANDOMIZE', and to 0 if\n+   you don't. */\n+#undef HAVE_DECL_ADDR_NO_RANDOMIZE\n+\n /* Define to 1 if you have the declaration of `asprintf', and to 0 if you\n    don't. */\n #undef HAVE_DECL_ASPRINTF"
    },
    {
      "sha": "8e2bd4e1ba5a29b24fab52931f39af51c3abe51e",
      "filename": "gdbserver/configure",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbserver/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbserver/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/configure?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -7139,6 +7139,22 @@ fi\n done\n \n \n+  # This is needed for RHEL 5 and uclibc-ng < 1.0.39.\n+  # These did not define ADDR_NO_RANDOMIZE in sys/personality.h,\n+  # only in linux/personality.h.\n+  ac_fn_c_check_decl \"$LINENO\" \"ADDR_NO_RANDOMIZE\" \"ac_cv_have_decl_ADDR_NO_RANDOMIZE\" \"#include <sys/personality.h>\n+\"\n+if test \"x$ac_cv_have_decl_ADDR_NO_RANDOMIZE\" = xyes; then :\n+  ac_have_decl=1\n+else\n+  ac_have_decl=0\n+fi\n+\n+cat >>confdefs.h <<_ACEOF\n+#define HAVE_DECL_ADDR_NO_RANDOMIZE $ac_have_decl\n+_ACEOF\n+\n+\n   ac_fn_c_check_decl \"$LINENO\" \"strstr\" \"ac_cv_have_decl_strstr\" \"$ac_includes_default\"\n if test \"x$ac_cv_have_decl_strstr\" = xyes; then :\n   ac_have_decl=1"
    },
    {
      "sha": "81e7c75f51dcba13ef74e81b79ef1da0281e8ca5",
      "filename": "gdbsupport/common.m4",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbsupport/common.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbsupport/common.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/common.m4?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -55,6 +55,11 @@ AC_DEFUN([GDB_AC_COMMON], [\n \t\t  ptrace64 sbrk setns sigaltstack sigprocmask \\\n \t\t  setpgid setpgrp getrusage getauxval sigtimedwait])\n \n+  # This is needed for RHEL 5 and uclibc-ng < 1.0.39.\n+  # These did not define ADDR_NO_RANDOMIZE in sys/personality.h,\n+  # only in linux/personality.h.\n+  AC_CHECK_DECLS([ADDR_NO_RANDOMIZE],,, [#include <sys/personality.h>])\n+\n   AC_CHECK_DECLS([strstr])\n \n   # ----------------------- #"
    },
    {
      "sha": "a7ae23b498495d0857fa44f8f737962578dec012",
      "filename": "gdbsupport/config.in",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbsupport/config.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbsupport/config.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/config.in?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -28,6 +28,10 @@\n /* define if the compiler supports basic C++11 syntax */\n #undef HAVE_CXX11\n \n+/* Define to 1 if you have the declaration of `ADDR_NO_RANDOMIZE', and to 0 if\n+   you don't. */\n+#undef HAVE_DECL_ADDR_NO_RANDOMIZE\n+\n /* Define to 1 if you have the declaration of `asprintf', and to 0 if you\n    don't. */\n #undef HAVE_DECL_ASPRINTF"
    },
    {
      "sha": "0b4e81a9c16eaefc79b4f2431c163780563ff46e",
      "filename": "gdbsupport/configure",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbsupport/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0b03c6f03d51f441d999e0cee92f81af543d9373/gdbsupport/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/configure?ref=0b03c6f03d51f441d999e0cee92f81af543d9373",
      "patch": "@@ -8152,6 +8152,22 @@ fi\n done\n \n \n+  # This is needed for RHEL 5 and uclibc-ng < 1.0.39.\n+  # These did not define ADDR_NO_RANDOMIZE in sys/personality.h,\n+  # only in linux/personality.h.\n+  ac_fn_c_check_decl \"$LINENO\" \"ADDR_NO_RANDOMIZE\" \"ac_cv_have_decl_ADDR_NO_RANDOMIZE\" \"#include <sys/personality.h>\n+\"\n+if test \"x$ac_cv_have_decl_ADDR_NO_RANDOMIZE\" = xyes; then :\n+  ac_have_decl=1\n+else\n+  ac_have_decl=0\n+fi\n+\n+cat >>confdefs.h <<_ACEOF\n+#define HAVE_DECL_ADDR_NO_RANDOMIZE $ac_have_decl\n+_ACEOF\n+\n+\n   ac_fn_c_check_decl \"$LINENO\" \"strstr\" \"ac_cv_have_decl_strstr\" \"$ac_includes_default\"\n if test \"x$ac_cv_have_decl_strstr\" = xyes; then :\n   ac_have_decl=1"
    }
  ]
}