{
  "sha": "36664835fa3f81503633024e0e834be4d84276e1",
  "node_id": "C_kwDOANOeidoAKDM2NjY0ODM1ZmEzZjgxNTAzNjMzMDI0ZTBlODM0YmU0ZDg0Mjc2ZTE",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-11-20T02:14:36Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2022-02-06T20:48:18Z"
    },
    "message": "gdb: add compunit_symtab::set_primary_filetab method\n\nAdd a method to set the primary filetab of the CU.  This is currently\ndone in buildsym_compunit::end_symtab_with_blockvector.\n\nChange-Id: I16c51a6b90a4cb4c0c5f183b0f2e12bc64b6fd74",
    "tree": {
      "sha": "a00cbe27884e94579e4ddb559faf62356be3d4b1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a00cbe27884e94579e4ddb559faf62356be3d4b1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/36664835fa3f81503633024e0e834be4d84276e1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/36664835fa3f81503633024e0e834be4d84276e1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/36664835fa3f81503633024e0e834be4d84276e1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/36664835fa3f81503633024e0e834be4d84276e1/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "43b49762a17718fe13718238a8c0af9b62b682d4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/43b49762a17718fe13718238a8c0af9b62b682d4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/43b49762a17718fe13718238a8c0af9b62b682d4"
    }
  ],
  "stats": {
    "total": 58,
    "additions": 36,
    "deletions": 22
  },
  "files": [
    {
      "sha": "914834f8e51f0a09d791fd18c76cb4a729e5fe88",
      "filename": "gdb/buildsym.c",
      "status": "modified",
      "additions": 2,
      "deletions": 22,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/36664835fa3f81503633024e0e834be4d84276e1/gdb/buildsym.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/36664835fa3f81503633024e0e834be4d84276e1/gdb/buildsym.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/buildsym.c?ref=36664835fa3f81503633024e0e834be4d84276e1",
      "patch": "@@ -996,28 +996,8 @@ buildsym_compunit::end_symtab_with_blockvector (struct block *static_block,\n       symtab->language = subfile->language;\n     }\n \n-  /* Make sure the symtab of main_subfile is the first in its list.  */\n-  {\n-    struct symtab *main_symtab, *prev_symtab;\n-\n-    main_symtab = m_main_subfile->symtab;\n-    prev_symtab = NULL;\n-    for (symtab *symtab : compunit_filetabs (cu))\n-      {\n-\tif (symtab == main_symtab)\n-\t  {\n-\t    if (prev_symtab != NULL)\n-\t      {\n-\t\tprev_symtab->next = main_symtab->next;\n-\t\tmain_symtab->next = COMPUNIT_FILETABS (cu);\n-\t\tCOMPUNIT_FILETABS (cu) = main_symtab;\n-\t      }\n-\t    break;\n-\t  }\n-\tprev_symtab = symtab;\n-      }\n-    gdb_assert (main_symtab == COMPUNIT_FILETABS (cu));\n-  }\n+  /* Make sure the filetab of main_subfile is the primary filetab of the CU.  */\n+  cu->set_primary_filetab (m_main_subfile->symtab);\n \n   /* Fill out the compunit symtab.  */\n "
    },
    {
      "sha": "f4f5f09f215af6101c7beaa4616ba2f7b92a48da",
      "filename": "gdb/symtab.c",
      "status": "modified",
      "additions": 28,
      "deletions": 0,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/36664835fa3f81503633024e0e834be4d84276e1/gdb/symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/36664835fa3f81503633024e0e834be4d84276e1/gdb/symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.c?ref=36664835fa3f81503633024e0e834be4d84276e1",
      "patch": "@@ -361,6 +361,34 @@ compunit_symtab::set_call_site_htab (htab_t call_site_htab)\n \n /* See symtab.h.  */\n \n+void\n+compunit_symtab::set_primary_filetab (symtab *primary_filetab)\n+{\n+  symtab *prev_filetab = nullptr;\n+\n+  /* Move PRIMARY_FILETAB to the head of the filetab list.  */\n+  for (symtab *filetab : compunit_filetabs (this))\n+    {\n+      if (filetab == primary_filetab)\n+\t{\n+\t  if (prev_filetab != nullptr)\n+\t    {\n+\t      prev_filetab->next = primary_filetab->next;\n+\t      primary_filetab->next = this->filetabs;\n+\t      this->filetabs = primary_filetab;\n+\t    }\n+\n+\t  break;\n+\t}\n+\n+      prev_filetab = filetab;\n+    }\n+\n+  gdb_assert (primary_filetab == this->filetabs);\n+}\n+\n+/* See symtab.h.  */\n+\n struct symtab *\n compunit_symtab::primary_filetab () const\n {"
    },
    {
      "sha": "23a348a381ceb4b3d1b2981408389c087b1ad8d9",
      "filename": "gdb/symtab.h",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/36664835fa3f81503633024e0e834be4d84276e1/gdb/symtab.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/36664835fa3f81503633024e0e834be4d84276e1/gdb/symtab.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.h?ref=36664835fa3f81503633024e0e834be4d84276e1",
      "patch": "@@ -1473,6 +1473,12 @@ struct compunit_symtab\n       }\n   }\n \n+  /* Make PRIMARY_FILETAB the primary filetab of this compunit symtab.\n+\n+     PRIMARY_FILETAB must already be a filetab of this compunit symtab.  */\n+\n+  void set_primary_filetab (symtab *primary_filetab);\n+\n   /* Return the primary filetab of the compunit.  */\n   symtab *primary_filetab () const;\n "
    }
  ]
}