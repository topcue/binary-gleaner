{
  "sha": "643c0cbedb4647702778ca8788a54053d1259d3b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjQzYzBjYmVkYjQ2NDc3MDI3NzhjYTg3ODhhNTQwNTNkMTI1OWQzYg==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-09-08T17:22:35Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-11-30T08:36:56Z"
    },
    "message": "Test define-prefix.\n\nAdds a test testing the new define-prefix command.\n\n2019-11-30  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* gdb.base/define-prefix.exp: New file.",
    "tree": {
      "sha": "8e971b432440e91260a5fc8830ceb8a9e363352e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8e971b432440e91260a5fc8830ceb8a9e363352e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/643c0cbedb4647702778ca8788a54053d1259d3b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/643c0cbedb4647702778ca8788a54053d1259d3b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/643c0cbedb4647702778ca8788a54053d1259d3b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/643c0cbedb4647702778ca8788a54053d1259d3b/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "c6ac7fc98718d7e472e1e1c12aae9855c79353a5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c6ac7fc98718d7e472e1e1c12aae9855c79353a5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c6ac7fc98718d7e472e1e1c12aae9855c79353a5"
    }
  ],
  "stats": {
    "total": 168,
    "additions": 168,
    "deletions": 0
  },
  "files": [
    {
      "sha": "a88c54538930a4dede695b7a8cc6384612609ff4",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/643c0cbedb4647702778ca8788a54053d1259d3b/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/643c0cbedb4647702778ca8788a54053d1259d3b/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=643c0cbedb4647702778ca8788a54053d1259d3b",
      "patch": "@@ -1,3 +1,7 @@\n+2019-11-30  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* gdb.base/define-prefix.exp: New file.\n+\n 2019-11-28  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* lib/gdb.exp (skip_btrace_tests): Return 1 if the test fails to"
    },
    {
      "sha": "b04c5959c0ff4e24bb462226230e2be2efda7043",
      "filename": "gdb/testsuite/gdb.base/define-prefix.exp",
      "status": "added",
      "additions": 164,
      "deletions": 0,
      "changes": 164,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/643c0cbedb4647702778ca8788a54053d1259d3b/gdb/testsuite/gdb.base/define-prefix.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/643c0cbedb4647702778ca8788a54053d1259d3b/gdb/testsuite/gdb.base/define-prefix.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/define-prefix.exp?ref=643c0cbedb4647702778ca8788a54053d1259d3b",
      "patch": "@@ -0,0 +1,164 @@\n+# This testcase is part of GDB, the GNU debugger.\n+\n+# Copyright 2019 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+\n+# This test verifies the \"define-prefix\" command.\n+\n+gdb_start\n+\n+####################\n+# Verify the definition of user defined prefix commands.\n+# Test the definition of a command using these prefixes.\n+\n+# Define an empty prefix command.\n+gdb_test_no_output \"define-prefix abc-prefix\"\n+\n+# Verify an empty prefix command cannot be used as a command.\n+gdb_test \"abc-prefix\" \\\n+    \"\\\"abc-prefix\\\" must be followed by the name of a subcommand.*\" \\\n+    \"execute prefix command not followed by subcommand\"\n+\n+# Define a sub-prefix command.\n+gdb_test_no_output \"define-prefix abc-prefix def-prefix\"\n+\n+# Define ghi-cmd using the prefixes.\n+gdb_test_multiple \"define abc-prefix def-prefix ghi-cmd\" \\\n+    \"define user command: abc-prefix def-prefix ghi-cmd\" {\n+\t-re \"Type commands for definition of \\\"abc-prefix def-prefix ghi-cmd\\\".\\r\\nEnd with a line saying just \\\"end\\\".\\r\\n>$\" {\n+\t    gdb_test \"echo command ghi-cmd\\\\n\\nend\" \"\" \\\n+\t\t\"define user command: ghi-cmd\"\n+\t}\n+    }\n+# Verify ghi-cmd works.\n+gdb_test \"abc-prefix def-prefix ghi-cmd\" \\\n+    \"command ghi-cmd\" \\\n+    \"use user command: ghi-cmd\"\n+\n+\n+####################\n+# Verify an existing (empty) command can be marked as a prefix command.\n+# Then verify an empty prefix command can be transformed into an executable command.\n+\n+# Define ghi-prefix-cmd as an empty command.\n+gdb_test_multiple \"define abc-prefix def-prefix ghi-prefix-cmd\" \\\n+    \"define user command: abc-prefix def-prefix ghi-prefix-cmd\" {\n+\t-re \"Type commands for definition of \\\"abc-prefix def-prefix ghi-prefix-cmd\\\".\\r\\nEnd with a line saying just \\\"end\\\".\\r\\n>$\" {\n+\t    gdb_test \"end\" \"\" \\\n+\t\t\"define user command: ghi-prefix-cmd\"\n+\t}\n+    }\n+gdb_test_no_output \"define-prefix abc-prefix def-prefix ghi-prefix-cmd\"\n+\n+# Verify a sequence ending with an empty prefix command cannot be used as\n+# a command.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd\" \\\n+    \"\\\"abc-prefix def-prefix ghi-prefix-cmd\\\" must be followed by the name of a subcommand.*\" \\\n+    \"execute sequence of prefix commands not followed by a subcommand\"\n+\n+# Define jkl-cmd command.\n+gdb_test_multiple \"define abc-prefix def-prefix ghi-prefix-cmd jkl-cmd\" \\\n+    \"define user command: abc-prefix def-prefix ghi-prefix-cmd jkl-cmd\" {\n+\t-re \"Type commands for definition of \\\"abc-prefix def-prefix ghi-prefix-cmd jkl-cmd\\\".\\r\\nEnd with a line saying just \\\"end\\\".\\r\\n>$\" {\n+\t    gdb_test \"echo command jkl-cmd\\\\n\\nend\" \"\" \\\n+\t\t\"define user command: jkl-cmd\"\n+\t}\n+    }\n+# Verify jkl-cmd command works.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd jkl-cmd\" \\\n+    \"command jkl-cmd\" \\\n+    \"use user command: jkl-cmd\"\n+\n+# Define alternate-jkl-cmd and check it works.\n+# Define alternate-jkl-cmd command.\n+gdb_test_multiple \"define abc-prefix def-prefix ghi-prefix-cmd alternate-jkl-cmd\" \\\n+    \"define user command: abc-prefix def-prefix ghi-prefix-cmd alternate-jkl-cmd\" {\n+\t-re \"Type commands for definition of \\\"abc-prefix def-prefix ghi-prefix-cmd alternate-jkl-cmd\\\".\\r\\nEnd with a line saying just \\\"end\\\".\\r\\n>$\" {\n+\t    gdb_test \"echo command alternate-jkl-cmd\\\\n\\nend\" \"\" \\\n+\t\t\"define user command: alternate-jkl-cmd\"\n+\t}\n+    }\n+# Verify alternate-jkl-cmd command works.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd alternate-jkl-cmd\" \\\n+    \"command alternate-jkl-cmd\" \\\n+    \"use user command: alternate-jkl-cmd\"\n+\n+\n+\n+# Now define ghi-prefix-cmd as a real command, and check it is working.\n+send_gdb \"define abc-prefix def-prefix ghi-prefix-cmd\\n\"\n+gdb_expect {\n+    -re \"Type commands for definition of \\\"abc-prefix def-prefix ghi-prefix-cmd\\\".\\r\\nEnd with a line saying just \\\"end\\\".\\r\\n>$\" {\n+\tsend_gdb \"echo defined command ghi-prefix-cmd\\\\n\\nend\\n\"\n+\tgdb_expect {\n+\t    -re \"$gdb_prompt $\" {pass \"define user command: ghi-prefix-cmd\"}\n+\t    timeout {fail \"(timeout) define user command: ghi-prefix-cmd\"}\n+\t}\n+    }\n+    timeout {fail \"(timeout) define user command: ghi-prefix-cmd\"}\n+}\n+\n+# Verify ghi-prefix-cmd command works.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd\" \\\n+    \"defined command ghi-prefix-cmd\" \\\n+    \"use defined user command: ghi-prefix-cmd\"\n+\n+# Now redefine ghi-prefix-cmd, and check it is working.\n+send_gdb \"define abc-prefix def-prefix ghi-prefix-cmd\\n\"\n+gdb_expect {\n+    -re \"Keeping subcommands of prefix command \\\"ghi-prefix-cmd\\\"\\.\\r\\nRedefine command \\\"ghi-prefix-cmd\\\".*y or n. $\" {\n+\tsend_gdb \"y\\n\"\n+\tgdb_expect {\n+\t    -re \"Type commands for definition of \\\"abc-prefix def-prefix ghi-prefix-cmd\\\".\\r\\nEnd with a line saying just \\\"end\\\".\\r\\n>$\" {\n+\t\tsend_gdb \"echo redefined command ghi-prefix-cmd\\\\n\\nend\\n\"\n+\t\tgdb_expect {\n+\t\t    -re \"$gdb_prompt $\" {pass \"redefine user command: ghi-prefix-cmd\"}\n+\t\t    timeout {fail \"(timeout) redefine user command: ghi-prefix-cmd\"}\n+\t\t}\n+\t    }\n+\t    timeout {fail \"(timeout) redefine user command: ghi-prefix-cmd\"}\n+\t}\n+    }\n+    -re \"$gdb_prompt $\" {fail \"redefine user command: ghi-prefix-cmd\"}\n+    timeout {fail \"(timeout) redefine user command: ghi-prefix-cmd\"}\n+}\n+\n+# Verify redefined ghi-prefix-cmd command works.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd\" \\\n+    \"redefined command ghi-prefix-cmd\" \\\n+    \"use redefined user command: ghi-prefix-cmd\"\n+\n+# Check jkl-cmd still works.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd jkl-cmd\" \\\n+    \"command jkl-cmd\" \\\n+    \"use user command after redefining ghi-prefix-cmd: jkl-cmd\"\n+\n+# Check alternate-jkl-cmd still works.\n+gdb_test \"abc-prefix def-prefix ghi-prefix-cmd alternate-jkl-cmd\" \\\n+    \"command alternate-jkl-cmd\" \\\n+    \"use user command after redefining ghi-prefix-cmd: alternate-jkl-cmd\"\n+\n+####################\n+# Check error behaviour.\n+\n+gdb_test \"define-prefix print\" \".* is built-in.*\"\n+\n+gdb_test \"define-prefix something-not-existing something-else\" \\\n+    \"Undefined command: \\\"something-not-existing\\\".*\"\n+\n+gdb_test \"define-prefix abc-prefix something-not-existing something-else\" \\\n+    \"Undefined abc-prefix command: \\\"something-not-existing\\\".*\"\n+"
    }
  ]
}