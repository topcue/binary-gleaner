{
  "sha": "e453275cdcb28f3ca70ecb90d7aec51272a7a4f9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTQ1MzI3NWNkY2IyOGYzY2E3MGVjYjkwZDdhZWM1MTI3MmE3YTRmOQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-05-27T13:22:38Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-05-27T13:22:38Z"
    },
    "message": "[gdb/testsuite] Prevent proc override in gdb-index.exp\n\nWhen running these two test-cases in this specific order we get:\n...\n$ make check 'RUNTESTFLAGS=gdb.dwarf2/gdb-index.exp \\\n    gdb.dwarf2/gdb-add-index-symlink.exp'\n  ...\nRunning gdb.dwarf2/gdb-index.exp ...\nRunning gdb.dwarf2/gdb-add-index-symlink.exp ...\nFAIL: gdb.dwarf2/gdb-add-index-symlink.exp: gdb-index file created\nFAIL: gdb.dwarf2/gdb-add-index-symlink.exp: Unable to call \\\n  gdb-add-index with a symlink to a symfile\n...\n\nThe problem is that gdb-index.exp introduces a proc add_gdb_index which\noverrides the one in lib/gdb.exp and stays active after the test is done.\nConsequently it's used in gdb-add-index-symlink.exp, which should use the one\nfrom lib/gdb.exp.\n\nFix this by renaming proc add_gdb_index in gdb-index.exp.\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2021-05-27  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/27921\n\t* gdb.dwarf2/gdb-index.exp (add_gdb_index): Rename to ...\n\t(local_add_gdb_index): ... this.",
    "tree": {
      "sha": "224cec2ca6e758619cd23432b8c6b128fe1b7a64",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/224cec2ca6e758619cd23432b8c6b128fe1b7a64"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2152b4fdec3eb950f6ef54c6376dcb6fbdb52d02",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2152b4fdec3eb950f6ef54c6376dcb6fbdb52d02",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2152b4fdec3eb950f6ef54c6376dcb6fbdb52d02"
    }
  ],
  "stats": {
    "total": 11,
    "additions": 9,
    "deletions": 2
  },
  "files": [
    {
      "sha": "968e623db408c88731d5f8f8262235dd9b799e58",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=e453275cdcb28f3ca70ecb90d7aec51272a7a4f9",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-27  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/27921\n+\t* gdb.dwarf2/gdb-index.exp (add_gdb_index): Rename to ...\n+\t(local_add_gdb_index): ... this.\n+\n 2021-05-21  Tom de Vries  <tdevries@suse.de>\n \n \tPR testsuite/25047"
    },
    {
      "sha": "0b7adb5379de40c1b2920afbec0c7e2b54bba1ac",
      "filename": "gdb/testsuite/gdb.dwarf2/gdb-index.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9/gdb/testsuite/gdb.dwarf2/gdb-index.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e453275cdcb28f3ca70ecb90d7aec51272a7a4f9/gdb/testsuite/gdb.dwarf2/gdb-index.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/gdb-index.exp?ref=e453275cdcb28f3ca70ecb90d7aec51272a7a4f9",
      "patch": "@@ -31,8 +31,9 @@ if { [prepare_for_testing \"failed to prepare\" \"${testfile}\" \\\n # PROGRAM is assumed to be the output of standard_output_file.\n # Returns the path of the program or \"\" if there is a failure.\n # If there is a failure it will have already been logged.\n+# Use local prefix to prevent overriding add_gdb_index from lib/gdb.exp.\n \n-proc add_gdb_index { program } {\n+proc local_add_gdb_index { program } {\n     set index_file ${program}.gdb-index\n     set dir [file dirname ${program}]\n     set filename [file tail ${program}]\n@@ -90,7 +91,7 @@ gdb_test_multiple \"mt print objfiles ${testfile}\" $test {\n \tset binfile_with_index $binfile\n     }\n     -re \"Psymtabs.*${gdb_prompt} $\" {\n-\tset binfile_with_index [add_gdb_index $binfile]\n+\tset binfile_with_index [local_add_gdb_index $binfile]\n \tif { ${binfile_with_index} == \"\" } {\n \t    return -1\n \t}"
    }
  ]
}