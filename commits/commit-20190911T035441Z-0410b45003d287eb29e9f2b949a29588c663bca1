{
  "sha": "0410b45003d287eb29e9f2b949a29588c663bca1",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDQxMGI0NTAwM2QyODdlYjI5ZTlmMmI5NDlhMjk1ODhjNjYzYmNhMQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-09-09T04:59:39Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-09-11T03:54:41Z"
    },
    "message": "Tidy ld/plugin.c\n\n\t* plugin.c (asymbol_from_plugin_symbol): Move code handling\n\tELF common symbols to block handling ELF visibility.  Simplify\n\tvisibility setting.",
    "tree": {
      "sha": "4df5f6493c2ce0c10c49e182dc2b050f7b3d18d3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4df5f6493c2ce0c10c49e182dc2b050f7b3d18d3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0410b45003d287eb29e9f2b949a29588c663bca1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0410b45003d287eb29e9f2b949a29588c663bca1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0410b45003d287eb29e9f2b949a29588c663bca1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0410b45003d287eb29e9f2b949a29588c663bca1/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e9697e24f52b8e3e5ba974f84f3fc64eb99fac00",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e9697e24f52b8e3e5ba974f84f3fc64eb99fac00",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e9697e24f52b8e3e5ba974f84f3fc64eb99fac00"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 14,
    "deletions": 10
  },
  "files": [
    {
      "sha": "d24973e0fa529c76756f7a5ba614400373a27399",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0410b45003d287eb29e9f2b949a29588c663bca1/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0410b45003d287eb29e9f2b949a29588c663bca1/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=0410b45003d287eb29e9f2b949a29588c663bca1",
      "patch": "@@ -1,3 +1,9 @@\n+2019-09-11  Alan Modra  <amodra@gmail.com>\n+\n+\t* plugin.c (asymbol_from_plugin_symbol): Move code handling\n+\tELF common symbols to block handling ELF visibility.  Simplify\n+\tvisibility setting.\n+\n 2019-09-09  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR binutils/24887"
    },
    {
      "sha": "c8ad732d7c538f1b41d9501ff77c9ec78e220e56",
      "filename": "ld/plugin.c",
      "status": "modified",
      "additions": 8,
      "deletions": 10,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0410b45003d287eb29e9f2b949a29588c663bca1/ld/plugin.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0410b45003d287eb29e9f2b949a29588c663bca1/ld/plugin.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/plugin.c?ref=0410b45003d287eb29e9f2b949a29588c663bca1",
      "patch": "@@ -403,12 +403,6 @@ asymbol_from_plugin_symbol (bfd *abfd, asymbol *asym,\n       flags = BSF_GLOBAL;\n       section = bfd_com_section_ptr;\n       asym->value = ldsym->size;\n-      /* For ELF targets, set alignment of common symbol to 1.  */\n-      if (bfd_get_flavour (abfd) == bfd_target_elf_flavour)\n-\t{\n-\t  ((elf_symbol_type *) asym)->internal_elf_sym.st_shndx = SHN_COMMON;\n-\t  ((elf_symbol_type *) asym)->internal_elf_sym.st_value = 1;\n-\t}\n       break;\n \n     default:\n@@ -417,14 +411,20 @@ asymbol_from_plugin_symbol (bfd *abfd, asymbol *asym,\n   asym->flags = flags;\n   asym->section = section;\n \n-  /* Visibility only applies on ELF targets.  */\n   if (bfd_get_flavour (abfd) == bfd_target_elf_flavour)\n     {\n       elf_symbol_type *elfsym = elf_symbol_from (abfd, asym);\n       unsigned char visibility;\n \n       if (!elfsym)\n \teinfo (_(\"%F%P: %s: non-ELF symbol in ELF BFD!\\n\"), asym->name);\n+\n+      if (ldsym->def == LDPK_COMMON)\n+\t{\n+\t  elfsym->internal_elf_sym.st_shndx = SHN_COMMON;\n+\t  elfsym->internal_elf_sym.st_value = 1;\n+\t}\n+\n       switch (ldsym->visibility)\n \t{\n \tdefault:\n@@ -445,9 +445,7 @@ asymbol_from_plugin_symbol (bfd *abfd, asymbol *asym,\n \t  visibility = STV_HIDDEN;\n \t  break;\n \t}\n-      elfsym->internal_elf_sym.st_other\n-\t= (visibility | (elfsym->internal_elf_sym.st_other\n-\t\t\t & ~ELF_ST_VISIBILITY (-1)));\n+      elfsym->internal_elf_sym.st_other |= visibility;\n     }\n \n   return LDPS_OK;"
    }
  ]
}