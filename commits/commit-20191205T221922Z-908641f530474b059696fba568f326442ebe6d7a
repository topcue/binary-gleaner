{
  "sha": "908641f530474b059696fba568f326442ebe6d7a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTA4NjQxZjUzMDQ3NGIwNTk2OTZmYmE1NjhmMzI2NDQyZWJlNmQ3YQ==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-12-01T14:40:17Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-12-05T22:19:22Z"
    },
    "message": "Fix leaks when pruning inferiors.\n\nValgrind detects various inferior related leaks, such as:\n  ==31877== 5,530 (56 direct, 5,474 indirect) bytes in 1 blocks are definitely lost in loss record 7,131 of 7,355\n  ==31877==    at 0x4C2E18C: calloc (vg_replace_malloc.c:760)\n  ==31877==    by 0x23E580: xcalloc (alloc.c:100)\n  ==31877==    by 0x4794A9: xcnewvec<void*> (poison.h:158)\n  ==31877==    by 0x4794A9: registry_alloc_data(registry_data_registry*, registry_fields*) (registry.c:51)\n  ==31877==    by 0x3A537C: inferior_alloc_data (inferior.c:43)\n  ==31877==    by 0x3A537C: inferior::inferior(int) (inferior.c:92)\n  ==31877==    by 0x3A5426: add_inferior_silent(int) (inferior.c:98)\n  ==31877==    by 0x3A5530: add_inferior(int) (inferior.c:122)\n  ...\n\nOrigin of the leaks is in prune_inferiors: prune_inferiors is first removing\nthe inferior to prune from the inferior list, then calls delete_inferior.\nBut delete_inferior will only really destroy the inferior when it finds\nit into the inferior list.\nAs delete_inferior is removing the inferior to delete from the inferior list,\nensure prune_inferiors only calls delete_inferior, without touching the\ninferior list.\n\ngdb/ChangeLog\n2019-12-05  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\t* inferior.c (prune_inferiors):  Only call delete_inferior.\n\tDo not modify the inferior list.",
    "tree": {
      "sha": "198b373ae4fa1fc103f079ff292d7f219ba8be3f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/198b373ae4fa1fc103f079ff292d7f219ba8be3f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/908641f530474b059696fba568f326442ebe6d7a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/908641f530474b059696fba568f326442ebe6d7a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/908641f530474b059696fba568f326442ebe6d7a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/908641f530474b059696fba568f326442ebe6d7a/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "bce7c9d6fbba85c351ee343843dc9adc285e44a3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bce7c9d6fbba85c351ee343843dc9adc285e44a3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bce7c9d6fbba85c351ee343843dc9adc285e44a3"
    }
  ],
  "stats": {
    "total": 14,
    "additions": 8,
    "deletions": 6
  },
  "files": [
    {
      "sha": "5e4b9f1b176247ef803585811b8075ee8aaa59de",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/908641f530474b059696fba568f326442ebe6d7a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/908641f530474b059696fba568f326442ebe6d7a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=908641f530474b059696fba568f326442ebe6d7a",
      "patch": "@@ -1,3 +1,7 @@\n+2019-12-05  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\t* inferior.c (prune_inferiors):  Only call delete_inferior,\n+\tDo not modify the inferior list.\n+\n 2019-12-05  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* c-exp.y: Update calls to lookup_typename,"
    },
    {
      "sha": "87df193ac392eef2fc2882c1681611057ddc6b07",
      "filename": "gdb/inferior.c",
      "status": "modified",
      "additions": 4,
      "deletions": 6,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/908641f530474b059696fba568f326442ebe6d7a/gdb/inferior.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/908641f530474b059696fba568f326442ebe6d7a/gdb/inferior.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inferior.c?ref=908641f530474b059696fba568f326442ebe6d7a",
      "patch": "@@ -370,24 +370,22 @@ have_live_inferiors (void)\n void\n prune_inferiors (void)\n {\n-  struct inferior *ss, **ss_link;\n+  inferior *ss;\n \n   ss = inferior_list;\n-  ss_link = &inferior_list;\n   while (ss)\n     {\n       if (!ss->deletable ()\n \t  || !ss->removable\n \t  || ss->pid != 0)\n \t{\n-\t  ss_link = &ss->next;\n-\t  ss = *ss_link;\n+\t  ss = ss->next;\n \t  continue;\n \t}\n \n-      *ss_link = ss->next;\n+      inferior *ss_next = ss->next;\n       delete_inferior (ss);\n-      ss = *ss_link;\n+      ss = ss_next;\n     }\n }\n "
    }
  ]
}