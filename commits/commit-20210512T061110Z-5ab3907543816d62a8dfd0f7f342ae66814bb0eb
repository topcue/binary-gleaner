{
  "sha": "5ab3907543816d62a8dfd0f7f342ae66814bb0eb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWFiMzkwNzU0MzgxNmQ2MmE4ZGZkMGY3ZjM0MmFlNjY4MTRiYjBlYg==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-05-11T23:21:22Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-05-12T06:11:10Z"
    },
    "message": "PR27849, heap-buffer-overflow on readelf -w\n\n\tPR 27849\n\t* dwarf.c (fetch_indexed_string): Correct length sanity checks.\n\tSanity check section size for version and padding too.  Correct\n\tindex sanity check.  Handle multiple tables in .debug_str_offsets.",
    "tree": {
      "sha": "2cb6e87bbfdf6d037ccb8f771269920ba830efaa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2cb6e87bbfdf6d037ccb8f771269920ba830efaa"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5ab3907543816d62a8dfd0f7f342ae66814bb0eb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5ab3907543816d62a8dfd0f7f342ae66814bb0eb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5ab3907543816d62a8dfd0f7f342ae66814bb0eb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5ab3907543816d62a8dfd0f7f342ae66814bb0eb/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "425b0b1a98456359084466b755aad51c462603df",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/425b0b1a98456359084466b755aad51c462603df",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/425b0b1a98456359084466b755aad51c462603df"
    }
  ],
  "stats": {
    "total": 39,
    "additions": 31,
    "deletions": 8
  },
  "files": [
    {
      "sha": "9e0611ea9f47aef91980eb9d8011b882a30b63a3",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ab3907543816d62a8dfd0f7f342ae66814bb0eb/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ab3907543816d62a8dfd0f7f342ae66814bb0eb/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=5ab3907543816d62a8dfd0f7f342ae66814bb0eb",
      "patch": "@@ -1,3 +1,10 @@\n+2021-05-12  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27849\n+\t* dwarf.c (fetch_indexed_string): Correct length sanity checks.\n+\tSanity check section size for version and padding too.  Correct\n+\tindex sanity check.  Handle multiple tables in .debug_str_offsets.\n+\n 2021-05-11  Hans-Peter Nilsson  <hp@axis.com>\n \n \t* dwarf.c (process_abbrev_set): Properly parenthesize before"
    },
    {
      "sha": "336a3d5839259484c58880e5d3862c62fe317162",
      "filename": "binutils/dwarf.c",
      "status": "modified",
      "additions": 24,
      "deletions": 8,
      "changes": 32,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ab3907543816d62a8dfd0f7f342ae66814bb0eb/binutils/dwarf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ab3907543816d62a8dfd0f7f342ae66814bb0eb/binutils/dwarf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dwarf.c?ref=5ab3907543816d62a8dfd0f7f342ae66814bb0eb",
      "patch": "@@ -745,7 +745,7 @@ fetch_indexed_string (dwarf_vma idx, struct cu_tu_set *this_set,\n   dwarf_vma str_offset;\n   const char * ret;\n   unsigned char *curr = index_section->start;\n-  const unsigned char *end = curr + index_section->size;\n+  unsigned char *end = curr + index_section->size;\n   dwarf_vma length;\n \n   if (index_section->start == NULL)\n@@ -780,16 +780,31 @@ fetch_indexed_string (dwarf_vma idx, struct cu_tu_set *this_set,\n     {\n       /* Skip the version and padding bytes.\n \t We assume that they are correct.  */\n-      curr += 4;\n+      if (end - curr >= 4)\n+\tcurr += 4;\n+      else\n+\tcurr = end;\n+      if (length >= 4)\n+\tlength -= 4;\n+      else\n+\tlength = 0;\n+\n+      if (this_set != NULL\n+\t  && this_set->section_sizes[DW_SECT_STR_OFFSETS] < length)\n+\tlength = this_set->section_sizes[DW_SECT_STR_OFFSETS];\n \n-      /* FIXME: The code below assumes that there is only one table\n-\t in the .debug_str_offsets section, so check that now.  */\n-      if ((offset_size == 4 && curr + length < (end - 8))\n-\t  || (offset_size == 8 && curr + length < (end - 16)))\n+      if (length > (dwarf_vma) (end - curr))\n \t{\n-\t  warn (_(\"index table size is too small %s vs %s\\n\"),\n+\t  warn (_(\"index table size too large for section %s vs %s\\n\"),\n \t\tdwarf_vmatoa (\"x\", length),\n \t\tdwarf_vmatoa (\"x\", index_section->size));\n+\t  length = end - curr;\n+\t}\n+\n+      if (length < offset_size)\n+\t{\n+\t  warn (_(\"index table size %s is too small\\n\"),\n+\t\tdwarf_vmatoa (\"x\", length));\n \t  return _(\"<table too small>\");\n \t}\n     }\n@@ -799,7 +814,8 @@ fetch_indexed_string (dwarf_vma idx, struct cu_tu_set *this_set,\n   if (this_set != NULL)\n     index_offset += this_set->section_offsets [DW_SECT_STR_OFFSETS];\n \n-  if (index_offset >= length)\n+  if (index_offset >= length\n+      || length - index_offset < offset_size)\n     {\n       warn (_(\"DW_FORM_GNU_str_index offset too big: 0x%s vs 0x%s\\n\"),\n \t    dwarf_vmatoa (\"x\", index_offset),"
    }
  ]
}