{
  "sha": "3024a17ae029ec7f55b498e99ddd6238e22fe565",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzAyNGExN2FlMDI5ZWM3ZjU1YjQ5OGU5OWRkZDYyMzhlMjJmZTU2NQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-01-26T23:57:42Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-01-27T00:23:00Z"
    },
    "message": "Mark all weak aliases for copy relocations\n\nbfd/\n\tPR ld/25458\n\t* elflink.c (_bfd_elf_gc_mark_rsec): Mark all weak aliases.\nld/\n\tPR ld/25458\n\t* testsuite/ld-elf/pr25458.map: New file.\n\t* testsuite/ld-elf/pr25458.rd: Likewise.\n\t* testsuite/ld-elf/pr25458a.s: Likewise.\n\t* testsuite/ld-elf/pr25458b.s: Likewise.\n\t* testsuite/ld-elf/shared.exp: Run PR ld/25458 test.",
    "tree": {
      "sha": "554320c69f99bb0a36f8301e9bcfe539873f6f20",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/554320c69f99bb0a36f8301e9bcfe539873f6f20"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3024a17ae029ec7f55b498e99ddd6238e22fe565",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3024a17ae029ec7f55b498e99ddd6238e22fe565",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3024a17ae029ec7f55b498e99ddd6238e22fe565",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3024a17ae029ec7f55b498e99ddd6238e22fe565/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "27ee3a66bfba776a2af8e9e1248e6a65c31e25a3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/27ee3a66bfba776a2af8e9e1248e6a65c31e25a3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/27ee3a66bfba776a2af8e9e1248e6a65c31e25a3"
    }
  ],
  "stats": {
    "total": 97,
    "additions": 90,
    "deletions": 7
  },
  "files": [
    {
      "sha": "3deba430f13ebaf966376f52ddb299080478f56a",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -1,3 +1,9 @@\n+2020-01-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\t    Alan Modra  <amodra@gmail.com>\n+\n+\tPR ld/25458\n+\t* elflink.c (_bfd_elf_gc_mark_rsec): Mark all weak aliases.\n+\n 2020-01-24  Jim Wilson  <jimw@sifive.com>\n \n \t* elfxx-riscv.c (riscv_get_prefix_class): Format s case like others."
    },
    {
      "sha": "5217528a79b2c61a33fecc0d32e07375f33a359a",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 11,
      "deletions": 7,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -13123,7 +13123,7 @@ _bfd_elf_gc_mark_rsec (struct bfd_link_info *info, asection *sec,\n \t\t       bfd_boolean *start_stop)\n {\n   unsigned long r_symndx;\n-  struct elf_link_hash_entry *h;\n+  struct elf_link_hash_entry *h, *hw;\n \n   r_symndx = cookie->rel->r_info >> cookie->r_sym_shift;\n   if (r_symndx == STN_UNDEF)\n@@ -13143,12 +13143,16 @@ _bfd_elf_gc_mark_rsec (struct bfd_link_info *info, asection *sec,\n \t     || h->root.type == bfd_link_hash_warning)\n \th = (struct elf_link_hash_entry *) h->root.u.i.link;\n       h->mark = 1;\n-      /* If this symbol is weak and there is a non-weak definition, we\n-\t keep the non-weak definition because many backends put\n-\t dynamic reloc info on the non-weak definition for code\n-\t handling copy relocs.  */\n-      if (h->is_weakalias)\n-\tweakdef (h)->mark = 1;\n+      /* Keep all aliases of the symbol too.  If an object symbol\n+\t needs to be copied into .dynbss then all of its aliases\n+\t should be present as dynamic symbols, not just the one used\n+\t on the copy relocation.  */\n+      hw = h;\n+      while (hw->is_weakalias)\n+\t{\n+\t  hw = hw->u.alias;\n+\t  hw->mark = 1;\n+\t}\n \n       if (start_stop != NULL)\n \t{"
    },
    {
      "sha": "b39c8c09b212e048112055d04346e35111e04117",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -1,3 +1,13 @@\n+2020-01-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\t    Alan Modra  <amodra@gmail.com>\n+\n+\tPR ld/25458\n+\t* testsuite/ld-elf/pr25458.map: New file.\n+\t* testsuite/ld-elf/pr25458.rd: Likewise.\n+\t* testsuite/ld-elf/pr25458a.s: Likewise.\n+\t* testsuite/ld-elf/pr25458b.s: Likewise.\n+\t* testsuite/ld-elf/shared.exp: Run PR ld/25458 test.\n+\n 2020-01-22  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/25416"
    },
    {
      "sha": "5578d1fae72ef728ba66750579b5025863431d0e",
      "filename": "ld/testsuite/ld-elf/pr25458.map",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458.map",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458.map",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25458.map?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -0,0 +1,4 @@\n+FOO {\n+global:\n+  __environ; _environ; environ;\n+};"
    },
    {
      "sha": "d0fc6b9bed75a7052db19fa2eb30881a064f11e0",
      "filename": "ld/testsuite/ld-elf/pr25458.rd",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458.rd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458.rd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25458.rd?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -0,0 +1,10 @@\n+#...\n+Symbol table '\\.dynsym' contains [0-9]+ entries:\n+ +Num: +Value +Size Type +Bind +Vis +Ndx Name\n+#...\n+ +[0-9]+: [0-9a-f]+ +(4|8)+ OBJECT +(WEAK|GLOBAL) +DEFAULT +[0-9]+ _*environ@FOO \\(2\\)\n+#...\n+ +[0-9]+: [0-9a-f]+ +(4|8)+ OBJECT +(WEAK|GLOBAL) +DEFAULT +[0-9]+ _*environ@FOO \\(2\\)\n+#...\n+ +[0-9]+: [0-9a-f]+ +(4|8)+ OBJECT +(WEAK|GLOBAL) +DEFAULT +[0-9]+ _*environ@FOO \\(2\\)\n+#pass"
    },
    {
      "sha": "59e6af2c192fdff8fcdf38c7c3bb6646f1b0ea8c",
      "filename": "ld/testsuite/ld-elf/pr25458a.s",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458a.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458a.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25458a.s?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -0,0 +1,6 @@\n+\t.text\n+\t.globl\t_start\n+\t.type\t_start, %function\n+_start:\n+\t.dc.a\tenviron\n+\t.size\t_start, .-_start"
    },
    {
      "sha": "ff64cc7584b3636d67e3f79eb7e075621cc2afe1",
      "filename": "ld/testsuite/ld-elf/pr25458b.s",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458b.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/pr25458b.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25458b.s?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -0,0 +1,11 @@\n+\t.data\n+\t.globl __environ\n+\t.type __environ,%object\n+__environ:\n+\t.dc.a\t0\n+\t.size\t__environ, .-__environ\n+\t.weak _environ\n+\t.globl _environ\n+\t.set _environ, __environ\n+\t.weak environ\n+\t.set environ, __environ"
    },
    {
      "sha": "b1762aff9be16b94503676e4bdc5bc2a20199ce4",
      "filename": "ld/testsuite/ld-elf/shared.exp",
      "status": "modified",
      "additions": 32,
      "deletions": 0,
      "changes": 32,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3024a17ae029ec7f55b498e99ddd6238e22fe565/ld/testsuite/ld-elf/shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/shared.exp?ref=3024a17ae029ec7f55b498e99ddd6238e22fe565",
      "patch": "@@ -337,6 +337,38 @@ if { [check_gc_sections_available] } {\n \t    \"pr22150\" \\\n \t] \\\n     ]\n+\n+    switch -glob $target_triplet {\n+\t# exclude targets that don't support copy relocs\n+\tbfin-*-* { }\n+\tfrv-*-* { }\n+\tlm32-*-* { }\n+\tmips*-*-* { }\n+\ttic6x-*-* { }\n+\txtensa-*-* { }\n+\tdefault {\n+\t    run_ld_link_tests [list \\\n+\t\t[list \\\n+\t\t     \"Build pr25458.so\" \\\n+\t\t     \"$LFLAGS -shared --version-script=pr25458.map\" \\\n+\t\t     \"\" \\\n+\t\t     \"$AFLAGS_PIC\" \\\n+\t\t     {pr25458b.s} \\\n+\t\t     {} \\\n+\t\t     \"pr25458.so\" \\\n+\t\t] \\\n+\t\t[list \\\n+\t\t     \"Build pr25458\" \\\n+\t\t     \"$LFLAGS -e _start --gc-sections\" \\\n+\t\t     \"tmpdir/pr25458.so\" \\\n+\t\t     \"$AFLAGS_PIC\" \\\n+\t\t     {pr25458a.s} \\\n+\t\t     {{readelf {--dyn-sym --wide} pr25458.rd}} \\\n+\t\t     \"pr25458\" \\\n+\t\t] \\\n+\t    ]\n+\t}\n+    }\n }\n \n set ASFLAGS $old_ASFLAGS"
    }
  ]
}