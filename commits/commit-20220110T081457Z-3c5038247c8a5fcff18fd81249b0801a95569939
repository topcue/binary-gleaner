{
  "sha": "3c5038247c8a5fcff18fd81249b0801a95569939",
  "node_id": "C_kwDOANOeidoAKDNjNTAzODI0N2M4YTVmY2ZmMThmZDgxMjQ5YjA4MDFhOTU1Njk5Mzk",
  "commit": {
    "author": {
      "name": "Cl\u00e9ment Chigot",
      "email": "clement.chigot@atos.net",
      "date": "2021-12-17T13:46:01Z"
    },
    "committer": {
      "name": "Cl\u00e9ment Chigot",
      "email": "clement.chigot@atos.net",
      "date": "2022-01-10T08:14:57Z"
    },
    "message": "XCOFF: add support for TLS relocations on hidden symbols\n\nThis patch adds support for TLS relocation targeting C_HIDEXT symbols.\nIn gas, TLS relocations, except R_TLSM and R_TLMSL, must keep the value\nof their target symbol.\nIn ld, it simply ensures that internal TLS symbols are added to the\nlinker hash table for xcoff_reloc_type_tls.\n\nIt also improves the tests made by both.\n\nbfd/ChangeLog:\n\n\t* coff-rs6000.c (xcoff_howto_table): Fix name of R_TLSML.\n\t(xcoff_reloc_type_tls): Replace the error when h is NULL by\n\tan assert.\n\t(xcoff_complain_overflow_unsigned_func): Adjust comments.\n\t* coff64-rs6000.c (xcoff64_howto_table): Fix name of R_TLSML.\n\t* xcofflink.c (xcoff_link_add_symbols_to_hash_table): New\n\tfunction.\n\t(xcoff_link_add_symbols): Add C_HIDEXT TLS symbols to the linker\n\thash table.\n\ngas/ChangeLog:\n\n\t* config/tc-ppc.c (md_apply_fix): Enable support for TLS\n\trelocation over internal symbols.\n\t* testsuite/gas/ppc/aix.exp: Replace xcoff-tlms by xcoff-tls.\n\t* testsuite/gas/ppc/xcoff-tlsm-32.d: Removed.\n\t* testsuite/gas/ppc/xcoff-tlsm-64.d: Removed.\n\t* testsuite/gas/ppc/xcoff-tlsm.s: Removed.\n\t* testsuite/gas/ppc/xcoff-tls-32.d: New test.\n\t* testsuite/gas/ppc/xcoff-tls-64.d: New test.\n\t* testsuite/gas/ppc/xcoff-tls.s: New test.\n\nld/ChangeLog:\n\n\t* testsuite/ld-powerpc/aix52.exp: Improve aix-tls-reloc test.\n\t* testsuite/ld-powerpc/aix-tls-reloc.s: Likewise.\n\t* testsuite/ld-powerpc/aix-tls-reloc-32.d: Removed.\n\t* testsuite/ld-powerpc/aix-tls-reloc-64.d: Removed.\n\t* testsuite/ld-powerpc/aix-tls-reloc-32.dd: New test.\n\t* testsuite/ld-powerpc/aix-tls-reloc-32.dt: New test.\n\t* testsuite/ld-powerpc/aix-tls-reloc-64.dd: New test.\n\t* testsuite/ld-powerpc/aix-tls-reloc-64.dt: New test.",
    "tree": {
      "sha": "2705a789bb9771f4d0f6f8709e390bc5666b9070",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2705a789bb9771f4d0f6f8709e390bc5666b9070"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3c5038247c8a5fcff18fd81249b0801a95569939",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3c5038247c8a5fcff18fd81249b0801a95569939",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3c5038247c8a5fcff18fd81249b0801a95569939",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3c5038247c8a5fcff18fd81249b0801a95569939/comments",
  "author": {
    "login": "Helflym",
    "id": 23002587,
    "node_id": "MDQ6VXNlcjIzMDAyNTg3",
    "avatar_url": "https://avatars.githubusercontent.com/u/23002587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Helflym",
    "html_url": "https://github.com/Helflym",
    "followers_url": "https://api.github.com/users/Helflym/followers",
    "following_url": "https://api.github.com/users/Helflym/following{/other_user}",
    "gists_url": "https://api.github.com/users/Helflym/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Helflym/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Helflym/subscriptions",
    "organizations_url": "https://api.github.com/users/Helflym/orgs",
    "repos_url": "https://api.github.com/users/Helflym/repos",
    "events_url": "https://api.github.com/users/Helflym/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Helflym/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "Helflym",
    "id": 23002587,
    "node_id": "MDQ6VXNlcjIzMDAyNTg3",
    "avatar_url": "https://avatars.githubusercontent.com/u/23002587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Helflym",
    "html_url": "https://github.com/Helflym",
    "followers_url": "https://api.github.com/users/Helflym/followers",
    "following_url": "https://api.github.com/users/Helflym/following{/other_user}",
    "gists_url": "https://api.github.com/users/Helflym/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Helflym/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Helflym/subscriptions",
    "organizations_url": "https://api.github.com/users/Helflym/orgs",
    "repos_url": "https://api.github.com/users/Helflym/repos",
    "events_url": "https://api.github.com/users/Helflym/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Helflym/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4cfa9e3f28c8c5156b9773cc94192233947d351c"
    }
  ],
  "stats": {
    "total": 979,
    "additions": 751,
    "deletions": 228
  },
  "files": [
    {
      "sha": "97e84a443b0041b7e1eb8f132f8886b54a5e877b",
      "filename": "bfd/coff-rs6000.c",
      "status": "modified",
      "additions": 12,
      "deletions": 21,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/bfd/coff-rs6000.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/bfd/coff-rs6000.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/coff-rs6000.c?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -1106,7 +1106,7 @@ reloc_howto_type xcoff_howto_table[] =\n \t 0,\t\t\t/* bitpos */\n \t complain_overflow_bitfield, /* complain_on_overflow */\n \t 0,\t\t\t/* special_function */\n-\t \"R_TLSM\",\t\t/* name */\n+\t \"R_TLSML\",\t\t/* name */\n \t true,\t\t\t/* partial_inplace */\n \t 0xffffffff,\t\t/* src_mask */\n \t 0xffffffff,\t\t/* dst_mask */\n@@ -3236,27 +3236,19 @@ xcoff_reloc_type_tls (bfd *input_bfd ATTRIBUTE_UNUSED,\n \n   h = obj_xcoff_sym_hashes (input_bfd)[rel->r_symndx];\n \n-  /* FIXME: R_TLSML is targeting a internal TOC symbol, which will\n-     make the following checks failing. It should be moved with\n-     R_TLSM bellow once it works.  */\n+  /* R_TLSML is handled by the loader but must be from a\n+     TOC entry targeting itslef.  This is already verified in\n+     xcoff_link_add_symbols.\n+     The value must be 0.  */\n   if (howto->type == R_TLSML)\n     {\n       *relocation = 0;\n       return true;\n     }\n \n-  /* FIXME: h is sometimes null, if the TLS symbol is not exported.  */\n-  if (!h)\n-    {\n-      char vaddr_buf[128];\n-\n-      sprintf_vma (vaddr_buf, rel->r_vaddr);\n-      _bfd_error_handler\n-\t(_(\"%pB: TLS relocation at 0x%s over internal symbols (C_HIDEXT) not yet possible\\n\"),\n-\t input_bfd, vaddr_buf);\n-      return false;\n-    }\n-\n+  /* The target symbol should always be available even if it's not\n+     exported.  */\n+  BFD_ASSERT (h != NULL);\n \n   /* TLS relocations must target a TLS symbol.  */\n   if (h->smclas != XMC_TL && h->smclas != XMC_UL)\n@@ -3286,9 +3278,8 @@ xcoff_reloc_type_tls (bfd *input_bfd ATTRIBUTE_UNUSED,\n       return false;\n     }\n \n-  /* R_TLSM and R_TLSML are relocations used by the loader.\n-     The value must be 0.\n-     FIXME: move R_TLSML here.  */\n+  /* R_TLSM are relocations used by the loader.\n+     The value must be 0.  */\n   if (howto->type == R_TLSM)\n     {\n       *relocation = 0;\n@@ -3621,10 +3612,10 @@ xcoff_complain_overflow_unsigned_func (bfd *input_bfd,\n    R_TLS_LE:\n    Thread-local storage relocation using local-exec model.\n \n-   R_TLS:\n+   R_TLSM:\n    Tread-local storage relocation used by the loader.\n \n-   R_TLSM:\n+   R_TLSML:\n    Tread-local storage relocation used by the loader.\n \n    R_TOCU:"
    },
    {
      "sha": "01326d4503df3a9cd66fd3229f07c6a9d355b4b9",
      "filename": "bfd/coff64-rs6000.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/bfd/coff64-rs6000.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/bfd/coff64-rs6000.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/coff64-rs6000.c?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -1350,7 +1350,7 @@ reloc_howto_type xcoff64_howto_table[] =\n \t 0,\t\t\t/* bitpos */\n \t complain_overflow_bitfield, /* complain_on_overflow */\n \t 0,\t\t\t/* special_function */\n-\t \"R_TLSM\",\t\t/* name */\n+\t \"R_TLSML\",\t\t/* name */\n \t true,\t\t\t/* partial_inplace */\n \t MINUS_ONE,\t\t/* src_mask */\n \t MINUS_ONE,\t\t/* dst_mask */"
    },
    {
      "sha": "ba07ba7f04546c0bce16441baf3c09634e202cf7",
      "filename": "bfd/xcofflink.c",
      "status": "modified",
      "additions": 49,
      "deletions": 6,
      "changes": 55,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/bfd/xcofflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/bfd/xcofflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/xcofflink.c?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -1178,6 +1178,26 @@ xcoff_find_reloc (struct internal_reloc *relocs,\n   return min;\n }\n \n+/* Return true if the symbol has to be added to the linker hash\n+   table.  */\n+static bool\n+xcoff_link_add_symbols_to_hash_table (struct internal_syment sym,\n+\t\t\t\t      union internal_auxent aux)\n+{\n+  /* External symbols must be added.  */\n+  if (EXTERN_SYM_P (sym.n_sclass))\n+    return true;\n+\n+  /* Hidden TLS symbols must be added to verify TLS relocations\n+     in xcoff_reloc_type_tls.  */\n+  if (sym.n_sclass == C_HIDEXT\n+      && ((aux.x_csect.x_smclas == XMC_TL\n+\t   || aux.x_csect.x_smclas == XMC_UL)))\n+    return true;\n+\n+  return false;\n+}\n+\n /* Add all the symbols from an object file to the hash table.\n \n    XCOFF is a weird format.  A normal XCOFF .o files will have three\n@@ -1551,6 +1571,11 @@ xcoff_link_add_symbols (bfd *abfd, struct bfd_link_info *info)\n \t     32 bit has a csect length of 4 for TOC\n \t     64 bit has a csect length of 8 for TOC\n \n+\t     An exception is made for TOC entries with a R_TLSML\n+\t     relocation.  This relocation is made for the loader.\n+\t     We must check that the referenced symbol is the TOC entry\n+\t     itself.\n+\n \t     The conditions to get past the if-check are not that bad.\n \t     They are what is used to create the TOC csects in the first\n \t     place.  */\n@@ -1580,7 +1605,8 @@ xcoff_link_add_symbols (bfd *abfd, struct bfd_link_info *info)\n \t\t 64 bit R_POS r_size is 63  */\n \t      if (relindx < enclosing->reloc_count\n \t\t  && rel->r_vaddr == (bfd_vma) sym.n_value\n-\t\t  && rel->r_type == R_POS\n+\t\t  && (rel->r_type == R_POS ||\n+\t\t      rel->r_type == R_TLSML)\n \t\t  && ((bfd_xcoff_is_xcoff32 (abfd)\n \t\t       && rel->r_size == 31)\n \t\t      || (bfd_xcoff_is_xcoff64 (abfd)\n@@ -1652,6 +1678,22 @@ xcoff_link_add_symbols (bfd *abfd, struct bfd_link_info *info)\n \t\t\t  set_toc = h;\n \t\t\t}\n \t\t    }\n+\t\t  else if (rel->r_type == R_TLSML)\n+\t\t    {\n+\t\t\tcsect_index = ((esym\n+\t\t\t\t\t- (bfd_byte *) obj_coff_external_syms (abfd))\n+\t\t\t\t       / symesz);\n+\t\t\tif (((unsigned long) rel->r_symndx) != csect_index)\n+\t\t\t  {\n+\t\t\t    _bfd_error_handler\n+\t\t\t      /* xgettext:c-format */\n+\t\t\t      (_(\"%pB: TOC entry `%s' has a R_TLSML\"\n+\t\t\t\t \"relocation not targeting itself\"),\n+\t\t\t       abfd, name);\n+\t\t\t    bfd_set_error (bfd_error_bad_value);\n+\t\t\t    goto error_return;\n+\t\t\t  }\n+\t\t    }\n \t\t}\n \t    }\n \n@@ -1749,9 +1791,10 @@ xcoff_link_add_symbols (bfd *abfd, struct bfd_link_info *info)\n \t    if (first_csect == NULL)\n \t      first_csect = csect;\n \n-\t    /* If this symbol is external, we treat it as starting at the\n-\t       beginning of the newly created section.  */\n-\t    if (EXTERN_SYM_P (sym.n_sclass))\n+\t    /* If this symbol must be added to the linker hash table,\n+\t       we treat it as starting at the beginning of the newly\n+\t       created section.  */\n+\t    if (xcoff_link_add_symbols_to_hash_table (sym, aux))\n \t      {\n \t\tsection = csect;\n \t\tvalue = 0;\n@@ -1847,7 +1890,7 @@ xcoff_link_add_symbols (bfd *abfd, struct bfd_link_info *info)\n \t  if (first_csect == NULL)\n \t    first_csect = csect;\n \n-\t  if (EXTERN_SYM_P (sym.n_sclass))\n+\t  if (xcoff_link_add_symbols_to_hash_table (sym, aux))\n \t    {\n \t      csect->flags |= SEC_IS_COMMON;\n \t      csect->size = 0;\n@@ -1888,7 +1931,7 @@ xcoff_link_add_symbols (bfd *abfd, struct bfd_link_info *info)\n       /* Now we have enough information to add the symbol to the\n \t linker hash table.  */\n \n-      if (EXTERN_SYM_P (sym.n_sclass))\n+      if (xcoff_link_add_symbols_to_hash_table (sym, aux))\n \t{\n \t  bool copy, ok;\n \t  flagword flags;"
    },
    {
      "sha": "159d3155b4ca6980173bf3d9098ca22edb7589e5",
      "filename": "gas/config/tc-ppc.c",
      "status": "modified",
      "additions": 19,
      "deletions": 13,
      "changes": 32,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/gas/config/tc-ppc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/gas/config/tc-ppc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-ppc.c?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -7426,22 +7426,25 @@ md_apply_fix (fixS *fixP, valueT *valP, segT seg)\n \tcase BFD_RELOC_PPC64_TLSM:\n \t  gas_assert (fixP->fx_addsy != NULL);\n \t  S_SET_THREAD_LOCAL (fixP->fx_addsy);\n-\t  fieldval = 0;\n \t  break;\n \n-\t  /* TLSML relocations are targeting a XMC_TC symbol named\n-\t     \"_$TLSML\". We can't check earlier because the relocation\n-\t     can target any symbol name which will be latter .rename\n-\t     to \"_$TLSML\".  */\n+\t  /* Officially, R_TLSML relocations must be from a TOC entry\n+\t     targeting itself. In practice, this TOC entry is always\n+\t     named (or .rename) \"_$TLSML\".\n+\t     Thus, as it doesn't seem possible to retrieve the symbol\n+\t     being relocated here, we simply check that the symbol\n+\t     targeted by R_TLSML is indeed a TOC entry named \"_$TLSML\".\n+\t     FIXME: Find a way to correctly check R_TLSML relocations\n+\t     as described above.  */\n \tcase BFD_RELOC_PPC_TLSML:\n \tcase BFD_RELOC_PPC64_TLSML:\n \t  gas_assert (fixP->fx_addsy != NULL);\n-\t  if (strcmp (symbol_get_tc (fixP->fx_addsy)->real_name, \"_$TLSML\") != 0)\n-\t    {\n-\t      as_bad_where (fixP->fx_file, fixP->fx_line,\n-\t\t\t    _(\"R_TLSML relocation doesn't target a \"\n-\t\t\t      \"symbol named \\\"_$TLSML\\\". %s\"), S_GET_NAME(fixP->fx_addsy));\n-\t    }\n+\t  if ((symbol_get_tc (fixP->fx_addsy)->symbol_class != XMC_TC\n+\t       || symbol_get_tc (fixP->fx_addsy)->symbol_class != XMC_TE)\n+\t      && strcmp (symbol_get_tc (fixP->fx_addsy)->real_name, \"_$TLSML\") != 0)\n+\t    as_bad_where (fixP->fx_file, fixP->fx_line,\n+\t\t\t  _(\"R_TLSML relocation doesn't target a \"\n+\t\t\t    \"TOC entry named \\\"_$TLSML\\\": %s\"), S_GET_NAME(fixP->fx_addsy));\n \t  fieldval = 0;\n \t  break;\n \n@@ -7519,12 +7522,15 @@ md_apply_fix (fixS *fixP, valueT *valP, segT seg)\n       *valP = value;\n     }\n   else if (fixP->fx_r_type == BFD_RELOC_PPC_TLSM\n-\t   || fixP->fx_r_type == BFD_RELOC_PPC64_TLSM)\n+\t   || fixP->fx_r_type == BFD_RELOC_PPC64_TLSM\n+\t   || fixP->fx_r_type == BFD_RELOC_PPC_TLSML\n+\t   || fixP->fx_r_type == BFD_RELOC_PPC64_TLSML)\n     /* AIX ld expects the section contents for these relocations\n        to be zero.  Arrange for that to occur when\n        bfd_install_relocation is called.  */\n     fixP->fx_addnumber = (- bfd_section_vma (S_GET_SEGMENT (fixP->fx_addsy))\n-\t\t\t  - S_GET_VALUE (fixP->fx_addsy));\n+\t\t\t  - S_GET_VALUE (fixP->fx_addsy)\n+\t\t\t  - fieldval);\n   else\n     fixP->fx_addnumber = 0;\n #endif"
    },
    {
      "sha": "78f29f0674df9657a5c8320c74f60da1d53e0fdb",
      "filename": "gas/testsuite/gas/ppc/aix.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/aix.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/aix.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/aix.exp?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -79,8 +79,8 @@ if { [istarget \"powerpc*-*-aix*\"] || [istarget \"rs6000-*-aix*\"] } then {\n     run_dump_test \"xcoff-function-1-32\"\n     run_dump_test \"xcoff-function-1-64\"\n \n-    run_dump_test \"xcoff-tlsm-32\"\n-    run_dump_test \"xcoff-tlsm-64\"\n+    run_dump_test \"xcoff-tls-32\"\n+    run_dump_test \"xcoff-tls-64\"\n \n     run_dump_test \"xcoff-stsym-32\"\n     run_dump_test \"xcoff-stsym-64\""
    },
    {
      "sha": "eb71df09e416aba364a12149283bdc02c2eedbdb",
      "filename": "gas/testsuite/gas/ppc/xcoff-tls-32.d",
      "status": "added",
      "additions": 106,
      "deletions": 0,
      "changes": 106,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/xcoff-tls-32.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/xcoff-tls-32.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/xcoff-tls-32.d?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,106 @@\n+#as: -a32\n+#source: xcoff-tls.s\n+#objdump: -Dr\n+#name: XCOFF TLS relocation (32 bit)\n+\n+.*\n+Disassembly of section .data:\n+\n+00000000 <TOC>:\n+   0:\t00 00 00 58.*\n+\t\t\t0: R_TLS\ttdata_ext.*\n+\n+00000004 <.tdata_ext_gd>:\n+   4:\t00 00 00 00.*\n+\t\t\t4: R_TLSM\ttdata_ext.*\n+\n+00000008 <tdata_ext_ld>:\n+   8:\t00 00 00 58.*\n+\t\t\t8: R_TLS_LD\ttdata_ext.*\n+\n+0000000c <tdata_ext_ie>:\n+   c:\t00 00 00 58.*\n+\t\t\tc: R_TLS_IE\ttdata_ext.*\n+\n+00000010 <tdata_ext_le>:\n+  10:\t00 00 00 58.*\n+\t\t\t10: R_TLS_LE\ttdata_ext.*\n+\n+00000014 <tdata_int1_gd>:\n+  14:\t00 00 00 5c.*\n+\t\t\t14: R_TLS\ttdata_int_csect.*\n+\n+00000018 <.tdata_int1_gd>:\n+  18:\t00 00 00 00.*\n+\t\t\t18: R_TLSM\ttdata_int_csect.*\n+\n+0000001c <tdata_int1_ld>:\n+  1c:\t00 00 00 5c.*\n+\t\t\t1c: R_TLS_LD\ttdata_int_csect.*\n+\n+00000020 <tdata_int1_ie>:\n+  20:\t00 00 00 5c.*\n+\t\t\t20: R_TLS_IE\ttdata_int_csect.*\n+\n+00000024 <tdata_int1_le>:\n+  24:\t00 00 00 5c.*\n+\t\t\t24: R_TLS_LE\ttdata_int_csect.*\n+\n+00000028 <tdata_int2_gd>:\n+  28:\t00 00 00 60.*\n+\t\t\t28: R_TLS\ttdata_int_csect.*\n+\n+0000002c <.tdata_int2_gd>:\n+  2c:\t00 00 00 00.*\n+\t\t\t2c: R_TLSM\ttdata_int_csect.*\n+\n+00000030 <tdata_int2_ld>:\n+  30:\t00 00 00 60.*\n+\t\t\t30: R_TLS_LD\ttdata_int_csect.*\n+\n+00000034 <tdata_int2_ie>:\n+  34:\t00 00 00 60.*\n+\t\t\t34: R_TLS_IE\ttdata_int_csect.*\n+\n+00000038 <tdata_int2_le>:\n+  38:\t00 00 00 60.*\n+\t\t\t38: R_TLS_LE\ttdata_int_csect.*\n+\n+0000003c <tbss_ext_gd>:\n+  3c:\t00 00 00 68.*\n+\t\t\t3c: R_TLS\ttbss_ext.*\n+\n+00000040 <.tbss_ext_gd>:\n+  40:\t00 00 00 00.*\n+\t\t\t40: R_TLSM\ttbss_ext.*\n+\n+00000044 <tbss_ext_ld>:\n+  44:\t00 00 00 68.*\n+\t\t\t44: R_TLS_LD\ttbss_ext.*\n+\n+00000048 <tbss_ext_ie>:\n+  48:\t00 00 00 68.*\n+\t\t\t48: R_TLS_IE\ttbss_ext.*\n+\n+0000004c <tbss_ext_le>:\n+  4c:\t00 00 00 68.*\n+\t\t\t4c: R_TLS_LE\ttbss_ext.*\n+\n+00000050 <_\\$TLSML>:\n+\t...\n+\t\t\t50: R_TLSML\t_\\$TLSML.*\n+\n+Disassembly of section .tdata:\n+\n+00000058 <tdata_ext>:\n+  58:\t00 00 00 01 \t.long 0x1\n+\n+0000005c <tdata_int_csect>:\n+  5c:\t00 00 00 02 \t.long 0x2\n+  60:\t00 00 00 03 \t.long 0x3\n+  64:.*\n+\n+Disassembly of section .tbss:\n+\n+00000068 <tbss_ext>:\n+\t..."
    },
    {
      "sha": "7f3b6ebceb6944a97eaafe0714dfd8a250cc969b",
      "filename": "gas/testsuite/gas/ppc/xcoff-tls-64.d",
      "status": "added",
      "additions": 124,
      "deletions": 0,
      "changes": 124,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/xcoff-tls-64.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/xcoff-tls-64.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/xcoff-tls-64.d?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,124 @@\n+#as: -a64\n+#source: xcoff-tls.s\n+#objdump: -Dr\n+#name: XCOFF TLS relocation (64 bit)\n+\n+.*\n+\n+\n+Disassembly of section .data:\n+\n+0000000000000000 <TOC>:\n+   0:\t00 00 00 00.*\n+\t\t\t0: R_TLS\ttdata_ext.*\n+   4:\t00 00 00 a8.*\n+\n+0000000000000008 <.tdata_ext_gd>:\n+\t...\n+\t\t\t8: R_TLSM\ttdata_ext.*\n+\n+0000000000000010 <tdata_ext_ld>:\n+  10:\t00 00 00 00.*\n+\t\t\t10: R_TLS_LD\ttdata_ext.*\n+  14:\t00 00 00 a8.*\n+\n+0000000000000018 <tdata_ext_ie>:\n+  18:\t00 00 00 00.*\n+\t\t\t18: R_TLS_IE\ttdata_ext.*\n+  1c:\t00 00 00 a8.*\n+\n+0000000000000020 <tdata_ext_le>:\n+  20:\t00 00 00 00.*\n+\t\t\t20: R_TLS_LE\ttdata_ext.*\n+  24:\t00 00 00 a8.*\n+\n+0000000000000028 <tdata_int1_gd>:\n+  28:\t00 00 00 00.*\n+\t\t\t28: R_TLS\ttdata_int_csect.*\n+  2c:\t00 00 00 ac.*\n+\n+0000000000000030 <.tdata_int1_gd>:\n+\t...\n+\t\t\t30: R_TLSM\ttdata_int_csect.*\n+\n+0000000000000038 <tdata_int1_ld>:\n+  38:\t00 00 00 00.*\n+\t\t\t38: R_TLS_LD\ttdata_int_csect.*\n+  3c:\t00 00 00 ac.*\n+\n+0000000000000040 <tdata_int1_ie>:\n+  40:\t00 00 00 00.*\n+\t\t\t40: R_TLS_IE\ttdata_int_csect.*\n+  44:\t00 00 00 ac.*\n+\n+0000000000000048 <tdata_int1_le>:\n+  48:\t00 00 00 00.*\n+\t\t\t48: R_TLS_LE\ttdata_int_csect.*\n+  4c:\t00 00 00 ac.*\n+\n+0000000000000050 <tdata_int2_gd>:\n+  50:\t00 00 00 00.*\n+\t\t\t50: R_TLS\ttdata_int_csect.*\n+  54:\t00 00 00 b0.*\n+\n+0000000000000058 <.tdata_int2_gd>:\n+\t...\n+\t\t\t58: R_TLSM\ttdata_int_csect.*\n+\n+0000000000000060 <tdata_int2_ld>:\n+  60:\t00 00 00 00.*\n+\t\t\t60: R_TLS_LD\ttdata_int_csect.*\n+  64:\t00 00 00 b0.*\n+\n+0000000000000068 <tdata_int2_ie>:\n+  68:\t00 00 00 00.*\n+\t\t\t68: R_TLS_IE\ttdata_int_csect.*\n+  6c:\t00 00 00 b0.*\n+\n+0000000000000070 <tdata_int2_le>:\n+  70:\t00 00 00 00.*\n+\t\t\t70: R_TLS_LE\ttdata_int_csect.*\n+  74:\t00 00 00 b0.*\n+\n+0000000000000078 <tbss_ext_gd>:\n+  78:\t00 00 00 00.*\n+\t\t\t78: R_TLS\ttbss_ext.*\n+  7c:\t00 00 00 b8.*\n+\n+0000000000000080 <.tbss_ext_gd>:\n+\t...\n+\t\t\t80: R_TLSM\ttbss_ext.*\n+\n+0000000000000088 <tbss_ext_ld>:\n+  88:\t00 00 00 00.*\n+\t\t\t88: R_TLS_LD\ttbss_ext.*\n+  8c:\t00 00 00 b8.*\n+\n+0000000000000090 <tbss_ext_ie>:\n+  90:\t00 00 00 00.*\n+\t\t\t90: R_TLS_IE\ttbss_ext.*\n+  94:\t00 00 00 b8.*\n+\n+0000000000000098 <tbss_ext_le>:\n+  98:\t00 00 00 00.*\n+\t\t\t98: R_TLS_LE\ttbss_ext.*\n+  9c:\t00 00 00 b8.*\n+\n+00000000000000a0 <_\\$TLSML>:\n+\t...\n+\t\t\ta0: R_TLSML\t_\\$TLSML-0xa0\n+\n+Disassembly of section .tdata:\n+\n+00000000000000a8 <tdata_ext>:\n+  a8:\t00 00 00 01 \t.long 0x1\n+\n+00000000000000ac <tdata_int_csect>:\n+  ac:\t00 00 00 02 \t.long 0x2\n+  b0:\t00 00 00 03 \t.long 0x3\n+  b4:.*\n+\n+Disassembly of section .tbss:\n+\n+00000000000000b8 <tbss_ext>:\n+\t..."
    },
    {
      "sha": "83e77f19c1e9eb6d0fe9aab73e12502f06d36e42",
      "filename": "gas/testsuite/gas/ppc/xcoff-tls.s",
      "status": "added",
      "additions": 57,
      "deletions": 0,
      "changes": 57,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/xcoff-tls.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/gas/testsuite/gas/ppc/xcoff-tls.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/xcoff-tls.s?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,57 @@\n+# An external tdata symbol\n+  .globl tdata_ext[TL]\n+  .csect tdata_ext[TL]\n+  .long 1\n+\n+  .csect tdata_int_csect[TL]\n+# A first internal tdata symbol\n+tdata_int1:\n+  .long 2\n+# A second internal tdata symbol\n+tdata_int2:\n+  .long 3\n+\n+# Two external tbss symbols.\n+# XCOFF doesn't seem to allow internal tbss\n+# (or bss) symbols.\n+  .comm tbss_ext[UL],8\n+\n+  .toc\n+# TC entries targeting the external tdata symbol\n+# Their value should be \"tdata_ext\" address,\n+# except TLSM value which must be 0.\n+# Their relocations should target it.\n+  .tc  tdata_ext_gd[TC],tdata_ext[TL]\n+  .tc .tdata_ext_gd[TC],tdata_ext[TL]@m\n+  .tc  tdata_ext_ld[TC],tdata_ext[TL]@ld\n+  .tc  tdata_ext_ie[TC],tdata_ext[TL]@ie\n+  .tc  tdata_ext_le[TC],tdata_ext[TL]@le\n+\n+# TC entries targeting internal tdata symbols.\n+# Their value should be \"tdata_int1\" or \"tdata_int2\"\n+# addresses, except TLSM value which must be 0.\n+# Their relocations should target \"tdata_int_csect\".\n+  .tc  tdata_int1_gd[TC],tdata_int1\n+  .tc .tdata_int1_gd[TC],tdata_int1@m\n+  .tc  tdata_int1_ld[TC],tdata_int1@ld\n+  .tc  tdata_int1_ie[TC],tdata_int1@ie\n+  .tc  tdata_int1_le[TC],tdata_int1@le\n+  .tc  tdata_int2_gd[TC],tdata_int2\n+  .tc .tdata_int2_gd[TC],tdata_int2@m\n+  .tc  tdata_int2_ld[TC],tdata_int2@ld\n+  .tc  tdata_int2_ie[TC],tdata_int2@ie\n+  .tc  tdata_int2_le[TC],tdata_int2@le\n+\n+# TC entries targeting the external tdata symbol\n+# Their value should be \"tbss_ext\" address,\n+# except TLSM value which must be 0.\n+# Their relocations should target \"tbss_ext\".\n+  .tc  tbss_ext_gd[TC],tbss_ext[UL]\n+  .tc .tbss_ext_gd[TC],tbss_ext[UL]@m\n+  .tc  tbss_ext_ld[TC],tbss_ext[UL]@ld\n+  .tc  tbss_ext_ie[TC],tbss_ext[UL]@ie\n+  .tc  tbss_ext_le[TC],tbss_ext[UL]@le\n+\n+# Module entry\n+  .tc  mh[TC],mh[TC]@ml\n+.rename mh[TC], \"_$TLSML\" # Symbol for the module handle"
    },
    {
      "sha": "a09dd1a2e4ac07d7f2326c8302d09a308f50a8f3",
      "filename": "gas/testsuite/gas/ppc/xcoff-tlsm-32.d",
      "status": "removed",
      "additions": 0,
      "deletions": 34,
      "changes": 34,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4cfa9e3f28c8c5156b9773cc94192233947d351c/gas/testsuite/gas/ppc/xcoff-tlsm-32.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4cfa9e3f28c8c5156b9773cc94192233947d351c/gas/testsuite/gas/ppc/xcoff-tlsm-32.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/xcoff-tlsm-32.d?ref=4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "patch": "@@ -1,34 +0,0 @@\n-#as: -a32\n-#source: xcoff-tlsm.s\n-#objdump: -Dr\n-#name: XCOFF TLSM relocation (32 bit)\n-\n-.*\n-Disassembly of section .data:\n-\n-00000000 <TOC>:\n-   0:\t00 00 00 10.*\n-\t\t\t0: R_TLS\tfoo_tdata-0x10\n-\n-00000004 <.foo_tdata>:\n-   4:\t00 00 00 00.*\n-\t\t\t4: R_TLSM\tfoo_tdata-0x10\n-\n-00000008 <foo_tbss>:\n-   8:\t00 00 00 20.*\n-\t\t\t8: R_TLS\tfoo_tbss-0x20\n-\n-0000000c <.foo_tbss>:\n-   c:\t00 00 00 00.*\n-\t\t\tc: R_TLSM\tfoo_tbss-0x20\n-\n-Disassembly of section .tdata:\n-\n-00000010 <foo_tdata>:\n-  10:\t00 00 00 01.*\n-\t...\n-\n-Disassembly of section .tbss:\n-\n-00000020 <foo_tbss>:\n-\t..."
    },
    {
      "sha": "f447a51774282807b6efa0571b1fa5616b719661",
      "filename": "gas/testsuite/gas/ppc/xcoff-tlsm-64.d",
      "status": "removed",
      "additions": 0,
      "deletions": 36,
      "changes": 36,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4cfa9e3f28c8c5156b9773cc94192233947d351c/gas/testsuite/gas/ppc/xcoff-tlsm-64.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4cfa9e3f28c8c5156b9773cc94192233947d351c/gas/testsuite/gas/ppc/xcoff-tlsm-64.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/xcoff-tlsm-64.d?ref=4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "patch": "@@ -1,36 +0,0 @@\n-#as: -a64\n-#source: xcoff-tlsm.s\n-#objdump: -Dr\n-#name: XCOFF TLSM relocation (64 bit)\n-\n-.*\n-Disassembly of section .data:\n-\n-0000000000000000 <TOC>:\n-   0:\t00 00 00 00.*\n-\t\t\t0: R_TLS\tfoo_tdata-0x20\n-   4:\t00 00 00 20.*\n-\n-0000000000000008 <.foo_tdata>:\n-\t...\n-\t\t\t8: R_TLSM\tfoo_tdata-0x20\n-\n-0000000000000010 <foo_tbss>:\n-  10:\t00 00 00 00.*\n-\t\t\t10: R_TLS\tfoo_tbss-0x30\n-  14:\t00 00 00 30.*\n-\n-0000000000000018 <.foo_tbss>:\n-\t...\n-\t\t\t18: R_TLSM\tfoo_tbss-0x30\n-\n-Disassembly of section .tdata:\n-\n-0000000000000020 <foo_tdata>:\n-  20:\t00 00 00 01.*\n-\t...\n-\n-Disassembly of section .tbss:\n-\n-0000000000000030 <foo_tbss>:\n-\t..."
    },
    {
      "sha": "0c857bf0aa9a9cad9b360858f84a1fe9ebdc901c",
      "filename": "gas/testsuite/gas/ppc/xcoff-tlsm.s",
      "status": "removed",
      "additions": 0,
      "deletions": 12,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4cfa9e3f28c8c5156b9773cc94192233947d351c/gas/testsuite/gas/ppc/xcoff-tlsm.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4cfa9e3f28c8c5156b9773cc94192233947d351c/gas/testsuite/gas/ppc/xcoff-tlsm.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/ppc/xcoff-tlsm.s?ref=4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "patch": "@@ -1,12 +0,0 @@\n-  .csect foo_tdata[TL],4\n-  .align 2\n-foo_tdata:\n-  .long\t1\n-\n-  .comm foo_tbss[UL],8\n-\n-  .toc\n-  .tc foo_tdata[TC],foo_tdata[TL]\n-  .tc .foo_tdata[TC],foo_tdata[TL]@m\n-  .tc foo_tbss[TC],foo_tbss[UL]\n-  .tc .foo_tbss[TC],foo_tbss[UL]@m"
    },
    {
      "sha": "5103de50618031420e61e92bd9edb9cccbeeef95",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc-32.d",
      "status": "removed",
      "additions": 0,
      "deletions": 35,
      "changes": 35,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4cfa9e3f28c8c5156b9773cc94192233947d351c/ld/testsuite/ld-powerpc/aix-tls-reloc-32.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4cfa9e3f28c8c5156b9773cc94192233947d351c/ld/testsuite/ld-powerpc/aix-tls-reloc-32.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc-32.d?ref=4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "patch": "@@ -1,35 +0,0 @@\n-#source: aix-tls-reloc.s\n-#as: -a32\n-#ld: -b32 -shared -bE:aix-tls-reloc.ex\n-#objdump: -dr\n-#target: [is_xcoff_format]\n-\n-.*\n-\n-Disassembly of section \\.text:\n-\n-.* <\\.foo>:\n-.*:\t80 82 00 00 \tl       r4,0\\(r2\\)\n-.*: R_TOC\tgd-.*\n-.*:\t80 62 00 04 \tl       r3,4\\(r2\\)\n-.*: R_TOC\t.gd-.*\n-.*:\t48 00 00 03 \tbla     0 <\\.foo-.*>\n-.*: R_BA_26\t__tls_get_addr\n-.*:\t80 62 00 0c \tl       r3,12\\(r2\\)\n-.*: R_TOC\t_\\$TLSML-.*\n-.*:\t48 00 00 03 \tbla     0 <\\.foo-.*>\n-.*: R_BA_26\t__tls_get_mod\n-.*:\t80 82 00 08 \tl       r4,8\\(r2\\)\n-.*: R_TOC\tld-.*\n-.*:\t7c a3 22 14 \tcax     r5,r3,r4\n-.*:\t48 00 00 03 \tbla     0 <\\.foo-.*>\n-.*: R_BA_26\t__get_tpointer\n-.*:\t80 82 00 10 \tl       r4,16\\(r2\\)\n-.*: R_TOC\tie-.*\n-.*:\t7c a3 22 14 \tcax     r5,r3,r4\n-.*:\t48 00 00 03 \tbla     0 <\\.foo-.*>\n-.*: R_BA_26\t__get_tpointer\n-.*:\t80 82 00 14 \tl       r4,20\\(r2\\)\n-.*: R_TOC\tle-.*\n-.*:\t7c a3 22 14 \tcax     r5,r3,r4\n-.*"
    },
    {
      "sha": "001a7f0c65e0b270ddf0176a0902699dc6c2b10e",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc-32.dd",
      "status": "added",
      "additions": 101,
      "deletions": 0,
      "changes": 101,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-32.dd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-32.dd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc-32.dd?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,101 @@\n+#source: aix-tls-reloc.s\n+#as: -a32\n+#ld: -b32 -shared -bE:aix-tls-reloc.ex\n+#objdump: -dr -j.data\n+#target: [is_xcoff_format]\n+\n+.*\n+\n+\n+Disassembly of section .data:\n+\n+.* <foo>:\n+.*\n+.*\n+.*\n+.*\n+.*\n+\n+.* <TOC>:\n+.*:\tff ff 88 00 .*\n+.*: R_TLS\ttdata_ext.*\n+\n+.* <.tdata_ext_gd>:\n+.*:\t00 00 00 00 .*\n+.*: R_TLSM\ttdata_ext.*\n+\n+.* <tdata_ext_ld>:\n+.*:\tff ff 88 00 .*\n+.*: R_TLS_LD\ttdata_ext.*\n+\n+.* <tdata_ext_ie>:\n+.*:\tff ff 88 00 .*\n+.*: R_TLS_IE\ttdata_ext.*\n+\n+.* <tdata_ext_le>:\n+.*:\tff ff 88 00 .*\n+.*: R_TLS_LE\ttdata_ext.*\n+\n+.* <tdata_int1_gd>:\n+.*:\tff ff 88 04 .*\n+.*: R_TLS\ttdata_int_csect.*\n+\n+.* <.tdata_int1_gd>:\n+.*:\t00 00 00 00 .*\n+.*: R_TLSM\ttdata_int_csect.*\n+\n+.* <tdata_int1_ld>:\n+.*:\tff ff 88 04 .*\n+.*: R_TLS_LD\ttdata_int_csect.*\n+\n+.* <tdata_int1_ie>:\n+.*:\tff ff 88 04 .*\n+.*: R_TLS_IE\ttdata_int_csect.*\n+\n+.* <tdata_int1_le>:\n+.*:\tff ff 88 04 .*\n+.*: R_TLS_LE\ttdata_int_csect.*\n+\n+.* <tdata_int2_gd>:\n+.*:\tff ff 88 08 .*\n+.*: R_TLS\ttdata_int_csect.*\n+\n+.* <.tdata_int2_gd>:\n+.*:\t00 00 00 00 .*\n+.*: R_TLSM\ttdata_int_csect.*\n+\n+.* <tdata_int2_ld>:\n+.*:\tff ff 88 08 .*\n+.*: R_TLS_LD\ttdata_int_csect.*\n+\n+.* <tdata_int2_ie>:\n+.*:\tff ff 88 08 .*\n+.*: R_TLS_IE\ttdata_int_csect.*\n+\n+.* <tdata_int2_le>:\n+.*:\tff ff 88 08 .*\n+.*: R_TLS_LE\ttdata_int_csect.*\n+\n+.* <tbss_ext_gd>:\n+.*:\tff ff 88 10 .*\n+.*: R_TLS\ttbss_ext.*\n+\n+.* <.tbss_ext_gd>:\n+.*:\t00 00 00 00 .*\n+.*: R_TLSM\ttbss_ext.*\n+\n+.* <tbss_ext_ld>:\n+.*:\tff ff 88 10 .*\n+.*: R_TLS_LD\ttbss_ext.*\n+\n+.* <tbss_ext_ie>:\n+.*:\tff ff 88 10 .*\n+.*: R_TLS_IE\ttbss_ext.*\n+\n+.* <tbss_ext_le>:\n+.*:\tff ff 88 10 .*\n+.*: R_TLS_LE\ttbss_ext.*\n+\n+.* <_\\$TLSML>:\n+\t...\n+.*: R_TLSML\t_\\$TLSML.*"
    },
    {
      "sha": "91ceb669eb9af412688c99ffa1ea41c3ac2490da",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc-32.dt",
      "status": "added",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-32.dt",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-32.dt",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc-32.dt?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,18 @@\n+\n+tmpdir/aix-tls-reloc.so:     file format aixcoff-rs6000\n+\n+\n+Disassembly of section .tdata:\n+\n+ffff8800 <tdata_ext>:\n+ffff8800:\t00 00 00 01 \t.long 0x1\n+\n+ffff8804 <tdata_int_csect>:\n+ffff8804:\t00 00 00 02 \t.long 0x2\n+ffff8808:\t00 00 00 03 \t.long 0x3\n+ffff880c:\t00 00 00 00 \t.long 0x0\n+\n+Disassembly of section .tbss:\n+\n+ffff8810 <tbss_ext>:\n+\t..."
    },
    {
      "sha": "71f6302ec4d00065916966b6672ea8cf5f5af981",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc-64.d",
      "status": "removed",
      "additions": 0,
      "deletions": 31,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4cfa9e3f28c8c5156b9773cc94192233947d351c/ld/testsuite/ld-powerpc/aix-tls-reloc-64.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4cfa9e3f28c8c5156b9773cc94192233947d351c/ld/testsuite/ld-powerpc/aix-tls-reloc-64.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc-64.d?ref=4cfa9e3f28c8c5156b9773cc94192233947d351c",
      "patch": "@@ -1,31 +0,0 @@\n-#source: aix-tls-reloc.s\n-#as: -a32\n-#ld: -b32 -shared -bE:aix-tls-reloc.ex\n-#objdump: -dr\n-#target: [is_xcoff_format]\n-\n-.*\n-\n-Disassembly of section \\.text:\n-\n-.* <\\.foo>:\n-.*:\te8 82 00 00 \tld      r4,0\\(r2\\)\n-.*: R_TOC\tgd-.*\n-.*:\te8 62 00 08 \tld      r3,8\\(r2\\)\n-.*: R_TOC\t.gd-.*\n-.*:\t48 00 00 03 \tbla     0 <\\.foo-.*>\n-.*: R_BA_26\t__tls_get_addr\n-.*:\te8 62 00 18 \tld      r3,24\\(r2\\)\n-.*: R_TOC\t_\\$TLSML-.*\n-.*:\t48 00 00 03 \tbla     0 <\\.foo-.*>\n-.*: R_BA_26\t__tls_get_mod\n-.*:\t80 82 00 10 \tlwz     r4,16\\(r2\\)\n-.*: R_TOC\tld-.*\n-.*:\t7c a3 22 14 \tadd     r5,r3,r4\n-.*:\te8 82 00 20 \tld      r4,32\\(r2\\)\n-.*: R_TOC\tie-.*\n-.*:\t7c a4 6a 14 \tadd     r5,r4,r13\n-.*:\te8 82 00 28 \tld      r4,40\\(r2\\)\n-.*: R_TOC\tle-.*\n-.*:\t7c a3 6a 14 \tadd     r5,r3,r13\n-.*"
    },
    {
      "sha": "dc0c48d1163e2063b9354afd22f9f418bce30554",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc-64.dd",
      "status": "added",
      "additions": 119,
      "deletions": 0,
      "changes": 119,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-64.dd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-64.dd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc-64.dd?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,119 @@\n+#source: aix-tls-reloc.s\n+#as: -a64\n+#ld: -b64 -shared -bE:aix-tls-reloc.ex\n+#objdump: -dr -j.data\n+#target: [is_xcoff_format]\n+\n+.*\n+\n+\n+Disassembly of section .data:\n+\n+.* <foo>:\n+.*\n+.*\n+.*\n+.*\n+.*\n+.*\n+.*\n+\n+.* <TOC>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS\ttdata_ext.*\n+.*:\tff ff 88 00 .*\n+\n+.* <.tdata_ext_gd>:\n+\t...\n+.*: R_TLSM\ttdata_ext.*\n+\n+.*<tdata_ext_ld>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LD\ttdata_ext.*\n+.*:\tff ff 88 00 .*\n+\n+.* <tdata_ext_ie>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_IE\ttdata_ext.*\n+.*:\tff ff 88 00 .*\n+\n+.* <tdata_ext_le>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LE\ttdata_ext.*\n+.*:\tff ff 88 00 .*\n+\n+.* <tdata_int1_gd>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS\ttdata_int_csect.*\n+.*:\tff ff 88 04 .*\n+\n+.* <.tdata_int1_gd>:\n+\t...\n+.*: R_TLSM\ttdata_int_csect.*\n+\n+.* <tdata_int1_ld>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LD\ttdata_int_csect.*\n+.*:\tff ff 88 04 .*\n+\n+.* <tdata_int1_ie>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_IE\ttdata_int_csect.*\n+.*:\tff ff 88 04 .*\n+\n+.* <tdata_int1_le>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LE\ttdata_int_csect.*\n+.*:\tff ff 88 04 .*\n+\n+.* <tdata_int2_gd>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS\ttdata_int_csect.*\n+.*:\tff ff 88 08 .*\n+\n+.* <.tdata_int2_gd>:\n+\t...\n+.*: R_TLSM\ttdata_int_csect.*\n+\n+.* <tdata_int2_ld>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LD\ttdata_int_csect.*\n+.*:\tff ff 88 08 .*\n+\n+.* <tdata_int2_ie>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_IE\ttdata_int_csect.*\n+.*:\tff ff 88 08 .*\n+\n+.* <tdata_int2_le>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LE\ttdata_int_csect.*\n+.*:\tff ff 88 08 .*\n+\n+.* <tbss_ext_gd>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS\ttbss_ext.*\n+.*:\tff ff 88 10 .*\n+\n+.* <.tbss_ext_gd>:\n+\t...\n+.*: R_TLSM\ttbss_ext.*\n+\n+.* <tbss_ext_ld>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LD\ttbss_ext.*\n+.*:\tff ff 88 10 .*\n+\n+.* <tbss_ext_ie>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_IE\ttbss_ext.*\n+.*:\tff ff 88 10 .*\n+\n+.* <tbss_ext_le>:\n+.*:\tff ff ff ff .*\n+.*: R_TLS_LE\ttbss_ext.*\n+.*:\tff ff 88 10 .*\n+\n+.* <_\\$TLSML>:\n+\t...\n+.*: R_TLSML\t_\\$TLSML.*"
    },
    {
      "sha": "9ddc5737e3a0e3193a1db2a5924a1e2ef208731f",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc-64.dt",
      "status": "added",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-64.dt",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc-64.dt",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc-64.dt?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -0,0 +1,23 @@\n+#source: aix-tls-reloc.s\n+#as: -a64\n+#ld: -b64 -shared -bE:aix-tls-reloc.ex\n+#objdump: -d -j.tdata -j.tbss\n+#target: [is_xcoff_format]\n+\n+.*\n+\n+\n+Disassembly of section .tdata:\n+\n+ffffffffffff8800 <tdata_ext>:\n+ffffffffffff8800:.*\n+\n+ffffffffffff8804 <tdata_int_csect>:\n+ffffffffffff8804:.*\n+ffffffffffff8808:.*\n+ffffffffffff880c:.*\n+\n+Disassembly of section .tbss:\n+\n+ffffffffffff8810 <tbss_ext>:\n+\t..."
    },
    {
      "sha": "062fc9498468bc9a153dcada5297046012991915",
      "filename": "ld/testsuite/ld-powerpc/aix-tls-reloc.s",
      "status": "modified",
      "additions": 118,
      "deletions": 36,
      "changes": 154,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix-tls-reloc.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix-tls-reloc.s?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -1,65 +1,147 @@\n-  .globl bar[TL]\n-  .csect bar[TL]\n+# An external tdata symbol\n+  .globl tdata_ext[TL]\n+  .csect tdata_ext[TL]\n   .long 1\n \n+  .csect tdata_int_csect[TL]\n+# A first internal tdata symbol\n+tdata_int1:\n+  .long 2\n+# A second internal tdata symbol\n+tdata_int2:\n+  .long 3\n+\n+# Two external tbss symbols.\n+# XCOFF doesn't seem to allow internal tbss\n+# (or bss) symbols.\n+  .comm tbss_ext[UL],8\n+\n   .toc\n-  .tc gd[TC],bar[TL]\n-  .tc .gd[TC],bar[TL]@m\n-  .tc ld[TC],bar[TL]@ld\n-  .tc mh[TC],mh[TC]@ml\n-  .tc ie[TC],bar[TL]@ie\n-  .tc le[TC],bar[TL]@le\n+# TC entries targeting the external tdata symbol\n+# Their value should be \"tdata_ext\" address,\n+# except TLSM value which must be 0.\n+# Their relocations should target it.\n+  .tc  tdata_ext_gd[TC],tdata_ext[TL]\n+  .tc .tdata_ext_gd[TC],tdata_ext[TL]@m\n+  .tc  tdata_ext_ld[TC],tdata_ext[TL]@ld\n+  .tc  tdata_ext_ie[TC],tdata_ext[TL]@ie\n+  .tc  tdata_ext_le[TC],tdata_ext[TL]@le\n \n-  .globl foo\n-  .globl .foo\n-  .csect foo[DS],3\n-foo:\n-  .if size == 32\n-  .long\t.foo, TOC[tc0], 0\n-  .else\n-  .llong .foo, TOC[tc0], 0\n-  .endif\n+# TC entries targeting internal tdata symbols.\n+# Their value should be \"tdata_int1\" or \"tdata_int2\"\n+# addresses, except TLSM value which must be 0.\n+# Their relocations should target \"tdata_int_csect\".\n+  .tc  tdata_int1_gd[TC],tdata_int1\n+  .tc .tdata_int1_gd[TC],tdata_int1@m\n+  .tc  tdata_int1_ld[TC],tdata_int1@ld\n+  .tc  tdata_int1_ie[TC],tdata_int1@ie\n+  .tc  tdata_int1_le[TC],tdata_int1@le\n+  .tc  tdata_int2_gd[TC],tdata_int2\n+  .tc .tdata_int2_gd[TC],tdata_int2@m\n+  .tc  tdata_int2_ld[TC],tdata_int2@ld\n+  .tc  tdata_int2_ie[TC],tdata_int2@ie\n+  .tc  tdata_int2_le[TC],tdata_int2@le\n \n-  .csect foo[PR]\n-.foo:\n-  #GD\n+# TC entries targeting the external tdata symbol\n+# Their value should be \"tbss_ext\" address,\n+# except TLSM value which must be 0.\n+# Their relocations should target \"tbss_ext\".\n+  .tc  tbss_ext_gd[TC],tbss_ext[UL]\n+  .tc .tbss_ext_gd[TC],tbss_ext[UL]@m\n+  .tc  tbss_ext_ld[TC],tbss_ext[UL]@ld\n+  .tc  tbss_ext_ie[TC],tbss_ext[UL]@ie\n+  .tc  tbss_ext_le[TC],tbss_ext[UL]@le\n+\n+# Module entry\n+  .tc  mh[TC],mh[TC]@ml\n+  .rename mh[TC], \"_$TLSML\" # Symbol for the module handle\n+\n+# Macros\n+  .macro gd_macro,sym\n   .if size == 32\n-  lwz 4, gd[TC](2)\n-  lwz 3, .gd[TC](2)\n+  lwz 4, \\sym\\()[TC](2)\n+  lwz 3, .\\sym\\()[TC](2)\n   .else\n-  ld 4, gd[TC](2)\n-  ld 3, .gd[TC](2)\n+  ld 4, \\sym\\()[TC](2)\n+  ld 3, .\\sym\\()[TC](2)\n   .endif\n   bla __tls_get_addr\n+  .endm\n \n-  #LD\n+  .macro ld_macro, sym\n   .if size == 32\n-  lwz 3, mh[TC](2)\n+  lwz 4, \\sym\\()[TC](2)\n   .else\n-  ld 3, mh[TC](2)\n+  ld 4, \\sym\\()[TC](2)\n   .endif\n-  bla __tls_get_mod\n-  lwz 4, ld[TC](2)\n   add 5,3,4\n+  .endm\n \n-  #IE\n+  .macro ie_macro, sym\n   .if size == 32\n   bla __get_tpointer\n-  lwz 4, ie[TC](2)\n+  lwz 4, \\sym\\()[TC](2)\n   add 5,3,4\n   .else\n-  ld 4, ie[TC](2)\n+  ld 4, \\sym\\()[TC](2)\n   add 5,4,13\n   .endif\n+  .endm\n \n-  #LE\n+  .macro le_macro, sym\n   .if size == 32\n   bla __get_tpointer\n-  lwz 4, le[TC](2)\n+  lwz 4, \\sym\\()[TC](2)\n   add 5,3,4\n   .else\n-  ld 4, le[TC](2)\n+  ld 4, \\sym\\()[TC](2)\n   add 5,3,13\n   .endif\n+  .endm\n+\n+\n+# As TLS relocations are made in for TC symbols,\n+# this function only aims to avoid garbage collection\n+# of these symbols, especially hidden ones.\n+  .globl foo\n+  .globl .foo\n+  .csect foo[DS],3\n+foo:\n+  .if size == 32\n+  .long\t.foo, TOC[tc0], 0\n+  .else\n+  .llong .foo, TOC[tc0], 0\n+  .endif\n+\n+  .csect foo[PR]\n+.foo:\n+  # External syms\n+  #GD\n+  gd_macro tdata_ext_gd\n+  gd_macro tdata_int1_gd\n+  gd_macro tdata_int2_gd\n+  gd_macro tbss_ext_gd\n+\n+  #LD\n+  .if size == 32\n+  lwz 3, mh[TC](2)\n+  .else\n+  ld 3, mh[TC](2)\n+  .endif\n+  bla __tls_get_mod\n+  ld_macro tdata_ext_ld\n+  ld_macro tdata_int1_ld\n+  ld_macro tdata_int2_ld\n+  ld_macro tbss_ext_ld\n \n-.rename mh[TC], \"_$TLSML\" # Symbol for the module handle\n+  #IE\n+  ie_macro tdata_ext_ie\n+  ie_macro tdata_int1_ie\n+  ie_macro tdata_int2_ie\n+  ie_macro tbss_ext_ie\n+\n+  #LE\n+  le_macro tdata_ext_le\n+  le_macro tdata_int1_le\n+  le_macro tdata_int2_le\n+  le_macro tbss_ext_le"
    },
    {
      "sha": "b49f3f5e1cf50c82b930000aa9825ee002297283",
      "filename": "ld/testsuite/ld-powerpc/aix52.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix52.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c5038247c8a5fcff18fd81249b0801a95569939/ld/testsuite/ld-powerpc/aix52.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/aix52.exp?ref=3c5038247c8a5fcff18fd81249b0801a95569939",
      "patch": "@@ -284,7 +284,8 @@ set aix7tests {\n \n     {\"TLS relocations\" \"-shared -bE:aix-tls-reloc.ex\"\n \t\"\" {aix-tls-reloc.s}\n-\t{{objdump -dr aix-tls-reloc-SIZE.d}}\n+\t{{objdump {-dr -j.data} aix-tls-reloc-SIZE.dd}\n+\t {objdump {-dr -j.tdata -j.tbss} aix-tls-reloc-SIZE.dt}}\n \t\"aix-tls-reloc.so\"}\n \n     {\"TLS section\" \"-shared -bE:aix-tls-section.ex\""
    }
  ]
}