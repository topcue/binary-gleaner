{
  "sha": "ff8885c3be6f42ed90a7b0ec0028fad26861cd94",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmY4ODg1YzNiZTZmNDJlZDkwYTdiMGVjMDAyOGZhZDI2ODYxY2Q5NA==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-04-27T13:19:48Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-04-27T13:28:03Z"
    },
    "message": "gdbsupport: include cstdlib in common-defs.h\n\nIn PR 25731 [1], the following build failure was reported:\n\n    ../../binutils-gdb/gdb/gdbtypes.c:1254:10: error: no member named 'abs' in namespace 'std'; did you mean simply 'abs'?\n                = ((std::abs (stride) * element_count) + 7) / 8;\n                    ^~~~~~~~\n                    abs\n    /usr/include/stdlib.h:129:6: note: 'abs' declared here\n    int      abs(int) __pure2;\n             ^\nThe original report was using:\n\n    $ gcc -v\n    Apple LLVM version 8.0.0 (clang-800.0.42.1)\n    Target: x86_64-apple-darwin15.6.0\n\nNote that I was _not_ able to reproduce using:\n\n    $ g++ --version\n    Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/c++/4.2.1\n    Apple clang version 11.0.0 (clang-1100.0.33.17)\n    Target: x86_64-apple-darwin19.3.0\n\nThe proposed fix is to include <cstdlib> in addition to <stdlib.h>.\n\nHere's an excerpt of [2] relevant to this problem:\n\n    These headers [speaking of the .h form] are allowed to also declare\n    the same names in the std namespace, and the corresponding cxxx\n    headers are allowed to also declare the same names in the global\n    namespace: including <cstdlib> definitely provides std::malloc and\n    may also provide ::malloc.  Including <stdlib.h> definitely provides\n    ::malloc and may also provide std::malloc\n\nSince we use std::abs, we should not assume that our include of stdlib.h\ndeclares an `abs` function in the `std` namespace.\n\nIf we replace the include of stdlib.h with cstdlib, then we fall in the\nopposite situation.  A standard C++ library may decide to only put the\ndeclarations in the std namespace, requiring us to prefix all standard\nfunctions with `std::`.  I'm not against that, but for the moment I think the\nsafest way forward is to just include both.\n\nNote that I don't know what effect this patch can have on any stdlib.h fix\nprovided by gnulib.\n\n[1] https://sourceware.org/bugzilla/show_bug.cgi?id=25731\n[2] https://en.cppreference.com/w/cpp/header#C_compatibility_headers\n\ngdbsupport/ChangeLog:\n\n\t* common-defs.h: Include cstdlib.h.",
    "tree": {
      "sha": "419f5a2ef886df5232c07ea1dc38deee0c15244d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/419f5a2ef886df5232c07ea1dc38deee0c15244d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ff8885c3be6f42ed90a7b0ec0028fad26861cd94",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ff8885c3be6f42ed90a7b0ec0028fad26861cd94",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ff8885c3be6f42ed90a7b0ec0028fad26861cd94",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ff8885c3be6f42ed90a7b0ec0028fad26861cd94/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "991a3e2e9944a4b3a27bd989ac03c18285bd545d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/991a3e2e9944a4b3a27bd989ac03c18285bd545d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/991a3e2e9944a4b3a27bd989ac03c18285bd545d"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 9,
    "deletions": 0
  },
  "files": [
    {
      "sha": "b071049ae73b975e6b1168872476513d1f67432b",
      "filename": "gdbsupport/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ff8885c3be6f42ed90a7b0ec0028fad26861cd94/gdbsupport/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ff8885c3be6f42ed90a7b0ec0028fad26861cd94/gdbsupport/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/ChangeLog?ref=ff8885c3be6f42ed90a7b0ec0028fad26861cd94",
      "patch": "@@ -1,3 +1,7 @@\n+2020-04-27  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* common-defs.h: Include cstdlib.h.\n+\n 2020-04-20  Tom Tromey  <tromey@adacore.com>\n \n \t* scoped_mmap.h (scoped_mmap): Mark move constructor as noexcept."
    },
    {
      "sha": "d3f5eafa4555fb014d2f9140127a6fb846d6574c",
      "filename": "gdbsupport/common-defs.h",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ff8885c3be6f42ed90a7b0ec0028fad26861cd94/gdbsupport/common-defs.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ff8885c3be6f42ed90a7b0ec0028fad26861cd94/gdbsupport/common-defs.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/common-defs.h?ref=ff8885c3be6f42ed90a7b0ec0028fad26861cd94",
      "patch": "@@ -84,7 +84,12 @@\n \n #include <stdarg.h>\n #include <stdio.h>\n+\n+/* Include both cstdlib and stdlib.h to ensure we have standard functions\n+   defined both in the std:: namespace and in the global namespace.  */\n+#include <cstdlib>\n #include <stdlib.h>\n+\n #include <stddef.h>\n #include <stdint.h>\n #include <string.h>"
    }
  ]
}