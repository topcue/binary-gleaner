{
  "sha": "a788aedd86da983faf0afef3cb41461118a2e9f2",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTc4OGFlZGQ4NmRhOTgzZmFmMGFmZWYzY2I0MTQ2MTExOGEyZTlmMg==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-01-13T12:00:46Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-01-13T12:15:36Z"
    },
    "message": "PR23560, PR23561, readelf memory leaks\n\n\tPR 23560\n\tPR 23561\n\t* dwarf.c (display_debug_frames): Move fde_fc earlier.  Free\n\tfde_fc col_type and col_offset.\n\t* readelf.c (apply_relocations): Move symsec check earlier.\n\t(free_debug_section): Free reloc_info.\n\t(process_notes_at): Free pnotes on error path.\n\t(process_object): Free dump_sects here..\n\t(process_archive): ..not here.",
    "tree": {
      "sha": "013d34de70329b9930b0b8f46f1418b32803c7a3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/013d34de70329b9930b0b8f46f1418b32803c7a3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a788aedd86da983faf0afef3cb41461118a2e9f2",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a788aedd86da983faf0afef3cb41461118a2e9f2",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a788aedd86da983faf0afef3cb41461118a2e9f2",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a788aedd86da983faf0afef3cb41461118a2e9f2/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "805f38bc551de820bcd7b31d3c5731ae27cf853a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/805f38bc551de820bcd7b31d3c5731ae27cf853a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/805f38bc551de820bcd7b31d3c5731ae27cf853a"
    }
  ],
  "stats": {
    "total": 56,
    "additions": 44,
    "deletions": 12
  },
  "files": [
    {
      "sha": "c1f6d348f16f2d3d6e3b51d33c9357de6d932cdb",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a788aedd86da983faf0afef3cb41461118a2e9f2/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a788aedd86da983faf0afef3cb41461118a2e9f2/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=a788aedd86da983faf0afef3cb41461118a2e9f2",
      "patch": "@@ -1,3 +1,15 @@\n+2020-01-13  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 23560\n+\tPR 23561\n+\t* dwarf.c (display_debug_frames): Move fde_fc earlier.  Free\n+\tfde_fc col_type and col_offset.\n+\t* readelf.c (apply_relocations): Move symsec check earlier.\n+\t(free_debug_section): Free reloc_info.\n+\t(process_notes_at): Free pnotes on error path.\n+\t(process_object): Free dump_sects here..\n+\t(process_archive): ..not here.\n+\n 2020-01-13  Alan Modra  <amodra@gmail.com>\n \n \tPR 25362"
    },
    {
      "sha": "35842f74b2ed2b34002553e7bf505f88ea3a49f3",
      "filename": "binutils/dwarf.c",
      "status": "modified",
      "additions": 12,
      "deletions": 1,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a788aedd86da983faf0afef3cb41461118a2e9f2/binutils/dwarf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a788aedd86da983faf0afef3cb41461118a2e9f2/binutils/dwarf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dwarf.c?ref=a788aedd86da983faf0afef3cb41461118a2e9f2",
      "patch": "@@ -7801,6 +7801,7 @@ display_debug_frames (struct dwarf_section *section,\n       unsigned int offset_size;\n       unsigned int initial_length_size;\n       bfd_boolean all_nops;\n+      static Frame_Chunk fde_fc;\n \n       saved_start = start;\n \n@@ -7898,7 +7899,6 @@ display_debug_frames (struct dwarf_section *section,\n       else\n \t{\n \t  unsigned char *look_for;\n-\t  static Frame_Chunk fde_fc;\n \t  unsigned long segment_selector;\n \n \t  if (is_eh)\n@@ -8705,6 +8705,17 @@ display_debug_frames (struct dwarf_section *section,\n       if (do_debug_frames_interp && ! all_nops)\n \tframe_display_row (fc, &need_col_headers, &max_regs);\n \n+      if (fde_fc.col_type != NULL)\n+\t{\n+\t  free (fde_fc.col_type);\n+\t  fde_fc.col_type = NULL;\n+\t}\n+      if (fde_fc.col_offset != NULL)\n+\t{\n+\t  free (fde_fc.col_offset);\n+\t  fde_fc.col_offset = NULL;\n+\t}\n+\n       start = block_end;\n       eh_addr_size = saved_eh_addr_size;\n     }"
    },
    {
      "sha": "6b5bebe743f34a9ebeeb85943fbbcb87757bcba2",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 20,
      "deletions": 11,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a788aedd86da983faf0afef3cb41461118a2e9f2/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a788aedd86da983faf0afef3cb41461118a2e9f2/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=a788aedd86da983faf0afef3cb41461118a2e9f2",
      "patch": "@@ -13333,6 +13333,11 @@ apply_relocations (Filedata *                 filedata,\n \t  || relsec->sh_link >= filedata->file_header.e_shnum)\n \tcontinue;\n \n+      symsec = filedata->section_headers + relsec->sh_link;\n+      if (symsec->sh_type != SHT_SYMTAB\n+\t  && symsec->sh_type != SHT_DYNSYM)\n+\treturn FALSE;\n+\n       is_rela = relsec->sh_type == SHT_RELA;\n \n       if (is_rela)\n@@ -13352,10 +13357,6 @@ apply_relocations (Filedata *                 filedata,\n       if (filedata->file_header.e_machine == EM_SH)\n \tis_rela = FALSE;\n \n-      symsec = filedata->section_headers + relsec->sh_link;\n-      if (symsec->sh_type != SHT_SYMTAB\n-\t  && symsec->sh_type != SHT_DYNSYM)\n-\treturn FALSE;\n       symtab = GET_ELF_SYMBOLS (filedata, symsec, & num_syms);\n \n       for (rp = relocs; rp < relocs + num_relocs; ++rp)\n@@ -14395,6 +14396,13 @@ free_debug_section (enum dwarf_section_display_enum debug)\n   section->start = NULL;\n   section->address = 0;\n   section->size = 0;\n+\n+  if (section->reloc_info != NULL)\n+    {\n+      free (section->reloc_info);\n+      section->reloc_info = NULL;\n+      section->num_relocs = 0;\n+    }\n }\n \n static bfd_boolean\n@@ -19341,6 +19349,7 @@ process_notes_at (Filedata *           filedata,\n     {\n       warn (_(\"Corrupt note: alignment %ld, expecting 4 or 8\\n\"),\n \t    (long) align);\n+      free (pnotes);\n       return FALSE;\n     }\n \n@@ -20011,6 +20020,13 @@ process_object (Filedata * filedata)\n   filedata->string_table = NULL;\n   filedata->string_table_length = 0;\n \n+  if (filedata->dump_sects != NULL)\n+    {\n+      free (filedata->dump_sects);\n+      filedata->dump_sects = NULL;\n+      filedata->num_dump_sects = 0;\n+    }\n+\n   if (dynamic_strings)\n     {\n       free (dynamic_strings);\n@@ -20316,13 +20332,6 @@ process_archive (Filedata * filedata, bfd_boolean is_thin_archive)\n \t    ret = FALSE;\n         }\n \n-      if (filedata->dump_sects != NULL)\n-\t{\n-\t  free (filedata->dump_sects);\n-\t  filedata->dump_sects = NULL;\n-\t  filedata->num_dump_sects = 0;\n-\t}\n-\n       free (qualified_name);\n     }\n "
    }
  ]
}