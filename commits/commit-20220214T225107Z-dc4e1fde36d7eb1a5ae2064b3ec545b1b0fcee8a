{
  "sha": "dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
  "node_id": "C_kwDOANOeidoAKGRjNGUxZmRlMzZkN2ViMWE1YWUyMDY0YjNlYzU0NWIxYjBmY2VlOGE",
  "commit": {
    "author": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@axis.com",
      "date": "2022-02-14T22:51:07Z"
    },
    "committer": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@bitrange.com",
      "date": "2022-02-14T22:51:07Z"
    },
    "message": "sim: Fix use of out-of-tree assembler and linker when testing\n\nWith commit 7a259895bb2d \"sim: testsuite: expand arch specific\ntoolchain settings\", trying to use out-of-tree ld and as at test-time\nbroke for the \"primary target\", like when testing a release-tarball.\n\nSubsequent to that commit, all assembler tests without in-tree-built\ntools FAIL, getting errors when trying to call\n$(abs_builddir)/../gas/as-new.  But, that isn't the actual culprint;\nit's actually it's its immediate predecessor, commit 8996c21067373\n\"sim: testsuite: setup per-port toolchain settings for multitarget\nbuild\", which hardcodes in-tree-paths to those tools instead of\nconsidering e.g. $(<X>_FOR_TARGET), the preferred overridable variable\nfor single-target builds, as set up by the toplevel Makefile.\n\nThis commit calls GCC_TARGET_TOOL (a deceptive name; gcc-specific\nfeatures aren't used) from toplev/config/acx.m4, somewhat like calls\nin toplev/configure.ac but without the NCN_STRICT_CHECK_TARGET_TOOLS\nstep, for each X to find a value for $(<X>_FOR_TARGET).  N.B.: in-tree\ntools still override any ${target}-${tool} found in $PATH, i.e. only\npreviously broken builds are affected.\n\nThe variables $(<X>_FOR_TARGET) are usually overridden by the toplevel\nMakefile to the same value or better, but has to be set here too, as\nautomake \"wants\" Makefiles to be self-contained (you get an error\npointing out that the variable may be empty).  If it hadn't been for\nthat, SIM_AC_CHECK_TOOLCHAIN_FOR_PRIMARY_TARGET would not be needed.\nThis detail should only (positively) affect users invoking \"make\ncheck\" in sim/ instead of \"make check-sim\" (or \"make check\") at the\ntoplevel.  Now the output from \"configure\" matches the target tools\nactually used by sim at test-time, for the \"primary target\".\n\nUsing $(CC) for \"example-\" targets CC_FOR_TARGET is not changed, as\nthat appears to be a deliberate special-case.\n\nNote that all tools still have to be installed and present in\n$PATH at configure-time to be properly used at test-time.\n\nsim:\n\t* m4/sim_ac_toolchain.m4 (SIM_AC_CHECK_TOOLCHAIN_FOR_PRIMARY_TARGET):\n\tNew defun.\n\t(SIM_TOOLCHAIN_VARS): Call it using AC_REQUIRE, and use variables\n\tAS_FOR_TARGET, LD_FOR_TARGET and CC_FOR_TARGET instead of hard-coded\n\tvalues.\n\t* Makefile.in, configure: Regenerate.",
    "tree": {
      "sha": "b4496b7208674f7e39c00a8c2b69bda7b44b29c3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b4496b7208674f7e39c00a8c2b69bda7b44b29c3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/comments",
  "author": {
    "login": "hpataxisdotcom",
    "id": 80339731,
    "node_id": "MDQ6VXNlcjgwMzM5NzMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hpataxisdotcom",
    "html_url": "https://github.com/hpataxisdotcom",
    "followers_url": "https://api.github.com/users/hpataxisdotcom/followers",
    "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}",
    "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions",
    "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs",
    "repos_url": "https://api.github.com/users/hpataxisdotcom/repos",
    "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": null,
  "parents": [
    {
      "sha": "e7e980c6fa1205495ec66741da916f0b25941963",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e7e980c6fa1205495ec66741da916f0b25941963",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e7e980c6fa1205495ec66741da916f0b25941963"
    }
  ],
  "stats": {
    "total": 384,
    "additions": 278,
    "deletions": 106
  },
  "files": [
    {
      "sha": "49a3c0b80dbfca41a349b6030eaf440f8cf63c04",
      "filename": "sim/Makefile.in",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/sim/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/sim/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/Makefile.in?ref=dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
      "patch": "@@ -1,7 +1,7 @@\n # Makefile.in generated by automake 1.15.1 from Makefile.am.\n # @configure_input@\n \n-# Copyright (C) 1994-2022 Free Software Foundation, Inc.\n+# Copyright (C) 1994-2017 Free Software Foundation, Inc.\n \n # This Makefile.in is free software; the Free Software Foundation\n # gives unlimited permission to copy and/or distribute it,\n@@ -14,7 +14,7 @@\n \n @SET_MAKE@\n \n-#   Copyright (C) 1993-2021 Free Software Foundation, Inc.\n+#   Copyright (C) 1993-2022 Free Software Foundation, Inc.\n #\n # This program is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -652,6 +652,7 @@ AMTAR = @AMTAR@\n AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@\n AR = @AR@\n AR_FOR_BUILD = @AR_FOR_BUILD@\n+AS_FOR_TARGET = @AS_FOR_TARGET@\n AS_FOR_TARGET_AARCH64 = @AS_FOR_TARGET_AARCH64@\n AS_FOR_TARGET_ARM = @AS_FOR_TARGET_ARM@\n AS_FOR_TARGET_AVR = @AS_FOR_TARGET_AVR@\n@@ -693,6 +694,7 @@ CATOBJEXT = @CATOBJEXT@\n CC = @CC@\n CCDEPMODE = @CCDEPMODE@\n CC_FOR_BUILD = @CC_FOR_BUILD@\n+CC_FOR_TARGET = @CC_FOR_TARGET@\n CC_FOR_TARGET_AARCH64 = @CC_FOR_TARGET_AARCH64@\n CC_FOR_TARGET_ARM = @CC_FOR_TARGET_ARM@\n CC_FOR_TARGET_AVR = @CC_FOR_TARGET_AVR@\n@@ -757,6 +759,7 @@ INSTOBJEXT = @INSTOBJEXT@\n LD = @LD@\n LDFLAGS = @LDFLAGS@\n LDFLAGS_FOR_BUILD = @LDFLAGS_FOR_BUILD@\n+LD_FOR_TARGET = @LD_FOR_TARGET@\n LD_FOR_TARGET_AARCH64 = @LD_FOR_TARGET_AARCH64@\n LD_FOR_TARGET_ARM = @LD_FOR_TARGET_ARM@\n LD_FOR_TARGET_AVR = @LD_FOR_TARGET_AVR@"
    },
    {
      "sha": "019c2f41cf4227c23477f74a809ce05cc0d2290b",
      "filename": "sim/configure",
      "status": "modified",
      "additions": 259,
      "deletions": 97,
      "changes": 356,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/sim/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/sim/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/configure?ref=dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
      "patch": "@@ -813,6 +813,9 @@ SIM_ENABLE_ARCH_aarch64_TRUE\n CC_FOR_TARGET_AARCH64\n LD_FOR_TARGET_AARCH64\n AS_FOR_TARGET_AARCH64\n+LD_FOR_TARGET\n+AS_FOR_TARGET\n+CC_FOR_TARGET\n SIM_COMMON_BUILD_FALSE\n SIM_COMMON_BUILD_TRUE\n SIM_SUBDIRS\n@@ -12632,7 +12635,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12635 \"configure\"\n+#line 12638 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -12738,7 +12741,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12741 \"configure\"\n+#line 12744 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -14395,13 +14398,141 @@ if test \"${enable_sim}\" != no; then\n \n       ;;\n   esac\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: checking where to find the target cc\" >&5\n+$as_echo_n \"checking where to find the target cc... \" >&6; }\n+if test \"x${build}\" != \"x${host}\" ; then\n+  if expr \"x$CC_FOR_TARGET\" : \"x/\" > /dev/null; then\n+    # We already found the complete path\n+    ac_dir=`dirname $CC_FOR_TARGET`\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed in $ac_dir\" >&5\n+$as_echo \"pre-installed in $ac_dir\" >&6; }\n+  else\n+    # Canadian cross, just use what we found\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed\" >&5\n+$as_echo \"pre-installed\" >&6; }\n+  fi\n+else\n+  ok=yes\n+  case \" ${configdirs} \" in\n+    *\" ${target_alias}-gcc \"*) ;;\n+    *) ok=no ;;\n+  esac\n+\n+  if test $ok = yes; then\n+    # An in-tree tool is available and we can use it\n+    CC_FOR_TARGET='$$r/$(HOST_SUBDIR)/${target_alias}-gcc'\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: just compiled\" >&5\n+$as_echo \"just compiled\" >&6; }\n+  elif expr \"x$CC_FOR_TARGET\" : \"x/\" > /dev/null; then\n+    # We already found the complete path\n+    ac_dir=`dirname $CC_FOR_TARGET`\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed in $ac_dir\" >&5\n+$as_echo \"pre-installed in $ac_dir\" >&6; }\n+  elif test \"x$target\" = \"x$host\"; then\n+    # We can use an host tool\n+    CC_FOR_TARGET='$(CC)'\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: host tool\" >&5\n+$as_echo \"host tool\" >&6; }\n+  else\n+    # We need a cross tool\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed\" >&5\n+$as_echo \"pre-installed\" >&6; }\n+  fi\n+fi\n+\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking where to find the target as\" >&5\n+$as_echo_n \"checking where to find the target as... \" >&6; }\n+if test \"x${build}\" != \"x${host}\" ; then\n+  if expr \"x$AS_FOR_TARGET\" : \"x/\" > /dev/null; then\n+    # We already found the complete path\n+    ac_dir=`dirname $AS_FOR_TARGET`\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed in $ac_dir\" >&5\n+$as_echo \"pre-installed in $ac_dir\" >&6; }\n+  else\n+    # Canadian cross, just use what we found\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed\" >&5\n+$as_echo \"pre-installed\" >&6; }\n+  fi\n+else\n+  ok=yes\n+  case \" ${configdirs} \" in\n+    *\" \\$(abs_builddir) \"*) ;;\n+    *) ok=no ;;\n+  esac\n+\n+  if test $ok = yes; then\n+    # An in-tree tool is available and we can use it\n+    AS_FOR_TARGET='$$r/$(HOST_SUBDIR)/\\$(abs_builddir)/../gas/as-new'\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: just compiled\" >&5\n+$as_echo \"just compiled\" >&6; }\n+  elif expr \"x$AS_FOR_TARGET\" : \"x/\" > /dev/null; then\n+    # We already found the complete path\n+    ac_dir=`dirname $AS_FOR_TARGET`\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed in $ac_dir\" >&5\n+$as_echo \"pre-installed in $ac_dir\" >&6; }\n+  elif test \"x$target\" = \"x$host\"; then\n+    # We can use an host tool\n+    AS_FOR_TARGET='$(AS)'\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: host tool\" >&5\n+$as_echo \"host tool\" >&6; }\n+  else\n+    # We need a cross tool\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed\" >&5\n+$as_echo \"pre-installed\" >&6; }\n+  fi\n+fi\n+\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking where to find the target ld\" >&5\n+$as_echo_n \"checking where to find the target ld... \" >&6; }\n+if test \"x${build}\" != \"x${host}\" ; then\n+  if expr \"x$LD_FOR_TARGET\" : \"x/\" > /dev/null; then\n+    # We already found the complete path\n+    ac_dir=`dirname $LD_FOR_TARGET`\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed in $ac_dir\" >&5\n+$as_echo \"pre-installed in $ac_dir\" >&6; }\n+  else\n+    # Canadian cross, just use what we found\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed\" >&5\n+$as_echo \"pre-installed\" >&6; }\n+  fi\n+else\n+  ok=yes\n+  case \" ${configdirs} \" in\n+    *\" \\$(abs_builddir) \"*) ;;\n+    *) ok=no ;;\n+  esac\n+\n+  if test $ok = yes; then\n+    # An in-tree tool is available and we can use it\n+    LD_FOR_TARGET='$$r/$(HOST_SUBDIR)/\\$(abs_builddir)/../ld/ld-new'\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: just compiled\" >&5\n+$as_echo \"just compiled\" >&6; }\n+  elif expr \"x$LD_FOR_TARGET\" : \"x/\" > /dev/null; then\n+    # We already found the complete path\n+    ac_dir=`dirname $LD_FOR_TARGET`\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed in $ac_dir\" >&5\n+$as_echo \"pre-installed in $ac_dir\" >&6; }\n+  elif test \"x$target\" = \"x$host\"; then\n+    # We can use an host tool\n+    LD_FOR_TARGET='$(LD)'\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: host tool\" >&5\n+$as_echo \"host tool\" >&6; }\n+  else\n+    # We need a cross tool\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: pre-installed\" >&5\n+$as_echo \"pre-installed\" >&6; }\n+  fi\n+fi\n+\n+\n+\n \n \n \n   if test \"$SIM_PRIMARY_TARGET\" = \"aarch64\"; then :\n-      : \"${AS_FOR_TARGET_AARCH64:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_AARCH64:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_AARCH64:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_AARCH64:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_AARCH64:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_AARCH64:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14438,10 +14569,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"arm\"; then :\n-      : \"${AS_FOR_TARGET_ARM:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_ARM:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_ARM:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_ARM:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_ARM:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_ARM:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14478,10 +14610,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"avr\"; then :\n-      : \"${AS_FOR_TARGET_AVR:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_AVR:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_AVR:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_AVR:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_AVR:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_AVR:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14518,10 +14651,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"bfin\"; then :\n-      : \"${AS_FOR_TARGET_BFIN:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_BFIN:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_BFIN:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_BFIN:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_BFIN:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_BFIN:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14557,10 +14691,11 @@ subdirs=\"$subdirs bpf\"\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"bpf\"; then :\n-      : \"${AS_FOR_TARGET_BPF:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_BPF:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_BPF:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_BPF:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_BPF:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_BPF:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14597,10 +14732,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"cr16\"; then :\n-      : \"${AS_FOR_TARGET_CR16:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_CR16:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_CR16:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_CR16:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_CR16:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_CR16:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14637,10 +14773,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"cris\"; then :\n-      : \"${AS_FOR_TARGET_CRIS:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_CRIS:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_CRIS:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_CRIS:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_CRIS:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_CRIS:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14677,10 +14814,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"d10v\"; then :\n-      : \"${AS_FOR_TARGET_D10V:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_D10V:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_D10V:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_D10V:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_D10V:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_D10V:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14717,10 +14855,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"frv\"; then :\n-      : \"${AS_FOR_TARGET_FRV:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_FRV:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_FRV:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_FRV:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_FRV:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_FRV:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14757,10 +14896,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"ft32\"; then :\n-      : \"${AS_FOR_TARGET_FT32:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_FT32:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_FT32:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_FT32:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_FT32:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_FT32:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14797,10 +14937,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"h8300\"; then :\n-      : \"${AS_FOR_TARGET_H8300:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_H8300:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_H8300:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_H8300:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_H8300:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_H8300:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14837,10 +14978,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"iq2000\"; then :\n-      : \"${AS_FOR_TARGET_IQ2000:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_IQ2000:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_IQ2000:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_IQ2000:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_IQ2000:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_IQ2000:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14877,10 +15019,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"lm32\"; then :\n-      : \"${AS_FOR_TARGET_LM32:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_LM32:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_LM32:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_LM32:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_LM32:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_LM32:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14917,10 +15060,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"m32c\"; then :\n-      : \"${AS_FOR_TARGET_M32C:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_M32C:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_M32C:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_M32C:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_M32C:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_M32C:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14957,10 +15101,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"m32r\"; then :\n-      : \"${AS_FOR_TARGET_M32R:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_M32R:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_M32R:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_M32R:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_M32R:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_M32R:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -14997,10 +15142,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"m68hc11\"; then :\n-      : \"${AS_FOR_TARGET_M68HC11:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_M68HC11:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_M68HC11:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_M68HC11:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_M68HC11:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_M68HC11:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15037,10 +15183,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"mcore\"; then :\n-      : \"${AS_FOR_TARGET_MCORE:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_MCORE:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_MCORE:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_MCORE:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_MCORE:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_MCORE:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15077,10 +15224,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"microblaze\"; then :\n-      : \"${AS_FOR_TARGET_MICROBLAZE:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_MICROBLAZE:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_MICROBLAZE:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_MICROBLAZE:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_MICROBLAZE:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_MICROBLAZE:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15114,10 +15262,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"mips\"; then :\n-      : \"${AS_FOR_TARGET_MIPS:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_MIPS:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_MIPS:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_MIPS:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_MIPS:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_MIPS:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15151,10 +15300,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"mn10300\"; then :\n-      : \"${AS_FOR_TARGET_MN10300:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_MN10300:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_MN10300:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_MN10300:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_MN10300:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_MN10300:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15191,10 +15341,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"moxie\"; then :\n-      : \"${AS_FOR_TARGET_MOXIE:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_MOXIE:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_MOXIE:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_MOXIE:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_MOXIE:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_MOXIE:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15231,10 +15382,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"msp430\"; then :\n-      : \"${AS_FOR_TARGET_MSP430:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_MSP430:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_MSP430:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_MSP430:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_MSP430:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_MSP430:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15268,10 +15420,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"or1k\"; then :\n-      : \"${AS_FOR_TARGET_OR1K:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_OR1K:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_OR1K:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_OR1K:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_OR1K:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_OR1K:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15305,10 +15458,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"ppc\"; then :\n-      : \"${AS_FOR_TARGET_PPC:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_PPC:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_PPC:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_PPC:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_PPC:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_PPC:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15345,10 +15499,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"pru\"; then :\n-      : \"${AS_FOR_TARGET_PRU:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_PRU:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_PRU:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_PRU:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_PRU:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_PRU:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15382,10 +15537,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"riscv\"; then :\n-      : \"${AS_FOR_TARGET_RISCV:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_RISCV:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_RISCV:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_RISCV:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_RISCV:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_RISCV:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15422,10 +15578,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"rl78\"; then :\n-      : \"${AS_FOR_TARGET_RL78:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_RL78:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_RL78:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_RL78:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_RL78:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_RL78:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15462,10 +15619,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"rx\"; then :\n-      : \"${AS_FOR_TARGET_RX:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_RX:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_RX:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_RX:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_RX:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_RX:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15502,10 +15660,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"sh\"; then :\n-      : \"${AS_FOR_TARGET_SH:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_SH:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_SH:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_SH:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_SH:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_SH:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15542,10 +15701,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"erc32\"; then :\n-      : \"${AS_FOR_TARGET_ERC32:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_ERC32:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_ERC32:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_ERC32:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_ERC32:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_ERC32:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15579,10 +15739,11 @@ fi\n \n \n \n+\n   if test \"$SIM_PRIMARY_TARGET\" = \"v850\"; then :\n-      : \"${AS_FOR_TARGET_V850:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_V850:=\\$(abs_builddir)/../ld/ld-new}\"\n-            : \"${CC_FOR_TARGET_V850:=${target_alias}-gcc}\"\n+      : \"${AS_FOR_TARGET_V850:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_V850:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_V850:=\\$(CC_FOR_TARGET)}\"\n \n fi\n \n@@ -15603,8 +15764,9 @@ fi\n \n \n \n-  : \"${AS_FOR_TARGET_EXAMPLE_SYNACOR:=\\$(abs_builddir)/../gas/as-new}\"\n-  : \"${LD_FOR_TARGET_EXAMPLE_SYNACOR:=\\$(abs_builddir)/../ld/ld-new}\"\n+\n+  : \"${AS_FOR_TARGET_EXAMPLE_SYNACOR:=\\$(AS_FOR_TARGET)}\"\n+  : \"${LD_FOR_TARGET_EXAMPLE_SYNACOR:=\\$(LD_FOR_TARGET)}\"\n   : \"${CC_FOR_TARGET_EXAMPLE_SYNACOR:=\\$(CC)}\"\n \n as_fn_append SIM_TOOLCHAIN_VARS \" AS_FOR_TARGET_EXAMPLE_SYNACOR LD_FOR_TARGET_EXAMPLE_SYNACOR CC_FOR_TARGET_EXAMPLE_SYNACOR\""
    },
    {
      "sha": "74532142929cce38990f7534a2b5a477e0f9178e",
      "filename": "sim/m4/sim_ac_toolchain.m4",
      "status": "modified",
      "additions": 14,
      "deletions": 7,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/sim/m4/sim_ac_toolchain.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a/sim/m4/sim_ac_toolchain.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m4/sim_ac_toolchain.m4?ref=dc4e1fde36d7eb1a5ae2064b3ec545b1b0fcee8a",
      "patch": "@@ -78,24 +78,31 @@ AC_COMPILE_IFELSE([AC_LANG_SOURCE([\n AC_SUBST(C_DIALECT)\n ])\n dnl\n+\n+AC_DEFUN([SIM_AC_CHECK_TOOLCHAIN_FOR_PRIMARY_TARGET],\n+[dnl\n+GCC_TARGET_TOOL([cc], [CC_FOR_TARGET], [CC], [${target_alias}-gcc])\n+GCC_TARGET_TOOL([as], [AS_FOR_TARGET], [AS], [\\$(abs_builddir)/../gas/as-new])\n+GCC_TARGET_TOOL([ld], [LD_FOR_TARGET], [LD], [\\$(abs_builddir)/../ld/ld-new])\n+])\n+\n SIM_TOOLCHAIN_VARS=\n AC_SUBST(SIM_TOOLCHAIN_VARS)\n AC_DEFUN([_SIM_AC_TOOLCHAIN_FOR_TARGET],\n [dnl\n+AC_REQUIRE([SIM_AC_CHECK_TOOLCHAIN_FOR_PRIMARY_TARGET])\n AC_ARG_VAR(AS_FOR_TARGET_$2, [Assembler for $1 tests])\n AC_ARG_VAR(LD_FOR_TARGET_$2, [Linker for $1 tests])\n AC_ARG_VAR(CC_FOR_TARGET_$2, [C compiler for $1 tests])\n m4_bmatch($1, [example-], [dnl\n-  : \"${AS_FOR_TARGET_$2:=\\$(abs_builddir)/../gas/as-new}\"\n-  : \"${LD_FOR_TARGET_$2:=\\$(abs_builddir)/../ld/ld-new}\"\n+  : \"${AS_FOR_TARGET_$2:=\\$(AS_FOR_TARGET)}\"\n+  : \"${LD_FOR_TARGET_$2:=\\$(LD_FOR_TARGET)}\"\n   : \"${CC_FOR_TARGET_$2:=\\$(CC)}\"\n ], [dnl\n   AS_IF([test \"$SIM_PRIMARY_TARGET\" = \"$1\"], [dnl\n-    : \"${AS_FOR_TARGET_$2:=\\$(abs_builddir)/../gas/as-new}\"\n-    : \"${LD_FOR_TARGET_$2:=\\$(abs_builddir)/../ld/ld-new}\"\n-    dnl The default will be checked at test time.  If it's not available, then\n-    dnl it is automatically skipped.  So hardcoding this is safe.\n-    : \"${CC_FOR_TARGET_$2:=${target_alias}-gcc}\"\n+    : \"${AS_FOR_TARGET_$2:=\\$(AS_FOR_TARGET)}\"\n+    : \"${LD_FOR_TARGET_$2:=\\$(LD_FOR_TARGET)}\"\n+    : \"${CC_FOR_TARGET_$2:=\\$(CC_FOR_TARGET)}\"\n   ])\n ])\n AS_VAR_APPEND([SIM_TOOLCHAIN_VARS], [\" AS_FOR_TARGET_$2 LD_FOR_TARGET_$2 CC_FOR_TARGET_$2\"])"
    }
  ]
}