{
  "sha": "974387bb254e7317e29205e51623ab4243f98d0c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTc0Mzg3YmIyNTRlNzMxN2UyOTIwNWU1MTYyM2FiNDI0M2Y5OGQwYw==",
  "commit": {
    "author": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-02-17T15:12:01Z"
    },
    "committer": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-02-20T16:35:16Z"
    },
    "message": "gdbserver: turn target op 'qxfer_libraries_svr4' into a method\n\ngdbserver/ChangeLog:\n2020-02-20  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n\n\tTurn process_stratum_target's qxfer_libraries_svr4 op into a\n\tmethod of process_target.\n\n\t* target.h (struct process_stratum_target): Remove the target op.\n\t(class process_target): Add the target op.  Also add\n\t'supports_qxfer_libraries_svr4'.\n\t* target.cc (process_target::qxfer_libraries_svr4): Define.\n\t(process_target::supports_qxfer_libraries_svr4): Define.\n\n\tUpdate the derived classes and callers below.\n\n\t* server.cc (handle_qxfer_libraries_svr4): Update.\n\t(handle_query): Update.\n\t* linux-low.cc (linux_target_ops): Update.\n\t(linux_process_target::supports_qxfer_libraries_svr4): Define.\n\t(linux_qxfer_libraries_svr4): Turn into ...\n\t(linux_process_target::qxfer_libraries_svr4): ... this.\n\t* linux-low.h (class linux_process_target): Update.\n\t* lynx-low.cc (lynx_target_ops): Update.\n\t* nto-low.cc (nto_target_ops): Update.\n\t* win32-low.cc (win32_target_ops): Update.",
    "tree": {
      "sha": "90dffafbefb950e26b32967936409848a38830f5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/90dffafbefb950e26b32967936409848a38830f5"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/974387bb254e7317e29205e51623ab4243f98d0c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/974387bb254e7317e29205e51623ab4243f98d0c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/974387bb254e7317e29205e51623ab4243f98d0c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/974387bb254e7317e29205e51623ab4243f98d0c/comments",
  "author": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c756403b171fc56562bf478c8602040bba3de856",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c756403b171fc56562bf478c8602040bba3de856",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c756403b171fc56562bf478c8602040bba3de856"
    }
  ],
  "stats": {
    "total": 87,
    "additions": 71,
    "deletions": 16
  },
  "files": [
    {
      "sha": "3ee9556d888246a94c9ec840e2de154ec6c5dc1f",
      "filename": "gdbserver/ChangeLog",
      "status": "modified",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/ChangeLog?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -1,3 +1,27 @@\n+2020-02-20  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n+\n+\tTurn process_stratum_target's qxfer_libraries_svr4 op into a\n+\tmethod of process_target.\n+\n+\t* target.h (struct process_stratum_target): Remove the target op.\n+\t(class process_target): Add the target op.  Also add\n+\t'supports_qxfer_libraries_svr4'.\n+\t* target.cc (process_target::qxfer_libraries_svr4): Define.\n+\t(process_target::supports_qxfer_libraries_svr4): Define.\n+\n+\tUpdate the derived classes and callers below.\n+\n+\t* server.cc (handle_qxfer_libraries_svr4): Update.\n+\t(handle_query): Update.\n+\t* linux-low.cc (linux_target_ops): Update.\n+\t(linux_process_target::supports_qxfer_libraries_svr4): Define.\n+\t(linux_qxfer_libraries_svr4): Turn into ...\n+\t(linux_process_target::qxfer_libraries_svr4): ... this.\n+\t* linux-low.h (class linux_process_target): Update.\n+\t* lynx-low.cc (lynx_target_ops): Update.\n+\t* nto-low.cc (nto_target_ops): Update.\n+\t* win32-low.cc (win32_target_ops): Update.\n+\n 2020-02-20  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n \n \tTurn process_stratum_target's supports_disable_randomization op"
    },
    {
      "sha": "4e5e8aea1462abbed4ddf4fb9159949381ee8110",
      "filename": "gdbserver/linux-low.cc",
      "status": "modified",
      "additions": 11,
      "deletions": 5,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/linux-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/linux-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/linux-low.cc?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -6931,6 +6931,12 @@ read_one_ptr (CORE_ADDR memaddr, CORE_ADDR *ptr, int ptr_size)\n   return ret;\n }\n \n+bool\n+linux_process_target::supports_qxfer_libraries_svr4 ()\n+{\n+  return true;\n+}\n+\n struct link_map_offsets\n   {\n     /* Offset and size of r_debug.r_version.  */\n@@ -6957,10 +6963,11 @@ struct link_map_offsets\n \n /* Construct qXfer:libraries-svr4:read reply.  */\n \n-static int\n-linux_qxfer_libraries_svr4 (const char *annex, unsigned char *readbuf,\n-\t\t\t    unsigned const char *writebuf,\n-\t\t\t    CORE_ADDR offset, int len)\n+int\n+linux_process_target::qxfer_libraries_svr4 (const char *annex,\n+\t\t\t\t\t    unsigned char *readbuf,\n+\t\t\t\t\t    unsigned const char *writebuf,\n+\t\t\t\t\t    CORE_ADDR offset, int len)\n {\n   struct process_info_private *const priv = current_process ()->priv;\n   char filename[PATH_MAX];\n@@ -7456,7 +7463,6 @@ linux_get_hwcap2 (int wordsize)\n static linux_process_target the_linux_target;\n \n static process_stratum_target linux_target_ops = {\n-  linux_qxfer_libraries_svr4,\n   linux_supports_agent,\n #ifdef HAVE_LINUX_BTRACE\n   linux_enable_btrace,"
    },
    {
      "sha": "463e4e9b7084348537e3f1ca464af3a4b6479d37",
      "filename": "gdbserver/linux-low.h",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/linux-low.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/linux-low.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/linux-low.h?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -424,6 +424,13 @@ class linux_process_target : public process_target\n   struct emit_ops *emit_ops () override;\n \n   bool supports_disable_randomization () override;\n+\n+  bool supports_qxfer_libraries_svr4 () override;\n+\n+  int qxfer_libraries_svr4 (const char *annex,\n+\t\t\t    unsigned char *readbuf,\n+\t\t\t    unsigned const char *writebuf,\n+\t\t\t    CORE_ADDR offset, int len) override;\n };\n \n #define get_thread_lwp(thr) ((struct lwp_info *) (thread_target_data (thr)))"
    },
    {
      "sha": "74e7de526f733de40e7e32b082754f4af81768e2",
      "filename": "gdbserver/lynx-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/lynx-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/lynx-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/lynx-low.cc?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -735,7 +735,6 @@ static lynx_process_target the_lynx_target;\n /* The LynxOS target_ops vector.  */\n \n static process_stratum_target lynx_target_ops = {\n-  NULL,  /* qxfer_libraries_svr4 */\n   NULL,  /* support_agent */\n   NULL,  /* enable_btrace */\n   NULL,  /* disable_btrace */"
    },
    {
      "sha": "037a053183db4c11007094f5d0173115a7e1d681",
      "filename": "gdbserver/nto-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/nto-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/nto-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/nto-low.cc?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -947,7 +947,6 @@ nto_sw_breakpoint_from_kind (int kind, int *size)\n static nto_process_target the_nto_target;\n \n static process_stratum_target nto_target_ops = {\n-  NULL, /* qxfer_libraries_svr4 */\n   NULL, /* support_agent */\n   NULL, /* enable_btrace */\n   NULL, /* disable_btrace */"
    },
    {
      "sha": "61346e3ce5b77cecb05d69ec9dbceb3d79924242",
      "filename": "gdbserver/server.cc",
      "status": "modified",
      "additions": 5,
      "deletions": 3,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/server.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/server.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/server.cc?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -1574,10 +1574,12 @@ handle_qxfer_libraries_svr4 (const char *annex,\n   if (writebuf != NULL)\n     return -2;\n \n-  if (current_thread == NULL || the_target->qxfer_libraries_svr4 == NULL)\n+  if (current_thread == NULL\n+      || !the_target->pt->supports_qxfer_libraries_svr4 ())\n     return -1;\n \n-  return the_target->qxfer_libraries_svr4 (annex, readbuf, writebuf, offset, len);\n+  return the_target->pt->qxfer_libraries_svr4 (annex, readbuf, writebuf,\n+\t\t\t\t\t       offset, len);\n }\n \n /* Handle qXfer:osadata:read.  */\n@@ -2364,7 +2366,7 @@ handle_query (char *own_buf, int packet_len, int *new_packet_len_p)\n       if (target_supports_catch_syscall ())\n \tstrcat (own_buf, \";QCatchSyscalls+\");\n \n-      if (the_target->qxfer_libraries_svr4 != NULL)\n+      if (the_target->pt->supports_qxfer_libraries_svr4 ())\n \tstrcat (own_buf, \";qXfer:libraries-svr4:read+\"\n \t\t\";augmented-libraries-svr4-read+\");\n       else"
    },
    {
      "sha": "fa04bd011b5c4626652b8d354d8eaccba1c57ab9",
      "filename": "gdbserver/target.cc",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/target.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/target.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/target.cc?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -705,3 +705,18 @@ process_target::supports_disable_randomization ()\n {\n   return false;\n }\n+\n+bool\n+process_target::supports_qxfer_libraries_svr4 ()\n+{\n+  return false;\n+}\n+\n+int\n+process_target::qxfer_libraries_svr4 (const char *annex,\n+\t\t\t\t      unsigned char *readbuf,\n+\t\t\t\t      unsigned const char *writebuf,\n+\t\t\t\t      CORE_ADDR offset, int len)\n+{\n+  gdb_assert_not_reached (\"target op qxfer_libraries_svr4 not supported\");\n+}"
    },
    {
      "sha": "fe0a7df57942910da4e75f6f103b71d4cdc87da8",
      "filename": "gdbserver/target.h",
      "status": "modified",
      "additions": 9,
      "deletions": 5,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/target.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/target.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/target.h?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -70,11 +70,6 @@ class process_target;\n    shared code.  */\n struct process_stratum_target\n {\n-  /* Read solib info on SVR4 platforms.  */\n-  int (*qxfer_libraries_svr4) (const char *annex, unsigned char *readbuf,\n-\t\t\t       unsigned const char *writebuf,\n-\t\t\t       CORE_ADDR offset, int len);\n-\n   /* Return true if target supports debugging agent.  */\n   int (*supports_agent) (void);\n \n@@ -493,6 +488,15 @@ class process_target\n \n   /* Returns true if the target supports disabling randomization.  */\n   virtual bool supports_disable_randomization ();\n+\n+  /* Return true if the qxfer_libraries_svr4 op is supported.  */\n+  virtual bool supports_qxfer_libraries_svr4 ();\n+\n+  /* Read solib info on SVR4 platforms.  */\n+  virtual int qxfer_libraries_svr4 (const char *annex,\n+\t\t\t\t    unsigned char *readbuf,\n+\t\t\t\t    unsigned const char *writebuf,\n+\t\t\t\t    CORE_ADDR offset, int len);\n };\n \n extern process_stratum_target *the_target;"
    },
    {
      "sha": "54d7fde89b6f46f653e806dc2ce1d1b0a0ef39d9",
      "filename": "gdbserver/win32-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/win32-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/974387bb254e7317e29205e51623ab4243f98d0c/gdbserver/win32-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/win32-low.cc?ref=974387bb254e7317e29205e51623ab4243f98d0c",
      "patch": "@@ -1858,7 +1858,6 @@ win32_sw_breakpoint_from_kind (int kind, int *size)\n static win32_process_target the_win32_target;\n \n static process_stratum_target win32_target_ops = {\n-  NULL, /* qxfer_libraries_svr4 */\n   NULL, /* support_agent */\n   NULL, /* enable_btrace */\n   NULL, /* disable_btrace */"
    }
  ]
}