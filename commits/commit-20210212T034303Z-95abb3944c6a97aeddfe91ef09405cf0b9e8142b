{
  "sha": "95abb3944c6a97aeddfe91ef09405cf0b9e8142b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTVhYmIzOTQ0YzZhOTdhZWRkZmU5MWVmMDk0MDVjZjBiOWU4MTQyYg==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-02-12T03:43:03Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-02-12T03:43:03Z"
    },
    "message": "[binutils] Fix printing of .debug_str_offsets\n\nWith exec:\n...\n$ clang -gdwarf-5 ./src/gdb/testsuite/gdb.dwarf2/fission-mix*.c\n...\nwe have:\n...\n$ readelf -w a.out\n  ...\nContents of the .debug_str_offsets section:\n\n    Length: 0x24\n    Version: 0x5\n       Index   Offset [String]\n           0      1d0 clang version 10.0.1\n           1      1e6 src/gdb/testsuite/gdb.dwarf2/fission-mix-2.c\n           2      213 /home/vries/gdb_versions/devel\n           3      232 bar\n           4      236 x\n           5       61 int\n           6      238 s\n           7      23a func2\n           8       2c ild/BUILD/glibc-2.26/csu\n           9        5 sdeps/x86_64/start.S\n          10      1d0 clang version 10.0.1\n          11      240 src/gdb/testsuite/gdb.dwarf2/fission-mix.c\n          12      213 /home/vries/gdb_versions/devel\n          13      26b foo\n          14      236 x\n          15       61 int\n          16      238 s\n          17      26f func\n          18      274 main\n          19      279 arg\n...\n\nThe section consists of two parts, one for each CU, each with a header, but\nthe printing only reads the first header as a header, and prints the second\nheader as:\n...\n           8       2c ild/BUILD/glibc-2.26/csu\n           9        5 sdeps/x86_64/start.S\n...\n\nFix this in display_debug_str_offsets such that we have:\n...\n           6      238 s\n           7      23a func2\n    Length: 0x2c\n    Version: 0x5\n       Index   Offset [String]\n           0      1d0 clang version 10.0.1\n           1      240 src/gdb/testsuite/gdb.dwarf2/fission-mix.c\n...\n\nbinutils/ChangeLog:\n\n2021-02-12  Tom de Vries  <tdevries@suse.de>\n\n\t* dwarf.c (display_debug_str_offsets): Handle multiple sets of\n\tentries.",
    "tree": {
      "sha": "56388e28f1ec73bf90759fc70cb29e5f8982e28a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/56388e28f1ec73bf90759fc70cb29e5f8982e28a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/95abb3944c6a97aeddfe91ef09405cf0b9e8142b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/95abb3944c6a97aeddfe91ef09405cf0b9e8142b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/95abb3944c6a97aeddfe91ef09405cf0b9e8142b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/95abb3944c6a97aeddfe91ef09405cf0b9e8142b/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d60f79984aecd7f72de6fdf2015100a7516c9ee2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d60f79984aecd7f72de6fdf2015100a7516c9ee2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d60f79984aecd7f72de6fdf2015100a7516c9ee2"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 14,
    "deletions": 1
  },
  "files": [
    {
      "sha": "cd6b573ef76c905ec3ee811448ca62e880494ee0",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/95abb3944c6a97aeddfe91ef09405cf0b9e8142b/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/95abb3944c6a97aeddfe91ef09405cf0b9e8142b/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=95abb3944c6a97aeddfe91ef09405cf0b9e8142b",
      "patch": "@@ -1,3 +1,8 @@\n+2021-02-12  Tom de Vries  <tdevries@suse.de>\n+\n+\t* dwarf.c (display_debug_str_offsets): Handle multiple sets of\n+\tentries.\n+\n 2021-02-12  Tom de Vries  <tdevries@suse.de>\n \n \t* dwarf.c (process_debug_info): Print DWO ID."
    },
    {
      "sha": "e55a7daa8febdd6a56e99d61e538792919b7f1aa",
      "filename": "binutils/dwarf.c",
      "status": "modified",
      "additions": 9,
      "deletions": 1,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/95abb3944c6a97aeddfe91ef09405cf0b9e8142b/binutils/dwarf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/95abb3944c6a97aeddfe91ef09405cf0b9e8142b/binutils/dwarf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dwarf.c?ref=95abb3944c6a97aeddfe91ef09405cf0b9e8142b",
      "patch": "@@ -7379,18 +7379,22 @@ display_debug_str_offsets (struct dwarf_section *section,\n       else\n \tentry_length = 4;\n \n+      unsigned char *entries_end;\n       if (length == 0)\n \t{\n \t  /* This is probably an old style .debug_str_offset section which\n \t     just contains offsets and no header (and the first offset is 0).  */\n \t  length = section->size;\n \t  curr   = section->start;\n+\t  entries_end = end;\n \n \t  printf (_(\"    Length: %#lx\\n\"), (unsigned long) length);\n \t  printf (_(\"       Index   Offset [String]\\n\"));\n \t}\n       else\n \t{\n+\t  entries_end = curr + length;\n+\n \t  int version;\n \t  SAFE_BYTE_GET_AND_INC (version, curr, 2, end);\n \t  if (version != 5)\n@@ -7406,11 +7410,15 @@ display_debug_str_offsets (struct dwarf_section *section,\n \t  printf (_(\"       Index   Offset [String]\\n\"));\n \t}\n \n-      for (idx = 0; length >= entry_length && curr < end; idx++)\n+      for (idx = 0; curr < entries_end; idx++)\n \t{\n \t  dwarf_vma offset;\n \t  const unsigned char * string;\n \n+\t  if (curr + entry_length > entries_end)\n+\t    /* Not enough space to read one entry_length, give up.  */\n+\t    return 0;\n+\n \t  SAFE_BYTE_GET_AND_INC (offset, curr, entry_length, end);\n \t  if (dwo)\n \t    string = (const unsigned char *)"
    }
  ]
}