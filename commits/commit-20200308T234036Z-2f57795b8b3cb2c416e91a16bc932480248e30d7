{
  "sha": "2f57795b8b3cb2c416e91a16bc932480248e30d7",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmY1Nzc5NWI4YjNjYjJjNDE2ZTkxYTE2YmM5MzI0ODAyNDhlMzBkNw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-03-08T23:03:49Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-03-08T23:40:36Z"
    },
    "message": "asan: wasm: Out-of-memory\n\n\t* wasm-module.c (wasm_scan): Sanity check file name length\n\tbefore allocating memory.  Move common section setup code.  Do\n\twithout bfd_tell to calculate section size.",
    "tree": {
      "sha": "8c1225897b9c7949b873704580c0c14e43079846",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8c1225897b9c7949b873704580c0c14e43079846"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2f57795b8b3cb2c416e91a16bc932480248e30d7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f57795b8b3cb2c416e91a16bc932480248e30d7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2f57795b8b3cb2c416e91a16bc932480248e30d7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f57795b8b3cb2c416e91a16bc932480248e30d7/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e63ee24f98f0648d1a88f9a74bd60a7278aeda2c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e63ee24f98f0648d1a88f9a74bd60a7278aeda2c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e63ee24f98f0648d1a88f9a74bd60a7278aeda2c"
    }
  ],
  "stats": {
    "total": 33,
    "additions": 21,
    "deletions": 12
  },
  "files": [
    {
      "sha": "371e505392d561e3d69530b3e534d901e59206d7",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f57795b8b3cb2c416e91a16bc932480248e30d7/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f57795b8b3cb2c416e91a16bc932480248e30d7/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=2f57795b8b3cb2c416e91a16bc932480248e30d7",
      "patch": "@@ -1,3 +1,9 @@\n+2020-03-09  Alan Modra  <amodra@gmail.com>\n+\n+\t* wasm-module.c (wasm_scan): Sanity check file name length\n+\tbefore allocating memory.  Move common section setup code.  Do\n+\twithout bfd_tell to calculate section size.\n+\n 2020-03-06  Nick Clifton  <nickc@redhat.com>\n \n \t* elf.c (_bfd_elf_set_section_contents): Replace call to abort"
    },
    {
      "sha": "66ac2d1874b5bcb71d584772868b95d40cc5b689",
      "filename": "bfd/wasm-module.c",
      "status": "modified",
      "additions": 15,
      "deletions": 12,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f57795b8b3cb2c416e91a16bc932480248e30d7/bfd/wasm-module.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f57795b8b3cb2c416e91a16bc932480248e30d7/bfd/wasm-module.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/wasm-module.c?ref=2f57795b8b3cb2c416e91a16bc932480248e30d7",
      "patch": "@@ -406,30 +406,33 @@ wasm_scan (bfd *abfd)\n \t  if (bfdsec == NULL)\n \t    goto error_return;\n \n-\t  bfdsec->vma = vma;\n-\t  bfdsec->lma = vma;\n \t  bfdsec->size = wasm_read_leb128 (abfd, &error, &bytes_read, FALSE);\n \t  if (error)\n \t    goto error_return;\n-\t  bfdsec->filepos = bfd_tell (abfd);\n-\t  bfdsec->alignment_power = 0;\n \t}\n       else\n \t{\n \t  bfd_vma payload_len;\n-\t  file_ptr section_start;\n \t  bfd_vma namelen;\n \t  char *name;\n \t  char *prefix = WASM_SECTION_PREFIX;\n \t  size_t prefixlen = strlen (prefix);\n+\t  ufile_ptr filesize;\n \n \t  payload_len = wasm_read_leb128 (abfd, &error, &bytes_read, FALSE);\n \t  if (error)\n \t    goto error_return;\n-\t  section_start = bfd_tell (abfd);\n \t  namelen = wasm_read_leb128 (abfd, &error, &bytes_read, FALSE);\n-\t  if (error || namelen > payload_len)\n+\t  if (error || bytes_read > payload_len\n+\t      || namelen > payload_len - bytes_read)\n \t    goto error_return;\n+\t  payload_len -= namelen + bytes_read;\n+\t  filesize = bfd_get_file_size (abfd);\n+\t  if (filesize != 0 && namelen > filesize)\n+\t    {\n+\t      bfd_set_error (bfd_error_file_truncated);\n+\t      return FALSE;\n+\t    }\n \t  name = bfd_alloc (abfd, namelen + prefixlen + 1);\n \t  if (!name)\n \t    goto error_return;\n@@ -443,13 +446,13 @@ wasm_scan (bfd *abfd)\n \t  if (bfdsec == NULL)\n \t    goto error_return;\n \n-\t  bfdsec->vma = vma;\n-\t  bfdsec->lma = vma;\n-\t  bfdsec->filepos = bfd_tell (abfd);\n-\t  bfdsec->size = section_start + payload_len - bfdsec->filepos;\n-\t  bfdsec->alignment_power = 0;\n+\t  bfdsec->size = payload_len;\n \t}\n \n+      bfdsec->vma = vma;\n+      bfdsec->lma = vma;\n+      bfdsec->alignment_power = 0;\n+      bfdsec->filepos = bfd_tell (abfd);\n       if (bfdsec->size != 0)\n \t{\n \t  bfdsec->contents = _bfd_alloc_and_read (abfd, bfdsec->size,"
    }
  ]
}