{
  "sha": "6cdd651fda1315cb43a6a50223350da0da3f6dcf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmNkZDY1MWZkYTEzMTVjYjQzYTZhNTAyMjMzNTBkYTBkYTNmNmRjZg==",
  "commit": {
    "author": {
      "name": "Luis Machado",
      "email": "luis.machado@linaro.org",
      "date": "2019-11-18T19:36:53Z"
    },
    "committer": {
      "name": "Luis Machado",
      "email": "luis.machado@linaro.org",
      "date": "2019-11-20T16:57:34Z"
    },
    "message": "Improve target description check for SVE in gdbserver\n\nThe current code checks for the presence of a SVE target description by\ncomparing the number of registers.  This is a bit fragile since the number\nof registers can change whenever we add new sets. Like PAC, for example.\n\nIf the comparison breaks, then we're left with SVE registers in the\ndescription, but gdbserver doesn't send the registers to GDB, which in\nturn displays stale information to the user.\n\nThe following patch changes the check to use the SVE feature string instead,\nwhich hopefully should be more stable.\n\ngdb/gdbserver/ChangeLog:\n\n2019-11-20  Luis Machado  <luis.machado@linaro.org>\n\n\t* linux-aarch64-low.c (is_sve_tdesc): Check against target feature\n\tinstead of register count.\n\t* tdesc.c (tdesc_contains_feature): New function.\n\t* tdesc.h (tdesc_contains_feature): New prototype.\n\nChange-Id: I28b782cb1677560ca9a06a1be442974b25aabae4",
    "tree": {
      "sha": "75ff8739197715b1945267077bc157335556178e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/75ff8739197715b1945267077bc157335556178e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6cdd651fda1315cb43a6a50223350da0da3f6dcf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6cdd651fda1315cb43a6a50223350da0da3f6dcf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6cdd651fda1315cb43a6a50223350da0da3f6dcf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6cdd651fda1315cb43a6a50223350da0da3f6dcf/comments",
  "author": {
    "login": "luislinaro",
    "id": 53092780,
    "node_id": "MDQ6VXNlcjUzMDkyNzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/53092780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luislinaro",
    "html_url": "https://github.com/luislinaro",
    "followers_url": "https://api.github.com/users/luislinaro/followers",
    "following_url": "https://api.github.com/users/luislinaro/following{/other_user}",
    "gists_url": "https://api.github.com/users/luislinaro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luislinaro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luislinaro/subscriptions",
    "organizations_url": "https://api.github.com/users/luislinaro/orgs",
    "repos_url": "https://api.github.com/users/luislinaro/repos",
    "events_url": "https://api.github.com/users/luislinaro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luislinaro/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "luislinaro",
    "id": 53092780,
    "node_id": "MDQ6VXNlcjUzMDkyNzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/53092780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luislinaro",
    "html_url": "https://github.com/luislinaro",
    "followers_url": "https://api.github.com/users/luislinaro/followers",
    "following_url": "https://api.github.com/users/luislinaro/following{/other_user}",
    "gists_url": "https://api.github.com/users/luislinaro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luislinaro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luislinaro/subscriptions",
    "organizations_url": "https://api.github.com/users/luislinaro/orgs",
    "repos_url": "https://api.github.com/users/luislinaro/repos",
    "events_url": "https://api.github.com/users/luislinaro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luislinaro/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "94c9b9db4b689bc1ae643e053580db1fdfaee2d4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/94c9b9db4b689bc1ae643e053580db1fdfaee2d4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/94c9b9db4b689bc1ae643e053580db1fdfaee2d4"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 29,
    "deletions": 1
  },
  "files": [
    {
      "sha": "a5da6b584deab36ea1614d5e24e45be828cbfb91",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=6cdd651fda1315cb43a6a50223350da0da3f6dcf",
      "patch": "@@ -1,3 +1,10 @@\n+2019-11-20  Luis Machado  <luis.machado@linaro.org>\n+\n+\t* linux-aarch64-low.c (is_sve_tdesc): Check against target feature\n+\tinstead of register count.\n+\t* tdesc.c (tdesc_contains_feature): New function.\n+\t* tdesc.h (tdesc_contains_feature): New prototype.\n+\n 2019-11-15  Christian Biesinger  <cbiesinger@google.com>\n \n \t* Makefile.in: Add safe-strerror.c."
    },
    {
      "sha": "9e234e0578bfd8017d58a5c8e24c8c7bda70fc5f",
      "filename": "gdb/gdbserver/linux-aarch64-low.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/linux-aarch64-low.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/linux-aarch64-low.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/linux-aarch64-low.c?ref=6cdd651fda1315cb43a6a50223350da0da3f6dcf",
      "patch": "@@ -83,7 +83,7 @@ is_sve_tdesc (void)\n {\n   struct regcache *regcache = get_thread_regcache (current_thread, 0);\n \n-  return regcache->tdesc->reg_defs.size () == AARCH64_SVE_NUM_REGS;\n+  return tdesc_contains_feature (regcache->tdesc, \"org.gnu.gdb.aarch64.sve\");\n }\n \n static void"
    },
    {
      "sha": "817e69a58f24ba2b870df75b64554754d5691d90",
      "filename": "gdb/gdbserver/tdesc.c",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/tdesc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/tdesc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/tdesc.c?ref=6cdd651fda1315cb43a6a50223350da0da3f6dcf",
      "patch": "@@ -186,3 +186,19 @@ tdesc_create_feature (struct target_desc *tdesc, const char *name)\n   tdesc->features.emplace_back (new_feature);\n   return new_feature;\n }\n+\n+/* See gdbsupport/tdesc.h.  */\n+\n+bool\n+tdesc_contains_feature (const target_desc *tdesc, const std::string &feature)\n+{\n+  gdb_assert (tdesc != nullptr);\n+\n+  for (const tdesc_feature_up &f : tdesc->features)\n+    {\n+      if (f->name == feature)\n+\treturn true;\n+    }\n+\n+  return false;\n+}"
    },
    {
      "sha": "da21cdaad47f14f29a647ec7f6ce351115330074",
      "filename": "gdb/gdbserver/tdesc.h",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/tdesc.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6cdd651fda1315cb43a6a50223350da0da3f6dcf/gdb/gdbserver/tdesc.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/tdesc.h?ref=6cdd651fda1315cb43a6a50223350da0da3f6dcf",
      "patch": "@@ -93,4 +93,9 @@ void init_target_desc (struct target_desc *tdesc,\n \n const struct target_desc *current_target_desc (void);\n \n+/* Return true if TDESC contains the feature described by string FEATURE.\n+   Return false otherwise.  */\n+bool tdesc_contains_feature (const target_desc *tdesc,\n+\t\t\t     const std::string &feature);\n+\n #endif /* GDBSERVER_TDESC_H */"
    }
  ]
}