{
  "sha": "f8080fb7a44b0a3a9699c188015106bc4b16076f",
  "node_id": "C_kwDOANOeidoAKGY4MDgwZmI3YTQ0YjBhM2E5Njk5YzE4ODAxNTEwNmJjNGIxNjA3NmY",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-11-26T19:46:37Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-11-26T19:46:37Z"
    },
    "message": "[gdb/testsuite] Add gdb.base/include-main.exp\n\nThe test-case gdb.ada/dgopt.exp uses the -gnatD switch, in combination with\n-gnatG.\n\nThis causes the source file $src/gdb/testsuite/gdb.ada/dgopt/x.adb to be\nexpanded into $build/gdb/testsuite/outputs/gdb.ada/dgopt/x.adb.dg, and the\ndebug information should refer to the x.adb.dg file.\n\nThat is the case for the .debug_line part:\n...\nThe Directory Table is empty.\n\n The File Name Table (offset 0x1c):\n  Entry Dir     Time    Size    Name\n  1     0       0       0       x.adb.dg\n...\nbut not for the .debug_info part:\n...\n    <11>   DW_AT_name        : $src/gdb/testsuite/gdb.ada/dgopt/x.adb\n    <15>   DW_AT_comp_dir    : $build/gdb/testsuite/outputs/gdb.ada/dgopt\n...\n\nFiled as PR gcc/103436.\n\nIn C we can generate similar debug information, using a source file that does\nnot contain any code, but includes another one that does:\n...\n $ cat gdb/testsuite/gdb.base/include-main.c\n #include \"main.c\"\n...\nsuch that in the .debug_line part we have:\n...\n The Directory Table (offset 0x1c):\n  1     /home/vries/gdb_versions/devel/src/gdb/testsuite/gdb.base\n\n The File Name Table (offset 0x57):\n  Entry Dir     Time    Size    Name\n  1     1       0       0       main.c\n...\nand in the .debug_info part:\n...\n    <11>   DW_AT_name        : $src/gdb/testsuite/gdb.base/include-main.c\n    <15>   DW_AT_comp_dir    : $build/gdb/testsuite\n...\n\nAdd a C test-case that mimics gdb.ada/dgopt.exp, that is:\n- generate debug info as described above,\n- issue a list of a line in include-main.c, while the corresponding\n  CU is not expanded yet.\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "8dcb141b80fa360e4023ef812c21fef648cd4ca9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8dcb141b80fa360e4023ef812c21fef648cd4ca9"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f8080fb7a44b0a3a9699c188015106bc4b16076f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f8080fb7a44b0a3a9699c188015106bc4b16076f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f8080fb7a44b0a3a9699c188015106bc4b16076f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f8080fb7a44b0a3a9699c188015106bc4b16076f/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c099934746ab8d7059411c77acc56fc6d149bbf4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c099934746ab8d7059411c77acc56fc6d149bbf4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c099934746ab8d7059411c77acc56fc6d149bbf4"
    }
  ],
  "stats": {
    "total": 87,
    "additions": 87,
    "deletions": 0
  },
  "files": [
    {
      "sha": "ef5ac0a9f3e259578721cd009627c24bde4ba072",
      "filename": "gdb/testsuite/gdb.base/include-main.c",
      "status": "added",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f8080fb7a44b0a3a9699c188015106bc4b16076f/gdb/testsuite/gdb.base/include-main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f8080fb7a44b0a3a9699c188015106bc4b16076f/gdb/testsuite/gdb.base/include-main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/include-main.c?ref=f8080fb7a44b0a3a9699c188015106bc4b16076f",
      "patch": "@@ -0,0 +1,18 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2021 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+#include \"main.c\""
    },
    {
      "sha": "5e5e94951987d6ff5fe2ca5115ffe20a80648293",
      "filename": "gdb/testsuite/gdb.base/include-main.exp",
      "status": "added",
      "additions": 47,
      "deletions": 0,
      "changes": 47,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f8080fb7a44b0a3a9699c188015106bc4b16076f/gdb/testsuite/gdb.base/include-main.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f8080fb7a44b0a3a9699c188015106bc4b16076f/gdb/testsuite/gdb.base/include-main.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/include-main.exp?ref=f8080fb7a44b0a3a9699c188015106bc4b16076f",
      "patch": "@@ -0,0 +1,47 @@\n+# Copyright 2021 Free Software Foundation, Inc.\n+#\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# C test-case that mimics gdb.ada/dgopt.exp.\n+\n+standard_testfile .c main.c\n+\n+if { [build_executable \"failed to prepare\" $testfile $srcfile {debug}] } {\n+    return -1\n+}\n+\n+clean_restart\n+\n+# Set language explicitly, to avoid expanding the include-main.c CU for the\n+# language lookup (this is currently not required, but may be after\n+# integration of the no-more-psym branch).\n+# This to make sure that the source file lookup we do later triggers the\n+# symtab expansion.\n+gdb_test_no_output \"set language c\"\n+\n+gdb_load $binfile\n+\n+# Verify that no CU was expanded.\n+gdb_test_no_output \"maint info symtab\"\n+\n+# List a line in include-main.c.  The tricky bit is that there's no code in\n+# include-main.c, so the file should not occur in the .debug_line info.\n+# GDB needs to find the file based on the CU's DW_AT_name/DW_AT_comp_dir.\n+set line [gdb_get_line_number \"include\" $srcfile]\n+gdb_test \"list $srcfile:$line\" \"$line\\[ \\t\\]*#include \\\"main.c\\\"\"\n+\n+# For completeness, also try to list a line in the file that does contain\n+# code.\n+set line [gdb_get_line_number \"main\" $srcfile2]\n+gdb_test \"list $srcfile2:$line\" \"$line\\[ \\t\\]*main \\\\(void\\\\)\\r\\n.*\""
    },
    {
      "sha": "bfe52c018d47899c142e2c03b70c11a73db0eac6",
      "filename": "gdb/testsuite/gdb.base/main.c",
      "status": "added",
      "additions": 22,
      "deletions": 0,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f8080fb7a44b0a3a9699c188015106bc4b16076f/gdb/testsuite/gdb.base/main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f8080fb7a44b0a3a9699c188015106bc4b16076f/gdb/testsuite/gdb.base/main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/main.c?ref=f8080fb7a44b0a3a9699c188015106bc4b16076f",
      "patch": "@@ -0,0 +1,22 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2021 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+int\n+main (void)\n+{\n+  return 0;\n+}"
    }
  ]
}