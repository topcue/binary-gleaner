{
  "sha": "000439d52897541ad00a84026ac471b4f8cb3c97",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDAwNDM5ZDUyODk3NTQxYWQwMGE4NDAyNmFjNDcxYjRmOGNiM2M5Nw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-05-15T19:06:59Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-05-29T14:25:38Z"
    },
    "message": "Add \"set print finish\"\n\nA user wanted to be able to disable the display of the value when\nusing \"finish\" -- but still have the value entered into the value\nhistory in case it was useful later on.  Part of the rationale here is\nthat sometimes the value might be quite large, or expensive to display\n(in their case this was compounded by a rogue pretty-printer).\n\nThis patch implements this idea.\n\ngdb/ChangeLog\n2019-05-29  Tom Tromey  <tromey@adacore.com>\n\n\t* NEWS: Add entry.\n\t* infcmd.c (print_return_value_1): Handle finish_print\n\toption.\n\t(show_print_finish): New function.\n\t(_initialize_infcmd): Add \"set/show print finish\" commands.\n\t* valprint.c (user_print_options): Initialize new member.\n\t* valprint.h (struct value_print_options) <finish_print>: New\n\tmember.\n\ngdb/doc/ChangeLog\n2019-05-29  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.texinfo (Continuing and Stepping): Document new\n\tcommands.\n\ngdb/testsuite/ChangeLog\n2019-05-29  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.base/finish.exp (finish_no_print): New proc.\n\t(finish_tests): Call it.",
    "tree": {
      "sha": "e6aa4c015ea8da9b59e6127f9efcc84a49af61d2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e6aa4c015ea8da9b59e6127f9efcc84a49af61d2"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/000439d52897541ad00a84026ac471b4f8cb3c97",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/000439d52897541ad00a84026ac471b4f8cb3c97",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/000439d52897541ad00a84026ac471b4f8cb3c97",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/000439d52897541ad00a84026ac471b4f8cb3c97/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e33f2313bf63b77763739732be14b469b4b647b7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e33f2313bf63b77763739732be14b469b4b647b7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e33f2313bf63b77763739732be14b469b4b647b7"
    }
  ],
  "stats": {
    "total": 92,
    "additions": 87,
    "deletions": 5
  },
  "files": [
    {
      "sha": "16c1d0c844e9481b8568e82a900a54a9e2c869ef",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -1,3 +1,14 @@\n+2019-05-29  Tom Tromey  <tromey@adacore.com>\n+\n+\t* NEWS: Add entry.\n+\t* infcmd.c (print_return_value_1): Handle finish_print\n+\toption.\n+\t(show_print_finish): New function.\n+\t(_initialize_infcmd): Add \"set/show print finish\" commands.\n+\t* valprint.c (user_print_options): Initialize new member.\n+\t* valprint.h (struct value_print_options) <finish_print>: New\n+\tmember.\n+\n 2019-05-28  Tom Tromey  <tromey@adacore.com>\n \n \t* ada-lang.c (ada_remove_Xbn_suffix)"
    },
    {
      "sha": "ab582c036dcf32050144480f4b75ee93e61cbd0c",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -39,6 +39,13 @@ show may-call-functions\n   an error when a command (such as print expression) calls a function\n   in the program.\n \n+set print finish [on|off]\n+show print finish\n+  This controls whether the `finish' command will display the value\n+  that is returned by the current function.  When `off', the value is\n+  still entered into the value history, but it is not printed.  The\n+  default is `on'.\n+\n set print max-depth\n show print max-depth\n   Allows deeply nested structures to be simplified when printing by"
    },
    {
      "sha": "c075d74eec81e1a6f9d227f97ae452545de5c15d",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -1,3 +1,8 @@\n+2019-05-29  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.texinfo (Continuing and Stepping): Document new\n+\tcommands.\n+\n 2019-05-22  Alan Hayward  <alan.hayward@arm.com>\n \n \t* gdb.texinfo (Shell Commands): Add debugredirect."
    },
    {
      "sha": "f2d8710d7dc27693d80a97ca98aebd3d2cd4eab0",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -5599,6 +5599,15 @@ abbreviated as @code{fin}.\n Contrast this with the @code{return} command (@pxref{Returning,\n ,Returning from a Function}).\n \n+@kindex set print finish\n+@kindex show print finish\n+@item set print finish @r{[}on|off@r{]}\n+@itemx show print finish\n+By default the @code{finish} command will show the value that is\n+returned by the function.  This can be disabled using @code{set print\n+finish off}.  When disabled, the value is still entered into the value\n+history (@pxref{Value History}), but not displayed.\n+\n @kindex until\n @kindex u @r{(@code{until})}\n @cindex run until specified location"
    },
    {
      "sha": "1dfbe2329b7e8649c8c9f4cfdbe7662cb723babe",
      "filename": "gdb/infcmd.c",
      "status": "modified",
      "additions": 29,
      "deletions": 4,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/infcmd.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/infcmd.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/infcmd.c?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -1621,10 +1621,14 @@ print_return_value_1 (struct ui_out *uiout, struct return_value_info *rv)\n       uiout->text (\" = \");\n       get_user_print_options (&opts);\n \n-      string_file stb;\n-\n-      value_print (rv->value, &stb, &opts);\n-      uiout->field_stream (\"return-value\", stb);\n+      if (opts.finish_print)\n+\t{\n+\t  string_file stb;\n+\t  value_print (rv->value, &stb, &opts);\n+\t  uiout->field_stream (\"return-value\", stb);\n+\t}\n+      else\n+\tuiout->field_string (\"return-value\", _(\"<not displayed>\"));\n       uiout->text (\"\\n\");\n     }\n   else\n@@ -3096,6 +3100,19 @@ info_proc_cmd_all (const char *args, int from_tty)\n   info_proc_cmd_1 (args, IP_ALL, from_tty);\n }\n \n+/* Implement `show print finish'.  */\n+\n+static void\n+show_print_finish (struct ui_file *file, int from_tty,\n+\t\t   struct cmd_list_element *c,\n+\t\t   const char *value)\n+{\n+  fprintf_filtered (file, _(\"\\\n+Printing of return value after `finish' is %s.\\n\"),\n+\t\t    value);\n+}\n+\n+\n /* This help string is used for the run, start, and starti commands.\n    It is defined as a macro to prevent duplication.  */\n \n@@ -3420,4 +3437,12 @@ List files opened by the specified process.\"),\n   add_cmd (\"all\", class_info, info_proc_cmd_all, _(\"\\\n List all available info about the specified process.\"),\n \t   &info_proc_cmdlist);\n+\n+  add_setshow_boolean_cmd (\"finish\", class_support,\n+\t\t\t   &user_print_options.finish_print, _(\"\\\n+Set whether `finish' prints the return value.\"), _(\"\\\n+Show whether `finish' prints the return value.\"), NULL,\n+\t\t\t   NULL,\n+\t\t\t   show_print_finish,\n+\t\t\t   &setprintlist, &showprintlist);\n }"
    },
    {
      "sha": "f795ba0c8c6d1550f2bd1dedbafa7edb2b6febfd",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -1,3 +1,8 @@\n+2019-05-29  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.base/finish.exp (finish_no_print): New proc.\n+\t(finish_tests): Call it.\n+\n 2019-05-24  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.dwarf2/gdb-add-index.exp: New file."
    },
    {
      "sha": "56f3c10e3f087c170c416c9fbc57500f62c9f065",
      "filename": "gdb/testsuite/gdb.base/finish.exp",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/testsuite/gdb.base/finish.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/testsuite/gdb.base/finish.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/finish.exp?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -86,6 +86,21 @@ proc finish_abbreviation { abbrev } {\n              \"Testing the \\\"$abbrev\\\" abbreviation for \\\"finish\\\"\"\n }\n \n+# Test \"set print finish off\".\n+proc finish_no_print {} {\n+    global decimal\n+\n+    if {![runto \"int_func\"]} {\n+\tuntested \"couldn't run to main\"\n+\treturn\n+    }\n+    gdb_test_no_output \"set print finish off\"\n+    gdb_test \"finish\" \\\n+\t\"Value returned is \\\\\\$$decimal = <not displayed>\"\n+    gdb_test \"print \\$\" \" = 1\" \\\n+\t\"Ensure return value was properly saved\"\n+}\n+\n proc finish_tests { } {\n     global gdb_prompt skip_float_test\n \n@@ -105,6 +120,7 @@ proc finish_tests { } {\n \tfinish_1 \"double\"\n     }\n     finish_abbreviation \"fin\"\n+    finish_no_print\n }\n \n set prev_timeout $timeout"
    },
    {
      "sha": "4c3d67a9ff80fdada56690741a27e870585c1806",
      "filename": "gdb/valprint.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/valprint.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/valprint.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/valprint.c?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -111,7 +111,8 @@ struct value_print_options user_print_options =\n   0,\t\t\t\t/* raw */\n   0,\t\t\t\t/* summary */\n   1,\t\t\t\t/* symbol_print */\n-  PRINT_MAX_DEPTH_DEFAULT\t/* max_depth */\n+  PRINT_MAX_DEPTH_DEFAULT,\t/* max_depth */\n+  1\t\t\t\t/* finish_print */\n };\n \n /* Initialize *OPTS to be a copy of the user print options.  */"
    },
    {
      "sha": "0bd3f1966c493101929a6d6457546b850e7a26d0",
      "filename": "gdb/valprint.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/valprint.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/000439d52897541ad00a84026ac471b4f8cb3c97/gdb/valprint.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/valprint.h?ref=000439d52897541ad00a84026ac471b4f8cb3c97",
      "patch": "@@ -95,6 +95,9 @@ struct value_print_options\n \n   /* Maximum print depth when printing nested aggregates.  */\n   int max_depth;\n+\n+  /* Whether \"finish\" should print the value.  */\n+  int finish_print;\n };\n \n /* The global print options set by the user.  In general this should"
    }
  ]
}