{
  "sha": "f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjFlMWQ3ZjMwNWU5YzZmNzYyOTc4NjNhYzQ1NGIwOWNlZWU1ZTRiZQ==",
  "commit": {
    "author": {
      "name": "Andrea Corallo",
      "email": "andrea.corallo@arm.com",
      "date": "2021-05-18T09:28:17Z"
    },
    "committer": {
      "name": "Andrea Corallo",
      "email": "andrea.corallo@arm.com",
      "date": "2021-07-26T12:18:24Z"
    },
    "message": "PATCH [2/10] arm: add 'pacbti' instruction for Armv8.1-M pacbti extension\n\ngas/\n2021-06-11  Andrea Corallo  <andrea.corallo@arm.com>\n\n\t* config/tc-arm.c\n\t(enum operand_parse_code): Add OP_SP and OP_R12.\n\t(parse_operands): Add switch cases for OP_SP and OP_R12.\n\t(T16_32_TAB): Add '_pacbti'.\n\t(do_t_pacbti): New function.\n\t(insns): Add 'pacbti'.\n\t* testsuite/gas/arm/armv8_1-m-pacbti-bad.d: New file.\n\t* testsuite/gas/arm/armv8_1-m-pacbti-bad.l: Likewise.\n\t* testsuite/gas/arm/armv8_1-m-pacbti-bad.s: Likewise.\n\t* testsuite/gas/arm/armv8_1-m-pacbti.d: Add 'pacbti' to testcase.\n\t* testsuite/gas/arm/armv8_1-m-pacbti.s: Likewise.\n\nopcodes/\n2021-06-11  Andrea Corallo  <andrea.corallo@arm.com>\n\n\t* arm-dis.c (thumb32_opcodes): Add 'pacbti' instruction.",
    "tree": {
      "sha": "25bf12a3bb98ce36bbe8ece0e90b8c83e801e93a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/25bf12a3bb98ce36bbe8ece0e90b8c83e801e93a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/comments",
  "author": {
    "login": "AndreaCorallo",
    "id": 6765576,
    "node_id": "MDQ6VXNlcjY3NjU1NzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6765576?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AndreaCorallo",
    "html_url": "https://github.com/AndreaCorallo",
    "followers_url": "https://api.github.com/users/AndreaCorallo/followers",
    "following_url": "https://api.github.com/users/AndreaCorallo/following{/other_user}",
    "gists_url": "https://api.github.com/users/AndreaCorallo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AndreaCorallo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AndreaCorallo/subscriptions",
    "organizations_url": "https://api.github.com/users/AndreaCorallo/orgs",
    "repos_url": "https://api.github.com/users/AndreaCorallo/repos",
    "events_url": "https://api.github.com/users/AndreaCorallo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AndreaCorallo/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "AndreaCorallo",
    "id": 6765576,
    "node_id": "MDQ6VXNlcjY3NjU1NzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6765576?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AndreaCorallo",
    "html_url": "https://github.com/AndreaCorallo",
    "followers_url": "https://api.github.com/users/AndreaCorallo/followers",
    "following_url": "https://api.github.com/users/AndreaCorallo/following{/other_user}",
    "gists_url": "https://api.github.com/users/AndreaCorallo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AndreaCorallo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AndreaCorallo/subscriptions",
    "organizations_url": "https://api.github.com/users/AndreaCorallo/orgs",
    "repos_url": "https://api.github.com/users/AndreaCorallo/repos",
    "events_url": "https://api.github.com/users/AndreaCorallo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AndreaCorallo/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3751264cdd187e355af867198f5b70b36846a1a8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3751264cdd187e355af867198f5b70b36846a1a8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/3751264cdd187e355af867198f5b70b36846a1a8"
    }
  ],
  "stats": {
    "total": 43,
    "additions": 43,
    "deletions": 0
  },
  "files": [
    {
      "sha": "ed870f01aee7cd1fdbba87a40db27833c242be2e",
      "filename": "gas/config/tc-arm.c",
      "status": "modified",
      "additions": 22,
      "deletions": 0,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/config/tc-arm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/config/tc-arm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-arm.c?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -7115,6 +7115,8 @@ enum operand_parse_code\n \n   /* New operands for Armv8.1-M Mainline.  */\n   OP_LR,\t/* ARM LR register */\n+  OP_SP,\t/* ARM SP register */\n+  OP_R12,\n   OP_RRe,\t/* ARM register, only even numbered.  */\n   OP_RRo,\t/* ARM register, only odd numbered, not r13 or r15.  */\n   OP_RRnpcsp_I32, /* ARM register (no BadReg) or literal 1 .. 32 */\n@@ -7425,6 +7427,8 @@ parse_operands (char *str, const unsigned int *pattern, bool thumb)\n \tcase OP_RRo:\n \tcase OP_LR:\n \tcase OP_oLR:\n+\tcase OP_SP:\n+\tcase OP_R12:\n \tcase OP_RR:    po_reg_or_fail (REG_TYPE_RN);\t  break;\n \tcase OP_RCP:   po_reg_or_fail (REG_TYPE_CP);\t  break;\n \tcase OP_RCN:   po_reg_or_fail (REG_TYPE_CN);\t  break;\n@@ -8122,6 +8126,16 @@ parse_operands (char *str, const unsigned int *pattern, bool thumb)\n \t    inst.error = _(\"operand must be LR register\");\n \t  break;\n \n+\tcase OP_SP:\n+\t  if (inst.operands[i].reg != REG_SP)\n+\t    inst.error = _(\"operand must be SP register\");\n+\t  break;\n+\n+\tcase OP_R12:\n+\t  if (inst.operands[i].reg != REG_R12)\n+\t    inst.error = _(\"operand must be r12\");\n+\t  break;\n+\n \tcase OP_RMQRZ:\n \tcase OP_oRMQRZ:\n \tcase OP_RR_ZR:\n@@ -11491,6 +11505,7 @@ encode_thumb32_addr_mode (int i, bool is_t, bool is_d)\n   X(_negs,  4240, f1d00000), /* rsbs #0 */\t\\\n   X(_orr,   4300, ea400000),\t\t\t\\\n   X(_orrs,  4300, ea500000),\t\t\t\\\n+  X(_pacbti, 0000, f3af800d),\t\t\t\\\n   X(_pop,   bc00, e8bd0000), /* ldmia sp!,... */\t\\\n   X(_push,  b400, e92d0000), /* stmdb sp!,... */\t\\\n   X(_rev,   ba00, fa90f080),\t\t\t\\\n@@ -22317,6 +22332,12 @@ do_vmmla (void)\n   neon_three_args (1);\n }\n \n+static void\n+do_t_pacbti (void)\n+{\n+  inst.instruction = THUMB_OP32 (inst.instruction);\n+}\n+\n \f\n /* Overall per-instruction processing.\t*/\n \n@@ -26306,6 +26327,7 @@ static const struct asm_opcode insns[] =\n #undef  THUMB_VARIANT\n #define THUMB_VARIANT & arm_ext_v8_1m_main\n  ToU(\"bti\",   f3af800f, 0, (), noargs),\n+ toU(\"pacbti\", _pacbti, 3, (R12, LR, SP), t_pacbti),\n  toU(\"cinc\",  _cinc,  3, (RRnpcsp, RR_ZR, COND),\tt_cond),\n  toU(\"cinv\",  _cinv,  3, (RRnpcsp, RR_ZR, COND),\tt_cond),\n  toU(\"cneg\",  _cneg,  3, (RRnpcsp, RR_ZR, COND),\tt_cond),"
    },
    {
      "sha": "77638ee3f62e649000e27fcba3ac31ab93a0292a",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.d",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.d?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -0,0 +1,5 @@\n+#name: Invalid Armv8.1-M pointer authentication and branch target identification extention\n+#skip: *-*-pe\n+#source: armv8_1-m-pacbti-bad.s\n+#as: -march=armv8.1-m.main\n+#error_output: armv8_1-m-pacbti-bad.l"
    },
    {
      "sha": "a812603d88d122776c1a95479c06cba61251f05d",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.l",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.l?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -0,0 +1,4 @@\n+.*: Assembler messages:\n+.*:6: Error: operand must be r12 -- `pacbti r11,lr,sp'\n+.*:7: Error: operand must be LR register -- `pacbti r12,r10,sp'\n+.*:8: Error: operand must be SP register -- `pacbti r12,lr,r10'"
    },
    {
      "sha": "64e71e70c115a4bb67fcca24296f4ce338f52684",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.s",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-pacbti-bad.s?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -0,0 +1,8 @@\n+\t.syntax unified\n+\t.text\n+\t.thumb\n+.Lstart:\n+\tbti\n+\tpacbti\tr11, lr, sp\n+\tpacbti\tr12, r10, sp\n+\tpacbti\tr12, lr, r10"
    },
    {
      "sha": "593ac34ed49872c58c9763f186a132c5dedc577b",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-pacbti.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-pacbti.d?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -7,4 +7,5 @@\n \n Disassembly of section .text:\n 0[0-9a-f]+ <[^>]+> f3af 800f \tbti\n+0[0-9a-f]+ <[^>]+> f3af 800d \tpacbti\tr12, lr, sp\n #..."
    },
    {
      "sha": "39db4542e39612fe7dc6fb43cf2b24587e14890d",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-pacbti.s",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/gas/testsuite/gas/arm/armv8_1-m-pacbti.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-pacbti.s?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -3,3 +3,4 @@\n \t.thumb\n .Lstart:\n \tbti\n+\tpacbti\tr12, lr, sp"
    },
    {
      "sha": "34b0ace58bc4842bc8b7cf7ebddd56d5b87beda5",
      "filename": "opcodes/arm-dis.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/opcodes/arm-dis.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1e1d7f305e9c6f76297863ac454b09ceee5e4be/opcodes/arm-dis.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/arm-dis.c?ref=f1e1d7f305e9c6f76297863ac454b09ceee5e4be",
      "patch": "@@ -4656,6 +4656,8 @@ static const struct opcode32 thumb32_opcodes[] =\n      Identification Extension.  */\n   {ARM_FEATURE_CORE_HIGH (ARM_EXT2_V8_1M_MAIN),\n    0xf3af800f, 0xffffffff, \"bti\"},\n+  {ARM_FEATURE_CORE_HIGH (ARM_EXT2_V8_1M_MAIN),\n+   0xf3af800d, 0xffffffff, \"pacbti\\tr12, lr, sp\"},\n \n   /* Armv8.1-M Mainline and Armv8.1-M Mainline Security Extensions\n      instructions.  */"
    }
  ]
}