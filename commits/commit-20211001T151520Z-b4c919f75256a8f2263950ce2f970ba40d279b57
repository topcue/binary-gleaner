{
  "sha": "b4c919f75256a8f2263950ce2f970ba40d279b57",
  "node_id": "C_kwDOANOeidoAKGI0YzkxOWY3NTI1NmE4ZjIyNjM5NTBjZTJmOTcwYmE0MGQyNzliNTc",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-10-01T15:15:20Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-10-01T15:15:20Z"
    },
    "message": "[gdb/symtab] Fix htab_find_slot call in read_call_site_scope\n\nIn read_call_site_scope we have:\n...\n  call_site_local.pc = pc;\n  slot = htab_find_slot (cu->call_site_htab, &call_site_local, INSERT);\n...\n\nThe call passes a call_site pointer as element.  OTOH, the hashtab is created\nusing hash_f == core_addr_hash and eq_f == core_addr_eq, so the element\nwill be accessed through a CORE_ADDR pointer.\n\nThis is not wrong (at least in C), given that pc is the first field in\ncall_site.\n\nNevertheless, as in call_site_for_pc, make the htab_find_slot call match the\nused hash_f and eq_f by using &pc instead:\n...\n  slot = htab_find_slot (cu->call_site_htab, &pc, INSERT);\n...\n\nTested on x86_64-linux.\n\nCo-Authored-By: Tom de Vries <tdevries@suse.de>",
    "tree": {
      "sha": "ef15543e80a88c36798131be2e055ccc9db841e1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ef15543e80a88c36798131be2e055ccc9db841e1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b4c919f75256a8f2263950ce2f970ba40d279b57",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4c919f75256a8f2263950ce2f970ba40d279b57",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b4c919f75256a8f2263950ce2f970ba40d279b57",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4c919f75256a8f2263950ce2f970ba40d279b57/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "242fe37867ce33d8f8158bc2ee154d1e2e026a49",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/242fe37867ce33d8f8158bc2ee154d1e2e026a49",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/242fe37867ce33d8f8158bc2ee154d1e2e026a49"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 3,
    "deletions": 6
  },
  "files": [
    {
      "sha": "b9b62b40a222d02a6d8bde3ccadef1fbdb101f1d",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c919f75256a8f2263950ce2f970ba40d279b57/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c919f75256a8f2263950ce2f970ba40d279b57/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=b4c919f75256a8f2263950ce2f970ba40d279b57",
      "patch": "@@ -13341,7 +13341,7 @@ read_call_site_scope (struct die_info *die, struct dwarf2_cu *cu)\n   struct gdbarch *gdbarch = objfile->arch ();\n   CORE_ADDR pc, baseaddr;\n   struct attribute *attr;\n-  struct call_site *call_site, call_site_local;\n+  struct call_site *call_site;\n   void **slot;\n   int nparams;\n   struct die_info *child_die;\n@@ -13369,8 +13369,7 @@ read_call_site_scope (struct die_info *die, struct dwarf2_cu *cu)\n     cu->call_site_htab = htab_create_alloc_ex (16, core_addr_hash, core_addr_eq,\n \t\t\t\t\t       NULL, &objfile->objfile_obstack,\n \t\t\t\t\t       hashtab_obstack_allocate, NULL);\n-  call_site_local.pc = pc;\n-  slot = htab_find_slot (cu->call_site_htab, &call_site_local, INSERT);\n+  slot = htab_find_slot (cu->call_site_htab, &pc, INSERT);\n   if (*slot != NULL)\n     {\n       complaint (_(\"Duplicate PC %s for DW_TAG_call_site \""
    },
    {
      "sha": "6d09576208d87e702811e9c1760a56a7b713d452",
      "filename": "gdb/gdbtypes.h",
      "status": "modified",
      "additions": 1,
      "deletions": 3,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4c919f75256a8f2263950ce2f970ba40d279b57/gdb/gdbtypes.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4c919f75256a8f2263950ce2f970ba40d279b57/gdb/gdbtypes.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbtypes.h?ref=b4c919f75256a8f2263950ce2f970ba40d279b57",
      "patch": "@@ -1793,9 +1793,7 @@ struct call_site_parameter\n \n struct call_site\n   {\n-    /* * Address of the first instruction after this call.  It must be\n-       the first field as we overload core_addr_hash and core_addr_eq\n-       for it.  */\n+    /* Address of the first instruction after this call.  */\n \n     CORE_ADDR pc;\n "
    }
  ]
}