{
  "sha": "b44d87d4424324cb7a88b314f3a178694581a831",
  "node_id": "C_kwDOANOeidoAKGI0NGQ4N2Q0NDI0MzI0Y2I3YTg4YjMxNGYzYTE3ODY5NDU4MWE4MzE",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-11-03T14:46:56Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-11-03T14:46:56Z"
    },
    "message": "gdb/testsuite: set ASAN_OPTIONS=detect_leaks=0 while running tests\n\nWe see some additional failures when running the testsuite against a GDB\ncompiled with ASan, compared to a GDB compiled without ASan.  Some of\nthem are caused by the memory leak report shown by the GDB process when\nit exits, and the fact that it makes it exit with a non-zero exit code.\n\nI generally try to remember to set ASAN_OPTIONS=detect_leaks=0 in my\nenvironment when running the tests, but I don't always do it.  I think\nit would be nice if the testsuite did it.  I don't see any use to have\nleak detection when running the tests.  That is, unless we ever have a\ntest that ensures GDB doesn't leak memory, which isn't going to happen\nany time soon.\n\nHere are some tests I found that were affected by this:\n\n    gdb.base/batch-exit-status.exp\n    gdb.base/many-headers.exp\n    gdb.base/quit.exp\n    gdb.base/with-mf.exp\n    gdb.dwarf2/gdb-add-index.exp\n    gdb.dwarf2/gdb-add-index-symlink.exp\n    gdb.dwarf2/imported-unit-runto-main.exp\n\nChange-Id: I784c7df8a13979eb96587f735c1d33ba2cc6e0ca",
    "tree": {
      "sha": "066d6eaa1997a1a9841085fefb7755d12349ff3a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/066d6eaa1997a1a9841085fefb7755d12349ff3a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b44d87d4424324cb7a88b314f3a178694581a831",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b44d87d4424324cb7a88b314f3a178694581a831",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b44d87d4424324cb7a88b314f3a178694581a831",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b44d87d4424324cb7a88b314f3a178694581a831/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "dac784d0e4cb7255646ea298b39a5443055a4bb2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dac784d0e4cb7255646ea298b39a5443055a4bb2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/dac784d0e4cb7255646ea298b39a5443055a4bb2"
    }
  ],
  "stats": {
    "total": 7,
    "additions": 7,
    "deletions": 0
  },
  "files": [
    {
      "sha": "97bedd5cb583a855f20d5e4397262d433169da7e",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b44d87d4424324cb7a88b314f3a178694581a831/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b44d87d4424324cb7a88b314f3a178694581a831/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=b44d87d4424324cb7a88b314f3a178694581a831",
      "patch": "@@ -25,6 +25,13 @@ if {$tool == \"\"} {\n     exit 2\n }\n \n+# If GDB is built with ASAN (and because there are leaks), it will output a\n+# leak report when exiting as well as exit with a non-zero (failure) status.\n+# This can affect tests that are sensitive to what GDB prints on stderr or its\n+# exit status.  Add `detect_leaks=0` to the ASAN_OPTIONS environment variable\n+# (which will affect any spawned sub-process) to avoid this.\n+append ::env(ASAN_OPTIONS) \",detect_leaks=0\"\n+\n # List of procs to run in gdb_finish.\n set gdb_finish_hooks [list]\n "
    }
  ]
}