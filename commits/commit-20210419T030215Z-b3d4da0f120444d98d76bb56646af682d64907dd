{
  "sha": "b3d4da0f120444d98d76bb56646af682d64907dd",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjNkNGRhMGYxMjA0NDRkOThkNzZiYjU2NjQ2YWY2ODJkNjQ5MDdkZA==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-19T02:35:19Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-19T03:02:15Z"
    },
    "message": "sim: rx: switch syscalls to common nltvals\n\nRather than hand duplicate the syscall table, switch to the common\nnltvals framework.  We have to tweak the constant names, but we get\neverything else for free.  I made sure the constants have the same\nvalues before & after too :).",
    "tree": {
      "sha": "9864165a9c9a408e9abdc016f5224de08837d387",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9864165a9c9a408e9abdc016f5224de08837d387"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b3d4da0f120444d98d76bb56646af682d64907dd",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3d4da0f120444d98d76bb56646af682d64907dd",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b3d4da0f120444d98d76bb56646af682d64907dd",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3d4da0f120444d98d76bb56646af682d64907dd/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f956ecde56495cbcd5f8a3b440220090ee39ff56"
    }
  ],
  "stats": {
    "total": 121,
    "additions": 59,
    "deletions": 62
  },
  "files": [
    {
      "sha": "f0827b283a6f8e9f4f02c89ad652b00e6097a589",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d4da0f120444d98d76bb56646af682d64907dd/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d4da0f120444d98d76bb56646af682d64907dd/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=b3d4da0f120444d98d76bb56646af682d64907dd",
      "patch": "@@ -1,3 +1,8 @@\n+2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* gennltvals.py (TARGETS): Add rx.\n+\t* nltvals.def: Regenerate.\n+\n 2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n \n \t* gennltvals.py (TARGETS): Add m32c."
    },
    {
      "sha": "bf0aaa484adf7b8534ee1ff5d22ea1483facebb3",
      "filename": "sim/common/gennltvals.py",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d4da0f120444d98d76bb56646af682d64907dd/sim/common/gennltvals.py",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d4da0f120444d98d76bb56646af682d64907dd/sim/common/gennltvals.py",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/gennltvals.py?ref=b3d4da0f120444d98d76bb56646af682d64907dd",
      "patch": "@@ -70,6 +70,7 @@\n     'msp430',\n     'pru',\n     'riscv',\n+    'rx',\n     'sparc',\n     'v850',\n }"
    },
    {
      "sha": "fbaee3abc6460594d19d024ebb1c951901bc8dea",
      "filename": "sim/common/nltvals.def",
      "status": "modified",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d4da0f120444d98d76bb56646af682d64907dd/sim/common/nltvals.def",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d4da0f120444d98d76bb56646af682d64907dd/sim/common/nltvals.def",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/nltvals.def?ref=b3d4da0f120444d98d76bb56646af682d64907dd",
      "patch": "@@ -657,6 +657,37 @@\n /* end riscv sys target macros */\n #endif\n #endif\n+#ifdef NL_TARGET_rx\n+#ifdef sys_defs\n+/* from syscall.h */\n+/* begin rx sys target macros */\n+ { \"SYS_argc\", 22 },\n+ { \"SYS_argn\", 24 },\n+ { \"SYS_argnlen\", 23 },\n+ { \"SYS_argv\", 13 },\n+ { \"SYS_argvlen\", 12 },\n+ { \"SYS_chdir\", 14 },\n+ { \"SYS_chmod\", 16 },\n+ { \"SYS_close\", 3 },\n+ { \"SYS_exit\", 1 },\n+ { \"SYS_fstat\", 10 },\n+ { \"SYS_getpid\", 8 },\n+ { \"SYS_gettimeofday\", 19 },\n+ { \"SYS_kill\", 9 },\n+ { \"SYS_link\", 21 },\n+ { \"SYS_lseek\", 6 },\n+ { \"SYS_open\", 2 },\n+ { \"SYS_read\", 4 },\n+ { \"SYS_reconfig\", 25 },\n+ { \"SYS_stat\", 15 },\n+ { \"SYS_time\", 18 },\n+ { \"SYS_times\", 20 },\n+ { \"SYS_unlink\", 7 },\n+ { \"SYS_utime\", 17 },\n+ { \"SYS_write\", 5 },\n+/* end rx sys target macros */\n+#endif\n+#endif\n #ifdef NL_TARGET_sparc\n #ifdef sys_defs\n /* from syscall.h */"
    },
    {
      "sha": "6660671bca249b9db1bbe00a089d1c000aaddbba",
      "filename": "sim/rx/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d4da0f120444d98d76bb56646af682d64907dd/sim/rx/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d4da0f120444d98d76bb56646af682d64907dd/sim/rx/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/rx/ChangeLog?ref=b3d4da0f120444d98d76bb56646af682d64907dd",
      "patch": "@@ -1,3 +1,11 @@\n+2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* Makefile.in (NL_TARGET): Define.\n+\t(syscalls.o): Delete syscall.h.\n+\t* syscalls.c: Change syscall.h include to targ-vals.h.\n+\t(rx_syscall): Add TARGET_ prefix to all SYS_ constants.\n+\t* syscall.h: Removed.\n+\n 2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n \n \t* configure: Regenerate."
    },
    {
      "sha": "3c6094caf2e78a58be7c53076994ffbf301bf76a",
      "filename": "sim/rx/Makefile.in",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d4da0f120444d98d76bb56646af682d64907dd/sim/rx/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d4da0f120444d98d76bb56646af682d64907dd/sim/rx/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/rx/Makefile.in?ref=b3d4da0f120444d98d76bb56646af682d64907dd",
      "patch": "@@ -18,6 +18,9 @@\n ### You should have received a copy of the GNU General Public License\n ### along with the GNU simulators; if not, see <http://www.gnu.org/licenses/>.\n \n+# This selects the newlib/libgloss syscall definitions.\n+NL_TARGET = -DNL_TARGET_rx\n+\n ## COMMON_PRE_CONFIG_FRAG\n \n SIM_EXTRA_CFLAGS = -Wall\n@@ -58,5 +61,5 @@ mem.o : mem.h cpu.h syscalls.h misc.h err.h\n misc.o : cpu.h misc.h\n reg.o : cpu.h trace.h\n rx.o : $(srcdir)/../../include/opcode/rx.h cpu.h mem.h syscalls.h fpu.h\n-syscalls.o : $(srcdir)/../../include/gdb/callback.h cpu.h mem.h syscalls.h syscall.h\n+syscalls.o : $(srcdir)/../../include/gdb/callback.h cpu.h mem.h syscalls.h\n trace.o : ../../bfd/bfd.h $(srcdir)/../../include/dis-asm.h cpu.h mem.h load.h"
    },
    {
      "sha": "0194e039e7fe86758bf8fc788ff70449f25903c0",
      "filename": "sim/rx/syscall.h",
      "status": "removed",
      "additions": 0,
      "deletions": 50,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/rx/syscall.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/rx/syscall.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/rx/syscall.h?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -1,50 +0,0 @@\n-/* Copied from libgloss */\n-/* General use syscall.h file.\n-   The more ports that use this file, the simpler sim/common/nltvals.def\n-   remains.  */\n-\n-#ifndef LIBGLOSS_SYSCALL_H\n-#define LIBGLOSS_SYSCALL_H\n-\n-/* Note: This file may be included by assembler source.  */\n-\n-/* These should be as small as possible to allow a port to use a trap type\n-   instruction, which the system call # as the trap (the d10v for instance\n-   supports traps 0..31).  An alternative would be to define one trap for doing\n-   system calls, and put the system call number in a register that is not used\n-   for the normal calling sequence (so that you don't have to shift down the\n-   arguments to add the system call number).  Obviously, if these system call\n-   numbers are ever changed, all of the simulators and potentially user code\n-   will need to be updated.  */\n-\n-/* There is no current need for the following: SYS_execv, SYS_creat, SYS_wait,\n-   etc. etc.  Don't add them.  */\n-\n-/* These are required by the ANSI C part of newlib (excluding system() of\n-   course).  */\n-#define\tSYS_exit\t1\n-#define\tSYS_open\t2\n-#define\tSYS_close\t3\n-#define\tSYS_read\t4\n-#define\tSYS_write\t5\n-#define\tSYS_lseek\t6\n-#define\tSYS_unlink\t7\n-#define\tSYS_getpid\t8\n-#define\tSYS_kill\t9\n-#define SYS_fstat       10\n-/*#define SYS_sbrk\t11 - not currently a system call, but reserved.  */\n-\n-/* ARGV support.  */\n-#define SYS_argvlen\t12\n-#define SYS_argv\t13\n-\n-/* These are extras added for one reason or another.  */\n-#define SYS_chdir\t 14\n-#define SYS_stat\t 15\n-#define SYS_chmod \t 16\n-#define SYS_utime \t 17\n-#define SYS_time \t 18\n-#define SYS_gettimeofday 19\n-#define SYS_times\t 20\n-#define SYS_link\t 21\n-#endif"
    },
    {
      "sha": "0c75c7dcdf8ab10cbaf52ba4209b75ba16231d37",
      "filename": "sim/rx/syscalls.c",
      "status": "modified",
      "additions": 10,
      "deletions": 11,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d4da0f120444d98d76bb56646af682d64907dd/sim/rx/syscalls.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d4da0f120444d98d76bb56646af682d64907dd/sim/rx/syscalls.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/rx/syscalls.c?ref=b3d4da0f120444d98d76bb56646af682d64907dd",
      "patch": "@@ -31,8 +31,7 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n #include \"cpu.h\"\n #include \"mem.h\"\n #include \"syscalls.h\"\n-\n-#include \"syscall.h\"\n+#include \"targ-vals.h\"\n \n /* The current syscall callbacks we're using.  */\n static struct host_callback_struct *callbacks;\n@@ -146,10 +145,10 @@ rx_syscall (int id)\n   argp = 0;\n   stackp = 4;\n   if (trace)\n-    printf (\"\\033[31m/* SYSCALL(%d) = %s */\\033[0m\\n\", id, id <= SYS_link ? callnames[id] : \"unknown\");\n+    printf (\"\\033[31m/* SYSCALL(%d) = %s */\\033[0m\\n\", id, id <= TARGET_SYS_link ? callnames[id] : \"unknown\");\n   switch (id)\n     {\n-    case SYS_exit:\n+    case TARGET_SYS_exit:\n       {\n \tint ec = arg ();\n \tif (verbose)\n@@ -158,7 +157,7 @@ rx_syscall (int id)\n       }\n       break;\n \n-    case SYS_open:\n+    case TARGET_SYS_open:\n       {\n \tint oflags, cflags;\n \tint path = arg ();\n@@ -200,7 +199,7 @@ rx_syscall (int id)\n       }\n       break;\n \n-    case SYS_close:\n+    case TARGET_SYS_close:\n       {\n \tint fd = arg ();\n \n@@ -216,7 +215,7 @@ rx_syscall (int id)\n       }\n       break;\n \n-    case SYS_read:\n+    case TARGET_SYS_read:\n       {\n \tint fd = arg ();\n \tint addr = arg ();\n@@ -236,7 +235,7 @@ rx_syscall (int id)\n       }\n       break;\n \n-    case SYS_write:\n+    case TARGET_SYS_write:\n       {\n \tint fd = arg ();\n \tint addr = arg ();\n@@ -259,11 +258,11 @@ rx_syscall (int id)\n       }\n       break;\n \n-    case SYS_getpid:\n+    case TARGET_SYS_getpid:\n       put_reg (1, 42);\n       break;\n \n-    case SYS_gettimeofday:\n+    case TARGET_SYS_gettimeofday:\n       {\n \tint tvaddr = arg ();\n \tstruct timeval tv;\n@@ -278,7 +277,7 @@ rx_syscall (int id)\n       }\n       break;\n \n-    case SYS_kill:\n+    case TARGET_SYS_kill:\n       {\n \tint pid = arg ();\n \tint sig = arg ();"
    }
  ]
}