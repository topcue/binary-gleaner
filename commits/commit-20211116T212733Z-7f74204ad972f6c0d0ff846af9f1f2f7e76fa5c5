{
  "sha": "7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5",
  "node_id": "C_kwDOANOeidoAKDdmNzQyMDRhZDk3MmY2YzBkMGZmODQ2YWY5ZjFmMmY3ZTc2ZmE1YzU",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-11-08T21:06:06Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-11-16T21:27:33Z"
    },
    "message": "gdb: fix length of array view returned by some value_contents functions\n\nIn commit 50888e42dcd3 (\"gdb: change functions returning value contents\nto use gdb::array_view\"), I believe I made a mistake with the length of\nthe array views returned by some functions.  All functions return a view\nof `TYPE_LENGTH (value_type (type))` length.  This is not correct when\nthe value's enclosing type is larger than the value's type.  In that\ncase, the value's contents buffer is of the size of the enclosing type,\nand the value's actual contents is a slice of that (as returned by\nvalue_contents).  So, functions value_contents_all_raw,\nvalue_contents_for_printing and value_contents_for_printing_const are\nnot correct.  Since they are meant to return the value's contents buffer\nas a whole, they should have the size of the enclosing type.\n\nThere is nothing that uses the returned array view size at the moment,\nso this didn't cause a problem.  But it became apparent when trying to\nadjust some callers.\n\nChange-Id: Ib4e8837e1069111d2b2784d3253d5f3002419e68",
    "tree": {
      "sha": "931058a66870fbfcdcde3b48240b2e6beb9f4cc7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/931058a66870fbfcdcde3b48240b2e6beb9f4cc7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a7fd11862703e45d2774981a4888bc127d473b06",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7fd11862703e45d2774981a4888bc127d473b06",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a7fd11862703e45d2774981a4888bc127d473b06"
    }
  ],
  "stats": {
    "total": 6,
    "additions": 3,
    "deletions": 3
  },
  "files": [
    {
      "sha": "7649b029f91b714cb6c7bb00396e7fca09da2d25",
      "filename": "gdb/value.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5/gdb/value.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5/gdb/value.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/value.c?ref=7f74204ad972f6c0d0ff846af9f1f2f7e76fa5c5",
      "patch": "@@ -1164,7 +1164,7 @@ value_contents_all_raw (struct value *value)\n {\n   allocate_value_contents (value);\n \n-  ULONGEST length = TYPE_LENGTH (value_type (value));\n+  ULONGEST length = TYPE_LENGTH (value_enclosing_type (value));\n   return gdb::make_array_view (value->contents.get (), length);\n }\n \n@@ -1250,7 +1250,7 @@ value_contents_for_printing (struct value *value)\n   if (value->lazy)\n     value_fetch_lazy (value);\n \n-  ULONGEST length = TYPE_LENGTH (value_type (value));\n+  ULONGEST length = TYPE_LENGTH (value_enclosing_type (value));\n   return gdb::make_array_view (value->contents.get (), length);\n }\n \n@@ -1259,7 +1259,7 @@ value_contents_for_printing_const (const struct value *value)\n {\n   gdb_assert (!value->lazy);\n \n-  ULONGEST length = TYPE_LENGTH (value_type (value));\n+  ULONGEST length = TYPE_LENGTH (value_enclosing_type (value));\n   return gdb::make_array_view (value->contents.get (), length);\n }\n "
    }
  ]
}