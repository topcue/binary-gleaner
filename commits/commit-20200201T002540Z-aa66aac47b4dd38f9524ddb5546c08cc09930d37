{
  "sha": "aa66aac47b4dd38f9524ddb5546c08cc09930d37",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YWE2NmFhYzQ3YjRkZDM4Zjk1MjRkZGI1NTQ2YzA4Y2MwOTkzMGQzNw==",
  "commit": {
    "author": {
      "name": "Shahab Vahedi",
      "email": "shahab@synopsys.com",
      "date": "2020-01-31T22:10:11Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-02-01T00:25:40Z"
    },
    "message": "gdb: Do not print empty-group regs when printing general ones\n\nWhen the command \"info registers\" (same as \"info registers general\"),\nis issued, _all_ the registers from a tdesc XML are printed. This\nincludes the registers with empty register groups (set as \"\") which\nare supposed to be only printed by \"info registers all\" (or \"info\nall-registers\").\n\nThis bug got introduced after all the overhauls that the\ntdesc_register_in_reggroup_p() went through. You can see that the\nlogic of tdesc_register_in_reggroup_p() did NOT remain the same after\nall those changes:\n\n  git difftool c9c895b9666..HEAD -- gdb/target-descriptions.c\n\nWith the current implementation, when the reg->group is an empty\nstring, this function returns -1, while in the working revision\n(c9c895b9666), it returned 0. This patch makes sure that the 0 is\nreturned again.\n\nThe old implementation of tdesc_register_in_reggroup_p() returned\n-1 when \"reggroup\" was set to \"all_reggroups\" at line 4 below:\n\n1  tdesc_register_reggroup_p (...)\n2  {\n3   ...\n4   ret = tdesc_register_in_reggroup_p (gdbarch, regno, reggroup);\n5   if (ret != -1)\n6     return ret;\n7\n8   return default_register_reggroup_p (gdbarch, regno, reggroup);\n9  }\n\nAs a result, the execution continued at line 8 and the\ndefault_register_reggroup_p(..., reggroup=all_reggroups) would\nreturn 1. However, with the current implementation of\ntdesc_register_in_reggroup_p() that allows checking against any\narbitrary group name, it returns 0 when comparing the \"reg->group\"\nagainst the string \"all\" which is the group name for \"all_reggroups\".\nI have added a special check to cover this case and\n\"info all-registers\" works as expected.\n\ngdb/ChangeLog:\n\n\t* target-descriptions.c (tdesc_register_in_reggroup_p): Return 0\n\twhen reg->group is empty and reggroup is not.\n\nChange-Id: I9eaf9d7fb36410ed5684ae652fe4756b1b2e61a3",
    "tree": {
      "sha": "2aeaddfaaa80a32d72942ecdc5e809d7349acb04",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2aeaddfaaa80a32d72942ecdc5e809d7349acb04"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/aa66aac47b4dd38f9524ddb5546c08cc09930d37",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa66aac47b4dd38f9524ddb5546c08cc09930d37",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/aa66aac47b4dd38f9524ddb5546c08cc09930d37",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa66aac47b4dd38f9524ddb5546c08cc09930d37/comments",
  "author": null,
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0ae34fc20afe98b9dc8230e3aab8118eacc92624",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0ae34fc20afe98b9dc8230e3aab8118eacc92624",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0ae34fc20afe98b9dc8230e3aab8118eacc92624"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 13,
    "deletions": 5
  },
  "files": [
    {
      "sha": "81a3b9c1dea8d0680b7f87853392a171b3686a1a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa66aac47b4dd38f9524ddb5546c08cc09930d37/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa66aac47b4dd38f9524ddb5546c08cc09930d37/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=aa66aac47b4dd38f9524ddb5546c08cc09930d37",
      "patch": "@@ -1,3 +1,8 @@\n+2020-02-01  Shahab Vahedi  <shahab@synopsys.com>\n+\n+\t* target-descriptions.c (tdesc_register_in_reggroup_p): Return 0\n+\twhen reg->group is empty and reggroup is not.\n+\n 2020-01-31  Tom Tromey  <tromey@adacore.com>\n \n \t* ravenscar-thread.c (ravenscar_thread_target::mourn_inferior):"
    },
    {
      "sha": "06f42a1b95d05df1380af082fd2ccc7407cd60c9",
      "filename": "gdb/target-descriptions.c",
      "status": "modified",
      "additions": 8,
      "deletions": 5,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa66aac47b4dd38f9524ddb5546c08cc09930d37/gdb/target-descriptions.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa66aac47b4dd38f9524ddb5546c08cc09930d37/gdb/target-descriptions.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target-descriptions.c?ref=aa66aac47b4dd38f9524ddb5546c08cc09930d37",
      "patch": "@@ -977,13 +977,16 @@ tdesc_register_in_reggroup_p (struct gdbarch *gdbarch, int regno,\n {\n   struct tdesc_reg *reg = tdesc_find_register (gdbarch, regno);\n \n-  if (reg != NULL && !reg->group.empty ()\n-      && (reg->group == reggroup_name (reggroup)))\n+  if (reg != NULL)\n+    {\n+      if (reggroup == all_reggroup)\n \treturn 1;\n \n-  if (reg != NULL\n-      && (reggroup == save_reggroup || reggroup == restore_reggroup))\n-    return reg->save_restore;\n+      else if (reggroup == save_reggroup || reggroup == restore_reggroup)\n+\treturn reg->save_restore;\n+      else\n+\treturn (int) (reg->group == reggroup_name (reggroup));\n+    }\n \n   return -1;\n }"
    }
  ]
}