{
  "sha": "cabb5f067daa9227bf0323cbf64c6065d6e4796f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2FiYjVmMDY3ZGFhOTIyN2JmMDMyM2NiZjY0YzYwNjVkNmU0Nzk2Zg==",
  "commit": {
    "author": {
      "name": "Thomas Schwinge",
      "email": "thomas@codesourcery.com",
      "date": "2019-02-13T11:02:20Z"
    },
    "committer": {
      "name": "Thomas Schwinge",
      "email": "thomas@codesourcery.com",
      "date": "2019-02-14T15:02:33Z"
    },
    "message": "[gdb, hurd] Work around conflict between Mach's 'thread_info' function, and GDB's 'thread_info' class\n\n    In file included from ./nm.h:25:0,\n                     from [...]/gdb/defs.h:423,\n                     from [...]/gdb/gdb.c:19:\n    [...]/gdb/regcache.h:35:46: warning: 'get_thread_regcache' initialized and declared 'extern'\n     extern struct regcache *get_thread_regcache (thread_info *thread);\n                                                  ^~~~~~~~~~~\n    [...]/gdb/regcache.h:35:46: error: 'regcache* get_thread_regcache' redeclared as different kind of symbol\n    [...]\n    [...]/gdb/gdbarch.h:1203:69: error: 'thread_info' is not a type\n     extern LONGEST gdbarch_get_syscall_number (struct gdbarch *gdbarch, thread_info *thread);\n                                                                         ^~~~~~~~~~~\n\nFixed with a different (self-contained, more maintainable?) approach compared\nto what has been done in commit 7aabaf9d4ad52a1df1f551908fbd8cafc5e7597a\n\"Create private_thread_info hierarchy\", and commit\n75cbc781e371279f4403045be93b07fd8fe7fde5 \"gdb: For macOS, s/thread_info/struct\nthread_info/\".  We don't want to change all the GDB code to everywhere use\n'class thread_info' or 'struct thread_info' instead of plain 'thread_info'.\n\n\tgdb/\n\t* config/i386/nm-i386gnu.h: Don't \"#include\" any files.\n\t* gnu-nat.h (mach_thread_info): New function.\n\t* gnu-nat.c (thread_takeover_sc_cmd): Use it.",
    "tree": {
      "sha": "62f96bd6149e954c4e635588e79d95264199220c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/62f96bd6149e954c4e635588e79d95264199220c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/cabb5f067daa9227bf0323cbf64c6065d6e4796f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cabb5f067daa9227bf0323cbf64c6065d6e4796f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/cabb5f067daa9227bf0323cbf64c6065d6e4796f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cabb5f067daa9227bf0323cbf64c6065d6e4796f/comments",
  "author": {
    "login": "tschwinge",
    "id": 21753,
    "node_id": "MDQ6VXNlcjIxNzUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tschwinge",
    "html_url": "https://github.com/tschwinge",
    "followers_url": "https://api.github.com/users/tschwinge/followers",
    "following_url": "https://api.github.com/users/tschwinge/following{/other_user}",
    "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions",
    "organizations_url": "https://api.github.com/users/tschwinge/orgs",
    "repos_url": "https://api.github.com/users/tschwinge/repos",
    "events_url": "https://api.github.com/users/tschwinge/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tschwinge/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tschwinge",
    "id": 21753,
    "node_id": "MDQ6VXNlcjIxNzUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/21753?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tschwinge",
    "html_url": "https://github.com/tschwinge",
    "followers_url": "https://api.github.com/users/tschwinge/followers",
    "following_url": "https://api.github.com/users/tschwinge/following{/other_user}",
    "gists_url": "https://api.github.com/users/tschwinge/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tschwinge/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tschwinge/subscriptions",
    "organizations_url": "https://api.github.com/users/tschwinge/orgs",
    "repos_url": "https://api.github.com/users/tschwinge/repos",
    "events_url": "https://api.github.com/users/tschwinge/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tschwinge/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b1041ae0ae8a2f1c51e75b45004686f1956078ed",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b1041ae0ae8a2f1c51e75b45004686f1956078ed",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b1041ae0ae8a2f1c51e75b45004686f1956078ed"
    }
  ],
  "stats": {
    "total": 37,
    "additions": 27,
    "deletions": 10
  },
  "files": [
    {
      "sha": "c88216b94b730a934f9ef9d90053f4d00622c0bc",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=cabb5f067daa9227bf0323cbf64c6065d6e4796f",
      "patch": "@@ -1,5 +1,9 @@\n 2019-02-14  Thomas Schwinge  <thomas@codesourcery.com>\n \n+\t* config/i386/nm-i386gnu.h: Don't \"#include\" any files.\n+\t* gnu-nat.h (mach_thread_info): New function.\n+\t* gnu-nat.c (thread_takeover_sc_cmd): Use it.\n+\n \t* config/i386/nm-i386gnu.h (gnu_target_pid_to_str): Remove.\n \n 2019-02-14  Frederic Konrad  <konrad@adacore.com>"
    },
    {
      "sha": "e859b23f2b23b6b2aa2e9c7db086d819957414a6",
      "filename": "gdb/config/i386/nm-i386gnu.h",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/config/i386/nm-i386gnu.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/config/i386/nm-i386gnu.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/config/i386/nm-i386gnu.h?ref=cabb5f067daa9227bf0323cbf64c6065d6e4796f",
      "patch": "@@ -19,11 +19,6 @@\n #ifndef CONFIG_I386_NM_I386GNU_H\n #define CONFIG_I386_NM_I386GNU_H\n \n-#include <unistd.h>\n-#include <mach.h>\n-#include <mach/exception.h>\n-#include \"regcache.h\"\n-\n /* Thread flavors used in re-setting the T bit.  */\n #define THREAD_STATE_FLAVOR\t\ti386_REGS_SEGS_STATE\n #define THREAD_STATE_SIZE\t\ti386_THREAD_STATE_COUNT"
    },
    {
      "sha": "bd8fcb6e59bfdac162cfd5cf17facb77fda9a404",
      "filename": "gdb/gnu-nat.c",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/gnu-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/gnu-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gnu-nat.c?ref=cabb5f067daa9227bf0323cbf64c6065d6e4796f",
      "patch": "@@ -20,6 +20,9 @@\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n \n+/* Include this first, to pick up the <mach.h> 'thread_info' diversion.  */\n+#include \"gnu-nat.h\"\n+\n /* Mach/Hurd headers are not yet ready for C++ compilation.  */\n extern \"C\"\n {\n@@ -67,7 +70,6 @@ extern \"C\"\n #include \"gdb_obstack.h\"\n #include \"tid-parse.h\"\n \n-#include \"gnu-nat.h\"\n #include \"inf-child.h\"\n \n /* MIG stubs are not yet ready for C++ compilation.  */\n@@ -3429,8 +3431,9 @@ thread_takeover_sc_cmd (const char *args, int from_tty)\n   thread_basic_info_data_t _info;\n   thread_basic_info_t info = &_info;\n   mach_msg_type_number_t info_len = THREAD_BASIC_INFO_COUNT;\n-  kern_return_t err =\n-  thread_info (thread->port, THREAD_BASIC_INFO, (int *) &info, &info_len);\n+  kern_return_t err\n+    = mach_thread_info (thread->port, THREAD_BASIC_INFO,\n+\t\t\t(int *) &info, &info_len);\n   if (err)\n     error ((\"%s.\"), safe_strerror (err));\n   thread->sc = info->suspend_count;"
    },
    {
      "sha": "dbad0cac93f78577627f1fa77ba1f3fdf1944664",
      "filename": "gdb/gnu-nat.h",
      "status": "modified",
      "additions": 14,
      "deletions": 1,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/gnu-nat.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/gnu-nat.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gnu-nat.h?ref=cabb5f067daa9227bf0323cbf64c6065d6e4796f",
      "patch": "@@ -19,8 +19,21 @@\n #ifndef GNU_NAT_H\n #define GNU_NAT_H\n \n-#include <unistd.h>\n+#include \"defs.h\"\n+\n+/* Work around conflict between Mach's 'thread_info' function, and GDB's\n+   'thread_info' class.  Make the former available as 'mach_thread_info'.  */\n+#define thread_info mach_thread_info\n+/* Mach headers are not yet ready for C++ compilation.  */\n+extern \"C\"\n+{\n #include <mach.h>\n+}\n+#undef thread_info\n+/* Divert 'mach_thread_info' to the original Mach 'thread_info' function.  */\n+extern __typeof__ (mach_thread_info) mach_thread_info asm (\"thread_info\");\n+\n+#include <unistd.h>\n \n struct inf;\n "
    },
    {
      "sha": "c23c4bc79cfc18fd3b0003dd9bd1ac2e718514f1",
      "filename": "gdb/i386-gnu-nat.c",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/i386-gnu-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cabb5f067daa9227bf0323cbf64c6065d6e4796f/gdb/i386-gnu-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/i386-gnu-nat.c?ref=cabb5f067daa9227bf0323cbf64c6065d6e4796f",
      "patch": "@@ -17,6 +17,9 @@\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n \n+/* Include this first, to pick up the <mach.h> 'thread_info' diversion.  */\n+#include \"gnu-nat.h\"\n+\n /* Mach/Hurd headers are not yet ready for C++ compilation.  */\n extern \"C\"\n {\n@@ -34,7 +37,6 @@ extern \"C\"\n \n #include \"i386-tdep.h\"\n \n-#include \"gnu-nat.h\"\n #include \"inf-child.h\"\n #include \"i387-tdep.h\"\n "
    }
  ]
}