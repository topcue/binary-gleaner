{
  "sha": "766f883622ef008230250aa5aecef9fb9b29f233",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzY2Zjg4MzYyMmVmMDA4MjMwMjUwYWE1YWVjZWY5ZmI5YjI5ZjIzMw==",
  "commit": {
    "author": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-05-28T09:07:54Z"
    },
    "committer": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-05-28T09:07:54Z"
    },
    "message": "Suppress SIGTTOU when handling errors\n\nCalls to error () can cause SIGTTOU to send gdb to the background.\n\nFor example, on an Arm build:\n  (gdb) b main\n  Breakpoint 1 at 0x10774: file /build/gdb/testsuite/../../../src/binutils-gdb/gdb/testsuite/gdb.base/watchpoint.c, line 174.\n  (gdb) r\n  Starting program: /build/gdb/testsuite/outputs/gdb.base/watchpoint/watchpoint\n\n  [1]+  Stopped                 ../gdb ./outputs/gdb.base/watchpoint/watchpoint\n  localhost$ fg\n  ../gdb ./outputs/gdb.base/watchpoint/watchpoint\n  Cannot parse expression `.L1199 4@r4'.\n  warning: Probes-based dynamic linker interface failed.\n  Reverting to original interface.\n\nThe SIGTTOU is raised whilst inside a syscall during the call to tcdrain.\nFix is to use scoped_ignore_sigttou to ensure SIGTTOU is blocked.\n\nIn addition fix include comments - job_control is not included via terminal.h\n\ngdb/ChangeLog:\n\n\t* event-top.c: Remove include comment.\n\t* inflow.c (class scoped_ignore_sigttou): Move from here...\n\t* inflow.h (class scoped_ignore_sigttou): ...to here.\n\t* ser-unix.c (hardwire_drain_output): Block SIGTTOU during drain.\n\t* top.c:  Remove include comment.",
    "tree": {
      "sha": "e1302190a7dc0b839e38d03dfbc192af18701dd6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e1302190a7dc0b839e38d03dfbc192af18701dd6"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/766f883622ef008230250aa5aecef9fb9b29f233",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/766f883622ef008230250aa5aecef9fb9b29f233",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/766f883622ef008230250aa5aecef9fb9b29f233",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/766f883622ef008230250aa5aecef9fb9b29f233/comments",
  "author": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0f4a61b42002f568473f821f00dd240413beadd0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0f4a61b42002f568473f821f00dd240413beadd0",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0f4a61b42002f568473f821f00dd240413beadd0"
    }
  ],
  "stats": {
    "total": 76,
    "additions": 45,
    "deletions": 31
  },
  "files": [
    {
      "sha": "15fe856541aab5bf40c6ba359e8cf9e400a9ce4d",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/766f883622ef008230250aa5aecef9fb9b29f233/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/766f883622ef008230250aa5aecef9fb9b29f233/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=766f883622ef008230250aa5aecef9fb9b29f233",
      "patch": "@@ -1,3 +1,11 @@\n+2019-05-28  Alan Hayward  <alan.hayward@arm.com>\n+\n+\t* event-top.c: Remove include comment.\n+\t* inflow.c (class scoped_ignore_sigttou): Move from here...\n+\t* inflow.h (class scoped_ignore_sigttou): ...to here.\n+\t* ser-unix.c (hardwire_drain_output): Block SIGTTOU during drain.\n+\t* top.c:  Remove include comment.\n+\n 2019-05-27  Tom Tromey  <tom@tromey.com>\n \n \t* NEWS: Fix typo."
    },
    {
      "sha": "93b7d2d28bcdb924b44d9721922dd1af1cfe6155",
      "filename": "gdb/event-top.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/766f883622ef008230250aa5aecef9fb9b29f233/gdb/event-top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/766f883622ef008230250aa5aecef9fb9b29f233/gdb/event-top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/event-top.c?ref=766f883622ef008230250aa5aecef9fb9b29f233",
      "patch": "@@ -24,7 +24,7 @@\n #include \"inferior.h\"\n #include \"infrun.h\"\n #include \"target.h\"\n-#include \"terminal.h\"\t\t/* for job_control */\n+#include \"terminal.h\"\n #include \"event-loop.h\"\n #include \"event-top.h\"\n #include \"interps.h\""
    },
    {
      "sha": "eba7a931f467c3f97e1006136c3618941bc015fb",
      "filename": "gdb/inflow.c",
      "status": "modified",
      "additions": 0,
      "deletions": 29,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/766f883622ef008230250aa5aecef9fb9b29f233/gdb/inflow.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/766f883622ef008230250aa5aecef9fb9b29f233/gdb/inflow.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inflow.c?ref=766f883622ef008230250aa5aecef9fb9b29f233",
      "patch": "@@ -106,35 +106,6 @@ static serial_ttystate initial_gdb_ttystate;\n \n static struct terminal_info *get_inflow_inferior_data (struct inferior *);\n \n-/* RAII class used to ignore SIGTTOU in a scope.  */\n-\n-class scoped_ignore_sigttou\n-{\n-public:\n-  scoped_ignore_sigttou ()\n-  {\n-#ifdef SIGTTOU\n-    if (job_control)\n-      m_osigttou = signal (SIGTTOU, SIG_IGN);\n-#endif\n-  }\n-\n-  ~scoped_ignore_sigttou ()\n-  {\n-#ifdef SIGTTOU\n-    if (job_control)\n-      signal (SIGTTOU, m_osigttou);\n-#endif\n-  }\n-\n-  DISABLE_COPY_AND_ASSIGN (scoped_ignore_sigttou);\n-\n-private:\n-#ifdef SIGTTOU\n-  sighandler_t m_osigttou = NULL;\n-#endif\n-};\n-\n /* While the inferior is running, we want SIGINT and SIGQUIT to go to the\n    inferior only.  If we have job control, that takes care of it.  If not,\n    we save our handlers in these two variables and set SIGINT and SIGQUIT"
    },
    {
      "sha": "5dd5c37bd2b708bcaeaf2155ed46540df12b2dff",
      "filename": "gdb/inflow.h",
      "status": "modified",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/766f883622ef008230250aa5aecef9fb9b29f233/gdb/inflow.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/766f883622ef008230250aa5aecef9fb9b29f233/gdb/inflow.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inflow.h?ref=766f883622ef008230250aa5aecef9fb9b29f233",
      "patch": "@@ -21,5 +21,36 @@\n #define INFLOW_H\n \n #include <unistd.h>\n+#include <signal.h>\n+#include \"common/job-control.h\"\n+\n+/* RAII class used to ignore SIGTTOU in a scope.  */\n+\n+class scoped_ignore_sigttou\n+{\n+public:\n+  scoped_ignore_sigttou ()\n+  {\n+#ifdef SIGTTOU\n+    if (job_control)\n+      m_osigttou = signal (SIGTTOU, SIG_IGN);\n+#endif\n+  }\n+\n+  ~scoped_ignore_sigttou ()\n+  {\n+#ifdef SIGTTOU\n+    if (job_control)\n+      signal (SIGTTOU, m_osigttou);\n+#endif\n+  }\n+\n+  DISABLE_COPY_AND_ASSIGN (scoped_ignore_sigttou);\n+\n+private:\n+#ifdef SIGTTOU\n+  sighandler_t m_osigttou = NULL;\n+#endif\n+};\n \n #endif /* inflow.h */"
    },
    {
      "sha": "3492619f2d6e50d039b3432a1cb040e83a5fd03e",
      "filename": "gdb/ser-unix.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/766f883622ef008230250aa5aecef9fb9b29f233/gdb/ser-unix.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/766f883622ef008230250aa5aecef9fb9b29f233/gdb/ser-unix.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ser-unix.c?ref=766f883622ef008230250aa5aecef9fb9b29f233",
      "patch": "@@ -32,6 +32,7 @@\n #include \"gdbcmd.h\"\n #include \"common/filestuff.h\"\n #include <termios.h>\n+#include \"inflow.h\"\n \n struct hardwire_ttystate\n   {\n@@ -164,6 +165,9 @@ hardwire_print_tty_state (struct serial *scb,\n static int\n hardwire_drain_output (struct serial *scb)\n {\n+  /* Ignore SIGTTOU which may occur during the drain.  */\n+  scoped_ignore_sigttou ignore_sigttou;\n+\n   return tcdrain (scb->fd);\n }\n "
    },
    {
      "sha": "1e17ebee87c8769bd33649ce240df9e0f540fcac",
      "filename": "gdb/top.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/766f883622ef008230250aa5aecef9fb9b29f233/gdb/top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/766f883622ef008230250aa5aecef9fb9b29f233/gdb/top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.c?ref=766f883622ef008230250aa5aecef9fb9b29f233",
      "patch": "@@ -34,7 +34,7 @@\n #include \"expression.h\"\n #include \"value.h\"\n #include \"language.h\"\n-#include \"terminal.h\"\t\t/* For job_control.  */\n+#include \"terminal.h\"\n #include \"common/job-control.h\"\n #include \"annotate.h\"\n #include \"completer.h\""
    }
  ]
}