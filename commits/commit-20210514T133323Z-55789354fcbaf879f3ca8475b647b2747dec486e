{
  "sha": "55789354fcbaf879f3ca8475b647b2747dec486e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTU3ODkzNTRmY2JhZjg3OWYzY2E4NDc1YjY0N2IyNzQ3ZGVjNDg2ZQ==",
  "commit": {
    "author": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2021-05-14T09:56:31Z"
    },
    "committer": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2021-05-14T13:33:23Z"
    },
    "message": "gdb/python: add a 'connection_num' attribute to Inferior objects\n\nDefine a 'connection_num' attribute for Inferior objects.  The\nread-only attribute is the ID of the connection of an inferior, as\nprinted by \"info inferiors\".  In GDB's internal terminology, that's\nthe process stratum target of the inferior.  If the inferior has no\ntarget connection, the attribute is None.\n\ngdb/ChangeLog:\n2021-05-14  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n\n\t* python/py-inferior.c (infpy_get_connection_num): New function.\n\t(inferior_object_getset): Add a new element for 'connection_num'.\n\t* NEWS: Mention the 'connection_num' attribute of Inferior objects.\n\ngdb/doc/ChangeLog:\n2021-05-14  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n\n\t* python.texi (Inferiors In Python): Mention the 'connection_num'\n\tattribute.\n\ngdb/testsuite/ChangeLog:\n2021-05-14  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n\n\t* gdb.python/py-inferior.exp: Add test cases for 'connection_num'.",
    "tree": {
      "sha": "c190df296e9397418263e9615401a9b6dde02b2d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c190df296e9397418263e9615401a9b6dde02b2d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/55789354fcbaf879f3ca8475b647b2747dec486e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/55789354fcbaf879f3ca8475b647b2747dec486e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/55789354fcbaf879f3ca8475b647b2747dec486e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/55789354fcbaf879f3ca8475b647b2747dec486e/comments",
  "author": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2f63ec5ccc5dca36398e570a500ad553729b19a3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f63ec5ccc5dca36398e570a500ad553729b19a3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2f63ec5ccc5dca36398e570a500ad553729b19a3"
    }
  ],
  "stats": {
    "total": 71,
    "additions": 70,
    "deletions": 1
  },
  "files": [
    {
      "sha": "d44b06d955940fb598eb337373b9f90f492b359a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-14  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n+\n+\t* python/py-inferior.c (infpy_get_connection_num): New function.\n+\t(inferior_object_getset): Add a new element for 'connection_num'.\n+\t* NEWS: Mention the 'connection_num' attribute of Inferior objects.\n+\n 2021-05-14  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* remote.c (check_pending_events_prevent_wildcard_vcont): Change"
    },
    {
      "sha": "ab678acec8bfd45ebd50a4db3f60c2eb097cfde4",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -211,6 +211,12 @@ QMemTags\n      value-reference-value, value-rvalue-reference-value and\n      value-const-value.\n \n+* Python API\n+\n+  ** Inferior objects now contain a read-only 'connection_num' attribute that\n+     gives the connection number as seen in 'info connections' and\n+     'info inferiors'.\n+\n *** Changes in GDB 10\n \n * There are new feature names for ARC targets: \"org.gnu.gdb.arc.core\""
    },
    {
      "sha": "db72a479d86b6157ffa24f1476a2e9f9e3a2dfb4",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-14  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n+\n+\t* python.texi (Inferiors In Python): Mention the 'connection_num'\n+\tattribute.\n+\n 2021-05-12  George Barrett  <bob@bob131.so>\n \n \t* guile.texi (Values From Inferior In Guile): Add documentation"
    },
    {
      "sha": "f1ca6f7ed128966d51c69d495b8a91e5c3b5924e",
      "filename": "gdb/doc/python.texi",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/doc/python.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/doc/python.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/python.texi?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -3065,6 +3065,12 @@ A @code{gdb.Inferior} object has the following attributes:\n ID of inferior, as assigned by GDB.\n @end defvar\n \n+@defvar Inferior.connection_num\n+ID of inferior's connection as assigned by @value{GDBN}, or None if\n+the inferior is not connected to a target.\n+@xref{Inferiors Connections and Programs}.\n+@end defvar\n+\n @defvar Inferior.pid\n Process ID of the inferior, as assigned by the underlying operating\n system."
    },
    {
      "sha": "336c6426b8c86289adbc7c23ad55cd4ffd101490",
      "filename": "gdb/python/py-inferior.c",
      "status": "modified",
      "additions": 19,
      "deletions": 0,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/python/py-inferior.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/python/py-inferior.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/py-inferior.c?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -427,6 +427,23 @@ infpy_get_num (PyObject *self, void *closure)\n   return gdb_py_object_from_longest (inf->inferior->num).release ();\n }\n \n+/* Return the connection number of the given inferior, or None if a\n+   connection does not exist.  */\n+\n+static PyObject *\n+infpy_get_connection_num (PyObject *self, void *closure)\n+{\n+  inferior_object *inf = (inferior_object *) self;\n+\n+  INFPY_REQUIRE_VALID (inf);\n+\n+  process_stratum_target *target = inf->inferior->process_target ();\n+  if (target == nullptr)\n+    Py_RETURN_NONE;\n+\n+  return PyLong_FromLong (target->connection_number);\n+}\n+\n static PyObject *\n infpy_get_pid (PyObject *self, void *closure)\n {\n@@ -943,6 +960,8 @@ gdbpy_initialize_inferior (void)\n static gdb_PyGetSetDef inferior_object_getset[] =\n {\n   { \"num\", infpy_get_num, NULL, \"ID of inferior, as assigned by GDB.\", NULL },\n+  { \"connection_num\", infpy_get_connection_num, NULL,\n+    \"ID of inferior's connection, as assigned by GDB.\", NULL },\n   { \"pid\", infpy_get_pid, NULL, \"PID of inferior, as assigned by the OS.\",\n     NULL },\n   { \"was_attached\", infpy_get_was_attached, NULL,"
    },
    {
      "sha": "fbe2d216066a691b5d5d0af61d90e84bed1c8ef9",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -1,3 +1,7 @@\n+2021-05-14  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n+\n+\t* gdb.python/py-inferior.exp: Add test cases for 'connection_num'.\n+\n 2021-05-14  Kent Cheung  <kent.cheung@arm.com>\n \t    Andrew Burgess  <andrew.burgess@embecosm.com>\n "
    },
    {
      "sha": "2252215b721715966a63ac6a658a67b885a541d4",
      "filename": "gdb/testsuite/gdb.python/py-inferior.exp",
      "status": "modified",
      "additions": 24,
      "deletions": 1,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/testsuite/gdb.python/py-inferior.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/55789354fcbaf879f3ca8475b647b2747dec486e/gdb/testsuite/gdb.python/py-inferior.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/py-inferior.exp?ref=55789354fcbaf879f3ca8475b647b2747dec486e",
      "patch": "@@ -51,6 +51,7 @@ gdb_py_test_silent_cmd \"python i0 = inferiors\\[0\\]\" \"get first inferior\" 0\n \n gdb_test \"python print ('result = %s' % (i0 == inferiors\\[0\\]))\" \" = True\" \"test equality comparison (true)\"\n gdb_test \"python print ('result = %s' % i0.num)\" \" = \\[0-9\\]+\" \"test Inferior.num\"\n+gdb_test \"python print ('result = %s' % i0.connection_num)\" \" = \\[0-9\\]+\" \"test Inferior.connection_num\"\n gdb_test \"python print ('result = %s' % i0.pid)\" \" = \\[0-9\\]+\" \"test Inferior.pid\"\n gdb_test \"python print ('result = %s' % i0.was_attached)\" \" = False\" \"test Inferior.was_attached\"\n gdb_test \"python print (i0.threads ())\" \"\\\\(<gdb.InferiorThread object at 0x\\[\\[:xdigit:\\]\\]+>,\\\\)\" \"test Inferior.threads\"\n@@ -262,6 +263,8 @@ with_test_prefix \"is_valid\" {\n     # correctly.\n     gdb_test \"python print (inf_list\\[1\\].num)\" \\\n \t\"RuntimeError: Inferior no longer exists.*\"\n+    gdb_test \"python print (inf_list\\[1\\].connection_num)\" \\\n+\t\"RuntimeError: Inferior no longer exists.*\"\n     gdb_test \"python print (inf_list\\[1\\].pid)\" \\\n \t\"RuntimeError: Inferior no longer exists.*\"\n     gdb_test \"python print (inf_list\\[1\\].was_attached)\" \\\n@@ -278,10 +281,30 @@ with_test_prefix \"is_valid\" {\n with_test_prefix \"selected_inferior\" {\n     gdb_test \"inferior 1\" \".*\" \"switch to first inferior\"\n     gdb_test \"py print (gdb.selected_inferior().num)\" \"1\" \"first inferior selected\"\n+    gdb_test \"py print (gdb.selected_inferior().connection_num)\" \"1\" \\\n+\t\"first inferior's connection\"\n+    # Figure out if inf 1 has a native target.\n+    set inf_1_is_native [gdb_is_target_native]\n \n-    gdb_test \"add-inferior\" \"Added inferior 3 on connection .*\" \"create new inferior\"\n+    gdb_test \"add-inferior -no-connection\" \"Added inferior 3\" \"create new inferior\"\n     gdb_test \"inferior 3\" \".*\" \"switch to third inferior\"\n     gdb_test \"py print (gdb.selected_inferior().num)\" \"3\" \"third inferior selected\"\n+    gdb_test \"py print (gdb.selected_inferior().connection_num)\" \"None\" \\\n+\t\"third inferior's None connection\"\n+    gdb_test \"target native\" \"Done.  Use the \\\"run\\\" command to start a process.\" \\\n+\t\"target for the third inferior\"\n+\n+    # If inf 1 has a native target, inf 3's target is shared with 1's.\n+    # Otherwise, it must have created a new target with a new number.\n+    if {$inf_1_is_native} {\n+\tset expected_connection_num 1\n+    } else {\n+\tset expected_connection_num 2\n+    }\n+    gdb_test \"py print (gdb.selected_inferior().connection_num)\" \\\n+\t\"$expected_connection_num\" \\\n+\t\"third inferior's native connection\"\n+\n     gdb_test \"inferior 1\" \".*\" \"switch back to first inferior\"\n     gdb_test_no_output \"remove-inferiors 3\" \"remove second inferior\"\n }"
    }
  ]
}