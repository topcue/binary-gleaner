{
  "sha": "293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjkzYjM4ZDYwZjE1NDIyY2Y3ZTNkM2JhMDZmZGJjNWNjOTBhZWU2Nw==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-10-04T16:59:51Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-12-04T10:24:59Z"
    },
    "message": "gdb/mi: Add -symbol-info-module-{variables,functions}\n\nTwo new MI command -symbol-info-module-variables and\n-symbol-info-module-functions, which are the equivalent of the CLI\ncommand 'info module variables' and 'info module functions'.  These\nreturn information about functions and variables within Fortran\nmodules.\n\ngdb/ChangeLog:\n\n\t* mi/mi-cmds.c (mi_cmds): Add -symbol-info-module-functions and\n\t-symbol-info-module-variables entries.\n\t* mi/mi-cmds.h (mi_cmd_symbol_info_module_functions): Declare.\n\t(mi_cmd_symbol_info_module_variables): Declare.\n\t* mi/mi-symbol-cmds.c\n\t(module_symbol_search_iterator): New typedef.\n\t(output_module_symbols_in_single_module_and_file): New function.\n\t(output_module_symbols_in_single_module): New function.\n\t(mi_info_module_functions_or_variables): New function.\n\t(mi_cmd_symbol_info_module_functions): New function.\n\t(mi_cmd_symbol_info_module_variables): New function.\n\t* NEWS: Mention new MI command.\n\ngdb/doc/ChangeLog:\n\n\t* doc/gdb.texinfo (GDB/MI Symbol Query): Document new MI command\n\t-symbol-info-module-functions and -symbol-info-module-variables.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.mi/mi-fortran-modules.exp: Add additional tests for\n\t-symbol-info-module-functions and -symbol-info-module-variables.\n\nChange-Id: Ic96f12dd14bd7e34774c3cde008fec30a4055bfe",
    "tree": {
      "sha": "d95a350a906bba209d71ad579864f79de84ed48e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d95a350a906bba209d71ad579864f79de84ed48e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0ba59a29407a9d24559a653ce0401a26d9a37aaa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0ba59a29407a9d24559a653ce0401a26d9a37aaa",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0ba59a29407a9d24559a653ce0401a26d9a37aaa"
    }
  ],
  "stats": {
    "total": 357,
    "additions": 356,
    "deletions": 1
  },
  "files": [
    {
      "sha": "85607bbad43d86255494a8c0febd8161e41a3c5b",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -1,3 +1,18 @@\n+2019-12-04  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* mi/mi-cmds.c (mi_cmds): Add -symbol-info-module-functions and\n+\t-symbol-info-module-variables entries.\n+\t* mi/mi-cmds.h (mi_cmd_symbol_info_module_functions): Declare.\n+\t(mi_cmd_symbol_info_module_variables): Declare.\n+\t* mi/mi-symbol-cmds.c\n+\t(module_symbol_search_iterator): New typedef.\n+\t(output_module_symbols_in_single_module_and_file): New function.\n+\t(output_module_symbols_in_single_module): New function.\n+\t(mi_info_module_functions_or_variables): New function.\n+\t(mi_cmd_symbol_info_module_functions): New function.\n+\t(mi_cmd_symbol_info_module_variables): New function.\n+\t* NEWS: Mention new MI command.\n+\n 2019-12-03  Christian Biesinger  <cbiesinger@google.com>\n \n \t* bcache.c (hash): Remove."
    },
    {
      "sha": "372a83aa17e916b675c5cbcc8333a6a5c6c699c1",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -402,6 +402,10 @@ focus, winheight, +, -, >, <\n -symbol-info-modules, this is the MI equivalent of the CLI 'info\n   modules' command.\n \n+-symbol-info-module-functions and -symbol-info-module-variables.\n+  These commands are the MI equivalent of the CLI commands 'info\n+  module functions' and 'info module variables'.\n+\n * Other MI changes\n \n  ** The default version of the MI interpreter is now 3 (-i=mi3)."
    },
    {
      "sha": "5b3eab7d732184551f4642e371d8569494e432f2",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -1,3 +1,8 @@\n+2019-12-04  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* doc/gdb.texinfo (GDB/MI Symbol Query): Document new MI command\n+\t-symbol-info-module-functions and -symbol-info-module-variables.\n+\n 2019-12-01  Tom Tromey  <tom@tromey.com>\n \n \t* gdb.texinfo (TUI Configuration): Mention TUI border styles."
    },
    {
      "sha": "6fb7e8ab7eae02fa7b735254c82a403ddec0da2e",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 142,
      "deletions": 0,
      "changes": 142,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -34058,6 +34058,148 @@ The corresponding @value{GDBN} command is @samp{info functions}.\n @end group\n @end smallexample\n \n+@subheading The @code{-symbol-info-module-functions} Command\n+@findex -symbol-info-module-functions\n+@anchor{-symbol-info-module-functions}\n+\n+@subsubheading Synopsis\n+\n+@smallexample\n+ -symbol-info-module-functions [--module @var{module_regexp}]\n+                               [--name @var{name_regexp}]\n+                               [--type @var{type_regexp}]\n+@end smallexample\n+\n+@noindent\n+Return a list containing the names of all known functions within all\n+know Fortran modules.  The functions are grouped by source file and\n+containing module, and shown with the line number on which each\n+function is defined.\n+\n+The option @code{--module} only returns results for modules matching\n+@var{module_regexp}.  The option @code{--name} only returns functions\n+whose name matches @var{name_regexp}, and @code{--type} only returns\n+functions whose type matches @var{type_regexp}.\n+\n+@subsubheading @value{GDBN} Command\n+\n+The corresponding @value{GDBN} command is @samp{info module functions}.\n+\n+@subsubheading Example\n+\n+@smallexample\n+@group\n+(gdb)\n+-symbol-info-module-functions\n+^done,symbols=\n+  [@{module=\"mod1\",\n+    files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+            fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+            symbols=[@{line=\"21\",name=\"mod1::check_all\",type=\"void (void)\",\n+                      description=\"void mod1::check_all(void);\"@}]@}]@},\n+    @{module=\"mod2\",\n+     files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+             fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+             symbols=[@{line=\"30\",name=\"mod2::check_var_i\",type=\"void (void)\",\n+                       description=\"void mod2::check_var_i(void);\"@}]@}]@},\n+    @{module=\"mod3\",\n+     files=[@{filename=\"/projec/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+             fullname=\"/projec/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+             symbols=[@{line=\"21\",name=\"mod3::check_all\",type=\"void (void)\",\n+                       description=\"void mod3::check_all(void);\"@},\n+                      @{line=\"27\",name=\"mod3::check_mod2\",type=\"void (void)\",\n+                       description=\"void mod3::check_mod2(void);\"@}]@}]@},\n+    @{module=\"modmany\",\n+     files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+             fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+             symbols=[@{line=\"35\",name=\"modmany::check_some\",type=\"void (void)\",\n+                       description=\"void modmany::check_some(void);\"@}]@}]@},\n+    @{module=\"moduse\",\n+     files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+             fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+             symbols=[@{line=\"44\",name=\"moduse::check_all\",type=\"void (void)\",\n+                       description=\"void moduse::check_all(void);\"@},\n+                      @{line=\"49\",name=\"moduse::check_var_x\",type=\"void (void)\",\n+                       description=\"void moduse::check_var_x(void);\"@}]@}]@}]\n+@end group\n+@end smallexample\n+\n+@subheading The @code{-symbol-info-module-variables} Command\n+@findex -symbol-info-module-variables\n+@anchor{-symbol-info-module-variables}\n+\n+@subsubheading Synopsis\n+\n+@smallexample\n+ -symbol-info-module-variables [--module @var{module_regexp}]\n+                               [--name @var{name_regexp}]\n+                               [--type @var{type_regexp}]\n+@end smallexample\n+\n+@noindent\n+Return a list containing the names of all known variables within all\n+know Fortran modules.  The variables are grouped by source file and\n+containing module, and shown with the line number on which each\n+variable is defined.\n+\n+The option @code{--module} only returns results for modules matching\n+@var{module_regexp}.  The option @code{--name} only returns variables\n+whose name matches @var{name_regexp}, and @code{--type} only returns\n+variables whose type matches @var{type_regexp}.\n+\n+@subsubheading @value{GDBN} Command\n+\n+The corresponding @value{GDBN} command is @samp{info module variables}.\n+\n+@subsubheading Example\n+\n+@smallexample\n+@group\n+(gdb)\n+-symbol-info-module-variables\n+^done,symbols=\n+  [@{module=\"mod1\",\n+    files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+            fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+            symbols=[@{line=\"18\",name=\"mod1::var_const\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) mod1::var_const;\"@},\n+                     @{line=\"17\",name=\"mod1::var_i\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) mod1::var_i;\"@}]@}]@},\n+   @{module=\"mod2\",\n+    files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+            fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules-2.f90\",\n+            symbols=[@{line=\"28\",name=\"mod2::var_i\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) mod2::var_i;\"@}]@}]@},\n+   @{module=\"mod3\",\n+    files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+            fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+            symbols=[@{line=\"18\",name=\"mod3::mod1\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) mod3::mod1;\"@},\n+                     @{line=\"17\",name=\"mod3::mod2\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) mod3::mod2;\"@},\n+                     @{line=\"19\",name=\"mod3::var_i\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) mod3::var_i;\"@}]@}]@},\n+   @{module=\"modmany\",\n+    files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+            fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+            symbols=[@{line=\"33\",name=\"modmany::var_a\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) modmany::var_a;\"@},\n+                     @{line=\"33\",name=\"modmany::var_b\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) modmany::var_b;\"@},\n+                     @{line=\"33\",name=\"modmany::var_c\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) modmany::var_c;\"@},\n+                     @{line=\"33\",name=\"modmany::var_i\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) modmany::var_i;\"@}]@}]@},\n+   @{module=\"moduse\",\n+    files=[@{filename=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+            fullname=\"/project/gdb/testsuite/gdb.mi/mi-fortran-modules.f90\",\n+            symbols=[@{line=\"42\",name=\"moduse::var_x\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) moduse::var_x;\"@},\n+                     @{line=\"42\",name=\"moduse::var_y\",type=\"integer(kind=4)\",\n+                      description=\"integer(kind=4) moduse::var_y;\"@}]@}]@}]\n+@end group\n+@end smallexample\n+\n @subheading The @code{-symbol-info-modules} Command\n @findex -symbol-info-modules\n @anchor{-symbol-info-modules}"
    },
    {
      "sha": "991fb4b9c2001a0ea62badfb025ff054b504aa1c",
      "filename": "gdb/mi/mi-cmds.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/mi/mi-cmds.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/mi/mi-cmds.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mi/mi-cmds.c?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -155,6 +155,10 @@ static struct mi_cmd mi_cmds[] =\n   DEF_MI_CMD_MI (\"symbol-info-variables\", mi_cmd_symbol_info_variables),\n   DEF_MI_CMD_MI (\"symbol-info-types\", mi_cmd_symbol_info_types),\n   DEF_MI_CMD_MI (\"symbol-info-modules\", mi_cmd_symbol_info_modules),\n+  DEF_MI_CMD_MI (\"symbol-info-module-functions\",\n+\t\t mi_cmd_symbol_info_module_functions),\n+  DEF_MI_CMD_MI (\"symbol-info-module-variables\",\n+\t\t mi_cmd_symbol_info_module_variables),\n   DEF_MI_CMD_CLI (\"target-attach\", \"attach\", 1),\n   DEF_MI_CMD_MI (\"target-detach\", mi_cmd_target_detach),\n   DEF_MI_CMD_CLI (\"target-disconnect\", \"disconnect\", 0),"
    },
    {
      "sha": "faeb36b40ee9097e2e379c765f78a8dc313e0444",
      "filename": "gdb/mi/mi-cmds.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/mi/mi-cmds.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/mi/mi-cmds.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mi/mi-cmds.h?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -95,6 +95,8 @@ extern mi_cmd_argv_ftype mi_cmd_stack_list_variables;\n extern mi_cmd_argv_ftype mi_cmd_stack_select_frame;\n extern mi_cmd_argv_ftype mi_cmd_symbol_list_lines;\n extern mi_cmd_argv_ftype mi_cmd_symbol_info_functions;\n+extern mi_cmd_argv_ftype mi_cmd_symbol_info_module_functions;\n+extern mi_cmd_argv_ftype mi_cmd_symbol_info_module_variables;\n extern mi_cmd_argv_ftype mi_cmd_symbol_info_modules;\n extern mi_cmd_argv_ftype mi_cmd_symbol_info_types;\n extern mi_cmd_argv_ftype mi_cmd_symbol_info_variables;"
    },
    {
      "sha": "2bebd11f799e5d9da2771160d114023b7156afb4",
      "filename": "gdb/mi/mi-symbol-cmds.c",
      "status": "modified",
      "additions": 155,
      "deletions": 0,
      "changes": 155,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/mi/mi-symbol-cmds.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/mi/mi-symbol-cmds.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mi/mi-symbol-cmds.c?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -216,6 +216,143 @@ mi_info_functions_or_variables (enum search_domain kind, char **argv, int argc)\n   mi_symbol_info (kind, regexp, t_regexp, exclude_minsyms);\n }\n \n+/* Type for an iterator over a vector of module_symbol_search results.  */\n+typedef std::vector<module_symbol_search>::const_iterator\n+\tmodule_symbol_search_iterator;\n+\n+/* Helper for mi_info_module_functions_or_variables.  Display the results\n+   from ITER up to END or until we find a symbol that is in a different\n+   module, or in a different symtab than the first symbol we print.  Update\n+   and return the new value for ITER.  */\n+static module_symbol_search_iterator\n+output_module_symbols_in_single_module_and_file\n+\t(struct ui_out *uiout, module_symbol_search_iterator iter,\n+\t const module_symbol_search_iterator end, enum search_domain kind)\n+{\n+  /* The symbol for the module in which the first result resides.  */\n+  const symbol *first_module_symbol = iter->first.symbol;\n+\n+  /* The symbol for the first result, and the symtab in which it resides.  */\n+  const symbol *first_result_symbol = iter->second.symbol;\n+  symtab *first_symbtab = symbol_symtab (first_result_symbol);\n+\n+  /* Formatted output.  */\n+  ui_out_emit_tuple current_file (uiout, nullptr);\n+  uiout->field_string (\"filename\",\n+\t\t       symtab_to_filename_for_display (first_symbtab));\n+  uiout->field_string (\"fullname\", symtab_to_fullname (first_symbtab));\n+  ui_out_emit_list item_list (uiout, \"symbols\");\n+\n+  /* Repeatedly output result symbols until either we run out of symbols,\n+     we change module, or we change symtab.  */\n+  for (; (iter != end\n+\t  && first_module_symbol == iter->first.symbol\n+\t  && first_symbtab == symbol_symtab (iter->second.symbol));\n+       ++iter)\n+    output_debug_symbol (uiout, kind, iter->second.symbol,\n+\t\t\t iter->second.block);\n+\n+  return iter;\n+}\n+\n+/* Helper for mi_info_module_functions_or_variables.  Display the results\n+   from ITER up to END or until we find a symbol that is in a different\n+   module than the first symbol we print.  Update and return the new value\n+   for ITER.  */\n+static module_symbol_search_iterator\n+output_module_symbols_in_single_module\n+\t(struct ui_out *uiout, module_symbol_search_iterator iter,\n+\t const module_symbol_search_iterator end, enum search_domain kind)\n+{\n+  gdb_assert (iter->first.symbol != nullptr);\n+  gdb_assert (iter->second.symbol != nullptr);\n+\n+  /* The symbol for the module in which the first result resides.  */\n+  const symbol *first_module_symbol = iter->first.symbol;\n+\n+  /* Create output formatting.  */\n+  ui_out_emit_tuple module_tuple (uiout, nullptr);\n+  uiout->field_string (\"module\", first_module_symbol->print_name ());\n+  ui_out_emit_list files_list (uiout, \"files\");\n+\n+  /* The results are sorted so that symbols within the same file are next\n+     to each other in the list.  Calling the output function once will\n+     print all results within a single file.  We keep calling the output\n+     function until we change module.  */\n+  while (iter != end && first_module_symbol == iter->first.symbol)\n+    iter = output_module_symbols_in_single_module_and_file (uiout, iter,\n+\t\t\t\t\t\t\t    end, kind);\n+  return iter;\n+}\n+\n+/* Core of -symbol-info-module-functions and -symbol-info-module-variables.\n+   KIND indicates what we are searching for, and ARGV and ARGC are the\n+   command line options passed to the MI command.  */\n+\n+static void\n+mi_info_module_functions_or_variables (enum search_domain kind,\n+\t\t\t\t\tchar **argv, int argc)\n+{\n+  const char *module_regexp = nullptr;\n+  const char *regexp = nullptr;\n+  const char *type_regexp = nullptr;\n+\n+  /* Process the command line options.  */\n+\n+  enum opt\n+    {\n+     MODULE_REGEXP_OPT, TYPE_REGEXP_OPT, NAME_REGEXP_OPT\n+    };\n+  static const struct mi_opt opts[] =\n+  {\n+    {\"-module\", MODULE_REGEXP_OPT, 1},\n+    {\"-type\", TYPE_REGEXP_OPT, 1},\n+    {\"-name\", NAME_REGEXP_OPT, 1},\n+    { 0, 0, 0 }\n+  };\n+\n+  int oind = 0;\n+  char *oarg = nullptr;\n+\n+  while (1)\n+    {\n+      const char *cmd_string\n+\t= ((kind == FUNCTIONS_DOMAIN)\n+\t   ? \"-symbol-info-module-functions\"\n+\t   : \"-symbol-info-module-variables\");\n+      int opt = mi_getopt (cmd_string, argc, argv, opts, &oind, &oarg);\n+      if (opt < 0)\n+\tbreak;\n+      switch ((enum opt) opt)\n+\t{\n+\tcase MODULE_REGEXP_OPT:\n+\t  module_regexp = oarg;\n+\t  break;\n+\tcase TYPE_REGEXP_OPT:\n+\t  type_regexp = oarg;\n+\t  break;\n+\tcase NAME_REGEXP_OPT:\n+\t  regexp = oarg;\n+\t  break;\n+\t}\n+    }\n+\n+  std::vector<module_symbol_search> module_symbols\n+    = search_module_symbols (module_regexp, regexp, type_regexp, kind);\n+\n+  struct ui_out *uiout = current_uiout;\n+  ui_out_emit_list all_matching_symbols (uiout, \"symbols\");\n+\n+  /* The results in the module_symbols list are ordered so symbols in the\n+     same module are next to each other.  Repeatedly call the output\n+     function to print sequences of symbols that are in the same module\n+     until we have no symbols left to print.  */\n+  module_symbol_search_iterator iter = module_symbols.begin ();\n+  const module_symbol_search_iterator end = module_symbols.end ();\n+  while (iter != end)\n+    iter = output_module_symbols_in_single_module (uiout, iter, end, kind);\n+}\n+\n /* Implement -symbol-info-functions command.  */\n \n void\n@@ -224,6 +361,24 @@ mi_cmd_symbol_info_functions (const char *command, char **argv, int argc)\n   mi_info_functions_or_variables (FUNCTIONS_DOMAIN, argv, argc);\n }\n \n+/* Implement -symbol-info-module-functions command.  */\n+\n+void\n+mi_cmd_symbol_info_module_functions (const char *command, char **argv,\n+\t\t\t\t     int argc)\n+{\n+  mi_info_module_functions_or_variables (FUNCTIONS_DOMAIN, argv, argc);\n+}\n+\n+/* Implement -symbol-info-module-variables command.  */\n+\n+void\n+mi_cmd_symbol_info_module_variables (const char *command, char **argv,\n+\t\t\t\t     int argc)\n+{\n+  mi_info_module_functions_or_variables (VARIABLES_DOMAIN, argv, argc);\n+}\n+\n /* Implement -symbol-inf-modules command.  */\n \n void"
    },
    {
      "sha": "9ed64d1d4c3fd5be10d11bb80c3c63be661383a1",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -1,3 +1,8 @@\n+2019-12-04  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.mi/mi-fortran-modules.exp: Add additional tests for\n+\t-symbol-info-module-functions and -symbol-info-module-variables.\n+\n 2019-12-01  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.fortran/array-slices.exp: Add test for dynamic strings."
    },
    {
      "sha": "12a81a68695448ef1ce5c1cdb098b1ebfb5e4ce1",
      "filename": "gdb/testsuite/gdb.mi/mi-fortran-modules.exp",
      "status": "modified",
      "additions": 24,
      "deletions": 1,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/testsuite/gdb.mi/mi-fortran-modules.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/293b38d60f15422cf7e3d3ba06fdbc5cc90aee67/gdb/testsuite/gdb.mi/mi-fortran-modules.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-fortran-modules.exp?ref=293b38d60f15422cf7e3d3ba06fdbc5cc90aee67",
      "patch": "@@ -45,7 +45,30 @@ mi_gdb_test \"103-symbol-info-modules --name moduse\" \\\n     \"103\\\\^done,symbols=\\{debug=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"41\\\",name=\\\"moduse\\\"\\}\\\\\\]\\}\\\\\\]\\}\" \\\n     \"-symbol-info-modules --name moduse\"\n \n-\n+mi_gdb_test \"104-symbol-info-module-functions\" \\\n+    [join \\\n+     [list \\\n+      \"104\\\\^done,symbols=\\\\\\[\\{module=\\\"mod1\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"21\\\",name=\\\"mod1::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod1::check_all\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"mod2\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"30\\\",name=\\\"mod2::check_var_i\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod2::check_var_i\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"mod3\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"21\\\",name=\\\"mod3::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod3::check_all\\\\(void\\\\);\\\"\\},\\{line=\\\"27\\\",name=\\\"mod3::check_mod2\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod3::check_mod2\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\" \\\n+\t  \"\\{module=\\\"modmany\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"35\\\",name=\\\"modmany::check_some\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void modmany::check_some\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"moduse\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"44\\\",name=\\\"moduse::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void moduse::check_all\\\\(void\\\\);\\\"\\},\\{line=\\\"49\\\",name=\\\"moduse::check_var_x\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void moduse::check_var_x\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\}\\\\\\]\" ] \"\" ] \\\n+    \"-symbol-info-module-functions\"\n+\n+mi_gdb_test \"105-symbol-info-module-functions --name _all\" \\\n+    \"105\\\\^done,symbols=\\\\\\[\\{module=\\\"mod1\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"21\\\",name=\\\"mod1::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod1::check_all\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"mod3\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"21\\\",name=\\\"mod3::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod3::check_all\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"moduse\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"44\\\",name=\\\"moduse::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void moduse::check_all\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\}\\\\\\]\" \\\n+    \"-symbol-info-module-functions --name _all\"\n+\n+mi_gdb_test \"106-symbol-info-module-functions --module mod\\[123\\]\" \\\n+    \"106\\\\^done,symbols=\\\\\\[\\{module=\\\"mod1\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"21\\\",name=\\\"mod1::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod1::check_all\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"mod2\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"30\\\",name=\\\"mod2::check_var_i\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod2::check_var_i\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"mod3\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"21\\\",name=\\\"mod3::check_all\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod3::check_all\\\\(void\\\\);\\\"\\},\\{line=\\\"27\\\",name=\\\"mod3::check_mod2\\\",type=\\\"void \\\\(void\\\\)\\\",description=\\\"void mod3::check_mod2\\\\(void\\\\);\\\"\\}\\\\\\]\\}\\\\\\]\\}\\\\\\]\" \\\n+    \"-symbol-info-module-functions --module mod\\[123\\]\"\n+\n+set int4 [fortran_int4]\n+\n+mi_gdb_test \"107-symbol-info-module-variables\" \\\n+    [join \\\n+     [list \\\n+      \"107\\\\^done,symbols=\\\\\\[\\{module=\\\"mod1\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"18\\\",name=\\\"mod1::var_const\\\",type=\\\"$int4\\\",description=\\\"$int4 mod1::var_const;\\\"\\},\\{line=\\\"17\\\",name=\\\"mod1::var_i\\\",type=\\\"$int4\\\",description=\\\"$int4 mod1::var_i;\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"mod2\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile2\\\",fullname=\\\"\\[^\\\"\\]+$srcfile2\\\",symbols=\\\\\\[\\{line=\\\"28\\\",name=\\\"mod2::var_i\\\",type=\\\"$int4\\\",description=\\\"$int4 mod2::var_i;\\\"\\}\\\\\\]\\}\\\\\\]\\},\" \\\n+\t  \"\\{module=\\\"mod3\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"18\\\",name=\\\"mod3::mod1\\\",type=\\\"$int4\\\",description=\\\"$int4 mod3::mod1;\\\"\\},\\{line=\\\"17\\\",name=\\\"mod3::mod2\\\",type=\\\"$int4\\\",description=\\\"$int4 mod3::mod2;\\\"\\},\\{line=\\\"19\\\",name=\\\"mod3::var_i\\\",type=\\\"$int4\\\",description=\\\"$int4 mod3::var_i;\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"modmany\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"33\\\",name=\\\"modmany::var_a\\\",type=\\\"$int4\\\",description=\\\"$int4 modmany::var_a;\\\"\\},\" \\\n+\t  \"\\{line=\\\"33\\\",name=\\\"modmany::var_b\\\",type=\\\"$int4\\\",description=\\\"$int4 modmany::var_b;\\\"\\},\\{line=\\\"33\\\",name=\\\"modmany::var_c\\\",type=\\\"$int4\\\",description=\\\"$int4 modmany::var_c;\\\"\\},\\{line=\\\"33\\\",name=\\\"modmany::var_i\\\",type=\\\"$int4\\\",description=\\\"$int4 modmany::var_i;\\\"\\}\\\\\\]\\}\\\\\\]\\},\\{module=\\\"moduse\\\",files=\\\\\\[\\{filename=\\\"\\[^\\\"\\]+$srcfile\\\",fullname=\\\"\\[^\\\"\\]+$srcfile\\\",symbols=\\\\\\[\\{line=\\\"42\\\",name=\\\"moduse::var_x\\\",type=\\\"$int4\\\",description=\\\"$int4 moduse::var_x;\\\"\\},\\{line=\\\"42\\\",name=\\\"moduse::var_y\\\",type=\\\"$int4\\\",description=\\\"$int4 moduse::var_y;\\\"\\}\\\\\\]\\}\\\\\\]\\}\\\\\\]\" ] \"\" ] \\\n+    \"-symbol-info-module-variables\"\n \n \n "
    }
  ]
}