{
  "sha": "6bdfee81576aae55666a9245cfc0a316a6849957",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmJkZmVlODE1NzZhYWU1NTY2NmE5MjQ1Y2ZjMGEzMTZhNjg0OTk1Nw==",
  "commit": {
    "author": {
      "name": "Kevin Buettner",
      "email": "kevinb@redhat.com",
      "date": "2019-07-26T01:27:20Z"
    },
    "committer": {
      "name": "Kevin Buettner",
      "email": "kevinb@redhat.com",
      "date": "2019-07-27T20:52:45Z"
    },
    "message": "Fix gdb.python/py-thrhandle.exp failures for -m32 multilib\n\nThis patch fixes the following failures when testing with\n\"target_board unix/-m32\" using a x86_64-pc-linux-gnu native GDB.\n\nFAIL: gdb.python/py-thrhandle.exp: print thread for bogus handle thrs[3]\nFAIL: gdb.python/py-thrhandle.exp: print thread for bogus handle thrs[4]\nFAIL: gdb.python/py-thrhandle.exp: print thread id for thrs[0]\nFAIL: gdb.python/py-thrhandle.exp: print thread id for thrs[1]\nFAIL: gdb.python/py-thrhandle.exp: print thread id for thrs[2]\nFAIL: gdb.python/py-thrhandle.exp: thread 0: fetch thread handle from thread\nFAIL: gdb.python/py-thrhandle.exp: thread 0: verify that handles are the same\nFAIL: gdb.python/py-thrhandle.exp: thread 1: fetch thread handle from thread\nFAIL: gdb.python/py-thrhandle.exp: thread 1: verify that handles are the same\nFAIL: gdb.python/py-thrhandle.exp: thread 2: fetch thread handle from thread\nFAIL: gdb.python/py-thrhandle.exp: thread 2: verify that handles are the same\n\nI've written it so that it might work for other 64-bit host / 32-bit target\ncombos too.\n\ngdb/ChangeLog:\n\n\t* linux-thread-db.c (thread_db_target::thread_handle_to_thread_info):\n\tAdd case for debugging 32-bit target on 64-bit host.  Revise\n\tcomment.",
    "tree": {
      "sha": "a472cdee9d0fea740162bbdf95b5e0b9dde859de",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a472cdee9d0fea740162bbdf95b5e0b9dde859de"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6bdfee81576aae55666a9245cfc0a316a6849957",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6bdfee81576aae55666a9245cfc0a316a6849957",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6bdfee81576aae55666a9245cfc0a316a6849957",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6bdfee81576aae55666a9245cfc0a316a6849957/comments",
  "author": {
    "login": "KevinBuettner",
    "id": 65747518,
    "node_id": "MDQ6VXNlcjY1NzQ3NTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/65747518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KevinBuettner",
    "html_url": "https://github.com/KevinBuettner",
    "followers_url": "https://api.github.com/users/KevinBuettner/followers",
    "following_url": "https://api.github.com/users/KevinBuettner/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinBuettner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KevinBuettner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinBuettner/subscriptions",
    "organizations_url": "https://api.github.com/users/KevinBuettner/orgs",
    "repos_url": "https://api.github.com/users/KevinBuettner/repos",
    "events_url": "https://api.github.com/users/KevinBuettner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KevinBuettner/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "KevinBuettner",
    "id": 65747518,
    "node_id": "MDQ6VXNlcjY1NzQ3NTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/65747518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KevinBuettner",
    "html_url": "https://github.com/KevinBuettner",
    "followers_url": "https://api.github.com/users/KevinBuettner/followers",
    "following_url": "https://api.github.com/users/KevinBuettner/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinBuettner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KevinBuettner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinBuettner/subscriptions",
    "organizations_url": "https://api.github.com/users/KevinBuettner/orgs",
    "repos_url": "https://api.github.com/users/KevinBuettner/repos",
    "events_url": "https://api.github.com/users/KevinBuettner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KevinBuettner/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "98a617f8d5cf9bfb53b2e1d5cf3f0e0f188d9e53",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/98a617f8d5cf9bfb53b2e1d5cf3f0e0f188d9e53",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/98a617f8d5cf9bfb53b2e1d5cf3f0e0f188d9e53"
    }
  ],
  "stats": {
    "total": 25,
    "additions": 18,
    "deletions": 7
  },
  "files": [
    {
      "sha": "be242e51a5134bdd80f5956e540c1c6f4511b369",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6bdfee81576aae55666a9245cfc0a316a6849957/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6bdfee81576aae55666a9245cfc0a316a6849957/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=6bdfee81576aae55666a9245cfc0a316a6849957",
      "patch": "@@ -1,3 +1,9 @@\n+2019-07-27  Kevin Buettner  <kevinb@redhat.com>\n+\n+\t* linux-thread-db.c (thread_db_target::thread_handle_to_thread_info):\n+\tAdd case for debugging 32-bit target on 64-bit host.  Revise\n+\tcomment.\n+\n 2019-07-27  Kevin Buettner  <kevinb@redhat.com>\n \n \t* infrun.c (fill_in_stop_func): Use find_pc_partial_function"
    },
    {
      "sha": "1d32e9195c041d5653c8bdfcc906d0f351fee8f1",
      "filename": "gdb/linux-thread-db.c",
      "status": "modified",
      "additions": 12,
      "deletions": 7,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6bdfee81576aae55666a9245cfc0a316a6849957/gdb/linux-thread-db.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6bdfee81576aae55666a9245cfc0a316a6849957/gdb/linux-thread-db.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/linux-thread-db.c?ref=6bdfee81576aae55666a9245cfc0a316a6849957",
      "patch": "@@ -1672,16 +1672,21 @@ thread_db_target::thread_handle_to_thread_info (const gdb_byte *thread_handle,\n {\n   thread_t handle_tid;\n \n-  /* Thread handle sizes must match in order to proceed.  We don't use an\n-     assert here because the resulting internal error will cause GDB to\n-     exit.  This isn't necessarily an internal error due to the possibility\n-     of garbage being passed as the thread handle via the python interface.  */\n-  if (handle_len != sizeof (handle_tid))\n+  /* When debugging a 32-bit target from a 64-bit host, handle_len\n+     will be 4 and sizeof (handle_tid) will be 8.  This requires\n+     a different cast than the more straightforward case where\n+     the sizes are the same.\n+\n+     Use \"--target_board unix/-m32\" from a native x86_64 linux build\n+     to test the 32/64-bit case.  */\n+  if (handle_len == 4 && sizeof (handle_tid) == 8)\n+    handle_tid = (thread_t) * (const uint32_t *) thread_handle;\n+  else if (handle_len == sizeof (handle_tid))\n+    handle_tid = * (const thread_t *) thread_handle;\n+  else\n     error (_(\"Thread handle size mismatch: %d vs %zu (from libthread_db)\"),\n \t   handle_len, sizeof (handle_tid));\n \n-  handle_tid = * (const thread_t *) thread_handle;\n-\n   for (thread_info *tp : inf->non_exited_threads ())\n     {\n       thread_db_thread_info *priv = get_thread_db_thread_info (tp);"
    }
  ]
}