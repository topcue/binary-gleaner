{
  "sha": "72042732bc0a1d2e1b24df2f5a0fc70857bd1865",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzIwNDI3MzJiYzBhMWQyZTFiMjRkZjJmNWEwZmM3MDg1N2JkMTg2NQ==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-05-02T15:04:58Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-05-02T15:04:58Z"
    },
    "message": "sim: add default cases to two switches in sim-options.c\n\nThis is the next compilation error I hit when I build all targets with\nClang:\n\n    /home/simark/src/binutils-gdb/sim/aarch64/../common/sim-options.c:234:12: error: no case matching constant switch condition '0' [-Werror]                                                                    switch (WITH_ENVIRONMENT)\n                      ^~~~~~~~~~~~~~~~                                                                                                                                                                 ./config.h:215:26: note: expanded from macro 'WITH_ENVIRONMENT'\n    #define WITH_ENVIRONMENT ALL_ENVIRONMENT                                                                                                                                                                                    ^~~~~~~~~~~~~~~\n    /home/simark/src/binutils-gdb/sim/aarch64/../common/sim-options.c:276:15: error: no case matching constant switch condition '0' [-Werror]                                                                switch (WITH_ALIGNMENT)\n                  ^~~~~~~~~~~~~~                                                                                                                                                                       /home/simark/src/binutils-gdb/sim/aarch64/../common/sim-config.h:220:24: note: expanded from macro 'WITH_ALIGNMENT'\n    #define WITH_ALIGNMENT 0\n                           ^\n\nThis is a little bit special because these are switches on compile-time\nvalue.  But regardless, the idea is that we logically can't reach the\nswitches if WITH_ENVIRONMENT == 0 or WITH_ALIGNMENT == 0, so the code is\ncorrect.\n\nIn addition to getting rid of the compiler warning, adding default cases\nto these switches ensure that if we do get in an unexpected situation,\nit is caught.  In GDB, I'd use gdb_assert_not_reached, I don't know if\nthere is something similar in sim so I went with abort.\n\nsim/common/ChangeLog:\n\n\t* sim-options.c (standard_option_handler): Add default cases to\n\tswitches.\n\nChange-Id: Ie237d67a201caa6b72de0d17cc815193417156b6",
    "tree": {
      "sha": "88956eafdc96e908a342db2e3f45da8ce25ab835",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/88956eafdc96e908a342db2e3f45da8ce25ab835"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/72042732bc0a1d2e1b24df2f5a0fc70857bd1865",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/72042732bc0a1d2e1b24df2f5a0fc70857bd1865",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/72042732bc0a1d2e1b24df2f5a0fc70857bd1865",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/72042732bc0a1d2e1b24df2f5a0fc70857bd1865/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f0c4dc40b2e16a876b5b61986de5014a78f76a5c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f0c4dc40b2e16a876b5b61986de5014a78f76a5c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f0c4dc40b2e16a876b5b61986de5014a78f76a5c"
    }
  ],
  "stats": {
    "total": 7,
    "additions": 7,
    "deletions": 0
  },
  "files": [
    {
      "sha": "fd9a5dd70ff0e7447596982b6764c4574f539712",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72042732bc0a1d2e1b24df2f5a0fc70857bd1865/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72042732bc0a1d2e1b24df2f5a0fc70857bd1865/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=72042732bc0a1d2e1b24df2f5a0fc70857bd1865",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-02  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* sim-options.c (standard_option_handler): Add default cases to\n+\tswitches.\n+\n 2021-05-02  Mike Frysinger  <vapier@gentoo.org>\n \n \t* callback.c (os_error): Change __attribute__((noreturn)) to"
    },
    {
      "sha": "1efb21fc62b8c7be4e12b3de9862e52d350c605f",
      "filename": "sim/common/sim-options.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72042732bc0a1d2e1b24df2f5a0fc70857bd1865/sim/common/sim-options.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72042732bc0a1d2e1b24df2f5a0fc70857bd1865/sim/common/sim-options.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/sim-options.c?ref=72042732bc0a1d2e1b24df2f5a0fc70857bd1865",
      "patch": "@@ -236,6 +236,7 @@ standard_option_handler (SIM_DESC sd, sim_cpu *cpu, int opt,\n \t    case USER_ENVIRONMENT: type = \"user\"; break;\n \t    case VIRTUAL_ENVIRONMENT: type = \"virtual\"; break;\n \t    case OPERATING_ENVIRONMENT: type = \"operating\"; break;\n+\t    default: abort ();\n \t    }\n \t  sim_io_eprintf (sd, \"Simulator compiled for the %s environment only.\\n\",\n \t\t\t  type);\n@@ -284,6 +285,7 @@ standard_option_handler (SIM_DESC sd, sim_cpu *cpu, int opt,\n \tcase FORCED_ALIGNMENT:\n \t  sim_io_eprintf (sd, \"Simulator compiled for forced alignment only.\\n\");\n \t  break;\n+\tdefault: abort ();\n \t}\n       return SIM_RC_FAIL;\n "
    }
  ]
}