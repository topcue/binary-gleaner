{
  "sha": "de34d42812a0b978b278cd344abeaee7c71fa55c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGUzNGQ0MjgxMmEwYjk3OGIyNzhjZDM0NGFiZWFlZTdjNzFmYTU1Yw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-12-24T05:26:23Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-12-24T12:28:03Z"
    },
    "message": "PR27100, final link failed: bad value\n\nThe failure on this PR is due to using the same bfd section for\nmultiple output sections.  Commit 21401fc7bf67 managed to create\nduplicate linker script output section statements, but not the actual\nbfd sections.\n\n\tPR 27100\n\t* ldlang.h (lang_output_section_statement_type): Add dup_output.\n\t* ldlang.c (lang_output_section_statement_lookup): Set dup_output.\n\t(init_os): Test dup_output rather than constraint.\n\t* testsuite/ld-scripts/pr27100.d,\n\t* testsuite/ld-scripts/pr27100.s,\n\t* testsuite/ld-scripts/pr27100.t: New test.\n\t* testsuite/ld-scripts/data.exp: Run it.  Don't exclude aout here.\n\t* testsuite/ld-scripts/data.d: Do so here instead.\n\t* testsuite/ld-scripts/fill.d: Likewise.\n\t* testsuite/ld-scripts/fill16.d: Likewise.",
    "tree": {
      "sha": "3ce14917aa8bf1a4949291d3b4db89f8a42da4df",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3ce14917aa8bf1a4949291d3b4db89f8a42da4df"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/de34d42812a0b978b278cd344abeaee7c71fa55c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/de34d42812a0b978b278cd344abeaee7c71fa55c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/de34d42812a0b978b278cd344abeaee7c71fa55c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/de34d42812a0b978b278cd344abeaee7c71fa55c/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "62fa7b3c6a7bca91df55cf520a97cb047070a475",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/62fa7b3c6a7bca91df55cf520a97cb047070a475",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/62fa7b3c6a7bca91df55cf520a97cb047070a475"
    }
  ],
  "stats": {
    "total": 47,
    "additions": 38,
    "deletions": 9
  },
  "files": [
    {
      "sha": "7d67ef200a7e08d5c8fa51bc0236cc3a99ad78ff",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -1,3 +1,17 @@\n+2020-12-24  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27100\n+\t* ldlang.h (lang_output_section_statement_type): Add dup_output.\n+\t* ldlang.c (lang_output_section_statement_lookup): Set dup_output.\n+\t(init_os): Test dup_output rather than constraint.\n+\t* testsuite/ld-scripts/pr27100.d,\n+\t* testsuite/ld-scripts/pr27100.s,\n+\t* testsuite/ld-scripts/pr27100.t: New test.\n+\t* testsuite/ld-scripts/data.exp: Run it.  Don't exclude aout here.\n+\t* testsuite/ld-scripts/data.d: Do so here instead.\n+\t* testsuite/ld-scripts/fill.d: Likewise.\n+\t* testsuite/ld-scripts/fill16.d: Likewise.\n+\n 2020-12-23  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* NEWS: Mention LAM_U48 and LAM_U57 support."
    },
    {
      "sha": "a2b6b4dc0abf33c0d3b327c29661ea7fcb991ad3",
      "filename": "ld/ldlang.c",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/ldlang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/ldlang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.c?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -1526,6 +1526,8 @@ lang_output_section_statement_lookup (const char *name,\n \n   entry->s.output_section_statement.name = name;\n   entry->s.output_section_statement.constraint = constraint;\n+  entry->s.output_section_statement.dup_output = (create == 2\n+\t\t\t\t\t\t  || constraint == SPECIAL);\n   return &entry->s.output_section_statement;\n }\n \n@@ -2387,7 +2389,7 @@ init_os (lang_output_section_statement_type *s, flagword flags)\n   if (strcmp (s->name, DISCARD_SECTION_NAME) == 0)\n     einfo (_(\"%F%P: illegal use of `%s' section\\n\"), DISCARD_SECTION_NAME);\n \n-  if (s->constraint != SPECIAL)\n+  if (!s->dup_output)\n     s->bfd_section = bfd_get_section_by_name (link_info.output_bfd, s->name);\n   if (s->bfd_section == NULL)\n     s->bfd_section = bfd_make_section_anyway_with_flags (link_info.output_bfd,"
    },
    {
      "sha": "fe601a8547fbc3551c7d588759a2af0c08d01d21",
      "filename": "ld/ldlang.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/ldlang.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/ldlang.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.h?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -173,6 +173,9 @@ typedef struct lang_output_section_statement_struct\n   unsigned int after_end : 1;\n   /* If this section uses the alignment of its input sections.  */\n   unsigned int align_lma_with_input : 1;\n+  /* If script has duplicate output section statements of the same name\n+     create duplicate output sections.  */\n+  unsigned int dup_output : 1;\n } lang_output_section_statement_type;\n \n typedef struct"
    },
    {
      "sha": "9784672db46e6de3b39c146b38f8604c836a2525",
      "filename": "ld/testsuite/ld-scripts/data.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/data.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/data.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/data.d?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -1,6 +1,7 @@\n #source: data.s\n #ld: -T data.t\n #objdump: -s -j .text\n+#notarget: [is_aout_format]\n #xfail: tic4x-*-* tic54x-*-*\n \n .*:     file format .*"
    },
    {
      "sha": "673b2f5a4d1dc316bdc79c514081b8133d288c8b",
      "filename": "ld/testsuite/ld-scripts/data.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 8,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/data.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/data.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/data.exp?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -19,14 +19,6 @@\n # Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston,\n # MA 02110-1301, USA.\n \n-# An a.out \"objdump -s -j .text\" has the file header visible inside the\n-# text segment, confusing run_dump_test.\n-if {[is_aout_format]} {\n-\tunsupported data\n-\tunsupported fill\n-\treturn\n-}\n-\n set old_LDFLAGS $LDFLAGS\n if { [is_xcoff_format] } then {\n     set LDFLAGS \"$LDFLAGS -bnogc\"\n@@ -35,5 +27,6 @@ if { [is_xcoff_format] } then {\n run_dump_test data\n run_dump_test fill\n run_dump_test fill16\n+run_dump_test pr27100\n \n set LDFLAGS $old_LDFLAGS"
    },
    {
      "sha": "d3b5ea939ce674511b8318496de306ef6a43e59b",
      "filename": "ld/testsuite/ld-scripts/fill.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/fill.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/fill.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/fill.d?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -3,6 +3,7 @@\n #source: fill_2.s\n #ld: -T fill.t\n #objdump: -s -j .text\n+#notarget: [is_aout_format]\n #skip: ia64-*-* mips*-*-freebsd* mips*-*-gnu* mips*-*-irix* mips*-*-kfreebsd*\n #skip: mips*-*-linux* mips*-*-netbsd* mips*-*-openbsd* mips*-*-sysv4*\n #skip: tilegx*-*-* tilepro-*-* x86_64-*-cygwin x86_64-*-mingw* x86_64-*-pe*"
    },
    {
      "sha": "91dc0a0b40b8054030e1e0bf0ff7ee8ef03853ac",
      "filename": "ld/testsuite/ld-scripts/fill16.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/fill16.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/fill16.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/fill16.d?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -3,6 +3,7 @@\n #source: fill16_2.s\n #ld: -T fill.t\n #objdump: -s -j .text\n+#notarget: [is_aout_format]\n #skip: arm-*-coff i[3-7]86-*-coff [is_xcoff_format]\n #xfail: alpha*-*-*ecoff sh-*-pe sparc*-*-coff\n #xfail: tic30-*-coff tic4x-*-* tic54x-*-* z8k-*-*"
    },
    {
      "sha": "28b5875dbceddbfafed018bb101c5e8a38398167",
      "filename": "ld/testsuite/ld-scripts/pr27100.d",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/pr27100.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/pr27100.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/pr27100.d?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -0,0 +1,10 @@\n+#ld: -r -T pr27100.t\n+#objdump: -h\n+#notarget: [is_aout_format]\n+#xfail: alpha*-*-*vms* mmix-*-* *c54x-*-* [is_xcoff_format]\n+\n+#...\n+.* \\.data +0+60 .*\n+#...\n+.* \\.data +0+10 .*\n+#pass"
    },
    {
      "sha": "3eb147dd3a69c19cbf0d33e5bed80926b303dd67",
      "filename": "ld/testsuite/ld-scripts/pr27100.s",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/pr27100.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/pr27100.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/pr27100.s?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -0,0 +1,2 @@\n+ .data\n+ .space 80"
    },
    {
      "sha": "b94b8e90a2d9604b929cd267ade635838dc6b723",
      "filename": "ld/testsuite/ld-scripts/pr27100.t",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/pr27100.t",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de34d42812a0b978b278cd344abeaee7c71fa55c/ld/testsuite/ld-scripts/pr27100.t",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/pr27100.t?ref=de34d42812a0b978b278cd344abeaee7c71fa55c",
      "patch": "@@ -0,0 +1,2 @@\n+SECTIONS { .data ALIGN (16) : { aa = .; LONG(0xdeadbeef); . = ALIGN (16); } }\n+SECTIONS { .data ALIGN (16) : { bb = .; LONG(0x00c0ffee); . = ALIGN (16); } }"
    }
  ]
}