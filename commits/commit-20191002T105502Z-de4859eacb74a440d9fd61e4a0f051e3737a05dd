{
  "sha": "de4859eacb74a440d9fd61e4a0f051e3737a05dd",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGU0ODU5ZWFjYjc0YTQ0MGQ5ZmQ2MWU0YTBmMDUxZTM3MzdhMDVkZA==",
  "commit": {
    "author": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2019-10-02T10:55:02Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2019-10-02T10:55:02Z"
    },
    "message": "Change objcopy's --set-section-alignment option to take a byte alignment value rather than a power of two alignment value.\n\n\tPR 24942\n\t* objcopy.c (copy_usage): Update description of\n\t--set-section-alignment.\n\t(copy_main): Interpret numeric argument of --set-section-alignment\n\tas a byte alignment, not a power of two alignment.\n\t* doc/binutils.texi: Update description of\n\t--set-section-alignment.\n\t* testsuite/binutils-all/set-section-alignment.d: New test.\n\t* testsuite/binutils-all/objcopy.exp: Run the new test.",
    "tree": {
      "sha": "af63b3781d3bf350958b4ee7f407ebd805dec414",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/af63b3781d3bf350958b4ee7f407ebd805dec414"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/de4859eacb74a440d9fd61e4a0f051e3737a05dd",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/de4859eacb74a440d9fd61e4a0f051e3737a05dd",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/de4859eacb74a440d9fd61e4a0f051e3737a05dd",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/de4859eacb74a440d9fd61e4a0f051e3737a05dd/comments",
  "author": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c292080e11976e05603af9a91a67b052c33b56e3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c292080e11976e05603af9a91a67b052c33b56e3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c292080e11976e05603af9a91a67b052c33b56e3"
    }
  ],
  "stats": {
    "total": 58,
    "additions": 47,
    "deletions": 11
  },
  "files": [
    {
      "sha": "f4402ae742343e7f383e186ce44d2a0b0f69bf91",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=de4859eacb74a440d9fd61e4a0f051e3737a05dd",
      "patch": "@@ -1,3 +1,15 @@\n+2019-10-02  Niklas G\u00fcrtler  <profclonk@gmail.com>\n+\n+\tPR 24942\n+\t* objcopy.c (copy_usage): Update description of\n+\t--set-section-alignment.\n+\t(copy_main): Interpret numeric argument of --set-section-alignment\n+\tas a byte alignment, not a power of two alignment.\n+\t* doc/binutils.texi: Update description of\n+\t--set-section-alignment.\n+\t* testsuite/binutils-all/set-section-alignment.d: New test.\n+\t* testsuite/binutils-all/objcopy.exp: Run the new test.\n+\n 2019-09-30  Alan Modra  <amodra@gmail.com>\n \n \tPR 25046"
    },
    {
      "sha": "b0de3d061d11d46b4c6cd380f025dd7bb8b4b378",
      "filename": "binutils/doc/binutils.texi",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/doc/binutils.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/doc/binutils.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/doc/binutils.texi?ref=de4859eacb74a440d9fd61e4a0f051e3737a05dd",
      "patch": "@@ -1622,9 +1622,9 @@ contents--just remove the section instead.  Not all flags are\n meaningful for all object file formats.\n \n @item --set-section-alignment @var{sectionpattern}=@var{align}\n-Set the alignment for any sections matching @var{sectionpattern}.  @var{align}\n-specifies the alignment as the exponent for the power of two, i.e. the\n-alignment in bytes will be 2^@var{align}.\n+Set the alignment for any sections matching @var{sectionpattern}.\n+@var{align} specifies the alignment in bytes and must be a power of\n+two, i.e. 1, 2, 4, 8@dots{}. \n \n @item --add-section @var{sectionname}=@var{filename}\n Add a new section named @var{sectionname} while copying the file.  The"
    },
    {
      "sha": "8f74bebae88e7cd8d60f8658b37b68fc7ba5b464",
      "filename": "binutils/objcopy.c",
      "status": "modified",
      "additions": 21,
      "deletions": 8,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/objcopy.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/objcopy.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/objcopy.c?ref=de4859eacb74a440d9fd61e4a0f051e3737a05dd",
      "patch": "@@ -615,7 +615,7 @@ copy_usage (FILE *stream, int exit_status)\n      --set-section-flags <name>=<flags>\\n\\\n                                    Set section <name>'s properties to <flags>\\n\\\n      --set-section-alignment <name>=<align>\\n\\\n-                                   Set section <name>'s alignment to 2^<align> bytes\\n\\\n+                                   Set section <name>'s alignment to <align> bytes\\n\\\n      --add-section <name>=<file>   Add section <name> found in <file> to output\\n\\\n      --update-section <name>=<file>\\n\\\n                                    Update contents of section <name> with\\n\\\n@@ -5280,24 +5280,37 @@ copy_main (int argc, char *argv[])\n \t    const char *s;\n \t    int len;\n \t    char *name;\n-\t    int align;\n+\t    int palign, align;\n \n \t    s = strchr (optarg, '=');\n \t    if (s == NULL)\n-\t      fatal (_(\"bad format for %s\"), \"--set-section-alignment\");\n+\t      fatal (_(\"bad format for --set-section-alignment: argument needed\"));\n \t    \n-\t    align = atoi(s+1);\n-\t    if (align < 0)\n-\t      fatal (_(\"bad format for %s\"), \"--set-section-alignment\");\n+\t    align = atoi (s + 1);\n+\t    if (align <= 0)\n+\t      fatal (_(\"bad format for --set-section-alignment: numeric argument needed\"));\n \n+\t    /* Convert integer alignment into a power-of-two alignment.  */\n+\t    palign = 0;\n+\t    while ((align & 1) == 0)\n+\t      {\n+\t    \talign >>= 1;\n+\t    \t++palign;\n+\t      }\n+\t    \n+\t    if (align != 1)\n+\t      /* Number has more than on 1, i.e. wasn't a power of 2.  */\n+\t      fatal (_(\"bad format for --set-section-alignment: alignment is not a power of two\"));\n+\n+\t    /* Add the alignment setting to the section list.  */\n \t    len = s - optarg;\n \t    name = (char *) xmalloc (len + 1);\n \t    strncpy (name, optarg, len);\n \t    name[len] = '\\0';\n \n \t    p = find_section_list (name, TRUE, SECTION_CONTEXT_SET_ALIGNMENT);\n-\n-\t    p->alignment = align;\n+\t    if (p)\n+\t      p->alignment = palign;\n \t  }\n \t  break;\n \t  "
    },
    {
      "sha": "e12a8286a598542717b9c619e5abecf68bb62cd5",
      "filename": "binutils/testsuite/binutils-all/objcopy.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/testsuite/binutils-all/objcopy.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/testsuite/binutils-all/objcopy.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/testsuite/binutils-all/objcopy.exp?ref=de4859eacb74a440d9fd61e4a0f051e3737a05dd",
      "patch": "@@ -1310,3 +1310,5 @@ proc objcopy_remove_relocations_from_executable { } {\n objcopy_remove_relocations_from_executable\n \n run_dump_test \"pr23633\"\n+\n+run_dump_test \"set-section-alignment\""
    },
    {
      "sha": "d562ce1503809c2da1d170cb994f79cebe32a1ff",
      "filename": "binutils/testsuite/binutils-all/set-section-alignment.d",
      "status": "added",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/testsuite/binutils-all/set-section-alignment.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/de4859eacb74a440d9fd61e4a0f051e3737a05dd/binutils/testsuite/binutils-all/set-section-alignment.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/testsuite/binutils-all/set-section-alignment.d?ref=de4859eacb74a440d9fd61e4a0f051e3737a05dd",
      "patch": "@@ -0,0 +1,9 @@\n+#source: pr23633.s\n+#PROG: objcopy\n+#objcopy: --set-section-alignment .text=16\n+#objdump: --section-headers\n+#notarget: *-*-*aout *-*-*coff *-*-cygwin* *-*-darwin *-*-mingw* *-*-go32 *-*-*pe hppa*-*-hpux* ns32k-*-* powerpc-*-aix* rs6000-*-* rx-*-* *-*-vms\n+\n+#...\n+.*\\.text.*2\\*\\*4\n+#pass"
    }
  ]
}