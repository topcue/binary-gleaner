{
  "sha": "231b7382c061721f291d850a7a075d47e97de13c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjMxYjczODJjMDYxNzIxZjI5MWQ4NTBhN2EwNzVkNDdlOTdkZTEzYw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-07-07T03:28:12Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-07-07T08:56:34Z"
    },
    "message": "Use is_pecoff_format in ld testsuite\n\n--image-base 0 is not just for x86_64 mingw.  This patch fixes that,\nand a case where a changed LDFLAGS leaked out of one script to the next.\n\n\t* testsuite/ld-scripts/align.exp: Use is_pecoff_format.\n\t* testsuite/ld-scripts/defined.exp: Likewise.\n\t* testsuite/ld-scripts/provide.exp: Likewise.\n\t* testsuite/ld-scripts/weak.exp: Likewise.\n\t* testsuite/ld-scripts/empty-address.exp: Likewise.  Reset LDFLAGS\n\ton exit.\n\t* testsuite/ld-scripts/expr.exp: Set LDFLAGS earlier, and with\n\t--image-base for PE.\n\t* testsuite/ld-scripts/include.exp: Set LDFLAGS for PE.\n\t* testsuite/ld-scripts/script.exp: Use is_pecoff_format, and\n\tset LDFLAGS as well as flags.",
    "tree": {
      "sha": "480bd99be2d24b5930371e3fd946c7029b5d8024",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/480bd99be2d24b5930371e3fd946c7029b5d8024"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/231b7382c061721f291d850a7a075d47e97de13c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/231b7382c061721f291d850a7a075d47e97de13c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/231b7382c061721f291d850a7a075d47e97de13c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/231b7382c061721f291d850a7a075d47e97de13c/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7193487fa8d496a1df20eb8ea5007e9b43ac07cb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7193487fa8d496a1df20eb8ea5007e9b43ac07cb",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7193487fa8d496a1df20eb8ea5007e9b43ac07cb"
    }
  ],
  "stats": {
    "total": 71,
    "additions": 46,
    "deletions": 25
  },
  "files": [
    {
      "sha": "ce29d72249a410fb55b6da13f30aabc4d0af985e",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -1,3 +1,17 @@\n+2020-07-07  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-scripts/align.exp: Use is_pecoff_format.\n+\t* testsuite/ld-scripts/defined.exp: Likewise.\n+\t* testsuite/ld-scripts/provide.exp: Likewise.\n+\t* testsuite/ld-scripts/weak.exp: Likewise.\n+\t* testsuite/ld-scripts/empty-address.exp: Likewise.  Reset LDFLAGS\n+\ton exit.\n+\t* testsuite/ld-scripts/expr.exp: Set LDFLAGS earlier, and with\n+\t--image-base for PE.\n+\t* testsuite/ld-scripts/include.exp: Set LDFLAGS for PE.\n+\t* testsuite/ld-scripts/script.exp: Use is_pecoff_format, and\n+\tset LDFLAGS as well as flags.\n+\n 2020-07-07  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-checks/checks.exp: Use is_xcoff_format."
    },
    {
      "sha": "38172517302402e6685fdbc8779df3721b6ab1e0",
      "filename": "ld/testsuite/ld-scripts/align.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/align.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/align.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/align.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -31,10 +31,10 @@ if ![ld_assemble $as $srcdir/$subdir/align.s tmpdir/align.o] {\n     return\n }\n \n-# mingw on x86_64 targets need to set the image base to 0 to avoid auto image-basing.\n+# Avoid auto image-basing.\n set saved_LDFLAGS \"$LDFLAGS\"\n-if [istarget \"x86_64-*-mingw*\"] then {\n-  set LDFLAGS \"$LDFLAGS --image-base 0\"\n+if { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n if ![ld_link $ld tmpdir/align \"$LDFLAGS -T $srcdir/$subdir/align.t tmpdir/align.o\"] {"
    },
    {
      "sha": "7a47030c70d235b764229a70cb563b2785009cd1",
      "filename": "ld/testsuite/ld-scripts/defined.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/defined.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/defined.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/defined.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -28,8 +28,8 @@ if ![ld_assemble $as $srcdir/$subdir/defined.s tmpdir/def.o] {\n }\n \n set saved_LDFLAGS \"$LDFLAGS\"\n-if [istarget \"x86_64-*-mingw*\"] then {\n-  set LDFLAGS \"$LDFLAGS --image-base 0\"\n+if { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n if { ![ld_link $ld tmpdir/def \"$LDFLAGS -T $srcdir/$subdir/defined.t tmpdir/def.o\"] } {"
    },
    {
      "sha": "d71202a303695e5fa8c76a78f6db69b59d3181db",
      "filename": "ld/testsuite/ld-scripts/empty-address.exp",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/empty-address.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/empty-address.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/empty-address.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -19,8 +19,9 @@\n # Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston,\n # MA 02110-1301, USA.\n \n-if [istarget \"x86_64-*-mingw*\"] then {\n-  set LDFLAGS \"$LDFLAGS --image-base 0\"\n+set old_LDFLAGS $LDFLAGS\n+if { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n run_dump_test empty-address-1\n@@ -29,3 +30,5 @@ run_dump_test empty-address-2b\n run_dump_test empty-address-3a\n run_dump_test empty-address-3b\n run_dump_test empty-address-3c\n+\n+set LDFLAGS $old_LDFLAGS"
    },
    {
      "sha": "7b1c62751d0eeb8c9a2c2820ef5512c2b6fd7bcd",
      "filename": "ld/testsuite/ld-scripts/expr.exp",
      "status": "modified",
      "additions": 9,
      "deletions": 6,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/expr.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/expr.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/expr.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -19,17 +19,20 @@\n # Foundation, Inc., 51 Franklin Street - Fifth Floor, Boston,\n # MA 02110-1301, USA.\n \n+set old_LDFLAGS $LDFLAGS\n+if { [istarget spu*-*-*] } then {\n+    set LDFLAGS \"$LDFLAGS --no-overlays --local-store 0:0\"\n+} elseif { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n+}\n+\n run_dump_test expr1\n run_dump_test expr2\n run_dump_test sane1\n run_dump_test assign-loc\n run_dump_test pr14962\n run_dump_test pr14962-2\n+run_dump_test pr18963\n run_dump_test pr22267\n \n-set old_ldflags $LDFLAGS\n-if { [istarget spu*-*-*] } {\n-    set LDFLAGS \"$LDFLAGS --no-overlays --local-store 0:0\"\n-}\n-run_dump_test pr18963\n-set LDFLAGS $old_ldflags\n+set LDFLAGS $old_LDFLAGS"
    },
    {
      "sha": "c7e2ee58a0366f9810bfe0f1204cc9a072c7d8c9",
      "filename": "ld/testsuite/ld-scripts/include.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/include.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/include.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/include.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -23,8 +23,10 @@ if [is_aout_format] {\n }\n \n set old_ldflags $LDFLAGS\n-if { [istarget spu*-*-*] } {\n+if { [istarget spu*-*-*] } then {\n     set LDFLAGS \"$LDFLAGS --local-store 0:0 --no-overlays\"\n+} elseif { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n set test_list [lsort [glob -nocomplain $srcdir/$subdir/include*.d]]"
    },
    {
      "sha": "34aed400a1e0975fea0e19b0c160041afa36a2da",
      "filename": "ld/testsuite/ld-scripts/provide.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/provide.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/provide.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/provide.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -31,8 +31,8 @@ if {[istarget \"powerpc*-*-aix*\"] || [istarget \"rs6000-*-aix*\"] || [is_aout_forma\n }\n \n set saved_LDFLAGS \"$LDFLAGS\"\n-if [istarget \"x86_64-*-mingw*\"] then {\n-  set LDFLAGS \"$LDFLAGS --image-base 0\"\n+if { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n set test_list [lsort [glob -nocomplain $srcdir/$subdir/provide-*.d]]"
    },
    {
      "sha": "108e53989fb6ef3cf7b2d8fc78f65a24727e3a4a",
      "filename": "ld/testsuite/ld-scripts/script.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 7,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/script.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/script.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/script.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -183,13 +183,10 @@ proc extract_symbol_test { testfile testname } {\n \n # PE targets need to set the image base to 0 to avoid complications from nm.\n set flags \"\"\n-if {[istarget \"*-*-pe*\"] \\\n-    || [istarget \"*-*-cygwin*\"] \\\n-    || [istarget \"*-*-mingw*\"] \\\n-    || [istarget \"*-*-winnt*\"] \\\n-    || [istarget \"*-*-nt\"] \\\n-    || [istarget \"*-*-interix*\"] } then {\n-  set flags \"--image-base 0\"\n+set old_LDFLAGS $LDFLAGS\n+if { [is_pecoff_format] } then {\n+    set flags \"--image-base 0\"\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n if ![ld_link $ld tmpdir/script \"$flags -T $srcdir/$subdir/script.t tmpdir/script.o\"] {\n@@ -235,3 +232,5 @@ run_dump_test \"pr20302\"\n run_dump_test \"segment-start\" {{name (default)}}\n run_dump_test \"segment-start\" {{name (overridden)} \\\n \t\t\t       {ld -Ttext-segment=0x10000000}}\n+\n+set LDFLAGS $old_LDFLAGS"
    },
    {
      "sha": "57986a31d4a9a3ec266c879535dc1b5d6a4863eb",
      "filename": "ld/testsuite/ld-scripts/weak.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/weak.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/231b7382c061721f291d850a7a075d47e97de13c/ld/testsuite/ld-scripts/weak.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/weak.exp?ref=231b7382c061721f291d850a7a075d47e97de13c",
      "patch": "@@ -44,8 +44,8 @@ if {! [ld_assemble $as $srcdir/$subdir/weak1.s tmpdir/weak1.o]\n }\n \n set saved_LDFLAGS \"$LDFLAGS\"\n-if [istarget \"x86_64-*-mingw*\"] then {\n-  set LDFLAGS \"$LDFLAGS --image-base 0\"\n+if { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n }\n \n set weak_regexp_big \\"
    }
  ]
}