{
  "sha": "d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDg5YTg3YmEzYzEwMGJkYmU4MmM3YmQ5OGFkN2I4YTI0MzVlMDAyZg==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2016-01-02T15:54:42Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-05-02T03:10:28Z"
    },
    "message": "sim: bfin: move option inits to respective modules\n\nNow that modules can self declare their own init funcs, change the mmu\nand mach logic to use it.  We don't need to export the option symbols\nor specifically call this logic from the sim_open function anymore.",
    "tree": {
      "sha": "624938f5f0bcb58fe3527bf9fdbef2f65f856191",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/624938f5f0bcb58fe3527bf9fdbef2f65f856191"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e4821e2f5fd281eb6b88b642fa9beaf9c3a35070",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e4821e2f5fd281eb6b88b642fa9beaf9c3a35070",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e4821e2f5fd281eb6b88b642fa9beaf9c3a35070"
    }
  ],
  "stats": {
    "total": 43,
    "additions": 30,
    "deletions": 13
  },
  "files": [
    {
      "sha": "4fe2a9dd1f5a068a387d93625c0d440411c60477",
      "filename": "sim/bfin/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/ChangeLog?ref=d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
      "patch": "@@ -1,3 +1,11 @@\n+2021-05-01  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* dv-bfin_mmu.c (bfin_mmu_options): Mark static.\n+\t(sim_install_bfin_mmu): New function & prototype.\n+\t* interp.c (e_sim_add_option_table): Delete.\n+\t* machs.c (bfin_mach_options): Mark static.\n+\t(sim_install_bfin_mach): New function & prototype.\n+\n 2021-05-01  Mike Frysinger  <vapier@gentoo.org>\n \n \t* config.in, configure: Regenerate."
    },
    {
      "sha": "cbaaaa2cae151dc668f50d6f9d88e9ef97e65c52",
      "filename": "sim/bfin/dv-bfin_mmu.c",
      "status": "modified",
      "additions": 11,
      "deletions": 1,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/dv-bfin_mmu.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/dv-bfin_mmu.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/dv-bfin_mmu.c?ref=d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
      "patch": "@@ -277,7 +277,7 @@ enum {\n   OPTION_MMU_SKIP_TABLES = OPTION_START,\n };\n \n-const OPTION bfin_mmu_options[] =\n+static const OPTION bfin_mmu_options[] =\n {\n   { {\"mmu-skip-cplbs\", no_argument, NULL, OPTION_MMU_SKIP_TABLES },\n       '\\0', NULL, \"Skip parsing of CPLB tables (big speed increase)\",\n@@ -301,6 +301,16 @@ bfin_mmu_option_handler (SIM_DESC sd, sim_cpu *current_cpu, int opt,\n       return SIM_RC_FAIL;\n     }\n }\n+\n+/* Provide a prototype to silence -Wmissing-prototypes.  */\n+extern MODULE_INIT_FN sim_install_bfin_mmu;\n+\n+SIM_RC\n+sim_install_bfin_mmu (SIM_DESC sd)\n+{\n+  SIM_ASSERT (STATE_MAGIC (sd) == SIM_MAGIC_NUMBER);\n+  return sim_add_option_table (sd, NULL, bfin_mmu_options);\n+}\n \f\n #define MMU_STATE(cpu) DV_STATE_CACHED (cpu, mmu)\n "
    },
    {
      "sha": "2aa9279aef8939d1662ddce7b214b7ead1e597fd",
      "filename": "sim/bfin/interp.c",
      "status": "modified",
      "additions": 0,
      "deletions": 11,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/interp.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/interp.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/interp.c?ref=d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
      "patch": "@@ -735,17 +735,6 @@ sim_open (SIM_OPEN_KIND kind, host_callback *callback,\n   if (STATE_ENVIRONMENT (sd) == ALL_ENVIRONMENT)\n     STATE_ENVIRONMENT (sd) = VIRTUAL_ENVIRONMENT;\n \n-  /* These options override any module options.\n-     Obviously ambiguity should be avoided, however the caller may wish to\n-     augment the meaning of an option.  */\n-#define e_sim_add_option_table(sd, options) \\\n-  do { \\\n-    extern const OPTION options[]; \\\n-    sim_add_option_table (sd, NULL, options); \\\n-  } while (0)\n-  e_sim_add_option_table (sd, bfin_mmu_options);\n-  e_sim_add_option_table (sd, bfin_mach_options);\n-\n   /* The parser will print an error message for us, so we silently return.  */\n   if (sim_parse_args (sd, argv) != SIM_RC_OK)\n     {"
    },
    {
      "sha": "a2060e8d8986fbc9b99abded9b779838a8fdc287",
      "filename": "sim/bfin/machs.c",
      "status": "modified",
      "additions": 11,
      "deletions": 1,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/machs.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f/sim/bfin/machs.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/machs.c?ref=d89a87ba3c100bdbe82c7bd98ad7b8a2435e002f",
      "patch": "@@ -1976,7 +1976,7 @@ enum {\n   OPTION_MACH_HW_BOARD_FILE,\n };\n \n-const OPTION bfin_mach_options[] =\n+static const OPTION bfin_mach_options[] =\n {\n   { {\"sirev\", required_argument, NULL, OPTION_MACH_SIREV },\n       '\\0', \"NUMBER\", \"Set CPU silicon revision\",\n@@ -2019,3 +2019,13 @@ bfin_mach_option_handler (SIM_DESC sd, sim_cpu *current_cpu, int opt,\n       return SIM_RC_FAIL;\n     }\n }\n+\n+/* Provide a prototype to silence -Wmissing-prototypes.  */\n+extern MODULE_INIT_FN sim_install_bfin_mach;\n+\n+SIM_RC\n+sim_install_bfin_mach (SIM_DESC sd)\n+{\n+  SIM_ASSERT (STATE_MAGIC (sd) == SIM_MAGIC_NUMBER);\n+  return sim_add_option_table (sd, NULL, bfin_mach_options);\n+}"
    }
  ]
}