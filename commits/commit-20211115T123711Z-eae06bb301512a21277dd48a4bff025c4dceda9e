{
  "sha": "eae06bb301512a21277dd48a4bff025c4dceda9e",
  "node_id": "C_kwDOANOeidoAKGVhZTA2YmIzMDE1MTJhMjEyNzdkZDQ4YTRiZmYwMjVjNGRjZWRhOWU",
  "commit": {
    "author": {
      "name": "Cl\u00e9ment Chigot",
      "email": "clement.chigot@atos.net",
      "date": "2021-11-15T09:37:36Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-11-15T12:37:11Z"
    },
    "message": "COFF: avoid modifications over C_FILE filename aux entries.\n\nCommit e86fc4a5bc37 (\"PR 28447: implement multiple parameters for .file\non XCOFF\") introduces C_FILE entries which can store additional\ninformation.\nHowever, some modifications are needed by them but not by the original\nC_FILE entries, usually representing the filename.\nThis patch ensures that filename entries are kept as is, in order to\nprotect targets not supporting the additional entries.\n\n\t* coffgen.c (coff_write_symbol): Protect filename entries\n\t(coff_write_symbols): Likewise.\n\t(coff_print_symbol): Likewise.",
    "tree": {
      "sha": "4f5fcc18608ee39d0a4c08d065c9706deeae164e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4f5fcc18608ee39d0a4c08d065c9706deeae164e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/eae06bb301512a21277dd48a4bff025c4dceda9e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/eae06bb301512a21277dd48a4bff025c4dceda9e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/eae06bb301512a21277dd48a4bff025c4dceda9e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/eae06bb301512a21277dd48a4bff025c4dceda9e/comments",
  "author": {
    "login": "Helflym",
    "id": 23002587,
    "node_id": "MDQ6VXNlcjIzMDAyNTg3",
    "avatar_url": "https://avatars.githubusercontent.com/u/23002587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Helflym",
    "html_url": "https://github.com/Helflym",
    "followers_url": "https://api.github.com/users/Helflym/followers",
    "following_url": "https://api.github.com/users/Helflym/following{/other_user}",
    "gists_url": "https://api.github.com/users/Helflym/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Helflym/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Helflym/subscriptions",
    "organizations_url": "https://api.github.com/users/Helflym/orgs",
    "repos_url": "https://api.github.com/users/Helflym/repos",
    "events_url": "https://api.github.com/users/Helflym/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Helflym/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f9402ccaa9fac7858713a7672fae5760ae3d5ce7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f9402ccaa9fac7858713a7672fae5760ae3d5ce7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f9402ccaa9fac7858713a7672fae5760ae3d5ce7"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 10,
    "deletions": 2
  },
  "files": [
    {
      "sha": "5474f6c24d8d35d513ebb0fe36912aae236d649a",
      "filename": "bfd/coffgen.c",
      "status": "modified",
      "additions": 10,
      "deletions": 2,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/eae06bb301512a21277dd48a4bff025c4dceda9e/bfd/coffgen.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/eae06bb301512a21277dd48a4bff025c4dceda9e/bfd/coffgen.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/coffgen.c?ref=eae06bb301512a21277dd48a4bff025c4dceda9e",
      "patch": "@@ -1036,7 +1036,10 @@ coff_write_symbol (bfd *abfd,\n \t{\n \t  BFD_ASSERT (! (native + j + 1)->is_sym);\n \n-\t  if (native->u.syment.n_sclass == C_FILE && j > 0)\n+\t  /* Adjust auxent only if this isn't the filename\n+\t     auxiliary entry.  */\n+\t  if (native->u.syment.n_sclass == C_FILE\n+\t      && (native + j + 1)->u.auxent.x_file.x_ftype)\n \t    coff_write_auxent_fname (abfd, (char *) (native + j + 1)->extrap,\n \t\t\t\t     &(native + j + 1)->u.auxent, string_size_p);\n \n@@ -1423,6 +1426,11 @@ coff_write_symbols (bfd *abfd)\n \t\t  char *str;\n \t\t  size_t str_length;\n \n+\t\t  /* Add strings from aux entries only if this isn't the\n+\t\t     filename auxiliary entry.  */\n+\t\t  if (!c_symbol->native[j + 1].u.auxent.x_file.x_ftype)\n+\t\t    continue;\n+\n \t\t  if (c_symbol->native[j + 1].u.auxent.x_file.x_n.x_fname[0] != 0)\n \t\t    continue;\n \n@@ -2207,7 +2215,7 @@ coff_print_symbol (bfd *abfd,\n \t\t  fprintf (file, \"File \");\n \t\t  /* Add additional information if this isn't the filename\n \t\t     auxiliary entry.  */\n-\t\t  if (aux)\n+\t\t  if (auxp->u.auxent.x_file.x_ftype)\n \t\t    fprintf (file, \"ftype %d fname \\\"%s\\\"\",\n \t\t\t     auxp->u.auxent.x_file.x_ftype,\n \t\t\t     (char *) auxp->u.auxent.x_file.x_n.x_n.x_offset);"
    }
  ]
}