{
  "sha": "44f871628ccfcfd931f4619c60554f3bd6b57b8d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDRmODcxNjI4Y2NmY2ZkOTMxZjQ2MTljNjA1NTRmM2JkNmI1N2I4ZA==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-04-29T09:43:53Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-04-29T09:43:53Z"
    },
    "message": "x86: allow @size to also (sensibly) apply to sections\n\nSo far this (counter-intuitively) produced the size as recorded in the\n(section) symbol. Obtain the section's size instead for section symbols.\n(I wonder whether STT_SECTION symbols couldn't properly hold the\nsection's size in their st_size field, which in turn would likely mean\nthe internal symbol would also have its size properly updated.)\n\nNote that this is not the same as the .sizeof.() pseudo-operator: @size\nyields the local file's contribution to a section, while .sizeof.() gets\nresolved by the linker to produce the final full section's size.\n\nAs to the 3rd each of the expected output lines in the changed testcase:\nI can't find justification for zzz to come after yyy despite them being\ndefined in the opposite order in source. Therefore I think it's better\nto permit both possible outcomes.",
    "tree": {
      "sha": "ee91ff51c0f4b7bf3adc4297e6c4f782fc22ba5c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ee91ff51c0f4b7bf3adc4297e6c4f782fc22ba5c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/44f871628ccfcfd931f4619c60554f3bd6b57b8d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/44f871628ccfcfd931f4619c60554f3bd6b57b8d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/44f871628ccfcfd931f4619c60554f3bd6b57b8d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/44f871628ccfcfd931f4619c60554f3bd6b57b8d/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8eb82ba1fdc052d2bb08ec6f0d98b8d2c10edd17",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8eb82ba1fdc052d2bb08ec6f0d98b8d2c10edd17",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8eb82ba1fdc052d2bb08ec6f0d98b8d2c10edd17"
    }
  ],
  "stats": {
    "total": 43,
    "additions": 36,
    "deletions": 7
  },
  "files": [
    {
      "sha": "e36170a2f91c5e9811493396da1e9dce8fbd5d3f",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=44f871628ccfcfd931f4619c60554f3bd6b57b8d",
      "patch": "@@ -1,3 +1,11 @@\n+2021-04-29  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* config/tc-i386.c (tc_gen_reloc): Use section size for section\n+\tsymbols when resolving BFD_RELOC_SIZE*.\n+\t* testsuite/gas/i386/size-2.s: Add section size cases.\n+\t* testsuite/gas/i386/size-2.d,\n+\ttestsuite/gas/i386/x86-64-size-2.d: Adjust expectations.\n+\n 2021-04-28  Jan Beulich  <jbeulich@suse.com>\n             H.J. Lu  <hjl.tools@gmail.com>\n "
    },
    {
      "sha": "9c544ee231de3ecd2e065f30c7aec1b523ee90ca",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=44f871628ccfcfd931f4619c60554f3bd6b57b8d",
      "patch": "@@ -14241,7 +14241,11 @@ tc_gen_reloc (asection *section ATTRIBUTE_UNUSED, fixS *fixp)\n \t{\n \t  /* Resolve size relocation against local symbol to size of\n \t     the symbol plus addend.  */\n-\t  valueT value = S_GET_SIZE (fixp->fx_addsy) + fixp->fx_offset;\n+\t  valueT value = S_GET_SIZE (fixp->fx_addsy);\n+\n+\t  if (symbol_get_bfdsym (fixp->fx_addsy)->flags & BSF_SECTION_SYM)\n+\t    value = bfd_section_size (S_GET_SEGMENT (fixp->fx_addsy));\n+\t  value += fixp->fx_offset;\n \t  if (fixp->fx_r_type == BFD_RELOC_SIZE32\n \t      && object_64bit\n \t      && !fits_in_unsigned_long (value))"
    },
    {
      "sha": "38b96f68f229bac5d1d44a6aa0965709f71dec30",
      "filename": "gas/testsuite/gas/i386/size-2.d",
      "status": "modified",
      "additions": 10,
      "deletions": 3,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/testsuite/gas/i386/size-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/testsuite/gas/i386/size-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/size-2.d?ref=44f871628ccfcfd931f4619c60554f3bd6b57b8d",
      "patch": "@@ -1,10 +1,14 @@\n #name: i386 size 2\n-#objdump: -dwr\n-\n+#objdump: -dhwr\n \n .*: +file format .*\n \n-\n+Sections:\n+Idx Name +Size .*\n+  0 \\.text +0*3c .*\n+  1 \\.data +0*5c .*\n+  2 \\.bss +0*199999(ae|b0) .*\n+#...\n Disassembly of section .text:\n \n 0+ <.text>:\n@@ -17,4 +21,7 @@ Disassembly of section .text:\n [ \t]*[a-f0-9]+:\tb8 90 99 99 19       \tmov    \\$0x19999990,%eax\n [ \t]*[a-f0-9]+:\tb8 70 99 99 19       \tmov    \\$0x19999970,%eax\n [ \t]*[a-f0-9]+:\tb8 b0 99 99 19       \tmov    \\$0x199999b0,%eax\n+[ \t]*[a-f0-9]+:\tb8 3c 00 00 00       \tmov    \\$0x3c,%eax\n+[ \t]*[a-f0-9]+:\tb8 60 00 00 00       \tmov    \\$0x60,%eax\n+[ \t]*[a-f0-9]+:\tb8 (ae|b0) 99 99 09       \tmov    \\$0x99999(ae|b0),%eax\n #pass"
    },
    {
      "sha": "b1f814a376546bfa133b1db495c4ed5c7e547a30",
      "filename": "gas/testsuite/gas/i386/size-2.s",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/testsuite/gas/i386/size-2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/testsuite/gas/i386/size-2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/size-2.s?ref=44f871628ccfcfd931f4619c60554f3bd6b57b8d",
      "patch": "@@ -9,6 +9,9 @@\n \tmovl\t$zzz@SIZE, %eax\n \tmovl\t$zzz@SIZE - 32, %eax\n \tmovl\t$zzz@SIZE + 32, %eax\n+\tmovl\t$.text@SIZE, %eax\n+\tmovl\t$.data@SIZE + 4, %eax\n+\tmovl\t$.bss@SIZE - 0x10000000, %eax\n \t.local\tzzz\n \t.comm\tzzz,429496720,32\n \t.bss"
    },
    {
      "sha": "2c49d5307c7d958fbc0aed9c2f18ee32548743ba",
      "filename": "gas/testsuite/gas/i386/x86-64-size-2.d",
      "status": "modified",
      "additions": 10,
      "deletions": 3,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/testsuite/gas/i386/x86-64-size-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/44f871628ccfcfd931f4619c60554f3bd6b57b8d/gas/testsuite/gas/i386/x86-64-size-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-size-2.d?ref=44f871628ccfcfd931f4619c60554f3bd6b57b8d",
      "patch": "@@ -1,11 +1,15 @@\n #name: x86-64 size 2\n #source: size-2.s\n-#objdump: -dwr\n-\n+#objdump: -dhwr\n \n .*: +file format .*\n \n-\n+Sections:\n+Idx Name +Size .*\n+  0 \\.text +0*3c .*\n+  1 \\.data +0*5c .*\n+  2 \\.bss +0*199999(ae|b0) .*\n+#...\n Disassembly of section .text:\n \n 0+ <.text>:\n@@ -18,4 +22,7 @@ Disassembly of section .text:\n [ \t]*[a-f0-9]+:\tb8 90 99 99 19       \tmov    \\$0x19999990,%eax\n [ \t]*[a-f0-9]+:\tb8 70 99 99 19       \tmov    \\$0x19999970,%eax\n [ \t]*[a-f0-9]+:\tb8 b0 99 99 19       \tmov    \\$0x199999b0,%eax\n+[ \t]*[a-f0-9]+:\tb8 3c 00 00 00       \tmov    \\$0x3c,%eax\n+[ \t]*[a-f0-9]+:\tb8 60 00 00 00       \tmov    \\$0x60,%eax\n+[ \t]*[a-f0-9]+:\tb8 (ae|b0) 99 99 09       \tmov    \\$0x99999(ae|b0),%eax\n #pass"
    }
  ]
}