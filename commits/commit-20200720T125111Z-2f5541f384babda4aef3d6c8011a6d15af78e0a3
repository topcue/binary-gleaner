{
  "sha": "2f5541f384babda4aef3d6c8011a6d15af78e0a3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmY1NTQxZjM4NGJhYmRhNGFlZjNkNmM4MDExYTZkMTVhZjc4ZTBhMw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-07-20T04:02:34Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-07-20T12:51:11Z"
    },
    "message": "PR26265, Spurious 'gc-sections requires ... when --init or --fini\n\nbfd/\n\t* elflink.c (_bfd_elf_gc_keep): Use bfd_is_const_section.\nld/\n\tPR 26265\n\t* ldlang.c (undef_from_cmdline): Delete.\n\t(ldlang_add_undef): Mark \"cmdline\" param unused.\n\t(lang_end): Traverse gc_sym_list to determine whether a symbol root\n\thas been specified.  Update error message.\n\t* testsuite/ld-gc/noent.d: Adjust for changed error message.",
    "tree": {
      "sha": "77de27fb62718a1cdcff15552aaee892704d6c7b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/77de27fb62718a1cdcff15552aaee892704d6c7b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2f5541f384babda4aef3d6c8011a6d15af78e0a3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f5541f384babda4aef3d6c8011a6d15af78e0a3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2f5541f384babda4aef3d6c8011a6d15af78e0a3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f5541f384babda4aef3d6c8011a6d15af78e0a3/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b243ba58e833dbb03f3746c0146f1450822c5d05",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b243ba58e833dbb03f3746c0146f1450822c5d05",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b243ba58e833dbb03f3746c0146f1450822c5d05"
    }
  ],
  "stats": {
    "total": 44,
    "additions": 34,
    "deletions": 10
  },
  "files": [
    {
      "sha": "d6a1d87e5e77595b7dc1fa11d15df2271bae4c81",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f5541f384babda4aef3d6c8011a6d15af78e0a3/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f5541f384babda4aef3d6c8011a6d15af78e0a3/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=2f5541f384babda4aef3d6c8011a6d15af78e0a3",
      "patch": "@@ -1,3 +1,7 @@\n+2020-07-20  Alan Modra  <amodra@gmail.com>\n+\n+\t* elflink.c (_bfd_elf_gc_keep): Use bfd_is_const_section.\n+\n 2020-07-19  Alan Modra  <amodra@gmail.com>\n \n \t* elf64-ppc.c (struct ppc_link_hash_table): Add has_power10_relocs."
    },
    {
      "sha": "286fc1125056f3a28617a3de4f1f4c5256dafed2",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f5541f384babda4aef3d6c8011a6d15af78e0a3/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f5541f384babda4aef3d6c8011a6d15af78e0a3/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=2f5541f384babda4aef3d6c8011a6d15af78e0a3",
      "patch": "@@ -13779,8 +13779,7 @@ _bfd_elf_gc_keep (struct bfd_link_info *info)\n       if (h != NULL\n \t  && (h->root.type == bfd_link_hash_defined\n \t      || h->root.type == bfd_link_hash_defweak)\n-\t  && !bfd_is_abs_section (h->root.u.def.section)\n-\t  && !bfd_is_und_section (h->root.u.def.section))\n+\t  && !bfd_is_const_section (h->root.u.def.section))\n \th->root.u.def.section->flags |= SEC_KEEP;\n     }\n }"
    },
    {
      "sha": "13c25fa26a3a9b5cd044868c89e78684bb1ef3de",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f5541f384babda4aef3d6c8011a6d15af78e0a3/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f5541f384babda4aef3d6c8011a6d15af78e0a3/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=2f5541f384babda4aef3d6c8011a6d15af78e0a3",
      "patch": "@@ -1,3 +1,12 @@\n+2020-07-20  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 26265\n+\t* ldlang.c (undef_from_cmdline): Delete.\n+\t(ldlang_add_undef): Mark \"cmdline\" param unused.\n+\t(lang_end): Traverse gc_sym_list to determine whether a symbol root\n+\thas been specified.  Update error message.\n+\t* testsuite/ld-gc/noent.d: Adjust for changed error message.\n+\n 2020-07-20  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gas/26263"
    },
    {
      "sha": "2b3a5f9069c0ddc4422b6111e1d3af3b9d11633d",
      "filename": "ld/ldlang.c",
      "status": "modified",
      "additions": 19,
      "deletions": 7,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f5541f384babda4aef3d6c8011a6d15af78e0a3/ld/ldlang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f5541f384babda4aef3d6c8011a6d15af78e0a3/ld/ldlang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.c?ref=2f5541f384babda4aef3d6c8011a6d15af78e0a3",
      "patch": "@@ -123,7 +123,6 @@ struct bfd_sym_chain entry_symbol = { NULL, NULL };\n const char *entry_section = \".text\";\n struct lang_input_statement_flags input_flags;\n bfd_boolean entry_from_cmdline;\n-bfd_boolean undef_from_cmdline;\n bfd_boolean lang_has_input_file = FALSE;\n bfd_boolean had_output_filename = FALSE;\n bfd_boolean lang_float_flag = FALSE;\n@@ -3895,11 +3894,10 @@ typedef struct bfd_sym_chain ldlang_undef_chain_list_type;\n #define ldlang_undef_chain_list_head entry_symbol.next\n \n void\n-ldlang_add_undef (const char *const name, bfd_boolean cmdline)\n+ldlang_add_undef (const char *const name, bfd_boolean cmdline ATTRIBUTE_UNUSED)\n {\n   ldlang_undef_chain_list_type *new_undef;\n \n-  undef_from_cmdline = undef_from_cmdline || cmdline;\n   new_undef = stat_alloc (sizeof (*new_undef));\n   new_undef->next = ldlang_undef_chain_list_head;\n   ldlang_undef_chain_list_head = new_undef;\n@@ -6839,10 +6837,24 @@ lang_end (void)\n      --gc-sections, unless --gc-keep-exported was also given.  */\n   if (bfd_link_relocatable (&link_info)\n       && link_info.gc_sections\n-      && !link_info.gc_keep_exported\n-      && !(entry_from_cmdline || undef_from_cmdline))\n-    einfo (_(\"%F%P: gc-sections requires either an entry or \"\n-\t     \"an undefined symbol\\n\"));\n+      && !link_info.gc_keep_exported)\n+    {\n+      struct bfd_sym_chain *sym;\n+\n+      for (sym = link_info.gc_sym_list; sym != NULL; sym = sym->next)\n+\t{\n+\t  h = bfd_link_hash_lookup (link_info.hash, sym->name,\n+\t\t\t\t    FALSE, FALSE, FALSE);\n+\t  if (h != NULL\n+\t      && (h->type == bfd_link_hash_defined\n+\t\t  || h->type == bfd_link_hash_defweak)\n+\t      && !bfd_is_const_section (h->u.def.section))\n+\t    break;\n+\t}\n+      if (!sym)\n+\teinfo (_(\"%F%P: --gc-sections requires a defined symbol root \"\n+\t\t \"specified by -e or -u\\n\"));\n+    }\n \n   if (entry_symbol.name == NULL)\n     {"
    },
    {
      "sha": "49808229b13b8002f11e7052bc3dd768ac85c8b6",
      "filename": "ld/testsuite/ld-gc/noent.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2f5541f384babda4aef3d6c8011a6d15af78e0a3/ld/testsuite/ld-gc/noent.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2f5541f384babda4aef3d6c8011a6d15af78e0a3/ld/testsuite/ld-gc/noent.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/noent.d?ref=2f5541f384babda4aef3d6c8011a6d15af78e0a3",
      "patch": "@@ -1,3 +1,3 @@\n # name: --gc-sections -r without -e\n # ld: --gc-sections -r\n-# error: gc-sections requires either an entry or an undefined symbol\n+# error: --gc-sections requires .*"
    }
  ]
}