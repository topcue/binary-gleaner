{
  "sha": "4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGJjY2M4NzVkMmJhNWNmOGY4NDg0YWUyYWE4M2QwZjFiNzExNWY3NA==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-11-29T19:36:13Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-11-29T19:41:47Z"
    },
    "message": "gold: Add endbr64 to IBT TLSDESC PLT entry\n\nGold generates:\n\n c10:   ff 35 da 23 00 00       push   0x23da(%rip)        # 2ff0 <_GLOBAL_OFFSET_TABLE_+0x8>\n c16:   f2 ff 25 c3 23 00 00    bnd jmp *0x23c3(%rip)        # 2fe0 <_DYNAMIC+0x260>\n c1d:   0f 1f 00                nopl   (%rax)\n\nfor IBT TLSDESC PLT entry which misses endbr64.  Add endbr64 to generate:\n\n c10:   f3 0f 1e fa             endbr64\n c14:   ff 35 d6 23 00 00       push   0x23d6(%rip)        # 2ff0 <_GLOBAL_OFFSET_TABLE_+0x8>\n c1a:   ff 25 c0 23 00 00       jmp    *0x23c0(%rip)        # 2fe0 <_DYNAMIC+0x260>\n\n\tPR ld/26972\n\t* x86_64.cc (Output_data_plt_x86_64_ibt::tlsdesc_plt_entry): Add\n\tendbr64.\n\t(Output_data_plt_x86_64_ibt::do_fill_tlsdesc_entry): Adjusted.",
    "tree": {
      "sha": "53bdefbbbd3d68e7eb1feb8275edfc9e7562cea1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/53bdefbbbd3d68e7eb1feb8275edfc9e7562cea1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9f1212394fa283e2748a83be8bca240710e696ca",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9f1212394fa283e2748a83be8bca240710e696ca",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9f1212394fa283e2748a83be8bca240710e696ca"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 13,
    "deletions": 6
  },
  "files": [
    {
      "sha": "a03163ebb8afc166a58f18e3f14c615c20a36eb5",
      "filename": "gold/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74/gold/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74/gold/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/ChangeLog?ref=4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74",
      "patch": "@@ -1,3 +1,10 @@\n+2020-11-29  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/26972\n+\t* x86_64.cc (Output_data_plt_x86_64_ibt::tlsdesc_plt_entry): Add\n+\tendbr64.\n+\t(Output_data_plt_x86_64_ibt::do_fill_tlsdesc_entry): Adjusted.\n+\n 2020-11-29  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gold/26939"
    },
    {
      "sha": "b570d6f439b69d3f18d220ee96785f8163fc9c90",
      "filename": "gold/x86_64.cc",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74/gold/x86_64.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74/gold/x86_64.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/x86_64.cc?ref=4bccc875d2ba5cf8f8484ae2aa83d0f1b7115f74",
      "patch": "@@ -2480,11 +2480,11 @@ Output_data_plt_x86_64_ibt<size>::tlsdesc_plt_entry[plt_entry_size] =\n {\n   // From Alexandre Oliva, \"Thread-Local Storage Descriptors for IA32\n   // and AMD64/EM64T\", Version 0.9.4 (2005-10-10).\n+  0xf3, 0x0f, 0x1e, 0xfa, // endbr64\n   0xff, 0x35,\t\t// pushq x(%rip)\n   0, 0, 0, 0,\t\t// replaced with address of linkmap GOT entry (at PLTGOT + 8)\n-  0xf2, 0xff, 0x25,\t// jmpq *y(%rip)\n+  0xff, 0x25,\t\t// jmpq *y(%rip)\n   0, 0, 0, 0,\t\t// replaced with offset of reserved TLSDESC_GOT entry\n-  0x0f,\t0x1f, 0\t\t// nop\n };\n \n template<int size>\n@@ -2498,15 +2498,15 @@ Output_data_plt_x86_64_ibt<size>::do_fill_tlsdesc_entry(\n     unsigned int plt_offset)\n {\n   memcpy(pov, tlsdesc_plt_entry, plt_entry_size);\n-  elfcpp::Swap_unaligned<32, false>::writeval(pov + 2,\n+  elfcpp::Swap_unaligned<32, false>::writeval(pov + 6,\n \t\t\t\t\t      (got_address + 8\n \t\t\t\t\t       - (plt_address + plt_offset\n-\t\t\t\t\t\t  + 6)));\n-  elfcpp::Swap_unaligned<32, false>::writeval(pov + 9,\n+\t\t\t\t\t\t  + 10)));\n+  elfcpp::Swap_unaligned<32, false>::writeval(pov + 12,\n \t\t\t\t\t      (got_base\n \t\t\t\t\t       + tlsdesc_got_offset\n \t\t\t\t\t       - (plt_address + plt_offset\n-\t\t\t\t\t\t  + 13)));\n+\t\t\t\t\t\t  + 16)));\n }\n \n // The .eh_frame unwind information for the PLT."
    }
  ]
}