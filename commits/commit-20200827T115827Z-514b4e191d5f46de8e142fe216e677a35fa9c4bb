{
  "sha": "514b4e191d5f46de8e142fe216e677a35fa9c4bb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTE0YjRlMTkxZDVmNDZkZThlMTQyZmUyMTZlNjc3YTM1ZmE5YzRiYg==",
  "commit": {
    "author": {
      "name": "Jeremy Drake",
      "email": "sourceware-bugzilla@jdrake.com",
      "date": "2020-08-27T11:58:27Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-08-27T11:58:27Z"
    },
    "message": "Change the default characteristics of DLLs built by the linker to more secure settings.\n\n\tPR 19011\n\t* emultempl/pe.em (DEFAULT_DLL_CHARACTERISTICS): Define.\n\t(pe_dll_characteristics): Initialise to DEFAULT_DLL_CHARACTERISTICS.\n\t(add_options): Add options to disable DLL characteristics.\n\t(list_options): List the new options.\n\t(handle_options): Handle the new options.\n\t* emultempl/pep.em: Similar changes to above.\n\t(NT_EXE_IMAGE_BASE): Default to an address above 4G.\n\t(NT_DLL_IMAGE_BASE, NT_DLL_AUTO_IMAGE_BASE,\n\t(NT_DLL_AUTO_IMAGE_MASK): Likewise.\n\t* ld.texi: Document the new options.\n\t* pe-dll.c (pe_dll_enable_reloc_section): Change to default to\n\ttrue.\n\t(generate_reloc): Do nothing if there is no reloc section.\n\t(pe_exe_fill_sections): Only assign the reloc section contents if\n\tthe section exists.\n\t* testsuite/ld-pe/pe.exp: Add the --disable-reloc-section flag to\n\tthe .secrel32 tests.\n\t* testsuite/ld-scripts/provide-8.d: Expect for fail on PE targets.\n\t* NEWS: Mention the change in DLL generation.",
    "tree": {
      "sha": "f4173c8f49e5987adc1cd1dd4c515c9493bbe268",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f4173c8f49e5987adc1cd1dd4c515c9493bbe268"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/514b4e191d5f46de8e142fe216e677a35fa9c4bb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/514b4e191d5f46de8e142fe216e677a35fa9c4bb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/514b4e191d5f46de8e142fe216e677a35fa9c4bb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/514b4e191d5f46de8e142fe216e677a35fa9c4bb/comments",
  "author": null,
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f2e5245f4169c2a1849ba998872e245c1b303950",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f2e5245f4169c2a1849ba998872e245c1b303950",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f2e5245f4169c2a1849ba998872e245c1b303950"
    }
  ],
  "stats": {
    "total": 244,
    "additions": 201,
    "deletions": 43
  },
  "files": [
    {
      "sha": "7a00278508cb1eba900202c7575f27aedb3d3f34",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -1,3 +1,26 @@\n+2020-08-27  Jeremy Drake  <sourceware-bugzilla@jdrake.com>\n+\n+\tPR 19011\n+\t* emultempl/pe.em (DEFAULT_DLL_CHARACTERISTICS): Define.\n+\t(pe_dll_characteristics): Initialise to DEFAULT_DLL_CHARACTERISTICS.\n+\t(add_options): Add options to disable DLL characteristics.\n+\t(list_options): List the new options.\n+\t(handle_options): Handle the new options.\n+\t* emultempl/pep.em: Similar changes to above.\n+\t(NT_EXE_IMAGE_BASE): Default to an address above 4G.\n+\t(NT_DLL_IMAGE_BASE, NT_DLL_AUTO_IMAGE_BASE,\n+\t(NT_DLL_AUTO_IMAGE_MASK): Likewise.\n+\t* ld.texi: Document the new options.\n+\t* pe-dll.c (pe_dll_enable_reloc_section): Change to default to\n+\ttrue.\n+\t(generate_reloc): Do nothing if there is no reloc section.\n+\t(pe_exe_fill_sections): Only assign the reloc section contents if\n+\tthe section exists.\n+\t* testsuite/ld-pe/pe.exp: Add the --disable-reloc-section flag to\n+\tthe .secrel32 tests.\n+\t* testsuite/ld-scripts/provide-8.d: Expect for fail on PE targets.\n+\t* NEWS: Mention the change in DLL generation.\n+\n 2020-08-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* testsuite/ld-elf/indirect.exp: Append $NOSANTIZE_CFLAGS to CC."
    },
    {
      "sha": "695348141b88e3c34f0ec89da464a83a10fa92a6",
      "filename": "ld/NEWS",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/NEWS?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -1,5 +1,8 @@\n -*- text -*-\n \n+* The creation of PE format DLLs now defaults to using a more secure set of DLL\n+  characteristics.\n+\n * The linker now deduplicates the types in .ctf sections.  The new\n   command-line option --ctf-share-types describes how to do this:\n   its default value, share-unconflicted, produces the most compact"
    },
    {
      "sha": "9d2097f486ab75aedee41c324c54c973db3ff259",
      "filename": "ld/emultempl/pe.em",
      "status": "modified",
      "additions": 64,
      "deletions": 11,
      "changes": 75,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/emultempl/pe.em",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/emultempl/pe.em",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/emultempl/pe.em?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -104,6 +104,9 @@ fragment <<EOF\n #define DEFAULT_PSEUDO_RELOC_VERSION 1\n #endif\n \n+#define DEFAULT_DLL_CHARACTERISTICS\t(IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE \\\n+\t\t\t\t\t | IMAGE_DLL_CHARACTERISTICS_NX_COMPAT)\n+\n #if defined(TARGET_IS_i386pe) || ! defined(DLL_SUPPORT)\n #define\tPE_DEF_SUBSYSTEM\t\t3\n #else\n@@ -129,7 +132,7 @@ static flagword real_flags = 0;\n static int support_old_code = 0;\n static char * thumb_entry_symbol = NULL;\n static lang_assignment_statement_type *image_base_statement = 0;\n-static unsigned short pe_dll_characteristics = 0;\n+static unsigned short pe_dll_characteristics = DEFAULT_DLL_CHARACTERISTICS;\n static bfd_boolean insert_timestamp = TRUE;\n static const char *emit_build_id;\n \n@@ -271,6 +274,17 @@ fragment <<EOF\n #define OPTION_NO_INSERT_TIMESTAMP\t(OPTION_INSERT_TIMESTAMP + 1)\n #define OPTION_BUILD_ID\t\t\t(OPTION_NO_INSERT_TIMESTAMP + 1)\n #define OPTION_ENABLE_RELOC_SECTION\t(OPTION_BUILD_ID + 1)\n+#define OPTION_DISABLE_RELOC_SECTION\t(OPTION_ENABLE_RELOC_SECTION + 1)\n+/* DLL Characteristics flags.  */\n+#define OPTION_DISABLE_DYNAMIC_BASE\t(OPTION_DISABLE_RELOC_SECTION + 1)\n+#define OPTION_DISABLE_FORCE_INTEGRITY\t(OPTION_DISABLE_DYNAMIC_BASE + 1)\n+#define OPTION_DISABLE_NX_COMPAT\t(OPTION_DISABLE_FORCE_INTEGRITY + 1)\n+#define OPTION_DISABLE_NO_ISOLATION\t(OPTION_DISABLE_NX_COMPAT + 1)\n+#define OPTION_DISABLE_NO_SEH\t\t(OPTION_DISABLE_NO_ISOLATION + 1)\n+#define OPTION_DISABLE_NO_BIND\t\t(OPTION_DISABLE_NO_SEH + 1)\n+#define OPTION_DISABLE_WDM_DRIVER\t(OPTION_DISABLE_NO_BIND + 1)\n+#define OPTION_DISABLE_TERMINAL_SERVER_AWARE \\\n+\t\t\t\t\t(OPTION_DISABLE_WDM_DRIVER + 1)\n \n static void\n gld${EMULATION_NAME}_add_options\n@@ -342,15 +356,24 @@ gld${EMULATION_NAME}_add_options\n     {\"enable-long-section-names\", no_argument, NULL, OPTION_ENABLE_LONG_SECTION_NAMES},\n     {\"disable-long-section-names\", no_argument, NULL, OPTION_DISABLE_LONG_SECTION_NAMES},\n     {\"dynamicbase\",no_argument, NULL, OPTION_DYNAMIC_BASE},\n+    {\"disable-dynamicbase\",no_argument, NULL, OPTION_DISABLE_DYNAMIC_BASE},\n     {\"forceinteg\", no_argument, NULL, OPTION_FORCE_INTEGRITY},\n+    {\"disable-forceinteg\", no_argument, NULL, OPTION_DISABLE_FORCE_INTEGRITY},\n     {\"nxcompat\", no_argument, NULL, OPTION_NX_COMPAT},\n+    {\"disable-nxcompat\", no_argument, NULL, OPTION_DISABLE_NX_COMPAT},\n     {\"no-isolation\", no_argument, NULL, OPTION_NO_ISOLATION},\n+    {\"disable-no-isolation\", no_argument, NULL, OPTION_DISABLE_NO_ISOLATION},\n     {\"no-seh\", no_argument, NULL, OPTION_NO_SEH},\n+    {\"disable-no-seh\", no_argument, NULL, OPTION_DISABLE_NO_SEH},\n     {\"no-bind\", no_argument, NULL, OPTION_NO_BIND},\n+    {\"disable-no-bind\", no_argument, NULL, OPTION_DISABLE_NO_BIND},\n     {\"wdmdriver\", no_argument, NULL, OPTION_WDM_DRIVER},\n+    {\"disable-wdmdriver\", no_argument, NULL, OPTION_DISABLE_WDM_DRIVER},\n     {\"tsaware\", no_argument, NULL, OPTION_TERMINAL_SERVER_AWARE},\n+    {\"disable-tsaware\", no_argument, NULL, OPTION_DISABLE_TERMINAL_SERVER_AWARE},\n     {\"build-id\", optional_argument, NULL, OPTION_BUILD_ID},\n     {\"enable-reloc-section\", no_argument, NULL, OPTION_ENABLE_RELOC_SECTION},\n+    {\"disable-reloc-section\", no_argument, NULL, OPTION_DISABLE_RELOC_SECTION},\n     {NULL, no_argument, NULL, 0}\n   };\n \n@@ -414,7 +437,7 @@ static definfo init[] =\n   D(SizeOfHeapReserve,\"__size_of_heap_reserve__\", 0x100000, FALSE),\n   D(SizeOfHeapCommit,\"__size_of_heap_commit__\", 0x1000, FALSE),\n   D(LoaderFlags,\"__loader_flags__\", 0x0, FALSE),\n-  D(DllCharacteristics, \"__dll_characteristics__\", 0x0, FALSE),\n+  D(DllCharacteristics, \"__dll_characteristics__\", DEFAULT_DLL_CHARACTERISTICS, FALSE),\n   { NULL, 0, 0, NULL, 0 , FALSE}\n };\n \n@@ -483,18 +506,21 @@ gld_${EMULATION_NAME}_list_options (FILE *file)\n                                        executable image files\\n\"));\n   fprintf (file, _(\"  --disable-long-section-names       Never use long COFF section names, even\\n\\\n                                        in object files\\n\"));\n-  fprintf (file, _(\"  --dynamicbase                      Image base address may be relocated using\\n\\\n+  fprintf (file, _(\"  --[disable-]dynamicbase            Image base address may be relocated using\\n\\\n                                        address space layout randomization (ASLR)\\n\"));\n   fprintf (file, _(\"  --enable-reloc-section             Create the base relocation table\\n\"));\n-  fprintf (file, _(\"  --forceinteg               Code integrity checks are enforced\\n\"));\n-  fprintf (file, _(\"  --nxcompat                 Image is compatible with data execution prevention\\n\"));\n-  fprintf (file, _(\"  --no-isolation             Image understands isolation but do not isolate the image\\n\"));\n-  fprintf (file, _(\"  --no-seh                   Image does not use SEH. No SE handler may\\n\\\n+  fprintf (file, _(\"  --disable-reloc-section            Do not create the base relocation table\\n\"));\n+  fprintf (file, _(\"  --[disable-]forceinteg             Code integrity checks are enforced\\n\"));\n+  fprintf (file, _(\"  --[disable-]nxcompat               Image is compatible with data execution\\n\\\n+                                       prevention\\n\"));\n+  fprintf (file, _(\"  --[disable-]no-isolation           Image understands isolation but do not\\n\\\n+                                       isolate the image\\n\"));\n+  fprintf (file, _(\"  --[disable-]no-seh                 Image does not use SEH. No SE handler may\\n\\\n                                        be called in this image\\n\"));\n-  fprintf (file, _(\"  --no-bind                  Do not bind this image\\n\"));\n-  fprintf (file, _(\"  --wdmdriver                Driver uses the WDM model\\n\"));\n-  fprintf (file, _(\"  --tsaware                  Image is Terminal Server aware\\n\"));\n-  fprintf (file, _(\"  --build-id[=STYLE]         Generate build ID\\n\"));\n+  fprintf (file, _(\"  --[disable-]no-bind                Do not bind this image\\n\"));\n+  fprintf (file, _(\"  --[disable-]wdmdriver              Driver uses the WDM model\\n\"));\n+  fprintf (file, _(\"  --[disable-]tsaware                Image is Terminal Server aware\\n\"));\n+  fprintf (file, _(\"  --build-id[=STYLE]                 Generate build ID\\n\"));\n }\n \n \n@@ -862,27 +888,54 @@ gld${EMULATION_NAME}_handle_option (int optc)\n     case OPTION_ENABLE_RELOC_SECTION:\n       pe_dll_enable_reloc_section = 1;\n       break;\n+    case OPTION_DISABLE_RELOC_SECTION:\n+      pe_dll_enable_reloc_section = 0;\n+      /* fall through */\n+    case OPTION_DISABLE_DYNAMIC_BASE:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE;\n+      break;\n     case OPTION_FORCE_INTEGRITY:\n       pe_dll_characteristics |= IMAGE_DLL_CHARACTERISTICS_FORCE_INTEGRITY;\n       break;\n+    case OPTION_DISABLE_FORCE_INTEGRITY:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_FORCE_INTEGRITY;\n+      break;\n     case OPTION_NX_COMPAT:\n       pe_dll_characteristics |= IMAGE_DLL_CHARACTERISTICS_NX_COMPAT;\n       break;\n+    case OPTION_DISABLE_NX_COMPAT:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_NX_COMPAT;\n+      break;\n     case OPTION_NO_ISOLATION:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_NO_ISOLATION;\n       break;\n+    case OPTION_DISABLE_NO_ISOLATION:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_NO_ISOLATION;\n+      break;\n     case OPTION_NO_SEH:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_NO_SEH;\n       break;\n+    case OPTION_DISABLE_NO_SEH:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_NO_SEH;\n+      break;\n     case OPTION_NO_BIND:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_NO_BIND;\n       break;\n+    case OPTION_DISABLE_NO_BIND:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_NO_BIND;\n+      break;\n     case OPTION_WDM_DRIVER:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_WDM_DRIVER;\n       break;\n+    case OPTION_DISABLE_WDM_DRIVER:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_WDM_DRIVER;\n+      break;\n     case OPTION_TERMINAL_SERVER_AWARE:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE;\n       break;\n+    case OPTION_DISABLE_TERMINAL_SERVER_AWARE:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE;\n+      break;\n     case OPTION_BUILD_ID:\n       free ((char *) emit_build_id);\n       emit_build_id = NULL;"
    },
    {
      "sha": "7d9395168d2a505c61c787c45162d7f93e095ed1",
      "filename": "ld/emultempl/pep.em",
      "status": "modified",
      "additions": 74,
      "deletions": 17,
      "changes": 91,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/emultempl/pep.em",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/emultempl/pep.em",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/emultempl/pep.em?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -99,24 +99,28 @@ fragment <<EOF\n #define DLL_SUPPORT\n #endif\n \n+#define DEFAULT_DLL_CHARACTERISTICS\t(IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE \\\n+\t\t\t\t\t | IMAGE_DLL_CHARACTERISTICS_HIGH_ENTROPY_VA \\\n+\t\t\t\t\t | IMAGE_DLL_CHARACTERISTICS_NX_COMPAT)\n+\n #if defined(TARGET_IS_i386pep) || ! defined(DLL_SUPPORT)\n #define\tPE_DEF_SUBSYSTEM\t\t3\n #undef NT_EXE_IMAGE_BASE\n #define NT_EXE_IMAGE_BASE \\\n   ((bfd_vma) (${move_default_addr_high} ? 0x100400000LL \\\n-\t\t\t\t\t: 0x400000LL))\n+\t\t\t\t\t: 0x140000000LL))\n #undef NT_DLL_IMAGE_BASE\n #define NT_DLL_IMAGE_BASE \\\n   ((bfd_vma) (${move_default_addr_high} ? 0x400000000LL \\\n-\t\t\t\t\t: 0x10000000LL))\n+\t\t\t\t\t: 0x180000000LL))\n #undef NT_DLL_AUTO_IMAGE_BASE\n #define NT_DLL_AUTO_IMAGE_BASE \\\n   ((bfd_vma) (${move_default_addr_high} ? 0x400000000LL \\\n-\t\t\t\t\t: 0x61300000LL))\n+\t\t\t\t\t: 0x1C0000000LL))\n #undef NT_DLL_AUTO_IMAGE_MASK\n #define NT_DLL_AUTO_IMAGE_MASK \\\n   ((bfd_vma) (${move_default_addr_high} ? 0x1ffff0000LL \\\n-\t\t\t\t\t: 0x0ffc0000LL))\n+\t\t\t\t\t: 0x1ffff0000LL))\n #else\n #undef  NT_EXE_IMAGE_BASE\n #define NT_EXE_IMAGE_BASE \\\n@@ -147,7 +151,7 @@ static int pep_subsystem = ${SUBSYSTEM};\n static flagword real_flags = IMAGE_FILE_LARGE_ADDRESS_AWARE;\n static int support_old_code = 0;\n static lang_assignment_statement_type *image_base_statement = 0;\n-static unsigned short pe_dll_characteristics = 0;\n+static unsigned short pe_dll_characteristics = DEFAULT_DLL_CHARACTERISTICS;\n static bfd_boolean insert_timestamp = TRUE;\n static const char *emit_build_id;\n \n@@ -248,7 +252,17 @@ enum options\n   OPTION_NO_INSERT_TIMESTAMP,\n   OPTION_TERMINAL_SERVER_AWARE,\n   OPTION_BUILD_ID,\n-  OPTION_ENABLE_RELOC_SECTION\n+  OPTION_ENABLE_RELOC_SECTION,\n+  OPTION_DISABLE_RELOC_SECTION,\n+  OPTION_DISABLE_HIGH_ENTROPY_VA,\n+  OPTION_DISABLE_DYNAMIC_BASE,\n+  OPTION_DISABLE_FORCE_INTEGRITY,\n+  OPTION_DISABLE_NX_COMPAT,\n+  OPTION_DISABLE_NO_ISOLATION,\n+  OPTION_DISABLE_NO_SEH,\n+  OPTION_DISABLE_NO_BIND,\n+  OPTION_DISABLE_WDM_DRIVER,\n+  OPTION_DISABLE_TERMINAL_SERVER_AWARE\n };\n \n static void\n@@ -327,6 +341,16 @@ gld${EMULATION_NAME}_add_options\n     {\"no-insert-timestamp\", no_argument, NULL, OPTION_NO_INSERT_TIMESTAMP},\n     {\"build-id\", optional_argument, NULL, OPTION_BUILD_ID},\n     {\"enable-reloc-section\", no_argument, NULL, OPTION_ENABLE_RELOC_SECTION},\n+    {\"disable-reloc-section\", no_argument, NULL, OPTION_DISABLE_RELOC_SECTION},\n+    {\"disable-high-entropy-va\", no_argument, NULL, OPTION_DISABLE_HIGH_ENTROPY_VA},\n+    {\"disable-dynamicbase\",no_argument, NULL, OPTION_DISABLE_DYNAMIC_BASE},\n+    {\"disable-forceinteg\", no_argument, NULL, OPTION_DISABLE_FORCE_INTEGRITY},\n+    {\"disable-nxcompat\", no_argument, NULL, OPTION_DISABLE_NX_COMPAT},\n+    {\"disable-no-isolation\", no_argument, NULL, OPTION_DISABLE_NO_ISOLATION},\n+    {\"disable-no-seh\", no_argument, NULL, OPTION_DISABLE_NO_SEH},\n+    {\"disable-no-bind\", no_argument, NULL, OPTION_DISABLE_NO_BIND},\n+    {\"disable-wdmdriver\", no_argument, NULL, OPTION_DISABLE_WDM_DRIVER},\n+    {\"disable-tsaware\", no_argument, NULL, OPTION_DISABLE_TERMINAL_SERVER_AWARE},\n     {NULL, no_argument, NULL, 0}\n   };\n \n@@ -384,7 +408,7 @@ static definfo init[] =\n   D(SizeOfHeapReserve,\"__size_of_heap_reserve__\", 0x100000, FALSE),\n   D(SizeOfHeapCommit,\"__size_of_heap_commit__\", 0x1000, FALSE),\n   D(LoaderFlags,\"__loader_flags__\", 0x0, FALSE),\n-  D(DllCharacteristics, \"__dll_characteristics__\", 0x0, FALSE),\n+  D(DllCharacteristics, \"__dll_characteristics__\", DEFAULT_DLL_CHARACTERISTICS, FALSE),\n   { NULL, 0, 0, NULL, 0, FALSE}\n };\n \n@@ -446,20 +470,23 @@ gld_${EMULATION_NAME}_list_options (FILE *file)\n                                        executable image files\\n\"));\n   fprintf (file, _(\"  --disable-long-section-names       Never use long COFF section names, even\\n\\\n                                        in object files\\n\"));\n-  fprintf (file, _(\"  --high-entropy-va                  Image is compatible with 64-bit address space\\n\\\n+  fprintf (file, _(\"  --[disable-]high-entropy-va        Image is compatible with 64-bit address space\\n\\\n                                        layout randomization (ASLR)\\n\"));\n-  fprintf (file, _(\"  --dynamicbase                      Image base address may be relocated using\\n\\\n+  fprintf (file, _(\"  --[disable-]dynamicbase            Image base address may be relocated using\\n\\\n                                        address space layout randomization (ASLR)\\n\"));\n   fprintf (file, _(\"  --enable-reloc-section             Create the base relocation table\\n\"));\n-  fprintf (file, _(\"  --forceinteg               Code integrity checks are enforced\\n\"));\n-  fprintf (file, _(\"  --nxcompat                 Image is compatible with data execution prevention\\n\"));\n-  fprintf (file, _(\"  --no-isolation             Image understands isolation but do not isolate the image\\n\"));\n-  fprintf (file, _(\"  --no-seh                   Image does not use SEH; no SE handler may\\n\\\n+  fprintf (file, _(\"  --disable-reloc-section            Do not create the base relocation table\\n\"));\n+  fprintf (file, _(\"  --[disable-]forceinteg             Code integrity checks are enforced\\n\"));\n+  fprintf (file, _(\"  --[disable-]nxcompat               Image is compatible with data execution\\n\\\n+                                       prevention\\n\"));\n+  fprintf (file, _(\"  --[disable-]no-isolation           Image understands isolation but do not\\n\\\n+                                       isolate the image\\n\"));\n+  fprintf (file, _(\"  --[disable-]no-seh                 Image does not use SEH; no SE handler may\\n\\\n                                        be called in this image\\n\"));\n-  fprintf (file, _(\"  --no-bind                  Do not bind this image\\n\"));\n-  fprintf (file, _(\"  --wdmdriver                Driver uses the WDM model\\n\"));\n-  fprintf (file, _(\"  --tsaware                  Image is Terminal Server aware\\n\"));\n-  fprintf (file, _(\"  --build-id[=STYLE]         Generate build ID\\n\"));\n+  fprintf (file, _(\"  --[disable-]no-bind                Do not bind this image\\n\"));\n+  fprintf (file, _(\"  --[disable-]wdmdriver              Driver uses the WDM model\\n\"));\n+  fprintf (file, _(\"  --[disable-]tsaware                Image is Terminal Server aware\\n\"));\n+  fprintf (file, _(\"  --build-id[=STYLE]                 Generate build ID\\n\"));\n #endif\n }\n \n@@ -809,27 +836,57 @@ gld${EMULATION_NAME}_handle_option (int optc)\n     case OPTION_ENABLE_RELOC_SECTION:\n       pep_dll_enable_reloc_section = 1;\n       break;\n+    case OPTION_DISABLE_RELOC_SECTION:\n+      pep_dll_enable_reloc_section = 0;\n+      /* fall through */\n+    case OPTION_DISABLE_DYNAMIC_BASE:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE;\n+      /* fall through */\n+    case OPTION_DISABLE_HIGH_ENTROPY_VA:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_HIGH_ENTROPY_VA;\n+      break;\n     case OPTION_FORCE_INTEGRITY:\n       pe_dll_characteristics |= IMAGE_DLL_CHARACTERISTICS_FORCE_INTEGRITY;\n       break;\n+    case OPTION_DISABLE_FORCE_INTEGRITY:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_FORCE_INTEGRITY;\n+      break;\n     case OPTION_NX_COMPAT:\n       pe_dll_characteristics |= IMAGE_DLL_CHARACTERISTICS_NX_COMPAT;\n       break;\n+    case OPTION_DISABLE_NX_COMPAT:\n+      pe_dll_characteristics &= ~ IMAGE_DLL_CHARACTERISTICS_NX_COMPAT;\n+      break;\n     case OPTION_NO_ISOLATION:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_NO_ISOLATION;\n       break;\n+    case OPTION_DISABLE_NO_ISOLATION:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_NO_ISOLATION;\n+      break;\n     case OPTION_NO_SEH:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_NO_SEH;\n       break;\n+    case OPTION_DISABLE_NO_SEH:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_NO_SEH;\n+      break;\n     case OPTION_NO_BIND:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_NO_BIND;\n       break;\n+    case OPTION_DISABLE_NO_BIND:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_NO_BIND;\n+      break;\n     case OPTION_WDM_DRIVER:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_WDM_DRIVER;\n       break;\n+    case OPTION_DISABLE_WDM_DRIVER:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_WDM_DRIVER;\n+      break;\n     case OPTION_TERMINAL_SERVER_AWARE:\n       pe_dll_characteristics |= IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE;\n       break;\n+    case OPTION_DISABLE_TERMINAL_SERVER_AWARE:\n+      pe_dll_characteristics &= ~ IMAGE_DLLCHARACTERISTICS_TERMINAL_SERVER_AWARE;\n+      break;\n     case OPTION_BUILD_ID:\n       free ((char *) emit_build_id);\n       emit_build_id = NULL;"
    },
    {
      "sha": "7d961c3bb8e747f32590eaa86b905b3643f3556b",
      "filename": "ld/ld.texi",
      "status": "modified",
      "additions": 26,
      "deletions": 8,
      "changes": 34,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/ld.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/ld.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ld.texi?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -3129,47 +3129,63 @@ of the PE file header:\n \n @kindex --high-entropy-va\n @item --high-entropy-va\n+@itemx --disable-high-entropy-va\n Image is compatible with 64-bit address space layout randomization\n-(ASLR).\n+(ASLR).  This option is enabled by default for 64-bit PE images.\n+\n This option also implies @option{--dynamicbase} and\n @option{--enable-reloc-section}.\n \n @kindex --dynamicbase\n @item --dynamicbase\n+@itemx --disable-dynamicbase\n The image base address may be relocated using address space layout\n randomization (ASLR).  This feature was introduced with MS Windows\n-Vista for i386 PE targets.\n+Vista for i386 PE targets.  This option is enabled by default but\n+can be disabled via the @option{--disable-dynamicbase} option.\n This option also implies @option{--enable-reloc-section}.\n \n @kindex --forceinteg\n @item --forceinteg\n-Code integrity checks are enforced.\n+@itemx --disable-forceinteg\n+Code integrity checks are enforced.  This option is disabled by\n+default.\n \n @kindex --nxcompat\n @item --nxcompat\n+@item --disable-nxcompat\n The image is compatible with the Data Execution Prevention.\n-This feature was introduced with MS Windows XP SP2 for i386 PE targets.\n+This feature was introduced with MS Windows XP SP2 for i386 PE\n+targets.  The option is enabled by default.\n \n @kindex --no-isolation\n @item --no-isolation\n+@itemx --disable-no-isolation\n Although the image understands isolation, do not isolate the image.\n+This option is disabled by default.\n \n @kindex --no-seh\n @item --no-seh\n+@itemx --disable-no-seh\n The image does not use SEH. No SE handler may be called from\n-this image.\n+this image.  This option is disabled by default.\n \n @kindex --no-bind\n @item --no-bind\n-Do not bind this image.\n+@itemx --disable-no-bind\n+Do not bind this image.  This option is disabled by default.\n \n @kindex --wdmdriver\n @item --wdmdriver\n-The driver uses the MS Windows Driver Model.\n+@itemx --disable-wdmdriver\n+The driver uses the MS Windows Driver Model.  This option is disabled\n+by default.\n \n @kindex --tsaware\n @item --tsaware\n-The image is Terminal Server aware.\n+@itemx --disable-tsaware\n+The image is Terminal Server aware.  This option is disabled by\n+default.\n \n @kindex --insert-timestamp\n @item --insert-timestamp\n@@ -3185,8 +3201,10 @@ identically.\n \n @kindex --enable-reloc-section\n @item --enable-reloc-section\n+@itemx --disable-reloc-section\n Create the base relocation table, which is necessary if the image\n is loaded at a different image base than specified in the PE header.\n+This option is enabled by default.\n @end table\n \n @c man end"
    },
    {
      "sha": "f2a17988944ed1d131e5d8b07271aef6b53a2416",
      "filename": "ld/pe-dll.c",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/pe-dll.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/pe-dll.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/pe-dll.c?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -160,7 +160,7 @@ int pe_dll_extra_pe_debug = 0;\n int pe_use_nul_prefixed_import_tables = 0;\n int pe_use_coff_long_section_names = -1;\n int pe_leading_underscore = -1;\n-int pe_dll_enable_reloc_section = 0;\n+int pe_dll_enable_reloc_section = 1;\n \n /* Static variables and types.  */\n \n@@ -1506,7 +1506,6 @@ pe_find_data_imports (const char *symhead,\n static void\n generate_reloc (bfd *abfd, struct bfd_link_info *info)\n {\n-\n   /* For .reloc stuff.  */\n   reloc_data_type *reloc_data;\n   int total_relocs = 0;\n@@ -1517,6 +1516,8 @@ generate_reloc (bfd *abfd, struct bfd_link_info *info)\n   bfd *b;\n   struct bfd_section *s;\n \n+  if (reloc_s == NULL)\n+    return;\n   total_relocs = 0;\n   for (b = info->input_bfds; b; b = b->link.next)\n     for (s = b->sections; s; s = s->next)\n@@ -1548,9 +1549,11 @@ generate_reloc (bfd *abfd, struct bfd_link_info *info)\n \t  if (s->output_section->vma == 0)\n \t    {\n \t      /* Huh?  Shouldn't happen, but punt if it does.  */\n+#if 0 /* This happens when linking with --just-symbols=<file>, so do not generate an error.  */\n \t      einfo (_(\"%P: zero vma section reloc detected: `%s' #%d f=%d\\n\"),\n \t\t     s->output_section->name, s->output_section->index,\n \t\t     s->output_section->flags);\n+#endif\n \t      continue;\n \t    }\n \n@@ -3631,7 +3634,8 @@ pe_exe_fill_sections (bfd *abfd, struct bfd_link_info *info)\n       /* Do the assignments again.  */\n       lang_do_assignments (lang_final_phase_enum);\n     }\n-  reloc_s->contents = reloc_d;\n+  if (reloc_s)\n+    reloc_s->contents = reloc_d;\n }\n \n bfd_boolean"
    },
    {
      "sha": "17dafbb02b8f080192dca9725e89a8a247b90379",
      "filename": "ld/testsuite/ld-pe/pe.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/testsuite/ld-pe/pe.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/testsuite/ld-pe/pe.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-pe/pe.exp?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -33,7 +33,7 @@ if {[istarget i*86-*-cygwin*]\n \n     if {[istarget x86_64-*-mingw*] } {\n       set pe_tests {\n-\t{\".secrel32\" \"\" \"\" \"\" {secrel1.s secrel2.s}\n+\t{\".secrel32\" \"--disable-reloc-section\" \"\" \"\" {secrel1.s secrel2.s}\n \t {{objdump -s secrel_64.d}} \"secrel.x\"}\n \t{\"Empty export table\" \"\" \"\" \"\" \"exports.s\"\n \t {{objdump -p exports64.d}} \"exports.dll\"}\n@@ -42,7 +42,7 @@ if {[istarget i*86-*-cygwin*]\n       }\n     } elseif {[istarget i*86-*-cygwin*] } {\n       set pe_tests {\n-\t{\".secrel32\" \"--disable-auto-import\" \"\" \"\" {secrel1.s secrel2.s}\n+\t{\".secrel32\" \"--disable-auto-import --disable-reloc-section\" \"\" \"\" {secrel1.s secrel2.s}\n \t {{objdump -s secrel.d}} \"secrel.x\"}\n \t{\"Empty export table\" \"\" \"\" \"\" \"exports.s\"\n \t {{objdump -p exports.d}} \"exports.dll\"}\n@@ -51,7 +51,7 @@ if {[istarget i*86-*-cygwin*]\n       }\n     } else {\n       set pe_tests {\n-\t{\".secrel32\" \"\" \"\" \"\" {secrel1.s secrel2.s}\n+\t{\".secrel32\" \"--disable-reloc-section\" \"\" \"\" {secrel1.s secrel2.s}\n \t {{objdump -s secrel.d}} \"secrel.x\"}\n \t{\"Empty export table\" \"\" \"\" \"\" \"exports.s\"\n \t {{objdump -p exports.d}} \"exports.dll\"}"
    },
    {
      "sha": "1dd5553ed32b4d4dcfd0e64aca8893dce4516c9d",
      "filename": "ld/testsuite/ld-scripts/provide-8.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/testsuite/ld-scripts/provide-8.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/514b4e191d5f46de8e142fe216e677a35fa9c4bb/ld/testsuite/ld-scripts/provide-8.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/provide-8.d?ref=514b4e191d5f46de8e142fe216e677a35fa9c4bb",
      "patch": "@@ -1,7 +1,7 @@\n #source: provide-5.s\n #ld: -T provide-8.t\n #nm: -B\n-#xfail: mmix-*-* sh-*-pe spu-*-*\n+#xfail: mmix-*-* *-*-pe spu-*-* *-*-mingw* *-*-cygwin\n \n #...\n 0+4000 D __FOO"
    }
  ]
}