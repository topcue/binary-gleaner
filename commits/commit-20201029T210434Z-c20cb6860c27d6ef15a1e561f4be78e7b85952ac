{
  "sha": "c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzIwY2I2ODYwYzI3ZDZlZjE1YTFlNTYxZjRiZTc4ZTdiODU5NTJhYw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-10-29T21:04:33Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-10-29T21:04:34Z"
    },
    "message": "Remove exec_filename macro\n\nThis removes the exec_filename macro, replacing it with uses of the\nmember of current_program_space.  This also renames that member, and\nchanges it to be a unique pointer.\n\ngdb/ChangeLog\n2020-10-29  Tom Tromey  <tom@tromey.com>\n\n\t* progspace.h (struct program_space) <exec_filename>: Rename from\n\tpspace_exec_filename.  Now a unique_xmalloc_ptr.\n\t* inferior.c (print_selected_inferior): Update.\n\t(print_inferior): Update.\n\t* mi/mi-main.c (print_one_inferior): Update.\n\t* exec.h (exec_filename): Remove macro.\n\t* corefile.c (get_exec_file): Update.\n\t* exec.c (exec_close): Update.\n\t(exec_file_attach): Update.\n\t* progspace.c (clone_program_space): Update.\n\t(print_program_space): Update.",
    "tree": {
      "sha": "87ba30d6af5da7628ff5d0b5aeac363a30f0eb30",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/87ba30d6af5da7628ff5d0b5aeac363a30f0eb30"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6be2a9ab1fba5f876c8cb2566280c5e4e6959d6e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6be2a9ab1fba5f876c8cb2566280c5e4e6959d6e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6be2a9ab1fba5f876c8cb2566280c5e4e6959d6e"
    }
  ],
  "stats": {
    "total": 54,
    "additions": 34,
    "deletions": 20
  },
  "files": [
    {
      "sha": "357c57f3497aa1029ba7a3c3a228161a2263c6ce",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -1,3 +1,17 @@\n+2020-10-29  Tom Tromey  <tom@tromey.com>\n+\n+\t* progspace.h (struct program_space) <exec_filename>: Rename from\n+\tpspace_exec_filename.  Now a unique_xmalloc_ptr.\n+\t* inferior.c (print_selected_inferior): Update.\n+\t(print_inferior): Update.\n+\t* mi/mi-main.c (print_one_inferior): Update.\n+\t* exec.h (exec_filename): Remove macro.\n+\t* corefile.c (get_exec_file): Update.\n+\t* exec.c (exec_close): Update.\n+\t(exec_file_attach): Update.\n+\t* progspace.c (clone_program_space): Update.\n+\t(print_program_space): Update.\n+\n 2020-10-29  Tom Tromey  <tom@tromey.com>\n \n \t* target-section.h (struct target_section): Add constructor."
    },
    {
      "sha": "c1eec199342adc3afe50981b5820e34572029b13",
      "filename": "gdb/corefile.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/corefile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/corefile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/corefile.c?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -144,8 +144,8 @@ validate_files (void)\n const char *\n get_exec_file (int err)\n {\n-  if (exec_filename)\n-    return exec_filename;\n+  if (current_program_space->exec_filename != nullptr)\n+    return current_program_space->exec_filename.get ();\n   if (!err)\n     return NULL;\n "
    },
    {
      "sha": "d27949c609f45663449be03741268cfa667411fa",
      "filename": "gdb/exec.c",
      "status": "modified",
      "additions": 6,
      "deletions": 5,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/exec.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/exec.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/exec.c?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -167,8 +167,7 @@ exec_close (void)\n \n       remove_target_sections (&exec_bfd);\n \n-      xfree (exec_filename);\n-      exec_filename = NULL;\n+      current_program_space->exec_filename.reset (nullptr);\n     }\n }\n \n@@ -486,11 +485,13 @@ exec_file_attach (const char *filename, int from_tty)\n \n       /* gdb_realpath_keepfile resolves symlinks on the local\n \t filesystem and so cannot be used for \"target:\" files.  */\n-      gdb_assert (exec_filename == NULL);\n+      gdb_assert (current_program_space->exec_filename == nullptr);\n       if (load_via_target)\n-\texec_filename = xstrdup (bfd_get_filename (exec_bfd));\n+\tcurrent_program_space->exec_filename\n+\t  = make_unique_xstrdup (bfd_get_filename (exec_bfd));\n       else\n-\texec_filename = gdb_realpath_keepfile (scratch_pathname).release ();\n+\tcurrent_program_space->exec_filename\n+\t  = gdb_realpath_keepfile (scratch_pathname);\n \n       if (!bfd_check_format_matches (exec_bfd, bfd_object, &matching))\n \t{"
    },
    {
      "sha": "b2f51509bcf7489f6c85288a7240316729d9d6d6",
      "filename": "gdb/exec.h",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/exec.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/exec.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/exec.h?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -32,7 +32,6 @@ struct objfile;\n \n #define exec_bfd current_program_space->ebfd\n #define exec_bfd_mtime current_program_space->ebfd_mtime\n-#define exec_filename current_program_space->pspace_exec_filename\n \n /* Builds a section table, given args BFD.  */\n "
    },
    {
      "sha": "fc21241a3744f55da3a625cffef74717d3640c42",
      "filename": "gdb/inferior.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/inferior.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/inferior.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inferior.c?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -415,7 +415,7 @@ void\n print_selected_inferior (struct ui_out *uiout)\n {\n   struct inferior *inf = current_inferior ();\n-  const char *filename = inf->pspace->pspace_exec_filename;\n+  const char *filename = inf->pspace->exec_filename.get ();\n \n   if (filename == NULL)\n     filename = _(\"<noexec>\");\n@@ -518,8 +518,8 @@ print_inferior (struct ui_out *uiout, const char *requested_inferiors)\n       std::string conn = uiout_field_connection (inf->process_target ());\n       uiout->field_string (\"connection-id\", conn.c_str ());\n \n-      if (inf->pspace->pspace_exec_filename != NULL)\n-\tuiout->field_string (\"exec\", inf->pspace->pspace_exec_filename);\n+      if (inf->pspace->exec_filename != nullptr)\n+\tuiout->field_string (\"exec\", inf->pspace->exec_filename.get ());\n       else\n \tuiout->field_skip (\"exec\");\n "
    },
    {
      "sha": "41bafd2f70d1a166b7c6acf325cafed664449b4d",
      "filename": "gdb/mi/mi-main.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/mi/mi-main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/mi/mi-main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mi/mi-main.c?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -649,10 +649,10 @@ print_one_inferior (struct inferior *inferior, bool recurse,\n       if (inferior->pid != 0)\n \tuiout->field_signed (\"pid\", inferior->pid);\n \n-      if (inferior->pspace->pspace_exec_filename != NULL)\n+      if (inferior->pspace->exec_filename != nullptr)\n \t{\n \t  uiout->field_string (\"executable\",\n-\t\t\t       inferior->pspace->pspace_exec_filename);\n+\t\t\t       inferior->pspace->exec_filename.get ());\n \t}\n \n       if (inferior->pid != 0)"
    },
    {
      "sha": "76001234255035a4f255f1118a0d9096e5434181",
      "filename": "gdb/progspace.c",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/progspace.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/progspace.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/progspace.c?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -233,8 +233,8 @@ clone_program_space (struct program_space *dest, struct program_space *src)\n \n   set_current_program_space (dest);\n \n-  if (src->pspace_exec_filename != NULL)\n-    exec_file_attach (src->pspace_exec_filename, 0);\n+  if (src->exec_filename != NULL)\n+    exec_file_attach (src->exec_filename.get (), 0);\n \n   if (src->symfile_object_file != NULL)\n     symbol_file_add_main (objfile_name (src->symfile_object_file),\n@@ -315,8 +315,8 @@ print_program_space (struct ui_out *uiout, int requested)\n \n       uiout->field_signed (\"id\", pspace->num);\n \n-      if (pspace->pspace_exec_filename)\n-\tuiout->field_string (\"exec\", pspace->pspace_exec_filename);\n+      if (pspace->exec_filename != nullptr)\n+\tuiout->field_string (\"exec\", pspace->exec_filename.get ());\n       else\n \tuiout->field_skip (\"exec\");\n "
    },
    {
      "sha": "3acce50b32fb6940b9002aafd8b5cc683acac0bf",
      "filename": "gdb/progspace.h",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/progspace.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c20cb6860c27d6ef15a1e561f4be78e7b85952ac/gdb/progspace.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/progspace.h?ref=c20cb6860c27d6ef15a1e561f4be78e7b85952ac",
      "patch": "@@ -284,9 +284,9 @@ struct program_space\n   /* The last-modified time, from when the exec was brought in.  */\n   long ebfd_mtime = 0;\n   /* Similar to bfd_get_filename (exec_bfd) but in original form given\n-     by user, without symbolic links and pathname resolved.\n-     It needs to be freed by xfree.  It is not NULL iff EBFD is not NULL.  */\n-  char *pspace_exec_filename = NULL;\n+     by user, without symbolic links and pathname resolved.  It is not\n+     NULL iff EBFD is not NULL.  */\n+  gdb::unique_xmalloc_ptr<char> exec_filename;\n \n   /* Binary file diddling handle for the core file.  */\n   gdb_bfd_ref_ptr cbfd;"
    }
  ]
}