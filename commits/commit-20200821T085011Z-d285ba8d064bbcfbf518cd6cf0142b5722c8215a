{
  "sha": "d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDI4NWJhOGQwNjRiYmNmYmY1MThjZDZjZjAxNDJiNTcyMmM4MjE1YQ==",
  "commit": {
    "author": {
      "name": "Cooper Qu",
      "email": "cooper.qu@linux.alibaba.com",
      "date": "2020-08-21T08:17:36Z"
    },
    "committer": {
      "name": "Lifang Xia",
      "email": "lifang_xia@c-sky.com",
      "date": "2020-08-21T08:50:11Z"
    },
    "message": "CSKY: Support two operands form for bloop.\n\ngas/\n        * config/tc-csky.c (csky_insn_info): Add member last_isize.\n        (md_assemble): Assign value to csky_insn.last_isize.\n        * testsuite/gas/csky/enhance_dsp.d: Test bloop's two operands form.\n        * testsuite/gas/csky/enhance_dsp.s: Likewise.\n\nopcodes/\n        * csky-opc.h (csky_v2_opcodes): Add two operands form for bloop.",
    "tree": {
      "sha": "04adfd59e18fc70f2cfcbdb58c53e19f772cbdea",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/04adfd59e18fc70f2cfcbdb58c53e19f772cbdea"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/comments",
  "author": {
    "login": "Cooper-Qu",
    "id": 68842787,
    "node_id": "MDQ6VXNlcjY4ODQyNzg3",
    "avatar_url": "https://avatars.githubusercontent.com/u/68842787?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Cooper-Qu",
    "html_url": "https://github.com/Cooper-Qu",
    "followers_url": "https://api.github.com/users/Cooper-Qu/followers",
    "following_url": "https://api.github.com/users/Cooper-Qu/following{/other_user}",
    "gists_url": "https://api.github.com/users/Cooper-Qu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Cooper-Qu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Cooper-Qu/subscriptions",
    "organizations_url": "https://api.github.com/users/Cooper-Qu/orgs",
    "repos_url": "https://api.github.com/users/Cooper-Qu/repos",
    "events_url": "https://api.github.com/users/Cooper-Qu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Cooper-Qu/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "Lifang-XIA",
    "id": 22215568,
    "node_id": "MDQ6VXNlcjIyMjE1NTY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/22215568?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Lifang-XIA",
    "html_url": "https://github.com/Lifang-XIA",
    "followers_url": "https://api.github.com/users/Lifang-XIA/followers",
    "following_url": "https://api.github.com/users/Lifang-XIA/following{/other_user}",
    "gists_url": "https://api.github.com/users/Lifang-XIA/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Lifang-XIA/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Lifang-XIA/subscriptions",
    "organizations_url": "https://api.github.com/users/Lifang-XIA/orgs",
    "repos_url": "https://api.github.com/users/Lifang-XIA/repos",
    "events_url": "https://api.github.com/users/Lifang-XIA/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Lifang-XIA/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "610ed3e08f13b3886fd7194fb7a248dee8724685",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/610ed3e08f13b3886fd7194fb7a248dee8724685",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/610ed3e08f13b3886fd7194fb7a248dee8724685"
    }
  ],
  "stats": {
    "total": 46,
    "additions": 41,
    "deletions": 5
  },
  "files": [
    {
      "sha": "94ad709568faa7331b55f8713967d7a616d76c24",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
      "patch": "@@ -1,3 +1,10 @@\n+2020-08-21  Cooper Qu  <cooper.qu@linux.alibaba.com>\n+\n+\t* config/tc-csky.c (csky_insn_info): Add member last_isize.\n+\t(md_assemble): Assign value to csky_insn.last_isize.\n+\t* testsuite/gas/csky/enhance_dsp.d: Test bloop's two operands form.\n+\t* testsuite/gas/csky/enhance_dsp.s: Likewise.\n+\n 2020-08-20  Martin Liska  <mliska@suse.cz>\n \n \t* NEWS: Mention --reduce-memory-overheads and --hash-size arguments"
    },
    {
      "sha": "49a52d442a056ab773ad44ef0e9d76a80aee35d1",
      "filename": "gas/config/tc-csky.c",
      "status": "modified",
      "additions": 21,
      "deletions": 1,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/config/tc-csky.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/config/tc-csky.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-csky.c?ref=d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
      "patch": "@@ -272,6 +272,7 @@ struct csky_insn_info\n   struct csky_macro_info *macro;\n   /* Insn size for check_literal.  */\n   unsigned int isize;\n+  unsigned int last_isize;\n   /* Max size of insn for relax frag_var.  */\n   unsigned int max;\n   /* Indicates which element is in csky_opcode_info op[] array.  */\n@@ -4145,6 +4146,7 @@ md_assemble (char *str)\n \tcheck_literals (csky_insn.opcode->transfer, csky_insn.max);\n     }\n \n+  csky_insn.last_isize = csky_insn.isize;\n   insn_reloc = BFD_RELOC_NONE;\n }\n \n@@ -6900,7 +6902,8 @@ dsp_work_bloop (void)\n   csky_insn.inst = csky_insn.opcode->op32[0].opcode | (reg << 16);\n   csky_insn.isize = 4;\n \n-  if (csky_insn.e1.X_op == O_symbol\n+  if (csky_insn.number == 3\n+      && csky_insn.e1.X_op == O_symbol\n       && csky_insn.e2.X_op == O_symbol)\n     {\n \tfix_new_exp (frag_now, csky_insn.output - frag_now->fr_literal,\n@@ -6910,6 +6913,23 @@ dsp_work_bloop (void)\n \t\t     4, &csky_insn.e2, 1,\n \t\t     BFD_RELOC_CKCORE_PCREL_BLOOP_IMM4BY4);\n     }\n+  else if (csky_insn.number == 2\n+\t   && csky_insn.e1.X_op == O_symbol)\n+    {\n+      fix_new_exp (frag_now, csky_insn.output-frag_now->fr_literal,\n+\t\t   4, &csky_insn.e1, 1,\n+\t\t   BFD_RELOC_CKCORE_PCREL_BLOOP_IMM12BY4);\n+      if (csky_insn.last_isize == 2)\n+\tcsky_insn.inst |= (0xf << 12);\n+      else if (csky_insn.last_isize != 0)\n+\tcsky_insn.inst |= (0xe << 12);\n+      else\n+\t{\n+\t  void *arg = (void *)\"bloop can not be the first instruction\"\\\n+\t\t      \"when the end label is not specified.\\n\";\n+\t  csky_show_error (ERROR_UNDEFINE, 0, arg, NULL);\n+\t}\n+    }\n \n   csky_write_insn (csky_insn.output, csky_insn.inst, csky_insn.isize);\n   return TRUE;"
    },
    {
      "sha": "eaf91259f8b86f838c4cd30f08ef646c79cdfa45",
      "filename": "gas/testsuite/gas/csky/enhance_dsp.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/testsuite/gas/csky/enhance_dsp.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/testsuite/gas/csky/enhance_dsp.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/csky/enhance_dsp.d?ref=d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
      "patch": "@@ -11,6 +11,7 @@ Disassembly of section \\.text:\n \\s*[0-9a-f]*:\\s*d0038802\\s*ldbi.w\\s*r2,\\s*\\(r3\\)\n #...\n \\s*[0-9a-f]*:\\s*e9c20ffa\\s*bloop\\s*r2,\\s*0x0,\\s*0xc.*\n+\\s*[0-9a-f]*:\\s*e9c2eff8\\s*bloop\\s*r2,\\s*0x0,\\s*0xc.*\n \\s*[0-9a-f]*:\\s*d0038c02\\s*pldbi.d\\s*r2,\\s*\\(r3\\)\n \\s*[0-9a-f]*:\\s*d0039002\\s*ldbi.hs\\s*r2,\\s*\\(r3\\)\n \\s*[0-9a-f]*:\\s*d0039402\\s*ldbi.bs\\s*r2,\\s*\\(r3\\)"
    },
    {
      "sha": "755235dab3a8cf22dcd543144d756ea0d895e91f",
      "filename": "gas/testsuite/gas/csky/enhance_dsp.s",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/testsuite/gas/csky/enhance_dsp.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/gas/testsuite/gas/csky/enhance_dsp.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/csky/enhance_dsp.s?ref=d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
      "patch": "@@ -7,6 +7,7 @@ hello:\n     ldbi.w r2, (r3)\n .loop_end:\n     bloop r2, .loop_start, .loop_end\n+    bloop r2, .loop_start\n     pldbi.d r2, (r3)\n     ldbi.hs r2, (r3)\n     ldbi.bs r2, (r3)"
    },
    {
      "sha": "6578fbf37f03ac53e74030620e03203c8d7281fa",
      "filename": "opcodes/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/opcodes/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/opcodes/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/ChangeLog?ref=d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
      "patch": "@@ -1,3 +1,7 @@\n+2020-08-21  Cooper Qu  <cooper.qu@linux.alibaba.com>\n+\n+\t* csky-opc.h (csky_v2_opcodes): Add two operands form for bloop.\n+\n 2020-08-19  Alan Modra  <amodra@gmail.com>\n \n \t* ppc-opc.c (powerpc_opcodes): Replace OBF with BF for vcmpsq,"
    },
    {
      "sha": "6dcf742e4828a0c218f9a2e90496447da2ecd783",
      "filename": "opcodes/csky-opc.h",
      "status": "modified",
      "additions": 7,
      "deletions": 4,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/opcodes/csky-opc.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d285ba8d064bbcfbf518cd6cf0142b5722c8215a/opcodes/csky-opc.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/csky-opc.h?ref=d285ba8d064bbcfbf518cd6cf0142b5722c8215a",
      "patch": "@@ -4675,13 +4675,16 @@ const struct csky_opcode csky_v2_opcodes[] =\n #define _RELAX      0\n \n     /* The followings are enhance DSP instructions.  */\n-    OP32_WITH_WORK (\"bloop\",\n-\t\t    OPCODE_INFO3 (0xe9c00000,\n+    DOP32_WITH_WORK (\"bloop\",\n+\t\t     OPCODE_INFO3 (0xe9c00000,\n \t\t\t\t  (16_20, AREG, OPRND_SHIFT_0_BIT),\n \t\t\t\t  (0_11, BLOOP_OFF12b, OPRND_SHIFT_1_BIT),\n \t\t\t\t  (12_15, BLOOP_OFF4b, OPRND_SHIFT_1_BIT)),\n-\t\t    CSKY_ISA_DSP_ENHANCE,\n-\t\t    dsp_work_bloop),\n+\t\t     OPCODE_INFO2 (0xe9c00000,\n+\t\t\t\t  (16_20, AREG, OPRND_SHIFT_0_BIT),\n+\t\t\t\t  (0_11, BLOOP_OFF12b, OPRND_SHIFT_1_BIT)),\n+\t\t     CSKY_ISA_DSP_ENHANCE,\n+\t\t     dsp_work_bloop),\n     /* The followings are ld/st instructions.  */\n     OP32 (\"ldbi.b\",\n \t  OPCODE_INFO2 (0xd0008000,"
    }
  ]
}