{
  "sha": "df07e2c772dab40d268dc44c78bb087c4b75b3c6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGYwN2UyYzc3MmRhYjQwZDI2OGRjNDRjNzhiYjA4N2M0Yjc1YjNjNg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-09-25T15:10:50Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-10-02T13:05:51Z"
    },
    "message": "gdb: Remove a use of VEC from dwarf2read.{c,h}\n\nRemoves a use of VEC from dwarf2read.{c,h} and replaces it with\nstd::vector.  As far as possible this is a like for like replacement\nwith minimal refactoring.\n\nThere should be no user visible changes after this commit.\n\ngdb/ChangeLog:\n\n\t* dwarf2read.c (struct type_unit_group) <tus>: Convert to\n\tstd::vector.\n\t(build_type_psymtabs_reader): Update for std::vector.\n\t(build_type_psymtab_dependencies): Likewise.\n\t* dwarf2read.h: Remove use of DEF_VEC_P.\n\t(typedef sig_type_ptr): Delete.",
    "tree": {
      "sha": "fde7a980951c491f5b4955c562a8690d3eeeaf29",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fde7a980951c491f5b4955c562a8690d3eeeaf29"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/df07e2c772dab40d268dc44c78bb087c4b75b3c6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/df07e2c772dab40d268dc44c78bb087c4b75b3c6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/df07e2c772dab40d268dc44c78bb087c4b75b3c6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/df07e2c772dab40d268dc44c78bb087c4b75b3c6/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "554ac434b02465f1fc925b0ae3393fb841e0d59c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/554ac434b02465f1fc925b0ae3393fb841e0d59c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/554ac434b02465f1fc925b0ae3393fb841e0d59c"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 18,
    "deletions": 11
  },
  "files": [
    {
      "sha": "81e372478864e69fce26f3165ce28f6cf2415da1",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/df07e2c772dab40d268dc44c78bb087c4b75b3c6/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/df07e2c772dab40d268dc44c78bb087c4b75b3c6/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=df07e2c772dab40d268dc44c78bb087c4b75b3c6",
      "patch": "@@ -1,3 +1,12 @@\n+2019-10-02  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* dwarf2read.c (struct type_unit_group) <tus>: Convert to\n+\tstd::vector.\n+\t(build_type_psymtabs_reader): Update for std::vector.\n+\t(build_type_psymtab_dependencies): Likewise.\n+\t* dwarf2read.h: Remove use of DEF_VEC_P.\n+\t(typedef sig_type_ptr): Delete.\n+\n 2019-10-02  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* btrace.c (btrace_maint_clear): Update to handle change from VEC"
    },
    {
      "sha": "30658b2d4f4f64007fcd05cf6d311d954a227157",
      "filename": "gdb/dwarf2read.c",
      "status": "modified",
      "additions": 9,
      "deletions": 8,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/df07e2c772dab40d268dc44c78bb087c4b75b3c6/gdb/dwarf2read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/df07e2c772dab40d268dc44c78bb087c4b75b3c6/gdb/dwarf2read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.c?ref=df07e2c772dab40d268dc44c78bb087c4b75b3c6",
      "patch": "@@ -620,7 +620,7 @@ struct type_unit_group\n   /* The TUs that share this DW_AT_stmt_list entry.\n      This is added to while parsing type units to build partial symtabs,\n      and is deleted afterwards and not used again.  */\n-  VEC (sig_type_ptr) *tus;\n+  std::vector <signatured_type *> *tus;\n \n   /* The compunit symtab.\n      Type units in a group needn't all be defined in the same source file,\n@@ -8184,7 +8184,9 @@ build_type_psymtabs_reader (const struct die_reader_specs *reader,\n   attr = dwarf2_attr_no_follow (type_unit_die, DW_AT_stmt_list);\n   tu_group = get_type_unit_group (cu, attr);\n \n-  VEC_safe_push (sig_type_ptr, tu_group->tus, sig_type);\n+  if (tu_group->tus == nullptr)\n+    tu_group->tus = new std::vector <signatured_type *>;\n+  tu_group->tus->push_back (sig_type);\n \n   prepare_one_comp_unit (cu, type_unit_die, language_minimal);\n   pst = create_partial_symtab (per_cu, \"\");\n@@ -8341,25 +8343,24 @@ build_type_psymtab_dependencies (void **slot, void *info)\n   struct type_unit_group *tu_group = (struct type_unit_group *) *slot;\n   struct dwarf2_per_cu_data *per_cu = &tu_group->per_cu;\n   struct partial_symtab *pst = per_cu->v.psymtab;\n-  int len = VEC_length (sig_type_ptr, tu_group->tus);\n-  struct signatured_type *iter;\n+  int len = (tu_group->tus == nullptr) ? 0 : tu_group->tus->size ();\n   int i;\n \n   gdb_assert (len > 0);\n   gdb_assert (IS_TYPE_UNIT_GROUP (per_cu));\n \n   pst->number_of_dependencies = len;\n   pst->dependencies = objfile->partial_symtabs->allocate_dependencies (len);\n-  for (i = 0;\n-       VEC_iterate (sig_type_ptr, tu_group->tus, i, iter);\n-       ++i)\n+  for (i = 0; i < len; ++i)\n     {\n+      struct signatured_type *iter = tu_group->tus->at (i);\n       gdb_assert (iter->per_cu.is_debug_types);\n       pst->dependencies[i] = iter->per_cu.v.psymtab;\n       iter->type_unit_group = tu_group;\n     }\n \n-  VEC_free (sig_type_ptr, tu_group->tus);\n+  delete tu_group->tus;\n+  tu_group->tus = nullptr;\n \n   return 1;\n }"
    },
    {
      "sha": "aee8742a79ce7f4d43a439e9e074efe5070c688e",
      "filename": "gdb/dwarf2read.h",
      "status": "modified",
      "additions": 0,
      "deletions": 3,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/df07e2c772dab40d268dc44c78bb087c4b75b3c6/gdb/dwarf2read.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/df07e2c772dab40d268dc44c78bb087c4b75b3c6/gdb/dwarf2read.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.h?ref=df07e2c772dab40d268dc44c78bb087c4b75b3c6",
      "patch": "@@ -401,9 +401,6 @@ struct signatured_type\n   struct dwo_unit *dwo_unit;\n };\n \n-typedef struct signatured_type *sig_type_ptr;\n-DEF_VEC_P (sig_type_ptr);\n-\n ULONGEST read_unsigned_leb128 (bfd *, const gdb_byte *, unsigned int *);\n \n /* This represents a '.dwz' file.  */"
    }
  ]
}