{
  "sha": "84d53fa9d281f057af5916f8663bc9a2872c5f6e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ODRkNTNmYTlkMjgxZjA1N2FmNTkxNmY4NjYzYmM5YTI4NzJjNWY2ZQ==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-05-21T17:12:29Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-05-21T17:12:29Z"
    },
    "message": "gdb: remove unnecessary NULL checks before xfree\n\nI was inspired by a series of patches merged by Alan Modra in the other\nprojects, so I did the same in GDB with a bit of Coccinelle and grep.\n\nThis patch removes the unnecessary NULL checks before calls to xfree.\nThey are unnecessary because xfree already does a NULL check.  Since\nfree is supposed to handle NULL values correctly, the NULL check in\nxfree itself is also questionable, but I've left it there for now.\n\ngdb/ChangeLog:\n\n\t* coffread.c (patch_type): Remove NULL check before xfree.\n\t* corefile.c (set_gnutarget): Likewise.\n\t* cp-abi.c (set_cp_abi_as_auto_default): Likewise.\n\t* exec.c (build_section_table): Likewise.\n\t* remote.c (remote_target::pass_signals): Likewise.\n\t* utils.c (n_spaces): Likewise.\n\t* cli/cli-script.c (document_command): Likewise.\n\t* i386-windows-tdep.c (core_process_module_section): Likewise.\n\t* linux-fork.c (struct fork_info) <~fork_info>: Likewise.",
    "tree": {
      "sha": "f6b7498d254e80fcd821b61642ff3f834be7953c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f6b7498d254e80fcd821b61642ff3f834be7953c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/84d53fa9d281f057af5916f8663bc9a2872c5f6e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/84d53fa9d281f057af5916f8663bc9a2872c5f6e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/84d53fa9d281f057af5916f8663bc9a2872c5f6e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/84d53fa9d281f057af5916f8663bc9a2872c5f6e/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0490dd41ae89e66efd8b3cee122c189a481269de",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0490dd41ae89e66efd8b3cee122c189a481269de",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0490dd41ae89e66efd8b3cee122c189a481269de"
    }
  ],
  "stats": {
    "total": 46,
    "additions": 24,
    "deletions": 22
  },
  "files": [
    {
      "sha": "4574440578870d36b6f84638e74dc1090f85b8b9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -1,3 +1,15 @@\n+2020-05-21  Simon Marchi  <simon.marchi@efficios.com>\n+\n+\t* coffread.c (patch_type): Remove NULL check before xfree.\n+\t* corefile.c (set_gnutarget): Likewise.\n+\t* cp-abi.c (set_cp_abi_as_auto_default): Likewise.\n+\t* exec.c (build_section_table): Likewise.\n+\t* remote.c (remote_target::pass_signals): Likewise.\n+\t* utils.c (n_spaces): Likewise.\n+\t* cli/cli-script.c (document_command): Likewise.\n+\t* i386-windows-tdep.c (core_process_module_section): Likewise.\n+\t* linux-fork.c (struct fork_info) <~fork_info>: Likewise.\n+\n 2020-05-20  Simon Marchi  <simon.marchi@efficios.com>\n \n \t* symfile.c (reread_symbols): Clear objfile's section_offsets"
    },
    {
      "sha": "90ee67a5f3d379b3197166249601e7e97b7f066b",
      "filename": "gdb/cli/cli-script.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/cli/cli-script.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/cli/cli-script.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-script.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -1528,8 +1528,7 @@ document_command (const char *comname, int from_tty)\n   counted_command_line doclines = read_command_lines (prompt.c_str (),\n \t\t\t\t\t\t      from_tty, 0, 0);\n \n-  if (c->doc)\n-    xfree ((char *) c->doc);\n+  xfree ((char *) c->doc);\n \n   {\n     struct command_line *cl1;"
    },
    {
      "sha": "0f7a6e3e5ad0565e50d357379b04d96f54757e45",
      "filename": "gdb/coffread.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/coffread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/coffread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/coffread.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -1467,8 +1467,7 @@ patch_type (struct type *type, struct type *real_type)\n     {\n       /* The previous copy of TYPE_NAME is allocated by\n \t process_coff_symbol.  */\n-      if (target->name ())\n-\txfree ((char*) target->name ());\n+      xfree ((char *) target->name ());\n       target->set_name (xstrdup (real_target->name ()));\n     }\n }"
    },
    {
      "sha": "996e5301b27a336abbe60adfb2b16cd65fb874e6",
      "filename": "gdb/corefile.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/corefile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/corefile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/corefile.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -472,8 +472,7 @@ complete_set_gnutarget (struct cmd_list_element *cmd,\n void\n set_gnutarget (const char *newtarget)\n {\n-  if (gnutarget_string != NULL)\n-    xfree (gnutarget_string);\n+  xfree (gnutarget_string);\n   gnutarget_string = xstrdup (newtarget);\n   set_gnutarget_command (NULL, 0, NULL);\n }"
    },
    {
      "sha": "3e2edad45ca3aedf3cc46bc6b140d4c6c0821e28",
      "filename": "gdb/cp-abi.c",
      "status": "modified",
      "additions": 2,
      "deletions": 4,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/cp-abi.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/cp-abi.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cp-abi.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -273,10 +273,8 @@ set_cp_abi_as_auto_default (const char *short_name)\n \t\t    _(\"Cannot find C++ ABI \\\"%s\\\" to set it as auto default.\"),\n \t\t    short_name);\n \n-  if (auto_cp_abi.longname != NULL)\n-    xfree ((char *) auto_cp_abi.longname);\n-  if (auto_cp_abi.doc != NULL)\n-    xfree ((char *) auto_cp_abi.doc);\n+  xfree ((char *) auto_cp_abi.longname);\n+  xfree ((char *) auto_cp_abi.doc);\n \n   auto_cp_abi = *abi;\n "
    },
    {
      "sha": "14c77495a38f14629d9f67a2a41901d6c74a47ce",
      "filename": "gdb/exec.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/exec.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/exec.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/exec.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -648,8 +648,7 @@ build_section_table (struct bfd *some_bfd, struct target_section **start,\n   unsigned count;\n \n   count = bfd_count_sections (some_bfd);\n-  if (*start)\n-    xfree (* start);\n+  xfree (*start);\n   *start = XNEWVEC (struct target_section, count);\n   *end = *start;\n   bfd_map_over_sections (some_bfd, add_to_section_table, (char *) end);"
    },
    {
      "sha": "f5965399abceaae271bb5010cfcfa109321c69d6",
      "filename": "gdb/i386-windows-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/i386-windows-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/i386-windows-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/i386-windows-tdep.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -142,8 +142,7 @@ core_process_module_section (bfd *abfd, asection *sect, void *obj)\n   data->module_count++;\n \n out:\n-  if (buf)\n-    xfree (buf);\n+  xfree (buf);\n   return;\n }\n "
    },
    {
      "sha": "e232d9c263a2df58d7f0352e0a53ff65b312a265",
      "filename": "gdb/linux-fork.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/linux-fork.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/linux-fork.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/linux-fork.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -61,8 +61,8 @@ struct fork_info\n \n     if (savedregs)\n       delete savedregs;\n-    if (filepos)\n-      xfree (filepos);\n+\n+    xfree (filepos);\n   }\n \n   ptid_t ptid = null_ptid;"
    },
    {
      "sha": "c73eb6e9e136f4d611aeb631b3641ceda5b238b1",
      "filename": "gdb/remote.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/remote.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/remote.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -2615,8 +2615,7 @@ remote_target::pass_signals (gdb::array_view<const unsigned char> pass_signals)\n \t  putpkt (pass_packet);\n \t  getpkt (&rs->buf, 0);\n \t  packet_ok (rs->buf, &remote_protocol_packets[PACKET_QPassSignals]);\n-\t  if (rs->last_pass_packet)\n-\t    xfree (rs->last_pass_packet);\n+\t  xfree (rs->last_pass_packet);\n \t  rs->last_pass_packet = pass_packet;\n \t}\n       else"
    },
    {
      "sha": "b29f864b3735989392dae7684754e7958413a08d",
      "filename": "gdb/symfile.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/symfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/symfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -3404,8 +3404,7 @@ enum ovly_index\n static void\n simple_free_overlay_table (void)\n {\n-  if (cache_ovly_table)\n-    xfree (cache_ovly_table);\n+  xfree (cache_ovly_table);\n   cache_novlys = 0;\n   cache_ovly_table = NULL;\n   cache_ovly_table_base = 0;"
    },
    {
      "sha": "d2290c30a78b895fb63be8bc3236772b7d00cf72",
      "filename": "gdb/utils.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/utils.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84d53fa9d281f057af5916f8663bc9a2872c5f6e/gdb/utils.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/utils.c?ref=84d53fa9d281f057af5916f8663bc9a2872c5f6e",
      "patch": "@@ -2260,8 +2260,7 @@ n_spaces (int n)\n \n   if (n > max_spaces)\n     {\n-      if (spaces)\n-\txfree (spaces);\n+      xfree (spaces);\n       spaces = (char *) xmalloc (n + 1);\n       for (t = spaces + n; t != spaces;)\n \t*--t = ' ';"
    }
  ]
}