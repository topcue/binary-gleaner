{
  "sha": "5798d69f030a0ff1fe270021963996279a1c7791",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTc5OGQ2OWYwMzBhMGZmMWZlMjcwMDIxOTYzOTk2Mjc5YTFjNzc5MQ==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-08-21T15:55:08Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-08-21T15:55:08Z"
    },
    "message": "sim/bfin: include config/pkg.m4 in configure.ac\n\nWhen trying to re-generate configure in sim/bfin, I get:\n\n    $ autoreconf -vf\n    autoreconf: Entering directory `.'\n    autoreconf: configure.ac: not using Gettext\n    autoreconf: running: aclocal --force\n    autoreconf: configure.ac: tracing\n    autoreconf: configure.ac: not running libtoolize: --install not given\n    autoreconf: running: /opt/autostuff/bin/autoconf --force\n    configure.ac:57: error: possibly undefined macro: AC_CHECK_LIB\n          If this token and others are legitimate, please use m4_pattern_allow.\n          See the Autoconf documentation.\n    autoreconf: /opt/autostuff/bin/autoconf failed with exit status: 1\n\nThis happens since commit f693213d126a (\"Run `autoreconf -vf` throughout\").\n\nThe problem (not clear from the error message) is that the\nPKG_CHECK_MODULES macro used in configure.ac is undefined.  In the past, I\nsuppose that it relied on the person running autoconf having pkg.m4 (from\npkg-config) in their include path.  That's not my case.\n\nSince we recently added a local version of PKG_CHECK_MODULES to our tree,\nwe can just make sim/bfin/configure.ac use it.  This patch makes\nconfigure.ac include config/pkg.m4, and re-generates configure.  With this,\nthe configure script appears to be generated correctly, I am able to\nconfigure and build the bfin simulator.\n\nNote: using sinclude to include the required m4 files makes no sense to\nme.  These files contain macros we need, if they are not defined then\nthe resulting file is unusable.  And sinclude fails silently if the file\nis not found.  So, better use include/m4_include.\n\nsim/bfin/ChangeLog:\n\n\t* configure.ac: Include config/pkg.m4.\n\nChange-Id: I7d8012e5ed510cd7746b94e918f0feb1c701cd83",
    "tree": {
      "sha": "a327ceb464b98bb603e7a618459b466014d45436",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a327ceb464b98bb603e7a618459b466014d45436"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5798d69f030a0ff1fe270021963996279a1c7791",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5798d69f030a0ff1fe270021963996279a1c7791",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5798d69f030a0ff1fe270021963996279a1c7791",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5798d69f030a0ff1fe270021963996279a1c7791/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ccf61261eb8cce869ae4452de547a5f3afb074e4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ccf61261eb8cce869ae4452de547a5f3afb074e4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ccf61261eb8cce869ae4452de547a5f3afb074e4"
    }
  ],
  "stats": {
    "total": 310,
    "additions": 302,
    "deletions": 8
  },
  "files": [
    {
      "sha": "18f2873231263cd9319e88a0d16793dea685f031",
      "filename": "sim/bfin/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5798d69f030a0ff1fe270021963996279a1c7791/sim/bfin/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5798d69f030a0ff1fe270021963996279a1c7791/sim/bfin/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/ChangeLog?ref=5798d69f030a0ff1fe270021963996279a1c7791",
      "patch": "@@ -1,3 +1,7 @@\n+2020-08-21  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* configure.ac: Include config/pkg.m4.\n+\n 2020-07-29  Simon Marchi  <simon.marchi@efficios.com>\n \n \t* aclocal.m4, configure: Re-generate."
    },
    {
      "sha": "9f0b46e11110df600159bd7b2531c2d4a33cac90",
      "filename": "sim/bfin/configure",
      "status": "modified",
      "additions": 297,
      "deletions": 8,
      "changes": 305,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5798d69f030a0ff1fe270021963996279a1c7791/sim/bfin/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5798d69f030a0ff1fe270021963996279a1c7791/sim/bfin/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/configure?ref=5798d69f030a0ff1fe270021963996279a1c7791",
      "patch": "@@ -634,6 +634,9 @@ LIBOBJS\n cgen_breaks\n SDL_LIBS\n SDL_CFLAGS\n+PKG_CONFIG_LIBDIR\n+PKG_CONFIG_PATH\n+PKG_CONFIG\n REPORT_BUGS_TEXI\n REPORT_BUGS_TO\n PKGVERSION\n@@ -797,7 +800,12 @@ CFLAGS\n LDFLAGS\n LIBS\n CPPFLAGS\n-CPP'\n+CPP\n+PKG_CONFIG\n+PKG_CONFIG_PATH\n+PKG_CONFIG_LIBDIR\n+SDL_CFLAGS\n+SDL_LIBS'\n \n \n # Initialize some variables set by options.\n@@ -1471,6 +1479,13 @@ Some influential environment variables:\n   CPPFLAGS    (Objective) C/C++ preprocessor flags, e.g. -I<include dir> if\n               you have headers in a nonstandard directory <include dir>\n   CPP         C preprocessor\n+  PKG_CONFIG  path to pkg-config utility\n+  PKG_CONFIG_PATH\n+              directories to add to pkg-config's search path\n+  PKG_CONFIG_LIBDIR\n+              path overriding pkg-config's built-in search path\n+  SDL_CFLAGS  C compiler flags for SDL, overriding pkg-config\n+  SDL_LIBS    linker flags for SDL, overriding pkg-config\n \n Use these variables to override the choices made by `configure' or to help\n it to find libraries and programs with nonstandard names/locations.\n@@ -4171,6 +4186,26 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu\n \n \n \n+\n+\n+\n+\n+# pkg.m4 - Macros to locate and utilise pkg-config.   -*- Autoconf -*-\n+# serial 12 (pkg-config-0.29.2)\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n \n \n \n@@ -12887,7 +12922,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12890 \"configure\"\n+#line 12925 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -12993,7 +13028,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12996 \"configure\"\n+#line 13031 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -13926,13 +13961,267 @@ fi\n done\n \n \n-PKG_PROG_PKG_CONFIG\n-PKG_CHECK_MODULES(SDL, sdl,\n-\tAC_CHECK_LIB(dl, dlopen, [\n+\n+\n+\n+\n+\n+\n+\n+if test \"x$ac_cv_env_PKG_CONFIG_set\" != \"xset\"; then\n+\tif test -n \"$ac_tool_prefix\"; then\n+  # Extract the first word of \"${ac_tool_prefix}pkg-config\", so it can be a program name with args.\n+set dummy ${ac_tool_prefix}pkg-config; ac_word=$2\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $ac_word\" >&5\n+$as_echo_n \"checking for $ac_word... \" >&6; }\n+if ${ac_cv_path_PKG_CONFIG+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  case $PKG_CONFIG in\n+  [\\\\/]* | ?:[\\\\/]*)\n+  ac_cv_path_PKG_CONFIG=\"$PKG_CONFIG\" # Let the user override the test with a path.\n+  ;;\n+  *)\n+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+    for ac_exec_ext in '' $ac_executable_extensions; do\n+  if as_fn_executable_p \"$as_dir/$ac_word$ac_exec_ext\"; then\n+    ac_cv_path_PKG_CONFIG=\"$as_dir/$ac_word$ac_exec_ext\"\n+    $as_echo \"$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext\" >&5\n+    break 2\n+  fi\n+done\n+  done\n+IFS=$as_save_IFS\n+\n+  ;;\n+esac\n+fi\n+PKG_CONFIG=$ac_cv_path_PKG_CONFIG\n+if test -n \"$PKG_CONFIG\"; then\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $PKG_CONFIG\" >&5\n+$as_echo \"$PKG_CONFIG\" >&6; }\n+else\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+fi\n+\n+\n+fi\n+if test -z \"$ac_cv_path_PKG_CONFIG\"; then\n+  ac_pt_PKG_CONFIG=$PKG_CONFIG\n+  # Extract the first word of \"pkg-config\", so it can be a program name with args.\n+set dummy pkg-config; ac_word=$2\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $ac_word\" >&5\n+$as_echo_n \"checking for $ac_word... \" >&6; }\n+if ${ac_cv_path_ac_pt_PKG_CONFIG+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  case $ac_pt_PKG_CONFIG in\n+  [\\\\/]* | ?:[\\\\/]*)\n+  ac_cv_path_ac_pt_PKG_CONFIG=\"$ac_pt_PKG_CONFIG\" # Let the user override the test with a path.\n+  ;;\n+  *)\n+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+    for ac_exec_ext in '' $ac_executable_extensions; do\n+  if as_fn_executable_p \"$as_dir/$ac_word$ac_exec_ext\"; then\n+    ac_cv_path_ac_pt_PKG_CONFIG=\"$as_dir/$ac_word$ac_exec_ext\"\n+    $as_echo \"$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext\" >&5\n+    break 2\n+  fi\n+done\n+  done\n+IFS=$as_save_IFS\n+\n+  ;;\n+esac\n+fi\n+ac_pt_PKG_CONFIG=$ac_cv_path_ac_pt_PKG_CONFIG\n+if test -n \"$ac_pt_PKG_CONFIG\"; then\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_pt_PKG_CONFIG\" >&5\n+$as_echo \"$ac_pt_PKG_CONFIG\" >&6; }\n+else\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+fi\n+\n+  if test \"x$ac_pt_PKG_CONFIG\" = x; then\n+    PKG_CONFIG=\"\"\n+  else\n+    case $cross_compiling:$ac_tool_warned in\n+yes:)\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet\" >&5\n+$as_echo \"$as_me: WARNING: using cross tools not prefixed with host triplet\" >&2;}\n+ac_tool_warned=yes ;;\n+esac\n+    PKG_CONFIG=$ac_pt_PKG_CONFIG\n+  fi\n+else\n+  PKG_CONFIG=\"$ac_cv_path_PKG_CONFIG\"\n+fi\n+\n+fi\n+if test -n \"$PKG_CONFIG\"; then\n+\t_pkg_min_version=0.9.0\n+\t{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking pkg-config is at least version $_pkg_min_version\" >&5\n+$as_echo_n \"checking pkg-config is at least version $_pkg_min_version... \" >&6; }\n+\tif $PKG_CONFIG --atleast-pkgconfig-version $_pkg_min_version; then\n+\t\t{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\n+$as_echo \"yes\" >&6; }\n+\telse\n+\t\t{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+\t\tPKG_CONFIG=\"\"\n+\tfi\n+fi\n+\n+pkg_failed=no\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for sdl\" >&5\n+$as_echo_n \"checking for sdl... \" >&6; }\n+\n+if test -n \"$SDL_CFLAGS\"; then\n+    pkg_cv_SDL_CFLAGS=\"$SDL_CFLAGS\"\n+ elif test -n \"$PKG_CONFIG\"; then\n+    if test -n \"$PKG_CONFIG\" && \\\n+    { { $as_echo \"$as_me:${as_lineno-$LINENO}: \\$PKG_CONFIG --exists --print-errors \\\"sdl\\\"\"; } >&5\n+  ($PKG_CONFIG --exists --print-errors \"sdl\") 2>&5\n+  ac_status=$?\n+  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n+  test $ac_status = 0; }; then\n+  pkg_cv_SDL_CFLAGS=`$PKG_CONFIG --cflags \"sdl\" 2>/dev/null`\n+\t\t      test \"x$?\" != \"x0\" && pkg_failed=yes\n+else\n+  pkg_failed=yes\n+fi\n+ else\n+    pkg_failed=untried\n+fi\n+if test -n \"$SDL_LIBS\"; then\n+    pkg_cv_SDL_LIBS=\"$SDL_LIBS\"\n+ elif test -n \"$PKG_CONFIG\"; then\n+    if test -n \"$PKG_CONFIG\" && \\\n+    { { $as_echo \"$as_me:${as_lineno-$LINENO}: \\$PKG_CONFIG --exists --print-errors \\\"sdl\\\"\"; } >&5\n+  ($PKG_CONFIG --exists --print-errors \"sdl\") 2>&5\n+  ac_status=$?\n+  $as_echo \"$as_me:${as_lineno-$LINENO}: \\$? = $ac_status\" >&5\n+  test $ac_status = 0; }; then\n+  pkg_cv_SDL_LIBS=`$PKG_CONFIG --libs \"sdl\" 2>/dev/null`\n+\t\t      test \"x$?\" != \"x0\" && pkg_failed=yes\n+else\n+  pkg_failed=yes\n+fi\n+ else\n+    pkg_failed=untried\n+fi\n+\n+if test $pkg_failed = no; then\n+  pkg_save_LDFLAGS=\"$LDFLAGS\"\n+  LDFLAGS=\"$LDFLAGS $pkg_cv_SDL_LIBS\"\n+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+\n+else\n+  pkg_failed=yes\n+fi\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n+  LDFLAGS=$pkg_save_LDFLAGS\n+fi\n+\n+\n+\n+if test $pkg_failed = yes; then\n+        { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+\n+if $PKG_CONFIG --atleast-pkgconfig-version 0.20; then\n+        _pkg_short_errors_supported=yes\n+else\n+        _pkg_short_errors_supported=no\n+fi\n+        if test $_pkg_short_errors_supported = yes; then\n+\t        SDL_PKG_ERRORS=`$PKG_CONFIG --short-errors --print-errors --cflags --libs \"sdl\" 2>&1`\n+        else\n+\t        SDL_PKG_ERRORS=`$PKG_CONFIG --print-errors --cflags --libs \"sdl\" 2>&1`\n+        fi\n+\t# Put the nasty error message in config.log where it belongs\n+\techo \"$SDL_PKG_ERRORS\" >&5\n+\n+\t:\n+elif test $pkg_failed = untried; then\n+        { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+\t:\n+else\n+\tSDL_CFLAGS=$pkg_cv_SDL_CFLAGS\n+\tSDL_LIBS=$pkg_cv_SDL_LIBS\n+        { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\n+$as_echo \"yes\" >&6; }\n+\n+\t{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for dlopen in -ldl\" >&5\n+$as_echo_n \"checking for dlopen in -ldl... \" >&6; }\n+if ${ac_cv_lib_dl_dlopen+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  ac_check_lib_save_LIBS=$LIBS\n+LIBS=\"-ldl  $LIBS\"\n+cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+/* Override any GCC internal prototype to avoid an error.\n+   Use char because int might match the return type of a GCC\n+   builtin and then its argument prototype would still apply.  */\n+#ifdef __cplusplus\n+extern \"C\"\n+#endif\n+char dlopen ();\n+int\n+main ()\n+{\n+return dlopen ();\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_c_try_link \"$LINENO\"; then :\n+  ac_cv_lib_dl_dlopen=yes\n+else\n+  ac_cv_lib_dl_dlopen=no\n+fi\n+rm -f core conftest.err conftest.$ac_objext \\\n+    conftest$ac_exeext conftest.$ac_ext\n+LIBS=$ac_check_lib_save_LIBS\n+fi\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_lib_dl_dlopen\" >&5\n+$as_echo \"$ac_cv_lib_dl_dlopen\" >&6; }\n+if test \"x$ac_cv_lib_dl_dlopen\" = xyes; then :\n+\n \t\tSDL_CFLAGS=\"${SDL_CFLAGS} -DHAVE_SDL\"\n \t\tSDL_LIBS=\"-ldl\"\n-\t\t], [SDL_CFLAGS= SDL_LIBS=])\n-\t, :)\n+\n+else\n+  SDL_CFLAGS= SDL_LIBS=\n+fi\n+\n+\n+fi\n \n \n "
    },
    {
      "sha": "47bacb1c0d2e8cb2d623bb7271bace8410e7da36",
      "filename": "sim/bfin/configure.ac",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5798d69f030a0ff1fe270021963996279a1c7791/sim/bfin/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5798d69f030a0ff1fe270021963996279a1c7791/sim/bfin/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/configure.ac?ref=5798d69f030a0ff1fe270021963996279a1c7791",
      "patch": "@@ -1,6 +1,7 @@\n dnl Process this file with autoconf to produce a configure script.\n AC_INIT(Makefile.in)\n sinclude(../common/acinclude.m4)\n+m4_include([../../config/pkg.m4])\n \n SIM_AC_COMMON\n "
    }
  ]
}