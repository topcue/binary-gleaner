{
  "sha": "a7067863418451b27130bb4300ac1890ff806c12",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTcwNjc4NjM0MTg0NTFiMjcxMzBiYjQzMDBhYzE4OTBmZjgwNmMxMg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-05-23T18:49:41Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-06-10T22:05:58Z"
    },
    "message": "gdb: Check for not allocated/associated values during array slicing\n\nWhen extracting an array slice we should give up if the array is\nnot-allocated or not-associated.  For Fortran, at least in gfortran\ncompiled code, the upper and lower bounds are undefined if the array\nis not allocated or not associated, in which case performing checks\nagainst these bounds will result in undefined behaviour.\n\nBetter then to throw an error if we try to slice such an array.  This\nchanges the error message that the user will receive in these\ncases (if they got an error message before).  Previously they may have\ngotten \"slice out of range\" now they'll get \"array not allocated\" or\n\"array not associated\".\n\ngdb/ChangeLog:\n\n\t* valops.c (value_slice): Check for not allocated or not\n\tassociated values.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.fortran/vla-sizeof.exp: Update expected results.",
    "tree": {
      "sha": "6df484c1278ac2e041d584b6a411d629b3e9abab",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6df484c1278ac2e041d584b6a411d629b3e9abab"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a7067863418451b27130bb4300ac1890ff806c12",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7067863418451b27130bb4300ac1890ff806c12",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a7067863418451b27130bb4300ac1890ff806c12",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7067863418451b27130bb4300ac1890ff806c12/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9ab084121f50a6858b7298de6c5326cee3687c43",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9ab084121f50a6858b7298de6c5326cee3687c43",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9ab084121f50a6858b7298de6c5326cee3687c43"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 16,
    "deletions": 2
  },
  "files": [
    {
      "sha": "022ce04d000c3be73a0aae72b27d7f9da5c8e2e6",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7067863418451b27130bb4300ac1890ff806c12/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7067863418451b27130bb4300ac1890ff806c12/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=a7067863418451b27130bb4300ac1890ff806c12",
      "patch": "@@ -1,3 +1,8 @@\n+2019-06-10  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* valops.c (value_slice): Check for not allocated or not\n+\tassociated values.\n+\n 2019-06-10  Tom de Vries  <tdevries@suse.de>\n \n \tPR gdb/24618"
    },
    {
      "sha": "33ae2f4925f677758ffbb848bfdf85606d2126ce",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7067863418451b27130bb4300ac1890ff806c12/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7067863418451b27130bb4300ac1890ff806c12/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=a7067863418451b27130bb4300ac1890ff806c12",
      "patch": "@@ -1,3 +1,7 @@\n+2019-06-10  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.fortran/vla-sizeof.exp: Update expected results.\n+\n 2019-06-06  Amos Bird  <amosbird@gmail.com>\n \n \t* gdb.base/annota1.exp (thread_switch): Add test for"
    },
    {
      "sha": "4fe6938445cb34669602393ea6e861ff6b40b5e9",
      "filename": "gdb/testsuite/gdb.fortran/vla-sizeof.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7067863418451b27130bb4300ac1890ff806c12/gdb/testsuite/gdb.fortran/vla-sizeof.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7067863418451b27130bb4300ac1890ff806c12/gdb/testsuite/gdb.fortran/vla-sizeof.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.fortran/vla-sizeof.exp?ref=a7067863418451b27130bb4300ac1890ff806c12",
      "patch": "@@ -32,7 +32,7 @@ gdb_test \"print sizeof(vla1)\" \" = 0\" \"print sizeof non-allocated vla1\"\n gdb_test \"print sizeof(vla1(3,2,1))\" \\\n     \"no such vector element \\\\(vector not allocated\\\\)\" \\\n     \"print sizeof non-allocated indexed vla1\"\n-gdb_test \"print sizeof(vla1(3:4,2,1))\" \"slice out of range\" \\\n+gdb_test \"print sizeof(vla1(3:4,2,1))\" \"array not allocated\" \\\n     \"print sizeof non-allocated sliced vla1\"\n \n # Try to access value in allocated VLA\n@@ -49,7 +49,7 @@ gdb_test \"print sizeof(pvla)\" \" = 0\" \"print sizeof non-associated pvla\"\n gdb_test \"print sizeof(pvla(3,2,1))\" \\\n     \"no such vector element \\\\(vector not associated\\\\)\" \\\n     \"print sizeof non-associated indexed pvla\"\n-gdb_test \"print sizeof(pvla(3:4,2,1))\" \"slice out of range\" \\\n+gdb_test \"print sizeof(pvla(3:4,2,1))\" \"array not associated\" \\\n     \"print sizeof non-associated sliced pvla\"\n \n # Try to access values in pointer to VLA and compare them"
    },
    {
      "sha": "cbf2eccde3e46d65ee70ecb06e6fb4ae9f2bc8d8",
      "filename": "gdb/valops.c",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7067863418451b27130bb4300ac1890ff806c12/gdb/valops.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7067863418451b27130bb4300ac1890ff806c12/gdb/valops.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/valops.c?ref=a7067863418451b27130bb4300ac1890ff806c12",
      "patch": "@@ -3801,6 +3801,11 @@ value_slice (struct value *array, int lowbound, int length)\n       && TYPE_CODE (array_type) != TYPE_CODE_STRING)\n     error (_(\"cannot take slice of non-array\"));\n \n+  if (type_not_allocated (array_type))\n+    error (_(\"array not allocated\"));\n+  if (type_not_associated (array_type))\n+    error (_(\"array not associated\"));\n+\n   range_type = TYPE_INDEX_TYPE (array_type);\n   if (get_discrete_bounds (range_type, &lowerbound, &upperbound) < 0)\n     error (_(\"slice from bad array or bitstring\"));"
    }
  ]
}