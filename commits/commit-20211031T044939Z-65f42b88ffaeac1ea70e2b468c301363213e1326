{
  "sha": "65f42b88ffaeac1ea70e2b468c301363213e1326",
  "node_id": "C_kwDOANOeidoAKDY1ZjQyYjg4ZmZhZWFjMWVhNzBlMmI0NjhjMzAxMzYzMjEzZTEzMjY",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-10-31T04:49:39Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-10-31T04:49:39Z"
    },
    "message": "sim: tighten up stamp rules\n\nAdd a new ECHO_STAMP helper and convert existing stamp code over\nto it.  This is mostly common rules and cgen mloop rules.",
    "tree": {
      "sha": "e37123577d982d65100922fe98a687a9e2eb463d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e37123577d982d65100922fe98a687a9e2eb463d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/65f42b88ffaeac1ea70e2b468c301363213e1326",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/65f42b88ffaeac1ea70e2b468c301363213e1326",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/65f42b88ffaeac1ea70e2b468c301363213e1326",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/65f42b88ffaeac1ea70e2b468c301363213e1326/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b6143d31625b3869a6715c7479cf665272162b6f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b6143d31625b3869a6715c7479cf665272162b6f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b6143d31625b3869a6715c7479cf665272162b6f"
    }
  ],
  "stats": {
    "total": 77,
    "additions": 46,
    "deletions": 31
  },
  "files": [
    {
      "sha": "05a246e670acc6ce119a317d19d6978143623841",
      "filename": "sim/bpf/Makefile.in",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/bpf/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/bpf/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bpf/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -166,7 +166,8 @@ $(srcdir)/sem-be.c $(srcdir)/decode-be.c $(srcdir)/decode-be.h: \\\n stamp-mloop: stamp-mloop-le stamp-mloop-be\n \n stamp-mloop-le: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop-le.c eng-le.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -scache -prefix bpfbf_ebpfle -cpu bpfbf \\\n                 -infile $(srcdir)/mloop.in -outfile-suffix -le\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng-le.hin eng-le.h\n@@ -176,7 +177,8 @@ mloop-le.c eng-le.h: stamp-mloop-le\n \t@true\n \n stamp-mloop-be: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop-be.c eng-be.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -scache -prefix bpfbf_ebpfbe -cpu bpfbf \\\n                 -infile $(srcdir)/mloop.in -outfile-suffix -be\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng-be.hin eng-be.h"
    },
    {
      "sha": "706531e8fa1226d70f8768481201dde95be236e7",
      "filename": "sim/common/Make-common.in",
      "status": "modified",
      "additions": 24,
      "deletions": 20,
      "changes": 44,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/common/Make-common.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/common/Make-common.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/Make-common.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -45,6 +45,12 @@ srcsim = $(srcdir)/..\n \n include $(srcroot)/gdb/silent-rules.mk\n \n+ifeq ($(V),0)\n+ECHO_STAMP = @echo \"  GEN   \"\n+else\n+ECHO_STAMP = @:\n+endif\n+\n # Helper code from gnulib.\n GNULIB_PARENT_DIR = ../..\n include $(GNULIB_PARENT_DIR)/gnulib/Makefile.gnulib.inc\n@@ -240,7 +246,7 @@ remote_sim_h = $(srcroot)/include/sim/sim.h\n all: libsim.a run$(EXEEXT) .gdbinit\n \n libsim.a: $(LIB_OBJS)\n-\trm -f libsim.a\n+\t$(SILENCE) rm -f libsim.a\n \t$(ECHO_AR) $(AR) $(AR_FLAGS) libsim.a $(LIB_OBJS)\n \t$(ECHO_RANLIB) $(RANLIB) libsim.a\n \n@@ -261,10 +267,11 @@ gentmap: gentmap.o\n \n targ-vals.h targ-map.c: stamp-tvals\n stamp-tvals: gentmap\n-\trm -f tmp-tvals.h tmp-tmap.c\n-\t./gentmap -h >tmp-tvals.h\n+\t$(ECHO_STAMP) targ-vals.h\n+\t$(SILENCE) ./gentmap -h >tmp-tvals.h\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change tmp-tvals.h targ-vals.h\n-\t./gentmap -c >tmp-tmap.c\n+\t$(ECHO_STAMP) targ-tmap.c\n+\t$(SILENCE) ./gentmap -c >tmp-tmap.c\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change tmp-tmap.c targ-map.c\n \t$(SILENCE) touch $@\n \n@@ -411,19 +418,16 @@ endif\n # FIXME This is one very simple-minded way of generating the file hw-config.h\n hw-config.h: stamp-hw ; @true\n stamp-hw: Makefile.in $(srccom)/Make-common.in $(config.status) Makefile\n-\trm -f tmp-hw.h\n-\techo \"/* generated by Makefile */\" > tmp-hw.h\n-\tsim_hw=\"$(SIM_HW_DEVICES)\"; \\\n-\tfor hw in $$sim_hw ; do \\\n-\t  echo \"extern const struct hw_descriptor dv_$${hw}_descriptor[];\" ; \\\n-\tdone >> tmp-hw.h\n-\techo \"const struct hw_descriptor *hw_descriptors[] = {\" >> tmp-hw.h\n-\tsim_hw=\"$(SIM_HW_DEVICES)\"; \\\n-\tfor hw in $$sim_hw ; do \\\n-\t  echo \"  dv_$${hw}_descriptor,\" ; \\\n-\tdone >> tmp-hw.h\n-\techo \"  NULL,\" >> tmp-hw.h\n-\techo \"};\" >> tmp-hw.h\n+\t$(ECHO_STAMP) hw-config.h\n+\t$(SILENCE) ( \\\n+\tsim_hw=\"$(SIM_HW_DEVICES)\" ; \\\n+\techo \"/* generated by Makefile */\" ; \\\n+\tprintf \"extern const struct hw_descriptor dv_%s_descriptor[];\\n\" $$sim_hw ; \\\n+\techo \"const struct hw_descriptor *hw_descriptors[] = {\" ; \\\n+\tprintf \"  dv_%s_descriptor,\\n\" $$sim_hw ; \\\n+\techo \"  NULL,\" ; \\\n+\techo \"};\" \\\n+\t) > tmp-hw.h\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change tmp-hw.h hw-config.h\n \t$(SILENCE) touch $@\n \n@@ -434,8 +438,8 @@ test-hw-events: $(srccom)/hw-events.c libsim.a\n # See sim_pre_argv_init and sim_module_install in sim-module.c for more details.\n modules.c: stamp-modules ; @true\n stamp-modules: Makefile $(SIM_OBJS:.o=.c)\n-\t@echo Generating $@\n-\t@LANG=C ; export LANG ; \\\n+\t$(ECHO_STAMP) modules.c\n+\t$(SILENCE) LANG=C ; export LANG ; \\\n \tLC_ALL=C ; export LC_ALL ; \\\n \tsed -n -e '/^sim_install_/{s/^\\(sim_install_[a-z_0-9A-Z]*\\).*/\\1/;p}' $^ | sort >$@.l-tmp\n \t@set -e; (\\\n@@ -450,7 +454,7 @@ stamp-modules: Makefile $(SIM_OBJS:.o=.c)\n \techo 'const int sim_modules_detected_len = ARRAY_SIZE (sim_modules_detected);'; \\\n \t) >$@.tmp\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change $@.tmp modules.c\n-\t@rm -f $@.l-tmp $@.tmp\n+\t$(SILENCE) rm -f $@.l-tmp $@.tmp\n \t$(SILENCE) touch $@\n \n # CGEN support."
    },
    {
      "sha": "6125fc87bedcbcff32521051a3e5f68ba7f6ccee",
      "filename": "sim/cris/Makefile.in",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/cris/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/cris/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/cris/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -70,7 +70,8 @@ CRISV10F_INCLUDE_DEPS = \\\n # than the apparent; some \"mono\" feature is work in progress)?\n mloopv10f.c engv10.h: stamp-v10fmloop\n stamp-v10fmloop: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloopv10f.c engv10.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -no-fast -pbb -switch semcrisv10f-switch.c \\\n \t\t-cpu crisv10f -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin engv10.h\n@@ -89,7 +90,8 @@ mloopv32f.c engv32.h: stamp-v32fmloop\n # We depend on stamp-v10fmloop to get serialization to avoid\n # racing with it for the same temporary file-names when \"make -j\".\n stamp-v32fmloop: stamp-v10fmloop $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloopv32f.c engv32.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -no-fast -pbb -switch semcrisv32f-switch.c \\\n \t\t-cpu crisv32f -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin engv32.h"
    },
    {
      "sha": "e709e37ee7404706675e8effd99bbbe371b0d9d0",
      "filename": "sim/frv/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/frv/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/frv/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/frv/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -57,7 +57,8 @@ FRVBF_INCLUDE_DEPS = \\\n # FIXME: Use of `mono' is wip.\n mloop.c eng.h: stamp-mloop\n stamp-mloop: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop.c eng.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -scache -parallel-generic-write -parallel-only \\\n \t\t-cpu frvbf -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin eng.h"
    },
    {
      "sha": "4f85dc76235803479004aad09d6dca1769711606",
      "filename": "sim/iq2000/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/iq2000/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/iq2000/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/iq2000/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -57,7 +57,8 @@ IQ2000BF_INCLUDE_DEPS = \\\n # FIXME: Use of `mono' is wip.\n mloop.c eng.h: stamp-mloop\n stamp-mloop: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop.c eng.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -fast -pbb -switch sem-switch.c \\\n \t\t-cpu iq2000bf -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin eng.h"
    },
    {
      "sha": "2daf74d637bc1e92f70fc4302f2e635c04797bd6",
      "filename": "sim/lm32/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/lm32/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/lm32/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/lm32/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -38,7 +38,8 @@ LM32BF_INCLUDE_DEPS = \\\n # FIXME: Use of `mono' is wip.\n mloop.c eng.h: stamp-mloop\n stamp-mloop: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop.c eng.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -fast -pbb -switch sem-switch.c \\\n \t\t-cpu lm32bf -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin eng.h"
    },
    {
      "sha": "7b0ed1e0b93210851b0a82f7bfb435a7ce25d909",
      "filename": "sim/m32r/Makefile.in",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/m32r/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/m32r/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32r/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -59,7 +59,8 @@ M32RBF_INCLUDE_DEPS = \\\n # FIXME: Use of `mono' is wip.\n mloop.c eng.h: stamp-mloop ; @true\n stamp-mloop: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop.c eng.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -fast -pbb -switch sem-switch.c \\\n \t\t-cpu m32rbf -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin eng.h\n@@ -75,7 +76,8 @@ M32RXF_INCLUDE_DEPS = \\\n # FIXME: Use of `mono' is wip.\n mloopx.c engx.h: stamp-xmloop ; @true\n stamp-xmloop: $(srcdir)/../common/genmloop.sh mloopx.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloopx.c engx.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -no-fast -pbb -parallel-write -switch semx-switch.c \\\n \t\t-cpu m32rxf -infile $(srcdir)/mloopx.in \\\n \t\t-outfile-suffix x\n@@ -92,7 +94,8 @@ M32R2F_INCLUDE_DEPS = \\\n # FIXME: Use of `mono' is wip.\n mloop2.c eng2.h: stamp-2mloop ; @true\n stamp-2mloop: $(srcdir)/../common/genmloop.sh mloop2.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop2.c eng2.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -no-fast -pbb -parallel-write -switch sem2-switch.c \\\n \t\t-cpu m32r2f -infile $(srcdir)/mloop2.in \\\n \t\t-outfile-suffix 2"
    },
    {
      "sha": "8f447fdc291adcb4712c5cde906ab57fadf00f20",
      "filename": "sim/or1k/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/or1k/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/65f42b88ffaeac1ea70e2b468c301363213e1326/sim/or1k/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/or1k/Makefile.in?ref=65f42b88ffaeac1ea70e2b468c301363213e1326",
      "patch": "@@ -72,7 +72,8 @@ OR1K32BF_INCLUDE_DEPS = \\\n \n mloop.c eng.h: stamp-mloop ; @true\n stamp-mloop: $(srcdir)/../common/genmloop.sh mloop.in Makefile\n-\t$(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n+\t$(ECHO_STAMP) mloop.c eng.h\n+\t$(SILENCE) $(SHELL) $(srccom)/genmloop.sh -shell $(SHELL) \\\n \t\t-mono -fast -pbb -switch sem-switch.c \\\n \t\t-cpu or1k32bf -infile $(srcdir)/mloop.in\n \t$(SILENCE) $(SHELL) $(srcroot)/move-if-change eng.hin eng.h"
    }
  ]
}