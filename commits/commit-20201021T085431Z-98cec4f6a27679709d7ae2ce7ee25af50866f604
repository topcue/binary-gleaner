{
  "sha": "98cec4f6a27679709d7ae2ce7ee25af50866f604",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OThjZWM0ZjZhMjc2Nzk3MDlkN2FlMmNlN2VlMjVhZjUwODY2ZjYwNA==",
  "commit": {
    "author": {
      "name": "Gary Benson",
      "email": "gbenson@redhat.com",
      "date": "2020-10-21T08:54:31Z"
    },
    "committer": {
      "name": "Gary Benson",
      "email": "gbenson@redhat.com",
      "date": "2020-10-21T08:54:31Z"
    },
    "message": "Fix gdb.mi/mi-fullname-deleted.exp with Clang\n\ngdb.mi/mi-fullname-deleted.exp attempts to generate an executable\nwith a doubled slash in the source filename recorded in its debug\ninfo.  This attempt fails when compiling using Clang, causing the\nsubstituted filename test to fail.  This commit fixes this issue.\nIt also expands the comments in the file, to clarify what the test\nis attempting to do, and to document where it doesn't succeed.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.mi/mi-fullname-deleted.exp: Fix substituted\n\tfullname test with Clang.  Also expand comments generally.",
    "tree": {
      "sha": "8f1b06c93e883f2ebd8f86b5b5d4a4800d534372",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8f1b06c93e883f2ebd8f86b5b5d4a4800d534372"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/98cec4f6a27679709d7ae2ce7ee25af50866f604",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/98cec4f6a27679709d7ae2ce7ee25af50866f604",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/98cec4f6a27679709d7ae2ce7ee25af50866f604",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/98cec4f6a27679709d7ae2ce7ee25af50866f604/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "a1bd8917ab2bbb61071366ce8a6fd31d00d147ad",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a1bd8917ab2bbb61071366ce8a6fd31d00d147ad",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a1bd8917ab2bbb61071366ce8a6fd31d00d147ad"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 27,
    "deletions": 4
  },
  "files": [
    {
      "sha": "4061d1789ccdd99d28bf539ae41d773e4c97e79a",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/98cec4f6a27679709d7ae2ce7ee25af50866f604/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/98cec4f6a27679709d7ae2ce7ee25af50866f604/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=98cec4f6a27679709d7ae2ce7ee25af50866f604",
      "patch": "@@ -1,3 +1,8 @@\n+2020-10-21  Gary Benson <gbenson@redhat.com>\n+\n+\t* gdb.mi/mi-fullname-deleted.exp: Fix substituted\n+\tfullname test with Clang.  Also expand comments generally.\n+\n 2020-10-20  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.dwarf2/pr13961.S: Remove superfluous end-of-siblings marker."
    },
    {
      "sha": "e175041b46c6b88c0ed03f4a7cfb6e9750970b5f",
      "filename": "gdb/testsuite/gdb.mi/mi-fullname-deleted.exp",
      "status": "modified",
      "additions": 22,
      "deletions": 4,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/98cec4f6a27679709d7ae2ce7ee25af50866f604/gdb/testsuite/gdb.mi/mi-fullname-deleted.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/98cec4f6a27679709d7ae2ce7ee25af50866f604/gdb/testsuite/gdb.mi/mi-fullname-deleted.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-fullname-deleted.exp?ref=98cec4f6a27679709d7ae2ce7ee25af50866f604",
      "patch": "@@ -24,7 +24,17 @@ if [mi_gdb_start] {\n standard_testfile\n set srcfileabs [standard_output_file $srcfile]\n \n-# \"//$srcfile\" It is used for the test of compare_filenames_for_search.\n+# Double the final slash separator in $srcfileabs, such that\n+# \"/path/to/$srcfile\" becomes \"/path/to//$srcfile\".  This is\n+# passed as the \"source\" argument of gdb_compile, which, when\n+# using GCC (as of 10.2) will result in the doubled slash\n+# being incorporated into the built executable's debug info.\n+# This is then used to check compare_filenames_for_search does\n+# not falsely use an absolute filename as a relative one.\n+# Note that Clang (as of 12.0.0) normalizes the path before\n+# storing it in the executable's debug info, removing the double\n+# slash.  This nullifies the \"compare_filenames_for_search does\n+# not match\" test when using Clang (it can never fail).\n if { [regsub {/[^/]+$} $srcfileabs {/\\0} srcfileabs] != 1 } {\n     xfail \"cannot double the last slash separator\"\n     return -1\n@@ -36,6 +46,12 @@ if { [regsub {^(/[^/]+)/} $srcfileabs {\\1subst/} srcfileabssubst] != 1\n     return -1\n }\n \n+# Generate a regular expression which to match $srcfileabs with\n+# or without the doubled slash.  This is used by the substituted\n+# fullname test.\n+set srcfileabssubst_regexp [string_to_regexp $srcfileabssubst]\n+regsub {//} $srcfileabssubst_regexp {\\0?} srcfileabssubst_regexp\n+\n set f [open $srcfileabs \"w\"]\n puts $f \"int main (void) { return 0; }\"\n close $f\n@@ -54,10 +70,12 @@ mi_gdb_test \"-interpreter-exec console \\\"set substitute-path ${initdir} ${initdi\n \n mi_gdb_test \"-file-list-exec-source-file\" \".*\\\",fullname=\\\".*\\\".*\" \"fullname present\"\n \n-mi_gdb_test \"-file-list-exec-source-file\" \".*\\\",fullname=\\\"[string_to_regexp $srcfileabssubst]\\\".*\" \"substituted fullname\"\n+mi_gdb_test \"-file-list-exec-source-file\" \".*\\\",fullname=\\\"$srcfileabssubst_regexp\\\".*\" \"substituted fullname\"\n \n-# Test compare_filenames_for_search does not falsely use absolute filename as\n-# a relative one.\n+# Test compare_filenames_for_search does not falsely use absolute\n+# filename as a relative one.  Note that this test can falsely pass\n+# with Clang, and possibly other compilers too; see the comment\n+# above for more.\n mi_gdb_test \"-break-insert -t /$srcfile:main\" \\\n \t    \"\\\\^error,msg=\\\"No source file named /[string_to_regexp $srcfile]\\\\.\\\"\" \\\n \t    \"compare_filenames_for_search does not match\""
    }
  ]
}