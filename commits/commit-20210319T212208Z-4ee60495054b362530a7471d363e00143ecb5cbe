{
  "sha": "4ee60495054b362530a7471d363e00143ecb5cbe",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGVlNjA0OTUwNTRiMzYyNTMwYTc0NzFkMzYzZTAwMTQzZWNiNWNiZQ==",
  "commit": {
    "author": {
      "name": "Duncan Simpson",
      "email": "dr.duncan.p.simpson@gmail.com",
      "date": "2021-03-19T21:22:08Z"
    },
    "committer": {
      "name": "Cary Coutant",
      "email": "ccoutant@gmail.com",
      "date": "2021-03-19T21:22:08Z"
    },
    "message": "Fix gold to use mallinfo2 if available instead of deprecated mallinfo.\n\ngold/\n\tPR gold/26585\n\t* configure.ac: Add check for mallinfo2.\n\t* configure: Regenerate.\n\t* main.cc (main): Use mallinfo2 if available.",
    "tree": {
      "sha": "3d4c8ce6e35c58fc1cbfb8edec25e1eb59ccd909",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3d4c8ce6e35c58fc1cbfb8edec25e1eb59ccd909"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4ee60495054b362530a7471d363e00143ecb5cbe",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4ee60495054b362530a7471d363e00143ecb5cbe",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4ee60495054b362530a7471d363e00143ecb5cbe",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4ee60495054b362530a7471d363e00143ecb5cbe/comments",
  "author": null,
  "committer": {
    "login": "ccoutant",
    "id": 1442098,
    "node_id": "MDQ6VXNlcjE0NDIwOTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1442098?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ccoutant",
    "html_url": "https://github.com/ccoutant",
    "followers_url": "https://api.github.com/users/ccoutant/followers",
    "following_url": "https://api.github.com/users/ccoutant/following{/other_user}",
    "gists_url": "https://api.github.com/users/ccoutant/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ccoutant/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ccoutant/subscriptions",
    "organizations_url": "https://api.github.com/users/ccoutant/orgs",
    "repos_url": "https://api.github.com/users/ccoutant/repos",
    "events_url": "https://api.github.com/users/ccoutant/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ccoutant/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5cde809b7b9da3ad3aa0d65f0e5e92ab199d64f0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5cde809b7b9da3ad3aa0d65f0e5e92ab199d64f0",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5cde809b7b9da3ad3aa0d65f0e5e92ab199d64f0"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 16,
    "deletions": 4
  },
  "files": [
    {
      "sha": "bd23e151d3c30dd7c519d5979b0d7c9fbfadba06",
      "filename": "gold/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4ee60495054b362530a7471d363e00143ecb5cbe/gold/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4ee60495054b362530a7471d363e00143ecb5cbe/gold/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/ChangeLog?ref=4ee60495054b362530a7471d363e00143ecb5cbe",
      "patch": "@@ -1,3 +1,10 @@\n+2021-03-19  Duncan Simpson <dr.duncan.p.simpson@gmail.com>\n+\n+\tPR gold/26585\n+\t* configure.ac: Add check for mallinfo2.\n+\t* configure: Regenerate.\n+\t* main.cc (main): Use mallinfo2 if available.\n+\n 2021-03-19  Cary Coutant  <ccoutant@gmail.com>\n \n \tPR gold/27246"
    },
    {
      "sha": "b9f062b68eb480971b709eee85be9fd22eb25ac6",
      "filename": "gold/configure",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4ee60495054b362530a7471d363e00143ecb5cbe/gold/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4ee60495054b362530a7471d363e00143ecb5cbe/gold/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/configure?ref=4ee60495054b362530a7471d363e00143ecb5cbe",
      "patch": "@@ -9967,7 +9967,7 @@ case \"$ac_cv_search_dlopen\" in\n esac\n \n \n-for ac_func in mallinfo posix_fallocate fallocate readv sysconf times mkdtemp\n+for ac_func in mallinfo mallinfo2 posix_fallocate fallocate readv sysconf times mkdtemp\n do :\n   as_ac_var=`$as_echo \"ac_cv_func_$ac_func\" | $as_tr_sh`\n ac_fn_cxx_check_func \"$LINENO\" \"$ac_func\" \"$as_ac_var\""
    },
    {
      "sha": "1716a779416a579d7514b280842fee88fde343cc",
      "filename": "gold/configure.ac",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4ee60495054b362530a7471d363e00143ecb5cbe/gold/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4ee60495054b362530a7471d363e00143ecb5cbe/gold/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/configure.ac?ref=4ee60495054b362530a7471d363e00143ecb5cbe",
      "patch": "@@ -636,7 +636,7 @@ case \"$ac_cv_search_dlopen\" in\n esac\n AC_SUBST(DLOPEN_LIBS)\n \n-AC_CHECK_FUNCS(mallinfo posix_fallocate fallocate readv sysconf times mkdtemp)\n+AC_CHECK_FUNCS(mallinfo mallinfo2 posix_fallocate fallocate readv sysconf times mkdtemp)\n AC_CHECK_DECLS([basename, ffs, asprintf, vasprintf, snprintf, vsnprintf, strverscmp, strndup, memmem])\n \n # Use of ::std::tr1::unordered_map::rehash causes undefined symbols"
    },
    {
      "sha": "89bc40b22af50de39fd0afeb5e694bdf6771ad50",
      "filename": "gold/main.cc",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4ee60495054b362530a7471d363e00143ecb5cbe/gold/main.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4ee60495054b362530a7471d363e00143ecb5cbe/gold/main.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gold/main.cc?ref=4ee60495054b362530a7471d363e00143ecb5cbe",
      "patch": "@@ -25,7 +25,7 @@\n #include <cstdio>\n #include <cstring>\n \n-#ifdef HAVE_MALLINFO\n+#if defined(HAVE_MALLINFO) || defined(HAVE_MALLINFO2)\n #include <malloc.h>\n #endif\n \n@@ -290,11 +290,16 @@ main(int argc, char** argv)\n               elapsed.sys / 1000, (elapsed.sys % 1000) * 1000,\n               elapsed.wall / 1000, (elapsed.wall % 1000) * 1000);\n \n-#ifdef HAVE_MALLINFO\n+#if defined(HAVE_MALLINFO2)\n+      struct mallinfo m = mallinfo2();\n+      fprintf(stderr, _(\"%s: total space allocated by malloc: %lld bytes\\n\"),\n+\t      program_name, static_cast<long long>(m.arena));\n+#elif defined(HAVE_MALLINFO)\n       struct mallinfo m = mallinfo();\n       fprintf(stderr, _(\"%s: total space allocated by malloc: %lld bytes\\n\"),\n \t      program_name, static_cast<long long>(m.arena));\n #endif\n+\n       File_read::print_stats();\n       Archive::print_stats();\n       Lib_group::print_stats();"
    }
  ]
}