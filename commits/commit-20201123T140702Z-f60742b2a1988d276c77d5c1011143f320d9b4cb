{
  "sha": "f60742b2a1988d276c77d5c1011143f320d9b4cb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjYwNzQyYjJhMTk4OGQyNzZjNzdkNWMxMDExMTQzZjMyMGQ5YjRjYg==",
  "commit": {
    "author": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-11-23T14:07:02Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-11-23T14:07:02Z"
    },
    "message": "Fix an illegal memory access when accessing corrupt dynamic secondary relocations.\n\n\tPR 26931\n\t* elf-bfd.h (struct elf_backend_data): Add bfd_boolean field to\n\tslurp_secondary_relocs field.\n\t(_bfd_elf_slurp_secondary_reloc_section): Update prototype.\n\t* elf.c (_bfd_elf_slurp_secondary_reloc_section): Add new\n\tparameter.  Compute number of symbols based upon the new\n\tparameter.\n\t* elfcode.h (elf_slurp_reloc_table): Pass dynamic as new\n\tparameter.",
    "tree": {
      "sha": "1d6169dbfb83984efad1a4bbdac29c562650433b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1d6169dbfb83984efad1a4bbdac29c562650433b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f60742b2a1988d276c77d5c1011143f320d9b4cb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f60742b2a1988d276c77d5c1011143f320d9b4cb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f60742b2a1988d276c77d5c1011143f320d9b4cb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f60742b2a1988d276c77d5c1011143f320d9b4cb/comments",
  "author": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "cbf097d7b024fad33d13cc43ff0d35f2e0b11898",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cbf097d7b024fad33d13cc43ff0d35f2e0b11898",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/cbf097d7b024fad33d13cc43ff0d35f2e0b11898"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 23,
    "deletions": 8
  },
  "files": [
    {
      "sha": "d47d518a2a9b0574f4a933dad307600cb9edd18a",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=f60742b2a1988d276c77d5c1011143f320d9b4cb",
      "patch": "@@ -1,3 +1,15 @@\n+2020-11-23  Nick Clifton  <nickc@redhat.com>\n+\n+\tPR 26931\n+\t* elf-bfd.h (struct elf_backend_data): Add bfd_boolean field to\n+\tslurp_secondary_relocs field.\n+\t(_bfd_elf_slurp_secondary_reloc_section): Update prototype.\n+\t* elf.c (_bfd_elf_slurp_secondary_reloc_section): Add new\n+\tparameter.  Compute number of symbols based upon the new\n+\tparameter.\n+\t* elfcode.h (elf_slurp_reloc_table): Pass dynamic as new\n+\tparameter.\n+\n 2020-11-23  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/26918"
    },
    {
      "sha": "e8455d14864aa852828c2d0a81374515bf54ad25",
      "filename": "bfd/elf-bfd.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/elf-bfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/elf-bfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf-bfd.h?ref=f60742b2a1988d276c77d5c1011143f320d9b4cb",
      "patch": "@@ -1571,7 +1571,7 @@ struct elf_backend_data\n \t\t\t\t\t       const char *, unsigned int);\n \n   /* Called when after loading the normal relocs for a section.  */\n-  bfd_boolean (*slurp_secondary_relocs) (bfd *, asection *, asymbol **);\n+  bfd_boolean (*slurp_secondary_relocs) (bfd *, asection *, asymbol **, bfd_boolean);\n \n   /* Called after writing the normal relocs for a section.  */\n   bfd_boolean (*write_secondary_relocs) (bfd *, asection *);\n@@ -2919,7 +2919,7 @@ extern bfd_boolean is_debuginfo_file (bfd *);\n extern bfd_boolean _bfd_elf_init_secondary_reloc_section\n   (bfd *, Elf_Internal_Shdr *, const char *, unsigned int);\n extern bfd_boolean _bfd_elf_slurp_secondary_reloc_section\n-  (bfd *, asection *, asymbol **);\n+  (bfd *, asection *, asymbol **, bfd_boolean);\n extern bfd_boolean _bfd_elf_copy_special_section_fields\n   (const bfd *, bfd *, const Elf_Internal_Shdr *, Elf_Internal_Shdr *);\n extern bfd_boolean _bfd_elf_write_secondary_reloc_section"
    },
    {
      "sha": "dbff0f24c8062ce0df58e865e07aa6a2230ef4c4",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 8,
      "deletions": 5,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=f60742b2a1988d276c77d5c1011143f320d9b4cb",
      "patch": "@@ -12560,9 +12560,10 @@ _bfd_elf_init_secondary_reloc_section (bfd * abfd,\n /* Read in any secondary relocs associated with SEC.  */\n \n bfd_boolean\n-_bfd_elf_slurp_secondary_reloc_section (bfd *      abfd,\n-\t\t\t\t\tasection * sec,\n-\t\t\t\t\tasymbol ** symbols)\n+_bfd_elf_slurp_secondary_reloc_section (bfd *       abfd,\n+\t\t\t\t\tasection *  sec,\n+\t\t\t\t\tasymbol **  symbols,\n+\t\t\t\t\tbfd_boolean dynamic)\n {\n   const struct elf_backend_data * const ebd = get_elf_backend_data (abfd);\n   asection * relsec;\n@@ -12641,7 +12642,10 @@ _bfd_elf_slurp_secondary_reloc_section (bfd *      abfd,\n \t      continue;\n \t    }\n \n-\t  symcount = bfd_get_symcount (abfd);\n+\t  if (dynamic)\n+\t    symcount = bfd_get_dynamic_symcount (abfd);\n+\t  else\n+\t    symcount = bfd_get_symcount (abfd);\n \n \t  for (i = 0, internal_reloc = internal_relocs,\n \t\t native_reloc = native_relocs;\n@@ -12688,7 +12692,6 @@ _bfd_elf_slurp_secondary_reloc_section (bfd *      abfd,\n \t\t  asymbol **ps;\n \n \t\t  ps = symbols + r_sym (rela.r_info) - 1;\n-\n \t\t  internal_reloc->sym_ptr_ptr = ps;\n \t\t  /* Make sure that this symbol is not removed by strip.  */\n \t\t  (*ps)->flags |= BSF_KEEP;"
    },
    {
      "sha": "c7da8f6c07424ec1f067af620f5b2ae3f20873d4",
      "filename": "bfd/elfcode.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/elfcode.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f60742b2a1988d276c77d5c1011143f320d9b4cb/bfd/elfcode.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfcode.h?ref=f60742b2a1988d276c77d5c1011143f320d9b4cb",
      "patch": "@@ -1603,7 +1603,7 @@ elf_slurp_reloc_table (bfd *abfd,\n \t\t\t\t\t      symbols, dynamic))\n     return FALSE;\n \n-  if (!bed->slurp_secondary_relocs (abfd, asect, symbols))\n+  if (!bed->slurp_secondary_relocs (abfd, asect, symbols, dynamic))\n     return FALSE;\n \n   asect->relocation = relents;"
    }
  ]
}