{
  "sha": "4d3bb35620e70d543d438bf21be1307f7ea0f5d0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGQzYmIzNTYyMGU3MGQ1NDNkNDM4YmYyMWJlMTMwN2Y3ZWEwZjVkMA==",
  "commit": {
    "author": {
      "name": "Szabolcs Nagy",
      "email": "szabolcs.nagy@arm.com",
      "date": "2020-07-29T14:47:50Z"
    },
    "committer": {
      "name": "Szabolcs Nagy",
      "email": "szabolcs.nagy@arm.com",
      "date": "2020-07-30T16:00:53Z"
    },
    "message": "aarch64: set sh_entsize of .plt to 0\n\nOn aarch64 the first PLT entry is 32 bytes, subsequent entries\nare 16 bytes by default but can be 24 bytes with BTI or with\nPAC-PLT.\n\nsh_entsize of .plt was set to the PLT entry size, so in some\ncases sh_size % sh_entsize != 0, which breaks some tools.\n\nNote that PLT0 (and the TLSDESC stub code which is also in the\nPLT) were historically not padded up to meet the sh_size\nrequirement, but to ensure that PLT stub code is aligned on\ncache lines. Similar layout is present on other targets too\nwhich just happens to make sh_size a multiple of sh_entsize and\nit is not expected that sh_entsize of .plt is used for anything.\n\nThis patch sets sh_entsize of .plt to 0: the section does not\nhold a table of fixed-size entries so other values are not\nconforming in principle to the ELF spec.\n\nbfd/ChangeLog:\n\n\tPR ld/26312\n\t* elfnn-aarch64.c (elfNN_aarch64_init_small_plt0_entry): Set sh_entsize\n\tto 0.\n\t(elfNN_aarch64_finish_dynamic_sections): Remove sh_entsize setting.",
    "tree": {
      "sha": "320675ff833252130161bcae7e09b1e360795ef8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/320675ff833252130161bcae7e09b1e360795ef8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4d3bb35620e70d543d438bf21be1307f7ea0f5d0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4d3bb35620e70d543d438bf21be1307f7ea0f5d0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4d3bb35620e70d543d438bf21be1307f7ea0f5d0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4d3bb35620e70d543d438bf21be1307f7ea0f5d0/comments",
  "author": {
    "login": "nsz-arm",
    "id": 30925343,
    "node_id": "MDQ6VXNlcjMwOTI1MzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nsz-arm",
    "html_url": "https://github.com/nsz-arm",
    "followers_url": "https://api.github.com/users/nsz-arm/followers",
    "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/nsz-arm/orgs",
    "repos_url": "https://api.github.com/users/nsz-arm/repos",
    "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nsz-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nsz-arm",
    "id": 30925343,
    "node_id": "MDQ6VXNlcjMwOTI1MzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nsz-arm",
    "html_url": "https://github.com/nsz-arm",
    "followers_url": "https://api.github.com/users/nsz-arm/followers",
    "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/nsz-arm/orgs",
    "repos_url": "https://api.github.com/users/nsz-arm/repos",
    "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nsz-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e12dcc50da18ef4382c02d1f2bb1541251cce45e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e12dcc50da18ef4382c02d1f2bb1541251cce45e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e12dcc50da18ef4382c02d1f2bb1541251cce45e"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 12,
    "deletions": 6
  },
  "files": [
    {
      "sha": "e507a9d6c0f0ff32426427646f9ca73b5e403401",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d3bb35620e70d543d438bf21be1307f7ea0f5d0/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d3bb35620e70d543d438bf21be1307f7ea0f5d0/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=4d3bb35620e70d543d438bf21be1307f7ea0f5d0",
      "patch": "@@ -1,3 +1,10 @@\n+2020-07-30  Szabolcs Nagy  <szabolcs.nagy@arm.com>\n+\n+\tPR ld/26312\n+\t* elfnn-aarch64.c (elfNN_aarch64_init_small_plt0_entry): Set sh_entsize\n+\tto 0.\n+\t(elfNN_aarch64_finish_dynamic_sections): Remove sh_entsize setting.\n+\n 2020-07-30  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* bfd.m4 (BFD_SYS_PROCFS_H): New macro."
    },
    {
      "sha": "a1c888722786b955b32fed490d56ab526173f215",
      "filename": "bfd/elfnn-aarch64.c",
      "status": "modified",
      "additions": 5,
      "deletions": 6,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d3bb35620e70d543d438bf21be1307f7ea0f5d0/bfd/elfnn-aarch64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d3bb35620e70d543d438bf21be1307f7ea0f5d0/bfd/elfnn-aarch64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-aarch64.c?ref=4d3bb35620e70d543d438bf21be1307f7ea0f5d0",
      "patch": "@@ -9509,8 +9509,11 @@ elfNN_aarch64_init_small_plt0_entry (bfd *output_bfd ATTRIBUTE_UNUSED,\n \n   memcpy (htab->root.splt->contents, htab->plt0_entry,\n \t  htab->plt_header_size);\n-  elf_section_data (htab->root.splt->output_section)->this_hdr.sh_entsize =\n-    htab->plt_header_size;\n+\n+  /* PR 26312: Explicitly set the sh_entsize to 0 so that\n+     consumers do not think that the section contains fixed\n+     sized objects.  */\n+  elf_section_data (htab->root.splt->output_section)->this_hdr.sh_entsize = 0;\n \n   plt_got_2nd_ent = (htab->root.sgotplt->output_section->vma\n \t\t  + htab->root.sgotplt->output_offset\n@@ -9612,10 +9615,6 @@ elfNN_aarch64_finish_dynamic_sections (bfd *output_bfd,\n     {\n       elfNN_aarch64_init_small_plt0_entry (output_bfd, htab);\n \n-      elf_section_data (htab->root.splt->output_section)->\n-\tthis_hdr.sh_entsize = htab->plt_entry_size;\n-\n-\n       if (htab->root.tlsdesc_plt && !(info->flags & DF_BIND_NOW))\n \t{\n \t  BFD_ASSERT (htab->root.tlsdesc_got != (bfd_vma)-1);"
    }
  ]
}