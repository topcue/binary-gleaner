{
  "sha": "6320fd00dc374f74658c7e4b7dffbe1d71723284",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjMyMGZkMDBkYzM3NGY3NDY1OGM3ZTRiN2RmZmJlMWQ3MTcyMzI4NA==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-06-17T19:35:18Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-07-09T01:11:53Z"
    },
    "message": "elf: Add GNU_PROPERTY_1_NEEDED\n\nAdd GNU_PROPERTY_1_NEEDED:\n\n #define GNU_PROPERTY_1_NEEDED      GNU_PROPERTY_UINT32_OR_LO\n\nto indicate the needed properties by the object file.\n\nAdd GNU_PROPERTY_1_NEEDED_INDIRECT_EXTERN_ACCESS:\n\n #define GNU_PROPERTY_1_NEEDED_INDIRECT_EXTERN_ACCESS  (1U << 0)\n\nto indicate that the object file requires canonical function pointers and\ncannot be used with copy relocation.\n\nbinutils/\n\n\t* readelf.c (decode_1_needed): New.\n\t(print_gnu_property_note): Handle GNU_PROPERTY_1_NEEDED.\n\ninclude/\n\n\t* elf/common.h (GNU_PROPERTY_1_NEEDED): New.\n\t(GNU_PROPERTY_1_NEEDED_INDIRECT_EXTERN_ACCESS): Likewise.\n\nld/\n\n\t* testsuite/ld-elf/property-1_needed-1a.d: New file.\n\t* testsuite/ld-elf/property-1_needed-1.s: Likewise.",
    "tree": {
      "sha": "95d9ca4603d3b066d511280d66ee384062c52853",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/95d9ca4603d3b066d511280d66ee384062c52853"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6320fd00dc374f74658c7e4b7dffbe1d71723284",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6320fd00dc374f74658c7e4b7dffbe1d71723284",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6320fd00dc374f74658c7e4b7dffbe1d71723284",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6320fd00dc374f74658c7e4b7dffbe1d71723284/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ce8fea3651a6050d5089b6d90068733f4cb9f686",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ce8fea3651a6050d5089b6d90068733f4cb9f686",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ce8fea3651a6050d5089b6d90068733f4cb9f686"
    }
  ],
  "stats": {
    "total": 78,
    "additions": 78,
    "deletions": 0
  },
  "files": [
    {
      "sha": "24ff069edf49a406db1256e5266639e1f3a78d2b",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 39,
      "deletions": 0,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6320fd00dc374f74658c7e4b7dffbe1d71723284/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6320fd00dc374f74658c7e4b7dffbe1d71723284/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=6320fd00dc374f74658c7e4b7dffbe1d71723284",
      "patch": "@@ -19332,6 +19332,28 @@ decode_aarch64_feature_1_and (unsigned int bitmask)\n     }\n }\n \n+static void\n+decode_1_needed (unsigned int bitmask)\n+{\n+  while (bitmask)\n+    {\n+      unsigned int bit = bitmask & (- bitmask);\n+\n+      bitmask &= ~ bit;\n+      switch (bit)\n+\t{\n+\tcase GNU_PROPERTY_1_NEEDED_INDIRECT_EXTERN_ACCESS:\n+\t  printf (\"indirect external access\");\n+\t  break;\n+\tdefault:\n+\t  printf (_(\"<unknown: %x>\"), bit);\n+\t  break;\n+\t}\n+      if (bitmask)\n+\tprintf (\", \");\n+    }\n+}\n+\n static void\n print_gnu_property_note (Filedata * filedata, Elf_Internal_Note * pnote)\n {\n@@ -19525,6 +19547,23 @@ print_gnu_property_note (Filedata * filedata, Elf_Internal_Note * pnote)\n \t\t  || (type >= GNU_PROPERTY_UINT32_OR_LO\n \t\t      && type <= GNU_PROPERTY_UINT32_OR_HI))\n \t\t{\n+\t\t  switch (type)\n+\t\t    {\n+\t\t    case GNU_PROPERTY_1_NEEDED:\n+\t\t      if (datasz != 4)\n+\t\t\tprintf (_(\"1_needed: <corrupt length: %#x> \"),\n+\t\t\t\tdatasz);\n+\t\t      else\n+\t\t\t{\n+\t\t\t  unsigned int bitmask = byte_get (ptr, 4);\n+\t\t\t  printf (\"1_needed: \");\n+\t\t\t  decode_1_needed (bitmask);\n+\t\t\t}\n+\t\t      goto next;\n+\n+\t\t    default:\n+\t\t      break;\n+\t\t    }\n \t\t  if (type <= GNU_PROPERTY_UINT32_AND_HI)\n \t\t    printf (_(\"UINT32_AND (%#x): \"), type);\n \t\t  else"
    },
    {
      "sha": "0d381f0d27be5b818a79dfea8293a0bc9a62012a",
      "filename": "include/elf/common.h",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6320fd00dc374f74658c7e4b7dffbe1d71723284/include/elf/common.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6320fd00dc374f74658c7e4b7dffbe1d71723284/include/elf/common.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/elf/common.h?ref=6320fd00dc374f74658c7e4b7dffbe1d71723284",
      "patch": "@@ -792,6 +792,13 @@\n #define GNU_PROPERTY_UINT32_OR_LO\t0xb0008000\n #define GNU_PROPERTY_UINT32_OR_HI\t0xb000ffff\n \n+/* The needed properties by the object file.  */\n+#define GNU_PROPERTY_1_NEEDED\t\tGNU_PROPERTY_UINT32_OR_LO\n+\n+/* Set if the object file requires canonical function pointers and\n+   cannot be used with copy relocation.  */\n+#define GNU_PROPERTY_1_NEEDED_INDIRECT_EXTERN_ACCESS\t(1U << 0)\n+\n /* Processor-specific semantics, lo */\n #define GNU_PROPERTY_LOPROC  0xc0000000\n /* Processor-specific semantics, hi */"
    },
    {
      "sha": "5d5cdc87744963eb3877911267669ecbad6e162c",
      "filename": "ld/testsuite/ld-elf/property-1_needed-1.s",
      "status": "added",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6320fd00dc374f74658c7e4b7dffbe1d71723284/ld/testsuite/ld-elf/property-1_needed-1.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6320fd00dc374f74658c7e4b7dffbe1d71723284/ld/testsuite/ld-elf/property-1_needed-1.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/property-1_needed-1.s?ref=6320fd00dc374f74658c7e4b7dffbe1d71723284",
      "patch": "@@ -0,0 +1,15 @@\n+\t.section \".note.gnu.property\", \"a\"\n+\t.p2align ALIGN\n+\t.long 1f - 0f\t\t/* name length */\n+\t.long 5f - 2f\t\t/* data length */\n+\t.long 5\t\t\t/* note type */\n+0:\t.asciz \"GNU\"\t\t/* vendor name */\n+1:\n+\t.p2align ALIGN\n+2:\t.long 0xb0008000\t/* pr_type.  */\n+\t.long 4f - 3f\t\t/* pr_datasz.  */\n+3:\n+\t.long 0x3\n+4:\n+\t.p2align ALIGN\n+5:"
    },
    {
      "sha": "d994e6edece01902dcf5412088f6c2823b976766",
      "filename": "ld/testsuite/ld-elf/property-1_needed-1a.d",
      "status": "added",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6320fd00dc374f74658c7e4b7dffbe1d71723284/ld/testsuite/ld-elf/property-1_needed-1a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6320fd00dc374f74658c7e4b7dffbe1d71723284/ld/testsuite/ld-elf/property-1_needed-1a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/property-1_needed-1a.d?ref=6320fd00dc374f74658c7e4b7dffbe1d71723284",
      "patch": "@@ -0,0 +1,17 @@\n+#source: empty.s\n+#source: property-1_needed-1.s\n+#as:\n+#ld: -shared\n+#readelf: -n\n+#xfail: ![check_shared_lib_support]\n+#notarget: am33_2.0-*-* hppa*-*-hpux* mn10300-*-*\n+# Assembly source file for the HPPA assembler is renamed and modifed by\n+# sed.  mn10300 has relocations in .note.gnu.property section which\n+# elf_parse_notes doesn't support.\n+\n+#...\n+Displaying notes found in: .note.gnu.property\n+[ \t]+Owner[ \t]+Data size[ \t]+Description\n+  GNU                  0x[0-9a-f]+\tNT_GNU_PROPERTY_TYPE_0\n+      Properties: 1_needed: indirect external access, <unknown: 2>\n+#pass"
    }
  ]
}