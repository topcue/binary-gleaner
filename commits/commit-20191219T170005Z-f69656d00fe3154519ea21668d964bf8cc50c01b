{
  "sha": "f69656d00fe3154519ea21668d964bf8cc50c01b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjY5NjU2ZDAwZmUzMTU0NTE5ZWEyMTY2OGQ5NjRiZjhjYzUwYzAxYg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-12-10T18:44:36Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-12-19T17:00:05Z"
    },
    "message": "Handle CRLF when reading XML on Windows\n\nxml-support.c uses FOPEN_RT, but then reads the entire contents of the\nfile and verifies that the number of bytes read matches the length.\nThis can fail on Windows, where the read will translate line\nterminators.\n\nThis patch fixes the bug by changing xml-support.c to use FOPEN_RB.\nThis works because expat correctly handles \\r\\n line terminators.\n\ngdb/ChangeLog\n2019-12-11  Tom Tromey  <tromey@adacore.com>\n\n\t* xml-support.c (xml_fetch_content_from_file): Use FOPEN_RB.\n\ngdb/testsuite/ChangeLog\n2019-12-11  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.xml/tdesc-arch.exp (set_arch): Add \"trans_mode\" parameter.\n\tAdd crlf test.\n\nChange-Id: I548438f33eed284dde1de8babf755eaa1a40319d",
    "tree": {
      "sha": "e07fe31898f35e94c42ff5e8e185488e7a26f845",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e07fe31898f35e94c42ff5e8e185488e7a26f845"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f69656d00fe3154519ea21668d964bf8cc50c01b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f69656d00fe3154519ea21668d964bf8cc50c01b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f69656d00fe3154519ea21668d964bf8cc50c01b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f69656d00fe3154519ea21668d964bf8cc50c01b/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "228c8f4be0c428369ec6b68e25696863d1e62ed7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/228c8f4be0c428369ec6b68e25696863d1e62ed7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/228c8f4be0c428369ec6b68e25696863d1e62ed7"
    }
  ],
  "stats": {
    "total": 27,
    "additions": 22,
    "deletions": 5
  },
  "files": [
    {
      "sha": "532dc6373af9fd0ad00276e93c3a31d1385b0555",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=f69656d00fe3154519ea21668d964bf8cc50c01b",
      "patch": "@@ -1,3 +1,7 @@\n+2019-12-11  Tom Tromey  <tromey@adacore.com>\n+\n+\t* xml-support.c (xml_fetch_content_from_file): Use FOPEN_RB.\n+\n 2019-12-18  Tom Tromey  <tromey@adacore.com>\n \n \tPR build/25268:"
    },
    {
      "sha": "4f8d8517e3c0b1bc59bbfc1192f94ef2ce32667c",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=f69656d00fe3154519ea21668d964bf8cc50c01b",
      "patch": "@@ -1,3 +1,8 @@\n+2019-12-11  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.xml/tdesc-arch.exp (set_arch): Add \"trans_mode\" parameter.\n+\tAdd crlf test.\n+\n 2019-12-18  Simon Marchi  <simon.marchi@efficios.com>\n \n \t* gdb.base/default.exp: Update value of $_gdb_major."
    },
    {
      "sha": "d98e50e5624fb2fb505031c5315d8f40cf082efa",
      "filename": "gdb/testsuite/gdb.xml/tdesc-arch.exp",
      "status": "modified",
      "additions": 11,
      "deletions": 3,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/testsuite/gdb.xml/tdesc-arch.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/testsuite/gdb.xml/tdesc-arch.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.xml/tdesc-arch.exp?ref=f69656d00fe3154519ea21668d964bf8cc50c01b",
      "patch": "@@ -55,13 +55,16 @@ if { \"$arch1\" == \"\" || \"$arch2\" == \"\" || \"$default_arch\" == \"\" } {\n \n # Run these tests twice, once for $arch1 and once for $arch2, to\n # make sure that the tdesc file overrides the global default.\n+# TRANS_MODE indicates how newlines should be represented; it should\n+# be one of the values supported by \"fconfigure -translation\".\n \n-proc set_arch { arch which } {\n+proc set_arch { arch which trans_mode } {\n     global gdb_prompt\n     global subdir\n \n     set filename [standard_output_file tdesc-arch.xml]\n     set fd [open $filename w]\n+    fconfigure $fd -translation $trans_mode\n     puts $fd \\\n \t\"<target>\n \t    <architecture>$arch</architecture>\n@@ -92,8 +95,13 @@ proc set_arch { arch which } {\n     remote_file host delete $filename\n }\n \n-set_arch $arch1 first\n-set_arch $arch2 second\n+set_arch $arch1 first lf\n+set_arch $arch2 second lf\n+\n+with_test_prefix crlf {\n+    set_arch $arch1 first crlf\n+    set_arch $arch2 second crlf\n+}\n \n # Check an invalid architecture setting.\n set filename [standard_output_file tdesc-arch.xml]"
    },
    {
      "sha": "0f0806f8ee047b19ce9999b2095ff3bc87389ea1",
      "filename": "gdb/xml-support.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/xml-support.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f69656d00fe3154519ea21668d964bf8cc50c01b/gdb/xml-support.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/xml-support.c?ref=f69656d00fe3154519ea21668d964bf8cc50c01b",
      "patch": "@@ -977,11 +977,11 @@ xml_fetch_content_from_file (const char *filename, void *baton)\n     {\n       char *fullname = concat (dirname, \"/\", filename, (char *) NULL);\n \n-      file = gdb_fopen_cloexec (fullname, FOPEN_RT);\n+      file = gdb_fopen_cloexec (fullname, FOPEN_RB);\n       xfree (fullname);\n     }\n   else\n-    file = gdb_fopen_cloexec (filename, FOPEN_RT);\n+    file = gdb_fopen_cloexec (filename, FOPEN_RB);\n \n   if (file == NULL)\n     return {};"
    }
  ]
}