{
  "sha": "61fb73769a0168afa466bb2245a1a233942203bb",
  "node_id": "C_kwDOANOeidoAKDYxZmI3Mzc2OWEwMTY4YWZhNDY2YmIyMjQ1YTFhMjMzOTQyMjAzYmI",
  "commit": {
    "author": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2022-02-07T07:26:56Z"
    },
    "committer": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2022-02-07T07:26:56Z"
    },
    "message": "gdb: add the 'set/show suppress-cli-notifications' command\n\nGDB already has a flag to suppress printing notification events, such\nas thread and inferior context switches, on the CLI.  This is used\ninternally when executing commands.  Make the flag available to the\nuser via a new command.  This is expected to be useful in scripts.\n\nFor instance, suppose that when Inferior 1 gets to a certain state,\nyou want to add and set up a new inferior using the commands below,\nbut you also want to have a reduced/clean output.\n\n  define do-setup\n    printf \"Setting up Inferior 2...\\n\"\n    add-inferior -exec a.out\n    inferior 2\n    break file.c:3\n    run\n    inferior 1\n    printf \"Done\\n\"\n  end\n\nCurrently, GDB prints\n\n  (gdb) do-setup\n  Setting up Inferior 2...\n  [New inferior 2]\n  Added inferior 2 on connection 1 (native)\n  [Switching to inferior 2 [<null>] (/tmp/a.out)]\n  Breakpoint 2 at 0x1155: file file.c, line 3.\n\n  Thread 2.1 \"a.out\" hit Breakpoint 2, main () at file.c:3\n  3         return 0;\n  [Switching to inferior 1 [process 7670] (/tmp/test)]\n  [Switching to thread 1.1 (process 7670)]\n  #0  main () at test.c:2\n  2         int a = 1;\n  Done\n\nGDB's Python API make it possible to capture and return GDB's output,\nbut this does not work for all the streams.  In particular, CLI\nnotification events are not captured:\n\n  (gdb) python gdb.execute(\"do-setup\", False, True)\n  [Switching to inferior 2 [<null>] (/tmp/a.out)]\n\n  Thread 2.1 \"a.out\" hit Breakpoint 2, main () at file.c:3\n  3         return 0;\n  [Switching to inferior 1 [process 8263] (/tmp/test)]\n  [Switching to thread 1.1 (process 8263)]\n  #0  main () at test.c:2\n  2         int a = 1;\n\nYou can use the new \"set suppress-cli-notifications\" command to\nsuppress the output:\n\n  (gdb) set suppress-cli-notifications on\n  (gdb) do-setup\n  Setting up Inferior 2...\n  [New inferior 2]\n  Added inferior 2 on connection 1 (native)\n  Breakpoint 2 at 0x1155: file file.c, line 3.\n  Done",
    "tree": {
      "sha": "d8f1ca94d686cfca7fbc7cff14c1d54bc0ebecdd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d8f1ca94d686cfca7fbc7cff14c1d54bc0ebecdd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/61fb73769a0168afa466bb2245a1a233942203bb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/61fb73769a0168afa466bb2245a1a233942203bb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/61fb73769a0168afa466bb2245a1a233942203bb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/61fb73769a0168afa466bb2245a1a233942203bb/comments",
  "author": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2b826f759256b77b447da9831b079e32a7bb0cdb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2b826f759256b77b447da9831b079e32a7bb0cdb",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2b826f759256b77b447da9831b079e32a7bb0cdb"
    }
  ],
  "stats": {
    "total": 181,
    "additions": 181,
    "deletions": 0
  },
  "files": [
    {
      "sha": "c739930bfc7a665275e0f54d00a28706a0728279",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/61fb73769a0168afa466bb2245a1a233942203bb/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/61fb73769a0168afa466bb2245a1a233942203bb/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=61fb73769a0168afa466bb2245a1a233942203bb",
      "patch": "@@ -81,6 +81,14 @@ maint show gnu-source-highlight enabled\n   styling to a particular source file, then the Python Pygments\n   library will be used instead.\n \n+set suppress-cli-notifications (on|off)\n+show suppress-cli-notifications\n+  This controls whether printing the notifications is suppressed for CLI.\n+  CLI notifications occur when you change the selected context\n+  (i.e., the current inferior, thread and/or the frame), or when\n+  the program being debugged stops (e.g., because of hitting a\n+  breakpoint, completing source-stepping, an interrupt, etc.).\n+\n * Changed commands\n \n maint packet"
    },
    {
      "sha": "31d398cb13bd6d966ce3a46712c5b1f0bb0449de",
      "filename": "gdb/cli/cli-cmds.c",
      "status": "modified",
      "additions": 39,
      "deletions": 0,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/61fb73769a0168afa466bb2245a1a233942203bb/gdb/cli/cli-cmds.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/61fb73769a0168afa466bb2245a1a233942203bb/gdb/cli/cli-cmds.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-cmds.c?ref=61fb73769a0168afa466bb2245a1a233942203bb",
      "patch": "@@ -192,6 +192,11 @@ static const char *const script_ext_enums[] = {\n \n static const char *script_ext_mode = script_ext_soft;\n \f\n+\n+/* User-controllable flag to suppress event notification on CLI.  */\n+\n+static bool user_wants_cli_suppress_notification = false;\n+\n /* Utility used everywhere when at least one argument is needed and\n    none is supplied.  */\n \n@@ -2136,6 +2141,28 @@ show_max_user_call_depth (struct ui_file *file, int from_tty,\n \t\t    value);\n }\n \n+/* Implement 'show suppress-cli-notifications'.  */\n+\n+static void\n+show_suppress_cli_notifications (ui_file *file, int from_tty,\n+\t\t\t\t cmd_list_element *c, const char *value)\n+{\n+  fprintf_filtered (file, _(\"Suppression of printing CLI notifications \"\n+\t\t\t    \"is %s.\\n\"), value);\n+}\n+\n+/* Implement 'set suppress-cli-notifications'.  */\n+\n+static void\n+set_suppress_cli_notifications (const char *args, int from_tty,\n+\t\t\t\tcmd_list_element *c)\n+{\n+  cli_suppress_notification.user_selected_context\n+    = user_wants_cli_suppress_notification;\n+  cli_suppress_notification.normal_stop\n+    = user_wants_cli_suppress_notification;\n+}\n+\n /* Returns the cmd_list_element in SHOWLIST corresponding to the first\n    argument of ARGV, which must contain one single value.\n    Throws an error if no value provided, or value not correct.\n@@ -2734,6 +2761,18 @@ Make \\\"wLapPeu\\\" an alias of 2 nested \\\"with\\\":\\n\\\n \n   set_cmd_completer_handle_brkchars (c, alias_command_completer);\n \n+  add_setshow_boolean_cmd (\"suppress-cli-notifications\", no_class,\n+\t\t\t   &user_wants_cli_suppress_notification,\n+\t\t\t   _(\"\\\n+Set whether printing notifications on CLI is suppressed.\"), _(\"\\\n+Show whether printing notifications on CLI is suppressed.\"), _(\"\\\n+When on, printing notifications (such as inferior/thread switch)\\n\\\n+on CLI is suppressed.\"),\n+\t\t\t   set_suppress_cli_notifications,\n+\t\t\t   show_suppress_cli_notifications,\n+\t\t\t   &setlist,\n+\t\t\t   &showlist);\n+\n   const char *source_help_text = xstrprintf (_(\"\\\n Read commands from a file named FILE.\\n\\\n \\n\\"
    },
    {
      "sha": "8e7fb2d9020bfb4da8402577aec1f03b67686422",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 69,
      "deletions": 0,
      "changes": 69,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/61fb73769a0168afa466bb2245a1a233942203bb/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/61fb73769a0168afa466bb2245a1a233942203bb/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=61fb73769a0168afa466bb2245a1a233942203bb",
      "patch": "@@ -27211,6 +27211,75 @@ inside a cygwin window.\n Displays whether the debugger is operating in interactive mode or not.\n @end table\n \n+@table @code\n+@kindex set suppress-cli-notifications\n+@item set suppress-cli-notifications\n+If @code{on}, command-line-interface (CLI) notifications that are\n+printed by @value{GDBN} are suppressed.  If @code{off}, the\n+notifications are printed as usual.  The default value is @code{off}.\n+CLI notifications occur when you change the selected context or when\n+the program being debugged stops, as detailed below.\n+\n+@table @emph\n+@item User-selected context changes:\n+When you change the selected context (i.e.@: the current inferior,\n+thread and/or the frame), @value{GDBN} prints information about the\n+new context.  For example, the default behavior is below:\n+\n+@smallexample\n+(gdb) inferior 1\n+[Switching to inferior 1 [process 634] (/tmp/test)]\n+[Switching to thread 1 (process 634)]\n+#0  main () at test.c:3\n+3         return 0;\n+(gdb)\n+@end smallexample\n+\n+When the notifications are suppressed, the new context is not printed:\n+\n+@smallexample\n+(gdb) set suppress-cli-notifications on\n+(gdb) inferior 1\n+(gdb)\n+@end smallexample\n+\n+@item The program being debugged stops:\n+When the program you are debugging stops (e.g.@: because of hitting a\n+breakpoint, completing source-stepping, an interrupt, etc.),\n+@value{GDBN} prints information about the stop event.  For example,\n+below is a breakpoint hit:\n+\n+@smallexample\n+(gdb) break test.c:3\n+Breakpoint 2 at 0x555555555155: file test.c, line 3.\n+(gdb) continue\n+Continuing.\n+\n+Breakpoint 2, main () at test.c:3\n+3         return 0;\n+(gdb)\n+@end smallexample\n+\n+When the notifications are suppressed, the output becomes:\n+\n+@smallexample\n+(gdb) break test.c:3\n+Breakpoint 2 at 0x555555555155: file test.c, line 3.\n+(gdb) set suppress-cli-notifications on\n+(gdb) continue\n+Continuing.\n+(gdb)\n+@end smallexample\n+\n+Suppressing CLI notifications may be useful in scripts to obtain a\n+reduced output from a list of commands.\n+@end table\n+\n+@kindex show suppress-cli-notifications\n+@item show suppress-cli-notifications\n+Displays whether printing CLI notifications is suppressed or not.\n+@end table\n+\n @node Extending GDB\n @chapter Extending @value{GDBN}\n @cindex extending GDB"
    },
    {
      "sha": "243dbc9c70aebbcb21c8bdfb675e5f8ca0f95ea8",
      "filename": "gdb/testsuite/gdb.base/cli-suppress-notification.c",
      "status": "added",
      "additions": 26,
      "deletions": 0,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/61fb73769a0168afa466bb2245a1a233942203bb/gdb/testsuite/gdb.base/cli-suppress-notification.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/61fb73769a0168afa466bb2245a1a233942203bb/gdb/testsuite/gdb.base/cli-suppress-notification.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/cli-suppress-notification.c?ref=61fb73769a0168afa466bb2245a1a233942203bb",
      "patch": "@@ -0,0 +1,26 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2020-2022 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+static int global = 0;\n+\n+int\n+main ()\n+{\n+  global++;\n+  global++;\n+  return 0;\n+}"
    },
    {
      "sha": "1e4cc9869e4909501615629692ced717fb4e9fca",
      "filename": "gdb/testsuite/gdb.base/cli-suppress-notification.exp",
      "status": "added",
      "additions": 39,
      "deletions": 0,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/61fb73769a0168afa466bb2245a1a233942203bb/gdb/testsuite/gdb.base/cli-suppress-notification.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/61fb73769a0168afa466bb2245a1a233942203bb/gdb/testsuite/gdb.base/cli-suppress-notification.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/cli-suppress-notification.exp?ref=61fb73769a0168afa466bb2245a1a233942203bb",
      "patch": "@@ -0,0 +1,39 @@\n+# Copyright 2020-2022 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# Test the set/show suppress-cli-notifications command.\n+\n+standard_testfile\n+\n+if {[prepare_for_testing \"failed to prepare\" ${binfile} ${srcfile}]} {\n+    return\n+}\n+\n+if {![runto_main]} {\n+    return\n+}\n+\n+gdb_test \"inferior 1\" \".*Switching to inferior 1 .* to thread 1 .*\" \\\n+    \"inferior switch is not suppressed\"\n+\n+gdb_test_no_output \"set suppress-cli-notifications on\"\n+gdb_test_no_output \"inferior 1\" \"inferior switch is suppressed\"\n+gdb_test_no_output \"next\" \"stepping is suppressed\"\n+\n+# Now check that suppression can be turned back off.\n+gdb_test_no_output \"set suppress-cli-notifications off\"\n+gdb_test \"inferior 1\" \".*Switching to inferior 1 .* to thread 1 .*\" \\\n+    \"inferior switch is not suppressed again\"\n+gdb_test \"next\" \"return 0;\" \"stepping is not suppressed\""
    }
  ]
}