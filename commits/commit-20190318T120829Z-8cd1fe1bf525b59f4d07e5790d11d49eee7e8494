{
  "sha": "8cd1fe1bf525b59f4d07e5790d11d49eee7e8494",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGNkMWZlMWJmNTI1YjU5ZjRkMDdlNTc5MGQxMWQ0OWVlZTdlODQ5NA==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-03-18T11:08:36Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-03-18T12:08:29Z"
    },
    "message": "PR24355, segmentation fault in function called from ppc_finish_symbols\n\nThis one looks to be a bug going back to 2009, git commit e054468f6c\n\"STT_GNU_IFUNC support for PowerPC\".  That bug was carried over with\ngit commit 49c09209d0 \"Rearrange PLT reloc output on powerpc\".\n\nIf the refcount for an ifunc local sym plt entry was zero,\nppc_elf_size_dynamic_sections would correctly set plt.offset to -1 but\nleave glink_offset uninitialized.  That leads to occasional segfaults\n(which can be made solid with MALLOC_PERTURB_=1 when using glibc).\nSo, guard the write_glink_stub call with plt.offset != -1.  Also,\nremove the totally ineffective attempt at writing multiple-use glink\nstubs only once.\n\n\tPR 24355\n\t* elf32-ppc.c (ppc_finish_symbols): Don't call write_glink_stub\n\tfor local iplt syms with ent->plt.offset == -1.  Remove ineffective\n\tattempt at writing glink stubs only once.",
    "tree": {
      "sha": "b54654c1967d9cc2a3693e727a77f5e7114987ad",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b54654c1967d9cc2a3693e727a77f5e7114987ad"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "28a66f07f0695c740dc0e1b043cd36f90dbfb5ea",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/28a66f07f0695c740dc0e1b043cd36f90dbfb5ea",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/28a66f07f0695c740dc0e1b043cd36f90dbfb5ea"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 9,
    "deletions": 6
  },
  "files": [
    {
      "sha": "9cdd4fe176728c448d1ec9a3dcc20424531af544",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=8cd1fe1bf525b59f4d07e5790d11d49eee7e8494",
      "patch": "@@ -1,3 +1,10 @@\n+2019-03-18  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 24355\n+\t* elf32-ppc.c (ppc_finish_symbols): Don't call write_glink_stub\n+\tfor local iplt syms with ent->plt.offset == -1.  Remove ineffective\n+\tattempt at writing glink stubs only once.\n+\n 2019-03-16  Alan Modra  <amodra@gmail.com>\n \n \tPR 24337"
    },
    {
      "sha": "6991e8ddc1e544d0d9aea6f4abe48b11a8ea3128",
      "filename": "bfd/elf32-ppc.c",
      "status": "modified",
      "additions": 2,
      "deletions": 6,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494/bfd/elf32-ppc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8cd1fe1bf525b59f4d07e5790d11d49eee7e8494/bfd/elf32-ppc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-ppc.c?ref=8cd1fe1bf525b59f4d07e5790d11d49eee7e8494",
      "patch": "@@ -9704,6 +9704,7 @@ ppc_finish_symbols (struct bfd_link_info *info)\n \t\tbfd_byte *loc;\n \t\tbfd_vma val;\n \t\tElf_Internal_Rela rela;\n+\t\tunsigned char *p;\n \n \t\tif (!get_sym_h (NULL, &sym, &sym_sec, NULL, &local_syms,\n \t\t\t\tlplt - local_plt, ibfd))\n@@ -9748,14 +9749,9 @@ ppc_finish_symbols (struct bfd_link_info *info)\n \t\tloc = relplt->contents + (relplt->reloc_count++\n \t\t\t\t\t  * sizeof (Elf32_External_Rela));\n \t\tbfd_elf32_swap_reloca_out (info->output_bfd, &rela, loc);\n-\t      }\n-\t    if ((ent->glink_offset & 1) == 0)\n-\t      {\n-\t\tunsigned char *p = ((unsigned char *) htab->glink->contents\n-\t\t\t\t    + ent->glink_offset);\n \n+\t\tp = (unsigned char *) htab->glink->contents + ent->glink_offset;\n \t\twrite_glink_stub (NULL, ent, htab->elf.iplt, p, info);\n-\t\tent->glink_offset |= 1;\n \t      }\n \t  }\n "
    }
  ]
}