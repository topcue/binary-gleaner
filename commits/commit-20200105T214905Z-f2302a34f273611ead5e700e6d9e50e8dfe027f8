{
  "sha": "f2302a34f273611ead5e700e6d9e50e8dfe027f8",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjIzMDJhMzRmMjczNjExZWFkNWU3MDBlNmQ5ZTUwZThkZmUwMjdmOA==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-12-22T23:45:31Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-01-05T21:49:05Z"
    },
    "message": "gdb: use tui_set_layout not show_layout to fix window focus\n\nWhen calling tui_add_win_to_layout, use tui_set_layout not show_layout\nso that window focus is correctly updated.  If the focus is not\ncorrectly maintained then GDB can be crashed like this:\n\n  start\n  tui enable\n  layout asm\n  list SOME_FUNCTION\n\nAt this point GDB will have \"popped up\" the source window to\ndisplay SOME_FUNCTION.  Previously no window would have focus at this\npoint, and so if the user now does 'focus next' or 'focus prev', then\nGDB would crash.\n\nCalling tui_set_layout ensures that focus is correctly calculated as\nthe source window is \"popped up\", and this fixes the issue.\n\ngdb/ChangeLog:\n\n\t* tui/tui-layout.c (tui_add_win_to_layout): Use tui_set_layout not\n\tshow_layout.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.tui/list.exp: Test 'focus next' after 'list main'.\n\nChange-Id: Id0b13f99b0e889261efedfd0adabe82020202f44",
    "tree": {
      "sha": "c5e7ede305c65d95e8cc3057c6a45e18c96dd529",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c5e7ede305c65d95e8cc3057c6a45e18c96dd529"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f2302a34f273611ead5e700e6d9e50e8dfe027f8",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f2302a34f273611ead5e700e6d9e50e8dfe027f8",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f2302a34f273611ead5e700e6d9e50e8dfe027f8",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f2302a34f273611ead5e700e6d9e50e8dfe027f8/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6a5206eb2740e769bcb0500bdbc5998801d90ef6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6a5206eb2740e769bcb0500bdbc5998801d90ef6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6a5206eb2740e769bcb0500bdbc5998801d90ef6"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 18,
    "deletions": 6
  },
  "files": [
    {
      "sha": "c24dccaaa97cf90806296b5691526cf7126281da",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=f2302a34f273611ead5e700e6d9e50e8dfe027f8",
      "patch": "@@ -1,3 +1,8 @@\n+2020-01-05  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* tui/tui-layout.c (tui_add_win_to_layout): Use tui_set_layout not\n+\tshow_layout.\n+\n 2020-01-05  Luis Machado  <luis.machado@linaro.org>\n \n \t* aarch64-linux-nat.c"
    },
    {
      "sha": "ba857a46f3b6299a9ceb4cb96dffa67a8ff123f0",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=f2302a34f273611ead5e700e6d9e50e8dfe027f8",
      "patch": "@@ -1,3 +1,7 @@\n+2020-01-05  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.tui/list.exp: Test 'focus next' after 'list main'.\n+\n 2020-01-03  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n \n \t* gdb.base/style.exp: Test that warnings are styled."
    },
    {
      "sha": "41cec125d534dcaa3cc62d7c4eeaf335eed244f9",
      "filename": "gdb/testsuite/gdb.tui/list.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/testsuite/gdb.tui/list.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/testsuite/gdb.tui/list.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.tui/list.exp?ref=f2302a34f273611ead5e700e6d9e50e8dfe027f8",
      "patch": "@@ -35,3 +35,6 @@ Term::check_contents \"asm window shows main\" \"$hex <main>\"\n \n Term::command \"list main\"\n Term::check_contents \"list main\" \"21 *return 0\"\n+# The following 'focus next' must be immediately after 'list main' to\n+# ensure that GDB has a valid idea of what is currently focused.\n+Term::command \"focus next\""
    },
    {
      "sha": "3720d3edc3c2810c002a2272556d0663efa8d4bd",
      "filename": "gdb/tui/tui-layout.c",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/tui/tui-layout.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f2302a34f273611ead5e700e6d9e50e8dfe027f8/gdb/tui/tui-layout.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-layout.c?ref=f2302a34f273611ead5e700e6d9e50e8dfe027f8",
      "patch": "@@ -201,9 +201,9 @@ tui_add_win_to_layout (enum tui_win_type type)\n \t  && cur_layout != SRC_DATA_COMMAND)\n \t{\n \t  if (cur_layout == DISASSEM_DATA_COMMAND)\n-\t    show_layout (SRC_DATA_COMMAND);\n+\t    tui_set_layout (SRC_DATA_COMMAND);\n \t  else\n-\t    show_layout (SRC_COMMAND);\n+\t    tui_set_layout (SRC_COMMAND);\n \t}\n       break;\n     case DISASSEM_WIN:\n@@ -212,19 +212,19 @@ tui_add_win_to_layout (enum tui_win_type type)\n \t  && cur_layout != DISASSEM_DATA_COMMAND)\n \t{\n \t  if (cur_layout == SRC_DATA_COMMAND)\n-\t    show_layout (DISASSEM_DATA_COMMAND);\n+\t    tui_set_layout (DISASSEM_DATA_COMMAND);\n \t  else\n-\t    show_layout (DISASSEM_COMMAND);\n+\t    tui_set_layout (DISASSEM_COMMAND);\n \t}\n       break;\n     case DATA_WIN:\n       if (cur_layout != SRC_DATA_COMMAND\n \t  && cur_layout != DISASSEM_DATA_COMMAND)\n \t{\n \t  if (cur_layout == DISASSEM_COMMAND)\n-\t    show_layout (DISASSEM_DATA_COMMAND);\n+\t    tui_set_layout (DISASSEM_DATA_COMMAND);\n \t  else\n-\t    show_layout (SRC_DATA_COMMAND);\n+\t    tui_set_layout (SRC_DATA_COMMAND);\n \t}\n       break;\n     default:"
    }
  ]
}