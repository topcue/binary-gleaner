{
  "sha": "6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmYyNjQzZGJkMjE5MmU2ZmZmNzdhNWU2ZmVjNTE0MWQyMDlmZDdkMA==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-16T15:31:16Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-17T10:11:51Z"
    },
    "message": "gdb/arc: fix print_one_insn selftest\n\nI noticed that the ARC print_one_insn selftest was failing.  The\nproblem is that in print_one_insn_test the arc case falls through into\nthe special case that handles nios2, score, and riscv.\n\nThe special case for these targets hard codes the breakpoint kind to\n'4'.  This is find for bare metal arc (see arc-tdep.c,\narc_sw_breakpoint_from_kind), however, for arc/linux only breakpoint\nkind '2' is supported (see arc-linux-tdep.c,\narc_linux_sw_breakpoint_from_kind).\n\nSo the code in print_one_insn_test as it is currently written passed\nin an invalid breakpoint kind, this leads to GDB trying to disassemble\nunexpected memory.\n\nThe fix is to reorder the code in print_one_insn_test so that the arc\ncase falls through into the default case.  In the default we no longer\nhard code the breakpoint kind, and everything should be good.\n\nAdditionally, given the arc code only expects specific breakpoint kind\nvalues, I thought it would be nice to add some gdb_assert to validate\nthings.  This assert would have triggered in this case and made it\neasier to find the error.\n\nAfter this commit, configure GDB with --enable-targets=all, then run\ngdb.gdb/unittest.exp, there should no longer be any failures.\n\ngdb/ChangeLog:\n\n\t* arc-linux-tdep.c (arc_linux_sw_breakpoint_from_kind): Add an\n\tassert.\n\t* arc-tdep.c (arc_breakpoint_kind_from_pc): Likewise.\n\t* disasm-selftests.c (print_one_insn_test): Fall throough from ARC\n\tcase to the default.",
    "tree": {
      "sha": "3ad5db07128c45af50b909d3b7e7f868ef26f1c7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3ad5db07128c45af50b909d3b7e7f868ef26f1c7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c72e313608b86c45a822d385ea5bc7acd3b6582c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c72e313608b86c45a822d385ea5bc7acd3b6582c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c72e313608b86c45a822d385ea5bc7acd3b6582c"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 15,
    "deletions": 5
  },
  "files": [
    {
      "sha": "a887a83e0811c48052685bfcdfa3a832d5984f58",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
      "patch": "@@ -1,3 +1,11 @@\n+2020-11-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* arc-linux-tdep.c (arc_linux_sw_breakpoint_from_kind): Add an\n+\tassert.\n+\t* arc-tdep.c (arc_breakpoint_kind_from_pc): Likewise.\n+\t* disasm-selftests.c (print_one_insn_test): Fall throough from ARC\n+\tcase to the default.\n+\n 2020-11-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* printcmd.c: Include 'safe-ctype.c'."
    },
    {
      "sha": "ef459bf596f07e0f15d2f781cbe790fea3353a4c",
      "filename": "gdb/arc-linux-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/arc-linux-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/arc-linux-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arc-linux-tdep.c?ref=6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
      "patch": "@@ -149,6 +149,7 @@ static const gdb_byte *\n arc_linux_sw_breakpoint_from_kind (struct gdbarch *gdbarch,\n \t\t\t\t   int kind, int *size)\n {\n+  gdb_assert (kind == trap_size);\n   *size = kind;\n   return ((gdbarch_byte_order (gdbarch) == BFD_ENDIAN_BIG)\n \t  ? arc_linux_trap_s_be"
    },
    {
      "sha": "d18d3bcdf2d02c4f59f452305ed86f1733bbda78",
      "filename": "gdb/arc-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/arc-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/arc-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arc-tdep.c?ref=6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
      "patch": "@@ -1634,6 +1634,7 @@ arc_breakpoint_kind_from_pc (struct gdbarch *gdbarch, CORE_ADDR *pcptr)\n static const gdb_byte *\n arc_sw_breakpoint_from_kind (struct gdbarch *gdbarch, int kind, int *size)\n {\n+  gdb_assert (kind == 2 || kind == 4);\n   *size = kind;\n \n   if (kind == sizeof (arc_brk_le))"
    },
    {
      "sha": "f8f999351a3b6abdc5f79ab3a67ea09a3fff558d",
      "filename": "gdb/disasm-selftests.c",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/disasm-selftests.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6f2643dbd2192e6fff77a5e6fec5141d209fd7d0/gdb/disasm-selftests.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/disasm-selftests.c?ref=6f2643dbd2192e6fff77a5e6fec5141d209fd7d0",
      "patch": "@@ -69,11 +69,6 @@ print_one_insn_test (struct gdbarch *gdbarch)\n       insn = xstormy16_insn;\n       len = sizeof (xstormy16_insn);\n       break;\n-    case bfd_arch_arc:\n-      /* PR 21003 */\n-      if (gdbarch_bfd_arch_info (gdbarch)->mach == bfd_mach_arc_arc601)\n-\treturn;\n-      /* fall through */\n     case bfd_arch_nios2:\n     case bfd_arch_score:\n     case bfd_arch_riscv:\n@@ -86,6 +81,11 @@ print_one_insn_test (struct gdbarch *gdbarch)\n \tlen = bplen;\n       }\n       break;\n+    case bfd_arch_arc:\n+      /* PR 21003 */\n+      if (gdbarch_bfd_arch_info (gdbarch)->mach == bfd_mach_arc_arc601)\n+\treturn;\n+      /* fall through */\n     default:\n       {\n \t/* Test disassemble breakpoint instruction.  */"
    }
  ]
}