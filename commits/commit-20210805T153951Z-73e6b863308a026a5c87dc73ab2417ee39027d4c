{
  "sha": "73e6b863308a026a5c87dc73ab2417ee39027d4c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzNlNmI4NjMzMDhhMDI2YTVjODdkYzczYWIyNDE3ZWUzOTAyN2Q0Yw==",
  "commit": {
    "author": {
      "name": "Zoran Zaric",
      "email": "Zoran.Zaric@amd.com",
      "date": "2020-10-09T12:25:10Z"
    },
    "committer": {
      "name": "Zoran Zaric",
      "email": "zoran.zaric@amd.com",
      "date": "2021-08-05T15:39:51Z"
    },
    "message": "Move get_object_address to dwarf_expr_context\n\nFollowing the idea of merging the evaluators, the get_object_address\nand can be moved from dwarf_expr_executor and dwarf_evaluate_loc_desc\nclasses to their base class dwarf_expr_context.\n\ngdb/ChangeLog:\n\n\t* dwarf2/expr.c (dwarf_expr_context::get_object_address): Move\n\tfrom dwarf_evaluate_loc_desc.\n\t(class dwarf_expr_context): Add object address member to\n\tdwarf_expr_context.\n\t* dwarf2/expr.h (dwarf_expr_context::get_frame_pc): Remove\n\tmethod.\n\t* dwarf2/frame.c (dwarf_expr_executor::get_object_address):\n\tRemove method.\n\t* dwarf2/loc.c (dwarf_evaluate_loc_desc::get_object_address):\n\tmove to dwarf_expr_context.\n\t(class dwarf_evaluate_loc_desc): Move object address member to\n\tdwarf_expr_context.",
    "tree": {
      "sha": "ade78d0214d645150fd8924406669dae4bc12702",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ade78d0214d645150fd8924406669dae4bc12702"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/73e6b863308a026a5c87dc73ab2417ee39027d4c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/73e6b863308a026a5c87dc73ab2417ee39027d4c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/73e6b863308a026a5c87dc73ab2417ee39027d4c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/73e6b863308a026a5c87dc73ab2417ee39027d4c/comments",
  "author": {
    "login": "ZaricZoran",
    "id": 81635026,
    "node_id": "MDQ6VXNlcjgxNjM1MDI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/81635026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZaricZoran",
    "html_url": "https://github.com/ZaricZoran",
    "followers_url": "https://api.github.com/users/ZaricZoran/followers",
    "following_url": "https://api.github.com/users/ZaricZoran/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZaricZoran/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZaricZoran/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZaricZoran/subscriptions",
    "organizations_url": "https://api.github.com/users/ZaricZoran/orgs",
    "repos_url": "https://api.github.com/users/ZaricZoran/repos",
    "events_url": "https://api.github.com/users/ZaricZoran/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZaricZoran/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ZaricZoran",
    "id": 81635026,
    "node_id": "MDQ6VXNlcjgxNjM1MDI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/81635026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZaricZoran",
    "html_url": "https://github.com/ZaricZoran",
    "followers_url": "https://api.github.com/users/ZaricZoran/followers",
    "following_url": "https://api.github.com/users/ZaricZoran/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZaricZoran/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZaricZoran/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZaricZoran/subscriptions",
    "organizations_url": "https://api.github.com/users/ZaricZoran/orgs",
    "repos_url": "https://api.github.com/users/ZaricZoran/repos",
    "events_url": "https://api.github.com/users/ZaricZoran/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZaricZoran/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b6d156edd8f2186445ff7b73dede720619a27d02",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b6d156edd8f2186445ff7b73dede720619a27d02",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b6d156edd8f2186445ff7b73dede720619a27d02"
    }
  ],
  "stats": {
    "total": 27,
    "additions": 9,
    "deletions": 18
  },
  "files": [
    {
      "sha": "d10bf9c78f3cdd9b1f4a31165008970b866cfeab",
      "filename": "gdb/dwarf2/expr.h",
      "status": "modified",
      "additions": 9,
      "deletions": 1,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/73e6b863308a026a5c87dc73ab2417ee39027d4c/gdb/dwarf2/expr.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/73e6b863308a026a5c87dc73ab2417ee39027d4c/gdb/dwarf2/expr.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/expr.h?ref=73e6b863308a026a5c87dc73ab2417ee39027d4c",
      "patch": "@@ -188,6 +188,9 @@ struct dwarf_expr_context\n   /* Compilation unit used for the evaluation.  */\n   dwarf2_per_cu_data *per_cu = nullptr;\n \n+  /* Object address used for the evaluation.  */\n+  CORE_ADDR obj_address = 0;\n+\n   /* Read LENGTH bytes at ADDR into BUF.  */\n   virtual void read_mem (gdb_byte *buf, CORE_ADDR addr, size_t length) = 0;\n \n@@ -200,7 +203,12 @@ struct dwarf_expr_context\n \t\t\t\t\t   int deref_size) = 0;\n \n   /* Return the `object address' for DW_OP_push_object_address.  */\n-  virtual CORE_ADDR get_object_address () = 0;\n+  virtual CORE_ADDR get_object_address ()\n+  {\n+    if (obj_address == 0)\n+      error (_(\"Location address is not set.\"));\n+    return obj_address;\n+  }\n \n private:\n "
    },
    {
      "sha": "37d3a4056fba67c1cf8a549193542785a22b1009",
      "filename": "gdb/dwarf2/frame.c",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/73e6b863308a026a5c87dc73ab2417ee39027d4c/gdb/dwarf2/frame.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/73e6b863308a026a5c87dc73ab2417ee39027d4c/gdb/dwarf2/frame.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/frame.c?ref=73e6b863308a026a5c87dc73ab2417ee39027d4c",
      "patch": "@@ -244,11 +244,6 @@ class dwarf_expr_executor : public dwarf_expr_context\n     invalid (\"DW_OP_entry_value\");\n   }\n \n-  CORE_ADDR get_object_address () override\n-  {\n-    invalid (\"DW_OP_push_object_address\");\n-  }\n-\n  private:\n \n   void invalid (const char *op) ATTRIBUTE_NORETURN"
    },
    {
      "sha": "217d74c08ef64a5524bc1127174dbf22ae7eb241",
      "filename": "gdb/dwarf2/loc.c",
      "status": "modified",
      "additions": 0,
      "deletions": 12,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/73e6b863308a026a5c87dc73ab2417ee39027d4c/gdb/dwarf2/loc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/73e6b863308a026a5c87dc73ab2417ee39027d4c/gdb/dwarf2/loc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/loc.c?ref=73e6b863308a026a5c87dc73ab2417ee39027d4c",
      "patch": "@@ -674,18 +674,6 @@ class dwarf_evaluate_loc_desc : public dwarf_expr_context\n     : dwarf_expr_context (per_objfile)\n   {}\n \n-  CORE_ADDR obj_address;\n-\n-  /* Callback function for get_object_address. Return the address of the VLA\n-     object.  */\n-\n-  CORE_ADDR get_object_address () override\n-  {\n-    if (obj_address == 0)\n-      error (_(\"Location address is not set.\"));\n-    return obj_address;\n-  }\n-\n   /* Execute DWARF block of call_site_parameter which matches KIND and\n      KIND_U.  Choose DEREF_SIZE value of that parameter.  Search\n      caller of this objects's frame."
    }
  ]
}