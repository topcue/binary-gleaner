{
  "sha": "be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
  "node_id": "C_kwDOANOeidoAKGJlNzdkZDczYzc2OWIzZTdhYzYyYmQ0YzBiOTgyNDJiNjJkMDgwZTA",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-06-04T22:00:33Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-11-05T19:58:48Z"
    },
    "message": "Introduce make_unique_xstrndup\n\nThis adds a new make_unique_xstrndup function, which is the \"n\"\nanalogue of make_unique_xstrdup.  It also updates a couple existing\nplaces to use this function.",
    "tree": {
      "sha": "42467dc2ff4b18810660886835c51503b6ffacb7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/42467dc2ff4b18810660886835c51503b6ffacb7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8a89ddbda2ecb41be0f12142e5d4b95c7bd5a138",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8a89ddbda2ecb41be0f12142e5d4b95c7bd5a138",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8a89ddbda2ecb41be0f12142e5d4b95c7bd5a138"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 14,
    "deletions": 5
  },
  "files": [
    {
      "sha": "18e2d4ed5c8245bf2f7863066b456012cc92b830",
      "filename": "gdb/cli/cli-setshow.c",
      "status": "modified",
      "additions": 3,
      "deletions": 4,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/gdb/cli/cli-setshow.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/gdb/cli/cli-setshow.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-setshow.c?ref=be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
      "patch": "@@ -375,14 +375,13 @@ do_set_command (const char *arg, int from_tty, struct cmd_list_element *c)\n \t  {\n \t    /* Clear trailing whitespace of filename.  */\n \t    const char *ptr = arg + strlen (arg) - 1;\n-\t    char *copy;\n \n \t    while (ptr >= arg && (*ptr == ' ' || *ptr == '\\t'))\n \t      ptr--;\n-\t    copy = xstrndup (arg, ptr + 1 - arg);\n+\t    gdb::unique_xmalloc_ptr<char> copy\n+\t      = make_unique_xstrndup (arg, ptr + 1 - arg);\n \n-\t    val = tilde_expand (copy);\n-\t    xfree (copy);\n+\t    val = tilde_expand (copy.get ());\n \t  }\n \telse\n \t  val = xstrdup (\"\");"
    },
    {
      "sha": "a76a6c1afdbc2730f4bfbda05e08b76449217caf",
      "filename": "gdb/parse.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/gdb/parse.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/gdb/parse.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/parse.c?ref=be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
      "patch": "@@ -199,7 +199,8 @@ parser_state::mark_completion_tag (enum type_code tag, const char *ptr,\n \t      || tag == TYPE_CODE_STRUCT\n \t      || tag == TYPE_CODE_ENUM);\n   m_completion_state.expout_tag_completion_type = tag;\n-  m_completion_state.expout_completion_name.reset (xstrndup (ptr, length));\n+  m_completion_state.expout_completion_name\n+    = make_unique_xstrndup (ptr, length);\n }\n \n /* See parser-defs.h.  */"
    },
    {
      "sha": "77aecb48e62959077f982bd8e04ffd4e5fed0d49",
      "filename": "gdbsupport/gdb_unique_ptr.h",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/gdbsupport/gdb_unique_ptr.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be77dd73c769b3e7ac62bd4c0b98242b62d080e0/gdbsupport/gdb_unique_ptr.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/gdb_unique_ptr.h?ref=be77dd73c769b3e7ac62bd4c0b98242b62d080e0",
      "patch": "@@ -64,4 +64,13 @@ make_unique_xstrdup (const char *str)\n   return gdb::unique_xmalloc_ptr<char> (xstrdup (str));\n }\n \n+/* Dup the first N characters of STR and return a unique_xmalloc_ptr\n+   for the result.  The result is always \\0-terminated.  */\n+\n+static inline gdb::unique_xmalloc_ptr<char>\n+make_unique_xstrndup (const char *str, size_t n)\n+{\n+  return gdb::unique_xmalloc_ptr<char> (xstrndup (str, n));\n+}\n+\n #endif /* COMMON_GDB_UNIQUE_PTR_H */"
    }
  ]
}