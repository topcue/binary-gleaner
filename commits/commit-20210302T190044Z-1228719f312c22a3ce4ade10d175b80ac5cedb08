{
  "sha": "1228719f312c22a3ce4ade10d175b80ac5cedb08",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTIyODcxOWYzMTJjMjJhM2NlNGFkZTEwZDE3NWI4MGFjNWNlZGIwOA==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-03-02T18:57:01Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-03-02T19:00:44Z"
    },
    "message": "Check objfile->sf in ada-lang.c\n\nMost places in gdb that reference objfile->sf also check that it is\nnot null.  It is valid for it to be null, because find_sym_fns can\nreturn null for some kinds of object file.  However, it's rare to\nencounter this scenario with Ada code.  I only encountered it when\nlooking at a fork of gdb that, I believe, makes its own objfiles\nwithout setting 'sf'.\n\nThis patch changes ada-lang.c to check this field before using it.\nThis avoids any potential crash here.  There's no test case because\nI'm not even sure this is possible to trip over with an unmodified\ngdb.\n\nThere are some other unchecked uses in gdb, but at a quick glance they\nall seem to be involved with symbol reading, which of course won't\nhappen when sf==null.\n\ngdb/ChangeLog\n2021-03-02  Tom Tromey  <tromey@adacore.com>\n\n\t* ada-lang.c (add_nonlocal_symbols): Handle case where objfile->sf\n\tis null.",
    "tree": {
      "sha": "6d54243422cec0008c6fb60a7b77ea5aa09dc4de",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6d54243422cec0008c6fb60a7b77ea5aa09dc4de"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1228719f312c22a3ce4ade10d175b80ac5cedb08",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1228719f312c22a3ce4ade10d175b80ac5cedb08",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1228719f312c22a3ce4ade10d175b80ac5cedb08",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1228719f312c22a3ce4ade10d175b80ac5cedb08/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ca8f6bc629cb27792ce449e7253c74a3f6f75fda",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca8f6bc629cb27792ce449e7253c74a3f6f75fda",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ca8f6bc629cb27792ce449e7253c74a3f6f75fda"
    }
  ],
  "stats": {
    "total": 21,
    "additions": 14,
    "deletions": 7
  },
  "files": [
    {
      "sha": "d9d5b4f9cb7cc398345550b9b28aadaaef7d4b07",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1228719f312c22a3ce4ade10d175b80ac5cedb08/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1228719f312c22a3ce4ade10d175b80ac5cedb08/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=1228719f312c22a3ce4ade10d175b80ac5cedb08",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-02  Tom Tromey  <tromey@adacore.com>\n+\n+\t* ada-lang.c (add_nonlocal_symbols): Handle case where objfile->sf\n+\tis null.\n+\n 2021-02-27  Lancelot Six  <lsix@lancelotsix.com>\n \n \tPR gdb/27393"
    },
    {
      "sha": "91a2a5ce1df84466cfd0dc3ea1195da21732b755",
      "filename": "gdb/ada-lang.c",
      "status": "modified",
      "additions": 9,
      "deletions": 7,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1228719f312c22a3ce4ade10d175b80ac5cedb08/gdb/ada-lang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1228719f312c22a3ce4ade10d175b80ac5cedb08/gdb/ada-lang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ada-lang.c?ref=1228719f312c22a3ce4ade10d175b80ac5cedb08",
      "patch": "@@ -5629,10 +5629,11 @@ add_nonlocal_symbols (struct obstack *obstackp,\n     {\n       data.objfile = objfile;\n \n-      objfile->sf->qf->map_matching_symbols (objfile, lookup_name,\n-\t\t\t\t\t     domain, global, callback,\n-\t\t\t\t\t     (is_wild_match\n-\t\t\t\t\t      ? NULL : compare_names));\n+      if (objfile->sf != nullptr)\n+\tobjfile->sf->qf->map_matching_symbols (objfile, lookup_name,\n+\t\t\t\t\t       domain, global, callback,\n+\t\t\t\t\t       (is_wild_match\n+\t\t\t\t\t\t? NULL : compare_names));\n \n       for (compunit_symtab *cu : objfile->compunits ())\n \t{\n@@ -5654,9 +5655,10 @@ add_nonlocal_symbols (struct obstack *obstackp,\n       for (objfile *objfile : current_program_space->objfiles ())\n \t{\n \t  data.objfile = objfile;\n-\t  objfile->sf->qf->map_matching_symbols (objfile, name1,\n-\t\t\t\t\t\t domain, global, callback,\n-\t\t\t\t\t\t compare_names);\n+\t  if (objfile->sf != nullptr)\n+\t    objfile->sf->qf->map_matching_symbols (objfile, name1,\n+\t\t\t\t\t\t   domain, global, callback,\n+\t\t\t\t\t\t   compare_names);\n \t}\n     }      \t\n }"
    }
  ]
}