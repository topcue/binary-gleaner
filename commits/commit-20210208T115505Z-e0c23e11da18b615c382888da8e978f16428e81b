{
  "sha": "e0c23e11da18b615c382888da8e978f16428e81b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTBjMjNlMTFkYTE4YjYxNWMzODI4ODhkYThlOTc4ZjE2NDI4ZTgxYg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-02-08T11:44:51Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-02-08T11:55:05Z"
    },
    "message": "gdb/python: don't allow the user to delete window title attributes\n\nThere's a bug in the python tui API.  If the user tries to delete the\nwindow title attribute then this will trigger undefined behaviour in\nGDB due to a missing nullptr check.\n\ngdb/ChangeLog:\n\n\t* python/py-tui.c (gdbpy_tui_set_title): Check that the new value\n\tfor the title is not nullptr.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.python/tui-window.exp: Add new tests.\n\t* gdb.python/tui-window.py (TestWindow) <__init__>: Store\n\tTestWindow object into global the_window.\n\t<remote_title>: New method.\n\t(delete_window_title): New function.",
    "tree": {
      "sha": "92997a5c1c428d3efa2d645d75a0823903388d09",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/92997a5c1c428d3efa2d645d75a0823903388d09"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e0c23e11da18b615c382888da8e978f16428e81b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e0c23e11da18b615c382888da8e978f16428e81b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e0c23e11da18b615c382888da8e978f16428e81b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e0c23e11da18b615c382888da8e978f16428e81b/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1cf2399651ef3fe1350ad8276cf00d16ddeb9960",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1cf2399651ef3fe1350ad8276cf00d16ddeb9960",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1cf2399651ef3fe1350ad8276cf00d16ddeb9960"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 29,
    "deletions": 2
  },
  "files": [
    {
      "sha": "b7b4909f84bedb8ffd00ccb559d6ebaa1af89cf3",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0c23e11da18b615c382888da8e978f16428e81b/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0c23e11da18b615c382888da8e978f16428e81b/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=e0c23e11da18b615c382888da8e978f16428e81b",
      "patch": "@@ -1,3 +1,8 @@\n+2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* python/py-tui.c (gdbpy_tui_set_title): Check that the new value\n+\tfor the title is not nullptr.\n+\n 2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* tui-layout.c (saved_tui_windows): Delete."
    },
    {
      "sha": "73b73f33d4af6a078913f4ed6647530ac9c08ec9",
      "filename": "gdb/python/py-tui.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0c23e11da18b615c382888da8e978f16428e81b/gdb/python/py-tui.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0c23e11da18b615c382888da8e978f16428e81b/gdb/python/py-tui.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/py-tui.c?ref=e0c23e11da18b615c382888da8e978f16428e81b",
      "patch": "@@ -434,7 +434,7 @@ gdbpy_tui_set_title (PyObject *self, PyObject *newvalue, void *closure)\n       return -1;\n     }\n \n-  if (win->window == nullptr)\n+  if (newvalue == nullptr)\n     {\n       PyErr_Format (PyExc_TypeError, _(\"Cannot delete \\\"title\\\" attribute.\"));\n       return -1;"
    },
    {
      "sha": "faee2c426379f216516ecee5754b6326dcbe4ce6",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0c23e11da18b615c382888da8e978f16428e81b/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0c23e11da18b615c382888da8e978f16428e81b/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=e0c23e11da18b615c382888da8e978f16428e81b",
      "patch": "@@ -1,3 +1,11 @@\n+2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.python/tui-window.exp: Add new tests.\n+\t* gdb.python/tui-window.py (TestWindow) <__init__>: Store\n+\tTestWindow object into global the_window.\n+\t<remote_title>: New method.\n+\t(delete_window_title): New function.\n+\n 2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.tui/winheight.exp: Add more tests."
    },
    {
      "sha": "8d86afb14496bbf732c9bdd91c9cdf0a93c65d8e",
      "filename": "gdb/testsuite/gdb.python/tui-window.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0c23e11da18b615c382888da8e978f16428e81b/gdb/testsuite/gdb.python/tui-window.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0c23e11da18b615c382888da8e978f16428e81b/gdb/testsuite/gdb.python/tui-window.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/tui-window.exp?ref=e0c23e11da18b615c382888da8e978f16428e81b",
      "patch": "@@ -47,6 +47,12 @@ Term::check_contents \"test title\" \\\n     \"This Is The Title\"\n Term::check_contents \"Window display\" \"Test: 0\"\n \n+Term::command \"python delete_window_title ()\"\n+Term::check_contents \"error message after trying to delete title\" \\\n+    \"TypeError: Cannot delete \\\"title\\\" attribute\\\\.\"\n+Term::check_contents \"title is unchanged\" \\\n+    \"This Is The Title\"\n+\n Term::resize 51 51\n # Remember that a resize request actually does two resizes...\n Term::check_contents \"Window was updated\" \"Test: 2\""
    },
    {
      "sha": "3bea78846ae86198240d143586e9c1b1982e5f3e",
      "filename": "gdb/testsuite/gdb.python/tui-window.py",
      "status": "modified",
      "additions": 9,
      "deletions": 1,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0c23e11da18b615c382888da8e978f16428e81b/gdb/testsuite/gdb.python/tui-window.py",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0c23e11da18b615c382888da8e978f16428e81b/gdb/testsuite/gdb.python/tui-window.py",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/tui-window.py?ref=e0c23e11da18b615c382888da8e978f16428e81b",
      "patch": "@@ -22,7 +22,7 @@\n class TestWindow:\n     def __init__(self, win):\n         global the_window\n-        the_window = win\n+        the_window = self\n         self.count = 0\n         self.win = win\n         win.title = \"This Is The Title\"\n@@ -34,8 +34,16 @@ def render(self):\n         self.win.write(\"Test: \" + str(self.count) + \" \" + str(w) + \"x\" + str(h))\n         self.count = self.count + 1\n \n+    # Tries to delete the title attribute.  GDB will throw an error.\n+    def remove_title(self):\n+        del self.win.title\n+\n gdb.register_window_type(\"test\", TestWindow)\n \n+# Call REMOVE_TITLE on the global window object.\n+def delete_window_title ():\n+    the_window.remove_title ()\n+\n # A TUI window \"constructor\" that always fails.\n def failwin(win):\n     raise RuntimeError(\"Whoops\")"
    }
  ]
}