{
  "sha": "a76ef689b60405e494cb99e198acf3c82f467f7d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTc2ZWY2ODliNjA0MDVlNDk0Y2I5OWUxOThhY2YzYzgyZjQ2N2Y3ZA==",
  "commit": {
    "author": {
      "name": "Stafford Horne",
      "email": "shorne@gmail.com",
      "date": "2021-05-06T11:51:24Z"
    },
    "committer": {
      "name": "Stafford Horne",
      "email": "shorne@gmail.com",
      "date": "2021-05-06T11:51:24Z"
    },
    "message": "or1k: Fix issue with plt link failure for local calls\n\nWhen building protobuf we were seeing the assert failure:\n\n    /home/giuliobenetti/git/upstream/or1k-binutils-2.36.1/host/lib/gcc/or1k-buildroot-linux-uclibc/9.3.0/../../../../or1k-buildroot-linux-uclibc/bin/ld:\n    BFD (GNU Binutils) 2.36.1 assertion fail elf32-or1k.c:2377\n    /home/giuliobenetti/git/upstream/or1k-binutils-2.36.1/host/lib/gcc/or1k-buildroot-linux-uclibc/9.3.0/../../../../or1k-buildroot-linux-uclibc/bin/ld:\n    BFD (GNU Binutils) 2.36.1 assertion fail elf32-or1k.c:2377\n    /home/giuliobenetti/git/upstream/or1k-binutils-2.36.1/host/lib/gcc/or1k-buildroot-linux-uclibc/9.3.0/../../../../or1k-buildroot-linux-uclibc/bin/ld:\n    BFD (GNU Binutils) 2.36.1 assertion fail elf32-or1k.c:2377\n    collect2: error: ld returned 1 exit status\n\nThis failure happens while writing out PLT entries, there is a check\n\"BFD_ASSERT (h->dynindx != -1)\" to confirm all plt entries have dynamic\nsymbol attributes.  This was failing for symbols that were\n\"forced_local\" in previous linking code.\n\nThe fix adds logic to or1k_elf_adjust_dynamic_symbol to identify\n\"forced_local\" symbols and exclude them from the the PLT.\n\nbfd/ChangeLog:\n\n\tPR 27624\n\t* elf32-or1k.c (or1k_elf_adjust_dynamic_symbol): Change\n\tcondition used to cleanup plt entries to cleanup forced local\n\tentries.\n\nCc: Giulio Benetti <giulio.benetti@benettiengineering.com>",
    "tree": {
      "sha": "71bb36376cb73095505f6e0fb06dbc58bc4dac52",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/71bb36376cb73095505f6e0fb06dbc58bc4dac52"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a76ef689b60405e494cb99e198acf3c82f467f7d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a76ef689b60405e494cb99e198acf3c82f467f7d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a76ef689b60405e494cb99e198acf3c82f467f7d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a76ef689b60405e494cb99e198acf3c82f467f7d/comments",
  "author": {
    "login": "stffrdhrn",
    "id": 2404255,
    "node_id": "MDQ6VXNlcjI0MDQyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2404255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stffrdhrn",
    "html_url": "https://github.com/stffrdhrn",
    "followers_url": "https://api.github.com/users/stffrdhrn/followers",
    "following_url": "https://api.github.com/users/stffrdhrn/following{/other_user}",
    "gists_url": "https://api.github.com/users/stffrdhrn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stffrdhrn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stffrdhrn/subscriptions",
    "organizations_url": "https://api.github.com/users/stffrdhrn/orgs",
    "repos_url": "https://api.github.com/users/stffrdhrn/repos",
    "events_url": "https://api.github.com/users/stffrdhrn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stffrdhrn/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "stffrdhrn",
    "id": 2404255,
    "node_id": "MDQ6VXNlcjI0MDQyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2404255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stffrdhrn",
    "html_url": "https://github.com/stffrdhrn",
    "followers_url": "https://api.github.com/users/stffrdhrn/followers",
    "following_url": "https://api.github.com/users/stffrdhrn/following{/other_user}",
    "gists_url": "https://api.github.com/users/stffrdhrn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stffrdhrn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stffrdhrn/subscriptions",
    "organizations_url": "https://api.github.com/users/stffrdhrn/orgs",
    "repos_url": "https://api.github.com/users/stffrdhrn/repos",
    "events_url": "https://api.github.com/users/stffrdhrn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stffrdhrn/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0618ecf6eb99dce0278102a88f622f28e3ecd837",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0618ecf6eb99dce0278102a88f622f28e3ecd837",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0618ecf6eb99dce0278102a88f622f28e3ecd837"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 11,
    "deletions": 5
  },
  "files": [
    {
      "sha": "7a6b9a14422b40b904737232297dd090eda0bb99",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a76ef689b60405e494cb99e198acf3c82f467f7d/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a76ef689b60405e494cb99e198acf3c82f467f7d/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=a76ef689b60405e494cb99e198acf3c82f467f7d",
      "patch": "@@ -1,3 +1,10 @@\n+2021-05-06  Stafford Horne  <shorne@gmail.com>\n+\n+\tPR 27624\n+\t* elf32-or1k.c (or1k_elf_adjust_dynamic_symbol): Change\n+\tcondition used to cleanup plt entries to cleanup forced local\n+\tentries.\n+\n 2021-05-05  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27825"
    },
    {
      "sha": "cc6c51220e502de6f317363050b6e298ed227e3e",
      "filename": "bfd/elf32-or1k.c",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a76ef689b60405e494cb99e198acf3c82f467f7d/bfd/elf32-or1k.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a76ef689b60405e494cb99e198acf3c82f467f7d/bfd/elf32-or1k.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-or1k.c?ref=a76ef689b60405e494cb99e198acf3c82f467f7d",
      "patch": "@@ -2566,11 +2566,10 @@ or1k_elf_adjust_dynamic_symbol (struct bfd_link_info *info,\n   if (h->type == STT_FUNC\n       || h->needs_plt)\n     {\n-      if (! bfd_link_pic (info)\n-\t  && !h->def_dynamic\n-\t  && !h->ref_dynamic\n-\t  && h->root.type != bfd_link_hash_undefweak\n-\t  && h->root.type != bfd_link_hash_undefined)\n+      if (h->plt.refcount <= 0\n+\t  || (SYMBOL_CALLS_LOCAL (info, h)\n+\t  || (ELF_ST_VISIBILITY (h->other) != STV_DEFAULT\n+\t      && h->root.type == bfd_link_hash_undefweak)))\n \t{\n \t  /* This case can occur if we saw a PLT reloc in an input\n \t     file, but the symbol was never referred to by a dynamic"
    }
  ]
}