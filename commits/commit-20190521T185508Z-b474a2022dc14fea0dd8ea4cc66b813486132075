{
  "sha": "b474a2022dc14fea0dd8ea4cc66b813486132075",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjQ3NGEyMDIyZGMxNGZlYTBkZDhlYTRjYzY2YjgxMzQ4NjEzMjA3NQ==",
  "commit": {
    "author": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-05-18T08:19:04Z"
    },
    "committer": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-05-21T18:55:08Z"
    },
    "message": "MIPS/LD: Reject tprel_hi and tprel_lo relocations in shared library\n\nbfd/\n\t* elfxx-mips.c (_bfd_mips_elf_check_relocs): Generate error\n\tfor TLS_TPREL_HI16(/LO16) relocations in shared library.\n\nld/\n\t* testsuite/ld-mips-elf/pic-reloc-5.s: Add tests for\n\t%tprel_hi and %tprel_lo relocations.\n\t* testsuite/ld-mips-elf/pic-reloc-6.s: Likewise.\n\t* testsuite/ld-mips-elf/pic-reloc-5.d: Update accordingly.\n\t* testsuite/ld-mips-elf/pic-reloc-6.d: Likewise.\n\t* testsuite/ld-mips-elf/pic-reloc-tls.ld: New test linker\n\tscript file.",
    "tree": {
      "sha": "0fe5db1c7c9c7dbe2899109aec52a5f63d624539",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0fe5db1c7c9c7dbe2899109aec52a5f63d624539"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b474a2022dc14fea0dd8ea4cc66b813486132075",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b474a2022dc14fea0dd8ea4cc66b813486132075",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b474a2022dc14fea0dd8ea4cc66b813486132075",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b474a2022dc14fea0dd8ea4cc66b813486132075/comments",
  "author": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "304f09d0d4b519f143144d213e1280a0691de8ba",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/304f09d0d4b519f143144d213e1280a0691de8ba",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/304f09d0d4b519f143144d213e1280a0691de8ba"
    }
  ],
  "stats": {
    "total": 74,
    "additions": 70,
    "deletions": 4
  },
  "files": [
    {
      "sha": "320e06ac7e9dad5c50e367a5733e250d51d76483",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -1,3 +1,8 @@\n+2019-05-21  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n+\n+\t* elfxx-mips.c (_bfd_mips_elf_check_relocs): Generate error\n+\tfor TLS_TPREL_HI16(/LO16) relocations in shared library.\n+\n 2019-05-21  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n \n \t* elfxx-mips.c (_bfd_mips_elf_check_relocs): Add NULL pointer"
    },
    {
      "sha": "c64f90c3bb66b1d7d2517dae0be2130605842128",
      "filename": "bfd/elfxx-mips.c",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/bfd/elfxx-mips.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/bfd/elfxx-mips.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-mips.c?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -9102,6 +9102,18 @@ _bfd_mips_elf_check_relocs (bfd *abfd, struct bfd_link_info *info,\n \t{\n \t  switch (r_type)\n \t    {\n+\t    case R_MIPS_TLS_TPREL_HI16:\n+\t    case R_MIPS16_TLS_TPREL_HI16:\n+\t    case R_MICROMIPS_TLS_TPREL_HI16:\n+\t    case R_MIPS_TLS_TPREL_LO16:\n+\t    case R_MIPS16_TLS_TPREL_LO16:\n+\t    case R_MICROMIPS_TLS_TPREL_LO16:\n+\t      /* These are okay in PIE, but not in a shared library.  */\n+\t      if (bfd_link_executable (info))\n+\t\tbreak;\n+\n+\t      /* FALLTHROUGH */\n+\n \t    case R_MIPS16_HI16:\n \t    case R_MIPS_HI16:\n \t    case R_MIPS_HIGHER:"
    },
    {
      "sha": "eb0dd9bb8fe3e006efbd590fa238de9ce6a18a6f",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -1,3 +1,13 @@\n+2019-05-21  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n+\n+\t* testsuite/ld-mips-elf/pic-reloc-5.s: Add tests for\n+\t%tprel_hi and %tprel_lo relocations.\n+\t* testsuite/ld-mips-elf/pic-reloc-6.s: Likewise.\n+\t* testsuite/ld-mips-elf/pic-reloc-5.d: Update accordingly.\n+\t* testsuite/ld-mips-elf/pic-reloc-6.d: Likewise.\n+\t* testsuite/ld-mips-elf/pic-reloc-tls.ld: New test linker\n+\tscript file.\n+\n 2019-05-21  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n \n \t* testsuite/ld-mips-elf/pic-reloc-5.d: New test."
    },
    {
      "sha": "ecedb6e0c1b1884822fba2fb88ae9a132d0355eb",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-5.d",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-5.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-5.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-5.d?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -1,6 +1,10 @@\n #name: MIPS PIC relocation 5\n-#ld: -shared -T pic-reloc-ordinary.ld\n+#ld: -shared -T pic-reloc-tls.ld\n #target: [check_shared_lib_support]\n #error: \\A[^\\n]*: in function `foo':\\n\n #error:   \\(\\.text\\+0x0\\): relocation R_(MICRO|)MIPS_HI16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n-#error:   \\(\\.text\\+0x8\\): relocation R_(MICRO|)MIPS_HI16 against `bar' cannot be used when making a shared object; recompile with -fPIC\\Z\n+#error:   \\(\\.text\\+0x8\\): relocation R_(MICRO|)MIPS_HI16 against `bar' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x10\\): relocation R_(MICRO|)MIPS_TLS_TPREL_HI16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x14\\): relocation R_(MICRO|)MIPS_TLS_TPREL_LO16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x18\\): relocation R_(MICRO|)MIPS_TLS_TPREL_HI16 against `global_tls' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x1c\\): relocation R_(MICRO|)MIPS_TLS_TPREL_LO16 against `global_tls' cannot be used when making a shared object; recompile with -fPIC\\Z"
    },
    {
      "sha": "456d834a10eb3de042bb9f39a696759a63a31285",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-5.s",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-5.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-5.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-5.s?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -1,10 +1,22 @@\n \t.text\n \t.globl\tfoo\n+\t.globl  global_tls\n \t.ent\tfoo\n foo:\n $LCL:\n \tlui\t$2, %hi($LCL)\n \taddiu\t$2, %lo($LCL)\n \tlui\t$2, %hi(bar)\n \taddiu\t$2, %lo(bar)\n+\tlui\t$a0,%tprel_hi(local_tls)\n+\taddiu\t$a0,$a0,%tprel_lo(local_tls)\n+\tlui\t$a0,%tprel_hi(global_tls)\n+\taddiu\t$a0,$a0,%tprel_lo(global_tls)\n \t.end\tfoo\n+\t.type\tlocal_tls,%object\n+\t.type\tglobal_tls,%object\n+\t.section\t.tbss,\"awT\",@nobits\n+local_tls:\n+\t.word\n+global_tls:\n+\t.word"
    },
    {
      "sha": "8a8b5501e926edd852bb36c40226c5a963fada41",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-6.d",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-6.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-6.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-6.d?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -1,7 +1,11 @@\n #name: MIPS PIC relocation 6 (MIPS16)\n-#ld: -shared -T pic-reloc-ordinary.ld\n+#ld: -shared -T pic-reloc-tls.ld\n #target: [check_shared_lib_support]\n #as: -mips16\n #error: \\A[^\\n]*: in function `foo':\\n\n #error:   \\(\\.text\\+0x0\\): relocation R_MIPS16_HI16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n-#error:   \\(\\.text\\+0x8\\): relocation R_MIPS16_HI16 against `bar' cannot be used when making a shared object; recompile with -fPIC\\Z\n+#error:   \\(\\.text\\+0x8\\): relocation R_MIPS16_HI16 against `bar' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x10\\): relocation R_MIPS16_TLS_TPREL_HI16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x14\\): relocation R_MIPS16_TLS_TPREL_LO16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x18\\): relocation R_MIPS16_TLS_TPREL_HI16 against `global_tls' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x1c\\): relocation R_MIPS16_TLS_TPREL_LO16 against `global_tls' cannot be used when making a shared object; recompile with -fPIC\\Z"
    },
    {
      "sha": "5cf5e81e4d0267ba2731e0ead565e74a3e096fd0",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-6.s",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-6.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-6.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-6.s?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -1,10 +1,22 @@\n \t.text\n \t.globl\tfoo\n+\t.globl  global_tls\n \t.ent\tfoo\n foo:\n $LCL:\n \tli\t$2, %hi($LCL)\n \taddiu\t$2, %lo($LCL)\n \tli\t$2, %hi(bar)\n \taddiu\t$2, %lo(bar)\n+\tli\t$a0,%tprel_hi(local_tls)\n+\tlw\t$a1,%tprel_lo(local_tls)($a0)\n+\tli\t$a0,%tprel_hi(global_tls)\n+\tlw\t$a1,%tprel_lo(global_tls)($a0)\n \t.end\tfoo\n+\t.type\tlocal_tls,%object\n+\t.type\tglobal_tls,%object\n+\t.section\t.tbss,\"awT\",@nobits\n+local_tls:\n+\t.word\n+global_tls:\n+\t.word"
    },
    {
      "sha": "85af30cf5e1987f397f5e31152dad9157e4822e3",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-tls.ld",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-tls.ld",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b474a2022dc14fea0dd8ea4cc66b813486132075/ld/testsuite/ld-mips-elf/pic-reloc-tls.ld",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-tls.ld?ref=b474a2022dc14fea0dd8ea4cc66b813486132075",
      "patch": "@@ -0,0 +1,7 @@\n+SECTIONS\n+{\n+  bar = foo;\n+  .text : { *(.text) }\n+  .tbss : { *(.tbss) }\n+  /DISCARD/ : { *(*) }\n+}"
    }
  ]
}