{
  "sha": "e1dbfc17c5305eef8f021c1baa703151bffc1490",
  "node_id": "C_kwDOANOeidoAKGUxZGJmYzE3YzUzMDVlZWY4ZjAyMWMxYmFhNzAzMTUxYmZmYzE0OTA",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2022-01-30T17:17:56Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2022-01-31T18:16:49Z"
    },
    "message": "Load debug section only when dumping debug sections\n\nDon't load debug sections if we aren't dumping any debug sections.\n\n\tPR binutils/28843\n\t* objdump.c (dump_any_debugging): New.\n\t(load_debug_section): Return false if dump_any_debugging isn't\n\tset.\n\t(main): Set dump_any_debugging when dumping any debug sections.\n\t* readelf (dump_any_debugging): New.\n\t(parse_args): Set dump_any_debugging when dumping any debug\n\tsections.\n\t(load_debug_section): Return false if dump_any_debugging isn't\n\tset.",
    "tree": {
      "sha": "ecca0df32edcb737c8c323fc4f1a0f2f8893ed6c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ecca0df32edcb737c8c323fc4f1a0f2f8893ed6c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e1dbfc17c5305eef8f021c1baa703151bffc1490",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e1dbfc17c5305eef8f021c1baa703151bffc1490",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e1dbfc17c5305eef8f021c1baa703151bffc1490",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e1dbfc17c5305eef8f021c1baa703151bffc1490/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "492325c4b78933e41608c53963d29b1f16affd47",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/492325c4b78933e41608c53963d29b1f16affd47",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/492325c4b78933e41608c53963d29b1f16affd47"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 15,
    "deletions": 0
  },
  "files": [
    {
      "sha": "24e91869bfdc41122abdf94fcb5b2e4c6294db72",
      "filename": "binutils/objdump.c",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e1dbfc17c5305eef8f021c1baa703151bffc1490/binutils/objdump.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e1dbfc17c5305eef8f021c1baa703151bffc1490/binutils/objdump.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/objdump.c?ref=e1dbfc17c5305eef8f021c1baa703151bffc1490",
      "patch": "@@ -131,6 +131,7 @@ static bool color_output = false;\t/* --visualize-jumps=color.  */\n static bool extended_color_output = false; /* --visualize-jumps=extended-color.  */\n static int process_links = false;       /* --process-links.  */\n \n+static int dump_any_debugging;\n static int demangle_flags = DMGL_ANSI | DMGL_PARAMS;\n \n /* A structure to record the sections mentioned in -j switches.  */\n@@ -3851,6 +3852,9 @@ load_debug_section (enum dwarf_section_display_enum debug, void *file)\n   asection *sec;\n   const char *name;\n \n+  if (!dump_any_debugging)\n+    return false;\n+\n   /* If it is already loaded, do nothing.  */\n   if (section->start != NULL)\n     {\n@@ -5688,6 +5692,10 @@ main (int argc, char **argv)\n   if (!seenflag)\n     usage (stderr, 2);\n \n+  dump_any_debugging = (dump_debugging\n+\t\t\t|| dump_dwarf_section_info\n+\t\t\t|| process_links);\n+\n   if (formats_info)\n     exit_status = display_info ();\n   else"
    },
    {
      "sha": "e56e9b5639397dd0839339b4606270e74995dfb4",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e1dbfc17c5305eef8f021c1baa703151bffc1490/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e1dbfc17c5305eef8f021c1baa703151bffc1490/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=e1dbfc17c5305eef8f021c1baa703151bffc1490",
      "patch": "@@ -239,6 +239,7 @@ static bool decompress_dumps = false;\n static bool do_not_show_symbol_truncation = false;\n static bool do_demangle = false;\t/* Pretty print C++ symbol names.  */\n static bool process_links = false;\n+static bool dump_any_debugging = false;\n static int demangle_flags = DMGL_ANSI | DMGL_PARAMS;\n static int sym_base = 0;\n \n@@ -5332,6 +5333,7 @@ parse_args (struct dump_data *dumpdata, int argc, char ** argv)\n \tcase 'P':\n \t  process_links = true;\n \t  do_follow_links = true;\n+\t  dump_any_debugging = true;\n \t  break;\n \tcase 'x':\n \t  request_dump (dumpdata, HEX_DUMP);\n@@ -5347,6 +5349,7 @@ parse_args (struct dump_data *dumpdata, int argc, char ** argv)\n \t  break;\n \tcase 'w':\n \t  do_dump = true;\n+\t  dump_any_debugging = true;\n \t  if (optarg == NULL)\n \t    {\n \t      do_debugging = true;\n@@ -5360,6 +5363,7 @@ parse_args (struct dump_data *dumpdata, int argc, char ** argv)\n \t  break;\n \tcase OPTION_DEBUG_DUMP:\n \t  do_dump = true;\n+\t  dump_any_debugging = true;\n \t  if (optarg == NULL)\n \t    {\n \t      do_debugging = true;\n@@ -15913,6 +15917,9 @@ load_debug_section (enum dwarf_section_display_enum debug, void * data)\n   Elf_Internal_Shdr * sec;\n   Filedata * filedata = (Filedata *) data;\n \n+  if (!dump_any_debugging)\n+    return false;\n+\n   /* Without section headers we cannot find any sections.  */\n   if (filedata->section_headers == NULL)\n     return false;"
    }
  ]
}