{
  "sha": "0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MGVkZTI0ZjJjNDZkMmI4ODhmNWUxOTQxOGU1NzdmM2MxMTEwZjZhNQ==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2015-06-23T16:32:47Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-01-03T01:55:21Z"
    },
    "message": "sim: common: add align_{up,down} to match gdb\n\nWe have ALIGN_{8,16,PAGE} and FLOOR_PAGE macros (where PAGE is defined as\n4k) which were imported from the ppc sim.  But no other sim utilizes these\nand hardcoding the sizes in the name is a bit limiting.\n\nLet's delete these and import the two general macros that gdb uses:\n\talign_up(addr, bytes)\n\talign_down(addr, bytes)\n\nThis in turn allows us to cut over the Blackfin code immediately.",
    "tree": {
      "sha": "fa410e70e724d2dc61347f24e137b9aecbcc6efb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fa410e70e724d2dc61347f24e137b9aecbcc6efb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3b47e132c439a5ac477bc07fab06edaa45fa0533",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3b47e132c439a5ac477bc07fab06edaa45fa0533",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/3b47e132c439a5ac477bc07fab06edaa45fa0533"
    }
  ],
  "stats": {
    "total": 37,
    "additions": 19,
    "deletions": 18
  },
  "files": [
    {
      "sha": "d82bc5ee742ac911ab0778b2a06d5153ba5143ed",
      "filename": "sim/bfin/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/bfin/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/bfin/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/ChangeLog?ref=0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
      "patch": "@@ -1,3 +1,8 @@\n+2021-01-02  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* interp.c: Change ALIGN to align_up.\n+\t* sim-main.h (ALIGN): Delete\n+\n 2020-08-21  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* configure.ac: Include config/pkg.m4."
    },
    {
      "sha": "e26a8221b20a220be2ddf40e1b327cf221d335f4",
      "filename": "sim/bfin/interp.c",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/bfin/interp.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/bfin/interp.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/interp.c?ref=0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
      "patch": "@@ -289,7 +289,7 @@ bfin_syscall (SIM_CPU *cpu)\n \tsc.result = heap;\n \theap += sc.arg2;\n \t/* Keep it page aligned.  */\n-\theap = ALIGN (heap, 4096);\n+\theap = align_up (heap, 4096);\n \n \tbreak;\n       }\n@@ -948,7 +948,8 @@ bfin_fdpic_load (SIM_DESC sd, SIM_CPU *cpu, struct bfd *abfd, bu32 *sp,\n       }\n \n   /* Update the load offset with a few extra pages.  */\n-  fdpic_load_offset = ALIGN (max (max_load_addr, fdpic_load_offset), 0x10000);\n+  fdpic_load_offset = align_up (max (max_load_addr, fdpic_load_offset),\n+\t\t\t\t0x10000);\n   fdpic_load_offset += 0x10000;\n \n   /* Push the summary loadmap info onto the stack last.  */\n@@ -1074,7 +1075,7 @@ bfin_user_init (SIM_DESC sd, SIM_CPU *cpu, struct bfd *abfd,\n     env_flat += strlen (env[i]);\n \n   /* Push the Auxiliary Vector Table between argv/env and actual strings.  */\n-  sp_flat = sp = ALIGN (SPREG - argv_flat - env_flat - 4, 4);\n+  sp_flat = sp = align_up (SPREG - argv_flat - env_flat - 4, 4);\n   if (auxvt)\n     {\n # define AT_PUSH(at, val) \\"
    },
    {
      "sha": "a09ea4961898f64148ac63df66bb56a3f96d285a",
      "filename": "sim/bfin/sim-main.h",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/bfin/sim-main.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/bfin/sim-main.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/bfin/sim-main.h?ref=0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
      "patch": "@@ -53,9 +53,7 @@ struct sim_state {\n #include \"dv-bfin_trace.h\"\n \n #undef CLAMP\n-#undef ALIGN\n #define CLAMP(a, b, c) min (max (a, b), c)\n-#define ALIGN(addr, size) (((addr) + ((size)-1)) & ~((size)-1))\n \n /* TODO: Move all this trace logic to the common code.  */\n #define BFIN_TRACE_CORE(cpu, addr, size, map, val) \\"
    },
    {
      "sha": "0545493f5718d9f1236487388a26566c169c5e7c",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
      "patch": "@@ -1,3 +1,9 @@\n+2021-01-02  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* sim-bits.h (_ALIGNa, _FLOORa, ALIGN_8, ALIGN_16, ALIGN_PAGE,\n+\tFLOOR_PAGE): Delete unused macros.\n+\t(align_up, align_down): Define.\n+\n 2020-08-10  Tom de Vries  <tdevries@suse.de>\n \n \t* sim-cpu.c: Include stdlib.h for free."
    },
    {
      "sha": "f8c2563e5bd163613f8735f7254c385088c97ba9",
      "filename": "sim/common/sim-bits.h",
      "status": "modified",
      "additions": 4,
      "deletions": 13,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/common/sim-bits.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ede24f2c46d2b888f5e19418e577f3c1110f6a5/sim/common/sim-bits.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/sim-bits.h?ref=0ede24f2c46d2b888f5e19418e577f3c1110f6a5",
      "patch": "@@ -92,11 +92,8 @@\n    EXTEND*(VALUE): Convert the `*' bit value to the targets natural\n    word size.  Sign extend the value if needed.\n \n-   ALIGN_*(VALUE): Round the value upwards so that it is aligned to a\n-   `_*' byte boundary.\n-\n-   FLOOR_*(VALUE): Truncate the value so that it is aligned to a `_*'\n-   byte boundary.\n+   align_*(VALUE, BYTES): Round the value so that it is aligned to a\n+   BYTES boundary.\n \n    ROT*(VALUE, NR_BITS): Return the `*' bit VALUE rotated by NR_BITS\n    right (positive) or left (negative).\n@@ -525,14 +522,8 @@ INLINE_SIM_BITS(unsigned_word) MSINSERTED (unsigned_word val, int start, int sto\n \n \n /* memory alignment macro's */\n-#define _ALIGNa(A,X)  (((X) + ((A) - 1)) & ~((A) - 1))\n-#define _FLOORa(A,X)  ((X) & ~((A) - 1))\n-\n-#define ALIGN_8(X)\t_ALIGNa (8, X)\n-#define ALIGN_16(X)\t_ALIGNa (16, X)\n-\n-#define ALIGN_PAGE(X)\t_ALIGNa (0x1000, X)\n-#define FLOOR_PAGE(X)   ((X) & ~(0x1000 - 1))\n+#define align_up(v, n)\t\t(((v) + (n) - 1) & -(n))\n+#define align_down(v, n)\t((v) & -(n))\n \n \n /* bit bliting macro's */"
    }
  ]
}