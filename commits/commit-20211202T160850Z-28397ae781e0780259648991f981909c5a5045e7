{
  "sha": "28397ae781e0780259648991f981909c5a5045e7",
  "node_id": "C_kwDOANOeidoAKDI4Mzk3YWU3ODFlMDc4MDI1OTY0ODk5MWY5ODE5MDljNWE1MDQ1ZTc",
  "commit": {
    "author": {
      "name": "Xavier Roirand",
      "email": "roirand@adacore.com",
      "date": "2017-05-12T13:02:28Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-12-02T16:08:50Z"
    },
    "message": "(Ada/AArch64) fix fixed point argument passing in inferior funcall\n\nConsider the following code:\n\n   type FP1_Type is delta 0.1 range -1.0 .. +1.0; --  Ordinary\n\n   function Call_FP1 (F : FP1_Type) return FP1_Type is\n   begin\n      return F;\n   end Call_FP1;\n\nWhen the default in GCC is to generate proper DWARF info for fixed point\ntypes, then in gdb, printing the result of a call to call_fp1 with a\ndecimal parameter leads to:\n\n  (gdb) p call_fp1(0.5)\n  $1 = 0\n\nThe displayed value is wrong, and we actually expected:\n\n  (gdb) p call_fp1(0.5)\n  $1 = 0.5\n\nWhat happened is that our fixed point type parameter got promoted to a\n32bit integer because we detected that the length of that object was less\nthan 4 bytes. The compiler does not perform this promotion and therefore\nGDB should not either.\n\nThis patch fixes the behavior described above.",
    "tree": {
      "sha": "965ddb40bfaf93324d408a37c727baf02ef3b439",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/965ddb40bfaf93324d408a37c727baf02ef3b439"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/28397ae781e0780259648991f981909c5a5045e7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/28397ae781e0780259648991f981909c5a5045e7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/28397ae781e0780259648991f981909c5a5045e7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/28397ae781e0780259648991f981909c5a5045e7/comments",
  "author": null,
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "bc75fb44c5693114b3dc654a2e4b39c9b5a9ca26",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bc75fb44c5693114b3dc654a2e4b39c9b5a9ca26",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bc75fb44c5693114b3dc654a2e4b39c9b5a9ca26"
    }
  ],
  "stats": {
    "total": 113,
    "additions": 112,
    "deletions": 1
  },
  "files": [
    {
      "sha": "3287499ab05944984eb63a1549978226b782a79d",
      "filename": "gdb/aarch64-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28397ae781e0780259648991f981909c5a5045e7/gdb/aarch64-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28397ae781e0780259648991f981909c5a5045e7/gdb/aarch64-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/aarch64-tdep.c?ref=28397ae781e0780259648991f981909c5a5045e7",
      "patch": "@@ -1917,7 +1917,7 @@ aarch64_push_dummy_call (struct gdbarch *gdbarch, struct value *function,\n \tcase TYPE_CODE_CHAR:\n \tcase TYPE_CODE_RANGE:\n \tcase TYPE_CODE_ENUM:\n-\t  if (len < 4)\n+\t  if (len < 4 && !is_fixed_point_type (arg_type))\n \t    {\n \t      /* Promote to 32 bit integer.  */\n \t      if (arg_type->is_unsigned ())"
    },
    {
      "sha": "5a721fdf4fcc2b0419fa1f22d82ff6628d4a540c",
      "filename": "gdb/testsuite/gdb.ada/fixed_points_function.exp",
      "status": "added",
      "additions": 38,
      "deletions": 0,
      "changes": 38,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/fixed_points_function.exp?ref=28397ae781e0780259648991f981909c5a5045e7",
      "patch": "@@ -0,0 +1,38 @@\n+# Copyright 2021 Free Software Foundation, Inc.\n+#\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+load_lib \"ada.exp\"\n+\n+if { [skip_ada_tests] } { return -1 }\n+\n+standard_ada_testfile fixed_points_function\n+\n+if {[gdb_compile_ada \"${srcfile}\" \"${binfile}\" executable [list debug]] != \"\" } {\n+    return -1\n+}\n+\n+clean_restart ${testfile}\n+\n+set bp_location [gdb_get_line_number \"STOP\" ${testdir}/fixed_points_function.adb]\n+runto \"fixed_points_function.adb:$bp_location\"\n+\n+gdb_test \"print call_fp1(1)\" \\\n+         \" = 1\"\n+\n+gdb_test \"print call_fp1(0.5)\" \\\n+         \" = 0.5\"\n+\n+gdb_test \"print call_fp1(-0.5)\" \\\n+         \" = -0.5\""
    },
    {
      "sha": "4f82a277ff1806e9130e9e6792bc02eb69496964",
      "filename": "gdb/testsuite/gdb.ada/fixed_points_function/fixed_points_function.adb",
      "status": "added",
      "additions": 30,
      "deletions": 0,
      "changes": 30,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function/fixed_points_function.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function/fixed_points_function.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/fixed_points_function/fixed_points_function.adb?ref=28397ae781e0780259648991f981909c5a5045e7",
      "patch": "@@ -0,0 +1,30 @@\n+--  Copyright 2021 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+with Pck; use Pck;\n+\n+procedure Fixed_Points_Function is\n+\n+   ------------\n+   -- Test 1 --\n+   ------------\n+\n+   --  Fixed point funcall\n+\n+   F1 : FP1_Type := 1.0;\n+\n+begin\n+   F1 := Call_FP1 (F1); -- STOP\n+end Fixed_Points_Function;"
    },
    {
      "sha": "d8766fe05f9a596126f360a650362bada0690160",
      "filename": "gdb/testsuite/gdb.ada/fixed_points_function/pck.adb",
      "status": "added",
      "additions": 22,
      "deletions": 0,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function/pck.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function/pck.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/fixed_points_function/pck.adb?ref=28397ae781e0780259648991f981909c5a5045e7",
      "patch": "@@ -0,0 +1,22 @@\n+--  Copyright 2021 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+package body Pck is\n+\n+   function Call_FP1 (F : FP1_Type) return FP1_Type is\n+   begin\n+      return F;\n+   end Call_FP1;\n+end pck;"
    },
    {
      "sha": "4ef29a8f0d896bf87ffe773cb999267497025079",
      "filename": "gdb/testsuite/gdb.ada/fixed_points_function/pck.ads",
      "status": "added",
      "additions": 21,
      "deletions": 0,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function/pck.ads",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28397ae781e0780259648991f981909c5a5045e7/gdb/testsuite/gdb.ada/fixed_points_function/pck.ads",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/fixed_points_function/pck.ads?ref=28397ae781e0780259648991f981909c5a5045e7",
      "patch": "@@ -0,0 +1,21 @@\n+--  Copyright 2021 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+package Pck is\n+\n+   type FP1_Type is delta 0.1 range -1.0 .. +1.0; --  Ordinary\n+\n+   function Call_FP1 (F : FP1_Type) return FP1_Type;\n+end pck;"
    }
  ]
}