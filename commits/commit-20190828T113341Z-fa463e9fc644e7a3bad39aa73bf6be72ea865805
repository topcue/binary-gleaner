{
  "sha": "fa463e9fc644e7a3bad39aa73bf6be72ea865805",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmE0NjNlOWZjNjQ0ZTdhM2JhZDM5YWE3M2JmNmJlNzJlYTg2NTgwNQ==",
  "commit": {
    "author": {
      "name": "Niklas G?rtler",
      "email": "profclonk@gmail.com",
      "date": "2019-08-28T11:33:41Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2019-08-28T11:33:41Z"
    },
    "message": "Add an option to objcopy to change the alignment of sections.\n\n\tPR 24942\n\t* objcopy.c (SECTION_CONTEXT_SET_ALIGNMENT): New constant.\n\t(struct section_list): Add alignment field.\n\t(command_line_switch): Add OPTION_SET_SECTION_ALIGNMENT.\n\t(copy_options): Add --set-section-alignment.\n\t(copy_usage): Describe --set-section-alignment.\n\t(find_section_list): Initialise the alignment field.\n\t(setup_section): Handle the alignment field.\n\t(copy_main): Handle OPTION_SET_SECTION_ALIGNMENT.\n\t* doc/binutils.texi: Document the new feature.\n\t* NEWS: Mention the new feature.",
    "tree": {
      "sha": "8cf65d7b31acaa739e104787a35dcf7022d3cc9f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8cf65d7b31acaa739e104787a35dcf7022d3cc9f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/fa463e9fc644e7a3bad39aa73bf6be72ea865805",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fa463e9fc644e7a3bad39aa73bf6be72ea865805",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/fa463e9fc644e7a3bad39aa73bf6be72ea865805",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fa463e9fc644e7a3bad39aa73bf6be72ea865805/comments",
  "author": {
    "login": "Erlkoenig90",
    "id": 7581656,
    "node_id": "MDQ6VXNlcjc1ODE2NTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7581656?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Erlkoenig90",
    "html_url": "https://github.com/Erlkoenig90",
    "followers_url": "https://api.github.com/users/Erlkoenig90/followers",
    "following_url": "https://api.github.com/users/Erlkoenig90/following{/other_user}",
    "gists_url": "https://api.github.com/users/Erlkoenig90/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Erlkoenig90/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Erlkoenig90/subscriptions",
    "organizations_url": "https://api.github.com/users/Erlkoenig90/orgs",
    "repos_url": "https://api.github.com/users/Erlkoenig90/repos",
    "events_url": "https://api.github.com/users/Erlkoenig90/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Erlkoenig90/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a1c110a3fe02f5cb8de18137f6615005288e849e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a1c110a3fe02f5cb8de18137f6615005288e849e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a1c110a3fe02f5cb8de18137f6615005288e849e"
    }
  ],
  "stats": {
    "total": 78,
    "additions": 72,
    "deletions": 6
  },
  "files": [
    {
      "sha": "1148e9d990b175256a1b84d46fef10f430c61a18",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=fa463e9fc644e7a3bad39aa73bf6be72ea865805",
      "patch": "@@ -1,3 +1,17 @@\n+2019-08-28  Niklas G\u00fcrtler  <profclonk@gmail.com>\n+\n+\tPR 24942\n+\t* objcopy.c (SECTION_CONTEXT_SET_ALIGNMENT): New constant.\n+\t(struct section_list): Add alignment field.\n+\t(command_line_switch): Add OPTION_SET_SECTION_ALIGNMENT.\n+\t(copy_options): Add --set-section-alignment.\n+\t(copy_usage): Describe --set-section-alignment.\n+\t(find_section_list): Initialise the alignment field.\n+\t(setup_section): Handle the alignment field.\n+\t(copy_main): Handle OPTION_SET_SECTION_ALIGNMENT.\n+\t* doc/binutils.texi: Document the new feature.\n+\t* NEWS: Mention the new feature.\n+\n 2019-08-28  Nick Clifton  <nickc@redhat.com>\n \n \tPR 24931"
    },
    {
      "sha": "349af31c36e50838288dc87b4ab428fe47beaf60",
      "filename": "binutils/NEWS",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/NEWS?ref=fa463e9fc644e7a3bad39aa73bf6be72ea865805",
      "patch": "@@ -2,6 +2,9 @@\n * Add --source-comment[=<txt>] option to objdump which if present,\n   provides a prefix to source code lines displayed in a disassembly.\n \n+* Add --set-section-alignment <section-name>=<align> option to objcopy to allow\n+  the changing of section alignments.\n+\n * Add --verilog-data-width option to objcopy for verilog targets to control\n   width of data elements in verilog hex format.\n "
    },
    {
      "sha": "bb37cb0988460001ea4858d88f3d95bbe098c1e6",
      "filename": "binutils/doc/binutils.texi",
      "status": "modified",
      "additions": 9,
      "deletions": 2,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/doc/binutils.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/doc/binutils.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/doc/binutils.texi?ref=fa463e9fc644e7a3bad39aa73bf6be72ea865805",
      "patch": "@@ -1175,6 +1175,7 @@ objcopy [@option{-F} @var{bfdname}|@option{--target=}@var{bfdname}]\n         [@option{--change-section-vma} @var{sectionpattern}@{=,+,-@}@var{val}]\n         [@option{--change-warnings}] [@option{--no-change-warnings}]\n         [@option{--set-section-flags} @var{sectionpattern}=@var{flags}]\n+        [@option{--set-section-alignment} @var{sectionpattern}=@var{align}]\n         [@option{--add-section} @var{sectionname}=@var{filename}]\n         [@option{--dump-section} @var{sectionname}=@var{filename}]\n         [@option{--update-section} @var{sectionname}=@var{filename}]\n@@ -1620,6 +1621,11 @@ to clear the @samp{contents} flag of a section which does have\n contents--just remove the section instead.  Not all flags are\n meaningful for all object file formats.\n \n+@item --set-section-alignment @var{sectionpattern}=@var{align}\n+Set the alignment for any sections matching @var{sectionpattern}.  @var{align}\n+specifies the alignment as the exponent for the power of two, i.e. the\n+alignment in bytes will be 2^@var{align}.\n+\n @item --add-section @var{sectionname}=@var{filename}\n Add a new section named @var{sectionname} while copying the file.  The\n contents of the new section are taken from the file @var{filename}.  The\n@@ -1975,8 +1981,9 @@ for dlls.\n [This option is specific to PE targets.]\n \n @item --section-alignment @var{num}\n-Sets the section alignment.  Sections in memory will always begin at\n-addresses which are a multiple of this number.  Defaults to 0x1000.\n+Sets the section alignment field in the PE header.  Sections in memory\n+will always begin at addresses which are a multiple of this number.\n+Defaults to 0x1000.\n [This option is specific to PE targets.]\n \n @item --stack @var{reserve}"
    },
    {
      "sha": "ebb99339aaa8023ca360e566be8a994947e6ea49",
      "filename": "binutils/objcopy.c",
      "status": "modified",
      "additions": 46,
      "deletions": 4,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/objcopy.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa463e9fc644e7a3bad39aa73bf6be72ea865805/binutils/objcopy.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/objcopy.c?ref=fa463e9fc644e7a3bad39aa73bf6be72ea865805",
      "patch": "@@ -143,10 +143,12 @@ struct section_list\n #define SECTION_CONTEXT_ALTER_LMA (1 << 5) /* Increment or decrement the section's LMA address.  */\n #define SECTION_CONTEXT_SET_FLAGS (1 << 6) /* Set the section's flags.  */\n #define SECTION_CONTEXT_REMOVE_RELOCS (1 << 7) /* Remove relocations for this section.  */\n+#define SECTION_CONTEXT_SET_ALIGNMENT (1 << 8) /* Set alignment for section.  */\n \n   bfd_vma\t\tvma_val;   /* Amount to change by or set to.  */\n   bfd_vma\t\tlma_val;   /* Amount to change by or set to.  */\n   flagword\t\tflags;\t   /* What to set the section flags to.\t */\n+  unsigned int\t        alignment; /* Alignment of output section.  */\n };\n \n static struct section_list *change_sections;\n@@ -344,8 +346,9 @@ enum command_line_switch\n   OPTION_REMOVE_RELOCS,\n   OPTION_RENAME_SECTION,\n   OPTION_REVERSE_BYTES,\n-  OPTION_SECTION_ALIGNMENT,\n+  OPTION_PE_SECTION_ALIGNMENT,\n   OPTION_SET_SECTION_FLAGS,\n+  OPTION_SET_SECTION_ALIGNMENT,\n   OPTION_SET_START,\n   OPTION_SREC_FORCES3,\n   OPTION_SREC_LEN,\n@@ -476,8 +479,9 @@ static struct option copy_options[] =\n   {\"remove-relocations\", required_argument, 0, OPTION_REMOVE_RELOCS},\n   {\"rename-section\", required_argument, 0, OPTION_RENAME_SECTION},\n   {\"reverse-bytes\", required_argument, 0, OPTION_REVERSE_BYTES},\n-  {\"section-alignment\", required_argument, 0, OPTION_SECTION_ALIGNMENT},\n+  {\"section-alignment\", required_argument, 0, OPTION_PE_SECTION_ALIGNMENT},\n   {\"set-section-flags\", required_argument, 0, OPTION_SET_SECTION_FLAGS},\n+  {\"set-section-alignment\", required_argument, 0, OPTION_SET_SECTION_ALIGNMENT},\n   {\"set-start\", required_argument, 0, OPTION_SET_START},\n   {\"srec-forceS3\", no_argument, 0, OPTION_SREC_FORCES3},\n   {\"srec-len\", required_argument, 0, OPTION_SREC_LEN},\n@@ -610,6 +614,8 @@ copy_usage (FILE *stream, int exit_status)\n                                    Warn if a named section does not exist\\n\\\n      --set-section-flags <name>=<flags>\\n\\\n                                    Set section <name>'s properties to <flags>\\n\\\n+     --set-section-alignment <name>=<align>\\n\\\n+                                   Set section <name>'s alignment to 2^<align> bytes\\n\\\n      --add-section <name>=<file>   Add section <name> found in <file> to output\\n\\\n      --update-section <name>=<file>\\n\\\n                                    Update contents of section <name> with\\n\\\n@@ -964,6 +970,7 @@ find_section_list (const char *name, bfd_boolean add, unsigned int context)\n   p->vma_val = 0;\n   p->lma_val = 0;\n   p->flags = 0;\n+  p->alignment = 0;\n   p->next = change_sections;\n   change_sections = p;\n \n@@ -3766,6 +3773,7 @@ setup_section (bfd *ibfd, sec_ptr isection, void *obfdarg)\n   const char * name;\n   char *prefix = NULL;\n   bfd_boolean make_nobits;\n+  unsigned int alignment;\n \n   if (is_strip_section (ibfd, isection))\n     return;\n@@ -3872,11 +3880,18 @@ setup_section (bfd *ibfd, sec_ptr isection, void *obfdarg)\n \n   osection->lma = lma;\n \n+  p = find_section_list (bfd_section_name (ibfd, isection), FALSE,\n+\t\t\t SECTION_CONTEXT_SET_ALIGNMENT);\n+  if (p != NULL)\n+    alignment = p->alignment;\n+  else\n+    alignment = bfd_section_alignment (ibfd, isection);\n+  \n   /* FIXME: This is probably not enough.  If we change the LMA we\n      may have to recompute the header for the file as well.  */\n   if (!bfd_set_section_alignment (obfd,\n \t\t\t\t  osection,\n-\t\t\t\t  bfd_section_alignment (ibfd, isection)))\n+\t\t\t\t  alignment))\n     {\n       err = _(\"failed to set alignment\");\n       goto loser;\n@@ -5262,6 +5277,33 @@ copy_main (int argc, char *argv[])\n \t  }\n \t  break;\n \n+\tcase OPTION_SET_SECTION_ALIGNMENT:\n+\t  {\n+\t    struct section_list *p;\n+\t    const char *s;\n+\t    int len;\n+\t    char *name;\n+\t    int align;\n+\n+\t    s = strchr (optarg, '=');\n+\t    if (s == NULL)\n+\t      fatal (_(\"bad format for %s\"), \"--set-section-alignment\");\n+\t    \n+\t    align = atoi(s+1);\n+\t    if (align < 0)\n+\t      fatal (_(\"bad format for %s\"), \"--set-section-alignment\");\n+\n+\t    len = s - optarg;\n+\t    name = (char *) xmalloc (len + 1);\n+\t    strncpy (name, optarg, len);\n+\t    name[len] = '\\0';\n+\n+\t    p = find_section_list (name, TRUE, SECTION_CONTEXT_SET_ALIGNMENT);\n+\n+\t    p->alignment = align;\n+\t  }\n+\t  break;\n+\t  \n \tcase OPTION_RENAME_SECTION:\n \t  {\n \t    flagword flags;\n@@ -5457,7 +5499,7 @@ copy_main (int argc, char *argv[])\n \t  pe_image_base = parse_vma (optarg, \"--image-base\");\n \t  break;\n \n-\tcase OPTION_SECTION_ALIGNMENT:\n+\tcase OPTION_PE_SECTION_ALIGNMENT:\n \t  pe_section_alignment = parse_vma (optarg,\n \t\t\t\t\t    \"--section-alignment\");\n \t  break;"
    }
  ]
}