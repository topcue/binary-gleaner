{
  "sha": "4a977544657ae51a33447b4c4211009dacb09bdd",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGE5Nzc1NDQ2NTdhZTUxYTMzNDQ3YjRjNDIxMTAwOWRhY2IwOWJkZA==",
  "commit": {
    "author": {
      "name": "Bernd Edlinger",
      "email": "bernd.edlinger@hotmail.de",
      "date": "2021-06-02T17:21:15Z"
    },
    "committer": {
      "name": "Bernd Edlinger",
      "email": "bernd.edlinger@hotmail.de",
      "date": "2021-06-05T17:35:44Z"
    },
    "message": "Fix gdb crash due to SIGPIPE when the compile command fails\n\nDue to the SIGPIPE the gdb process is killed here, which is\nnot helpful.\n\n2021-06-05  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n\n\t* compile/compile.c (scoped_ignore_sigpipe): New helper class.\n\t(compile_to_object): Ignore SIGPIPE before calling the plugin.",
    "tree": {
      "sha": "e53a817d0288c549dc684c1859a1269575951de0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e53a817d0288c549dc684c1859a1269575951de0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4a977544657ae51a33447b4c4211009dacb09bdd",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4a977544657ae51a33447b4c4211009dacb09bdd",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4a977544657ae51a33447b4c4211009dacb09bdd",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4a977544657ae51a33447b4c4211009dacb09bdd/comments",
  "author": {
    "login": "bernd-edlinger",
    "id": 17638929,
    "node_id": "MDQ6VXNlcjE3NjM4OTI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bernd-edlinger",
    "html_url": "https://github.com/bernd-edlinger",
    "followers_url": "https://api.github.com/users/bernd-edlinger/followers",
    "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions",
    "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs",
    "repos_url": "https://api.github.com/users/bernd-edlinger/repos",
    "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "bernd-edlinger",
    "id": 17638929,
    "node_id": "MDQ6VXNlcjE3NjM4OTI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/17638929?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bernd-edlinger",
    "html_url": "https://github.com/bernd-edlinger",
    "followers_url": "https://api.github.com/users/bernd-edlinger/followers",
    "following_url": "https://api.github.com/users/bernd-edlinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/bernd-edlinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bernd-edlinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bernd-edlinger/subscriptions",
    "organizations_url": "https://api.github.com/users/bernd-edlinger/orgs",
    "repos_url": "https://api.github.com/users/bernd-edlinger/repos",
    "events_url": "https://api.github.com/users/bernd-edlinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bernd-edlinger/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8ff8c543b4a6da9abbba7f406f13ba844cfe6d94",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8ff8c543b4a6da9abbba7f406f13ba844cfe6d94",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8ff8c543b4a6da9abbba7f406f13ba844cfe6d94"
    }
  ],
  "stats": {
    "total": 36,
    "additions": 36,
    "deletions": 0
  },
  "files": [
    {
      "sha": "dcb97ae04613336ea394be3076f4fb581833ba0f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a977544657ae51a33447b4c4211009dacb09bdd/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a977544657ae51a33447b4c4211009dacb09bdd/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=4a977544657ae51a33447b4c4211009dacb09bdd",
      "patch": "@@ -1,3 +1,8 @@\n+2021-06-05  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n+\n+\t* compile/compile.c (scoped_ignore_sigpipe): New helper class.\n+\t(compile_to_object): Ignore SIGPIPE before calling the plugin.\n+\n 2021-06-05  Tom Tromey  <tom@tromey.com>\n \n \t* data-directory/Makefile.in (Makefile): Use correct directory"
    },
    {
      "sha": "8247fc453960ac960f4ef7b844da280c310fd660",
      "filename": "gdb/compile/compile.c",
      "status": "modified",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a977544657ae51a33447b4c4211009dacb09bdd/gdb/compile/compile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a977544657ae51a33447b4c4211009dacb09bdd/gdb/compile/compile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/compile/compile.c?ref=4a977544657ae51a33447b4c4211009dacb09bdd",
      "patch": "@@ -633,6 +633,33 @@ print_callback (void *ignore, const char *message)\n   fputs_filtered (message, gdb_stderr);\n }\n \n+/* RAII class used to ignore SIGPIPE in a scope.  */\n+\n+class scoped_ignore_sigpipe\n+{\n+public:\n+  scoped_ignore_sigpipe ()\n+  {\n+#ifdef SIGPIPE\n+    m_osigpipe = signal (SIGPIPE, SIG_IGN);\n+#endif\n+  }\n+\n+  ~scoped_ignore_sigpipe ()\n+  {\n+#ifdef SIGPIPE\n+    signal (SIGPIPE, m_osigpipe);\n+#endif\n+  }\n+\n+  DISABLE_COPY_AND_ASSIGN (scoped_ignore_sigpipe);\n+\n+private:\n+#ifdef SIGPIPE\n+  sighandler_t m_osigpipe = NULL;\n+#endif\n+};\n+\n /* Process the compilation request.  On success it returns the object\n    and source file names.  On an error condition, error () is\n    called.  */\n@@ -755,6 +782,10 @@ compile_to_object (struct command_line *cmd, const char *cmd_string,\n     fprintf_unfiltered (gdb_stdlog, \"source file produced: %s\\n\\n\",\n \t\t\tfnames.source_file ());\n \n+  /* If we don't do this, then GDB simply exits\n+     when the compiler dies.  */\n+  scoped_ignore_sigpipe ignore_sigpipe;\n+\n   /* Call the compiler and start the compilation process.  */\n   compiler->set_source_file (fnames.source_file ());\n   ok = compiler->compile (fnames.object_file (), compile_debug);"
    }
  ]
}