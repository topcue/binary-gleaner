{
  "sha": "56c1b507aa8bd8029f63bc78275fab1d815966f5",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTZjMWI1MDdhYThiZDgwMjlmNjNiYzc4Mjc1ZmFiMWQ4MTU5NjZmNQ==",
  "commit": {
    "author": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-07-15T11:52:53Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-07-15T11:52:53Z"
    },
    "message": "Fix the generation of relocs for missing build notes.\n\n\t* write.c (create_note_reloc): Add desc2_size parameter.  Zero out\n\tthe addend field of REL relocations.  Store the full addend into\n\tthe note for REL relocations.",
    "tree": {
      "sha": "4e7dc187f88c686181f090ff8eb77400b1f4fbd3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4e7dc187f88c686181f090ff8eb77400b1f4fbd3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/56c1b507aa8bd8029f63bc78275fab1d815966f5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/56c1b507aa8bd8029f63bc78275fab1d815966f5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/56c1b507aa8bd8029f63bc78275fab1d815966f5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/56c1b507aa8bd8029f63bc78275fab1d815966f5/comments",
  "author": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "28b80303a2f3e47fcedcfab677a322a8e71dc607",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/28b80303a2f3e47fcedcfab677a322a8e71dc607",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/28b80303a2f3e47fcedcfab677a322a8e71dc607"
    }
  ],
  "stats": {
    "total": 33,
    "additions": 24,
    "deletions": 9
  },
  "files": [
    {
      "sha": "194819eecfd4cfed73b37015cfb75f262545c1d0",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/56c1b507aa8bd8029f63bc78275fab1d815966f5/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/56c1b507aa8bd8029f63bc78275fab1d815966f5/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=56c1b507aa8bd8029f63bc78275fab1d815966f5",
      "patch": "@@ -1,3 +1,9 @@\n+2020-07-15  Nick Clifton  <nickc@redhat.com>\n+\n+\t* write.c (create_note_reloc): Add desc2_size parameter.  Zero out\n+\tthe addend field of REL relocations.  Store the full addend into\n+\tthe note for REL relocations.\n+\n 2020-07-15  Jan Beulich  <jbeulich@suse.com>\n \n \t* testsuite/gas/i386/x86-64-stack.s: Adjust 32-bit push"
    },
    {
      "sha": "0b43063bbaab76d21fe3bac5fb4643bfff3c72e2",
      "filename": "gas/write.c",
      "status": "modified",
      "additions": 18,
      "deletions": 9,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/56c1b507aa8bd8029f63bc78275fab1d815966f5/gas/write.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/56c1b507aa8bd8029f63bc78275fab1d815966f5/gas/write.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/write.c?ref=56c1b507aa8bd8029f63bc78275fab1d815966f5",
      "patch": "@@ -1897,6 +1897,7 @@ create_note_reloc (segT           sec,\n \t\t   symbolS *      sym,\n \t\t   bfd_size_type  note_offset,\n \t\t   bfd_size_type  desc2_offset,\n+\t\t   offsetT        desc2_size,\n \t\t   int            reloc_type,\n \t\t   bfd_vma        addend,\n \t\t   char *         note)\n@@ -1931,15 +1932,21 @@ create_note_reloc (segT           sec,\n \t but still stores the addend in the word being relocated.  */\n       || strstr (bfd_get_target (stdoutput), \"-sh\") != NULL)\n     {\n+      offsetT i;\n+\n+      /* Zero out the addend, since it is now stored in the note.  */\n+      reloc->u.b.r.addend = 0;\n+\n       if (target_big_endian)\n \t{\n-\t  if (bfd_arch_bits_per_address (stdoutput) <= 32)\n-\t    note[desc2_offset + 3] = addend;\n-\t  else\n-\t    note[desc2_offset + 7] = addend;\n+\t  for (i = desc2_size; addend != 0 && i > 0; addend >>= 8, i--)\n+\t    note[desc2_offset + i - 1] = (addend & 0xff);\n \t}\n       else\n-\tnote[desc2_offset] = addend;\n+\t{\n+\t  for (i = 0; addend != 0 && i < desc2_size; addend >>= 8, i++)\n+\t    note[desc2_offset + i] = (addend & 0xff);\n+\t}\n     }\n }\n \n@@ -2025,14 +2032,14 @@ maybe_generate_build_notes (void)\n \tif (target_big_endian)\n \t  {\n \t    note[3] = 8; /* strlen (name) + 1.  */\n-\t    note[7] = desc_size; /* Two 8-byte offsets.  */\n+\t    note[7] = desc_size; /* Two N-byte offsets.  */\n \t    note[10] = NT_GNU_BUILD_ATTRIBUTE_OPEN >> 8;\n \t    note[11] = NT_GNU_BUILD_ATTRIBUTE_OPEN & 0xff;\n \t  }\n \telse\n \t  {\n \t    note[0] = 8; /* strlen (name) + 1.  */\n-\t    note[4] = desc_size; /* Two 8-byte offsets.  */\n+\t    note[4] = desc_size; /* Two N-byte offsets.  */\n \t    note[8] = NT_GNU_BUILD_ATTRIBUTE_OPEN & 0xff;\n \t    note[9] = NT_GNU_BUILD_ATTRIBUTE_OPEN >> 8;\n \t  }\n@@ -2042,10 +2049,12 @@ maybe_generate_build_notes (void)\n \tmemcpy (note + 12, \"GA$\u00013a1\", 8);\n \n \t/* Create a relocation to install the start address of the note...  */\n-\tcreate_note_reloc (sec, sym, total_size, 20, desc_reloc, 0, note);\n+\tcreate_note_reloc (sec, sym, total_size, 20, desc_size / 2, desc_reloc, 0, note);\n \n \t/* ...and another one to install the end address.  */\n-\tcreate_note_reloc (sec, sym, total_size, desc2_offset, desc_reloc,\n+\tcreate_note_reloc (sec, sym, total_size, desc2_offset,\n+\t\t\t   desc_size / 2,\n+\t\t\t   desc_reloc,\n \t\t\t   bfd_section_size (bsym->section),\n \t\t\t   note);\n "
    }
  ]
}