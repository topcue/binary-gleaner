{
  "sha": "0454ef42e74e051dda95004f3c99cbe89bce3a8c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDQ1NGVmNDJlNzRlMDUxZGRhOTUwMDRmM2M5OWNiZTg5YmNlM2E4Yw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-12-20T00:51:40Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-01-14T23:25:04Z"
    },
    "message": "Add gdbsupport check-defines script\n\nThis adds a new script that tries to check that none of the support\ncode uses defines that are not defined by common.m4.  This check is\nnecessarily inexact, but this script caught all the issues fixed in\nthe previous patches.\n\ngdbsupport/ChangeLog\n2020-01-14  Tom Tromey  <tom@tromey.com>\n\n\t* Makefile.in: Rebuild.\n\t* Makefile.am (check-defines): New target.\n\t* check-defines.el: New file.\n\nChange-Id: I59450e91394d5e6a7fa59e9ab53c95843c4bacd9",
    "tree": {
      "sha": "6a077764690fc116afef9dc51944dc7ec9f3e61e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6a077764690fc116afef9dc51944dc7ec9f3e61e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0454ef42e74e051dda95004f3c99cbe89bce3a8c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0454ef42e74e051dda95004f3c99cbe89bce3a8c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0454ef42e74e051dda95004f3c99cbe89bce3a8c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0454ef42e74e051dda95004f3c99cbe89bce3a8c/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "25e573565306c51df462eb6a957f86fc130ee580",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/25e573565306c51df462eb6a957f86fc130ee580",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/25e573565306c51df462eb6a957f86fc130ee580"
    }
  ],
  "stats": {
    "total": 91,
    "additions": 91,
    "deletions": 0
  },
  "files": [
    {
      "sha": "aa827364ed8577cf196db503917c1c98ef251beb",
      "filename": "gdbsupport/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/ChangeLog?ref=0454ef42e74e051dda95004f3c99cbe89bce3a8c",
      "patch": "@@ -1,3 +1,9 @@\n+2020-01-14  Tom Tromey  <tom@tromey.com>\n+\n+\t* Makefile.in: Rebuild.\n+\t* Makefile.am (check-defines): New target.\n+\t* check-defines.el: New file.\n+\n 2020-01-14  Tom Tromey  <tom@tromey.com>\n \n \t* configure, Makefile.in, aclocal.m4, common.m4, config.in:"
    },
    {
      "sha": "1a001a008178f48ca29dec9c065d94f5fc0d17aa",
      "filename": "gdbsupport/Makefile.am",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/Makefile.am",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/Makefile.am",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/Makefile.am?ref=0454ef42e74e051dda95004f3c99cbe89bce3a8c",
      "patch": "@@ -68,3 +68,7 @@ libgdbsupport_a_SOURCES = \\\n     thread-pool.c \\\n     xml-utils.c\t\\\n     $(selftest)\n+\n+# Double-check that no defines are missing from our configury.\n+check-defines:\n+\tcd $(srcdir) && emacs --script check-defines.el"
    },
    {
      "sha": "5723ae5e97e14d7071483ef208ddf1362c40c019",
      "filename": "gdbsupport/Makefile.in",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/Makefile.in?ref=0454ef42e74e051dda95004f3c99cbe89bce3a8c",
      "patch": "@@ -691,6 +691,10 @@ uninstall-am:\n override CC := $(CXX)\n override CFLAGS := $(CXXFLAGS)\n \n+# Double-check that no defines are missing from our configury.\n+check-defines:\n+\tcd $(srcdir) && emacs --script check-defines.el\n+\n # Tell versions [3.59,3.63) of GNU make to not export all variables.\n # Otherwise a system limit (for SysV at least) may be exceeded.\n .NOEXPORT:"
    },
    {
      "sha": "b59748f0054ae66454fd699af912847e30dd7c88",
      "filename": "gdbsupport/check-defines.el",
      "status": "added",
      "additions": 77,
      "deletions": 0,
      "changes": 77,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/check-defines.el",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0454ef42e74e051dda95004f3c99cbe89bce3a8c/gdbsupport/check-defines.el",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/check-defines.el?ref=0454ef42e74e051dda95004f3c99cbe89bce3a8c",
      "patch": "@@ -0,0 +1,77 @@\n+;; Verify that preprocessor symbols are defined in config.in.\n+\n+;; Copyright (C) 2020 Free Software Foundation, Inc.\n+;;\n+;; This file is part of GDB.\n+;;\n+;; This program is free software; you can redistribute it and/or modify\n+;; it under the terms of the GNU General Public License as published by\n+;; the Free Software Foundation; either version 3 of the License, or\n+;; (at your option) any later version.\n+;;\n+;; This program is distributed in the hope that it will be useful,\n+;; but WITHOUT ANY WARRANTY; without even the implied warranty of\n+;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+;; GNU General Public License for more details.\n+;;\n+;; You should have received a copy of the GNU General Public License\n+;; along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+;; To use:\n+;;   cd gdbsupport\n+;;   emacs --script check-defines.el\n+\n+(require 'cl-lib)\n+\n+(setq-default case-fold-search nil)\n+\n+;; The currently recognized macros.\n+(defconst check-regexp \"\\\\_<\\\\(\\\\(HAVE\\\\|PTRACE_TYPE\\\\|SIZEOF\\\\)_[a-zA-Z0-9_]+\\\\)\\\\_>\")\n+\n+(defvar check-seen 0)\n+\n+;; Whitelist.  These are things that have names like autoconf-created\n+;; macros, but that are managed directly in the code.\n+(put (intern \"HAVE_USEFUL_SBRK\") :check-ok t)\n+(put (intern \"HAVE_SOCKETS\") :check-ok t)\n+(put (intern \"HAVE_F_GETFD\") :check-ok t)\n+(put (intern \"HAVE_IS_TRIVIALLY_COPYABLE\") :check-ok t)\n+(put (intern \"HAVE_IS_TRIVIALLY_CONSTRUCTIBLE\") :check-ok t)\n+(put (intern \"HAVE_DOS_BASED_FILE_SYSTEM\") :check-ok t)\n+\n+(defun check-read-config.in (file)\n+  (save-excursion\n+    (find-file-read-only file)\n+    (goto-char (point-min))\n+    (while (re-search-forward \"^#undef \\\\(.+\\\\)$\" nil t)\n+      (let ((name (match-string 1)))\n+\t(put (intern name) :check-ok t)))))\n+\n+(defun check-one-file (file)\n+  (save-excursion\n+    (find-file-read-only file)\n+    (goto-char (point-min))\n+    (while (re-search-forward check-regexp nil t)\n+      (let ((name (match-string 1)))\n+\t(unless (get (intern name) :check-ok)\n+\t  (save-excursion\n+\t    (goto-char (match-beginning 0))\n+\t    (cl-incf check-seen)\n+\t    (message \"%s:%d:%d: error: name %s not defined\"\n+\t\t     file\n+\t\t     (line-number-at-pos)\n+\t\t     (current-column)\n+\t\t     name)))))))\n+\n+(defun check-directory (dir)\n+  (dolist (file (directory-files dir t \"\\\\.[ch]$\"))\n+    (check-one-file file)))\n+\n+(check-read-config.in \"config.in\")\n+(check-read-config.in \"../gnulib/config.in\")\n+(check-directory \".\")\n+(check-directory \"../gdb/nat\")\n+(check-directory \"../gdb/target\")\n+\n+(when (> check-seen 0)\n+  (message \"%d errors seen\" check-seen))"
    }
  ]
}