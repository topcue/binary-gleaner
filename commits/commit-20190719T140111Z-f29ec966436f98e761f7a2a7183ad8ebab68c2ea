{
  "sha": "f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjI5ZWM5NjY0MzZmOThlNzYxZjdhMmE3MTgzYWQ4ZWJhYjY4YzJlYQ==",
  "commit": {
    "author": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-07-19T14:01:11Z"
    },
    "committer": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-07-19T14:01:11Z"
    },
    "message": "Arm: Use feature target descriptions\n\nIn arm arm_create_target_description and\naarch32_create_target_description create feature based target descriptions\ninstead of returning the old style descriptions.\n\nEnsure the descriptions are created in exactly the same way as the old xml\nfiles.\n\nRemove the old initialize calls.\n\ngdb/ChangeLog:\n\n\t* arch/aarch32.c (aarch32_create_target_description): Create\n\ttarget descriptions using features.\n\t* arch/arm.c (arm_create_target_description)\n\t(arm_create_mprofile_target_description): Likewise.\n\t* arm-tdep.c (_initialize_arm_tdep): Remove tdesc init calls.",
    "tree": {
      "sha": "90b0a56047a91f0a50e378c2c21db2f33f8c3aa6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/90b0a56047a91f0a50e378c2c21db2f33f8c3aa6"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/comments",
  "author": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d105cce5dd8d6a5218b044fc161ce89c6b245432",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d105cce5dd8d6a5218b044fc161ce89c6b245432",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d105cce5dd8d6a5218b044fc161ce89c6b245432"
    }
  ],
  "stats": {
    "total": 115,
    "additions": 72,
    "deletions": 43
  },
  "files": [
    {
      "sha": "994e0eff6825122bc323a24ea42f52d55f801e6a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
      "patch": "@@ -1,3 +1,11 @@\n+2019-07-19  Alan Hayward  <alan.hayward@arm.com>\n+\n+\t* arch/aarch32.c (aarch32_create_target_description): Create\n+\ttarget descriptions using features.\n+\t* arch/arm.c (arm_create_target_description)\n+\t(arm_create_mprofile_target_description): Likewise.\n+\t* arm-tdep.c (_initialize_arm_tdep): Remove tdesc init calls.\n+\n 2019-07-19  Alan Hayward  <alan.hayward@arm.com>\n \n \t* Makefile.in: Add new files."
    },
    {
      "sha": "1e21d5ac3a29d307be7a375c3ddb249c56c3d30c",
      "filename": "gdb/arch/aarch32.c",
      "status": "modified",
      "additions": 16,
      "deletions": 2,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/arch/aarch32.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/arch/aarch32.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arch/aarch32.c?ref=f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
      "patch": "@@ -18,12 +18,26 @@\n #include \"gdbsupport/common-defs.h\"\n #include \"aarch32.h\"\n \n-extern struct target_desc *tdesc_arm_with_neon;\n+#include \"../features/arm/arm-core.c\"\n+#include \"../features/arm/arm-vfpv3.c\"\n \n /* See aarch32.h.  */\n \n target_desc *\n aarch32_create_target_description ()\n {\n-  return tdesc_arm_with_neon;\n+  target_desc *tdesc = allocate_target_description ();\n+\n+#ifndef IN_PROCESS_AGENT\n+  set_tdesc_architecture (tdesc, \"arm\");\n+#endif\n+\n+  long regnum = 0;\n+\n+  regnum = create_feature_arm_arm_core (tdesc, regnum);\n+  /* Create a vfpv3 feature, then a blank NEON feature.  */\n+  regnum = create_feature_arm_arm_vfpv3 (tdesc, regnum);\n+  tdesc_create_feature (tdesc, \"org.gnu.gdb.arm.neon\");\n+\n+  return tdesc;\n }"
    },
    {
      "sha": "ea03dd1685a7674bc6361e849680ea2109015cfb",
      "filename": "gdb/arch/arm.c",
      "status": "modified",
      "additions": 48,
      "deletions": 24,
      "changes": 72,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/arch/arm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/arch/arm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arch/arm.c?ref=f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
      "patch": "@@ -21,16 +21,12 @@\n #include \"gdbsupport/common-regcache.h\"\n #include \"arm.h\"\n \n-extern struct target_desc *tdesc_arm_with_vfpv2;\n-extern struct target_desc *tdesc_arm_with_vfpv3;\n-extern struct target_desc *tdesc_arm_with_iwmmxt;\n-\n-/* Temporary ifdef.  Will be removed when target descriptions are switched.  */\n-#ifndef GDBSERVER\n-extern struct target_desc *tdesc_arm_with_m;\n-extern struct target_desc *tdesc_arm_with_m_vfp_d16;\n-extern struct target_desc *tdesc_arm_with_m_fpa_layout;\n-#endif\n+#include \"../features/arm/arm-core.c\"\n+#include \"../features/arm/arm-vfpv2.c\"\n+#include \"../features/arm/arm-vfpv3.c\"\n+#include \"../features/arm/xscale-iwmmxt.c\"\n+#include \"../features/arm/arm-m-profile.c\"\n+#include \"../features/arm/arm-m-profile-with-fpa.c\"\n \n /* See arm.h.  */\n \n@@ -389,46 +385,74 @@ shifted_reg_val (struct regcache *regcache, unsigned long inst,\n target_desc *\n arm_create_target_description (arm_fp_type fp_type)\n {\n+  target_desc *tdesc = allocate_target_description ();\n+\n+#ifndef IN_PROCESS_AGENT\n+  if (fp_type == ARM_FP_TYPE_IWMMXT)\n+    set_tdesc_architecture (tdesc, \"iwmmxt\");\n+  else\n+    set_tdesc_architecture (tdesc, \"arm\");\n+#endif\n+\n+  long regnum = 0;\n+\n+  regnum = create_feature_arm_arm_core (tdesc, regnum);\n+\n   switch (fp_type)\n     {\n     case ARM_FP_TYPE_NONE:\n-      return nullptr;\n-/* Temporary ifdef.  Will be removed when target descriptions are switched.  */\n-#ifndef GDBSERVER\n+      break;\n+\n     case ARM_FP_TYPE_VFPV2:\n-      return tdesc_arm_with_vfpv2;\n+      regnum = create_feature_arm_arm_vfpv2 (tdesc, regnum);\n+      break;\n \n     case ARM_FP_TYPE_VFPV3:\n-      return tdesc_arm_with_vfpv3;\n+      regnum = create_feature_arm_arm_vfpv3 (tdesc, regnum);\n+      break;\n \n     case ARM_FP_TYPE_IWMMXT:\n-      return tdesc_arm_with_iwmmxt;\n-#endif\n+      regnum = create_feature_arm_xscale_iwmmxt (tdesc, regnum);\n+      break;\n+\n     default:\n       error (_(\"Invalid Arm FP type: %d\"), fp_type);\n     }\n+\n+  return tdesc;\n }\n \n /* See arch/arm.h.  */\n \n target_desc *\n arm_create_mprofile_target_description (arm_m_profile_type m_type)\n {\n+  target_desc *tdesc = allocate_target_description ();\n+\n+#ifndef IN_PROCESS_AGENT\n+  set_tdesc_architecture (tdesc, \"arm\");\n+#endif\n+\n+  long regnum = 0;\n+\n   switch (m_type)\n     {\n-/* Temporary ifdef.  Will be removed when target descriptions are switched.  */\n-#ifndef GDBSERVER\n     case ARM_M_TYPE_M_PROFILE:\n-      return tdesc_arm_with_m;\n+      regnum = create_feature_arm_arm_m_profile (tdesc, regnum);\n+      break;\n \n     case ARM_M_TYPE_VFP_D16:\n-      return tdesc_arm_with_m_fpa_layout;\n+      regnum = create_feature_arm_arm_m_profile (tdesc, regnum);\n+      regnum = create_feature_arm_arm_vfpv2 (tdesc, regnum);\n+      break;\n \n     case ARM_M_TYPE_WITH_FPA:\n-      return tdesc_arm_with_m_vfp_d16;\n-#endif\n+      regnum = create_feature_arm_arm_m_profile_with_fpa (tdesc, regnum);\n+      break;\n+\n     default:\n       error (_(\"Invalid Arm M type: %d\"), m_type);\n     }\n-}\n \n+  return tdesc;\n+}"
    },
    {
      "sha": "1d655eab5ce62921a8e9e7799d8c0dea30bf7c64",
      "filename": "gdb/arm-tdep.c",
      "status": "modified",
      "additions": 0,
      "deletions": 17,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/arm-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f29ec966436f98e761f7a2a7183ad8ebab68c2ea/gdb/arm-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arm-tdep.c?ref=f29ec966436f98e761f7a2a7183ad8ebab68c2ea",
      "patch": "@@ -61,14 +61,6 @@\n #include \"record-full.h\"\n #include <algorithm>\n \n-#include \"features/arm/arm-with-m.c\"\n-#include \"features/arm/arm-with-m-fpa-layout.c\"\n-#include \"features/arm/arm-with-m-vfp-d16.c\"\n-#include \"features/arm/arm-with-iwmmxt.c\"\n-#include \"features/arm/arm-with-vfpv2.c\"\n-#include \"features/arm/arm-with-vfpv3.c\"\n-#include \"features/arm/arm-with-neon.c\"\n-\n #if GDB_SELF_TEST\n #include \"gdbsupport/selftest.h\"\n #endif\n@@ -9451,15 +9443,6 @@ _initialize_arm_tdep (void)\n \t\t\t\t  bfd_target_elf_flavour,\n \t\t\t\t  arm_elf_osabi_sniffer);\n \n-  /* Initialize the standard target descriptions.  */\n-  initialize_tdesc_arm_with_m ();\n-  initialize_tdesc_arm_with_m_fpa_layout ();\n-  initialize_tdesc_arm_with_m_vfp_d16 ();\n-  initialize_tdesc_arm_with_iwmmxt ();\n-  initialize_tdesc_arm_with_vfpv2 ();\n-  initialize_tdesc_arm_with_vfpv3 ();\n-  initialize_tdesc_arm_with_neon ();\n-\n   /* Add root prefix command for all \"set arm\"/\"show arm\" commands.  */\n   add_prefix_cmd (\"arm\", no_class, set_arm_command,\n \t\t  _(\"Various ARM-specific commands.\"),"
    }
  ]
}