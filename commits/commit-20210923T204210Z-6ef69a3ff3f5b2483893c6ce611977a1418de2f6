{
  "sha": "6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
  "node_id": "C_kwDOANOeidoAKDZlZjY5YTNmZjNmNWIyNDgzODkzYzZjZTYxMTk3N2ExNDE4ZGUyZjY",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-23T20:42:10Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-23T20:42:10Z"
    },
    "message": "[gdb/testsuite] Use pie instead of -fPIE -pie\n\nReplace {additional_flags=-fPIE ldflags=-pie} with {pie}.\n\nThis makes sure that the test-cases properly error out when using target board\nunix/-fno-PIE/-no-pie.\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "8cf2492a9ecfff89d09cf3234281d9d00e27f235",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8cf2492a9ecfff89d09cf3234281d9d00e27f235"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "508109612f99513f523e2295d86133a71418c010",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/508109612f99513f523e2295d86133a71418c010",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/508109612f99513f523e2295d86133a71418c010"
    }
  ],
  "stats": {
    "total": 38,
    "additions": 16,
    "deletions": 22
  },
  "files": [
    {
      "sha": "ad8175373c028b202dc1b1261c2ce0a8145a2628",
      "filename": "gdb/testsuite/gdb.base/attach-pie-misread.exp",
      "status": "modified",
      "additions": 5,
      "deletions": 3,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/attach-pie-misread.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/attach-pie-misread.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/attach-pie-misread.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -25,7 +25,8 @@ standard_testfile .c\n set genfile [standard_output_file ${testfile}-gen.h]\n set executable $testfile\n \n-if {[build_executable_own_libs ${testfile}.exp $executable $srcfile [list additional_flags=-fPIE ldflags=-pie]] == \"\"} {\n+if {[build_executable_own_libs ${testfile}.exp $executable $srcfile \\\n+\t {pie}] == \"\"} {\n     return -1\n }\n \n@@ -95,7 +96,8 @@ if {$result == 0} {\n     fail $test\n }\n \n-set prelink_args [build_executable_own_libs ${test}.exp $executable $srcfile [list \"additional_flags=-fPIE -DGEN=\\\"$genfile\\\"\" \"ldflags=-pie\"]]\n+set prelink_args [build_executable_own_libs ${test}.exp $executable $srcfile \\\n+\t\t      [list pie \"additional_flags=-DGEN=\\\"$genfile\\\"\"]]\n if {$prelink_args == \"\"} {\n     return -1\n }\n@@ -118,7 +120,7 @@ verbose -log \"first_offset is $first_offset\"\n \n set test \"first offset is non-zero\"\n if {$first_offset == 0} {\n-    fail \"$test (-fPIE -pie in effect?)\"\n+    fail \"$test (failing because PIE is not effect?)\"\n } else {\n     pass $test\n }"
    },
    {
      "sha": "ae3d0bc64d96ffece6c4ca553cf76bc7b7179581",
      "filename": "gdb/testsuite/gdb.base/attach-pie-noexec.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/attach-pie-noexec.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/attach-pie-noexec.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/attach-pie-noexec.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -20,7 +20,7 @@ if {![can_spawn_for_attach]} {\n standard_testfile .c\n set executable ${testfile}\n \n-if { [prepare_for_testing \"failed to prepare\" $executable \"\" [list debug \"additional_flags=-fPIE\" \"ldflags=-pie\"]] } {\n+if { [prepare_for_testing \"failed to prepare\" $executable \"\" [list debug pie]] } {\n     return -1\n }\n "
    },
    {
      "sha": "4171584942ba25f9fdff85d8d61fefd20e2ac1b8",
      "filename": "gdb/testsuite/gdb.base/jit-attach-pie.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/jit-attach-pie.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/jit-attach-pie.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/jit-attach-pie.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -21,7 +21,7 @@ standard_testfile .c\n set executable ${testfile}\n \n if { [build_executable ${testfile}.exp $executable $srcfile \\\n-\t\t\t  [list debug pthreads \"additional_flags=-fPIE\" \"ldflags=-pie\"]] } {\n+\t\t\t  [list debug pthreads pie]] } {\n     return -1\n }\n "
    },
    {
      "sha": "7e13f6ae9beeaac3d62f792661490d309c3a9edf",
      "filename": "gdb/testsuite/gdb.base/jit-elf.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/jit-elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/jit-elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/jit-elf.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -158,8 +158,7 @@ if {[can_spawn_for_attach]} {\n     }\n }\n \n-if { [compile_jit_main ${main_srcfile} \"${main_binfile}-pie\" \\\n-\t  {additional_flags=-fPIE ldflags=-pie}] == 0 } {\n+if { [compile_jit_main ${main_srcfile} \"${main_binfile}-pie\" pie] == 0 } {\n     with_test_prefix PIE {\n \tone_jit_test [lindex $jit_solibs_target 0] \"${hex}  jit_function_0001\" 0\n     }"
    },
    {
      "sha": "33b3aa06e506478f79889cdefdaef940bccaee1a",
      "filename": "gdb/testsuite/gdb.base/pie-execl.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/pie-execl.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/pie-execl.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/pie-execl.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -41,7 +41,7 @@ set binfile2_test_msg OBJDIR/${subdir}/${executable2}\n # Use conditional compilation according to `BIN' as GDB remembers the source\n # file name of the breakpoint.\n \n-set opts [list debug additional_flags=-fPIE ldflags=-pie]\n+set opts [list debug pie]\n if {[build_executable ${testfile}.exp $executable1 $srcfile [concat $opts {additional_flags=-DBIN=1}]] == -1\n     || [build_executable ${testfile}.exp $executable2 $srcfile [concat $opts {additional_flags=-DBIN=2}]] == -1} {\n     return -1"
    },
    {
      "sha": "d093c195da0e30ee2129feb6993a5e820032f950",
      "filename": "gdb/testsuite/gdb.base/pie-fork.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/pie-fork.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/pie-fork.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/pie-fork.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -18,7 +18,7 @@\n \n standard_testfile\n \n-set opts [list debug additional_flags=-fPIE ldflags=-pie]\n+set opts [list debug pie]\n \n if [prepare_for_testing \"failed to prepare\" $testfile $srcfile $opts] {\n     return"
    },
    {
      "sha": "7ab30f2fde032b083b6fd8a2f2660ce2ff0169dd",
      "filename": "gdb/testsuite/gdb.base/reread.exp",
      "status": "modified",
      "additions": 5,
      "deletions": 12,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/reread.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.base/reread.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/reread.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -14,9 +14,7 @@\n # along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n # Build programs in PIE mode, to reproduce PR 21555.\n-foreach_with_prefix opts {\n-    { \"\" \"\" }\n-    { \"-fPIE\" \"ldflags=-pie\" } } {\n+foreach_with_prefix opts { \"\" \"pie\" } {\n \n \t# build the first test case\n \n@@ -25,9 +23,7 @@ foreach_with_prefix opts {\n \t# Cygwin needs $EXEEXT.\n \tset binfile1 [standard_output_file ${testfile1}$EXEEXT]\n \n-\tset testfile1_opt [list debug nowarnings \\\n-\t\t\t       additional_flags=[lindex $opts 0] \\\n-\t\t\t       [lindex $opts 1] ]\n+\tset testfile1_opt [list debug nowarnings $opts]\n \tif  { [gdb_compile \"${srcdir}/${subdir}/${srcfile1}\" \"${binfile1}\" \\\n \t\t   executable ${testfile1_opt}] != \"\" } {\n \t    untested \"failed to compile first testcase\"\n@@ -40,12 +36,9 @@ foreach_with_prefix opts {\n \tset srcfile2 ${testfile2}.c\n \tset binfile2 [standard_output_file ${testfile2}$EXEEXT]\n \n-\tset testfile2_opt1 [list debug nowarnings \\\n-\t\t\t\tadditional_flags=[lindex $opts 0] \\\n-\t\t\t\t[lindex $opts 1]]\n-\tset testfile2_op2 [list debug nowarnings \\\n-\t\t\t       \"additional_flags=-DNO_SECTIONS [lindex $opts 0]\" \\\n-\t\t\t       [lindex $opts 1]]\n+\tset testfile2_opt1 [list debug nowarnings $opts]\n+\tset testfile2_op2 [list debug nowarnings $opts \\\n+\t\t\t       \"additional_flags=-DNO_SECTIONS\"]\n \tif  { [gdb_compile \"${srcdir}/${subdir}/${srcfile2}\" \"${binfile2}\" \\\n \t\t   executable ${testfile2_opt1}] != \"\"\n \t      && [gdb_compile \"${srcdir}/${subdir}/${srcfile2}\" \"${binfile2}\" \\"
    },
    {
      "sha": "f0ba05f73db20e43e533555f172a4714358fb140",
      "filename": "gdb/testsuite/gdb.threads/tls-nodebug-pie.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.threads/tls-nodebug-pie.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ef69a3ff3f5b2483893c6ce611977a1418de2f6/gdb/testsuite/gdb.threads/tls-nodebug-pie.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.threads/tls-nodebug-pie.exp?ref=6ef69a3ff3f5b2483893c6ce611977a1418de2f6",
      "patch": "@@ -16,7 +16,7 @@\n standard_testfile\n \n if {[gdb_compile_pthreads \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" executable \\\n-\t\t\t  [list \"additional_flags=-fPIE -pie\"]] != \"\" } {\n+\t {pie}] != \"\" } {\n     return -1\n }\n "
    }
  ]
}