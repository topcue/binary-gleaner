{
  "sha": "708dc93ed0c8ee744e2784a1c349d8129a84200f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzA4ZGM5M2VkMGM4ZWU3NDRlMjc4NGExYzM0OWQ4MTI5YTg0MjAwZg==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-04-20T20:17:17Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-05-31T15:13:07Z"
    },
    "message": "Test the | (pipe) command.\n\ngdb/testsuite/ChangeLog\n2019-05-31  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* gdb.base/shell.exp: Test pipe command, $_shell_exitcode,\n\t$_shell_exitsignal.\n\t* gdb.base/default.exp: Update for new convenience variables.",
    "tree": {
      "sha": "fd65e9d3dafd66b43564444886fbd576e4924169",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fd65e9d3dafd66b43564444886fbd576e4924169"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/708dc93ed0c8ee744e2784a1c349d8129a84200f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/708dc93ed0c8ee744e2784a1c349d8129a84200f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/708dc93ed0c8ee744e2784a1c349d8129a84200f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/708dc93ed0c8ee744e2784a1c349d8129a84200f/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "947d39462e26b0edee9b58003ea579552dbf4fa8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/947d39462e26b0edee9b58003ea579552dbf4fa8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/947d39462e26b0edee9b58003ea579552dbf4fa8"
    }
  ],
  "stats": {
    "total": 98,
    "additions": 97,
    "deletions": 1
  },
  "files": [
    {
      "sha": "8d5f6bc63714efe8c05ef0b4f91ecabc00045e40",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/708dc93ed0c8ee744e2784a1c349d8129a84200f/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/708dc93ed0c8ee744e2784a1c349d8129a84200f/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=708dc93ed0c8ee744e2784a1c349d8129a84200f",
      "patch": "@@ -1,3 +1,9 @@\n+2019-05-31  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* gdb.base/shell.exp: Test pipe command, $_shell_exitcode,\n+\t$_shell_exitsignal.\n+\t* gdb.base/default.exp: Update for new convenience variables.\n+\n 2019-05-29  Tom Tromey  <tromey@adacore.com>\n \n \t* gdb.ada/complete.exp (test_gdb_no_completion): Add \"/\" and \"-\""
    },
    {
      "sha": "0325b8045d391b6067e88d5545834d7feccd8703",
      "filename": "gdb/testsuite/gdb.base/default.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/708dc93ed0c8ee744e2784a1c349d8129a84200f/gdb/testsuite/gdb.base/default.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/708dc93ed0c8ee744e2784a1c349d8129a84200f/gdb/testsuite/gdb.base/default.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/default.exp?ref=708dc93ed0c8ee744e2784a1c349d8129a84200f",
      "patch": "@@ -606,6 +606,8 @@ set show_conv_list \\\n \t{$_isvoid = <internal function _isvoid>} \\\n \t{$_gdb_major = 8} \\\n \t{$_gdb_minor = 4} \\\n+\t{$_shell_exitsignal = void} \\\n+\t{$_shell_exitcode = 0} \\\n     }\n if ![skip_python_tests] {\n     append show_conv_list \\"
    },
    {
      "sha": "2136d48919f3444355f69f50bc200d2461ce7b3c",
      "filename": "gdb/testsuite/gdb.base/shell.exp",
      "status": "modified",
      "additions": 89,
      "deletions": 1,
      "changes": 90,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/708dc93ed0c8ee744e2784a1c349d8129a84200f/gdb/testsuite/gdb.base/shell.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/708dc93ed0c8ee744e2784a1c349d8129a84200f/gdb/testsuite/gdb.base/shell.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/shell.exp?ref=708dc93ed0c8ee744e2784a1c349d8129a84200f",
      "patch": "@@ -13,7 +13,7 @@\n # You should have received a copy of the GNU General Public License\n # along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n-# Test that the shell and ! commands work.\n+# Test that the \"shell\", \"!\", \"|\" and \"pipe\" commands work.\n \n gdb_exit\n gdb_start\n@@ -22,3 +22,91 @@ gdb_test \"shell echo foo\" \"foo\"\n \n gdb_test \"! echo foo\" \"foo\"\n gdb_test \"!echo foo\" \"foo\"\n+\n+# Convenience variables with shell command.\n+gdb_test_no_output \"! exit 0\"\n+gdb_test \"p \\$_shell_exitcode\" \" = 0\" \"shell success exitcode\"\n+gdb_test \"p \\$_shell_exitsignal\" \" = void\" \"shell success exitsignal\"\n+\n+gdb_test_no_output \"! exit 1\"\n+gdb_test \"p \\$_shell_exitcode\" \" = 1\" \"shell fail exitcode\"\n+gdb_test \"p \\$_shell_exitsignal\" \" = void\" \"shell fail exitsignal\"\n+\n+gdb_test_no_output \"! kill -2 $$\"\n+gdb_test \"p \\$_shell_exitcode\" \" = void\" \"shell interrupt exitcode\"\n+gdb_test \"p \\$_shell_exitsignal\" \" = 2\" \"shell interrupt exitsignal\"\n+\n+# Define the user command \"foo\", used to test \"pipe\" command.\n+gdb_test_multiple \"define foo\" \"define foo\" {\n+    -re \"End with\"  {\n+\tpass \"define foo\"\n+    }\n+}\n+gdb_test \\\n+    [multi_line_input \\\n+\t { echo coucou\\n }\\\n+\t { echo truc\\n }\\\n+\t { echo machin\\n }\\\n+\t { if $argc > 0 }\\\n+\t { echo $arg0\\n}\\\n+\t {end}\\\n+\t {end}] \\\n+    \"\" \\\n+    \"enter commands\"\n+\n+\n+gdb_test \"pipe foo | wc -l\" \"3\" \"simple pipe\"\n+gdb_test \"pipe foo brol| wc -l\" \"4\" \"simple pipe with arg\"\n+gdb_test \"pipe foo truc2 | grep truc | wc -l\" \"2\" \"double pipe\"\n+\n+gdb_test \"| foo truc2 | grep truc | wc -l\" \"2\" \"double pipe, pipe char\"\n+gdb_test \"|foo|grep truc|wc -l\" \"1\" \"no space around pipe char\"\n+\n+gdb_test \"echo coucou\\\\n\" \"coucou\" \"echo coucou\"\n+gdb_test \"||wc -l\" \"1\" \"repeat previous command\"\n+\n+gdb_test \"| -d ! echo this contains a | character\\\\n ! sed -e 's/|/PIPE/'\" \\\n+    \"this contains a PIPE character\" \"alternate 1char delim\"\n+\n+gdb_test \"|-d ! echo this contains a | character\\\\n!sed -e 's/|/PIPE/'\" \\\n+    \"this contains a PIPE character\" \"alternate 1char delim, no space\"\n+\n+gdb_test \"| -d !!! echo this contains a | character\\\\n !!! sed -e 's/|/PIPE/'\" \\\n+    \"this contains a PIPE character\" \"alternate 3char delim\"\n+\n+gdb_test \"|-d !!! echo this contains a | character\\\\n!!!sed -e 's/|/PIPE/'\" \\\n+    \"this contains a PIPE character\" \"alternate 3char delim, no space\"\n+\n+# Convenience variables with pipe command.\n+gdb_test \"|p 123| exit 0\" \"\"\n+gdb_test \"p \\$_shell_exitcode\" \" = 0\" \"pipe success exitcode\"\n+gdb_test \"p \\$_shell_exitsignal\" \" = void\" \"pipe success exitsignal\"\n+\n+gdb_test \"|p 123| exit 1\" \"\"\n+gdb_test \"p \\$_shell_exitcode\" \" = 1\" \"pipe fail exitcode\"\n+gdb_test \"p \\$_shell_exitsignal\" \" = void\" \"pipe fail exitsignal\"\n+\n+gdb_test \"|p 123| kill -2 $$\" \"\"\n+gdb_test \"p \\$_shell_exitcode\" \" = void\" \"pipe interrupt exitcode\"\n+gdb_test \"p \\$_shell_exitsignal\" \" = 2\" \"pipe interrupt exitsignal\"\n+\n+# Error handling verifications.\n+gdb_test \"|\" \"Missing COMMAND\" \"all missing\"\n+gdb_test \"|-d\" \"Missing delimiter DELIM after -d\" \"-d value missing\"\n+gdb_test \"|-d    \" \"Missing delimiter DELIM after -d\" \"-d spaces value missing\"\n+gdb_test \"| echo coucou\" \\\n+    \"Missing delimiter before SHELL_COMMAND\" \\\n+    \"| delimiter missing\"\n+gdb_test \"|-d DELIM echo coucou\" \\\n+    \"Missing delimiter before SHELL_COMMAND\" \\\n+    \"DELIM delimiter missing\"\n+gdb_test \"|echo coucou|\" \\\n+    \"Missing SHELL_COMMAND\" \\\n+    \"SHELL_COMMAND missing\"\n+gdb_test \"|-d ! echo coucou !\" \\\n+    \"Missing SHELL_COMMAND\" \\\n+    \"SHELL_COMMAND missing with delimiter\"\n+gdb_test \"|-d! echo coucou ! wc\" \\\n+    \"Missing delimiter before SHELL_COMMAND\" \\\n+    \"delimiter missing due to missing space\"\n+"
    }
  ]
}