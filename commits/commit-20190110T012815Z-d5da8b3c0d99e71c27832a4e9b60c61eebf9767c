{
  "sha": "d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDVkYThiM2MwZDk5ZTcxYzI3ODMyYTRlOWI2MGM2MWVlYmY5NzY3Yw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2018-11-24T16:51:44Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-01-10T01:28:15Z"
    },
    "message": "Remove ALL_OBJFILE_FILETABS\n\nThis removes ALL_OBJFILE_FILETABS, replacing its uses with ranged for\nloops.\n\ngdb/ChangeLog\n2019-01-09  Tom Tromey  <tom@tromey.com>\n\n\t* symmisc.c (print_objfile_statistics, dump_objfile)\n\t(maintenance_print_symbols): Use compunit_filetabs.\n\t* source.c (forget_cached_source_info_for_objfile): Use\n\tcompunit_filetabs.\n\t* objfiles.h (ALL_OBJFILE_FILETABS): Remove.\n\t(ALL_FILETABS): Use compunit_filetabs.\n\t* objfiles.c (objfile_relocate1): Use compunit_filetabs.\n\t* coffread.c (coff_symtab_read): Use compunit_filetabs.",
    "tree": {
      "sha": "c4e9e194e65019df77c754dfea3399c34de7080c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c4e9e194e65019df77c754dfea3399c34de7080c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5accd1a07e080c386918da413e0f9e90c4cab58a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5accd1a07e080c386918da413e0f9e90c4cab58a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5accd1a07e080c386918da413e0f9e90c4cab58a"
    }
  ],
  "stats": {
    "total": 137,
    "additions": 81,
    "deletions": 56
  },
  "files": [
    {
      "sha": "d07f2c10fcc64ef74800d772bfb3a7626f5282cb",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
      "patch": "@@ -1,3 +1,14 @@\n+2019-01-09  Tom Tromey  <tom@tromey.com>\n+\n+\t* symmisc.c (print_objfile_statistics, dump_objfile)\n+\t(maintenance_print_symbols): Use compunit_filetabs.\n+\t* source.c (forget_cached_source_info_for_objfile): Use\n+\tcompunit_filetabs.\n+\t* objfiles.h (ALL_OBJFILE_FILETABS): Remove.\n+\t(ALL_FILETABS): Use compunit_filetabs.\n+\t* objfiles.c (objfile_relocate1): Use compunit_filetabs.\n+\t* coffread.c (coff_symtab_read): Use compunit_filetabs.\n+\n 2019-01-09  Tom Tromey  <tom@tromey.com>\n \n \t* symtab.h (ALL_COMPUNIT_FILETABS): Remove."
    },
    {
      "sha": "4f05295712220461d647e01600dfab162e85378d",
      "filename": "gdb/coffread.c",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/coffread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/coffread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/coffread.c?ref=d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
      "patch": "@@ -1203,8 +1203,11 @@ coff_symtab_read (minimal_symbol_reader &reader,\n   /* Patch up any opaque types (references to types that are not defined\n      in the file where they are referenced, e.g. \"struct foo *bar\").  */\n   {\n-    ALL_OBJFILE_FILETABS (objfile, cu, s)\n-      patch_opaque_types (s);\n+    for (compunit_symtab *cu : objfile_compunits (objfile))\n+      {\n+\tfor (symtab *s : compunit_filetabs (cu))\n+\t  patch_opaque_types (s);\n+      }\n   }\n \n   coffread_objfile = NULL;"
    },
    {
      "sha": "75e041ece7fd5d8f33d92a16c833cd58dfda7b4e",
      "filename": "gdb/objfiles.c",
      "status": "modified",
      "additions": 16,
      "deletions": 13,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/objfiles.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/objfiles.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.c?ref=d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
      "patch": "@@ -788,20 +788,23 @@ objfile_relocate1 (struct objfile *objfile,\n \n   /* OK, get all the symtabs.  */\n   {\n-    ALL_OBJFILE_FILETABS (objfile, cust, s)\n-    {\n-      struct linetable *l;\n+    for (compunit_symtab *cust : objfile_compunits (objfile))\n+      {\n+\tfor (symtab *s : compunit_filetabs (cust))\n+\t  {\n+\t    struct linetable *l;\n \n-      /* First the line table.  */\n-      l = SYMTAB_LINETABLE (s);\n-      if (l)\n-\t{\n-\t  for (int i = 0; i < l->nitems; ++i)\n-\t    l->item[i].pc += ANOFFSET (delta,\n-\t\t\t\t       COMPUNIT_BLOCK_LINE_SECTION\n-\t\t\t\t\t (cust));\n-\t}\n-    }\n+\t    /* First the line table.  */\n+\t    l = SYMTAB_LINETABLE (s);\n+\t    if (l)\n+\t      {\n+\t\tfor (int i = 0; i < l->nitems; ++i)\n+\t\t  l->item[i].pc += ANOFFSET (delta,\n+\t\t\t\t\t     COMPUNIT_BLOCK_LINE_SECTION\n+\t\t\t\t\t     (cust));\n+\t      }\n+\t  }\n+      }\n \n     for (compunit_symtab *cust : objfile_compunits (objfile))\n       {"
    },
    {
      "sha": "33acb20e7a18d690c9b5a4813723478f5fea5f73",
      "filename": "gdb/objfiles.h",
      "status": "modified",
      "additions": 4,
      "deletions": 9,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/objfiles.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/objfiles.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.h?ref=d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
      "patch": "@@ -612,12 +612,6 @@ class all_objfiles_safe\n        (obj) != NULL;\t\t\t\t    \\\n        (obj) = (obj)->next)\n \n-/* Traverse all symtabs in one objfile.  */\n-\n-#define ALL_OBJFILE_FILETABS(objfile, cu, s) \\\n-  for (compunit_symtab *cu : objfile_compunits (objfile)) \\\n-    for (symtab *s : compunit_filetabs (cu))\n-\n /* A range adapter that makes it possible to iterate over all\n    compunits in one objfile.  */\n \n@@ -714,9 +708,10 @@ class objfile_msymbols\n /* Traverse all symtabs in all objfiles in the current symbol\n    space.  */\n \n-#define ALL_FILETABS(objfile, ps, s)\t\t\\\n-  ALL_OBJFILES (objfile)\t\t\t\\\n-    ALL_OBJFILE_FILETABS (objfile, ps, s)\n+#define ALL_FILETABS(objfile, ps, s)\t\t\t\t\t\\\n+  ALL_OBJFILES (objfile)\t\t\t\t\t\t\\\n+    for (compunit_symtab *ps : objfile_compunits (objfile))\t\\\n+      for (symtab *s : compunit_filetabs (cu))\n \n #define ALL_OBJFILE_OSECTIONS(objfile, osect)\t\\\n   for (osect = objfile->sections; osect < objfile->sections_end; osect++) \\"
    },
    {
      "sha": "14dda01cb0164cf1644c5fd57c38decd381e6c82",
      "filename": "gdb/source.c",
      "status": "modified",
      "additions": 12,
      "deletions": 9,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/source.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/source.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source.c?ref=d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
      "patch": "@@ -349,17 +349,20 @@ show_directories_command (struct ui_file *file, int from_tty,\n void\n forget_cached_source_info_for_objfile (struct objfile *objfile)\n {\n-  ALL_OBJFILE_FILETABS (objfile, cu, s)\n+  for (compunit_symtab *cu : objfile_compunits (objfile))\n     {\n-      if (s->line_charpos != NULL)\n+      for (symtab *s : compunit_filetabs (cu))\n \t{\n-\t  xfree (s->line_charpos);\n-\t  s->line_charpos = NULL;\n-\t}\n-      if (s->fullname != NULL)\n-\t{\n-\t  xfree (s->fullname);\n-\t  s->fullname = NULL;\n+\t  if (s->line_charpos != NULL)\n+\t    {\n+\t      xfree (s->line_charpos);\n+\t      s->line_charpos = NULL;\n+\t    }\n+\t  if (s->fullname != NULL)\n+\t    {\n+\t      xfree (s->fullname);\n+\t      s->fullname = NULL;\n+\t    }\n \t}\n     }\n "
    },
    {
      "sha": "23d232ca97dba91a0732d3ec11881b34e0c618d3",
      "filename": "gdb/symmisc.c",
      "status": "modified",
      "additions": 33,
      "deletions": 23,
      "changes": 56,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/symmisc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d5da8b3c0d99e71c27832a4e9b60c61eebf9767c/gdb/symmisc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symmisc.c?ref=d5da8b3c0d99e71c27832a4e9b60c61eebf9767c",
      "patch": "@@ -107,11 +107,14 @@ print_objfile_statistics (void)\n       if (objfile->sf)\n \tobjfile->sf->qf->print_stats (objfile);\n       i = linetables = 0;\n-      ALL_OBJFILE_FILETABS (objfile, cu, s)\n+      for (compunit_symtab *cu : objfile_compunits (objfile))\n \t{\n-\t  i++;\n-\t  if (SYMTAB_LINETABLE (s) != NULL)\n-\t    linetables++;\n+\t  for (symtab *s : compunit_filetabs (cu))\n+\t    {\n+\t      i++;\n+\t      if (SYMTAB_LINETABLE (s) != NULL)\n+\t\tlinetables++;\n+\t    }\n \t}\n       blockvectors = std::distance (objfile_compunits (objfile).begin (),\n \t\t\t\t    objfile_compunits (objfile).end ());\n@@ -157,16 +160,20 @@ dump_objfile (struct objfile *objfile)\n   if (objfile->compunit_symtabs != NULL)\n     {\n       printf_filtered (\"Symtabs:\\n\");\n-      ALL_OBJFILE_FILETABS (objfile, cust, symtab)\n+      for (compunit_symtab *cu : objfile_compunits (objfile))\n \t{\n-\t  printf_filtered (\"%s at \", symtab_to_filename_for_display (symtab));\n-\t  gdb_print_host_address (symtab, gdb_stdout);\n-\t  printf_filtered (\", \");\n-\t  if (SYMTAB_OBJFILE (symtab) != objfile)\n+\t  for (symtab *symtab : compunit_filetabs (cu))\n \t    {\n-\t      printf_filtered (\"NOT ON CHAIN!  \");\n+\t      printf_filtered (\"%s at \",\n+\t\t\t       symtab_to_filename_for_display (symtab));\n+\t      gdb_print_host_address (symtab, gdb_stdout);\n+\t      printf_filtered (\", \");\n+\t      if (SYMTAB_OBJFILE (symtab) != objfile)\n+\t\t{\n+\t\t  printf_filtered (\"NOT ON CHAIN!  \");\n+\t\t}\n+\t      wrap_here (\"  \");\n \t    }\n-\t  wrap_here (\"  \");\n \t}\n       printf_filtered (\"\\n\\n\");\n     }\n@@ -477,21 +484,24 @@ maintenance_print_symbols (const char *args, int from_tty)\n \t  if (!print_for_objfile)\n \t    continue;\n \n-\t  ALL_OBJFILE_FILETABS (objfile, cu, s)\n+\t  for (compunit_symtab *cu : objfile_compunits (objfile))\n \t    {\n-\t      int print_for_source = 0;\n-\n-\t      QUIT;\n-\t      if (source_arg != NULL)\n+\t      for (symtab *s : compunit_filetabs (cu))\n \t\t{\n-\t\t  print_for_source\n-\t\t    = compare_filenames_for_search\n-\t\t        (symtab_to_filename_for_display (s), source_arg);\n-\t\t  found = 1;\n+\t\t  int print_for_source = 0;\n+\n+\t\t  QUIT;\n+\t\t  if (source_arg != NULL)\n+\t\t    {\n+\t\t      print_for_source\n+\t\t\t= compare_filenames_for_search\n+\t\t\t(symtab_to_filename_for_display (s), source_arg);\n+\t\t      found = 1;\n+\t\t    }\n+\t\t  if (source_arg == NULL\n+\t\t      || print_for_source)\n+\t\t    dump_symtab (s, outfile);\n \t\t}\n-\t      if (source_arg == NULL\n-\t\t  || print_for_source)\n-\t\tdump_symtab (s, outfile);\n \t    }\n \t}\n "
    }
  ]
}