{
  "sha": "f64eea3a594042c9cf499b17b5b166276275a051",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjY0ZWVhM2E1OTQwNDJjOWNmNDk5YjE3YjViMTY2Mjc2Mjc1YTA1MQ==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2019-09-18T17:33:33Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2019-09-18T17:33:33Z"
    },
    "message": "gdb: remove local extern declaration of cli_styling\n\nFollowing the int -> bool conversion of boolean options (commit\n491144b5e21b (\"Change boolean options to bool instead of int\")), I see\nthis ASAN error:\n\n  ==357543==ERROR: AddressSanitizer: global-buffer-overflow on address 0x55555b25d440 at pc 0x5555583ce9e1 bp 0x7fffffffd390 sp 0x7fffffffd380\n  READ of size 4 at 0x55555b25d440 thread T0\n      #0 0x5555583ce9e0 in term_cli_styling /home/simark/src/binutils-gdb/gdb/ui-file.c:111\n      #1 0x5555583cf8b0 in stdio_file::can_emit_style_escape() /home/simark/src/binutils-gdb/gdb/ui-file.c:308\n      #2 0x5555584450d2 in set_output_style /home/simark/src/binutils-gdb/gdb/utils.c:1442\n      #3 0x5555584491af in fprintf_styled(ui_file*, ui_file_style const&, char const*, ...) /home/simark/src/binutils-gdb/gdb/utils.c:2143\n      #4 0x5555582fa13c in print_gdb_version(ui_file*, bool) /home/simark/src/binutils-gdb/gdb/top.c:1339\n      #5 0x555557b723ab in captured_main_1 /home/simark/src/binutils-gdb/gdb/main.c:981\n      #6 0x555557b7353b in captured_main /home/simark/src/binutils-gdb/gdb/main.c:1172\n      #7 0x555557b735d0 in gdb_main(captured_main_args*) /home/simark/src/binutils-gdb/gdb/main.c:1197\n      #8 0x55555700a53d in main /home/simark/src/binutils-gdb/gdb/gdb.c:32\n      #9 0x7ffff64c9ee2 in __libc_start_main (/usr/lib/libc.so.6+0x26ee2)\n      #10 0x55555700a30d in _start (/home/simark/build/binutils-gdb/gdb/gdb+0x1ab630d)\n\n  0x55555b25d441 is located 0 bytes to the right of global variable 'cli_styling' defined in '/home/simark/src/binutils-gdb/gdb/cli/cli-style.c:31:6' (0x55555b25d440) of size 1\n\nThe reason of this is that we have this declaration of cli_styling in cli/cli-style.h:\n\n  extern bool cli_styling;\n\nbut ui-file.c uses its  own local declaration:\n\n  extern int cli_styling;\n\nBecause of that, the code in ui-file.c thinks the variable is 4 bytes\nlong, when it is actually 1 byte long, so the generated code reads past\nthe variable.\n\nFix it by removing the declaration and making ui-file.c include\ncli/cli-style.h.\n\ngdb/ChangeLog:\n\n\t* ui-file.c: Include cli/cli-style.h.\n\t(term_cli_styling): Remove cli_styling declaration.",
    "tree": {
      "sha": "baa28be363a0bfccaffc074b4546e656db1108a0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/baa28be363a0bfccaffc074b4546e656db1108a0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f64eea3a594042c9cf499b17b5b166276275a051",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f64eea3a594042c9cf499b17b5b166276275a051",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f64eea3a594042c9cf499b17b5b166276275a051",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f64eea3a594042c9cf499b17b5b166276275a051/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b078f3ac8803297bfc8416c20e09d0863c5ac6cc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b078f3ac8803297bfc8416c20e09d0863c5ac6cc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b078f3ac8803297bfc8416c20e09d0863c5ac6cc"
    }
  ],
  "stats": {
    "total": 8,
    "additions": 6,
    "deletions": 2
  },
  "files": [
    {
      "sha": "796ade3c71ff8a2b02c84de98494d1165daf7c91",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f64eea3a594042c9cf499b17b5b166276275a051/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f64eea3a594042c9cf499b17b5b166276275a051/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=f64eea3a594042c9cf499b17b5b166276275a051",
      "patch": "@@ -1,3 +1,8 @@\n+2019-09-18  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* ui-file.c: Include cli/cli-style.h.\n+\t(term_cli_styling): Remove cli_styling declaration.\n+\n 2019-09-18  Alan Modra  <amodra@gmail.com>\n \n \t* arm-tdep.c (arm_record_special_symbol): Update bfd_get_section"
    },
    {
      "sha": "71b74bba19054d35555e25328a1d6fd84fdaddd5",
      "filename": "gdb/ui-file.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f64eea3a594042c9cf499b17b5b166276275a051/gdb/ui-file.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f64eea3a594042c9cf499b17b5b166276275a051/gdb/ui-file.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ui-file.c?ref=f64eea3a594042c9cf499b17b5b166276275a051",
      "patch": "@@ -24,6 +24,7 @@\n #include \"gdb_obstack.h\"\n #include \"gdb_select.h\"\n #include \"gdbsupport/filestuff.h\"\n+#include \"cli/cli-style.h\"\n \n null_file null_stream;\n \n@@ -106,8 +107,6 @@ ui_file_isatty (struct ui_file *file)\n static bool\n term_cli_styling ()\n {\n-  extern int cli_styling;\n-\n   if (!cli_styling)\n     return false;\n "
    }
  ]
}