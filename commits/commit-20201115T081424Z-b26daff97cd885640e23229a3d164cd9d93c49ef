{
  "sha": "b26daff97cd885640e23229a3d164cd9d93c49ef",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjI2ZGFmZjk3Y2Q4ODU2NDBlMjMyMjlhM2QxNjRjZDlkOTNjNDllZg==",
  "commit": {
    "author": {
      "name": "Joel Brobecker",
      "email": "brobecker@adacore.com",
      "date": "2020-11-15T08:14:24Z"
    },
    "committer": {
      "name": "Joel Brobecker",
      "email": "brobecker@adacore.com",
      "date": "2020-11-15T08:14:24Z"
    },
    "message": "fix printing of DWARF fixed-point type objects with format modifier\n\nConsider a fixed-point type such the scaling factor is 1/16,\nas the following Ada code snippet would create:\n\n      type FP1_Type is delta 0.1 range -1.0 .. +1.0;\n      FP1_Var : FP1_Type := 0.25;\n\nPrinting the value of this variable with a format modifier yields\nthe wrong value. E.g.:\n\n    (gdb) p /x fp1_var\n    $6 = 0x4\n\nSince the real value is 0.25, we therefore expected...\n\n    (gdb) p /x fp1_var\n    $6 = 0x0\n\nWhat happens, in this case, is that the value being printed is\nactually the \"raw\" value of our object, before the scaling factor\ngets applied.\n\nThis commit fixes the issue by using approach as for float values,\nwhere we convert the value into an integer value, prior to printing,\nknowing that the conversion takes the scaling factor into account.\n\ngdb/ChangeLog:\n\n        * printcmd.c (print_scalar_formatted): Add fixed-point type\n        handling when options->format is set.\n\ngdb/testsuite/ChangeLog:\n\n        * gdb.dwarf2/dw2-fixed-point.exp: Add \"print /x\" tests.",
    "tree": {
      "sha": "d32c394299fd968d93abeb4c49615dbb041443c0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d32c394299fd968d93abeb4c49615dbb041443c0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b26daff97cd885640e23229a3d164cd9d93c49ef",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b26daff97cd885640e23229a3d164cd9d93c49ef",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b26daff97cd885640e23229a3d164cd9d93c49ef",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b26daff97cd885640e23229a3d164cd9d93c49ef/comments",
  "author": {
    "login": "brobecke",
    "id": 11981700,
    "node_id": "MDQ6VXNlcjExOTgxNzAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11981700?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brobecke",
    "html_url": "https://github.com/brobecke",
    "followers_url": "https://api.github.com/users/brobecke/followers",
    "following_url": "https://api.github.com/users/brobecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/brobecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brobecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brobecke/subscriptions",
    "organizations_url": "https://api.github.com/users/brobecke/orgs",
    "repos_url": "https://api.github.com/users/brobecke/repos",
    "events_url": "https://api.github.com/users/brobecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brobecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "brobecke",
    "id": 11981700,
    "node_id": "MDQ6VXNlcjExOTgxNzAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11981700?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brobecke",
    "html_url": "https://github.com/brobecke",
    "followers_url": "https://api.github.com/users/brobecke/followers",
    "following_url": "https://api.github.com/users/brobecke/following{/other_user}",
    "gists_url": "https://api.github.com/users/brobecke/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brobecke/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brobecke/subscriptions",
    "organizations_url": "https://api.github.com/users/brobecke/orgs",
    "repos_url": "https://api.github.com/users/brobecke/repos",
    "events_url": "https://api.github.com/users/brobecke/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brobecke/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0958441403b92163dff851f0a78241c7fcb4e8eb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0958441403b92163dff851f0a78241c7fcb4e8eb",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0958441403b92163dff851f0a78241c7fcb4e8eb"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 23,
    "deletions": 1
  },
  "files": [
    {
      "sha": "0d322da69c505e7733de3f83e588543612d705a9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=b26daff97cd885640e23229a3d164cd9d93c49ef",
      "patch": "@@ -1,3 +1,8 @@\n+2020-11-15  Joel Brobecker  <brobecker@adacore.com>\n+\n+\t* printcmd.c (print_scalar_formatted): Add fixed-point type\n+\thandling when options->format is set.\n+\n 2020-11-15  Joel Brobecker  <brobecker@adacore.com>\n \n \t* ada-valprint.c (ada_value_print_1): Add fixed-point type handling."
    },
    {
      "sha": "665142446f4bd2be7eb19f063fbedf29733f80ac",
      "filename": "gdb/printcmd.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/printcmd.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/printcmd.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/printcmd.c?ref=b26daff97cd885640e23229a3d164cd9d93c49ef",
      "patch": "@@ -421,7 +421,8 @@ print_scalar_formatted (const gdb_byte *valaddr, struct type *type,\n      range case, we want to avoid this, so we store the unpacked value\n      here for possible use later.  */\n   gdb::optional<LONGEST> val_long;\n-  if ((type->code () == TYPE_CODE_FLT\n+  if (((type->code () == TYPE_CODE_FLT\n+\t|| is_fixed_point_type (type))\n        && (options->format == 'o'\n \t   || options->format == 'x'\n \t   || options->format == 't'"
    },
    {
      "sha": "9b9ffe51133bb575a7e80d42ae41beecaa5b00a6",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=b26daff97cd885640e23229a3d164cd9d93c49ef",
      "patch": "@@ -1,3 +1,7 @@\n+2020-11-15  Joel Brobecker  <brobecker@adacore.com>\n+\n+\t* gdb.dwarf2/dw2-fixed-point.exp: Add \"print /x\" tests.\n+\n 2020-11-15  Joel Brobecker  <brobecker@adacore.com>\n \n \t* gdb.ada/fixed_cmp.exp: Force compilation to use -fgnat-encodings=all."
    },
    {
      "sha": "27c549c602f481b073c5f8eb9cd1f4e2ae4d98c7",
      "filename": "gdb/testsuite/gdb.dwarf2/dw2-fixed-point.exp",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/testsuite/gdb.dwarf2/dw2-fixed-point.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b26daff97cd885640e23229a3d164cd9d93c49ef/gdb/testsuite/gdb.dwarf2/dw2-fixed-point.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/dw2-fixed-point.exp?ref=b26daff97cd885640e23229a3d164cd9d93c49ef",
      "patch": "@@ -122,11 +122,23 @@ gdb_test_no_output \"set lang ada\"\n gdb_test \"print pck.fp1_var\" \\\n          \" = 0.25\"\n \n+gdb_test \"print /x pck.fp1_var\" \\\n+         \" = 0x0\"\n+\n gdb_test \"print pck.fp2_var\" \\\n          \" = -0.01\"\n \n+gdb_test \"print /x pck.fp2_var\" \\\n+         \" = 0x0\"\n+\n gdb_test \"print pck.fp3_var\" \\\n          \" = 0.1\"\n \n+gdb_test \"print /x pck.fp3_var\" \\\n+         \" = 0x0\"\n+\n gdb_test \"print pck.fp1_range_var\" \\\n          \" = 1\"\n+\n+gdb_test \"print /x pck.fp1_range_var\" \\\n+         \" = 0x1\""
    }
  ]
}