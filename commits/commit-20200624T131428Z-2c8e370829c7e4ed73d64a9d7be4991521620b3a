{
  "sha": "2c8e370829c7e4ed73d64a9d7be4991521620b3a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmM4ZTM3MDgyOWM3ZTRlZDczZDY0YTlkN2JlNDk5MTUyMTYyMGIzYQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-06-24T13:14:18Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-06-24T13:14:28Z"
    },
    "message": "csky: Don't generate unnecessary dynamic tags\n\nDynamic tags, DT_JMPREL, PLTREL and PLTRELSZ, are needed only if there\nare relocation entries for PLT.  Don't generate them if there are no\nrelocation entries for PLT.\n\nbfd/\n\n\tPR ld/26083\n\t* elf32-csky.c (csky_elf_size_dynamic_sections): Call\n\t_bfd_elf_add_dynamic_tags.\n\nld/\n\n\tPR ld/26083\n\t* testsuite/ld-csky/tls-ie-v1.d: Updated.\n\t* testsuite/ld-csky/tls-ie.d: Likewise.",
    "tree": {
      "sha": "86627221051f1bdbc01a5fdb9350c4715a990b20",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/86627221051f1bdbc01a5fdb9350c4715a990b20"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2c8e370829c7e4ed73d64a9d7be4991521620b3a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2c8e370829c7e4ed73d64a9d7be4991521620b3a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2c8e370829c7e4ed73d64a9d7be4991521620b3a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2c8e370829c7e4ed73d64a9d7be4991521620b3a/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c679ec98a1296d8da3b5920a9058ba14b47ca3a4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c679ec98a1296d8da3b5920a9058ba14b47ca3a4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c679ec98a1296d8da3b5920a9058ba14b47ca3a4"
    }
  ],
  "stats": {
    "total": 67,
    "additions": 16,
    "deletions": 51
  },
  "files": [
    {
      "sha": "943139ebf4f786d618f0447688537e3a2c7db732",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2c8e370829c7e4ed73d64a9d7be4991521620b3a/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2c8e370829c7e4ed73d64a9d7be4991521620b3a/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=2c8e370829c7e4ed73d64a9d7be4991521620b3a",
      "patch": "@@ -1,3 +1,9 @@\n+2020-06-24  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/26083\n+\t* elf32-csky.c (csky_elf_size_dynamic_sections): Call\n+\t_bfd_elf_add_dynamic_tags.\n+\n 2020-06-24  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/26083"
    },
    {
      "sha": "ea58e14c004b6075e4d4ca11395dfc24fde07774",
      "filename": "bfd/elf32-csky.c",
      "status": "modified",
      "additions": 2,
      "deletions": 43,
      "changes": 45,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2c8e370829c7e4ed73d64a9d7be4991521620b3a/bfd/elf32-csky.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2c8e370829c7e4ed73d64a9d7be4991521620b3a/bfd/elf32-csky.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-csky.c?ref=2c8e370829c7e4ed73d64a9d7be4991521620b3a",
      "patch": "@@ -2093,49 +2093,8 @@ csky_elf_size_dynamic_sections (bfd *output_bfd ATTRIBUTE_UNUSED,\n     }\n \n   if (htab->elf.dynamic_sections_created)\n-    {\n-      /* Add some entries to the .dynamic section.  We fill in the\n-\t values later, in csky_elf_finish_dynamic_sections, but we\n-\t must add the entries now so that we get the correct size for\n-\t the .dynamic section.  The DT_DEBUG entry is filled in by the\n-\t dynamic linker and used by the debugger.  */\n-#define add_dynamic_entry(TAG, VAL) \\\n-  _bfd_elf_add_dynamic_entry (info, TAG, VAL)\n-\n-      if (bfd_link_executable (info) && !add_dynamic_entry (DT_DEBUG, 0))\n-\treturn FALSE;\n-\n-      if (htab->elf.sgot->size != 0 || htab->elf.splt->size)\n-\t{\n-\t  if (!add_dynamic_entry (DT_PLTGOT, 0)\n-\t      || !add_dynamic_entry (DT_PLTRELSZ, 0)\n-\t      || !add_dynamic_entry (DT_PLTREL, DT_RELA)\n-\t      || !add_dynamic_entry (DT_JMPREL, 0))\n-\t    return FALSE;\n-\t}\n-\n-      if (relocs)\n-\t{\n-\t  if (!add_dynamic_entry (DT_RELA, 0)\n-\t      || !add_dynamic_entry (DT_RELASZ, 0)\n-\t      || !add_dynamic_entry (DT_RELAENT,\n-\t\t\t\t     sizeof (Elf32_External_Rela)))\n-\t    return FALSE;\n-\n-\t  /* If any dynamic relocs apply to a read-only section,\n-\t     then we need a DT_TEXTREL entry.  */\n-\t  if ((info->flags & DF_TEXTREL) == 0)\n-\t    elf_link_hash_traverse (&htab->elf,\n-\t\t\t\t    _bfd_elf_maybe_set_textrel, info);\n-\n-\t  if ((info->flags & DF_TEXTREL) != 0\n-\t      && !add_dynamic_entry (DT_TEXTREL, 0))\n-\t    return FALSE;\n-\t}\n-    }\n-#undef add_dynamic_entry\n-\n-  return TRUE;\n+    htab->elf.dt_pltgot_required = htab->elf.sgot->size != 0;\n+  return _bfd_elf_add_dynamic_tags (output_bfd, info, relocs);\n }\n \n /* Finish up dynamic symbol handling.  We set the contents of various"
    },
    {
      "sha": "bf171da0fa9014b67519d8b48a3a8996cc87118b",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2c8e370829c7e4ed73d64a9d7be4991521620b3a/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2c8e370829c7e4ed73d64a9d7be4991521620b3a/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=2c8e370829c7e4ed73d64a9d7be4991521620b3a",
      "patch": "@@ -1,3 +1,9 @@\n+2020-06-24  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/26083\n+\t* testsuite/ld-csky/tls-ie-v1.d: Updated.\n+\t* testsuite/ld-csky/tls-ie.d: Likewise.\n+\n 2020-06-24  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/26083"
    },
    {
      "sha": "af1858c3b81a0dc4a911689eede19a4ec0eeb4b8",
      "filename": "ld/testsuite/ld-csky/tls-ie-v1.d",
      "status": "modified",
      "additions": 1,
      "deletions": 4,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2c8e370829c7e4ed73d64a9d7be4991521620b3a/ld/testsuite/ld-csky/tls-ie-v1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2c8e370829c7e4ed73d64a9d7be4991521620b3a/ld/testsuite/ld-csky/tls-ie-v1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-csky/tls-ie-v1.d?ref=2c8e370829c7e4ed73d64a9d7be4991521620b3a",
      "patch": "@@ -4,17 +4,14 @@\n #ld: -shared --hash-style=sysv\n #readelf: -d -r\n \n-Dynamic section at offset 0x[0-9a-f]+ contains 13 entries:\n+Dynamic section at offset 0x[0-9a-f]+ contains 10 entries:\n   Tag        Type                         Name/Value\n  0x00000004 \\(HASH\\)                       .*\n  0x00000005 \\(STRTAB\\)                     .*\n  0x00000006 \\(SYMTAB\\)                     .*\n  0x0000000a \\(STRSZ\\)                      .* \\(bytes\\)\n  0x0000000b \\(SYMENT\\)                     .* \\(bytes\\)\n  0x00000003 \\(PLTGOT\\)                     0x[0-9a-f]+\n- 0x00000002 \\(PLTRELSZ\\)                   0 \\(bytes\\)\n- 0x00000014 \\(PLTREL\\)                     RELA\n- 0x00000017 \\(JMPREL\\)                     0x[0-9a-f]+\n  0x00000007 \\(RELA\\)                       0x[0-9a-f]+\n  0x00000008 \\(RELASZ\\)                     12 \\(bytes\\)\n  0x00000009 \\(RELAENT\\)                    12 \\(bytes\\)"
    },
    {
      "sha": "38c2a911def1cf06ea3b320ad656015802261ce3",
      "filename": "ld/testsuite/ld-csky/tls-ie.d",
      "status": "modified",
      "additions": 1,
      "deletions": 4,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2c8e370829c7e4ed73d64a9d7be4991521620b3a/ld/testsuite/ld-csky/tls-ie.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2c8e370829c7e4ed73d64a9d7be4991521620b3a/ld/testsuite/ld-csky/tls-ie.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-csky/tls-ie.d?ref=2c8e370829c7e4ed73d64a9d7be4991521620b3a",
      "patch": "@@ -3,17 +3,14 @@\n #ld: -shared --hash-style=sysv\n #readelf: -d -r\n \n-Dynamic section at offset 0x[0-9a-f]+ contains 13 entries:\n+Dynamic section at offset 0x[0-9a-f]+ contains 10 entries:\n   Tag        Type                         Name/Value\n  0x00000004 \\(HASH\\)                       .*\n  0x00000005 \\(STRTAB\\)                     .*\n  0x00000006 \\(SYMTAB\\)                     .*\n  0x0000000a \\(STRSZ\\)                      .* \\(bytes\\)\n  0x0000000b \\(SYMENT\\)                     .* \\(bytes\\)\n  0x00000003 \\(PLTGOT\\)                     0x[0-9a-f]+\n- 0x00000002 \\(PLTRELSZ\\)                   0 \\(bytes\\)\n- 0x00000014 \\(PLTREL\\)                     RELA\n- 0x00000017 \\(JMPREL\\)                     0x[0-9a-f]+\n  0x00000007 \\(RELA\\)                       0x[0-9a-f]+\n  0x00000008 \\(RELASZ\\)                     12 \\(bytes\\)\n  0x00000009 \\(RELAENT\\)                    12 \\(bytes\\)"
    }
  ]
}