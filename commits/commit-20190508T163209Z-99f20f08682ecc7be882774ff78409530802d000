{
  "sha": "99f20f08682ecc7be882774ff78409530802d000",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTlmMjBmMDg2ODJlY2M3YmU4ODI3NzRmZjc4NDA5NTMwODAyZDAwMA==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-05-01T17:13:31Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-05-08T16:32:09Z"
    },
    "message": "Fix style bug when paging\n\nPhilippe pointed out a styling bug that would occur in some conditions\nwhen paging:\n\n    https://sourceware.org/ml/gdb-patches/2019-04/msg00101.html\n\nI was finally able to reproduce this, and this patch fixes the bug.\n\nThe problem occurred when text overflowed the line, causing a\npagination prompt, but when no wrap column had been set.  In this\ncase, the current style was reset to show the prompt, but then not\nreset back to the previously applied style before emitting the rest of\nthe line.\n\nThe fix is to record the applied style in this case, and re-apply it\nafterward -- but only if the pager prompt was emitted, something that\nthe existing style.exp pointed out on the first, more naive, version\nof the patch.\n\nTested on x86-64 Fedora 29.\n\ngdb/ChangeLog\n2019-05-08  Tom Tromey  <tromey@adacore.com>\n\n\t* utils.c (fputs_maybe_filtered): Reset style after paging, even\n\twhen no wrap column is set.",
    "tree": {
      "sha": "90335855e5d39c61fd09f5a5b40aef30b39be386",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/90335855e5d39c61fd09f5a5b40aef30b39be386"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/99f20f08682ecc7be882774ff78409530802d000",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/99f20f08682ecc7be882774ff78409530802d000",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/99f20f08682ecc7be882774ff78409530802d000",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/99f20f08682ecc7be882774ff78409530802d000/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "80e55b132940813fa454da2592a31db6c8af85f1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/80e55b132940813fa454da2592a31db6c8af85f1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/80e55b132940813fa454da2592a31db6c8af85f1"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 26,
    "deletions": 3
  },
  "files": [
    {
      "sha": "ca20a7c365461612d90bb264d9471ac3ff4f0a76",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99f20f08682ecc7be882774ff78409530802d000/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99f20f08682ecc7be882774ff78409530802d000/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=99f20f08682ecc7be882774ff78409530802d000",
      "patch": "@@ -1,3 +1,8 @@\n+2019-05-08  Tom Tromey  <tromey@adacore.com>\n+\n+\t* utils.c (fputs_maybe_filtered): Reset style after paging, even\n+\twhen no wrap column is set.\n+\n 2019-05-08  Tom Tromey  <tromey@adacore.com>\n \n \t* c-lang.c (c_get_string): Handle non-C-style arrays."
    },
    {
      "sha": "10fa5bcce64f35201dc30d92011c94b8d76ed616",
      "filename": "gdb/utils.c",
      "status": "modified",
      "additions": 21,
      "deletions": 3,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99f20f08682ecc7be882774ff78409530802d000/gdb/utils.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99f20f08682ecc7be882774ff78409530802d000/gdb/utils.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/utils.c?ref=99f20f08682ecc7be882774ff78409530802d000",
      "patch": "@@ -1772,10 +1772,20 @@ fputs_maybe_filtered (const char *linebuffer, struct ui_file *stream,\n \t    {\n \t      unsigned int save_chars = chars_printed;\n \n+\t      /* If we change the style, below, we'll want to reset it\n+\t\t before continuing to print.  If there is no wrap\n+\t\t column, then we'll only reset the style if the pager\n+\t\t prompt is given; and to avoid emitting style\n+\t\t sequences in the middle of a run of text, we track\n+\t\t this as well.  */\n+\t      ui_file_style save_style;\n+\t      bool did_paginate = false;\n+\n \t      chars_printed = 0;\n \t      lines_printed++;\n \t      if (wrap_column)\n \t\t{\n+\t\t  save_style = wrap_style;\n \t\t  if (stream->can_emit_style_escape ())\n \t\t    emit_style_escape (ui_file_style (), stream);\n \t\t  /* If we aren't actually wrapping, don't output\n@@ -1785,21 +1795,27 @@ fputs_maybe_filtered (const char *linebuffer, struct ui_file *stream,\n \t\t  fputc_unfiltered ('\\n', stream);\n \t\t}\n \t      else\n-\t\tflush_wrap_buffer (stream);\n+\t\t{\n+\t\t  save_style = applied_style;\n+\t\t  flush_wrap_buffer (stream);\n+\t\t}\n \n \t      /* Possible new page.  Note that\n \t\t PAGINATION_DISABLED_FOR_COMMAND might be set during\n \t\t this loop, so we must continue to check it here.  */\n \t      if (lines_printed >= lines_per_page - 1\n \t\t  && !pagination_disabled_for_command)\n-\t\tprompt_for_continue ();\n+\t\t{\n+\t\t  prompt_for_continue ();\n+\t\t  did_paginate = true;\n+\t\t}\n \n \t      /* Now output indentation and wrapped string.  */\n \t      if (wrap_column)\n \t\t{\n \t\t  fputs_unfiltered (wrap_indent, stream);\n \t\t  if (stream->can_emit_style_escape ())\n-\t\t    emit_style_escape (wrap_style, stream);\n+\t\t    emit_style_escape (save_style, stream);\n \t\t  /* FIXME, this strlen is what prevents wrap_indent from\n \t\t     containing tabs.  However, if we recurse to print it\n \t\t     and count its chars, we risk trouble if wrap_indent is\n@@ -1810,6 +1826,8 @@ fputs_maybe_filtered (const char *linebuffer, struct ui_file *stream,\n \t\t    + (save_chars - wrap_column);\n \t\t  wrap_column = 0;\t/* And disable fancy wrap */\n \t\t}\n+\t      else if (did_paginate && can_emit_style_escape (stream))\n+\t\temit_style_escape (save_style, stream);\n \t    }\n \t}\n "
    }
  ]
}