{
  "sha": "27cce8667f5c897751bb10d7c859b02b0bb26291",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjdjY2U4NjY3ZjVjODk3NzUxYmIxMGQ3Yzg1OWIwMmIwYmIyNjI5MQ==",
  "commit": {
    "author": {
      "name": "Matthew Malcomson",
      "email": "matthew.malcomson@arm.com",
      "date": "2019-11-07T17:03:54Z"
    },
    "committer": {
      "name": "Matthew Malcomson",
      "email": "matthew.malcomson@arm.com",
      "date": "2019-11-07T17:03:54Z"
    },
    "message": "[Patch][binutils][arm] .bfloat16 directive for Arm [6/X]\n\nHi,\n\nThis patch is part of a series that adds support for Armv8.6-A\n(Matrix Multiply and BFloat16 extensions) to binutils.\n\nThis patch implements the '.bfloat16' directive for the Arm backend.\n\nThe syntax for the directive is:\n  .bfloat16 <0-n numbers>\ne.g.\n  .bfloat16 12.0\n  .bfloat16 0.123, 1.0, NaN, 5\n\nThis is implemented by utilizing the ieee_atof_detail function (included\nin the previous patch) in order to encode the slightly different\nbfloat16 format.\n\nAdded testcases to verify the correct encoding for various bfloat16\nvalues (NaN, Infinity (+ & -), normals, subnormals etc...).\n\nCross compiled and tested on arm-none-eabi and arm-none-linux-gnueabihf\nwith no issues.\n\nCommitted on behalf of Mihail Ionescu.\n\ngas/ChangeLog:\n\n2019-10-21  Mihail Ionescu  <mihail.ionescu@arm.com>\n2019-10-21  Barnaby Wilks  <barnaby.wilks@arm.com>\n\n\t* config/tc-arm.c (md_atof): Add encoding for bfloat16\n\t* testsuite/gas/arm/bfloat16-directive-le.d: New test.\n\t* testsuite/gas/arm/bfloat16-directive-be.d: New test.\n\t* testsuite/gas/arm/bfloat16-directive.s: New test.\n\nIs it ok for trunk?\n\nRegards,\nMihail",
    "tree": {
      "sha": "6446644127a180b49c1171e4188a3be68d5e14f7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6446644127a180b49c1171e4188a3be68d5e14f7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/27cce8667f5c897751bb10d7c859b02b0bb26291",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/27cce8667f5c897751bb10d7c859b02b0bb26291",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/27cce8667f5c897751bb10d7c859b02b0bb26291",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/27cce8667f5c897751bb10d7c859b02b0bb26291/comments",
  "author": {
    "login": "mmalcomson",
    "id": 57484298,
    "node_id": "MDQ6VXNlcjU3NDg0Mjk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/57484298?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mmalcomson",
    "html_url": "https://github.com/mmalcomson",
    "followers_url": "https://api.github.com/users/mmalcomson/followers",
    "following_url": "https://api.github.com/users/mmalcomson/following{/other_user}",
    "gists_url": "https://api.github.com/users/mmalcomson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mmalcomson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mmalcomson/subscriptions",
    "organizations_url": "https://api.github.com/users/mmalcomson/orgs",
    "repos_url": "https://api.github.com/users/mmalcomson/repos",
    "events_url": "https://api.github.com/users/mmalcomson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mmalcomson/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "mmalcomson",
    "id": 57484298,
    "node_id": "MDQ6VXNlcjU3NDg0Mjk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/57484298?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mmalcomson",
    "html_url": "https://github.com/mmalcomson",
    "followers_url": "https://api.github.com/users/mmalcomson/followers",
    "following_url": "https://api.github.com/users/mmalcomson/following{/other_user}",
    "gists_url": "https://api.github.com/users/mmalcomson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mmalcomson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mmalcomson/subscriptions",
    "organizations_url": "https://api.github.com/users/mmalcomson/orgs",
    "repos_url": "https://api.github.com/users/mmalcomson/repos",
    "events_url": "https://api.github.com/users/mmalcomson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mmalcomson/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c96f148b7bcaad8b6f1191faafbcd6c8cfdee7a3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c96f148b7bcaad8b6f1191faafbcd6c8cfdee7a3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c96f148b7bcaad8b6f1191faafbcd6c8cfdee7a3"
    }
  ],
  "stats": {
    "total": 96,
    "additions": 96,
    "deletions": 0
  },
  "files": [
    {
      "sha": "ce2bfdc0d350cfb83761e025085678f8032f5cf3",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=27cce8667f5c897751bb10d7c859b02b0bb26291",
      "patch": "@@ -1,3 +1,11 @@\n+2019-11-07  Mihail Ionescu  <mihail.ionescu@arm.com>\n+2019-11-07  Barnaby Wilks  <barnaby.wilks@arm.com>\n+\n+\t* config/tc-arm.c (md_atof): Add encoding for bfloat16\n+\t* testsuite/gas/arm/bfloat16-directive-le.d: New test.\n+\t* testsuite/gas/arm/bfloat16-directive-be.d: New test.\n+\t* testsuite/gas/arm/bfloat16-directive.s: New test.\n+\n 2019-11-07  Mihail Ionescu  <mihail.ionescu@arm.com>\n 2019-11-07  Barnaby Wilks  <barnaby.wilks@arm.com>\n "
    },
    {
      "sha": "1d735a731ebbb500dbb6dbdd7393ff851e9d6d86",
      "filename": "gas/config/tc-arm.c",
      "status": "modified",
      "additions": 47,
      "deletions": 0,
      "changes": 47,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/config/tc-arm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/config/tc-arm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-arm.c?ref=27cce8667f5c897751bb10d7c859b02b0bb26291",
      "patch": "@@ -1218,6 +1218,52 @@ md_atof (int type, char * litP, int * sizeP)\n       prec = 1;\n       break;\n \n+    /* If this is a bfloat16, then parse it slightly differently, as it\n+       does not follow the IEEE specification for floating point numbers\n+       exactly.  */\n+    case 'b':\n+      {\n+\tFLONUM_TYPE generic_float;\n+\n+\tt = atof_ieee_detail (input_line_pointer, 1, 8, words, &generic_float);\n+\n+\tif (t)\n+\t  input_line_pointer = t;\n+\telse\n+\t  return _(\"invalid floating point number\");\n+\n+\tswitch (generic_float.sign)\n+\t  {\n+\t  /* Is +Inf.  */\n+\t  case 'P':\n+\t    words[0] = 0x7f80;\n+\t    break;\n+\n+\t  /* Is -Inf.  */\n+\t  case 'N':\n+\t    words[0] = 0xff80;\n+\t    break;\n+\n+\t  /* Is NaN.  */\n+\t  /* bfloat16 has two types of NaN - quiet and signalling.\n+\t     Quiet NaN has bit[6] == 1 && faction != 0, whereas\n+\t     signalling NaN's have bit[0] == 0 && fraction != 0.\n+\t     Chosen this specific encoding as it is the same form\n+\t     as used by other IEEE 754 encodings in GAS.  */\n+\t  case 0:\n+\t    words[0] = 0x7fff;\n+\t    break;\n+\n+\t  default:\n+\t    break;\n+\t  }\n+\n+\t*sizeP = 2;\n+\n+\tmd_number_to_chars (litP, (valueT) words[0], sizeof (LITTLENUM_TYPE));\n+\n+\treturn NULL;\n+      }\n     case 'f':\n     case 'F':\n     case 's':\n@@ -5088,6 +5134,7 @@ const pseudo_typeS md_pseudo_table[] =\n   { \"extend\",\t   float_cons, 'x' },\n   { \"ldouble\",\t   float_cons, 'x' },\n   { \"packed\",\t   float_cons, 'p' },\n+  { \"bfloat16\",\t   float_cons, 'b' },\n #ifdef TE_PE\n   {\"secrel32\", pe_directive_secrel, 0},\n #endif"
    },
    {
      "sha": "8862f8302f7f101715a032614c1a6d2c4e3cf5a9",
      "filename": "gas/testsuite/gas/arm/bfloat16-directive-be.d",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/testsuite/gas/arm/bfloat16-directive-be.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/testsuite/gas/arm/bfloat16-directive-be.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/bfloat16-directive-be.d?ref=27cce8667f5c897751bb10d7c859b02b0bb26291",
      "patch": "@@ -0,0 +1,11 @@\n+# name: Big endian bfloat16 literal directives\n+# source: bfloat16-directive.s\n+# objdump: -s --section=.data\n+# as: -mbig-endian\n+\n+.*: +file format .*\n+\n+Contents of section \\.data:\n+ 0000 41403dfc 000042f7 8000c2f7 7fff7f80  .*\n+ 0010 ff807f7f ff7f0080 80800001 8001007f  .*\n+ 0020 807f3f80 bf804000 c0000000           .*"
    },
    {
      "sha": "da94b6b254c5b7889b0690535bea464e8c83bbf9",
      "filename": "gas/testsuite/gas/arm/bfloat16-directive-le.d",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/testsuite/gas/arm/bfloat16-directive-le.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/testsuite/gas/arm/bfloat16-directive-le.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/bfloat16-directive-le.d?ref=27cce8667f5c897751bb10d7c859b02b0bb26291",
      "patch": "@@ -0,0 +1,11 @@\n+# name: Little endian bfloat16 literal directives\n+# source: bfloat16-directive.s\n+# objdump: -s --section=.data\n+# as: -mlittle-endian\n+\n+.*: +file format .*\n+\n+Contents of section \\.data:\n+ 0000 4041fc3d 0000f742 0080f7c2 ff7f807f  .*\n+ 0010 80ff7f7f 7fff8000 80800100 01807f00  .*\n+ 0020 7f80803f 80bf0040 00c00000           .*"
    },
    {
      "sha": "bffba758303f0209a55ebaf1b4bfe78d5df1568c",
      "filename": "gas/testsuite/gas/arm/bfloat16-directive.s",
      "status": "added",
      "additions": 19,
      "deletions": 0,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/testsuite/gas/arm/bfloat16-directive.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/27cce8667f5c897751bb10d7c859b02b0bb26291/gas/testsuite/gas/arm/bfloat16-directive.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/bfloat16-directive.s?ref=27cce8667f5c897751bb10d7c859b02b0bb26291",
      "patch": "@@ -0,0 +1,19 @@\n+.data\n+\t.bfloat16 12.0\n+\t.bfloat16 0.123\n+\t.bfloat16 +0.0\n+\t.bfloat16 123.4\n+\t.bfloat16 -0.0\n+\t.bfloat16 -123.4\n+\t.bfloat16 NaN\n+\t.bfloat16 Inf\n+\t.bfloat16 -Inf\n+\t.bfloat16 3.390e+38\n+\t.bfloat16 -3.390e+38\n+\t.bfloat16 1.175e-38\n+\t.bfloat16 -1.175e-38\n+\t.bfloat16 9.194e-41\n+\t.bfloat16 -9.194e-41\n+\t.bfloat16 1.167e-38\n+\t.bfloat16 -1.167e-38\n+\t.bfloat16 1.0, -1, 2.0, -2, 0"
    }
  ]
}