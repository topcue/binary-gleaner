{
  "sha": "b863685d70199489b3fe27abedfb1eb6d1452b7d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Yjg2MzY4NWQ3MDE5OTQ4OWIzZmUyN2FiZWRmYjFlYjZkMTQ1MmI3ZA==",
  "commit": {
    "author": {
      "name": "Richard Bunt",
      "email": "richard.bunt@arm.com",
      "date": "2019-07-10T13:14:16Z"
    },
    "committer": {
      "name": "Richard Bunt",
      "email": "richard.bunt@arm.com",
      "date": "2019-07-10T13:14:16Z"
    },
    "message": "Restore original GDB prompt in define.exp\n\ndefine.exp will fail on a GDB which has set a custom prompt to identify\nitself.  This is because the test resets the prompt to a hard coded\n\"(gdb)\" but then verifies the success of this against the value in\n$gdb_prompt, which is set to the custom prompt.\n\nThe original approach to fix this involved resetting the prompt to\n$gdb_prompt rather than a hard coded \"(gdb)\". However it was noted during\nreview that $gdb_prompt is a regular expression rather than a string.\nThis is problematic because in general the prompt would be reset to a\nregular expression rather than an instance of a string accepted by said\nregular expression.\n\nThe fix used in this commit avoids the above issue by capturing the\nliteral prompt from running \"show prompt\" and uses this literal to\nrestore the previous prompt.\n\nRegression tested with GCC 7.3.0 on x86_64, ppc64le, aarch64.\n\ngdb/testsuite/ChangeLog:\n2019-07-10  Richard Bunt  <richard.bunt@arm.com>\n\tStephen Roberts  <stephen.roberts@arm.com>\n\n\t* gdb.base/define.exp: Restore original prompt.",
    "tree": {
      "sha": "2be7f7da8ce08d824d88fedba1f8937b01778756",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2be7f7da8ce08d824d88fedba1f8937b01778756"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b863685d70199489b3fe27abedfb1eb6d1452b7d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b863685d70199489b3fe27abedfb1eb6d1452b7d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b863685d70199489b3fe27abedfb1eb6d1452b7d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b863685d70199489b3fe27abedfb1eb6d1452b7d/comments",
  "author": {
    "login": "RichardABunt",
    "id": 84915683,
    "node_id": "MDQ6VXNlcjg0OTE1Njgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/84915683?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RichardABunt",
    "html_url": "https://github.com/RichardABunt",
    "followers_url": "https://api.github.com/users/RichardABunt/followers",
    "following_url": "https://api.github.com/users/RichardABunt/following{/other_user}",
    "gists_url": "https://api.github.com/users/RichardABunt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RichardABunt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RichardABunt/subscriptions",
    "organizations_url": "https://api.github.com/users/RichardABunt/orgs",
    "repos_url": "https://api.github.com/users/RichardABunt/repos",
    "events_url": "https://api.github.com/users/RichardABunt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RichardABunt/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "RichardABunt",
    "id": 84915683,
    "node_id": "MDQ6VXNlcjg0OTE1Njgz",
    "avatar_url": "https://avatars.githubusercontent.com/u/84915683?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RichardABunt",
    "html_url": "https://github.com/RichardABunt",
    "followers_url": "https://api.github.com/users/RichardABunt/followers",
    "following_url": "https://api.github.com/users/RichardABunt/following{/other_user}",
    "gists_url": "https://api.github.com/users/RichardABunt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RichardABunt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RichardABunt/subscriptions",
    "organizations_url": "https://api.github.com/users/RichardABunt/orgs",
    "repos_url": "https://api.github.com/users/RichardABunt/repos",
    "events_url": "https://api.github.com/users/RichardABunt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RichardABunt/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "166a82be89008621a31e6e56b2d52a049b53e341",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/166a82be89008621a31e6e56b2d52a049b53e341",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/166a82be89008621a31e6e56b2d52a049b53e341"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 15,
    "deletions": 1
  },
  "files": [
    {
      "sha": "0118420abc31628a6f29cca45d721a44658539ca",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b863685d70199489b3fe27abedfb1eb6d1452b7d/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b863685d70199489b3fe27abedfb1eb6d1452b7d/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=b863685d70199489b3fe27abedfb1eb6d1452b7d",
      "patch": "@@ -1,3 +1,8 @@\n+2019-07-10  Richard Bunt  <richard.bunt@arm.com>\n+\tStephen Roberts  <stephen.roberts@arm.com>\n+\n+\t* gdb.base/define.exp: Restore original prompt.\n+\n 2019-07-09  Pedro Alves  <palves@redhat.com>\n \n \t* gdb.cp/catch-multi-stdlib.exp: Adjust expected \"info"
    },
    {
      "sha": "e8508b8728dcaa953fb861d481e0356ca5aeaa10",
      "filename": "gdb/testsuite/gdb.base/define.exp",
      "status": "modified",
      "additions": 10,
      "deletions": 1,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b863685d70199489b3fe27abedfb1eb6d1452b7d/gdb/testsuite/gdb.base/define.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b863685d70199489b3fe27abedfb1eb6d1452b7d/gdb/testsuite/gdb.base/define.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/define.exp?ref=b863685d70199489b3fe27abedfb1eb6d1452b7d",
      "patch": "@@ -283,6 +283,15 @@ gdb_test_multiple \"define target hookpost-testsuite\" \"\" {\n \n gdb_test \"target testsuite\" \"one\\r\\nhello\\r\\ntwo\" \"target testsuite with hooks\"\n \n+# Save the GDB prompt so it can be restored to the original value later.\n+set prior_prompt \"\"\n+gdb_test_multiple \"show prompt\" \"save gdb_prompt\" {\n+    -re \"Gdb's prompt is \\\"($gdb_prompt) \\\"\\.\\[\\r\\n\\]*$gdb_prompt $\" {\n+\tset prior_prompt $expect_out(1,string)\n+\tpass \"save gdb_prompt\"\n+    }\n+}\n+\n # This is a quasi-define command: Verify that the user can redefine\n # GDB's gdb_prompt.\n #\n@@ -292,7 +301,7 @@ gdb_test_multiple \"set prompt \\\\(blah\\\\) \" \"set gdb_prompt\" {\n     }\n }\n \n-gdb_test_multiple \"set prompt \\\\(gdb\\\\) \" \"reset gdb_prompt\" {\n+gdb_test_multiple \"set prompt $prior_prompt \" \"reset gdb_prompt\" {\n     -re \"$gdb_prompt $\" {\n \tpass \"reset gdb_prompt\"\n     }"
    }
  ]
}