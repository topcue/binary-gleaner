{
  "sha": "77208eb7e24a2bad8771f3958d9cd2e06144c654",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzcyMDhlYjdlMjRhMmJhZDg3NzFmMzk1OGQ5Y2QyZTA2MTQ0YzY1NA==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-07-22T13:56:07Z"
    },
    "committer": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-07-22T13:56:07Z"
    },
    "message": "gdb/jit: move cached_code_address and jit_breakpoint to jiter_objfile_data\n\nThis is in preparation for allowing more than one JITer objfile per\nprogram space.  Once we do that, each JITer objfile will have its own\nJIT breakpoint (on the __jit_debug_register_code function it provides).\nThe cached_code_address field is just the runtime / relocated address of\nthat symbol.\n\nSince they are going to become JITer-objfile-specific and not\nprogram-space-specific, move these fields from jit_program_space_data to\njiter_objfile_data.\n\ngdb/ChangeLog:\n2020-07-22  Simon Marchi  <simon.marchi@polymtl.ca>\n\n\t* jit.h (struct jiter_objfile_data) <cached_code_address,\n\tjit_breakpoint>: Move to here from ...\n\t* jit.c (jit_program_space_data): ... here.\n\t(jiter_objfile_data::~jiter_objfile_data): Update.\n\t(jit_breakpoint_deleted): Update.\n\t(jit_breakpoint_re_set_internal): Update.",
    "tree": {
      "sha": "0bbf3164f475c3cd20ede6f9f15abfea98e62749",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0bbf3164f475c3cd20ede6f9f15abfea98e62749"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/77208eb7e24a2bad8771f3958d9cd2e06144c654",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/77208eb7e24a2bad8771f3958d9cd2e06144c654",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/77208eb7e24a2bad8771f3958d9cd2e06144c654",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/77208eb7e24a2bad8771f3958d9cd2e06144c654/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8c1c720faa4fb1ddc0c89dd60979361a8e11268a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8c1c720faa4fb1ddc0c89dd60979361a8e11268a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8c1c720faa4fb1ddc0c89dd60979361a8e11268a"
    }
  ],
  "stats": {
    "total": 58,
    "additions": 34,
    "deletions": 24
  },
  "files": [
    {
      "sha": "3a3866a44f75ffdbc1ede8776b5ce2a6052b47a5",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/77208eb7e24a2bad8771f3958d9cd2e06144c654/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/77208eb7e24a2bad8771f3958d9cd2e06144c654/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=77208eb7e24a2bad8771f3958d9cd2e06144c654",
      "patch": "@@ -1,3 +1,12 @@\n+2020-07-22  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* jit.h (struct jiter_objfile_data) <cached_code_address,\n+\tjit_breakpoint>: Move to here from ...\n+\t* jit.c (jit_program_space_data): ... here.\n+\t(jiter_objfile_data::~jiter_objfile_data): Update.\n+\t(jit_breakpoint_deleted): Update.\n+\t(jit_breakpoint_re_set_internal): Update.\n+\n 2020-07-22  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* jit.c (jiter_objfile_data::~jiter_objfile_data): Remove some"
    },
    {
      "sha": "562c76330cb84d3f70cbf389a2e54c363762db43",
      "filename": "gdb/jit.c",
      "status": "modified",
      "additions": 17,
      "deletions": 24,
      "changes": 41,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/77208eb7e24a2bad8771f3958d9cd2e06144c654/gdb/jit.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/77208eb7e24a2bad8771f3958d9cd2e06144c654/gdb/jit.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/jit.c?ref=77208eb7e24a2bad8771f3958d9cd2e06144c654",
      "patch": "@@ -248,17 +248,6 @@ struct jit_program_space_data\n      symbols.  */\n \n   struct objfile *objfile = nullptr;\n-\n-  /* If this program space has __jit_debug_register_code, this is the\n-     cached address from the minimal symbol.  This is used to detect\n-     relocations requiring the breakpoint to be re-created.  */\n-\n-  CORE_ADDR cached_code_address = 0;\n-\n-  /* This is the JIT event breakpoint, or NULL if it has not been\n-     set.  */\n-\n-  struct breakpoint *jit_breakpoint = nullptr;\n };\n \n static program_space_key<jit_program_space_data> jit_program_space_key;\n@@ -273,11 +262,9 @@ jiter_objfile_data::~jiter_objfile_data ()\n   gdb_assert (ps_data != nullptr);\n   gdb_assert (ps_data->objfile == this->objfile);\n \n-  ps_data->objfile = NULL;\n-  if (ps_data->jit_breakpoint != NULL)\n-    delete_breakpoint (ps_data->jit_breakpoint);\n-\n-  ps_data->cached_code_address = 0;\n+  ps_data->objfile = nullptr;\n+  if (this->jit_breakpoint != nullptr)\n+    delete_breakpoint (this->jit_breakpoint);\n }\n \n /* Fetch the jiter_objfile_data associated with OBJF.  If no data exists\n@@ -924,10 +911,16 @@ jit_breakpoint_deleted (struct breakpoint *b)\n       struct jit_program_space_data *ps_data;\n \n       ps_data = jit_program_space_key.get (iter->pspace);\n-      if (ps_data != NULL && ps_data->jit_breakpoint == iter->owner)\n+      if (ps_data != nullptr && ps_data->objfile != nullptr)\n \t{\n-\t  ps_data->cached_code_address = 0;\n-\t  ps_data->jit_breakpoint = NULL;\n+\t  objfile *objf = ps_data->objfile;\n+\t  jiter_objfile_data *jiter_data = objf->jiter_data.get ();\n+\n+\t  if (jiter_data->jit_breakpoint == iter->owner)\n+\t    {\n+\t      jiter_data->cached_code_address = 0;\n+\t      jiter_data->jit_breakpoint = nullptr;\n+\t    }\n \t}\n     }\n }\n@@ -976,16 +969,16 @@ jit_breakpoint_re_set_internal (struct gdbarch *gdbarch,\n \t\t\t\"breakpoint_addr = %s\\n\",\n \t\t\tpaddress (gdbarch, addr));\n \n-  if (ps_data->cached_code_address == addr)\n+  if (objf_data->cached_code_address == addr)\n     return true;\n \n   /* Delete the old breakpoint.  */\n-  if (ps_data->jit_breakpoint != NULL)\n-    delete_breakpoint (ps_data->jit_breakpoint);\n+  if (objf_data->jit_breakpoint != nullptr)\n+    delete_breakpoint (objf_data->jit_breakpoint);\n \n   /* Put a breakpoint in the registration symbol.  */\n-  ps_data->cached_code_address = addr;\n-  ps_data->jit_breakpoint = create_jit_event_breakpoint (gdbarch, addr);\n+  objf_data->cached_code_address = addr;\n+  objf_data->jit_breakpoint = create_jit_event_breakpoint (gdbarch, addr);\n \n   return true;\n }"
    },
    {
      "sha": "b78c35d518478ea6f75245ceb7de3c800a2fb18d",
      "filename": "gdb/jit.h",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/77208eb7e24a2bad8771f3958d9cd2e06144c654/gdb/jit.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/77208eb7e24a2bad8771f3958d9cd2e06144c654/gdb/jit.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/jit.h?ref=77208eb7e24a2bad8771f3958d9cd2e06144c654",
      "patch": "@@ -86,6 +86,14 @@ struct jiter_objfile_data\n \n   /* Symbol for __jit_debug_descriptor.  */\n   minimal_symbol *descriptor = nullptr;\n+\n+  /* This is the relocated address of the __jit_debug_register_code function\n+     provided by this objfile.  This is used to detect relocations changes\n+     requiring the breakpoint to be re-created.  */\n+  CORE_ADDR cached_code_address = 0;\n+\n+  /* This is the JIT event breakpoint, or nullptr if it has been deleted.  */\n+  breakpoint *jit_breakpoint = nullptr;\n };\n \n /* An objfile that is the product of JIT compilation and was registered"
    }
  ]
}