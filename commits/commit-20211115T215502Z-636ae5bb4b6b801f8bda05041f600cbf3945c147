{
  "sha": "636ae5bb4b6b801f8bda05041f600cbf3945c147",
  "node_id": "C_kwDOANOeidoAKDYzNmFlNWJiNGI2YjgwMWY4YmRhMDUwNDFmNjAwY2JmMzk0NWMxNDc",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-11-15T21:55:02Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-11-15T21:55:02Z"
    },
    "message": "[gdb] Don't use gdb_stdlog for inferior-events\n\nThe test-case gdb.base/foll-vfork.exp contains:\n...\nif [gdb_debug_enabled] {\n    untested \"debug is enabled\"\n    return 0\n}\n...\n\nTo understand what it does, I disabled this bit and ran with GDB_DEBUG=infrun,\nlike so:\n...\n$ cd $build/gdb/testsuite\n$ make check GDB_DEBUG=infrun RUNTESTFLAGS=gdb.base/foll-vfork.exp\n...\nand ran into:\n...\n(gdb) PASS: gdb.base/foll-vfork.exp: exec: \\\n  vfork parent follow, through step: set follow-fork parent\nnext^M\n33        if (pid == 0) {^M\n(gdb) FAIL: gdb.base/foll-vfork.exp: exec: \\\n  vfork parent follow, through step: step\n...\n\nThe problem is that the test-case expects:\n...\n(gdb) PASS: gdb.base/foll-vfork.exp: exec: \\\n  vfork parent follow, through step: set follow-fork parent\nnext^M\n[Detaching after vfork from child process 28169]^M\n33        if (pid == 0) {^M\n(gdb) PASS: gdb.base/foll-vfork.exp: exec: \\\n  vfork parent follow, through step: step\n...\nbut the \"Detaching\" line has been redirected to\n$outputs/gdb.base/foll-vfork/gdb.debug.\n\nI looked at the documentation of \"set logging debugredirect [on|off]\":\n...\n  By default, GDB debug output will go to both the terminal and the logfile.\n  Set debugredirect if you want debug output to go only to the log file.\n...\nand my interpretation of it was that \"debug output\" did not match the\n\"messages\" description of inferior-events:\n...\nThe set print inferior-events command allows you to enable or disable printing\nof messages when GDB notices that new inferiors have started or that inferiors\nhave exited or have been detached.\n...\n\nFix the discrepancy by not using gdb_stdlog for inferior-events.\n\nUpdate the gdb.base/foll-vfork.exp test-case to not require\ngdb_debug_enabled == 0.\n\nTested on x86_64-linux.\n\nTested test-case gdb.base/foll-vfork.exp with and without GDB_DEBUG=infrun.",
    "tree": {
      "sha": "6fd2ce7e13b3613033bd15bf46273e05fce1a8a2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6fd2ce7e13b3613033bd15bf46273e05fce1a8a2"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/636ae5bb4b6b801f8bda05041f600cbf3945c147",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/636ae5bb4b6b801f8bda05041f600cbf3945c147",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/636ae5bb4b6b801f8bda05041f600cbf3945c147",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/636ae5bb4b6b801f8bda05041f600cbf3945c147/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d029b54d9c57232b812a32889b445f0db8958e0a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d029b54d9c57232b812a32889b445f0db8958e0a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d029b54d9c57232b812a32889b445f0db8958e0a"
    }
  ],
  "stats": {
    "total": 40,
    "additions": 14,
    "deletions": 26
  },
  "files": [
    {
      "sha": "64e535a34773e605cb77b8493f74c6e0b232d27d",
      "filename": "gdb/infrun.c",
      "status": "modified",
      "additions": 14,
      "deletions": 19,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/636ae5bb4b6b801f8bda05041f600cbf3945c147/gdb/infrun.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/636ae5bb4b6b801f8bda05041f600cbf3945c147/gdb/infrun.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/infrun.c?ref=636ae5bb4b6b801f8bda05041f600cbf3945c147",
      "patch": "@@ -455,10 +455,9 @@ holding the child stopped.  Try \\\"set detach-on-fork\\\" or \\\n \t      ptid_t process_ptid = ptid_t (child_ptid.pid ());\n \n \t      target_terminal::ours_for_output ();\n-\t      fprintf_filtered (gdb_stdlog,\n-\t\t\t\t_(\"[Detaching after %s from child %s]\\n\"),\n-\t\t\t\thas_vforked ? \"vfork\" : \"fork\",\n-\t\t\t\ttarget_pid_to_str (process_ptid).c_str ());\n+\t      printf_filtered (_(\"[Detaching after %s from child %s]\\n\"),\n+\t\t\t       has_vforked ? \"vfork\" : \"fork\",\n+\t\t\t       target_pid_to_str (process_ptid).c_str ());\n \t    }\n \t}\n       else\n@@ -522,11 +521,10 @@ holding the child stopped.  Try \\\"set detach-on-fork\\\" or \\\n \t  std::string child_pid = target_pid_to_str (child_ptid);\n \n \t  target_terminal::ours_for_output ();\n-\t  fprintf_filtered (gdb_stdlog,\n-\t\t\t    _(\"[Attaching after %s %s to child %s]\\n\"),\n-\t\t\t    parent_pid.c_str (),\n-\t\t\t    has_vforked ? \"vfork\" : \"fork\",\n-\t\t\t    child_pid.c_str ());\n+\t  printf_filtered (_(\"[Attaching after %s %s to child %s]\\n\"),\n+\t\t\t   parent_pid.c_str (),\n+\t\t\t   has_vforked ? \"vfork\" : \"fork\",\n+\t\t\t   child_pid.c_str ());\n \t}\n \n       /* Add the new inferior first, so that the target_detach below\n@@ -634,10 +632,9 @@ holding the child stopped.  Try \\\"set detach-on-fork\\\" or \\\n \t      ptid_t process_ptid = ptid_t (parent_ptid.pid ());\n \n \t      target_terminal::ours_for_output ();\n-\t      fprintf_filtered (gdb_stdlog,\n-\t\t\t\t_(\"[Detaching after fork from \"\n-\t\t\t\t  \"parent %s]\\n\"),\n-\t\t\t\ttarget_pid_to_str (process_ptid).c_str ());\n+\t      printf_filtered (_(\"[Detaching after fork from \"\n+\t\t\t\t \"parent %s]\\n\"),\n+\t\t\t       target_pid_to_str (process_ptid).c_str ());\n \t    }\n \n \t  target_detach (parent_inf, 0);\n@@ -957,15 +954,13 @@ handle_vfork_child_exec_or_exit (int exec)\n \n \t      if (exec)\n \t\t{\n-\t\t  fprintf_filtered (gdb_stdlog,\n-\t\t\t\t    _(\"[Detaching vfork parent %s \"\n-\t\t\t\t      \"after child exec]\\n\"), pidstr.c_str ());\n+\t\t  printf_filtered (_(\"[Detaching vfork parent %s \"\n+\t\t\t\t     \"after child exec]\\n\"), pidstr.c_str ());\n \t\t}\n \t      else\n \t\t{\n-\t\t  fprintf_filtered (gdb_stdlog,\n-\t\t\t\t    _(\"[Detaching vfork parent %s \"\n-\t\t\t\t      \"after child exit]\\n\"), pidstr.c_str ());\n+\t\t  printf_filtered (_(\"[Detaching vfork parent %s \"\n+\t\t\t\t     \"after child exit]\\n\"), pidstr.c_str ());\n \t\t}\n \t    }\n "
    },
    {
      "sha": "5de0795d60a8521d9e492f431bb85219dd78702f",
      "filename": "gdb/testsuite/gdb.base/foll-vfork.exp",
      "status": "modified",
      "additions": 0,
      "deletions": 7,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/636ae5bb4b6b801f8bda05041f600cbf3945c147/gdb/testsuite/gdb.base/foll-vfork.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/636ae5bb4b6b801f8bda05041f600cbf3945c147/gdb/testsuite/gdb.base/foll-vfork.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/foll-vfork.exp?ref=636ae5bb4b6b801f8bda05041f600cbf3945c147",
      "patch": "@@ -25,13 +25,6 @@ if {![istarget \"*-linux*\"]} then {\n     continue\n }\n \n-# Test relies on checking follow-fork output. Do not run if gdb debug is\n-# enabled as it will be redirected to the log.\n-if [gdb_debug_enabled] {\n-    untested \"debug is enabled\"\n-    return 0\n-}\n-\n standard_testfile\n \n set compile_options debug"
    }
  ]
}