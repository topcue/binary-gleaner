{
  "sha": "dd17020328b4ebf45be26eed156fba3d269096f6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGQxNzAyMDMyOGI0ZWJmNDViZTI2ZWVkMTU2ZmJhM2QyNjkwOTZmNg==",
  "commit": {
    "author": {
      "name": "Tejas Belagod",
      "email": "tejas.belagod@arm.com",
      "date": "2021-04-09T11:29:32Z"
    },
    "committer": {
      "name": "Tamar Christina",
      "email": "tamar.christina@arm.com",
      "date": "2021-04-09T11:32:00Z"
    },
    "message": "AArch64: Fix Diagnostic messaging for LD/ST Exclusive.\n\nA summary of what this patch set fixes:\n\nFor instructions\n\n\tSTXR w0,x2,[x0]\n\tSTLXR w0,x2,[x0]\n\nThe warning we emit currently is misleading:\n\nWarning: unpredictable: identical transfer and status registers --`stlxr w0,x2,[x0]'\nWarning: unpredictable: identical transfer and status registers --`stxr w0,x2,[x0]'\n\nit ought to be:\n\nWarning: unpredictable: identical base and status registers --`stlxr w0,x2,[x0]'\nWarning: unpredictable: identical base and status registers --`stxr w0,x2,[x0]'\n\nFor instructions:\n\n\tldaxp x0,x0,[x0]\n\tldxp x0,x0,[x0]\n\nThe warning we emit is incorrect\n\nWarning: unpredictable: identical transfer and status registers --`ldaxp x0,x0,[x0]'\nWarning: unpredictable: identical transfer and status registers --`ldxp x0,x0,[x0]'\n\nit ought to be:\n\nWarning: unpredictable load of register pair -- `ldaxp x0,x0,[x0]'\nWarning: unpredictable load of register pair -- `ldxp x0,x0,[x0]'\n\nFor instructions\n\n\tstlxp   w0, x2, x2, [x0]\n\tstxp    w0, x2, x2, [x0]\n\nWe don't emit any warning when it ought to be:\n\nWarning: unpredictable: identical base and status registers --`stlxp w0,x2,x2,[x0]'\nWarning: unpredictable: identical base and status registers --`stxp w0,x2,x2,[x0]'\n\ngas/ChangeLog:\n\n2021-04-09  Tejas Belagod  <tejas.belagod@arm.com>\n\n\t* config/tc-aarch64.c (warn_unpredictable_ldst): Clean-up diagnostic messages\n\tfor LD/ST Exclusive instructions.\n\t* testsuite/gas/aarch64/diagnostic.s: Add a diagnostic test for STLXP.\n\t* testsuite/gas/aarch64/diagnostic.l: Fix-up test after message clean-up.",
    "tree": {
      "sha": "7379b8370b03e1789cb7c12b3d0e0920f8c291a8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7379b8370b03e1789cb7c12b3d0e0920f8c291a8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/dd17020328b4ebf45be26eed156fba3d269096f6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dd17020328b4ebf45be26eed156fba3d269096f6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/dd17020328b4ebf45be26eed156fba3d269096f6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dd17020328b4ebf45be26eed156fba3d269096f6/comments",
  "author": {
    "login": "tejas-belagod-arm",
    "id": 92718852,
    "node_id": "U_kgDOBYbHBA",
    "avatar_url": "https://avatars.githubusercontent.com/u/92718852?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tejas-belagod-arm",
    "html_url": "https://github.com/tejas-belagod-arm",
    "followers_url": "https://api.github.com/users/tejas-belagod-arm/followers",
    "following_url": "https://api.github.com/users/tejas-belagod-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/tejas-belagod-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tejas-belagod-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tejas-belagod-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/tejas-belagod-arm/orgs",
    "repos_url": "https://api.github.com/users/tejas-belagod-arm/repos",
    "events_url": "https://api.github.com/users/tejas-belagod-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tejas-belagod-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "TamarChristinaArm",
    "id": 48126768,
    "node_id": "MDQ6VXNlcjQ4MTI2NzY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TamarChristinaArm",
    "html_url": "https://github.com/TamarChristinaArm",
    "followers_url": "https://api.github.com/users/TamarChristinaArm/followers",
    "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}",
    "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions",
    "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs",
    "repos_url": "https://api.github.com/users/TamarChristinaArm/repos",
    "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "52efda8266cb1f8ade0193f45801fdd6e42165ac",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/52efda8266cb1f8ade0193f45801fdd6e42165ac",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/52efda8266cb1f8ade0193f45801fdd6e42165ac"
    }
  ],
  "stats": {
    "total": 67,
    "additions": 53,
    "deletions": 14
  },
  "files": [
    {
      "sha": "13e427284ec08e1c68d43e85b20c993f8a42da2d",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dd17020328b4ebf45be26eed156fba3d269096f6/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dd17020328b4ebf45be26eed156fba3d269096f6/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=dd17020328b4ebf45be26eed156fba3d269096f6",
      "patch": "@@ -1,3 +1,10 @@\n+2021-04-09  Tejas Belagod  <tejas.belagod@arm.com>\n+\n+\t* config/tc-aarch64.c (warn_unpredictable_ldst): Clean-up diagnostic messages\n+\tfor LD/ST Exclusive instructions.\n+\t* testsuite/gas/aarch64/diagnostic.s: Add a diagnostic test for STLXP.\n+\t* testsuite/gas/aarch64/diagnostic.l: Fix-up test after message clean-up.\n+\n 2021-04-09  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/gas/ppc/prefix-pcrel.d: Update expected output."
    },
    {
      "sha": "69705521f008b13c4ebf56e5ea8092b8b6cda090",
      "filename": "gas/config/tc-aarch64.c",
      "status": "modified",
      "additions": 39,
      "deletions": 8,
      "changes": 47,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dd17020328b4ebf45be26eed156fba3d269096f6/gas/config/tc-aarch64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dd17020328b4ebf45be26eed156fba3d269096f6/gas/config/tc-aarch64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-aarch64.c?ref=dd17020328b4ebf45be26eed156fba3d269096f6",
      "patch": "@@ -7156,18 +7156,49 @@ warn_unpredictable_ldst (aarch64_instruction *instr, char *str)\n       break;\n \n     case ldstexcl:\n-      /* It is unpredictable if the destination and status registers are the\n-\t same.  */\n       if ((aarch64_get_operand_class (opnds[0].type)\n \t   == AARCH64_OPND_CLASS_INT_REG)\n \t  && (aarch64_get_operand_class (opnds[1].type)\n-\t      == AARCH64_OPND_CLASS_INT_REG)\n-\t  && (opnds[0].reg.regno == opnds[1].reg.regno\n-\t      || opnds[0].reg.regno == opnds[2].reg.regno))\n-\tas_warn (_(\"unpredictable: identical transfer and status registers\"\n-\t\t   \" --`%s'\"),\n-\t\t str);\n+\t      == AARCH64_OPND_CLASS_INT_REG))\n+\t{\n+          if ((opcode->opcode & (1 << 22)))\n+\t    {\n+\t      /* It is unpredictable if load-exclusive pair with Rt == Rt2.  */\n+\t      if ((opcode->opcode & (1 << 21))\n+\t\t  && opnds[0].reg.regno == opnds[1].reg.regno)\n+\t\tas_warn (_(\"unpredictable load of register pair -- `%s'\"), str);\n+\t    }\n+\t  else\n+\t    {\n+\t      /*  Store-Exclusive is unpredictable if Rt == Rs.  */\n+\t      if (opnds[0].reg.regno == opnds[1].reg.regno)\n+\t\tas_warn\n+\t\t  (_(\"unpredictable: identical transfer and status registers\"\n+\t\t     \" --`%s'\"),str);\n \n+\t      if (opnds[0].reg.regno == opnds[2].reg.regno)\n+\t\t{\n+\t\t  if (!(opcode->opcode & (1 << 21)))\n+\t            /*  Store-Exclusive is unpredictable if Rn == Rs.  */\n+\t\t    as_warn\n+\t\t      (_(\"unpredictable: identical base and status registers\"\n+\t\t\t \" --`%s'\"),str);\n+\t\t  else\n+\t            /*  Store-Exclusive pair is unpredictable if Rt2 == Rs.  */\n+\t\t    as_warn\n+\t\t      (_(\"unpredictable: \"\n+\t\t\t \"identical transfer and status registers\"\n+\t\t\t \" --`%s'\"),str);\n+\t\t}\n+\n+\t      /* Store-Exclusive pair is unpredictable if Rn == Rs.  */\n+\t      if ((opcode->opcode & (1 << 21))\n+\t\t  && opnds[0].reg.regno == opnds[3].reg.regno\n+\t\t  && opnds[3].reg.regno != REG_SP)\n+\t\tas_warn (_(\"unpredictable: identical base and status registers\"\n+\t\t\t   \" --`%s'\"),str);\n+\t    }\n+\t}\n       break;\n \n     default:"
    },
    {
      "sha": "5158d41cd43b3706c78be45ff958850dbafa02e8",
      "filename": "gas/testsuite/gas/aarch64/diagnostic.l",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dd17020328b4ebf45be26eed156fba3d269096f6/gas/testsuite/gas/aarch64/diagnostic.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dd17020328b4ebf45be26eed156fba3d269096f6/gas/testsuite/gas/aarch64/diagnostic.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/diagnostic.l?ref=dd17020328b4ebf45be26eed156fba3d269096f6",
      "patch": "@@ -175,11 +175,11 @@\n [^:]*:304: Warning: unpredictable: identical transfer and status registers --`stlxrb w26,w26,\\[x0\\]'\n [^:]*:305: Warning: unpredictable: identical transfer and status registers --`stlxrh w26,w26,\\[x1\\]'\n [^:]*:306: Warning: unpredictable: identical transfer and status registers --`stlxr w26,w26,\\[x2\\]'\n-[^:]*:307: Warning: unpredictable: identical transfer and status registers --`stlxrb w26,w27,\\[x26\\]'\n-[^:]*:308: Warning: unpredictable: identical transfer and status registers --`stlxrh w26,w27,\\[x26\\]'\n-[^:]*:309: Warning: unpredictable: identical transfer and status registers --`stlxr w26,w27,\\[x26\\]'\n-[^:]*:310: Warning: unpredictable: identical transfer and status registers --`stlxr w26,x27,\\[x26\\]'\n+[^:]*:307: Warning: unpredictable: identical base and status registers --`stlxrb w26,w27,\\[x26\\]'\n+[^:]*:308: Warning: unpredictable: identical base and status registers --`stlxrh w26,w27,\\[x26\\]'\n+[^:]*:309: Warning: unpredictable: identical base and status registers --`stlxr w26,w27,\\[x26\\]'\n+[^:]*:310: Warning: unpredictable: identical base and status registers --`stlxr w26,x27,\\[x26\\]'\n [^:]*:311: Warning: unpredictable: identical transfer and status registers --`stlxr w26,x26,\\[x3\\]'\n-[^:]*:312: Warning: unpredictable: identical transfer and status registers --`ldxp x26,x26,\\[x5\\]'\n-[^:]*:313: Warning: unpredictable: identical transfer and status registers --`ldxp x26,x1,\\[x26\\]'\n+[^:]*:312: Warning: unpredictable load of register pair -- `ldxp x26,x26,\\[x5\\]'\n [^:]*:314: Error: expected element type rather than vector type at operand 1 -- `st4 {v0\\.16b-v3\\.16b}\\[4\\],\\[x0\\]'\n+[^:]*:315: Warning: unpredictable: identical base and status registers --`stlxp w3,w26,w26,\\[x3\\]'"
    },
    {
      "sha": "0ebe85ac59d709e2f9253c0656cbd4cf3a6ea2d4",
      "filename": "gas/testsuite/gas/aarch64/diagnostic.s",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dd17020328b4ebf45be26eed156fba3d269096f6/gas/testsuite/gas/aarch64/diagnostic.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dd17020328b4ebf45be26eed156fba3d269096f6/gas/testsuite/gas/aarch64/diagnostic.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/diagnostic.s?ref=dd17020328b4ebf45be26eed156fba3d269096f6",
      "patch": "@@ -312,3 +312,4 @@\n \tldxp\tx26, x26, [x5]\n \tldxp\tx26, x1, [x26]\n \tst4\t{v0.16b-v3.16b}[4], [x0]\n+\tstlxp\tw3, w26, w26, [x3]"
    }
  ]
}