{
  "sha": "6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmM3Nzc5YjM0YjM4Y2E3MWRmOTQ2MGMwN2JjNGMwM2QwMWRmYWEwYg==",
  "commit": {
    "author": {
      "name": "Zoran Zaric",
      "email": "Zoran.Zaric@amd.com",
      "date": "2020-10-09T10:22:23Z"
    },
    "committer": {
      "name": "Zoran Zaric",
      "email": "zoran.zaric@amd.com",
      "date": "2021-08-05T15:39:27Z"
    },
    "message": "Remove get_frame_cfa from dwarf_expr_context\n\nFollowing the idea of merging the evaluators, the get_frame_cfa method\ncan be moved from dwarf_expr_executor and dwarf_evaluate_loc_desc\nclasses to their base class dwarf_expr_context. Once this is done,\nit becomes apparent that the method is only called once and it can be\ninlined.\n\nIt is also necessary to check if the frame context information was\nprovided before the DW_OP_call_frame_cfa operation is executed.\n\ngdb/ChangeLog:\n\n\t* dwarf2/expr.c (dwarf_expr_context::get_frame_cfa): Remove\n\tmethod.\n\t(dwarf_expr_context::execute_stack_op): Call frame context info\n\tcheck for DW_OP_call_frame_cfa. Remove use of get_frame_cfa.\n\t* dwarf2/expr.h (dwarf_expr_context::get_frame_cfa): Remove\n\tmethod.\n\t* dwarf2/frame.c (dwarf_expr_context::get_frame_cfa): Remove\n\tmethod.\n\t* dwarf2/loc.c (dwarf_expr_context::get_frame_cfa): Remove\n\tmethod.",
    "tree": {
      "sha": "4a2d0ea8953c4544e6c23f6cc36c206df391e611",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4a2d0ea8953c4544e6c23f6cc36c206df391e611"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/comments",
  "author": {
    "login": "ZaricZoran",
    "id": 81635026,
    "node_id": "MDQ6VXNlcjgxNjM1MDI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/81635026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZaricZoran",
    "html_url": "https://github.com/ZaricZoran",
    "followers_url": "https://api.github.com/users/ZaricZoran/followers",
    "following_url": "https://api.github.com/users/ZaricZoran/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZaricZoran/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZaricZoran/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZaricZoran/subscriptions",
    "organizations_url": "https://api.github.com/users/ZaricZoran/orgs",
    "repos_url": "https://api.github.com/users/ZaricZoran/repos",
    "events_url": "https://api.github.com/users/ZaricZoran/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZaricZoran/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ZaricZoran",
    "id": 81635026,
    "node_id": "MDQ6VXNlcjgxNjM1MDI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/81635026?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ZaricZoran",
    "html_url": "https://github.com/ZaricZoran",
    "followers_url": "https://api.github.com/users/ZaricZoran/followers",
    "following_url": "https://api.github.com/users/ZaricZoran/following{/other_user}",
    "gists_url": "https://api.github.com/users/ZaricZoran/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ZaricZoran/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ZaricZoran/subscriptions",
    "organizations_url": "https://api.github.com/users/ZaricZoran/orgs",
    "repos_url": "https://api.github.com/users/ZaricZoran/repos",
    "events_url": "https://api.github.com/users/ZaricZoran/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ZaricZoran/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "62e37eac1c5b9e4805d40715e7570f7146caa788",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/62e37eac1c5b9e4805d40715e7570f7146caa788",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/62e37eac1c5b9e4805d40715e7570f7146caa788"
    }
  ],
  "stats": {
    "total": 21,
    "additions": 4,
    "deletions": 17
  },
  "files": [
    {
      "sha": "4427c53fe691e0a0b0182b17be55ed716ef4c745",
      "filename": "gdb/dwarf2/expr.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/expr.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/expr.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/expr.c?ref=6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
      "patch": "@@ -29,6 +29,7 @@\n #include \"dwarf2/expr.h\"\n #include \"dwarf2/loc.h\"\n #include \"dwarf2/read.h\"\n+#include \"frame.h\"\n #include \"gdbsupport/underlying.h\"\n #include \"gdbarch.h\"\n \n@@ -1217,7 +1218,9 @@ dwarf_expr_context::execute_stack_op (const gdb_byte *op_ptr,\n \t  break;\n \n \tcase DW_OP_call_frame_cfa:\n-\t  result = this->get_frame_cfa ();\n+\t  ensure_have_frame (this->frame, \"DW_OP_call_frame_cfa\");\n+\n+\t  result = dwarf2_frame_cfa (this->frame);\n \t  result_val = value_from_ulongest (address_type, result);\n \t  in_stack_memory = true;\n \t  break;"
    },
    {
      "sha": "f1c931e219062ffdf5a38b3a6b883e412453544c",
      "filename": "gdb/dwarf2/expr.h",
      "status": "modified",
      "additions": 0,
      "deletions": 3,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/expr.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/expr.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/expr.h?ref=6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
      "patch": "@@ -192,9 +192,6 @@ struct dwarf_expr_context\n   /* Read LENGTH bytes at ADDR into BUF.  */\n   virtual void read_mem (gdb_byte *buf, CORE_ADDR addr, size_t length) = 0;\n \n-  /* Return the CFA for the frame.  */\n-  virtual CORE_ADDR get_frame_cfa () = 0;\n-\n   /* Return the PC for the frame.  */\n   virtual CORE_ADDR get_frame_pc ()\n   {"
    },
    {
      "sha": "d7cc764f2d65f4f9a4a74eb54ea7170c581dce24",
      "filename": "gdb/dwarf2/frame.c",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/frame.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/frame.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/frame.c?ref=6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
      "patch": "@@ -249,11 +249,6 @@ class dwarf_expr_executor : public dwarf_expr_context\n     invalid (\"DW_OP_push_object_address\");\n   }\n \n-  CORE_ADDR get_frame_cfa () override\n-  {\n-    invalid (\"DW_OP_call_frame_cfa\");\n-  }\n-\n   CORE_ADDR get_tls_address (CORE_ADDR offset) override\n   {\n     invalid (\"DW_OP_form_tls_address\");"
    },
    {
      "sha": "723d9a40af5f9ea5c3067ddba13ed25edc9bab77",
      "filename": "gdb/dwarf2/loc.c",
      "status": "modified",
      "additions": 0,
      "deletions": 8,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/loc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6c7779b34b38ca71df9460c07bc4c03d01dfaa0b/gdb/dwarf2/loc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/loc.c?ref=6c7779b34b38ca71df9460c07bc4c03d01dfaa0b",
      "patch": "@@ -699,14 +699,6 @@ class dwarf_evaluate_loc_desc : public dwarf_expr_context\n   struct dwarf2_per_cu_data *per_cu;\n   CORE_ADDR obj_address;\n \n-  /* Helper function for dwarf2_evaluate_loc_desc.  Computes the CFA for\n-     the frame in BATON.  */\n-\n-  CORE_ADDR get_frame_cfa () override\n-  {\n-    return dwarf2_frame_cfa (frame);\n-  }\n-\n   /* Helper function for dwarf2_evaluate_loc_desc.  Computes the PC for\n      the frame in BATON.  */\n "
    }
  ]
}