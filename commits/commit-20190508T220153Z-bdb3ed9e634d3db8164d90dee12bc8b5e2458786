{
  "sha": "bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmRiM2VkOWU2MzRkM2RiODE2NGQ5MGRlZTEyYmM4YjVlMjQ1ODc4Ng==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-05-01T21:21:36Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-05-08T22:01:53Z"
    },
    "message": "Convert nto-tdep.c to type-safe registry API\n\nThis changes nto-tdep.c to use the type-safe registry API.\n\ngdb/ChangeLog\n2019-05-08  Tom Tromey  <tom@tromey.com>\n\n\t* nto-tdep.c (nto_inferior_data_reg): Change type.\n\t(nto_inferior_data): Update.\n\t(nto_inferior_data_cleanup, nto_new_inferior_data)\n\t(_initialize_nto_tdep): Remove.\n\t* nto-tdep.h (struct nto_inferior_data): Add initializers.",
    "tree": {
      "sha": "d1b744dd2e3842c92217e6398861e451490988aa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d1b744dd2e3842c92217e6398861e451490988aa"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f37b313d5cafbed4e724db4724d1ab567b373be4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f37b313d5cafbed4e724db4724d1ab567b373be4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f37b313d5cafbed4e724db4724d1ab567b373be4"
    }
  ],
  "stats": {
    "total": 49,
    "additions": 14,
    "deletions": 35
  },
  "files": [
    {
      "sha": "a8d727b87b1d4207b880cbf1aaacdbc203b9e098",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
      "patch": "@@ -1,3 +1,11 @@\n+2019-05-08  Tom Tromey  <tom@tromey.com>\n+\n+\t* nto-tdep.c (nto_inferior_data_reg): Change type.\n+\t(nto_inferior_data): Update.\n+\t(nto_inferior_data_cleanup, nto_new_inferior_data)\n+\t(_initialize_nto_tdep): Remove.\n+\t* nto-tdep.h (struct nto_inferior_data): Add initializers.\n+\n 2019-05-08  Tom Tromey  <tom@tromey.com>\n \n \t* ada-lang.c (struct ada_inferior_data): Add initializers."
    },
    {
      "sha": "48e731acd05267d058bf455c27f98c0975fef70e",
      "filename": "gdb/nto-tdep.c",
      "status": "modified",
      "additions": 4,
      "deletions": 33,
      "changes": 37,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/gdb/nto-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/gdb/nto-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nto-tdep.c?ref=bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
      "patch": "@@ -51,7 +51,8 @@ static char default_nto_target[] = \"\";\n \n struct nto_target_ops current_nto_target;\n \n-static const struct inferior_data *nto_inferior_data_reg;\n+static const struct inferior_key<struct nto_inferior_data>\n+  nto_inferior_data_reg;\n \n static char *\n nto_target (void)\n@@ -498,25 +499,6 @@ nto_read_auxv_from_initial_stack (CORE_ADDR initial_stack, gdb_byte *readbuf,\n   return len_read;\n }\n \n-/* Allocate new nto_inferior_data object.  */\n-\n-static struct nto_inferior_data *\n-nto_new_inferior_data (void)\n-{\n-  struct nto_inferior_data *const inf_data\n-    = XCNEW (struct nto_inferior_data);\n-\n-  return inf_data;\n-}\n-\n-/* Free inferior data.  */\n-\n-static void\n-nto_inferior_data_cleanup (struct inferior *const inf, void *const dat)\n-{\n-  xfree (dat);\n-}\n-\n /* Return nto_inferior_data for the given INFERIOR.  If not yet created,\n    construct it.  */\n \n@@ -528,20 +510,9 @@ nto_inferior_data (struct inferior *const inferior)\n \n   gdb_assert (inf != NULL);\n \n-  inf_data\n-    = (struct nto_inferior_data *) inferior_data (inf, nto_inferior_data_reg);\n+  inf_data = nto_inferior_data_reg.get (inf);\n   if (inf_data == NULL)\n-    {\n-      set_inferior_data (inf, nto_inferior_data_reg,\n-\t\t\t (inf_data = nto_new_inferior_data ()));\n-    }\n+    inf_data = nto_inferior_data_reg.emplace (inf);\n \n   return inf_data;\n }\n-\n-void\n-_initialize_nto_tdep (void)\n-{\n-  nto_inferior_data_reg\n-    = register_inferior_data_with_cleanup (NULL, nto_inferior_data_cleanup);\n-}"
    },
    {
      "sha": "2410a03a4a689a96c066cf53d8cd29edb77840e2",
      "filename": "gdb/nto-tdep.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/gdb/nto-tdep.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bdb3ed9e634d3db8164d90dee12bc8b5e2458786/gdb/nto-tdep.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nto-tdep.h?ref=bdb3ed9e634d3db8164d90dee12bc8b5e2458786",
      "patch": "@@ -152,10 +152,10 @@ get_nto_thread_info (thread_info *thread)\n struct nto_inferior_data\n {\n   /* Last stopped flags result from wait function */\n-  unsigned int stopped_flags;\n+  unsigned int stopped_flags = 0;\n \n   /* Last known stopped PC */\n-  CORE_ADDR stopped_pc;\n+  CORE_ADDR stopped_pc = 0;\n };\n \n /* Generic functions in nto-tdep.c.  */"
    }
  ]
}