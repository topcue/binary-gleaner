{
  "sha": "2708dbbd58fd5ccdbf07b6da812a45e228659268",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjcwOGRiYmQ1OGZkNWNjZGJmMDdiNmRhODEyYTQ1ZTIyODY1OTI2OA==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-01-18T10:03:21Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-02-08T11:03:54Z"
    },
    "message": "gdb/python: reformat an error string\n\nWhile working on another patch I noticed an oddly formatted error\nmessage in the Python code.\n\nWhen 'set python print-stack message' is in effect then consider this\nPython script:\n\n  class TestCommand (gdb.Command):\n      def __init__ (self):\n          gdb.Command.__init__ (self, \"test-cmd\", gdb.COMMAND_DATA)\n      def invoke(self, args, from_tty):\n          raise RuntimeError (\"bad\")\n  TestCommand ()\n\nAnd this GDB session:\n\n  (gdb) source path/to/python/script.py\n  (gdb) test-cmd\n  Python Exception <class 'RuntimeError'> bad:\n  Error occurred in Python: bad\n\nThe line 'Python Exception <class 'RuntimeError'> bad:' doesn't look\nterrible in this situation, the colon at the end of the first line\nmakes sense given the second line.\n\nHowever, there are places in GDB where there is no second line\nprinted, for example consider this python script:\n\n  def stop_listener (e):\n      raise RuntimeError (\"bad\")\n  gdb.events.stop.connect (stop_listener)\n\nThen this GDB session:\n\n  (gdb) file helloworld.exe\n  (gdb) start\n  Temporary breakpoint 1 at 0x40112a: file hello.c, line 6.\n  Starting program: helloworld.exe\n\n  Temporary breakpoint 1, main () at hello.c:6\n  6\t  printf (\"Hello World\\n\");\n  Python Exception <class 'RuntimeError'> bad:\n  (gdb) si\n  0x000000000040112f\t6\t  printf (\"Hello World\\n\");\n  Python Exception <class 'RuntimeError'> bad:\n\nIn this case there is no auxiliary information displayed after the\nwarning, and the line ending in the colon looks weird to me.\n\nA quick survey of the code seems to indicate that it is not uncommon\nfor there to be no auxiliary information line printed, its not just\nthe one case I found above.\n\nI propose that the line that currently looks like this:\n\n  Python Exception <class 'RuntimeError'> bad:\n\nBe reformatted like this:\n\n  Python Exception <class 'RuntimeError'>: bad\n\nI think this looks fine then in either situation.  The first now looks\nlike this:\n\n  (gdb) test-cmd\n  Python Exception <class 'RuntimeError'>: bad\n  Error occurred in Python: bad\n\nAnd the second like this:\n\n  (gdb) si\n  0x000000000040112f\t6\t  printf (\"Hello World\\n\");\n  Python Exception <class 'RuntimeError'>: bad\n\nThere's just two tests that needed updating.  Errors are checked for\nin many more tests, but most of the time the pattern doesn't care\nabout the colon.\n\ngdb/ChangeLog:\n\n\t* python/python.c (gdbpy_print_stack): Reformat an error message.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.python/py-framefilter.exp: Update expected results.\n\t* gdb.python/python.exp: Update expected results.",
    "tree": {
      "sha": "517dba7d3383052557eae181c38d75d68dbc3ffe",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/517dba7d3383052557eae181c38d75d68dbc3ffe"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2708dbbd58fd5ccdbf07b6da812a45e228659268",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2708dbbd58fd5ccdbf07b6da812a45e228659268",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2708dbbd58fd5ccdbf07b6da812a45e228659268",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2708dbbd58fd5ccdbf07b6da812a45e228659268/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6bf99988c68154f435c57309769f8fc1d7c5c449",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6bf99988c68154f435c57309769f8fc1d7c5c449",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6bf99988c68154f435c57309769f8fc1d7c5c449"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 12,
    "deletions": 3
  },
  "files": [
    {
      "sha": "a45c2c7499b932756826b572e93e94c26e43b3c1",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=2708dbbd58fd5ccdbf07b6da812a45e228659268",
      "patch": "@@ -1,3 +1,7 @@\n+2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* python/python.c (gdbpy_print_stack): Reformat an error message.\n+\n 2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* tui/tui-interp.c (tui_command_line_handler): New function."
    },
    {
      "sha": "009c0c4c6d7b5cc60bcb3e7064ddf9f942d9ad6c",
      "filename": "gdb/python/python.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/python/python.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/python/python.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/python.c?ref=2708dbbd58fd5ccdbf07b6da812a45e228659268",
      "patch": "@@ -1320,7 +1320,7 @@ gdbpy_print_stack (void)\n \t      PyErr_Clear ();\n \t    }\n \t  else\n-\t    fprintf_filtered (gdb_stderr, \"Python Exception %s %s: \\n\",\n+\t    fprintf_filtered (gdb_stderr, \"Python Exception %s: %s\\n\",\n \t\t\t      type.get (), msg.get ());\n \t}\n       catch (const gdb_exception &except)"
    },
    {
      "sha": "8fb69c0bacf627153f99c440576c4eaac7d4895e",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=2708dbbd58fd5ccdbf07b6da812a45e228659268",
      "patch": "@@ -1,3 +1,8 @@\n+2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.python/py-framefilter.exp: Update expected results.\n+\t* gdb.python/python.exp: Update expected results.\n+\n 2021-02-08  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.tui/scroll.exp: Tighten expected results.  Remove comment"
    },
    {
      "sha": "a9c6ca642bef058c71963bb9239ac2ab8892c5b1",
      "filename": "gdb/testsuite/gdb.python/py-framefilter.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/testsuite/gdb.python/py-framefilter.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/testsuite/gdb.python/py-framefilter.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/py-framefilter.exp?ref=2708dbbd58fd5ccdbf07b6da812a45e228659268",
      "patch": "@@ -269,7 +269,7 @@ gdb_test_no_output  \"enable frame-filter global Error\" \\\n     \"enable frame-filter global Error\"\n set test \"bt 1 with Error filter\"\n gdb_test_multiple \"bt 1\" $test {\n-    -re \"Python Exception .*whoops:.*$gdb_prompt $\" {\n+    -re \"Python Exception .*: whoops\\r\\n.*$gdb_prompt $\" {\n \tpass $test\n     }\n }"
    },
    {
      "sha": "c7d879efe634c4d97edb21a71ba4f86fe733bcab",
      "filename": "gdb/testsuite/gdb.python/python.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/testsuite/gdb.python/python.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2708dbbd58fd5ccdbf07b6da812a45e228659268/gdb/testsuite/gdb.python/python.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/python.exp?ref=2708dbbd58fd5ccdbf07b6da812a45e228659268",
      "patch": "@@ -463,7 +463,7 @@ gdb_test_multiline \"prompt substitution readline error_prompt\" \\\n   \"end\" \"\"\n \n gdb_test_multiple \"python gdb.prompt_hook = error_prompt\" \"set the hook error_prompt\" {\n-    -re \"Python Exception (exceptions.RuntimeError|<(type 'exceptions.|class ')RuntimeError'>) Python exception called.*$gdb_prompt $\" {\n+    -re \"Python Exception (exceptions.RuntimeError|<(type 'exceptions.|class ')RuntimeError'>): Python exception called\\r\\n$gdb_prompt $\" {\n \tpass $gdb_test_name\n     }\n }"
    }
  ]
}