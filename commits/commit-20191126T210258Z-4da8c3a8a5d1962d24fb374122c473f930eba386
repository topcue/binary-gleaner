{
  "sha": "4da8c3a8a5d1962d24fb374122c473f930eba386",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGRhOGMzYThhNWQxOTYyZDI0ZmIzNzQxMjJjNDczZjkzMGViYTM4Ng==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-10-12T19:06:18Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-11-26T21:02:58Z"
    },
    "message": "Set names of worker threads\n\nThis adds some configury so that gdb can set the names of worker\nthreads.  This makes them show up more nicely when debugging gdb\nitself.\n\n2019-11-26  Tom Tromey  <tom@tromey.com>\n\n\t* gdbsupport/thread-pool.c (thread_pool::set_thread_count): Set\n\tname of worker thread.\n\t* gdbsupport/common.m4 (GDB_AC_COMMON): Check for\n\tpthread_setname_np.\n\t* configure, config.in: Rebuild.\n\ngdb/gdbserver/ChangeLog\n2019-11-26  Tom Tromey  <tom@tromey.com>\n\n\t* configure, config.in: Rebuild.\n\nChange-Id: I60473d65ae9ae14d8c56ddde39684240c16aaf35",
    "tree": {
      "sha": "80ec079a39c964f8e4c2dd30893f0e413336032b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/80ec079a39c964f8e4c2dd30893f0e413336032b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4da8c3a8a5d1962d24fb374122c473f930eba386",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4da8c3a8a5d1962d24fb374122c473f930eba386",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4da8c3a8a5d1962d24fb374122c473f930eba386",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4da8c3a8a5d1962d24fb374122c473f930eba386/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "971db5e21e35e1ad0d124b954ce13d463b887b6c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/971db5e21e35e1ad0d124b954ce13d463b887b6c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/971db5e21e35e1ad0d124b954ce13d463b887b6c"
    }
  ],
  "stats": {
    "total": 54,
    "additions": 45,
    "deletions": 9
  },
  "files": [
    {
      "sha": "94a8bdc8dc1e24ba73ba1d86765a5451ba836872",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -1,3 +1,11 @@\n+2019-11-26  Tom Tromey  <tom@tromey.com>\n+\n+\t* gdbsupport/thread-pool.c (thread_pool::set_thread_count): Set\n+\tname of worker thread.\n+\t* gdbsupport/common.m4 (GDB_AC_COMMON): Check for\n+\tpthread_setname_np.\n+\t* configure, config.in: Rebuild.\n+\n 2019-11-26  Tom Tromey  <tom@tromey.com>\n \n \t* python/python.c (class gdbpy_gil): New."
    },
    {
      "sha": "1caf76481b9dddfbdca8c53fb87840a1d0f146e2",
      "filename": "gdb/config.in",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/config.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/config.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/config.in?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -342,6 +342,9 @@\n /* Have PTHREAD_PRIO_INHERIT. */\n #undef HAVE_PTHREAD_PRIO_INHERIT\n \n+/* Define to 1 if you have the `pthread_setname_np' function. */\n+#undef HAVE_PTHREAD_SETNAME_NP\n+\n /* Define to 1 if you have the `pthread_sigmask' function. */\n #undef HAVE_PTHREAD_SIGMASK\n "
    },
    {
      "sha": "6b64619df7a932155cb70d3a14cd273fff20198a",
      "filename": "gdb/configure",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -14333,12 +14333,13 @@ $as_echo \"$gdb_cv_cxx_std_thread\" >&6; }\n \n     # This check must be here, while LIBS includes any necessary\n     # threading library.\n-    for ac_func in pthread_sigmask\n+    for ac_func in pthread_sigmask pthread_setname_np\n do :\n-  ac_fn_cxx_check_func \"$LINENO\" \"pthread_sigmask\" \"ac_cv_func_pthread_sigmask\"\n-if test \"x$ac_cv_func_pthread_sigmask\" = xyes; then :\n+  as_ac_var=`$as_echo \"ac_cv_func_$ac_func\" | $as_tr_sh`\n+ac_fn_cxx_check_func \"$LINENO\" \"$ac_func\" \"$as_ac_var\"\n+if eval test \\\"x\\$\"$as_ac_var\"\\\" = x\"yes\"; then :\n   cat >>confdefs.h <<_ACEOF\n-#define HAVE_PTHREAD_SIGMASK 1\n+#define `$as_echo \"HAVE_$ac_func\" | $as_tr_cpp` 1\n _ACEOF\n \n fi"
    },
    {
      "sha": "de6c311e076ddf550962263f339f41e49863b99a",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -1,3 +1,7 @@\n+2019-11-26  Tom Tromey  <tom@tromey.com>\n+\n+\t* configure, config.in: Rebuild.\n+\n 2019-11-26  Tom Tromey  <tom@tromey.com>\n \n \t* remote-utils.c (block_unblock_async_io): Use gdb_sigmask."
    },
    {
      "sha": "14cf7099e39f8bdb297ca362607a9b78a4f61d3c",
      "filename": "gdb/gdbserver/config.in",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbserver/config.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbserver/config.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/config.in?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -195,6 +195,9 @@\n /* Have PTHREAD_PRIO_INHERIT. */\n #undef HAVE_PTHREAD_PRIO_INHERIT\n \n+/* Define to 1 if you have the `pthread_setname_np' function. */\n+#undef HAVE_PTHREAD_SETNAME_NP\n+\n /* Define to 1 if you have the `pthread_sigmask' function. */\n #undef HAVE_PTHREAD_SIGMASK\n "
    },
    {
      "sha": "da17f8cb2cc6a21cb04d6138dd4a6b56652095c9",
      "filename": "gdb/gdbserver/configure",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbserver/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbserver/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/configure?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -7725,12 +7725,13 @@ $as_echo \"$gdb_cv_cxx_std_thread\" >&6; }\n \n     # This check must be here, while LIBS includes any necessary\n     # threading library.\n-    for ac_func in pthread_sigmask\n+    for ac_func in pthread_sigmask pthread_setname_np\n do :\n-  ac_fn_cxx_check_func \"$LINENO\" \"pthread_sigmask\" \"ac_cv_func_pthread_sigmask\"\n-if test \"x$ac_cv_func_pthread_sigmask\" = xyes; then :\n+  as_ac_var=`$as_echo \"ac_cv_func_$ac_func\" | $as_tr_sh`\n+ac_fn_cxx_check_func \"$LINENO\" \"$ac_func\" \"$as_ac_var\"\n+if eval test \\\"x\\$\"$as_ac_var\"\\\" = x\"yes\"; then :\n   cat >>confdefs.h <<_ACEOF\n-#define HAVE_PTHREAD_SIGMASK 1\n+#define `$as_echo \"HAVE_$ac_func\" | $as_tr_cpp` 1\n _ACEOF\n \n fi"
    },
    {
      "sha": "4f2bb5218d554fe321d3356aada532c2abb9ad17",
      "filename": "gdb/gdbsupport/common.m4",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbsupport/common.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbsupport/common.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbsupport/common.m4?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -57,7 +57,7 @@ AC_DEFUN([GDB_AC_COMMON], [\n \n     # This check must be here, while LIBS includes any necessary\n     # threading library.\n-    AC_CHECK_FUNCS([pthread_sigmask])\n+    AC_CHECK_FUNCS([pthread_sigmask pthread_setname_np])\n \n     LIBS=\"$save_LIBS\"\n     CXXFLAGS=\"$save_CXXFLAGS\""
    },
    {
      "sha": "d19ae02e3ef18d8b42f4661ce3dcb023a28194e1",
      "filename": "gdb/gdbsupport/thread-pool.c",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbsupport/thread-pool.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4da8c3a8a5d1962d24fb374122c473f930eba386/gdb/gdbsupport/thread-pool.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbsupport/thread-pool.c?ref=4da8c3a8a5d1962d24fb374122c473f930eba386",
      "patch": "@@ -26,6 +26,19 @@\n #include \"gdbsupport/block-signals.h\"\n #include <algorithm>\n \n+/* On the off chance that we have the pthread library on a Windows\n+   host, but std::thread is not using it, avoid calling\n+   pthread_setname_np on Windows.  */\n+#ifndef _WIN32\n+#ifdef HAVE_PTHREAD_SETNAME_NP\n+#define USE_PTHREAD_SETNAME_NP\n+#endif\n+#endif\n+\n+#ifdef USE_PTHREAD_SETNAME_NP\n+#include <pthread.h>\n+#endif\n+\n namespace gdb\n {\n \n@@ -62,6 +75,9 @@ thread_pool::set_thread_count (size_t num_threads)\n       for (size_t i = m_thread_count; i < num_threads; ++i)\n \t{\n \t  std::thread thread (&thread_pool::thread_function, this);\n+#ifdef USE_PTHREAD_SETNAME_NP\n+\t  pthread_setname_np (thread.native_handle (), \"gdb worker\");\n+#endif\n \t  thread.detach ();\n \t}\n     }"
    }
  ]
}