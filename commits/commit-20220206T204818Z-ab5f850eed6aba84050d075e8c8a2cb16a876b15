{
  "sha": "ab5f850eed6aba84050d075e8c8a2cb16a876b15",
  "node_id": "C_kwDOANOeidoAKGFiNWY4NTBlZWQ2YWJhODQwNTBkMDc1ZThjOGEyY2IxNmE4NzZiMTU",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-11-20T03:09:25Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2022-02-06T20:48:18Z"
    },
    "message": "gdb: remove COMPUNIT_PRODUCER macro, add getter/setter\n\nAdd a getter and a setter for a compunit_symtab's producer.  Remove the\ncorresponding macro and adjust all callers.\n\nChange-Id: Ia1d6d8a0e247a08a21af23819d71e49b37d8931b",
    "tree": {
      "sha": "05057981c94964184fbeca51093765525eeb01b2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/05057981c94964184fbeca51093765525eeb01b2"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ab5f850eed6aba84050d075e8c8a2cb16a876b15",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab5f850eed6aba84050d075e8c8a2cb16a876b15",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ab5f850eed6aba84050d075e8c8a2cb16a876b15",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab5f850eed6aba84050d075e8c8a2cb16a876b15/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "422f1ea279deea8530b679e4770e97f669797543",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/422f1ea279deea8530b679e4770e97f669797543",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/422f1ea279deea8530b679e4770e97f669797543"
    }
  ],
  "stats": {
    "total": 58,
    "additions": 33,
    "deletions": 25
  },
  "files": [
    {
      "sha": "539ebe9e1c36ffe34e7ce3ada2b736b96c2f1ef7",
      "filename": "gdb/amd64-tdep.c",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/amd64-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/amd64-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/amd64-tdep.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -2474,8 +2474,8 @@ amd64_skip_xmm_prologue (CORE_ADDR pc, CORE_ADDR start_pc)\n \n   start_pc_sal = find_pc_sect_line (start_pc, NULL, 0);\n   if (start_pc_sal.symtab == NULL\n-      || producer_is_gcc_ge_4 (COMPUNIT_PRODUCER\n-\t   (SYMTAB_COMPUNIT (start_pc_sal.symtab))) < 6\n+      || producer_is_gcc_ge_4 (SYMTAB_COMPUNIT\n+\t\t\t\t (start_pc_sal.symtab)->producer ()) < 6\n       || start_pc_sal.pc != start_pc || pc >= start_pc_sal.end)\n     return pc;\n \n@@ -2545,9 +2545,9 @@ amd64_skip_prologue (struct gdbarch *gdbarch, CORE_ADDR start_pc)\n \t compilers to emit usable line notes.  */\n       if (post_prologue_pc\n \t  && (cust != NULL\n-\t      && COMPUNIT_PRODUCER (cust) != NULL\n-\t      && (producer_is_llvm (COMPUNIT_PRODUCER (cust))\n-\t      || producer_is_icc_ge_19 (COMPUNIT_PRODUCER (cust)))))\n+\t      && cust->producer () != nullptr\n+\t      && (producer_is_llvm (cust->producer ())\n+\t      || producer_is_icc_ge_19 (cust->producer ()))))\n         return std::max (start_pc, post_prologue_pc);\n     }\n "
    },
    {
      "sha": "d36856e1f3b5352ceaf534ea81acf0d2967e3960",
      "filename": "gdb/arm-tdep.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/arm-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/arm-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arm-tdep.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -1394,9 +1394,9 @@ arm_skip_prologue (struct gdbarch *gdbarch, CORE_ADDR pc)\n \t missing (e.g. for -gstabs), assuming the GNU tools.  */\n       if (post_prologue_pc\n \t  && (cust == NULL\n-\t      || COMPUNIT_PRODUCER (cust) == NULL\n-\t      || startswith (COMPUNIT_PRODUCER (cust), \"GNU \")\n-\t      || producer_is_llvm (COMPUNIT_PRODUCER (cust))))\n+\t      || cust->producer () == NULL\n+\t      || startswith (cust->producer (), \"GNU \")\n+\t      || producer_is_llvm (cust->producer ())))\n \treturn post_prologue_pc;\n \n       if (post_prologue_pc != 0)"
    },
    {
      "sha": "22727277613120e5b42531710bc8e4eb8fb5330d",
      "filename": "gdb/buildsym.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/buildsym.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/buildsym.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/buildsym.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -1013,7 +1013,7 @@ buildsym_compunit::end_symtab_with_blockvector (struct block *static_block,\n   cu->set_debugformat (m_debugformat);\n \n   /* Similarly for the producer.  */\n-  COMPUNIT_PRODUCER (cu) = m_producer;\n+  cu->set_producer (m_producer);\n \n   COMPUNIT_BLOCKVECTOR (cu) = blockvector;\n   {"
    },
    {
      "sha": "7bd6ac817b8f3b503d87190f26bfb6b4cf2b3353",
      "filename": "gdb/compile/compile.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/compile/compile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/compile/compile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/compile/compile.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -561,11 +561,11 @@ get_selected_pc_producer_options (void)\n   struct compunit_symtab *symtab = find_pc_compunit_symtab (pc);\n   const char *cs;\n \n-  if (symtab == NULL || symtab->producer == NULL\n-      || !startswith (symtab->producer, \"GNU \"))\n+  if (symtab == NULL || symtab->producer () == NULL\n+      || !startswith (symtab->producer (), \"GNU \"))\n     return NULL;\n \n-  cs = symtab->producer;\n+  cs = symtab->producer ();\n   while (*cs != 0 && *cs != '-')\n     cs = skip_spaces (skip_to_space (cs));\n   if (*cs != '-')"
    },
    {
      "sha": "0b7ed2c63fdc8227ca1b3f61a4d1be4b57850c00",
      "filename": "gdb/dwarf2/frame.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/dwarf2/frame.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/dwarf2/frame.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/frame.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -745,7 +745,7 @@ dwarf2_frame_find_quirks (struct dwarf2_frame_state *fs,\n   if (cust == NULL)\n     return;\n \n-  if (producer_is_realview (COMPUNIT_PRODUCER (cust)))\n+  if (producer_is_realview (cust->producer ()))\n     {\n       if (fde->cie->version == 1)\n \tfs->armcc_cfa_offsets_sf = 1;"
    },
    {
      "sha": "e598a4d197b8a23c3de86c668e75a99c4399601c",
      "filename": "gdb/i386-tdep.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/i386-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/i386-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/i386-tdep.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -1853,9 +1853,9 @@ i386_skip_prologue (struct gdbarch *gdbarch, CORE_ADDR start_pc)\n \t compilers to emit usable line notes.  */\n       if (post_prologue_pc\n \t  && (cust != NULL\n-\t      && COMPUNIT_PRODUCER (cust) != NULL\n-\t      && (producer_is_llvm (COMPUNIT_PRODUCER (cust))\n-\t      || producer_is_icc_ge_19 (COMPUNIT_PRODUCER (cust)))))\n+\t      && cust->producer () != NULL\n+\t      && (producer_is_llvm (cust->producer ())\n+\t      || producer_is_icc_ge_19 (cust->producer ()))))\n         return std::max (start_pc, post_prologue_pc);\n     }\n  "
    },
    {
      "sha": "b973b25f1587dbc5484b24bca175625672349e30",
      "filename": "gdb/python/py-symtab.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/python/py-symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/python/py-symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/py-symtab.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -132,9 +132,9 @@ stpy_get_producer (PyObject *self, void *closure)\n \n   STPY_REQUIRE_VALID (self, symtab);\n   cust = SYMTAB_COMPUNIT (symtab);\n-  if (COMPUNIT_PRODUCER (cust) != NULL)\n+  if (cust->producer () != nullptr)\n     {\n-      const char *producer = COMPUNIT_PRODUCER (cust);\n+      const char *producer = cust->producer ();\n \n       return host_string_to_python_string (producer).release ();\n     }"
    },
    {
      "sha": "07ea2af9fd853e7f4db326328de48b390f779371",
      "filename": "gdb/source.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/source.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/source.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -724,8 +724,8 @@ info_source_command (const char *ignore, int from_tty)\n \n   printf_filtered (_(\"Source language is %s.\\n\"), language_str (s->language));\n   printf_filtered (_(\"Producer is %s.\\n\"),\n-\t\t   COMPUNIT_PRODUCER (cust) != NULL\n-\t\t   ? COMPUNIT_PRODUCER (cust) : _(\"unknown\"));\n+\t\t   (cust->producer ()) != nullptr\n+\t\t    ? cust->producer () : _(\"unknown\"));\n   printf_filtered (_(\"Compiled with %s debugging format.\\n\"),\n \t\t   cust->debugformat ());\n   printf_filtered (_(\"%s preprocessor macro info.\\n\"),"
    },
    {
      "sha": "b946fc8bde0448dc4594853ba39bca4494578799",
      "filename": "gdb/symmisc.c",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/symmisc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/symmisc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symmisc.c?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -779,9 +779,8 @@ maintenance_info_symtabs (const char *regexp, int from_tty)\n \t\t\tprintf_filtered (\"    debugformat %s\\n\",\n \t\t\t\t\t cust->debugformat ());\n \t\t\tprintf_filtered (\"    producer %s\\n\",\n-\t\t\t\t\t COMPUNIT_PRODUCER (cust) != NULL\n-\t\t\t\t\t ? COMPUNIT_PRODUCER (cust)\n-\t\t\t\t\t : \"(null)\");\n+\t\t\t\t\t (cust->producer () != nullptr\n+\t\t\t\t\t  ? cust->producer () : \"(null)\"));\n \t\t\tprintf_filtered (\"    dirname %s\\n\",\n \t\t\t\t\t COMPUNIT_DIRNAME (cust) != NULL\n \t\t\t\t\t ? COMPUNIT_DIRNAME (cust)"
    },
    {
      "sha": "1e3f95dc92faac150b8558644661b13b65de02c9",
      "filename": "gdb/symtab.h",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/symtab.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab5f850eed6aba84050d075e8c8a2cb16a876b15/gdb/symtab.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.h?ref=ab5f850eed6aba84050d075e8c8a2cb16a876b15",
      "patch": "@@ -1492,6 +1492,16 @@ struct compunit_symtab\n     m_debugformat = debugformat;\n   }\n \n+  const char *producer () const\n+  {\n+    return m_producer;\n+  }\n+\n+  void set_producer (const char *producer)\n+  {\n+    m_producer = producer;\n+  }\n+\n   /* Make PRIMARY_FILETAB the primary filetab of this compunit symtab.\n \n      PRIMARY_FILETAB must already be a filetab of this compunit symtab.  */\n@@ -1538,7 +1548,7 @@ struct compunit_symtab\n   const char *m_debugformat;\n \n   /* String of producer version information, or NULL if we don't know.  */\n-  const char *producer;\n+  const char *m_producer;\n \n   /* Directory in which it was compiled, or NULL if we don't know.  */\n   const char *dirname;\n@@ -1587,7 +1597,6 @@ struct compunit_symtab\n \n using compunit_symtab_range = next_range<compunit_symtab>;\n \n-#define COMPUNIT_PRODUCER(cust) ((cust)->producer)\n #define COMPUNIT_DIRNAME(cust) ((cust)->dirname)\n #define COMPUNIT_BLOCKVECTOR(cust) ((cust)->blockvector)\n #define COMPUNIT_BLOCK_LINE_SECTION(cust) ((cust)->block_line_section)"
    }
  ]
}