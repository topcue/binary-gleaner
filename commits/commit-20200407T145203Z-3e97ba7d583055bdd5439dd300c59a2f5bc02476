{
  "sha": "3e97ba7d583055bdd5439dd300c59a2f5bc02476",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6M2U5N2JhN2Q1ODMwNTViZGQ1NDM5ZGQzMDBjNTlhMmY1YmMwMjQ3Ng==",
  "commit": {
    "author": {
      "name": "Rainer Orth",
      "email": "ro@CeBiTec.Uni-Bielefeld.DE",
      "date": "2020-04-07T14:52:03Z"
    },
    "committer": {
      "name": "Rainer Orth",
      "email": "ro@CeBiTec.Uni-Bielefeld.DE",
      "date": "2020-04-07T14:52:03Z"
    },
    "message": "ld: Fix several 32-bit SPARC plugin tests\n\nSeveral ld plugin tests currently FAIL on 32-bit Solaris/SPARC:\n\nFAIL: load plugin with source\nFAIL: plugin claimfile lost symbol with source\nFAIL: plugin claimfile replace symbol with source\nFAIL: plugin claimfile resolve symbol with source\nFAIL: plugin claimfile replace file with source\nFAIL: plugin set symbol visibility with source\nFAIL: plugin ignore lib with source\nFAIL: plugin claimfile replace lib with source\nFAIL: plugin 2 with source lib\nFAIL: load plugin 2 with source\nFAIL: load plugin 2 with source and -r\nFAIL: plugin 3 with source lib\nFAIL: load plugin 3 with source\nFAIL: load plugin 3 with source and -r\nFAIL: PR ld/20070\n\nall of them in the same way:\n\n./ld-new: BFD (GNU Binutils) 2.34.50.20200328 internal error, aborting at /vol/src/gnu/binutils/hg/master/git/bfd/elf32-sparc.c:154 in sparc_final_write_processing\n\nThis happens when bfd_get_mach returns 0 when abfd refers to a source\nfile:\n\n$11 = {\n  filename = 0x28c358 \"/vol/src/gnu/binutils/hg/master/local/ld/testsuite/ld-plugin/func.c (symbol from plugin)\", xvec = 0x24ed6c <sparc_elf32_sol2_vec>,\n[...]\n\nWhile I could find no specification what abfd's are allowed/expected in\n*_final_write_processing, I could find no other target that behaved the\nsame.  And indeed ignoring the 0 case fixes the failures.  The code now\nerrors for other values.  64-bit SPARC is not affected because it doesn't\nhave a specific implementation of elf_backend_final_write_processing.\n\nTested on sparc-sun-solaris2.11.\n\n2020-04-07  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n\t    Nick Clifton  <nickc@redhat.com>\n\n\t* elf32-sparc.c (sparc_final_write_processing): Fix whitespace.\n\t<0>: Ignore.\n\t<default>: Error rather than abort.",
    "tree": {
      "sha": "2f433a8895521ff52923982a0e3ffceba866f5bb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2f433a8895521ff52923982a0e3ffceba866f5bb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3e97ba7d583055bdd5439dd300c59a2f5bc02476",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3e97ba7d583055bdd5439dd300c59a2f5bc02476",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3e97ba7d583055bdd5439dd300c59a2f5bc02476",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3e97ba7d583055bdd5439dd300c59a2f5bc02476/comments",
  "author": {
    "login": "rorth",
    "id": 3930951,
    "node_id": "MDQ6VXNlcjM5MzA5NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rorth",
    "html_url": "https://github.com/rorth",
    "followers_url": "https://api.github.com/users/rorth/followers",
    "following_url": "https://api.github.com/users/rorth/following{/other_user}",
    "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rorth/subscriptions",
    "organizations_url": "https://api.github.com/users/rorth/orgs",
    "repos_url": "https://api.github.com/users/rorth/repos",
    "events_url": "https://api.github.com/users/rorth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rorth/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "rorth",
    "id": 3930951,
    "node_id": "MDQ6VXNlcjM5MzA5NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rorth",
    "html_url": "https://github.com/rorth",
    "followers_url": "https://api.github.com/users/rorth/followers",
    "following_url": "https://api.github.com/users/rorth/following{/other_user}",
    "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rorth/subscriptions",
    "organizations_url": "https://api.github.com/users/rorth/orgs",
    "repos_url": "https://api.github.com/users/rorth/repos",
    "events_url": "https://api.github.com/users/rorth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rorth/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6e0e8b45026e04c25f1875ead25eb6e0e1ac31ae",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6e0e8b45026e04c25f1875ead25eb6e0e1ac31ae",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6e0e8b45026e04c25f1875ead25eb6e0e1ac31ae"
    }
  ],
  "stats": {
    "total": 34,
    "additions": 19,
    "deletions": 15
  },
  "files": [
    {
      "sha": "27fc158395ec5c36b61b982dff8a3dfa85288082",
      "filename": "bfd/elf32-sparc.c",
      "status": "modified",
      "additions": 19,
      "deletions": 15,
      "changes": 34,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3e97ba7d583055bdd5439dd300c59a2f5bc02476/bfd/elf32-sparc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3e97ba7d583055bdd5439dd300c59a2f5bc02476/bfd/elf32-sparc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-sparc.c?ref=3e97ba7d583055bdd5439dd300c59a2f5bc02476",
      "patch": "@@ -121,37 +121,41 @@ sparc_final_write_processing (bfd *abfd)\n {\n   switch (bfd_get_mach (abfd))\n     {\n-    case bfd_mach_sparc :\n-    case bfd_mach_sparc_sparclet :\n-    case bfd_mach_sparc_sparclite :\n+    case bfd_mach_sparc:\n+    case bfd_mach_sparc_sparclet:\n+    case bfd_mach_sparc_sparclite:\n       break; /* nothing to do */\n-    case bfd_mach_sparc_v8plus :\n+    case bfd_mach_sparc_v8plus:\n       elf_elfheader (abfd)->e_machine = EM_SPARC32PLUS;\n       elf_elfheader (abfd)->e_flags &=~ EF_SPARC_32PLUS_MASK;\n       elf_elfheader (abfd)->e_flags |= EF_SPARC_32PLUS;\n       break;\n-    case bfd_mach_sparc_v8plusa :\n+    case bfd_mach_sparc_v8plusa:\n       elf_elfheader (abfd)->e_machine = EM_SPARC32PLUS;\n       elf_elfheader (abfd)->e_flags &=~ EF_SPARC_32PLUS_MASK;\n       elf_elfheader (abfd)->e_flags |= EF_SPARC_32PLUS | EF_SPARC_SUN_US1;\n       break;\n-    case bfd_mach_sparc_v8plusb :\n-    case bfd_mach_sparc_v8plusc :\n-    case bfd_mach_sparc_v8plusd :\n-    case bfd_mach_sparc_v8pluse :\n-    case bfd_mach_sparc_v8plusv :\n-    case bfd_mach_sparc_v8plusm :\n-    case bfd_mach_sparc_v8plusm8 :\n+    case bfd_mach_sparc_v8plusb:\n+    case bfd_mach_sparc_v8plusc:\n+    case bfd_mach_sparc_v8plusd:\n+    case bfd_mach_sparc_v8pluse:\n+    case bfd_mach_sparc_v8plusv:\n+    case bfd_mach_sparc_v8plusm:\n+    case bfd_mach_sparc_v8plusm8:\n       elf_elfheader (abfd)->e_machine = EM_SPARC32PLUS;\n       elf_elfheader (abfd)->e_flags &=~ EF_SPARC_32PLUS_MASK;\n       elf_elfheader (abfd)->e_flags |= EF_SPARC_32PLUS | EF_SPARC_SUN_US1\n \t\t\t\t       | EF_SPARC_SUN_US3;\n       break;\n-    case bfd_mach_sparc_sparclite_le :\n+    case bfd_mach_sparc_sparclite_le:\n       elf_elfheader (abfd)->e_flags |= EF_SPARC_LEDATA;\n       break;\n-    default :\n-      abort ();\n+    case 0: /* A non-sparc architecture - ignore.  */\n+      break;\n+    default:\n+      _bfd_error_handler\n+\t(_(\"%pB: unhandled sparc machine value '%lu' detected during write processing\"),\n+\t abfd, (long) bfd_get_mach (abfd));\n       break;\n     }\n }"
    }
  ]
}