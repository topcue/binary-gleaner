{
  "sha": "f1c7f42126274d48f6b0a929e4e15a32193997c6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjFjN2Y0MjEyNjI3NGQ0OGY2YjBhOTI5ZTRlMTVhMzIxOTM5OTdjNg==",
  "commit": {
    "author": {
      "name": "Andre Vieira",
      "email": "andre.simoesdiasvieira@arm.com",
      "date": "2019-04-15T10:29:14Z"
    },
    "committer": {
      "name": "Andre Vieira",
      "email": "andre.simoesdiasvieira@arm.com",
      "date": "2019-04-15T11:30:33Z"
    },
    "message": "[binutils, ARM, 7/16] New BFX and BFLX instruction for Armv8.1-M Mainline\n\nThis patch is part of a series of patches to add support for Armv8.1-M Mainline instructions to binutils.\n\nThis patch adds the BFX and BFLX instructions.\n\nChangeLog entries are as follows :\n\n*** gas/ChangeLog ***\n\n2019-04-15  Sudakshina Das  <sudi.das@arm.com>\n\n\t* config/tc-arm.c (T16_32_TAB): New entries for bfx and bflx.\n\t(do_t_v8_1_branch): New switch cases for bfx and bflx.\n\t(insns): New instruction for bfx and bflx.\n\t* testsuite/gas/arm/armv8_1-m-bf-exchange.d: New.\n\t* testsuite/gas/arm/armv8_1-m-bf-exchange.s: New.\n\t* testsuite/gas/arm/armv8_1-m-bf-exchange-bad.s: New\n\t* testsuite/gas/arm/armv8_1-m-bf-exchange-bad.l: New\n\t* testsuite/gas/arm/armv8_1-m-bf-exchange-bad.d: New\n\n*** opcodes/ChangeLog ***\n\n2019-04-15  Sudakshina Das  <sudi.das@arm.com>\n\n\t* arm-dis.c (print_insn_thumb32): Add '%<bitfield>S' to print an\n\tArm register with r13 and r15 unpredictable.\n\t(thumb32_opcodes): New instructions for bfx and bflx.",
    "tree": {
      "sha": "e7d52e61a7c5e91e8decb2a32454e44ff3d90d51",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e7d52e61a7c5e91e8decb2a32454e44ff3d90d51"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f1c7f42126274d48f6b0a929e4e15a32193997c6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f1c7f42126274d48f6b0a929e4e15a32193997c6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f1c7f42126274d48f6b0a929e4e15a32193997c6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f1c7f42126274d48f6b0a929e4e15a32193997c6/comments",
  "author": {
    "login": "avieira-arm",
    "id": 68072104,
    "node_id": "MDQ6VXNlcjY4MDcyMTA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/68072104?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/avieira-arm",
    "html_url": "https://github.com/avieira-arm",
    "followers_url": "https://api.github.com/users/avieira-arm/followers",
    "following_url": "https://api.github.com/users/avieira-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/avieira-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/avieira-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/avieira-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/avieira-arm/orgs",
    "repos_url": "https://api.github.com/users/avieira-arm/repos",
    "events_url": "https://api.github.com/users/avieira-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/avieira-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "avieira-arm",
    "id": 68072104,
    "node_id": "MDQ6VXNlcjY4MDcyMTA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/68072104?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/avieira-arm",
    "html_url": "https://github.com/avieira-arm",
    "followers_url": "https://api.github.com/users/avieira-arm/followers",
    "following_url": "https://api.github.com/users/avieira-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/avieira-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/avieira-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/avieira-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/avieira-arm/orgs",
    "repos_url": "https://api.github.com/users/avieira-arm/repos",
    "events_url": "https://api.github.com/users/avieira-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/avieira-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4389b29a5af431eeac517272b66560e12df3c430",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4389b29a5af431eeac517272b66560e12df3c430",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4389b29a5af431eeac517272b66560e12df3c430"
    }
  ],
  "stats": {
    "total": 84,
    "additions": 84,
    "deletions": 0
  },
  "files": [
    {
      "sha": "10aa75768c6542a6dece406e4586c67d7cdc42f3",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -1,3 +1,14 @@\n+2019-04-15  Sudakshina Das  <sudi.das@arm.com>\n+\n+\t* config/tc-arm.c (T16_32_TAB): New entries for bfx and bflx.\n+\t(do_t_v8_1_branch): New switch cases for bfx and bflx.\n+\t(insns): New instruction for bfx and bflx.\n+\t* testsuite/gas/arm/armv8_1-m-bf-exchange.d: New.\n+\t* testsuite/gas/arm/armv8_1-m-bf-exchange.s: New.\n+\t* testsuite/gas/arm/armv8_1-m-bf-exchange-bad.s: New\n+\t* testsuite/gas/arm/armv8_1-m-bf-exchange-bad.l: New\n+\t* testsuite/gas/arm/armv8_1-m-bf-exchange-bad.d: New\n+\n 2019-04-15  Sudakshina Das  <sudi.das@arm.com>\n             Andre Vieira  <andre.simoesdiasvieira@arm.com>\n "
    },
    {
      "sha": "c7c1a82a998ce08330e05f3f2b3e34e453b87b2c",
      "filename": "gas/config/tc-arm.c",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/config/tc-arm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/config/tc-arm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-arm.c?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -10506,6 +10506,8 @@ encode_thumb32_addr_mode (int i, bfd_boolean is_t, bfd_boolean is_d)\n   X(_b,     e000, f000b000),\t\t\t\\\n   X(_bcond, d000, f0008000),\t\t\t\\\n   X(_bf,    0000, f040e001),\t\t\t\\\n+  X(_bfx,   0000, f060e001),\t\t\t\\\n+  X(_bflx,  0000, f070e001),\t\t\t\\\n   X(_bic,   4380, ea200000),\t\t\t\\\n   X(_bics,  4380, ea300000),\t\t\t\\\n   X(_cmn,   42c0, eb100f00),\t\t\t\\\n@@ -13362,6 +13364,11 @@ do_t_branch_future (void)\n \t  }\n \tbreak;\n \n+      case T_MNEM_bfx:\n+      case T_MNEM_bflx:\n+\tinst.instruction |= inst.operands[1].reg << 16;\n+\tbreak;\n+\n       default: abort ();\n     }\n }\n@@ -21679,6 +21686,8 @@ static const struct asm_opcode insns[] =\n #undef  THUMB_VARIANT\n #define THUMB_VARIANT & arm_ext_v8_1m_main\n  toC(\"bf\",     _bf,\t2, (EXPs, EXPs),\t     t_branch_future),\n+ toC(\"bfx\",    _bfx,\t2, (EXPs, RRnpcsp),\t     t_branch_future),\n+ toC(\"bflx\",   _bflx,\t2, (EXPs, RRnpcsp),\t     t_branch_future),\n };\n #undef ARM_VARIANT\n #undef THUMB_VARIANT"
    },
    {
      "sha": "3ee7df81610c45f68aced3982cb04589104d6873",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.d",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.d?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -0,0 +1,4 @@\n+#name: Invalid Armv8.1-M Mainline BF-exchange instructions\n+#source: armv8_1-m-bf-exchange-bad.s\n+#as: -march=armv8.1-m.main\n+#error_output: armv8_1-m-bf-exchange-bad.l"
    },
    {
      "sha": "1033b71e6ea2ad7a6886ba1d45e34537ea650a04",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.l",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.l?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -0,0 +1,7 @@\n+.*: Assembler messages:\n+.*:6: Error: branch out of range or not a multiple of 2\n+.*:7: Error: branch out of range or not a multiple of 2\n+.*:8: Error: branch out of range or not a multiple of 2\n+.*:9: Error: branch out of range or not a multiple of 2\n+.*:11: Error: r15 not allowed here -- `bfx 2,PC'\n+.*:12: Error: r13 not allowed here -- `bflx 2,SP'"
    },
    {
      "sha": "ca06eaf3d4fa6cf692b78b0dee87c6c75a888f71",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.s",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-bf-exchange-bad.s?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -0,0 +1,12 @@\n+\t.syntax unified\n+\t.text\n+\t.thumb\n+foo:\n+\t# OP0 : Unsigned, 5-bit, even\n+\tbfx   0, r3\n+\tbfx  -2, r3\n+\tbflx  3, r3\n+\tbflx 32, r3\n+\t# OP1 : no SP or PC\n+\tbfx   2, PC\n+\tbflx  2, SP"
    },
    {
      "sha": "e88bb941acd7ebe29867dba940a69992932e6ada",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-bf-exchange.d",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-bf-exchange.d?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -0,0 +1,14 @@\n+#name: Valid Armv8.1-M Mainline BF-exchange instructions\n+#source: armv8_1-m-bf-exchange.s\n+#as: -march=armv8.1-m.main\n+#objdump: -dr --prefix-addresses --show-raw-insn\n+\n+.*: +file format .*arm.*\n+\n+Disassembly of section .text:\n+0[0-9a-f]+ <[^>]+> f265 e001 \tbfx\t8, r5\n+0[0-9a-f]+ <[^>]+> 4609      \tmov\tr1, r1\n+0[0-9a-f]+ <[^>]+> f173 e001 \tbflx\t4, r3\n+0[0-9a-f]+ <[^>]+> 460a      \tmov\tr2, r1\n+0[0-9a-f]+ <[^>]+> 4613      \tmov\tr3, r2\n+0[0-9a-f]+ <[^>]+> 4614      \tmov\tr4, r2"
    },
    {
      "sha": "e3d9dfcdc7a2f518a10c4e71568b32dc6694aaba",
      "filename": "gas/testsuite/gas/arm/armv8_1-m-bf-exchange.s",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/gas/testsuite/gas/arm/armv8_1-m-bf-exchange.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/armv8_1-m-bf-exchange.s?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -0,0 +1,12 @@\n+\t.syntax unified\n+\t.text\n+\t.thumb\n+foo:\n+\tbfx .LB1, r5\n+\tmov r1, r1\n+\tbflx .LB2, r3\n+\tmov r2, r1\n+.LB1:\n+\tmov r3, r2\n+.LB2:\n+\tmov r4, r2"
    },
    {
      "sha": "e4de1d7305d6d615e0739b83a3f9a8c77cb9cb46",
      "filename": "opcodes/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/opcodes/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/opcodes/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/ChangeLog?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -1,3 +1,9 @@\n+2019-04-15  Sudakshina Das  <sudi.das@arm.com>\n+\n+\t* arm-dis.c (print_insn_thumb32): Add '%<bitfield>S' to print an\n+\tArm register with r13 and r15 unpredictable.\n+\t(thumb32_opcodes): New instructions for bfx and bflx.\n+\n 2019-04-15  Sudakshina Das  <sudi.das@arm.com>\n \n \t* arm-dis.c (thumb32_opcodes): New instructions for bf."
    },
    {
      "sha": "08af17193afc959fe5365922e9ad1770fbed76dc",
      "filename": "opcodes/arm-dis.c",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f1c7f42126274d48f6b0a929e4e15a32193997c6/opcodes/arm-dis.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f1c7f42126274d48f6b0a929e4e15a32193997c6/opcodes/arm-dis.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/arm-dis.c?ref=f1c7f42126274d48f6b0a929e4e15a32193997c6",
      "patch": "@@ -2730,6 +2730,7 @@ static const struct opcode16 thumb_opcodes[] =\n        %<bitfield>W\tprint bitfield*4 in decimal\n        %<bitfield>r\tprint bitfield as an ARM register\n        %<bitfield>R\tas %<>r but r15 is UNPREDICTABLE\n+       %<bitfield>S\tas %<>r but r13 and r15 is UNPREDICTABLE\n        %<bitfield>c\tprint bitfield as a condition code\n \n        %<bitfield>'c\tprint specified char iff bitfield is all ones\n@@ -2749,6 +2750,10 @@ static const struct opcode32 thumb32_opcodes[] =\n   /* Armv8.1-M Mainline instructions.  */\n   {ARM_FEATURE_CORE_HIGH (ARM_EXT2_V8_1M_MAIN),\n     0xf040e001, 0xf860f001, \"bf%c\\t%G, %W\"},\n+  {ARM_FEATURE_CORE_HIGH (ARM_EXT2_V8_1M_MAIN),\n+    0xf060e001, 0xf8f0f001, \"bfx%c\\t%G, %16-19S\"},\n+  {ARM_FEATURE_CORE_HIGH (ARM_EXT2_V8_1M_MAIN),\n+    0xf070e001, 0xf8f0f001, \"bflx%c\\t%G, %16-19S\"},\n \n \n   /* ARMv8-M and ARMv8-M Security Extensions instructions.  */\n@@ -6056,6 +6061,10 @@ print_insn_thumb32 (bfd_vma pc, struct disassemble_info *info, long given)\n \t\t      value_in_comment = val * 4;\n \t\t      break;\n \n+\t\t    case 'S':\n+\t\t      if (val == 13)\n+\t\t\tis_unpredictable = TRUE;\n+\t\t      /* Fall through.  */\n \t\t    case 'R':\n \t\t      if (val == 15)\n \t\t\tis_unpredictable = TRUE;"
    }
  ]
}