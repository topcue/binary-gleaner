{
  "sha": "d15acc425222d23f9224bca4299319179a479801",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDE1YWNjNDI1MjIyZDIzZjkyMjRiY2E0Mjk5MzE5MTc5YTQ3OTgwMQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-02-08T20:40:54Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-02-08T20:43:24Z"
    },
    "message": "Change dwarf2_per_objfile::line_header_hash to htab_up\n\nThis changes dwarf2_per_objfile::line_header_hash to be an htab_up,\nand changes it to use heap allocation.\n\n2020-02-08  Tom Tromey  <tom@tromey.com>\n\n\t* dwarf2/read.c (~dwarf2_per_objfile): Don't delete\n\tline_header_hash.\n\t(handle_DW_AT_stmt_list): Update.  Don't allocate on obstack.\n\t* dwarf2/read.h (struct dwarf2_per_objfile) <line_header_hash>:\n\tChange type to htab_up.\n\nChange-Id: Icb148a270838c0f96f38fc4a28b5b77d067927b6",
    "tree": {
      "sha": "ed2c4b70aa8b9f17db85c99ec2016aebc9c97213",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ed2c4b70aa8b9f17db85c99ec2016aebc9c97213"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d15acc425222d23f9224bca4299319179a479801",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d15acc425222d23f9224bca4299319179a479801",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d15acc425222d23f9224bca4299319179a479801",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d15acc425222d23f9224bca4299319179a479801/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "eaa5fa8b291fed6f97c315680953ca94d4eafb72",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/eaa5fa8b291fed6f97c315680953ca94d4eafb72",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/eaa5fa8b291fed6f97c315680953ca94d4eafb72"
    }
  ],
  "stats": {
    "total": 28,
    "additions": 15,
    "deletions": 13
  },
  "files": [
    {
      "sha": "b5c2954a885e7a8728a35051790bb8fac98c3b32",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d15acc425222d23f9224bca4299319179a479801/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d15acc425222d23f9224bca4299319179a479801/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=d15acc425222d23f9224bca4299319179a479801",
      "patch": "@@ -1,3 +1,11 @@\n+2020-02-08  Tom Tromey  <tom@tromey.com>\n+\n+\t* dwarf2/read.c (~dwarf2_per_objfile): Don't delete\n+\tline_header_hash.\n+\t(handle_DW_AT_stmt_list): Update.  Don't allocate on obstack.\n+\t* dwarf2/read.h (struct dwarf2_per_objfile) <line_header_hash>:\n+\tChange type to htab_up.\n+\n 2020-02-08  Tom Tromey  <tom@tromey.com>\n \n \t* dwarf2/read.c (allocate_type_unit_groups_table): Return"
    },
    {
      "sha": "6c698bd0fe47eae9d1202208ca1559597c38349a",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 6,
      "deletions": 12,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d15acc425222d23f9224bca4299319179a479801/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d15acc425222d23f9224bca4299319179a479801/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=d15acc425222d23f9224bca4299319179a479801",
      "patch": "@@ -2014,9 +2014,6 @@ dwarf2_per_objfile::~dwarf2_per_objfile ()\n   if (quick_file_names_table)\n     htab_delete (quick_file_names_table);\n \n-  if (line_header_hash)\n-    htab_delete (line_header_hash);\n-\n   for (dwarf2_per_cu_data *per_cu : all_comp_units)\n     per_cu->imported_symtabs_free ();\n \n@@ -11059,7 +11056,6 @@ handle_DW_AT_stmt_list (struct die_info *die, struct dwarf2_cu *cu,\n {\n   struct dwarf2_per_objfile *dwarf2_per_objfile\n     = cu->per_cu->dwarf2_per_objfile;\n-  struct objfile *objfile = dwarf2_per_objfile->objfile;\n   struct attribute *attr;\n   struct line_header line_header_local;\n   hashval_t line_header_local_hash;\n@@ -11084,20 +11080,18 @@ handle_DW_AT_stmt_list (struct die_info *die, struct dwarf2_cu *cu,\n       && die->tag == DW_TAG_partial_unit)\n     {\n       dwarf2_per_objfile->line_header_hash\n-\t= htab_create_alloc_ex (127, line_header_hash_voidp,\n-\t\t\t\tline_header_eq_voidp,\n-\t\t\t\tfree_line_header_voidp,\n-\t\t\t\t&objfile->objfile_obstack,\n-\t\t\t\thashtab_obstack_allocate,\n-\t\t\t\tdummy_obstack_deallocate);\n+\t.reset (htab_create_alloc (127, line_header_hash_voidp,\n+\t\t\t\t   line_header_eq_voidp,\n+\t\t\t\t   free_line_header_voidp,\n+\t\t\t\t   xcalloc, xfree));\n     }\n \n   line_header_local.sect_off = line_offset;\n   line_header_local.offset_in_dwz = cu->per_cu->is_dwz;\n   line_header_local_hash = line_header_hash (&line_header_local);\n   if (dwarf2_per_objfile->line_header_hash != NULL)\n     {\n-      slot = htab_find_slot_with_hash (dwarf2_per_objfile->line_header_hash,\n+      slot = htab_find_slot_with_hash (dwarf2_per_objfile->line_header_hash.get (),\n \t\t\t\t       &line_header_local,\n \t\t\t\t       line_header_local_hash, NO_INSERT);\n \n@@ -11125,7 +11119,7 @@ handle_DW_AT_stmt_list (struct die_info *die, struct dwarf2_cu *cu,\n     slot = NULL;\n   else\n     {\n-      slot = htab_find_slot_with_hash (dwarf2_per_objfile->line_header_hash,\n+      slot = htab_find_slot_with_hash (dwarf2_per_objfile->line_header_hash.get (),\n \t\t\t\t       &line_header_local,\n \t\t\t\t       line_header_local_hash, INSERT);\n       gdb_assert (slot != NULL);"
    },
    {
      "sha": "0f30837d3e2b96216621ab5c0bc00f809752712b",
      "filename": "gdb/dwarf2/read.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d15acc425222d23f9224bca4299319179a479801/gdb/dwarf2/read.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d15acc425222d23f9224bca4299319179a479801/gdb/dwarf2/read.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.h?ref=d15acc425222d23f9224bca4299319179a479801",
      "patch": "@@ -220,7 +220,7 @@ struct dwarf2_per_objfile\n   std::vector<dwarf2_per_cu_data *> just_read_cus;\n \n   /* Table containing line_header indexed by offset and offset_in_dwz.  */\n-  htab_t line_header_hash {};\n+  htab_up line_header_hash;\n \n   /* Table containing all filenames.  This is an optional because the\n      table is lazily constructed on first access.  */"
    }
  ]
}