{
  "sha": "fdd502691f8b893e321f19260464831f9726c5d4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmRkNTAyNjkxZjhiODkzZTMyMWYxOTI2MDQ2NDgzMWY5NzI2YzVkNA==",
  "commit": {
    "author": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-08-30T22:14:36Z"
    },
    "committer": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-08-30T22:14:36Z"
    },
    "message": "RISC-V: Force linker error exit after unresolvable reloc.\n\nThis was noticed while trying to test the compiler -msave-restore support.\nPutting non-pic code in a shared library gives a linker error, but doesn't\nstop the build.\n\nrohan:2030$ cat libtmp.c\nextern int sub2 (int);\nint sub (int i) { return sub2 (i + 10); }\nrohan:2031$ cat libtmp2.c\nextern int sub (int);\nint sub2 (int i) { return sub (i + 10); }\nrohan:2032$ riscv64-unknown-linux-gnu-gcc --shared -o libtmp.so libtmp.c\nrohan:2033$ riscv64-unknown-linux-gnu-gcc --shared -o libtmp2.so libtmp2.c libtmp.so\n/home/jimw/FOSS/install-riscv64/lib/gcc/riscv64-unknown-linux-gnu/8.3.0/../../../../riscv64-unknown-linux-gnu/bin/ld: /tmp/cctrsIBe.o(.text+0x18): unresolvable R_RISCV_CALL relocation against symbol `sub'\nrohan:2034$ echo $?\n0\nrohan:2035$ ls -lt libtmp2.so\n-rwxr-xr-x 1 jimw jimw 6912 Aug 30 14:32 libtmp2.so\nrohan:2036$\n\nThe patch fixes this by forcing a linker error.  I now get this.\n\nohan:2059$ sh tmp.script\n/home/jimw/FOSS/BINUTILS/X-riscv64-linux/ld/ld-new: libtmp2.o(.text+0x18): unresolvable R_RISCV_CALL relocation against symbol `sub'\n/home/jimw/FOSS/BINUTILS/X-riscv64-linux/ld/ld-new: final link failed: bad value\nrohan:2060$ echo $?\n1\nrohan:2061$ ls -lt libtmp2.so\nls: cannot access 'libtmp2.so': No such file or directory\n\n\tbfd/\n\t* elfnn-riscv.c (riscv_elf_relocate_section): For unresolvable reloc\n\terror, call bfd_set_error, set ret to FALSE, and goto out label.",
    "tree": {
      "sha": "e7f5e03087a6bad76e145ff3b105ab0e5ffebf76",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e7f5e03087a6bad76e145ff3b105ab0e5ffebf76"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/fdd502691f8b893e321f19260464831f9726c5d4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fdd502691f8b893e321f19260464831f9726c5d4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/fdd502691f8b893e321f19260464831f9726c5d4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fdd502691f8b893e321f19260464831f9726c5d4/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "47a536d940d2f2bccfec51539b857da06ebc429e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/47a536d940d2f2bccfec51539b857da06ebc429e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/47a536d940d2f2bccfec51539b857da06ebc429e"
    }
  ],
  "stats": {
    "total": 10,
    "additions": 9,
    "deletions": 1
  },
  "files": [
    {
      "sha": "1fc39dce5fd0acc23471d2dda48a1f2193474add",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fdd502691f8b893e321f19260464831f9726c5d4/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fdd502691f8b893e321f19260464831f9726c5d4/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=fdd502691f8b893e321f19260464831f9726c5d4",
      "patch": "@@ -1,3 +1,8 @@\n+2019-08-30  Jim Wilson  <jimw@sifive.com>\n+\n+\t* elfnn-riscv.c (riscv_elf_relocate_section): For unresolvable reloc\n+\terror, call bfd_set_error, set ret to FALSE, and goto out label.\n+\n 2019-08-30  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/24951"
    },
    {
      "sha": "ef2471eb9996667f9dd9dc1da8fc0b7280851ac3",
      "filename": "bfd/elfnn-riscv.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fdd502691f8b893e321f19260464831f9726c5d4/bfd/elfnn-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fdd502691f8b893e321f19260464831f9726c5d4/bfd/elfnn-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-riscv.c?ref=fdd502691f8b893e321f19260464831f9726c5d4",
      "patch": "@@ -2297,7 +2297,10 @@ riscv_elf_relocate_section (bfd *output_bfd,\n \t     (uint64_t) rel->r_offset,\n \t     howto->name,\n \t     h->root.root.string);\n-\t  continue;\n+\n+\t  bfd_set_error (bfd_error_bad_value);\n+\t  ret = FALSE;\n+\t  goto out;\n \t}\n \n       if (r == bfd_reloc_ok)"
    }
  ]
}