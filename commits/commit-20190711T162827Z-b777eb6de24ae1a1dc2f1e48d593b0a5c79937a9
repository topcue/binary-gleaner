{
  "sha": "b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Yjc3N2ViNmRlMjRhZTFhMWRjMmYxZTQ4ZDU5M2IwYTVjNzk5MzdhOQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-07-11T14:54:17Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-07-11T16:28:27Z"
    },
    "message": "Remove init_cli_cmds\n\nI noticed that init_cli_cmds only installs a command, and so doesn't\nneed to be handled specially.  This patch merges it into\n_initialize_cli_cmds.\n\nThe help text is constructed dynamically, which is sometimes an\nindication that special treatment is needed; but in this case it is\njust to insert the value of \"gdbinit\", which is created at\ncompile-time and not modified; so this doesn't affect the result.\n\nThis version also removes the \"gdbinit\" global.  There's no need for\nit, as GDBINIT can be used instead.  Note, though, that the help text\nin question must still be dynamically constructed, in order to be\ni18n-friendly.\n\ngdb/ChangeLog\n2019-07-11  Tom Tromey  <tromey@adacore.com>\n\n\t* main.c (get_init_files): Use GDBINIT, not gdbinit.\n\t* auto-load.c (file_is_auto_load_safe): Use GDBINIT, not gdbinit.\n\t* top.h (gdbinit): Don't declare.\n\t* cli/cli-cmds.c (init_cli_cmds): Remove, merging contents\n\tinto...\n\t(_initialize_cli_cmds): ...here.  Use GDBINIT, not gdbinit.\n\t* top.c (gdb_init): Don't call init_cli_cmds.\n\t(gdbinit): Remove.\n\t* cli/cli-cmds.h (init_cli_cmds): Don't declare.",
    "tree": {
      "sha": "7b5a07c166d0453709cd5190c3adf5b753da8db4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7b5a07c166d0453709cd5190c3adf5b753da8db4"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "72ee03ff58d954dbed886b672032c8c9db0a0dcc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/72ee03ff58d954dbed886b672032c8c9db0a0dcc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/72ee03ff58d954dbed886b672032c8c9db0a0dcc"
    }
  ],
  "stats": {
    "total": 39,
    "additions": 18,
    "deletions": 21
  },
  "files": [
    {
      "sha": "90da3d42c1d4c0f5fa427ee913d60e34598d2ba8",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -1,3 +1,15 @@\n+2019-07-11  Tom Tromey  <tromey@adacore.com>\n+\n+\t* main.c (get_init_files): Use GDBINIT, not gdbinit.\n+\t* auto-load.c (file_is_auto_load_safe): Use GDBINIT, not gdbinit.\n+\t* top.h (gdbinit): Don't declare.\n+\t* cli/cli-cmds.c (init_cli_cmds): Remove, merging contents\n+\tinto...\n+\t(_initialize_cli_cmds): ...here.  Use GDBINIT, not gdbinit.\n+\t* top.c (gdb_init): Don't call init_cli_cmds.\n+\t(gdbinit): Remove.\n+\t* cli/cli-cmds.h (init_cli_cmds): Don't declare.\n+\n 2019-07-11  Tom Tromey  <tromey@adacore.com>\n \n \t* python/py-inferior.c (add_thread_object): Don't use thread_obj"
    },
    {
      "sha": "616aeb6fc96a5988e26d05a20a74d844010fe248",
      "filename": "gdb/auto-load.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/auto-load.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/auto-load.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/auto-load.c?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -500,7 +500,7 @@ file_is_auto_load_safe (const char *filename, const char *debug_fmt, ...)\n \n       if (homedir == NULL)\n \thomedir = \"$HOME\";\n-      std::string homeinit = string_printf (\"%s/%s\", homedir, gdbinit);\n+      std::string homeinit = string_printf (\"%s/%s\", homedir, GDBINIT);\n \n       printf_filtered (_(\"\\\n To enable execution of this file add\\n\\"
    },
    {
      "sha": "0b62622e888b4471463a332a1116a653ec9017e0",
      "filename": "gdb/cli/cli-cmds.c",
      "status": "modified",
      "additions": 2,
      "deletions": 9,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/cli/cli-cmds.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/cli/cli-cmds.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-cmds.c?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -2215,15 +2215,8 @@ Make \\\"spe\\\" an alias of \\\"set print elements\\\":\\n\\\n   alias spe = set print elements\\n\\\n Make \\\"elms\\\" an alias of \\\"elements\\\" in the \\\"set print\\\" command:\\n\\\n   alias -a set print elms = set print elements\"));\n-}\n-\n-void\n-init_cli_cmds (void)\n-{\n-  struct cmd_list_element *c;\n-  char *source_help_text;\n \n-  source_help_text = xstrprintf (_(\"\\\n+  const char *source_help_text = xstrprintf (_(\"\\\n Read commands from a file named FILE.\\n\\\n \\n\\\n Usage: source [-s] [-v] FILE\\n\\\n@@ -2232,7 +2225,7 @@ Usage: source [-s] [-v] FILE\\n\\\n -v: each command in FILE is echoed as it is executed.\\n\\\n \\n\\\n Note that the file \\\"%s\\\" is read automatically in this way\\n\\\n-when GDB is started.\"), gdbinit);\n+when GDB is started.\"), GDBINIT);\n   c = add_cmd (\"source\", class_support, source_command,\n \t       source_help_text, &cmdlist);\n   set_cmd_completer (c, filename_completer);"
    },
    {
      "sha": "5bfffde04a105e911e245e4d1eab45b29c7a0c08",
      "filename": "gdb/cli/cli-cmds.h",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/cli/cli-cmds.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/cli/cli-cmds.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-cmds.h?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -105,8 +105,6 @@ extern struct cmd_list_element *showchecklist;\n \n void init_cmd_lists (void);\n \n-void init_cli_cmds (void);\n-\n int is_complete_command (struct cmd_list_element *cmd);\n \n /* Exported to gdb/main.c */"
    },
    {
      "sha": "678c413021c7db30149f28c028c289ced2c1861d",
      "filename": "gdb/main.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/main.c?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -260,20 +260,20 @@ get_init_files (const char **system_gdbinit,\n \n       if (homedir)\n \t{\n-\t  homeinit = xstrprintf (\"%s/%s\", homedir, gdbinit);\n+\t  homeinit = xstrprintf (\"%s/%s\", homedir, GDBINIT);\n \t  if (stat (homeinit, &homebuf) != 0)\n \t    {\n \t      xfree (homeinit);\n \t      homeinit = NULL;\n \t    }\n \t}\n \n-      if (stat (gdbinit, &cwdbuf) == 0)\n+      if (stat (GDBINIT, &cwdbuf) == 0)\n \t{\n \t  if (!homeinit\n \t      || memcmp ((char *) &homebuf, (char *) &cwdbuf,\n \t\t\t sizeof (struct stat)))\n-\t    localinit = gdbinit;\n+\t    localinit = GDBINIT;\n \t}\n       \n       initialized = 1;"
    },
    {
      "sha": "83a3604688b1c952d4d412ed454401b6485825bf",
      "filename": "gdb/top.c",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.c?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -108,10 +108,6 @@ gen_ret_current_ui_field_ptr (struct ui_file *, gdb_stderr)\n gen_ret_current_ui_field_ptr (struct ui_file *, gdb_stdlog)\n gen_ret_current_ui_field_ptr (struct ui_out *, current_uiout)\n \n-/* Initialization file name for gdb.  This is host-dependent.  */\n-\n-const char gdbinit[] = GDBINIT;\n-\n int inhibit_gdbinit = 0;\n \n extern char lang_frame_mismatch_warn[];\t\t/* language.c */\n@@ -2265,7 +2261,6 @@ gdb_init (char *argv0)\n   initialize_progspace ();\n   initialize_inferiors ();\n   initialize_current_architecture ();\n-  init_cli_cmds();\n   init_main ();\t\t\t/* But that omits this file!  Do it now.  */\n \n   initialize_stdin_serial ();"
    },
    {
      "sha": "32a898b82f5b485d00dec93d72629378a541132d",
      "filename": "gdb/top.h",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/top.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9/gdb/top.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.h?ref=b777eb6de24ae1a1dc2f1e48d593b0a5c79937a9",
      "patch": "@@ -219,7 +219,6 @@ extern void ui_unregister_input_event_handler (struct ui *ui);\n /* From top.c.  */\n extern int confirm;\n extern int inhibit_gdbinit;\n-extern const char gdbinit[];\n \n /* Print the GDB version banner to STREAM.  If INTERACTIVE is false,\n    then information referring to commands (e.g., \"show configuration\")"
    }
  ]
}