{
  "sha": "d9b1deff13c53333118cb48324a95bbf099b0f2b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDliMWRlZmYxM2M1MzMzMzExOGNiNDgzMjRhOTViYmYwOTliMGYyYg==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-01-13T10:58:27Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-01-14T02:53:11Z"
    },
    "message": "sim: watch: add basic default handler that traps\n\nThe default watchpoint handler is NULL.  That means any port that\nsets the STATE_WATCHPOINTS->pc field will crash if you try to use\nthe --watch options but don't configure the interrupt handler.  In\nthe past, you had to setup STATE_WATCHPOINTS->pc if you wanted to\nsupport PC profiling, and while that was fixed a while ago, we have\na lot of ports who still configure it.\n\nWe already add a default set of interrupts (just \"int\") if the port\ndoesn't define any.  Let's also add a default handler that raises a\nSIGTRAP.  When connected to gdb, this is a breakpoint which is what\npeople would expect.  When running standalone, it'll abort the sim,\nbut it's unclear whether there's anything better to do there.  This\nreally is just to make the watchpoint module more usable out of the\nbox for most ports with very little setup, at least inside of gdb.",
    "tree": {
      "sha": "b650df9a337606b5dc30d39338f0fb54775de71f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b650df9a337606b5dc30d39338f0fb54775de71f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d9b1deff13c53333118cb48324a95bbf099b0f2b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d9b1deff13c53333118cb48324a95bbf099b0f2b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d9b1deff13c53333118cb48324a95bbf099b0f2b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d9b1deff13c53333118cb48324a95bbf099b0f2b/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8f66807b98f7634c43149ea62e454ea8f877691d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8f66807b98f7634c43149ea62e454ea8f877691d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8f66807b98f7634c43149ea62e454ea8f877691d"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 18,
    "deletions": 1
  },
  "files": [
    {
      "sha": "3571c95e918b6e43873ebbb1810f685c9ab91fe1",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d9b1deff13c53333118cb48324a95bbf099b0f2b/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d9b1deff13c53333118cb48324a95bbf099b0f2b/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=d9b1deff13c53333118cb48324a95bbf099b0f2b",
      "patch": "@@ -1,3 +1,9 @@\n+2021-01-13  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* sim-watch.c (default_interrupt_handler): Define.\n+\t(sim_watchpoint_install): Set default interrupt_handler to new\n+\tdefault_interrupt_handler.\n+\n 2021-01-13  Mike Frysinger  <vapier@gentoo.org>\n \n \t* sim-watch.c (do_watchpoint_create): Parse arg+1 and assign to arg1."
    },
    {
      "sha": "6d177298597103cd4140f86660e9656a3b13acb1",
      "filename": "sim/common/sim-watch.c",
      "status": "modified",
      "additions": 12,
      "deletions": 1,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d9b1deff13c53333118cb48324a95bbf099b0f2b/sim/common/sim-watch.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d9b1deff13c53333118cb48324a95bbf099b0f2b/sim/common/sim-watch.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/sim-watch.c?ref=d9b1deff13c53333118cb48324a95bbf099b0f2b",
      "patch": "@@ -376,7 +376,16 @@ static const OPTION watchpoint_options[] =\n \n static const char *default_interrupt_names[] = { \"int\", 0, };\n \n-\n+/* This default handler is \"good enough\" for targets that just want to trap into\n+   gdb when watchpoints are hit, and have only configured STATE_WATCHPOINTS pc &\n+   sizeof_pc fields.  */\n+static void\n+default_interrupt_handler (SIM_DESC sd, void *data)\n+{\n+  sim_cpu *cpu = STATE_CPU (sd, 0);\n+  address_word cia = CPU_PC_GET (cpu);\n+  sim_engine_halt (sd, cpu, NULL, cia, sim_stopped, SIM_SIGTRAP);\n+}\n \n SIM_RC\n sim_watchpoint_install (SIM_DESC sd)\n@@ -389,6 +398,8 @@ sim_watchpoint_install (SIM_DESC sd)\n   /* fill in some details */\n   if (watch->interrupt_names == NULL)\n     watch->interrupt_names = default_interrupt_names;\n+  if (watch->interrupt_handler == NULL)\n+    watch->interrupt_handler = default_interrupt_handler;\n   watch->nr_interrupts = 0;\n   while (watch->interrupt_names[watch->nr_interrupts] != NULL)\n     watch->nr_interrupts++;"
    }
  ]
}