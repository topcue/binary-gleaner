{
  "sha": "40d231b4fbcb68d5906a949acd1d421123d74082",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDBkMjMxYjRmYmNiNjhkNTkwNmE5NDlhY2QxZDQyMTEyM2Q3NDA4Mg==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-06-25T07:25:12Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-06-25T07:25:12Z"
    },
    "message": "x86: also refuse data size prefix on SIMD insns\n\nThe data size prefix alters the meaning of legacy encoded SIMD insns,\nand hence shouldn't be accepted there. Use of it also leads to\ninconsistencies in SSE2AVX mode. Don't match insns with data size prefix\nagainst SSE2AVX templates.",
    "tree": {
      "sha": "b3cdd402b4ecf3d5c012959846ea9b2a7a3756ab",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b3cdd402b4ecf3d5c012959846ea9b2a7a3756ab"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/40d231b4fbcb68d5906a949acd1d421123d74082",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/40d231b4fbcb68d5906a949acd1d421123d74082",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/40d231b4fbcb68d5906a949acd1d421123d74082",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/40d231b4fbcb68d5906a949acd1d421123d74082/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "11abe4264708e70413de9eeb2cbe14ac71e304db",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/11abe4264708e70413de9eeb2cbe14ac71e304db",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/11abe4264708e70413de9eeb2cbe14ac71e304db"
    }
  ],
  "stats": {
    "total": 51,
    "additions": 37,
    "deletions": 14
  },
  "files": [
    {
      "sha": "835a5525d6e8800652efe7f10aa8fd076da6a30e",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -1,3 +1,16 @@\n+2020-06-25  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* config/tc-i386.c (cpu_flags_match): Only match SSE2AVX\n+\ttemplates when there's no data size prefix.\n+\t(md_assemble): Reject data size prefix also for legacy encoded\n+\tSIMD templates.\n+\t* testsuite/gas/i386/prefix32.s, testsuite/gas/i386/prefix64.s:\n+\tUncomment previously not working line.\n+\t* testsuite/gas/i386/sse2avx.s: Add ldmxcsr/stmxcsr cases with\n+\tdata16 prefix.\n+\t* testsuite/gas/i386/prefix32.l, testsuite/gas/i386/prefix64.l,\n+\ttestsuite/gas/i386/sse2avx.d: Adjust expectations.\n+\n 2020-06-25  Jan Beulich  <jbeulich@suse.com>\n \n \t* config/tc-i386.c (build_evex_prefix): Drop early setting of"
    },
    {
      "sha": "5a652a9b9b333273ec4ec20aad495f165b11c284",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -1944,7 +1944,8 @@ cpu_flags_match (const insn_template *t)\n \t    {\n \t      /* We need to check a few extra flags with AVX.  */\n \t      if (cpu.bitfield.cpuavx\n-\t\t  && (!t->opcode_modifier.sse2avx || sse2avx)\n+\t\t  && (!t->opcode_modifier.sse2avx\n+\t\t      || (sse2avx && !i.prefix[DATA_PREFIX]))\n \t\t  && (!x.bitfield.cpuaes || cpu.bitfield.cpuaes)\n \t\t  && (!x.bitfield.cpugfni || cpu.bitfield.cpugfni)\n \t\t  && (!x.bitfield.cpupclmul || cpu.bitfield.cpupclmul))\n@@ -4787,8 +4788,11 @@ md_assemble (char *line)\n       return;\n     }\n \n-  /* Check for data size prefix on VEX/XOP/EVEX encoded insns.  */\n-  if (i.prefix[DATA_PREFIX] && is_any_vex_encoding (&i.tm))\n+  /* Check for data size prefix on VEX/XOP/EVEX encoded and SIMD insns.  */\n+  if (i.prefix[DATA_PREFIX]\n+      && (is_any_vex_encoding (&i.tm)\n+\t  || i.tm.operand_types[i.imm_operands].bitfield.class >= RegMMX\n+\t  || i.tm.operand_types[i.imm_operands + 1].bitfield.class >= RegMMX))\n     {\n       as_bad (_(\"data size prefix invalid with `%s'\"), i.tm.name);\n       return;"
    },
    {
      "sha": "e43abbdc292fd96388696199ee3490824a8df55c",
      "filename": "gas/testsuite/gas/i386/prefix32.l",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix32.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix32.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/prefix32.l?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -5,7 +5,8 @@\n .*:9: Error: invalid .* `vaddss' after `repne'\n .*:14: Error: same type of prefix .*\n .*:15: Error: same type of prefix .*\n-.*:19: Error: same type of prefix .*\n+.*:18: Error: data size .* `addps'\n+.*:19: Error: data size .* `addpd'\n .*:20: Error: data size .* `vaddps'\n .*:21: Error: data size .* `vaddpd'\n .*:25: Error: same type of prefix .*\n@@ -28,9 +29,8 @@ GAS LISTING .*\n [ \t]*15[ \t]+rep bnd ret\n [ \t]*16[ \t]*\n [ \t]*17[ \t]+\\.Ldata16:\n-[ \t]*18[ \t]+#bogus\tdata16 addps\t%xmm0, %xmm0\n-[ \t]*19[ \t]+\\?\\?\\?\\? 660F58C0[ \t]+data16 addpd\t%xmm0, %xmm0\n-\\*\\*\\*\\*  Error: .*\n+[ \t]*18[ \t]+data16 addps\t%xmm0, %xmm0\n+[ \t]*19[ \t]+data16 addpd\t%xmm0, %xmm0\n [ \t]*20[ \t]+data16 vaddps\t%xmm0, %xmm0, %xmm0\n [ \t]*21[ \t]+data16 vaddpd\t%xmm0, %xmm0, %xmm0\n [ \t]*22[ \t]*"
    },
    {
      "sha": "598b0a775b65bc2f8213cd0520f97527c2fd32a5",
      "filename": "gas/testsuite/gas/i386/prefix32.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix32.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix32.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/prefix32.s?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -15,7 +15,7 @@ prefix:\n \trep bnd ret\n \n .Ldata16:\n-#bogus\tdata16 addps\t%xmm0, %xmm0\n+\tdata16 addps\t%xmm0, %xmm0\n \tdata16 addpd\t%xmm0, %xmm0\n \tdata16 vaddps\t%xmm0, %xmm0, %xmm0\n \tdata16 vaddpd\t%xmm0, %xmm0, %xmm0"
    },
    {
      "sha": "712f4e0d688c3b8a735498ce84bdaea2ef41f499",
      "filename": "gas/testsuite/gas/i386/prefix64.l",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix64.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix64.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/prefix64.l?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -5,7 +5,8 @@\n .*:9: Error: invalid .* `vaddss' after `repne'\n .*:14: Error: same type of prefix .*\n .*:15: Error: same type of prefix .*\n-.*:19: Error: same type of prefix .*\n+.*:18: Error: data size .* `addps'\n+.*:19: Error: data size .* `addpd'\n .*:20: Error: data size .* `vaddps'\n .*:21: Error: data size .* `vaddpd'\n GAS LISTING .*\n@@ -27,10 +28,9 @@ GAS LISTING .*\n [ \t]*15[ \t]+rep bnd ret\n [ \t]*16[ \t]*\n [ \t]*17[ \t]+\\.Ldata16:\n-[ \t]*18[ \t]+#bogus\tdata16 addps\t%xmm0, %xmm0\n-[ \t]*19[ \t]+\\?\\?\\?\\? 660F58C0[ \t]+data16 addpd\t%xmm0, %xmm0\n-\\*\\*\\*\\*  Error: .*\n+[ \t]*18[ \t]+data16 addps\t%xmm0, %xmm0\n+[ \t]*19[ \t]+data16 addpd\t%xmm0, %xmm0\n [ \t]*20[ \t]+data16 vaddps\t%xmm0, %xmm0, %xmm0\n [ \t]*21[ \t]+data16 vaddpd\t%xmm0, %xmm0, %xmm0\n [ \t]*22[ \t]*\n-[ \t]*23[ \t]*[\\?]+ 0+[ \\t]+\\.p2align\t4,0\n+#pass"
    },
    {
      "sha": "32091c7c05adba07904fb9644a92c8dc2da4f99b",
      "filename": "gas/testsuite/gas/i386/prefix64.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix64.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/prefix64.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/prefix64.s?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -15,7 +15,7 @@ prefix:\n \trep bnd ret\n \n .Ldata16:\n-#bogus\tdata16 addps\t%xmm0, %xmm0\n+\tdata16 addps\t%xmm0, %xmm0\n \tdata16 addpd\t%xmm0, %xmm0\n \tdata16 vaddps\t%xmm0, %xmm0, %xmm0\n \tdata16 vaddpd\t%xmm0, %xmm0, %xmm0"
    },
    {
      "sha": "1a7df7165b330f57b95e59cc7b1b573779d4b896",
      "filename": "gas/testsuite/gas/i386/sse2avx.d",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/sse2avx.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/sse2avx.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/sse2avx.d?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -9,6 +9,8 @@ Disassembly of section .text:\n 0+ <_start>:\n [ \t]*[a-f0-9]+:\tc5 f8 ae 11          \tvldmxcsr \\(%ecx\\)\n [ \t]*[a-f0-9]+:\tc5 f8 ae 19          \tvstmxcsr \\(%ecx\\)\n+[ \t]*[a-f0-9]+:\t66 0f ae 11          \tdata16 ldmxcsr \\(%ecx\\)\n+[ \t]*[a-f0-9]+:\t66 0f ae 19          \tdata16 stmxcsr \\(%ecx\\)\n [ \t]*[a-f0-9]+:\tc5 f8 5b f4          \tvcvtdq2ps %xmm4,%xmm6\n [ \t]*[a-f0-9]+:\tc5 f8 5b 21          \tvcvtdq2ps \\(%ecx\\),%xmm4\n [ \t]*[a-f0-9]+:\tc5 fb e6 f4          \tvcvtpd2dq %xmm4,%xmm6"
    },
    {
      "sha": "0ad600c3289d73dcf3a2c1ced0657bd36455d4a6",
      "filename": "gas/testsuite/gas/i386/sse2avx.s",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/sse2avx.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40d231b4fbcb68d5906a949acd1d421123d74082/gas/testsuite/gas/i386/sse2avx.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/sse2avx.s?ref=40d231b4fbcb68d5906a949acd1d421123d74082",
      "patch": "@@ -7,6 +7,10 @@ _start:\n \tldmxcsr (%ecx)\n \tstmxcsr (%ecx)\n \n+# These should not be converted\n+\tdata16 ldmxcsr (%ecx)\n+\tdata16 stmxcsr (%ecx)\n+\n # Tests for op xmm/mem128, xmm\n \tcvtdq2ps %xmm4,%xmm6\n \tcvtdq2ps (%ecx),%xmm4"
    }
  ]
}