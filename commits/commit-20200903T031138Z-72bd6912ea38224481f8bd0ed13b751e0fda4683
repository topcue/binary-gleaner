{
  "sha": "72bd6912ea38224481f8bd0ed13b751e0fda4683",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzJiZDY5MTJlYTM4MjI0NDgxZjhiZDBlZDEzYjc1MWUwZmRhNDY4Mw==",
  "commit": {
    "author": {
      "name": "Kito Cheng",
      "email": "kito.cheng@sifive.com",
      "date": "2020-07-07T02:30:36Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2020-09-03T03:11:38Z"
    },
    "message": "RISC-V: Improve the error message for the mis-matched ISA versions.\n\nConsider the updated attr-merge-arch-failed-01.d testcase.  Extension\nA's version are mis-matched between attr-merge-arch-failed-01a.s and\nattr-merge-arch-failed-01b.s.  But the old binutils reports that the\nmis-matched extension is M rather than A.  This commit is used to fix\nthe wrong mis-matched error message.\n\nBesides, when parsing the arch string in the riscv_parse_subset, it\nshouldn't be NULL or empty.  However, it might be empty when we failed\nto merge the arch string in the riscv_merge_attributes.  Since we should\nalready issue the correct error message in another side, and the message\n- ISA string must begin with rv32 or rv64 - is meaninglesss when the arch\nstring is empty, so do not issue it.\n\n\tbfd/\n\t* elfnn-riscv.c (riscv_merge_std_ext): Fix to report the correct\n\terror message when the versions of extension are mis-matched.\n\t* elfxx-riscv.c (riscv_parse_subset): Don't issue the error when\n\tthe string is empty.\n\n\tld/\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d: Updated.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01a.s: Likewise.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01b.s: Likewise.",
    "tree": {
      "sha": "0ba9c3c12bb03120fd7b2608423fb1523c48d533",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0ba9c3c12bb03120fd7b2608423fb1523c48d533"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/72bd6912ea38224481f8bd0ed13b751e0fda4683",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/72bd6912ea38224481f8bd0ed13b751e0fda4683",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/72bd6912ea38224481f8bd0ed13b751e0fda4683",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/72bd6912ea38224481f8bd0ed13b751e0fda4683/comments",
  "author": {
    "login": "kito-cheng",
    "id": 2723185,
    "node_id": "MDQ6VXNlcjI3MjMxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2723185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kito-cheng",
    "html_url": "https://github.com/kito-cheng",
    "followers_url": "https://api.github.com/users/kito-cheng/followers",
    "following_url": "https://api.github.com/users/kito-cheng/following{/other_user}",
    "gists_url": "https://api.github.com/users/kito-cheng/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kito-cheng/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kito-cheng/subscriptions",
    "organizations_url": "https://api.github.com/users/kito-cheng/orgs",
    "repos_url": "https://api.github.com/users/kito-cheng/repos",
    "events_url": "https://api.github.com/users/kito-cheng/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kito-cheng/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": null,
  "parents": [
    {
      "sha": "d48b742bc1a7af6a673e747c91bf7c72518a0b6a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d48b742bc1a7af6a673e747c91bf7c72518a0b6a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d48b742bc1a7af6a673e747c91bf7c72518a0b6a"
    }
  ],
  "stats": {
    "total": 33,
    "additions": 26,
    "deletions": 7
  },
  "files": [
    {
      "sha": "8703aebeb3464f5998e8407272289c0ea9cc2fbf",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -1,3 +1,10 @@\n+2020-09-03  Kito Cheng  <kito.cheng@sifive.com>\n+\n+\t* elfnn-riscv.c (riscv_merge_std_ext): Fix to report the correct\n+\terror message when the versions of extension are mis-matched.\n+\t* elfxx-riscv.c (riscv_parse_subset): Don't issue the error when\n+\tthe string is empty.\n+\n 2020-09-03  Alan Modra  <amodra@gmail.com>\n \n \t* xcofflink.c (xcoff_get_archive_info): Allocate xcoff_archive_info"
    },
    {
      "sha": "f8de7194ea65edcd8d8e8422cb45117e7931c05e",
      "filename": "bfd/elfnn-riscv.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/bfd/elfnn-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/bfd/elfnn-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-riscv.c?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -2724,7 +2724,7 @@ riscv_merge_std_ext (bfd *ibfd,\n \t  && ((find_in->major_version != find_out->major_version)\n \t      || (find_in->minor_version != find_out->minor_version)))\n \t{\n-\t  riscv_version_mismatch (ibfd, in, out);\n+\t  riscv_version_mismatch (ibfd, find_in, find_out);\n \t  return FALSE;\n \t}\n "
    },
    {
      "sha": "cfdd867e0dec697202d994d4c8eb9b1f50e5e65d",
      "filename": "bfd/elfxx-riscv.c",
      "status": "modified",
      "additions": 9,
      "deletions": 3,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/bfd/elfxx-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/bfd/elfxx-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-riscv.c?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -1519,9 +1519,15 @@ riscv_parse_subset (riscv_parse_subset_t *rps,\n     }\n   else\n     {\n-      rps->error_handler\n-\t(_(\"-march=%s: ISA string must begin with rv32 or rv64\"),\n-\t arch);\n+      /* Arch string shouldn't be NULL or empty here.  However,\n+\t it might be empty only when we failed to merge the arch\n+\t string in the riscv_merge_attributes.  We have already\n+\t issued the correct error message in another side, so do\n+\t not issue this error when the arch string is empty.  */\n+      if (strlen (arch))\n+\trps->error_handler (\n+\t  _(\"-march=%s: ISA string must begin with rv32 or rv64\"),\n+\t  arch);\n       return FALSE;\n     }\n "
    },
    {
      "sha": "4bba88474378f52faade677ffae297117835dc26",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -1,3 +1,9 @@\n+2020-09-03  Kito Cheng  <kito.cheng@sifive.com>\n+\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d: Updated.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01a.s: Likewise.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01b.s: Likewise.\n+\n 2020-09-03  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-scripts/sysroot-prefix.exp (single_sysroot_prefix_test):"
    },
    {
      "sha": "8a9c0929f80b4f315f10b967fefdfa300ff9b3dc",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -2,4 +2,4 @@\n #source: attr-merge-arch-failed-01b.s\n #as: -march-attr\n #ld: -r -melf32lriscv\n-#error: Mis-matched ISA version for 'm' extension. 3.0 vs 2.0\n+#error: Mis-matched ISA version for 'a' extension. 3.0 vs 2.0"
    },
    {
      "sha": "365901d8dc15d6d6c331bf2db461437555cc8a78",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01a.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01a.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01a.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01a.s?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -1 +1 @@\n-\t.attribute arch, \"rv32i2p0_m2p0\"\n+\t.attribute arch, \"rv32i2p0_m2p0_a2p0\""
    },
    {
      "sha": "49263bf66d4cfce8eac3d0595288f7e2c5d82e85",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01b.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01b.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/72bd6912ea38224481f8bd0ed13b751e0fda4683/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01b.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01b.s?ref=72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "patch": "@@ -1 +1 @@\n-\t.attribute arch, \"rv32i2p0_m3p0\"\n+\t.attribute arch, \"rv32i2p0_m2p0_a3p0\""
    }
  ]
}