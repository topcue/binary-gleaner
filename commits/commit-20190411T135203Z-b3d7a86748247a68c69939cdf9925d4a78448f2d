{
  "sha": "b3d7a86748247a68c69939cdf9925d4a78448f2d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjNkN2E4Njc0ODI0N2E2OGM2OTkzOWNkZjk5MjVkNGE3ODQ0OGYyZA==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2019-04-11T13:52:03Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2019-04-11T13:52:03Z"
    },
    "message": "ld: Add -static-pie tests\n\nAdd -static-pie tests for DT_INIT_ARRAY, DT_FINI_ARRAY, DT_PREINIT_ARRAY\nand IFUNC.\n\n\t* testsuite/config/default.exp (STATIC_PIE_LDFLAGS): New.  Set\n\tto \"-static-pie\" if target compiler supports it.\n\t* testsuite/ld-elf/elf.exp: Run -static-pie tests if\n\t$STATIC_PIE_LDFLAGS isn't empty.\n\t* testsuite/ld-ifunc/ifunc.exp: Likewise.",
    "tree": {
      "sha": "4f53fc7857d2c79e5417bf0d6005c4cb1a8a7a11",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4f53fc7857d2c79e5417bf0d6005c4cb1a8a7a11"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b3d7a86748247a68c69939cdf9925d4a78448f2d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3d7a86748247a68c69939cdf9925d4a78448f2d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b3d7a86748247a68c69939cdf9925d4a78448f2d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3d7a86748247a68c69939cdf9925d4a78448f2d/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a0ea3a14dc6a6062c0c1f2bfbb7ad0373ec20843",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a0ea3a14dc6a6062c0c1f2bfbb7ad0373ec20843",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a0ea3a14dc6a6062c0c1f2bfbb7ad0373ec20843"
    }
  ],
  "stats": {
    "total": 111,
    "additions": 110,
    "deletions": 1
  },
  "files": [
    {
      "sha": "d5f44354ca750f4fe7714356874feaa2fb52c93f",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=b3d7a86748247a68c69939cdf9925d4a78448f2d",
      "patch": "@@ -1,3 +1,11 @@\n+2019-04-11  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\t* testsuite/config/default.exp (STATIC_PIE_LDFLAGS): New.  Set\n+\tto \"-static-pie\" if target compiler supports it.\n+\t* testsuite/ld-elf/elf.exp: Run -static-pie tests if\n+\t$STATIC_PIE_LDFLAGS isn't empty.\n+\t* testsuite/ld-ifunc/ifunc.exp: Likewise.\n+\n 2019-04-11  Tamar Christina  <tamar.christina@arm.com>\n \n \tPR ld/24302"
    },
    {
      "sha": "5acab06329132470e263281b41d9df142cce4d36",
      "filename": "ld/testsuite/config/default.exp",
      "status": "modified",
      "additions": 37,
      "deletions": 0,
      "changes": 37,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/testsuite/config/default.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/testsuite/config/default.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/config/default.exp?ref=b3d7a86748247a68c69939cdf9925d4a78448f2d",
      "patch": "@@ -454,3 +454,40 @@ if { ![info exists STATIC_LDFLAGS] } then {\n \tset STATIC_LDFLAGS \"\"\n     }\n }\n+\n+# Set STATIC_PIE_LDFLAGS to \"-static-pie\" if target compiler supports it.\n+\n+if { ![info exists STATIC_PIE_LDFLAGS] } then {\n+    if { [which $CC] != 0 } {\n+\t# Check if gcc supports -static-pie.\n+\tset flags \"\"\n+\tif [board_info [target_info name] exists cflags] {\n+\t    append flags \" [board_info [target_info name] cflags]\"\n+\t}\n+\tif [board_info [target_info name] exists ldflags] {\n+\t    append flags \" [board_info [target_info name] ldflags]\"\n+\t}\n+\n+\tset basename \"tmpdir/static[pid]\"\n+\tset src ${basename}.c\n+\tset output ${basename}\n+\tset f [open $src \"w\"]\n+\tputs $f \"int main (void) { return 0; }\"\n+\tclose $f\n+\tif [is_remote host] {\n+\t    set src [remote_download host $src]\n+\t}\n+\tset static_available [run_host_cmd_yesno \"$CC\" \"-static-pie $flags $src -o $output\"]\n+\tremote_file host delete $src\n+\tremote_file host delete $output\n+\tfile delete $src\n+\n+\tif { $static_available == 1 } then {\n+\t    set STATIC_PIE_LDFLAGS \"-static-pie\"\n+\t} else {\n+\t    set STATIC_PIE_LDFLAGS \"\"\n+\t}\n+    } else {\n+\tset STATIC_PIE_LDFLAGS \"\"\n+    }\n+}"
    },
    {
      "sha": "4686870916455213476410a8743827b5bd9ebdf4",
      "filename": "ld/testsuite/ld-elf/elf.exp",
      "status": "modified",
      "additions": 50,
      "deletions": 0,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/testsuite/ld-elf/elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/testsuite/ld-elf/elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/elf.exp?ref=b3d7a86748247a68c69939cdf9925d4a78448f2d",
      "patch": "@@ -235,6 +235,56 @@ if { [istarget *-*-linux*]\n      || [istarget *-*-gnu*] } {\n     run_ld_link_exec_tests $array_tests_pie $xfails\n \n+    if { $STATIC_PIE_LDFLAGS != \"\" } then {\n+\trun_ld_link_exec_tests [list \\\n+\t    [list \\\n+\t\t\"Static PIE preinit array\" \\\n+\t\t\"$STATIC_PIE_LDFLAGS\" \\\n+\t\t\"\" \\\n+\t\t{preinit.c} \\\n+\t\t\"preinit-static-pie\" \\\n+\t\t\"preinit.out\" \\\n+\t\t\"-fPIE\" \\\n+\t    ] \\\n+\t    [list \\\n+\t\t\"Static PIE init array\" \\\n+\t\t\"$STATIC_PIE_LDFLAGS\" \\\n+\t\t\"\" \\\n+\t\t{init.c} \\\n+\t\t\"init-static-pie\" \\\n+\t\t\"init.out\" \\\n+\t\t\"-fPIE\" \\\n+\t    ] \\\n+\t    [list \\\n+\t\t\"Static PIE fini array\" \\\n+\t\t\"$STATIC_PIE_LDFLAGS\" \\\n+\t\t\"\" \\\n+\t\t{fini.c} \\\n+\t\t\"fini-static-pie\" \\\n+\t\t\"fini.out\" \\\n+\t\t\"-fPIE\" \\\n+\t    ] \\\n+\t    [list \\\n+\t\t\"Static PIE init array mixed\" \\\n+\t\t\"$STATIC_PIE_LDFLAGS\" \\\n+\t\t\"\" \\\n+\t\t{init-mixed.c} \\\n+\t\t\"init-mixed-static-pie\" \\\n+\t\t\"init-mixed.out\" \\\n+\t\t\"-I.  -fPIE\" \\\n+\t    ] \\\n+\t    [list \\\n+\t\t\"Static PIE PR ld/14525\" \\\n+\t\t\"$STATIC_PIE_LDFLAGS\" \\\n+\t\t\"\" \\\n+\t\t{pr14525.c} \\\n+\t\t\"pr14525-static-pie\" \\\n+\t\t\"pr14525.out\" \\\n+\t\t\"-fPIE\" \\\n+\t    ] \\\n+\t]\n+    }\n+\n     run_ld_link_exec_tests [list \\\n \t[list \\\n \t    \"Run mbind2a\" \\"
    },
    {
      "sha": "e13b5615ff3e645a846f29ac4eab42eb981fa416",
      "filename": "ld/testsuite/ld-ifunc/ifunc.exp",
      "status": "modified",
      "additions": 15,
      "deletions": 1,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/testsuite/ld-ifunc/ifunc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3d7a86748247a68c69939cdf9925d4a78448f2d/ld/testsuite/ld-ifunc/ifunc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-ifunc/ifunc.exp?ref=b3d7a86748247a68c69939cdf9925d4a78448f2d",
      "patch": "@@ -777,6 +777,20 @@ run_ld_link_exec_tests [list \\\n \t\"pass.out\" \\\n \t\"-fPIE -O2 -g\" \\\n     ] \\\n-]}\n+]\n+if { $STATIC_PIE_LDFLAGS != \"\" } then {\n+    run_ld_link_exec_tests [list \\\n+\t[list \\\n+\t    \"Run pr23169g\" \\\n+\t    \"$STATIC_PIE_LDFLAGS\" \\\n+\t    \"\" \\\n+\t    { pr23169a.c pr23169b.c pr23169c.c } \\\n+\t    \"pr23169g\" \\\n+\t    \"pass.out\" \\\n+\t    \"-fPIE -O2 -g\" \\\n+\t] \\\n+]\n+}\n+}\n \n set ASFLAGS \"$saved_ASFLAGS\""
    }
  ]
}