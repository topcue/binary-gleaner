{
  "sha": "5809fbf2e289fc524d3086da62918876b66cefa8",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTgwOWZiZjJlMjg5ZmM1MjRkMzA4NmRhNjI5MTg4NzZiNjZjZWZhOA==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-07-05T19:02:40Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-04-15T09:34:09Z"
    },
    "message": "gdb: add \"set startup-quietly\" command\n\nThis adds a new command to change GDB to behave as though \"-quiet\"\nwere always given.  This new command can be added to the gdbearlyinit\nfile to affect future GDB sessions.\n\ngdb/ChangeLog:\n\n\t* NEWS: Add entry.\n\t* main.c (captured_main_1): Call check_quiet_mode.\n\t* top.c (startup_quiet): New global.\n\t(check_quiet_mode): New function.\n\t(show_startup_quiet): New function.\n\t(init_main): Register new command.\n\t* top.h (check_quiet_mode): Declare.\n\ngdb/doc/ChangeLog:\n\n\t* gdb.texinfo (Mode Options): Mention \"set startup-quietly\".\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.base/startup-file.exp: Add more tests.",
    "tree": {
      "sha": "991a62f7b453e581a709e31f7d7365da9c979d4b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/991a62f7b453e581a709e31f7d7365da9c979d4b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5809fbf2e289fc524d3086da62918876b66cefa8",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5809fbf2e289fc524d3086da62918876b66cefa8",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5809fbf2e289fc524d3086da62918876b66cefa8",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5809fbf2e289fc524d3086da62918876b66cefa8/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "92e4e97a9f569bf23b0f74479f32280c1f24cc6b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/92e4e97a9f569bf23b0f74479f32280c1f24cc6b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/92e4e97a9f569bf23b0f74479f32280c1f24cc6b"
    }
  ],
  "stats": {
    "total": 117,
    "additions": 117,
    "deletions": 0
  },
  "files": [
    {
      "sha": "53850586bd77129015d74b3aa51c92570129e2a9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -1,3 +1,14 @@\n+2021-04-15  Tom Tromey  <tom@tromey.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* NEWS: Add entry.\n+\t* main.c (captured_main_1): Call check_quiet_mode.\n+\t* top.c (startup_quiet): New global.\n+\t(check_quiet_mode): New function.\n+\t(show_startup_quiet): New function.\n+\t(init_main): Register new command.\n+\t* top.h (check_quiet_mode): Declare.\n+\n 2021-04-15  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \tPR cli/25956"
    },
    {
      "sha": "faccf40dd4138f2eae17b29ab3738a1a40209d7b",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -94,6 +94,13 @@ memory-tag set-allocation-tag ADDRESS LENGTH TAGS\n memory-tag check POINTER\n   Validate that POINTER's logical tag matches the allocation tag.\n \n+set startup-quietly on|off\n+show startup-quietly\n+  When 'on', this causes GDB to act as if \"-silent\" were passed on the\n+  command line.  This command needs to be added to an early\n+  initialization file (e.g. ~/.config/gdb/gdbearlyinit) in order to\n+  affect GDB.\n+\n * Changed commands\n \n break [PROBE_MODIFIER] [LOCATION] [thread THREADNUM]"
    },
    {
      "sha": "32801bf88bfc290beab7b518215f4d5aa735da7b",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -1,3 +1,8 @@\n+2021-04-15  Tom Tromey  <tom@tromey.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.texinfo (Mode Options): Mention \"set startup-quietly\".\n+\n 2021-04-15  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \tPR cli/25956"
    },
    {
      "sha": "d13cbda2c11014ebbfd3a731801b1cec13e11293",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -1112,6 +1112,14 @@ are still loaded.\n ``Quiet''.  Do not print the introductory and copyright messages.  These\n messages are also suppressed in batch mode.\n \n+@kindex set startup-quietly\n+@kindex show startup-quietly\n+This can also be enabled using @code{set startup-quietly on}.  The\n+default is @code{off}.  Use @code{show startup-quietly} to see the\n+current setting.  Place @code{set startup-quietly on} into your early\n+initialization file (@pxref{Initialization Files,,Initialization\n+Files}) to have future @value{GDBN} sessions startup quietly.\n+\n @item -batch\n @cindex @code{--batch}\n Run in batch mode.  Exit with status @code{0} after processing all the"
    },
    {
      "sha": "60c08fb83ddc8b50e019ded9ad154269e76ee011",
      "filename": "gdb/main.c",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/main.c?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -1053,6 +1053,11 @@ captured_main_1 (struct captured_main_args *context)\n   execute_cmdargs (&cmdarg_vec, CMDARG_EARLYINIT_FILE,\n \t\t   CMDARG_EARLYINIT_COMMAND, &ret);\n \n+  /* Recheck if we're starting up quietly after processing the startup\n+     scripts and commands.  */\n+  if (!quiet)\n+    quiet = check_quiet_mode ();\n+\n   /* Now that gdb_init has created the initial inferior, we're in\n      position to set args for that inferior.  */\n   if (set_args)"
    },
    {
      "sha": "f58d771f3ec2bd2424da69bd57e0c4625e3db781",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -1,3 +1,7 @@\n+2021-04-15  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.base/startup-file.exp: Add more tests.\n+\n 2021-04-15  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \tPR cli/25956"
    },
    {
      "sha": "9d5e84cdad1d4ccc3776d030c61dafcf60abf410",
      "filename": "gdb/testsuite/gdb.base/early-init-file.exp",
      "status": "modified",
      "additions": 39,
      "deletions": 0,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/testsuite/gdb.base/early-init-file.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/testsuite/gdb.base/early-init-file.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/early-init-file.exp?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -66,6 +66,21 @@ proc setup_home_directories { prefix content } {\n     return [list $home_dir $xdg_home_dir]\n }\n \n+# Restart GDB and ensure that there's no license text, we should just\n+# drop straight to the prompt.\n+proc check_gdb_startups_up_quietly { message } {\n+    global gdb_prompt\n+\n+    gdb_exit\n+    gdb_spawn\n+\n+    gdb_test_multiple \"\" $message {\n+\t-re \"^$gdb_prompt $\" {\n+\t    pass $gdb_test_name\n+\t}\n+    }\n+}\n+\n save_vars { env(TERM) } {\n     # We need an ANSI-capable terminal to get the output.\n     setenv TERM ansi\n@@ -106,4 +121,28 @@ save_vars { env(TERM) } {\n \tcheck_gdb_startup_version_string none \\\n \t    \"check version string is unstyled using XDG_CONFIG_HOME\"\n     }\n+\n+    # Create two directories to use for the quiet startup test.\n+    set dirs [setup_home_directories \"quiet\" \"set startup-quietly on\"]\n+    set home_dir [lindex $dirs 0]\n+    set xdg_home_dir [lindex $dirs 1]\n+\n+    # Now arrange to use the fake home directory startup file.\n+    save_vars { INTERNAL_GDBFLAGS env(HOME) env(XDG_CONFIG_HOME) } {\n+\tset INTERNAL_GDBFLAGS [string map {\"-nx\" \"\"} $INTERNAL_GDBFLAGS]\n+\n+\t# Now test GDB when using the HOME directory.\n+\tset env(HOME) $home_dir\n+\tunset -nocomplain env(XDG_CONFIG_HOME)\n+\tcheck_gdb_startups_up_quietly \\\n+\t    \"check GDB starts quietly using HOME\"\n+\n+\t# Now test using the XDG_CONFIG_HOME folder.  We still need to\n+\t# have a HOME directory set otherwise GDB will issue an error\n+\t# about not knowing where to place the index cache.\n+\tset env(XDG_CONFIG_HOME) $xdg_home_dir\n+\tset env(HOME) $empty_home_dir\n+\tcheck_gdb_startups_up_quietly \\\n+\t    \"check GDB starts quietly using XDG_CONFIG_HOME\"\n+    }\n }"
    },
    {
      "sha": "ecd90a1433a74cbc28c68f539afe8b14335264a2",
      "filename": "gdb/top.c",
      "status": "modified",
      "additions": 33,
      "deletions": 0,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.c?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -2163,6 +2163,28 @@ set_history_filename (const char *args,\n     }\n }\n \n+/* Whether we're in quiet startup mode.  */\n+\n+static bool startup_quiet;\n+\n+/* See top.h.  */\n+\n+bool\n+check_quiet_mode ()\n+{\n+  return startup_quiet;\n+}\n+\n+/* Show whether GDB should start up in quiet mode.  */\n+\n+static void\n+show_startup_quiet (struct ui_file *file, int from_tty,\n+\t      struct cmd_list_element *c, const char *value)\n+{\n+  fprintf_filtered (file, _(\"Whether to start up quietly is %s.\\n\"),\n+\t\t    value);\n+}\n+\n static void\n init_gdb_version_vars (void)\n {\n@@ -2319,6 +2341,17 @@ input settings.\"),\n \t\t\tshow_interactive_mode,\n \t\t\t&setlist, &showlist);\n \n+  c = add_setshow_boolean_cmd (\"startup-quietly\", class_support,\n+\t\t\t       &startup_quiet, _(\"\\\n+Set whether GDB should start up quietly.\"), _(\"\t\t\\\n+Show whether GDB should start up quietly.\"), _(\"\\\n+This setting will not affect the current session.  Instead this command\\n\\\n+should be added to the .gdbearlyinit file in the users home directory to\\n\\\n+affect future GDB sessions.\"),\n+\t\t\t       NULL,\n+\t\t\t       show_startup_quiet,\n+\t\t\t       &setlist, &showlist);\n+\n   c = add_cmd (\"new-ui\", class_support, new_ui_command, _(\"\\\n Create a new UI.\\n\\\n Usage: new-ui INTERPRETER TTY\\n\\"
    },
    {
      "sha": "9438e52331b508e6f1fd6c6a1303699f4e86ab53",
      "filename": "gdb/top.h",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/top.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5809fbf2e289fc524d3086da62918876b66cefa8/gdb/top.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.h?ref=5809fbf2e289fc524d3086da62918876b66cefa8",
      "patch": "@@ -291,4 +291,9 @@ extern char *handle_line_of_input (struct buffer *cmd_line_buffer,\n \t\t\t\t   const char *rl, int repeat,\n \t\t\t\t   const char *annotation_suffix);\n \n+/* Call at startup to see if the user has requested that gdb start up\n+   quietly.  */\n+\n+extern bool check_quiet_mode ();\n+\n #endif"
    }
  ]
}