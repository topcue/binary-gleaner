{
  "sha": "2b4e6a3f4b66284556254f548716c7b21b93524a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmI0ZTZhM2Y0YjY2Mjg0NTU2MjU0ZjU0ODcxNmM3YjIxYjkzNTI0YQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-06-11T16:34:31Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-06-11T16:34:31Z"
    },
    "message": "Fix hex floating point lexing\n\nPR gdb/18318 notes that gdb will sometimes incorrectly handle hex\nfloating point input.  This turns out to be a bug in the C lexer; the\n'p' was not being correctly recognized, and so the exponent was not\nalways passed to the floating point \"from_string\" method.\n\nTested by the buildbot \"Fedora-x86_64-m64\" builder.\n\ngdb/ChangeLog\n2020-06-11  Tom Tromey  <tom@tromey.com>\n\n\tPR gdb/18318:\n\t* c-exp.y (lex_one_token): Handle 'p' like 'e'.\n\ngdb/testsuite/ChangeLog\n2020-06-11  Tom Tromey  <tom@tromey.com>\n\n\tPR gdb/18318:\n\t* gdb.base/printcmds.exp (test_float_accepted): Add more hex\n\tfloating point tests.",
    "tree": {
      "sha": "347344736ca24012aceb5c9c8bc4e0dd06e50dcd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/347344736ca24012aceb5c9c8bc4e0dd06e50dcd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2b4e6a3f4b66284556254f548716c7b21b93524a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2b4e6a3f4b66284556254f548716c7b21b93524a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2b4e6a3f4b66284556254f548716c7b21b93524a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2b4e6a3f4b66284556254f548716c7b21b93524a/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4412332f4b3a4ec570c378ff98ec671dd83a2959",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4412332f4b3a4ec570c378ff98ec671dd83a2959",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4412332f4b3a4ec570c378ff98ec671dd83a2959"
    }
  ],
  "stats": {
    "total": 40,
    "additions": 27,
    "deletions": 13
  },
  "files": [
    {
      "sha": "5ef6ee6aca4616d77268f680ebadbc70ffd187fb",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=2b4e6a3f4b66284556254f548716c7b21b93524a",
      "patch": "@@ -1,3 +1,8 @@\n+2020-06-11  Tom Tromey  <tom@tromey.com>\n+\n+\tPR gdb/18318:\n+\t* c-exp.y (lex_one_token): Handle 'p' like 'e'.\n+\n 2020-06-09  Jonny Grant  <jg@jguk.org>\n 2020-06-09  Simon Marchi  <simon.marchi@polymtl.ca>\n "
    },
    {
      "sha": "5ec84eb8ed7abcd09287c2aaab10a53f5095a44e",
      "filename": "gdb/c-exp.y",
      "status": "modified",
      "additions": 7,
      "deletions": 4,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/c-exp.y",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/c-exp.y",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/c-exp.y?ref=2b4e6a3f4b66284556254f548716c7b21b93524a",
      "patch": "@@ -2748,7 +2748,7 @@ lex_one_token (struct parser_state *par_state, bool *is_quoted_name)\n     case '9':\n       {\n \t/* It's a number.  */\n-\tint got_dot = 0, got_e = 0, toktype;\n+\tint got_dot = 0, got_e = 0, got_p = 0, toktype;\n \tconst char *p = tokstart;\n \tint hex = input_radix > 10;\n \n@@ -2768,13 +2768,16 @@ lex_one_token (struct parser_state *par_state, bool *is_quoted_name)\n \t    /* This test includes !hex because 'e' is a valid hex digit\n \t       and thus does not indicate a floating point number when\n \t       the radix is hex.  */\n-\t    if (!hex && !got_e && (*p == 'e' || *p == 'E'))\n+\t    if (!hex && !got_e && !got_p && (*p == 'e' || *p == 'E'))\n \t      got_dot = got_e = 1;\n+\t    else if (!got_e && !got_p && (*p == 'p' || *p == 'P'))\n+\t      got_dot = got_p = 1;\n \t    /* This test does not include !hex, because a '.' always indicates\n \t       a decimal floating point number regardless of the radix.  */\n \t    else if (!got_dot && *p == '.')\n \t      got_dot = 1;\n-\t    else if (got_e && (p[-1] == 'e' || p[-1] == 'E')\n+\t    else if (((got_e && (p[-1] == 'e' || p[-1] == 'E'))\n+\t\t      || (got_p && (p[-1] == 'p' || p[-1] == 'P')))\n \t\t     && (*p == '-' || *p == '+'))\n \t      /* This is the sign of the exponent, not the end of the\n \t\t number.  */\n@@ -2787,7 +2790,7 @@ lex_one_token (struct parser_state *par_state, bool *is_quoted_name)\n \t      break;\n \t  }\n \ttoktype = parse_number (par_state, tokstart, p - tokstart,\n-\t\t\t\tgot_dot|got_e, &yylval);\n+\t\t\t\tgot_dot | got_e | got_p, &yylval);\n         if (toktype == ERROR)\n \t  {\n \t    char *err_copy = (char *) alloca (p - tokstart + 1);"
    },
    {
      "sha": "0523f7cb8813b47bca9d4b4483ec0fb416ed6b1e",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=2b4e6a3f4b66284556254f548716c7b21b93524a",
      "patch": "@@ -1,3 +1,9 @@\n+2020-06-11  Tom Tromey  <tom@tromey.com>\n+\n+\tPR gdb/18318:\n+\t* gdb.base/printcmds.exp (test_float_accepted): Add more hex\n+\tfloating point tests.\n+\n 2020-06-11  Keith Seitz  <keiths@redhat.com>\n \n \tPR gdb/21356"
    },
    {
      "sha": "0a96b228b89d0656df1fe5d6b16ff7186fcd20c0",
      "filename": "gdb/testsuite/gdb.base/printcmds.exp",
      "status": "modified",
      "additions": 9,
      "deletions": 9,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/testsuite/gdb.base/printcmds.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2b4e6a3f4b66284556254f548716c7b21b93524a/gdb/testsuite/gdb.base/printcmds.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/printcmds.exp?ref=2b4e6a3f4b66284556254f548716c7b21b93524a",
      "patch": "@@ -127,15 +127,15 @@ proc test_float_accepted {} {\n     gdb_test \"p 1.5l\" \" = 1.5\"\n \n     # Test hexadecimal floating point.\n-    set test \"p 0x1.1\"\n-    gdb_test_multiple $test $test {\n-\t-re \" = 1\\\\.0625\\r\\n$gdb_prompt $\" {\n-\t    pass $test\n-\t}\n-\t-re \"Invalid number \\\"0x1\\\\.1\\\"\\\\.\\r\\n$gdb_prompt $\" {\n-\t    # Older glibc does not support hex float, newer does.\n-\t    xfail $test\n-\t}\n+    foreach {num result} {\n+\t0x1.1 1.0625\n+\t0x1.8480000000000p+6 97.125\n+\t0x1.8480000000000p6 97.125\n+\t0x00.1p0 0.0625\n+\t0x00.1p1 0.125\n+\t0x00.1p-1 0.03125\n+    } {\n+\tgdb_test \"p $num\" \" = [string_to_regexp $result]\"\n     }\n }\n "
    }
  ]
}