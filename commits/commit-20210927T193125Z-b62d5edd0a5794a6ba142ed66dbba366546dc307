{
  "sha": "b62d5edd0a5794a6ba142ed66dbba366546dc307",
  "node_id": "C_kwDOANOeidoAKGI2MmQ1ZWRkMGE1Nzk0YTZiYTE0MmVkNjZkYmJhMzY2NTQ2ZGMzMDc",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-09-27T19:31:21Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-09-27T19:31:25Z"
    },
    "message": "libctf: fix handling of CTF symtypetab sections emitted by older GCC\n\nOlder (pre-upstreaming) GCC emits a function symtypetab section of a\nformat never read by any extant libctf.  We can detect such CTF dicts by\nthe lack of the CTF_F_NEWFUNCINFO flag in their header, and we do so\nwhen reading in the symtypetab section -- but if the set of symbols with\ntypes is sufficiently sparse, even an older GCC will emit a function\nindex section.\n\nIn NEWFUNCINFO-capable compilers, this section will always be the exact\nsame length as the corresponding function section (each is an array of\nuint32_t, associated 1:1 with each other). But this is not true for the\nolder compiler, for which the sections are different lengths.  We check\nto see if the function symtypetab section and its index are the same\nlength, but we fail to skip this check when this is not a NEWFUNCINFO\ndict, and emit a spurious corruption error for a CTF dict we could\nhave perfectly well opened and used.\n\nFix trivial: check the flag (and fix the terrible grammar of the error\nmessage at the same time).\n\nlibctf/ChangeLog\n2021-09-27  Nick Alcock  <nick.alcock@oracle.com>\n\n\t* ctf-open.c (ctf_bufopen_internal): Don't complain about corrupt\n\tfunction index symtypetab sections if this is an old-format\n\tfunction symtypetab section (which should be ignored in any case).\n\tFix bad grammar.",
    "tree": {
      "sha": "8b0136f8c17bafda082c6dc66677b1e7ac16a10a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8b0136f8c17bafda082c6dc66677b1e7ac16a10a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b62d5edd0a5794a6ba142ed66dbba366546dc307",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b62d5edd0a5794a6ba142ed66dbba366546dc307",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b62d5edd0a5794a6ba142ed66dbba366546dc307",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b62d5edd0a5794a6ba142ed66dbba366546dc307/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b9004024b9c0af433952551e3317c6382a7bede3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b9004024b9c0af433952551e3317c6382a7bede3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b9004024b9c0af433952551e3317c6382a7bede3"
    }
  ],
  "stats": {
    "total": 14,
    "additions": 11,
    "deletions": 3
  },
  "files": [
    {
      "sha": "66423cfa48c69b3c54cb545660d415fe629899dd",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b62d5edd0a5794a6ba142ed66dbba366546dc307/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b62d5edd0a5794a6ba142ed66dbba366546dc307/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=b62d5edd0a5794a6ba142ed66dbba366546dc307",
      "patch": "@@ -1,3 +1,10 @@\n+2021-09-27  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* ctf-open.c (ctf_bufopen_internal): Don't complain about corrupt\n+\tfunction index symtypetab sections if this is an old-format\n+\tfunction symtypetab section (which should be ignored in any case).\n+\tFix bad grammar.\n+\n 2021-09-27  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* configure: Regenerate."
    },
    {
      "sha": "caeff06425af4a51a18507d0450caabe62b645a9",
      "filename": "libctf/ctf-open.c",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b62d5edd0a5794a6ba142ed66dbba366546dc307/libctf/ctf-open.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b62d5edd0a5794a6ba142ed66dbba366546dc307/libctf/ctf-open.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ctf-open.c?ref=b62d5edd0a5794a6ba142ed66dbba366546dc307",
      "patch": "@@ -1449,7 +1449,7 @@ ctf_bufopen_internal (const ctf_sect_t *ctfsect, const ctf_sect_t *symsect,\n        != hp->cth_funcoff - hp->cth_objtoff))\n     {\n       ctf_err_warn (NULL, 0, ECTF_CORRUPT,\n-\t\t    _(\"Object index section exists is neither empty nor the \"\n+\t\t    _(\"Object index section is neither empty nor the \"\n \t\t      \"same length as the object section: %u versus %u \"\n \t\t      \"bytes\"), hp->cth_funcoff - hp->cth_objtoff,\n \t\t    hp->cth_funcidxoff - hp->cth_objtidxoff);\n@@ -1458,10 +1458,11 @@ ctf_bufopen_internal (const ctf_sect_t *ctfsect, const ctf_sect_t *symsect,\n \n   if ((hp->cth_varoff - hp->cth_funcidxoff != 0) &&\n       (hp->cth_varoff - hp->cth_funcidxoff\n-       != hp->cth_objtidxoff - hp->cth_funcoff))\n+       != hp->cth_objtidxoff - hp->cth_funcoff) &&\n+      (hp->cth_flags & CTF_F_NEWFUNCINFO))\n     {\n       ctf_err_warn (NULL, 0, ECTF_CORRUPT,\n-\t\t    _(\"Function index section exists is neither empty nor the \"\n+\t\t    _(\"Function index section is neither empty nor the \"\n \t\t      \"same length as the function section: %u versus %u \"\n \t\t      \"bytes\"), hp->cth_objtidxoff - hp->cth_funcoff,\n \t\t    hp->cth_varoff - hp->cth_funcidxoff);"
    }
  ]
}