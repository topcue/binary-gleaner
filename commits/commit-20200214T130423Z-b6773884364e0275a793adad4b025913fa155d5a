{
  "sha": "b6773884364e0275a793adad4b025913fa155d5a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjY3NzM4ODQzNjRlMDI3NWE3OTNhZGFkNGIwMjU5MTNmYTE1NWQ1YQ==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-02-14T13:04:23Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-02-14T13:04:23Z"
    },
    "message": "x86: adjust segment override prefix emission\n\nSince we already suppress the prefix altogether when it's the default\none for the chosen addressing mode, let's do so also when instruction\nprefix and override specified with the memory operand match. (Note that\ninsn prefix specified segment overrides never get discarded.)",
    "tree": {
      "sha": "4658777b7d567dda75bd6d901649f140f8597332",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4658777b7d567dda75bd6d901649f140f8597332"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b6773884364e0275a793adad4b025913fa155d5a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b6773884364e0275a793adad4b025913fa155d5a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b6773884364e0275a793adad4b025913fa155d5a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b6773884364e0275a793adad4b025913fa155d5a/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "92334ad2c6ad3aef4f78894c4d0f2794255317b3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/92334ad2c6ad3aef4f78894c4d0f2794255317b3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/92334ad2c6ad3aef4f78894c4d0f2794255317b3"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 29,
    "deletions": 6
  },
  "files": [
    {
      "sha": "56d50719a2a746fa8df8cfddcc3cfcf72d4ee9d0",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b6773884364e0275a793adad4b025913fa155d5a/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b6773884364e0275a793adad4b025913fa155d5a/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=b6773884364e0275a793adad4b025913fa155d5a",
      "patch": "@@ -1,3 +1,11 @@\n+2020-02-14  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* config/tc-i386.c (process_operands): Also skip segment\n+\toverride prefix emission if it matches an already present one.\n+\t* testsuite/gas/i386/prefix32.s: Add double segment override\n+\tcases.\n+\t* testsuite/gas/i386/prefix32.l: Adjust expectations.\n+\n 2020-02-14  Jan Beulich  <jbeulich@suse.com>\n \n \t* config/tc-i386.c (process_operands): Drop ineffectual segment"
    },
    {
      "sha": "0e60919e492046ec6a416e29a8e330b4af5d4a4d",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 7,
      "deletions": 5,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b6773884364e0275a793adad4b025913fa155d5a/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b6773884364e0275a793adad4b025913fa155d5a/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=b6773884364e0275a793adad4b025913fa155d5a",
      "patch": "@@ -7178,11 +7178,13 @@ process_operands (void)\n     }\n \n   /* If a segment was explicitly specified, and the specified segment\n-     is not the default, use an opcode prefix to select it.  If we\n-     never figured out what the default segment is, then default_seg\n-     will be zero at this point, and the specified segment prefix will\n-     always be used.  */\n-  if ((i.seg[0]) && (i.seg[0] != default_seg))\n+     is neither the default nor the one already recorded from a prefix,\n+     use an opcode prefix to select it.  If we never figured out what\n+     the default segment is, then default_seg will be zero at this\n+     point, and the specified segment prefix will always be used.  */\n+  if (i.seg[0]\n+      && i.seg[0] != default_seg\n+      && i.seg[0]->seg_prefix != i.prefix[SEG_PREFIX])\n     {\n       if (!add_prefix (i.seg[0]->seg_prefix))\n \treturn 0;"
    },
    {
      "sha": "09a00cd03d9707b11aabf9f744248f75748404ef",
      "filename": "gas/testsuite/gas/i386/prefix32.l",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b6773884364e0275a793adad4b025913fa155d5a/gas/testsuite/gas/i386/prefix32.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b6773884364e0275a793adad4b025913fa155d5a/gas/testsuite/gas/i386/prefix32.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/prefix32.l?ref=b6773884364e0275a793adad4b025913fa155d5a",
      "patch": "@@ -8,6 +8,7 @@\n .*:19: Error: same type of prefix .*\n .*:20: Error: data size .* `vaddps'\n .*:21: Error: data size .* `vaddpd'\n+.*:25: Error: same type of prefix .*\n GAS LISTING .*\n #...\n [ \t]*1[ \t]+\\.text\n@@ -33,4 +34,10 @@ GAS LISTING .*\n [ \t]*20[ \t]+data16 vaddps\t%xmm0, %xmm0, %xmm0\n [ \t]*21[ \t]+data16 vaddpd\t%xmm0, %xmm0, %xmm0\n [ \t]*22[ \t]*\n-[ \t]*23[ \t]*[\\?]+ 0+[ \\t]+\\.p2align\t4,0\n+[ \t]*23[ \t]+\\.Lsegment:\n+[ \t]*24[ \t]+\\?\\?\\?\\? 368B4500[ \t]+ss mov\t\t%ss:\\(%ebp\\), %eax\n+[ \t]*25[ \t]+ss mov\t\t%ds:\\(%ebp\\), %eax\n+[ \t]*26[ \t]+\\?\\?\\?\\? 3E8B4500[ \t]+ds mov\t\t%ss:\\(%ebp\\), %eax\n+[ \t]*27[ \t]+\\?\\?\\?\\? 3E8B4500[ \t]+ds mov\t\t%ds:\\(%ebp\\), %eax\n+[ \t]*28[ \t]*\n+#pass"
    },
    {
      "sha": "a4382a2b616117150205458f45efdba769fb5589",
      "filename": "gas/testsuite/gas/i386/prefix32.s",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b6773884364e0275a793adad4b025913fa155d5a/gas/testsuite/gas/i386/prefix32.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b6773884364e0275a793adad4b025913fa155d5a/gas/testsuite/gas/i386/prefix32.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/prefix32.s?ref=b6773884364e0275a793adad4b025913fa155d5a",
      "patch": "@@ -20,4 +20,10 @@ prefix:\n \tdata16 vaddps\t%xmm0, %xmm0, %xmm0\n \tdata16 vaddpd\t%xmm0, %xmm0, %xmm0\n \n+.Lsegment:\n+\tss mov\t\t%ss:(%ebp), %eax\n+\tss mov\t\t%ds:(%ebp), %eax\n+\tds mov\t\t%ss:(%ebp), %eax\n+\tds mov\t\t%ds:(%ebp), %eax\n+\n \t.p2align\t4,0"
    }
  ]
}