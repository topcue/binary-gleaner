{
  "sha": "86e887ae1183ded1c4bfba8617e4e19c8dfc8271",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ODZlODg3YWUxMTgzZGVkMWM0YmZiYTg2MTdlNGUxOWM4ZGZjODI3MQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-04-24T14:21:30Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-04-24T14:21:30Z"
    },
    "message": "[gdb/testsuite] Reset errcnt in clean_restart\n\nWhen running test-case gdb.base/readnever.exp without commit 96038148d0e\n\"[gdb/testsuite] Skip gdb.base/readnever.exp with target board readnow\", we\nrun into an error:\n...\nERROR: (eof) GDB never initialized.\ntestcase gdb/testsuite/gdb.base/readnever.exp completed in 0 seconds\n...\n\nIf we additionally run test-case gdb.base/realname-expand.exp, we get an\nunresolved for the first test:\n...\nUNRESOLVED: gdb.base/realname-expand.exp: set basenames-may-differ on\n...\n\nUsing -v we find out that the UNRESOLVED is due the error triggered in the\nprevious test-case:\n...\n(gdb) set basenames-may-differ on^M\n(gdb) Error/Warning threshold exceeded:  1 0 (max. 1 3)\nUNRESOLVED: gdb.base/realname-expand.exp: set basenames-may-differ on\n...\n\nSo, the error count of one test spills into the next test, even though we do a\nclean restart.  That seems like a bad idea.\n\nFix this by resetting errcnt (as well as warncnt) in clean_restart, such that\nwe have:\n...\nRunning src/gdb/testsuite/gdb.base/readnever.exp ...\nERROR: (eof) GDB never initialized.\nRunning src/gdb/testsuite/gdb.base/realname-expand.exp ...\nPASS: gdb.base/realname-expand.exp: set basenames-may-differ on\n...\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2020-04-24  Tom de Vries  <tdevries@suse.de>\n\n\t* lib/gdb.exp (clean_restart): Reset errcnt and warncnt.",
    "tree": {
      "sha": "a4c045065001dd12fca46578d37fdf98100cde80",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a4c045065001dd12fca46578d37fdf98100cde80"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/86e887ae1183ded1c4bfba8617e4e19c8dfc8271",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/86e887ae1183ded1c4bfba8617e4e19c8dfc8271",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/86e887ae1183ded1c4bfba8617e4e19c8dfc8271",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/86e887ae1183ded1c4bfba8617e4e19c8dfc8271/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7be2bb4f47b7b25d4f60b52f6ebaade0644827f2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7be2bb4f47b7b25d4f60b52f6ebaade0644827f2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7be2bb4f47b7b25d4f60b52f6ebaade0644827f2"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 10,
    "deletions": 2
  },
  "files": [
    {
      "sha": "7426bdde4cd624f8791c0606573f57a94fc42cb2",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/86e887ae1183ded1c4bfba8617e4e19c8dfc8271/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/86e887ae1183ded1c4bfba8617e4e19c8dfc8271/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=86e887ae1183ded1c4bfba8617e4e19c8dfc8271",
      "patch": "@@ -1,3 +1,7 @@\n+2020-04-24  Tom de Vries  <tdevries@suse.de>\n+\n+\t* lib/gdb.exp (clean_restart): Reset errcnt and warncnt.\n+\n 2020-04-24  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.dwarf2/dwzbuildid.exp: Add quiet to dwzbuildid-mismatch compile"
    },
    {
      "sha": "2208f3a1a9b30de8a8d8534d75a5c8af7368580c",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/86e887ae1183ded1c4bfba8617e4e19c8dfc8271/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/86e887ae1183ded1c4bfba8617e4e19c8dfc8271/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=86e887ae1183ded1c4bfba8617e4e19c8dfc8271",
      "patch": "@@ -6108,22 +6108,26 @@ proc clean_restart { args } {\n     global srcdir\n     global subdir\n     global errcnt\n+    global warncnt\n \n     if { [llength $args] > 1 } {\n \terror \"bad number of args: [llength $args]\"\n     }\n \n     gdb_exit\n \n+    # This is a clean restart, so reset error and warning count.\n+    set errcnt 0\n+    set warncnt 0\n+\n     # We'd like to do:\n     #   if { [gdb_start] == -1 } {\n     #     return -1\n     #   }\n     # but gdb_start is a ${tool}_start proc, which doesn't have a defined\n     # return value.  So instead, we test for errcnt.\n-    set saved_errcnt $errcnt\n     gdb_start\n-    if { $errcnt > $saved_errcnt } {\n+    if { $errcnt > 0 } {\n \treturn -1\n     }\n "
    }
  ]
}