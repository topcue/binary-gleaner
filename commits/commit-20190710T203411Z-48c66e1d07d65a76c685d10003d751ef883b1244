{
  "sha": "48c66e1d07d65a76c685d10003d751ef883b1244",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDhjNjZlMWQwN2Q2NWE3NmM2ODVkMTAwMDNkNzUxZWY4ODNiMTI0NA==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-06-27T19:52:42Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-07-10T20:34:11Z"
    },
    "message": "Change solib-spu.c to use type-safe registry\n\nThis changes solib-spu.c to use the type-safe registry.\n\n2019-07-10  Tom Tromey  <tromey@adacore.com>\n\n\t* solib-spu.c (ocl_program_data_key): Change type.\n\t(append_ocl_sos, ocl_enable_break, _initialize_spu_solib):\n\tUpdate.",
    "tree": {
      "sha": "28513d88b6b2040813823941d823a9c08a305164",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/28513d88b6b2040813823941d823a9c08a305164"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/48c66e1d07d65a76c685d10003d751ef883b1244",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/48c66e1d07d65a76c685d10003d751ef883b1244",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/48c66e1d07d65a76c685d10003d751ef883b1244",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/48c66e1d07d65a76c685d10003d751ef883b1244/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a269fbf12dcc621c45030ab9956ae28053878b7c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a269fbf12dcc621c45030ab9956ae28053878b7c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a269fbf12dcc621c45030ab9956ae28053878b7c"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 11,
    "deletions": 7
  },
  "files": [
    {
      "sha": "303fe15e90de5dc9ab11f603e6a7cd4f6919299f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/48c66e1d07d65a76c685d10003d751ef883b1244/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/48c66e1d07d65a76c685d10003d751ef883b1244/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=48c66e1d07d65a76c685d10003d751ef883b1244",
      "patch": "@@ -1,3 +1,9 @@\n+2019-07-10  Tom Tromey  <tromey@adacore.com>\n+\n+\t* solib-spu.c (ocl_program_data_key): Change type.\n+\t(append_ocl_sos, ocl_enable_break, _initialize_spu_solib):\n+\tUpdate.\n+\n 2019-07-10  Tom Tromey  <tromey@adacore.com>\n \n \t* solib-aix.c (lm_info_aix_p): Remove typedef.  Don't define VEC."
    },
    {
      "sha": "448e1a64f4cb99536930b5b65db46104b6a13af1",
      "filename": "gdb/solib-spu.c",
      "status": "modified",
      "additions": 5,
      "deletions": 7,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/48c66e1d07d65a76c685d10003d751ef883b1244/gdb/solib-spu.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/48c66e1d07d65a76c685d10003d751ef883b1244/gdb/solib-spu.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/solib-spu.c?ref=48c66e1d07d65a76c685d10003d751ef883b1244",
      "patch": "@@ -94,7 +94,8 @@ spu_skip_standalone_loader (void)\n     }\n }\n \n-static const struct objfile_data *ocl_program_data_key;\n+static objfile_key<CORE_ADDR, gdb::noop_deleter<CORE_ADDR>>\n+  ocl_program_data_key;\n \n /* Appends OpenCL programs to the list of `struct so_list' objects.  */\n static void\n@@ -104,8 +105,7 @@ append_ocl_sos (struct so_list **link_ptr)\n \n   for (objfile *objfile : current_program_space->objfiles ())\n     {\n-      ocl_program_addr_base\n-\t= (CORE_ADDR *) objfile_data (objfile, ocl_program_data_key);\n+      ocl_program_addr_base = ocl_program_data_key.get (objfile);\n       if (ocl_program_addr_base != NULL)\n         {\n \t  enum bfd_endian byte_order = bfd_big_endian (objfile->obfd)?\n@@ -448,15 +448,14 @@ ocl_enable_break (struct objfile *objfile)\n \n       /* Store the address of the symbol that will point to OpenCL program\n          using the per-objfile private data mechanism.  */\n-      if (objfile_data (objfile, ocl_program_data_key) == NULL)\n+      if (ocl_program_data_key.get (objfile) == NULL)\n         {\n           CORE_ADDR *ocl_program_addr_base = OBSTACK_CALLOC (\n \t\t  &objfile->objfile_obstack,\n \t\t  objfile->sections_end - objfile->sections,\n \t\t  CORE_ADDR);\n \t  *ocl_program_addr_base = BMSYMBOL_VALUE_ADDRESS (addr_sym);\n-\t  set_objfile_data (objfile, ocl_program_data_key,\n-\t\t\t    ocl_program_addr_base);\n+\t  ocl_program_data_key.set (objfile, ocl_program_addr_base);\n         }\n     }\n }\n@@ -544,6 +543,5 @@ void\n _initialize_spu_solib (void)\n {\n   gdb::observers::solib_loaded.attach (spu_solib_loaded);\n-  ocl_program_data_key = register_objfile_data ();\n }\n "
    }
  ]
}