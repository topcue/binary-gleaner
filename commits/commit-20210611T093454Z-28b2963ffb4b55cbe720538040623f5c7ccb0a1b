{
  "sha": "28b2963ffb4b55cbe720538040623f5c7ccb0a1b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjhiMjk2M2ZmYjRiNTVjYmU3MjA1MzgwNDA2MjNmNWM3Y2NiMGExYg==",
  "commit": {
    "author": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-06-11T09:23:43Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-06-11T09:34:54Z"
    },
    "message": "RISC-V: Update the riscv_opts.[rvc|rve] in the riscv_set_arch.\n\nWe also need to update the riscv_opts.[rvc|rve] for elf attributes.\nOtherwise, the following case will fail,\n\n$ cat cadd.s\n.attribute arch, \"rv64gc\"\nc.add   a0, a1\n$ riscv64-unknown-elf-as cadd.s -o cadd.o\ncadd.s: Assembler messages:\ncadd.s:2: Error: illegal operands `c.add a0,a1\n\nAfter applying this patch,\n\n$ riscv64-unknown-elf-as cadd.s -o cadd.o\n$ riscv64-unknown-elf-objdump -d cadd.o\n\ncadd.o:     file format elf64-littleriscv\n\nDisassembly of section .text:\n\n0000000000000000 <.text>:\n   0:   952e                    add     a0,a0,a1\n        ...\n\ngas/\n    * config/tc-riscv.c (riscv_set_arch): Call riscv_set_rvc\n    and riscv_set_rve both for -march and elf attributes.\n    (riscv_after_parse_args): Likewise.",
    "tree": {
      "sha": "f242ee4bdc89e42a734f4160182f7ae02f8427e7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f242ee4bdc89e42a734f4160182f7ae02f8427e7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/28b2963ffb4b55cbe720538040623f5c7ccb0a1b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/28b2963ffb4b55cbe720538040623f5c7ccb0a1b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/28b2963ffb4b55cbe720538040623f5c7ccb0a1b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/28b2963ffb4b55cbe720538040623f5c7ccb0a1b/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "066f8fbede55e781c6241c445e0940f8368d0ef9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/066f8fbede55e781c6241c445e0940f8368d0ef9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/066f8fbede55e781c6241c445e0940f8368d0ef9"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 14,
    "deletions": 10
  },
  "files": [
    {
      "sha": "11693d33182131d27e345f8c7f46ead2cca1404e",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28b2963ffb4b55cbe720538040623f5c7ccb0a1b/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28b2963ffb4b55cbe720538040623f5c7ccb0a1b/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=28b2963ffb4b55cbe720538040623f5c7ccb0a1b",
      "patch": "@@ -1,3 +1,9 @@\n+2021-06-11  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* config/tc-riscv.c (riscv_set_arch): Call riscv_set_rvc\n+\tand riscv_set_rve both for -march and elf attributes.\n+\t(riscv_after_parse_args): Likewise.\n+\n 2021-06-10  Jan Beulich  <jbeulich@suse.com>\n \n \t* config/tc-arm.c (do_bfloat_vfma): Rename index to idx."
    },
    {
      "sha": "70cbc8190fe31146da38508ae7d1d0c5f27fd82e",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 8,
      "deletions": 10,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/28b2963ffb4b55cbe720538040623f5c7ccb0a1b/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/28b2963ffb4b55cbe720538040623f5c7ccb0a1b/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=28b2963ffb4b55cbe720538040623f5c7ccb0a1b",
      "patch": "@@ -417,6 +417,14 @@ riscv_set_arch (const char *s)\n \n   riscv_release_subset_list (&riscv_subsets);\n   riscv_parse_subset (&rps, s);\n+\n+  /* To support .option rvc and rve.  */\n+  riscv_set_rvc (false);\n+  if (riscv_subset_supports (\"c\"))\n+    riscv_set_rvc (true);\n+  riscv_set_rve (false);\n+  if (riscv_subset_supports (\"e\"))\n+    riscv_set_rve (true);\n }\n \n /* Indicate -mabi option is explictly set.  */\n@@ -2945,16 +2953,6 @@ riscv_after_parse_args (void)\n \n   riscv_set_arch (default_arch_with_ext);\n \n-  /* Add the RVC extension, regardless of -march, to support .option rvc.  */\n-  riscv_set_rvc (false);\n-  if (riscv_subset_supports (\"c\"))\n-    riscv_set_rvc (true);\n-\n-  /* Enable RVE if specified by the -march option.  */\n-  riscv_set_rve (false);\n-  if (riscv_subset_supports (\"e\"))\n-    riscv_set_rve (true);\n-\n   /* If the CIE to be produced has not been overridden on the command line,\n      then produce version 3 by default.  This allows us to use the full\n      range of registers in a .cfi_return_column directive.  */"
    }
  ]
}