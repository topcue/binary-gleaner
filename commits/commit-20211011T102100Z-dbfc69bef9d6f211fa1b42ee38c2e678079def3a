{
  "sha": "dbfc69bef9d6f211fa1b42ee38c2e678079def3a",
  "node_id": "C_kwDOANOeidoAKGRiZmM2OWJlZjlkNmYyMTFmYTFiNDJlZTM4YzJlNjc4MDc5ZGVmM2E",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-10-11T10:21:00Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-10-11T10:21:00Z"
    },
    "message": "[gdb/testsuite] Handle readnow in ensure_gdb_index\n\nWhen running test-case gdb.base/with-mf.exp with target board readnow, I run\ninto:\n...\nFAIL: gdb.base/with-mf.exp: check if index present\n...\nThis is since commit 6010fb0c49e \"[gdb/testsuite] Fix full buffer in\ngdb.rust/dwindex.exp\".\n\nBefore that commit, the proc ensure_gdb_index would treat the line:\n...\n.gdb_index: faked for \"readnow\"^M\n...\nas proof that an index is already present (which is incorrect).\n\nNow, instead it generates aforementioned FAIL and continues to generate an\nindex.\n\nFix this by explicitly handling the readnow case in proc ensure_gdb_index,\nsuch that we bail out instead.\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "f8ec7de7681b3bf038dd23749e4208e41b8f7300",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f8ec7de7681b3bf038dd23749e4208e41b8f7300"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/dbfc69bef9d6f211fa1b42ee38c2e678079def3a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dbfc69bef9d6f211fa1b42ee38c2e678079def3a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/dbfc69bef9d6f211fa1b42ee38c2e678079def3a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dbfc69bef9d6f211fa1b42ee38c2e678079def3a/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "47265957ad9b1de1d6434baa0569d286d75eaf48",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/47265957ad9b1de1d6434baa0569d286d75eaf48",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/47265957ad9b1de1d6434baa0569d286d75eaf48"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 9,
    "deletions": 0
  },
  "files": [
    {
      "sha": "c2e6595f5942f2d84e2e7cbe0021f66f87c56147",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dbfc69bef9d6f211fa1b42ee38c2e678079def3a/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dbfc69bef9d6f211fa1b42ee38c2e678079def3a/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=dbfc69bef9d6f211fa1b42ee38c2e678079def3a",
      "patch": "@@ -7922,6 +7922,7 @@ proc ensure_gdb_index { binfile {style \"\"} } {\n     set testfile [file tail $binfile]\n     set test \"check if index present\"\n     set has_index 0\n+    set has_readnow 0\n     gdb_test_multiple \"mt print objfiles ${testfile}\" $test -lbl {\n \t-re \"\\r\\n\\\\.gdb_index: version ${decimal}(?=\\r\\n)\" {\n \t    set has_index 1\n@@ -7934,6 +7935,10 @@ proc ensure_gdb_index { binfile {style \"\"} } {\n \t-re \"\\r\\nPsymtabs:(?=\\r\\n)\" {\n \t    gdb_test_lines \"\" $gdb_test_name \".*\"\n \t}\n+\t-re \".gdb_index: faked for \\\"readnow\\\"\" {\n+\t    set has_readnow 1\n+\t    gdb_test_lines \"\" $gdb_test_name \".*\"\n+\t}\n \t-re -wrap \"\" {\n \t    fail $gdb_test_name\n \t}\n@@ -7943,6 +7948,10 @@ proc ensure_gdb_index { binfile {style \"\"} } {\n \treturn 0\n     }\n \n+    if { $has_readnow } {\n+\treturn -1\n+    }\n+\n     if { [add_gdb_index $binfile $style] == \"1\" } {\n \treturn 1\n     }"
    }
  ]
}