{
  "sha": "3f2e9699234ca31d083bc93ea6e03903f10baeaf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6M2YyZTk2OTkyMzRjYTMxZDA4M2JjOTNlYTZlMDM5MDNmMTBiYWVhZg==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-08-22T15:31:53Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-08-22T15:32:02Z"
    },
    "message": "elf: Keep only one '@' for undefined versioned symbols\n\nThe symbol string table in the .symtab section is optional and cosmetic.\nKeep only one '@' for undefined versioned symbols, which are defined in\nshared objects, in the symbol string table.  Update \"nm -D\" to display\nonly one '@' for undefined versioned symbols.\n\nbfd/\n\n\tPR ld/26382\n\t* elflink.c (elf_link_output_symstrtab): Keep only one '@' for\n\tversioned symbols, which are defined in shared objects, in\n\tsymbol string table.\n\nbinutils/\n\n\tPR ld/26382\n\t* nm.c (print_symname): Display only one '@' for undefined\n\tversioned symbols.\n\t* doc/binutils.texi: Update nm version information.\n\nld/\n\n\tPR ld/26382\n\t* testsuite/ld-elf/pr26302.nd: Updated.\n\t* testsuite/ld-elf/pr26302.rd: New file.\n\t* testsuite/ld-elf/shared.exp: Add a test for readelf -sW.",
    "tree": {
      "sha": "bfe2e473c96a1b7c9cc4e3f9ea8bb90d2d946521",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/bfe2e473c96a1b7c9cc4e3f9ea8bb90d2d946521"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3f2e9699234ca31d083bc93ea6e03903f10baeaf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3f2e9699234ca31d083bc93ea6e03903f10baeaf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3f2e9699234ca31d083bc93ea6e03903f10baeaf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3f2e9699234ca31d083bc93ea6e03903f10baeaf/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d19c3068ab17598662fe562e96bc1943b2b49736",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d19c3068ab17598662fe562e96bc1943b2b49736",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d19c3068ab17598662fe562e96bc1943b2b49736"
    }
  ],
  "stats": {
    "total": 73,
    "additions": 68,
    "deletions": 5
  },
  "files": [
    {
      "sha": "b3c1c6a70ef330356dc45b42beac5a9ac64a3113",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -1,3 +1,10 @@\n+2020-08-22  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/26382\n+\t* elflink.c (elf_link_output_symstrtab): Keep only one '@' for\n+\tversioned symbols, which are defined in shared objects, in\n+\tsymbol string table.\n+\n 2020-08-21  Nick Clifton  <nickc@redhat.com>\n \n \t* elfnn-aarch64.c (_bfd_aarch64_erratum_835769_scan): Only sort"
    },
    {
      "sha": "17a423270ec147f3044c79ed0206dd57543d2cd0",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 21,
      "deletions": 1,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -9642,9 +9642,29 @@ elf_link_output_symstrtab (struct elf_final_link_info *flinfo,\n     {\n       /* Call _bfd_elf_strtab_offset after _bfd_elf_strtab_finalize\n \t to get the final offset for st_name.  */\n+      char *versioned_name = (char *) name;\n+      if (h != NULL && h->versioned == versioned && h->def_dynamic)\n+\t{\n+\t  /* Keep only one '@' for versioned symbols defined in shared\n+\t     objects.  */\n+\t  char *version = strrchr (name, ELF_VER_CHR);\n+\t  char *base_end = strchr (name, ELF_VER_CHR);\n+\t  if (version != base_end)\n+\t    {\n+\t      size_t base_len;\n+\t      size_t len = strlen (name);\n+\t      versioned_name = bfd_alloc (flinfo->output_bfd, len);\n+\t      if (versioned_name == NULL)\n+\t\treturn 0;\n+\t      base_len = base_end - name;\n+\t      memcpy (versioned_name, name, base_len);\n+\t      memcpy (versioned_name + base_len, version,\n+\t\t      len - base_len);\n+\t    }\n+\t}\n       elfsym->st_name\n \t= (unsigned long) _bfd_elf_strtab_add (flinfo->symstrtab,\n-\t\t\t\t\t       name, FALSE);\n+\t\t\t\t\t       versioned_name, FALSE);\n       if (elfsym->st_name == (unsigned long) -1)\n \treturn 0;\n     }"
    },
    {
      "sha": "ef4b8cb3dc036a0840e70f9723ca7e5fbd05fe0d",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -1,3 +1,10 @@\n+2020-08-22  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/26382\n+\t* nm.c (print_symname): Display only one '@' for undefined\n+\tversioned symbols.\n+\t* doc/binutils.texi: Update nm version information.\n+\n 2020-08-21  Mark Wielaard  <mark@klomp.org>\n \n \t* testsuite/binutils-all/readelf.exp (readelf_wi_test): Also"
    },
    {
      "sha": "35a5a67041e387254a2ceee5812bacee7a7769fd",
      "filename": "binutils/doc/binutils.texi",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/binutils/doc/binutils.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/binutils/doc/binutils.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/doc/binutils.texi?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -924,7 +924,13 @@ The symbol type is unknown, or object file format specific.\n @end table\n \n @item\n-The symbol name.\n+The symbol name.  If a symbol has version information associated with it,\n+then the version information is displayed as well.  If the versioned\n+symbol is undefined or hidden from linker, the version string is displayed\n+as a suffix to the symbol name, preceded by an @@ character.  For example\n+@samp{foo@@VER_1}.  If the version is the default version to be used when\n+resolving unversioned references to the symbol, then it is displayed as a\n+suffix preceded by two @@ characters.  For example @samp{foo@@@@VER_2}.\n @end itemize\n \n @c man end"
    },
    {
      "sha": "3501f48d29eff43d0ef027c00dbaec05adcfed20",
      "filename": "binutils/nm.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/binutils/nm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/binutils/nm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/nm.c?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -421,7 +421,10 @@ print_symname (const char *form, struct extended_symbol_info *info,\n \t= bfd_get_symbol_version_string (abfd, &info->elfinfo->symbol,\n \t\t\t\t\t FALSE, &hidden);\n       if (version_string && version_string[0])\n-\tprintf (\"%s%s\", hidden ? \"@\" : \"@@\", version_string);\n+\tprintf (\"%s%s\",\n+\t       (hidden || bfd_is_und_section (info->elfinfo->symbol.section)\n+\t\t? \"@\" : \"@@\"),\n+\t       version_string);\n     }\n }\n "
    },
    {
      "sha": "4f57be86dedce20a61daa23681719f89e06a7c1f",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -1,3 +1,10 @@\n+2020-08-22  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/26382\n+\t* testsuite/ld-elf/pr26302.nd: Updated.\n+\t* testsuite/ld-elf/pr26302.rd: New file.\n+\t* testsuite/ld-elf/shared.exp: Add a test for readelf -sW.\n+\n 2020-08-20  Nick Clifton  <nickc@redhat.com>\n \n \tPR 26428"
    },
    {
      "sha": "bc9a675789a8b576c7a5d2d22ec162eae09890bc",
      "filename": "ld/testsuite/ld-elf/pr26302.nd",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/testsuite/ld-elf/pr26302.nd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/testsuite/ld-elf/pr26302.nd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr26302.nd?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -1,3 +1,3 @@\n #...\n- +U foo@@FOO\n+ +U foo@FOO\n #pass"
    },
    {
      "sha": "8f7b8a96e75f30058d177fd8b036ef8f4ad50f2c",
      "filename": "ld/testsuite/ld-elf/pr26302.rd",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/testsuite/ld-elf/pr26302.rd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/testsuite/ld-elf/pr26302.rd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr26302.rd?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -0,0 +1,12 @@\n+#...\n+Symbol table '\\.dynsym' contains [0-9]+ entries:\n+ +Num: +Value +Size Type +Bind +Vis +Ndx Name\n+#...\n+ +[0-9]+: +[a-f0-9]+ +0 +FUNC +GLOBAL +DEFAULT +UND +foo@FOO \\([0-9]+\\)\n+#...\n+\n+Symbol table '\\.symtab' contains [0-9]+ entries:\n+ +Num: +Value +Size Type +Bind +Vis +Ndx Name\n+#...\n+ +[0-9]+: +[a-f0-9]+ +0 +FUNC +GLOBAL +DEFAULT +UND +foo@FOO\n+#pass"
    },
    {
      "sha": "4de5b341834135dc8006c2be7809e66c0ecbaa0b",
      "filename": "ld/testsuite/ld-elf/shared.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/testsuite/ld-elf/shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3f2e9699234ca31d083bc93ea6e03903f10baeaf/ld/testsuite/ld-elf/shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/shared.exp?ref=3f2e9699234ca31d083bc93ea6e03903f10baeaf",
      "patch": "@@ -856,7 +856,8 @@ run_cc_link_tests [list \\\n \t\"-shared -Wl,--no-as-needed tmpdir/pr26302a.so\" \\\n \t\"-fPIC\" \\\n \t{pr26302b.c} \\\n-\t{{nm {-u} pr26302.nd} \\\n+\t{{readelf {-sW} pr26302.rd} \\\n+\t {nm {-u} pr26302.nd} \\\n \t {nm {-u -D} pr26302.nd} \\\n \t {nm {-u -D --with-symbol-versions} pr26302.nd}} \\\n \t\"pr26302b.so\" \\"
    }
  ]
}