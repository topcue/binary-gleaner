{
  "sha": "b3983e5f53caad175563f8c842f2ab2a1277c2bc",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjM5ODNlNWY1M2NhYWQxNzU1NjNmOGM4NDJmMmFiMmExMjc3YzJiYw==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-07-20T06:57:18Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-07-20T06:57:18Z"
    },
    "message": "x86: handle SVR4 escaped binary operators\n\nPR gas/4572\n\nWhen / is a comment character, its use as binary \"divide\" operator needs\nescaping by a backslash. Besides the scrubber needing to support this\n(addressed in an earlier change), there are also a few provisions needed\nin target specific operator handling.\n\nAs the spec calls for % and * to also be escaped because of being\n\"overloaded\", also recognize these, despite the overloading there not\nreally preventing their use as operators in most (%) or all (*) cases,\ngiven the way how the rest of the assembler works.\n\nTo bring source and testsuite in line, also drop the TE_I386AIX part of\nthe respective conditional, as i?86-*-aix* support had been removed a\nwhile ago.",
    "tree": {
      "sha": "6d5e3343f11a36633999b33996e210b4edd1650e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6d5e3343f11a36633999b33996e210b4edd1650e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b3983e5f53caad175563f8c842f2ab2a1277c2bc",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3983e5f53caad175563f8c842f2ab2a1277c2bc",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b3983e5f53caad175563f8c842f2ab2a1277c2bc",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3983e5f53caad175563f8c842f2ab2a1277c2bc/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "750e4bf70f2caab39dc5d0a1b2d26c9ca1fbd909",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/750e4bf70f2caab39dc5d0a1b2d26c9ca1fbd909",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/750e4bf70f2caab39dc5d0a1b2d26c9ca1fbd909"
    }
  ],
  "stats": {
    "total": 102,
    "additions": 95,
    "deletions": 7
  },
  "files": [
    {
      "sha": "2aed48f181d39b8133966a7a7bd29982d32d708d",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=b3983e5f53caad175563f8c842f2ab2a1277c2bc",
      "patch": "@@ -1,3 +1,15 @@\n+2020-07-20  Jan Beulich  <jbeulich@suse.com>\n+\n+\tPR gas/4572\n+\t* config/tc-i386.c (i386_comment_chars): Drop TE_I386AIX from\n+\tconditional around it.\n+\t(md_begin): Insert backslash into operand_chars[] when slash is\n+\ta comment character.\n+\t* config/tc-i386-intel.c (i386_operator): Recognize \\/, \\%, and\n+\t\\* as operators when / may be a comment character.\n+\t* testsuite/gas/i386/svr4.s, testsuite/gas/i386/svr4.d: New.\n+\t* testsuite/gas/i386/i386.exp: Run new test.\n+\n 2020-07-20  Jan Beulich  <jbeulich@suse.com>\n \n \tPR gas/4572"
    },
    {
      "sha": "a98771bfef17ce7bd4d7d29f07d79a9266c3fbb2",
      "filename": "gas/config/tc-i386-intel.c",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/config/tc-i386-intel.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/config/tc-i386-intel.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386-intel.c?ref=b3983e5f53caad175563f8c842f2ab2a1277c2bc",
      "patch": "@@ -123,6 +123,16 @@ operatorT i386_operator (const char *name, unsigned int operands, char *pc)\n {\n   unsigned int j;\n \n+#ifdef SVR4_COMMENT_CHARS\n+  if (!name && operands == 2 && *input_line_pointer == '\\\\')\n+    switch (input_line_pointer[1])\n+      {\n+      case '/': input_line_pointer += 2; return O_divide;\n+      case '%': input_line_pointer += 2; return O_modulus;\n+      case '*': input_line_pointer += 2; return O_multiply;\n+      }\n+#endif\n+\n   if (!intel_syntax)\n     return O_absent;\n "
    },
    {
      "sha": "9ab841383c5fad93dd1f31a6a042f2f5f18b911b",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 10,
      "deletions": 7,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=b3983e5f53caad175563f8c842f2ab2a1277c2bc",
      "patch": "@@ -480,13 +480,12 @@ const char extra_symbol_chars[] = \"*%-([{}\"\n #endif\n \t;\n \n-#if (defined (TE_I386AIX)\t\t\t\t\\\n-     || ((defined (OBJ_ELF) || defined (OBJ_MAYBE_ELF))\t\\\n-\t && !defined (TE_GNU)\t\t\t\t\\\n-\t && !defined (TE_LINUX)\t\t\t\t\\\n-\t && !defined (TE_FreeBSD)\t\t\t\\\n-\t && !defined (TE_DragonFly)\t\t\t\\\n-\t && !defined (TE_NetBSD)))\n+#if ((defined (OBJ_ELF) || defined (OBJ_MAYBE_ELF))\t\\\n+     && !defined (TE_GNU)\t\t\t\t\\\n+     && !defined (TE_LINUX)\t\t\t\t\\\n+     && !defined (TE_FreeBSD)\t\t\t\t\\\n+     && !defined (TE_DragonFly)\t\t\t\t\\\n+     && !defined (TE_NetBSD))\n /* This array holds the chars that always start a comment.  If the\n    pre-processor is disabled, these aren't very useful.  The option\n    --divide will remove '/' from this list.  */\n@@ -3116,6 +3115,10 @@ md_begin (void)\n \t    mnemonic_chars[c] = c;\n \t    operand_chars[c] = c;\n \t  }\n+#ifdef SVR4_COMMENT_CHARS\n+\telse if (c == '\\\\' && strchr (i386_comment_chars, '/'))\n+\t  operand_chars[c] = c;\n+#endif\n \n \tif (ISALPHA (c) || ISDIGIT (c))\n \t  identifier_chars[c] = c;"
    },
    {
      "sha": "a91ad798660cbb762d606bed66beb9ebc7ccf268",
      "filename": "gas/testsuite/gas/i386/i386.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/testsuite/gas/i386/i386.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/testsuite/gas/i386/i386.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/i386.exp?ref=b3983e5f53caad175563f8c842f2ab2a1277c2bc",
      "patch": "@@ -692,6 +692,14 @@ if [expr [istarget \"i*86-*-*\"] || [istarget \"x86_64-*-*\"]] then {\n \trun_dump_test \"dw2-compressed-1\"\n \trun_dump_test \"dw2-compressed-3a\"\n \trun_dump_test \"dw2-compressed-3b\"\n+\n+\tif {![istarget \"*-*-dragonfly*\"]\n+\t    && ![istarget \"*-*-gnu*\"]\n+\t    && ![istarget \"*-*-freebsd*\"]\n+\t    && ![istarget \"*-*-linux*\"]\n+\t    && ![istarget \"*-*-netbsd*\"]} then {\n+\t    run_dump_test \"svr4\"\n+\t}\n     }\n }\n "
    },
    {
      "sha": "3a4635419281b4db26ae70c92366e0c80ee52d08",
      "filename": "gas/testsuite/gas/i386/svr4.d",
      "status": "added",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/testsuite/gas/i386/svr4.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/testsuite/gas/i386/svr4.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/svr4.d?ref=b3983e5f53caad175563f8c842f2ab2a1277c2bc",
      "patch": "@@ -0,0 +1,24 @@\n+#objdump: -dtw\n+#name: SVR4 comment char escape handling\n+\n+.*: +file format .*\n+\n+SYMBOL TABLE:\n+0+00 .* \\.text[ \t]+0+ \\.text\n+0+00 .* \\.data[ \t]+0+ \\.data\n+0+00 .* \\.bss[ \t]+0+ \\.bss\n+0+00 .* \\.text[ \t]+0+ svr4\n+0+04 .* \\*ABS\\*[ \t]+0+ a\n+0+03 .* \\*ABS\\*[ \t]+0+ b\n+0+4c .* \\*ABS\\*[ \t]+0+ c\n+\n+Disassembly of section .text:\n+\n+0+0 <svr4>:\n+[\t ]*[0-9a-f]+:[\t ]+b0 07[\t ]+mov    \\$0x7,%al\n+[\t ]*[0-9a-f]+:[\t ]+b0 01[\t ]+mov    \\$0x1,%al\n+[\t ]*[0-9a-f]+:[\t ]+b0 1e[\t ]+mov    \\$0x1e,%al\n+[\t ]*[0-9a-f]+:[\t ]+b0 05[\t ]+mov    \\$0x5,%al\n+[\t ]*[0-9a-f]+:[\t ]+b0 02[\t ]+mov    \\$0x2,%al\n+[\t ]*[0-9a-f]+:[\t ]+b0 33[\t ]+mov    \\$0x33,%al\n+#pass"
    },
    {
      "sha": "4565e0134e9104a82068dcd668f2925568ac12e3",
      "filename": "gas/testsuite/gas/i386/svr4.s",
      "status": "added",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/testsuite/gas/i386/svr4.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3983e5f53caad175563f8c842f2ab2a1277c2bc/gas/testsuite/gas/i386/svr4.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/svr4.s?ref=b3983e5f53caad175563f8c842f2ab2a1277c2bc",
      "patch": "@@ -0,0 +1,31 @@\n+\t.text\n+\n+\t.if 1 / 2\n+\t.else\n+\t.error\n+\t.endif\n+\n+\t.if 1 \\/ 2\n+\t.error\n+\t.endif\n+\n+\t.if 4 \\% 2\n+\t.error\n+\t.endif\n+\n+\t.if 1 \\* 0\n+\t.error\n+\t.endif\n+\n+svr4:\n+\tmov\t$(15 \\/ 2), %al\n+\tmov\t$(15 \\% 2), %al\n+\tmov\t$(15 \\* 2), %al\n+\n+\t.byte\t0xb0, 17 \\/ 3\n+\t.byte\t0xb0, 17 \\% 3\n+\t.byte\t0xb0, 17 \\* 3\n+\n+\t.equiv\ta, 19 \\/ 4\n+\t.equiv\tb, 19 \\% 4\n+\t.equiv\tc, 19 \\* 4"
    }
  ]
}