{
  "sha": "b4951546078b869ce2f720561a2c59cfe2d005c9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjQ5NTE1NDYwNzhiODY5Y2UyZjcyMDU2MWEyYzU5Y2ZlMmQwMDVjOQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-05-15T05:47:58Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-05-15T05:52:25Z"
    },
    "message": "display_debug_ranges\n\n\t* dwarf.c (display_debug_ranges): Delete initial_length_size.\n\tCorrect fallback size calculated on finding a reloc.  Constrain\n\tdata reads to length given in header.  Avoid pointer UB.",
    "tree": {
      "sha": "1b8e499096386eaeb6d78b09a255a2f9f2966ba8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1b8e499096386eaeb6d78b09a255a2f9f2966ba8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b4951546078b869ce2f720561a2c59cfe2d005c9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4951546078b869ce2f720561a2c59cfe2d005c9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b4951546078b869ce2f720561a2c59cfe2d005c9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4951546078b869ce2f720561a2c59cfe2d005c9/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "669f463dbc700ab2694c960bb3e3f1083323f500",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/669f463dbc700ab2694c960bb3e3f1083323f500",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/669f463dbc700ab2694c960bb3e3f1083323f500"
    }
  ],
  "stats": {
    "total": 22,
    "additions": 12,
    "deletions": 10
  },
  "files": [
    {
      "sha": "9d646ed9870d08d087e3ca85e50ea2d2567316eb",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4951546078b869ce2f720561a2c59cfe2d005c9/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4951546078b869ce2f720561a2c59cfe2d005c9/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=b4951546078b869ce2f720561a2c59cfe2d005c9",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-15  Alan Modra  <amodra@gmail.com>\n+\n+\t* dwarf.c (display_debug_ranges): Delete initial_length_size.\n+\tCorrect fallback size calculated on finding a reloc.  Constrain\n+\tdata reads to length given in header.  Avoid pointer UB.\n+\n 2021-05-15  Alan Modra  <amodra@gmail.com>\n \n \t* dwarf.c (display_debug_rnglists_list): Avoid pointer UB."
    },
    {
      "sha": "9243c8530200949c4300519e1560d6a3ab70f785",
      "filename": "binutils/dwarf.c",
      "status": "modified",
      "additions": 6,
      "deletions": 10,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4951546078b869ce2f720561a2c59cfe2d005c9/binutils/dwarf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4951546078b869ce2f720561a2c59cfe2d005c9/binutils/dwarf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dwarf.c?ref=b4951546078b869ce2f720561a2c59cfe2d005c9",
      "patch": "@@ -7691,7 +7691,6 @@ display_debug_ranges (struct dwarf_section *section,\n   if (is_rnglists)\n     {\n       dwarf_vma initial_length;\n-      unsigned int initial_length_size;\n       unsigned char segment_selector_size;\n       unsigned int offset_size, offset_entry_count;\n       unsigned short version;\n@@ -7704,22 +7703,18 @@ display_debug_ranges (struct dwarf_section *section,\n \t  /* This section is 64-bit DWARF 3.  */\n \t  SAFE_BYTE_GET_AND_INC (initial_length, start, 8, finish);\n \t  offset_size = 8;\n-\t  initial_length_size = 12;\n \t}\n       else\n-\t{\n-\t  offset_size = 4;\n-\t  initial_length_size = 4;\n-\t}\n+\toffset_size = 4;\n \n-      if (initial_length + initial_length_size > section->size)\n+      if (initial_length > (size_t) (finish - start))\n \t{\n \t  /* If the length field has a relocation against it, then we should\n \t     not complain if it is inaccurate (and probably negative).\n \t     It is copied from .debug_line handling code.  */\n \t  if (reloc_at (section, (start - section->start) - offset_size))\n \t    {\n-\t      initial_length = (finish - start) - initial_length_size;\n+\t      initial_length = finish - start;\n \t    }\n \t  else\n \t    {\n@@ -7728,6 +7723,7 @@ display_debug_ranges (struct dwarf_section *section,\n \t      return 0;\n \t    }\n \t}\n+      finish = start + initial_length;\n \n       /* Get and check the version number.  */\n       SAFE_BYTE_GET_AND_INC (version, start, 2, finish);\n@@ -7833,7 +7829,6 @@ display_debug_ranges (struct dwarf_section *section,\n \n       pointer_size = (is_rnglists ? address_size : debug_info_p->pointer_size);\n       offset = range_entry->ranges_offset;\n-      next = section_begin + offset;\n       base_address = debug_info_p->base_address;\n \n       /* PR 17512: file: 001-101485-0.001:0.1.  */\n@@ -7844,12 +7839,13 @@ display_debug_ranges (struct dwarf_section *section,\n \t  continue;\n \t}\n \n-      if (next < section_begin || next >= finish)\n+      if (offset > (size_t) (finish - section_begin))\n \t{\n \t  warn (_(\"Corrupt offset (%#8.8lx) in range entry %u\\n\"),\n \t\t(unsigned long) offset, i);\n \t  continue;\n \t}\n+      next = section_begin + offset;\n \n       /* If multiple DWARF entities reference the same range then we will\n          have multiple entries in the `range_entries' list for the same"
    }
  ]
}