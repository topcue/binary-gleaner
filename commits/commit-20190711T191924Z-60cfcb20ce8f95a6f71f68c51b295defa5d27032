{
  "sha": "60cfcb20ce8f95a6f71f68c51b295defa5d27032",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjBjZmNiMjBjZThmOTVhNmY3MWY2OGM1MWIyOTVkZWZhNWQyNzAzMg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-11T14:39:55Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-11T19:19:24Z"
    },
    "message": "gdb: Add command completers for some info commands\n\nAdd command completion for info variables, functions, args, and\nlocals.  This completer only completes the command line options as\nthese commands all take a regexp which GDB can't really offer\ncompletions for.\n\ngdb/ChangeLog:\n\n\t* cli/cli-utils.c (info_print_command_completer): New function.\n\t* cli/cli-utils.h: Add 'completer.h' include, and forward\n\tdeclaration for 'struct cmd_list_element'.\n\t(info_print_command_completer): Declare.\n\t* stack.c (_initialize_stack): Add completer for 'info locals' and\n\t'info args'.\n\t* symtab.c (_initialize_symtab): Add completer for 'info\n\tvariables' and 'info functions'.\n\t* NEWS: Mention completion for additional info commands.",
    "tree": {
      "sha": "2037083f33150d7dc6e6d3be5ae62047d4c7d235",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2037083f33150d7dc6e6d3be5ae62047d4c7d235"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/60cfcb20ce8f95a6f71f68c51b295defa5d27032",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/60cfcb20ce8f95a6f71f68c51b295defa5d27032",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/60cfcb20ce8f95a6f71f68c51b295defa5d27032",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/60cfcb20ce8f95a6f71f68c51b295defa5d27032/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b16507e0917169555f8bbfcb1d6c9685813ccf6c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b16507e0917169555f8bbfcb1d6c9685813ccf6c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b16507e0917169555f8bbfcb1d6c9685813ccf6c"
    }
  ],
  "stats": {
    "total": 75,
    "additions": 64,
    "deletions": 11
  },
  "files": [
    {
      "sha": "90af6d38b57c8d7c60a58f4cd9e2580018666071",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=60cfcb20ce8f95a6f71f68c51b295defa5d27032",
      "patch": "@@ -1,3 +1,15 @@\n+2019-07-11  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* cli/cli-utils.c (info_print_command_completer): New function.\n+\t* cli/cli-utils.h: Add 'completer.h' include, and forward\n+\tdeclaration for 'struct cmd_list_element'.\n+\t(info_print_command_completer): Declare.\n+\t* stack.c (_initialize_stack): Add completer for 'info locals' and\n+\t'info args'.\n+\t* symtab.c (_initialize_symtab): Add completer for 'info\n+\tvariables' and 'info functions'.\n+\t* NEWS: Mention completion for additional info commands.\n+\n 2019-07-11  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* cli/cli-utils.c (extract_info_print_args): Delete."
    },
    {
      "sha": "4e479bf738bbff1e99e2fe0a35c56bd536fdc63d",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=60cfcb20ce8f95a6f71f68c51b295defa5d27032",
      "patch": "@@ -217,7 +217,9 @@ maint show test-options-completion-result\n      \"taas\" commands, and their \"-ascending\" option can now be\n      abbreviated.\n \n-  ** GDB can now complete the options of the \"info threads\" command.\n+  ** GDB can now complete the options of the \"info threads\", \"info\n+     functions\", \"info variables\", \"info locals\", and \"info args\"\n+     commands.\n \n   ** GDB can now complete the options of the \"compile file\" and\n      \"compile code\" commands.  The \"compile file\" command now"
    },
    {
      "sha": "c6405505d99141d77526564bfc61cb798d668373",
      "filename": "gdb/cli/cli-utils.c",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/cli/cli-utils.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/cli/cli-utils.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-utils.c?ref=60cfcb20ce8f95a6f71f68c51b295defa5d27032",
      "patch": "@@ -473,3 +473,20 @@ extract_info_print_options (info_print_options *opts,\n   if (*args != nullptr && **args == '\\0')\n     *args = nullptr;\n }\n+\n+/* See documentation in cli-utils.h.  */\n+\n+void\n+info_print_command_completer (struct cmd_list_element *ignore,\n+\t\t\t      completion_tracker &tracker,\n+\t\t\t      const char *text, const char * /* word */)\n+{\n+  const auto group\n+    = make_info_print_options_def_group (nullptr);\n+  if (gdb::option::complete_options\n+      (tracker, &text, gdb::option::PROCESS_OPTIONS_UNKNOWN_IS_OPERAND, group))\n+    return;\n+\n+  const char *word = advance_to_expression_complete_word_point (tracker, text);\n+  symbol_completer (ignore, tracker, text, word);\n+}"
    },
    {
      "sha": "17cdd842b2f0936e34f102d80ccd8b557b34fdf2",
      "filename": "gdb/cli/cli-utils.h",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/cli/cli-utils.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/cli/cli-utils.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-utils.h?ref=60cfcb20ce8f95a6f71f68c51b295defa5d27032",
      "patch": "@@ -20,6 +20,10 @@\n #ifndef CLI_CLI_UTILS_H\n #define CLI_CLI_UTILS_H\n \n+#include \"completer.h\"\n+\n+struct cmd_list_element;\n+\n /* *PP is a string denoting a number.  Get the number.  Advance *PP\n    after the string and any trailing whitespace.\n \n@@ -66,6 +70,15 @@ struct info_print_options\n extern void extract_info_print_options (info_print_options *opts,\n \t\t\t\t\tconst char **args);\n \n+/* Function that can be used as a command completer for 'info variable'\n+   and friends.  This offers command option completion as well as symbol\n+   completion.  At the moment all symbols are offered for all commands.  */\n+\n+extern void info_print_command_completer (struct cmd_list_element *ignore,\n+\t\t\t\t\t  completion_tracker &tracker,\n+\t\t\t\t\t  const char *text,\n+\t\t\t\t\t  const char * /* word */);\n+\n /* Throws an error telling the user that ARGS starts with an option\n    unrecognized by COMMAND.  */\n "
    },
    {
      "sha": "9b1d1a6856884f24282320d52d706ec173e8b2d3",
      "filename": "gdb/stack.c",
      "status": "modified",
      "additions": 6,
      "deletions": 4,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/stack.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/stack.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/stack.c?ref=60cfcb20ce8f95a6f71f68c51b295defa5d27032",
      "patch": "@@ -3423,18 +3423,20 @@ Print information about a stack frame selected by level.\\n\\\n Usage: info frame level LEVEL\"),\n \t   &info_frame_cmd_list);\n \n-  add_info (\"locals\", info_locals_command,\n-\t    info_print_args_help (_(\"\\\n+  cmd = add_info (\"locals\", info_locals_command,\n+\t\t  info_print_args_help (_(\"\\\n All local variables of current stack frame or those matching REGEXPs.\\n\\\n Usage: info locals [-q] [-t TYPEREGEXP] [NAMEREGEXP]\\n\\\n Prints the local variables of the current stack frame.\\n\"),\n \t\t\t\t  _(\"local variables\")));\n-  add_info (\"args\", info_args_command,\n-\t    info_print_args_help (_(\"\\\n+  set_cmd_completer_handle_brkchars (cmd, info_print_command_completer);\n+  cmd = add_info (\"args\", info_args_command,\n+\t\t  info_print_args_help (_(\"\\\n All argument variables of current stack frame or those matching REGEXPs.\\n\\\n Usage: info args [-q] [-t TYPEREGEXP] [NAMEREGEXP]\\n\\\n Prints the argument variables of the current stack frame.\\n\"),\n \t\t\t\t  _(\"argument variables\")));\n+  set_cmd_completer_handle_brkchars (cmd, info_print_command_completer);\n \n   if (dbx_commands)\n     add_com (\"func\", class_stack, func_command, _(\"\\"
    },
    {
      "sha": "41898992c190745519535a5f15cd2f14a7363a67",
      "filename": "gdb/symtab.c",
      "status": "modified",
      "additions": 13,
      "deletions": 6,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/60cfcb20ce8f95a6f71f68c51b295defa5d27032/gdb/symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.c?ref=60cfcb20ce8f95a6f71f68c51b295defa5d27032",
      "patch": "@@ -5997,28 +5997,35 @@ symbol_set_symtab (struct symbol *symbol, struct symtab *symtab)\n void\n _initialize_symtab (void)\n {\n+  cmd_list_element *c;\n+\n   initialize_ordinary_address_classes ();\n \n-  add_info (\"variables\", info_variables_command,\n-\t    info_print_args_help (_(\"\\\n+  c = add_info (\"variables\", info_variables_command,\n+\t\tinfo_print_args_help (_(\"\\\n All global and static variable names or those matching REGEXPs.\\n\\\n Usage: info variables [-q] [-t TYPEREGEXP] [NAMEREGEXP]\\n\\\n Prints the global and static variables.\\n\"),\n \t\t\t\t  _(\"global and static variables\")));\n+  set_cmd_completer_handle_brkchars (c, info_print_command_completer);\n   if (dbx_commands)\n-    add_com (\"whereis\", class_info, info_variables_command,\n-\t     info_print_args_help (_(\"\\\n+    {\n+      c = add_com (\"whereis\", class_info, info_variables_command,\n+\t\t   info_print_args_help (_(\"\\\n All global and static variable names, or those matching REGEXPs.\\n\\\n Usage: whereis [-q] [-t TYPEREGEXP] [NAMEREGEXP]\\n\\\n Prints the global and static variables.\\n\"),\n \t\t\t\t   _(\"global and static variables\")));\n+      set_cmd_completer_handle_brkchars (c, info_print_command_completer);\n+    }\n \n-  add_info (\"functions\", info_functions_command,\n-\t    info_print_args_help (_(\"\\\n+  c = add_info (\"functions\", info_functions_command,\n+\t\tinfo_print_args_help (_(\"\\\n All function names or those matching REGEXPs.\\n\\\n Usage: info functions [-q] [-t TYPEREGEXP] [NAMEREGEXP]\\n\\\n Prints the functions.\\n\"),\n \t\t\t\t  _(\"functions\")));\n+  set_cmd_completer_handle_brkchars (c, info_print_command_completer);\n \n   /* FIXME:  This command has at least the following problems:\n      1.  It prints builtin types (in a very strange and confusing fashion)."
    }
  ]
}