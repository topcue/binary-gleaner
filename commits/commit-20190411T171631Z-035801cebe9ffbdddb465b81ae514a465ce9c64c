{
  "sha": "035801cebe9ffbdddb465b81ae514a465ce9c64c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDM1ODAxY2ViZTlmZmJkZGRiNDY1YjgxYWU1MTRhNDY1Y2U5YzY0Yw==",
  "commit": {
    "author": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-04-02T20:17:16Z"
    },
    "committer": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-04-11T17:16:31Z"
    },
    "message": "ld: Add --no-print-map-discarded option\n\nAdd a new option to disable the listing of discarded sections\nin map file output.  The use case stems from a large application\nbuilt with -ffunction-sections --gc-sections where the list of\ndiscarded sections blows up the map file output.  The default\nbehaviour remains to print discarded sections,  but the new option\nallows us to disable it.\n\nld/\n\t* NEWS: Mention new option --no-print-map-discarded.\n\t* ld.h (ld_config_type) <print_map_discarded>: New field.\n\t* ldlang.c (lang_map): Conditionally output discarded sections\n\tin map files based on configuration option.\n\t* ldlex.h (option_values) <OPTION_PRINT_MAP_DISCARDED,\n\tOPTION_NO_PRINT_MAP_DISCARDED>: New.\n\t* ldmain.c (main): Enabled print_map_discarded by default.\n\t* lexsup.c (ld_options): Add new command-line options.\n\t(parse_args) <OPTION_NO_PRINT_MAP_DISCARDED,\n\tOPTION_PRINT_MAP_DISCARDED>: New cases.\n\t* ld.texi: Document new options.\n\t* testsuite/ld-gc/gc.exp: Add new test.\n\t* testsuite/ld-gc/skip-map-discarded.s: New file.\n\t* testsuite/ld-gc/skip-map-discarded.d: New file.\n\t* testsuite/ld-gc/skip-map-discarded.map: New file.",
    "tree": {
      "sha": "1bec295602b51ae66b0c83a96673726cb10c6d46",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1bec295602b51ae66b0c83a96673726cb10c6d46"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/035801cebe9ffbdddb465b81ae514a465ce9c64c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/035801cebe9ffbdddb465b81ae514a465ce9c64c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/035801cebe9ffbdddb465b81ae514a465ce9c64c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/035801cebe9ffbdddb465b81ae514a465ce9c64c/comments",
  "author": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c30391f893fd99e768c1a6282763ef553c45f1ff",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c30391f893fd99e768c1a6282763ef553c45f1ff",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c30391f893fd99e768c1a6282763ef553c45f1ff"
    }
  ],
  "stats": {
    "total": 88,
    "additions": 76,
    "deletions": 12
  },
  "files": [
    {
      "sha": "c8eda47e2f5d8c16984a0f79e0d6aa93b2880a6a",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -1,3 +1,21 @@\n+2019-04-11  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n+\n+\t* NEWS: Mention new option --no-print-map-discarded.\n+\t* ld.h (ld_config_type) <print_map_discarded>: New field.\n+\t* ldlang.c (lang_map): Conditionally output discarded sections\n+\tin map files based on configuration option.\n+\t* ldlex.h (option_values) <OPTION_PRINT_MAP_DISCARDED,\n+\tOPTION_NO_PRINT_MAP_DISCARDED>: New.\n+\t* ldmain.c (main): Enabled print_map_discarded by default.\n+\t* lexsup.c (ld_options): Add new command-line options.\n+\t(parse_args) <OPTION_NO_PRINT_MAP_DISCARDED,\n+\tOPTION_PRINT_MAP_DISCARDED>: New cases.\n+\t* ld.texi: Document new options.\n+\t* testsuite/ld-gc/gc.exp: Add new test.\n+\t* testsuite/ld-gc/skip-map-discarded.s: New file.\n+\t* testsuite/ld-gc/skip-map-discarded.d: New file.\n+\t* testsuite/ld-gc/skip-map-discarded.map: New file.\n+\n 2019-04-11  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* ld.texi: Document -z cet-report=[none|warning|error]."
    },
    {
      "sha": "de2cd16c4ef1bd725a15e447be766a441d598564",
      "filename": "ld/NEWS",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/NEWS?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -1,5 +1,7 @@\n -*- text -*-\n \n+* Add command-line option --no-print-map-discarded.\n+\n Changes in 2.33:\n \n * Add target handlers for AArch64 for ELF GNU program properties."
    },
    {
      "sha": "55078a9637b9ad09f18ef58ae44c6ff089ddb3f4",
      "filename": "ld/ld.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ld.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ld.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ld.h?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -318,6 +318,9 @@ typedef struct\n \n   /* The common page size for ELF.  */\n   bfd_vma commonpagesize;\n+\n+  /* If set, print discarded sections in map file output.  */\n+  bfd_boolean print_map_discarded;\n } ld_config_type;\n \n extern ld_config_type config;"
    },
    {
      "sha": "71c8d2599b83f73fe16d42b06a13f2833258fe55",
      "filename": "ld/ld.texi",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ld.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ld.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ld.texi?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -783,6 +783,14 @@ when merging properties in  @file{foo.o}, whose 0xc0010001 property value\n is 0x1, and @file{bar.o}, whose 0xc0010001 property value is 0x1.\n @end itemize\n \n+@cindex link map discarded\n+@kindex --print-map-discarded\n+@kindex --no-print-map-discarded\n+@item --print-map-discarded\n+@itemx --no-print-map-discarded\n+Print (or do not print) the list of discarded and garbage collected sections\n+in the link map.  Enabled by default.\n+\n @kindex -n\n @cindex read-only text\n @cindex NMAGIC"
    },
    {
      "sha": "898735efab59a0d3a0494d4a54efcee62c042153",
      "filename": "ld/ldlang.c",
      "status": "modified",
      "additions": 13,
      "deletions": 12,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ldlang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ldlang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.c?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -2251,19 +2251,20 @@ lang_map (void)\n \t  || file->flags.just_syms)\n \tcontinue;\n \n-      for (s = file->the_bfd->sections; s != NULL; s = s->next)\n-\tif ((s->output_section == NULL\n-\t     || s->output_section->owner != link_info.output_bfd)\n-\t    && (s->flags & (SEC_LINKER_CREATED | SEC_KEEP)) == 0)\n-\t  {\n-\t    if (!dis_header_printed)\n-\t      {\n-\t\tfprintf (config.map_file, _(\"\\nDiscarded input sections\\n\\n\"));\n-\t\tdis_header_printed = TRUE;\n-\t      }\n+      if (config.print_map_discarded)\n+\tfor (s = file->the_bfd->sections; s != NULL; s = s->next)\n+\t  if ((s->output_section == NULL\n+\t       || s->output_section->owner != link_info.output_bfd)\n+\t      && (s->flags & (SEC_LINKER_CREATED | SEC_KEEP)) == 0)\n+\t    {\n+\t      if (! dis_header_printed)\n+\t\t{\n+\t\t  fprintf (config.map_file, _(\"\\nDiscarded input sections\\n\\n\"));\n+\t\t  dis_header_printed = TRUE;\n+\t\t}\n \n-\t    print_input_section (s, TRUE);\n-\t  }\n+\t      print_input_section (s, TRUE);\n+\t    }\n     }\n \n   minfo (_(\"\\nMemory Configuration\\n\\n\"));"
    },
    {
      "sha": "32a7a6409e8e88e9b316636c4e6b435821e3ab9b",
      "filename": "ld/ldlex.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ldlex.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ldlex.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlex.h?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -148,6 +148,8 @@ enum option_values\n   OPTION_REQUIRE_DEFINED_SYMBOL,\n   OPTION_ORPHAN_HANDLING,\n   OPTION_FORCE_GROUP_ALLOCATION,\n+  OPTION_PRINT_MAP_DISCARDED,\n+  OPTION_NO_PRINT_MAP_DISCARDED,\n };\n \n /* The initial parser states.  */"
    },
    {
      "sha": "da1c6a7658f1c41fed33c98f314d8d996f2aab0d",
      "filename": "ld/ldmain.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ldmain.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/ldmain.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldmain.c?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -264,6 +264,7 @@ main (int argc, char **argv)\n   config.make_executable = TRUE;\n   config.magic_demand_paged = TRUE;\n   config.text_read_only = TRUE;\n+  config.print_map_discarded = TRUE;\n   link_info.disable_target_specific_optimizations = -1;\n \n   command_line.warn_mismatch = TRUE;"
    },
    {
      "sha": "dacb9623b404a766b8ac65e35eb538b999fa6446",
      "filename": "ld/lexsup.c",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/lexsup.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/lexsup.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/lexsup.c?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -543,6 +543,12 @@ static const struct ld_option ld_options[] =\n   { {\"orphan-handling\", required_argument, NULL, OPTION_ORPHAN_HANDLING},\n     '\\0', N_(\"=MODE\"), N_(\"Control how orphan sections are handled.\"),\n     TWO_DASHES },\n+  { {\"print-map-discarded\", no_argument, NULL, OPTION_PRINT_MAP_DISCARDED},\n+    '\\0', NULL, N_(\"Show discarded sections in map file output (default)\"),\n+    TWO_DASHES },\n+  { {\"no-print-map-discarded\", no_argument, NULL, OPTION_NO_PRINT_MAP_DISCARDED},\n+    '\\0', NULL, N_(\"Do not show discarded sections in map file output\"),\n+    TWO_DASHES },\n };\n \n #define OPTION_COUNT ARRAY_SIZE (ld_options)\n@@ -1577,6 +1583,14 @@ parse_args (unsigned argc, char **argv)\n \t    einfo (_(\"%F%P: invalid argument to option\"\n \t\t     \" \\\"--orphan-handling\\\"\\n\"));\n \t  break;\n+\n+\tcase OPTION_NO_PRINT_MAP_DISCARDED:\n+\t  config.print_map_discarded = FALSE;\n+\t  break;\n+\n+\tcase OPTION_PRINT_MAP_DISCARDED:\n+\t  config.print_map_discarded = TRUE;\n+\t  break;\n \t}\n     }\n "
    },
    {
      "sha": "13968cc7d1b47b8162e979eb8deb08f6d0e441d7",
      "filename": "ld/testsuite/ld-gc/gc.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/gc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/gc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/gc.exp?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -171,3 +171,5 @@ if { [is_elf_format] && [check_shared_lib_support] \\\n     ]\n     run_dump_test \"pr20306\"\n }\n+\n+run_dump_test \"skip-map-discarded\""
    },
    {
      "sha": "2e79f0be17e597db60e58235074255a143f3fae3",
      "filename": "ld/testsuite/ld-gc/skip-map-discarded.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/skip-map-discarded.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/skip-map-discarded.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/skip-map-discarded.d?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -0,0 +1,3 @@\n+#name: Check --no-print-map-discarded linker option\n+#ld: -e 0 --gc-sections --no-print-map-discarded\n+#map: skip-map-discarded.map"
    },
    {
      "sha": "ca4818e712650b7ed7831183f4431bd29f1ca96b",
      "filename": "ld/testsuite/ld-gc/skip-map-discarded.map",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/skip-map-discarded.map",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/skip-map-discarded.map",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/skip-map-discarded.map?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -0,0 +1,5 @@\n+#failif\n+Discarded input sections\n+#...\n+ _foo.*\n+#..."
    },
    {
      "sha": "630aab0d9ce074e973b30276dc3c7863c0a37e25",
      "filename": "ld/testsuite/ld-gc/skip-map-discarded.s",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/skip-map-discarded.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/035801cebe9ffbdddb465b81ae514a465ce9c64c/ld/testsuite/ld-gc/skip-map-discarded.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/skip-map-discarded.s?ref=035801cebe9ffbdddb465b81ae514a465ce9c64c",
      "patch": "@@ -0,0 +1,5 @@\n+.globl __start\n+__start:\n+\t.section\t_foo\n+foo:\n+\t.long\t1"
    }
  ]
}