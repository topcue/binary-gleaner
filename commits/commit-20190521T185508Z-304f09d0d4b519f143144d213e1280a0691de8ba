{
  "sha": "304f09d0d4b519f143144d213e1280a0691de8ba",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzA0ZjA5ZDBkNGI1MTlmMTQzMTQ0ZDIxM2UxMjgwYTA2OTFkZThiYQ==",
  "commit": {
    "author": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-05-18T08:19:03Z"
    },
    "committer": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-05-21T18:55:08Z"
    },
    "message": "MIPS/LD: Fix memory fault linking non-PIC object in to shared library\n\nbfd/\n\t* elfxx-mips.c (_bfd_mips_elf_check_relocs): Add NULL pointer\n\tchecks.  Search the RELA table for n64 relocations.\n\nld/\n\t* testsuite/ld-mips-elf/pic-reloc-5.d: New test.\n\t* testsuite/ld-mips-elf/pic-reloc-6.d: New test.\n\t* testsuite/ld-mips-elf/pic-reloc-7.d: New test.\n\t* testsuite/ld-mips-elf/pic-reloc-5.s: New test source.\n\t* testsuite/ld-mips-elf/pic-reloc-6.s: New test source.\n\t* testsuite/ld-mips-elf/pic-reloc-7.s: New test source.\n\t* testsuite/ld-mips-elf/mips-elf.exp: Run the new tests.",
    "tree": {
      "sha": "d5baa5160d5ed5001a91c77672f14a95ce5abde3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d5baa5160d5ed5001a91c77672f14a95ce5abde3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/304f09d0d4b519f143144d213e1280a0691de8ba",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/304f09d0d4b519f143144d213e1280a0691de8ba",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/304f09d0d4b519f143144d213e1280a0691de8ba",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/304f09d0d4b519f143144d213e1280a0691de8ba/comments",
  "author": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ba6cd17f0a28e54d9b4ef46397d448f1d208d9a0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ba6cd17f0a28e54d9b4ef46397d448f1d208d9a0",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ba6cd17f0a28e54d9b4ef46397d448f1d208d9a0"
    }
  ],
  "stats": {
    "total": 92,
    "additions": 84,
    "deletions": 8
  },
  "files": [
    {
      "sha": "4335227db6a7b84a2246f857249e46bf90aff66c",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -1,3 +1,8 @@\n+2019-05-21  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n+\n+\t* elfxx-mips.c (_bfd_mips_elf_check_relocs): Add NULL pointer\n+\tchecks.  Search the RELA table for n64 relocations.\n+\n 2019-05-21  Matthew Fortune  <matthew.fortune@mips.com>\n \t    Faraz Shahbazker  <fshahbazker@wavecomp.com>\n "
    },
    {
      "sha": "28e95bcc08a70d390b76be46b4d6714a57e8c05a",
      "filename": "bfd/elfxx-mips.c",
      "status": "modified",
      "additions": 11,
      "deletions": 8,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/bfd/elfxx-mips.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/bfd/elfxx-mips.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-mips.c?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -9115,7 +9115,7 @@ _bfd_mips_elf_check_relocs (bfd *abfd, struct bfd_link_info *info,\n \t\tbreak;\n \n \t      /* Likewise an absolute symbol.  */\n-\t      if (bfd_is_abs_symbol (&h->root))\n+\t      if (h != NULL && bfd_is_abs_symbol (&h->root))\n \t\tbreak;\n \n \t      /* R_MIPS_HI16 against _gp_disp is used for $gp setup,\n@@ -9133,13 +9133,16 @@ _bfd_mips_elf_check_relocs (bfd *abfd, struct bfd_link_info *info,\n \t    case R_MIPS16_26:\n \t    case R_MIPS_26:\n \t    case R_MICROMIPS_26_S1:\n-\t      howto = MIPS_ELF_RTYPE_TO_HOWTO (abfd, r_type, FALSE);\n-\t      info->callbacks->einfo\n-\t\t/* xgettext:c-format */\n-\t\t(_(\"%X%H: relocation %s against `%s' cannot be used\"\n-\t\t   \" when making a shared object; recompile with -fPIC\\n\"),\n-\t\t abfd, sec, rel->r_offset, howto->name,\n-\t\t (h) ? h->root.root.string : \"a local symbol\");\n+\t      howto = MIPS_ELF_RTYPE_TO_HOWTO (abfd, r_type, NEWABI_P (abfd));\n+\t      /* An error for unsupported relocations is raised as part\n+\t\t of the above search, so we can skip the following.  */\n+\t      if (howto != NULL)\n+\t\tinfo->callbacks->einfo\n+\t\t  /* xgettext:c-format */\n+\t\t  (_(\"%X%H: relocation %s against `%s' cannot be used\"\n+\t\t     \" when making a shared object; recompile with -fPIC\\n\"),\n+\t\t   abfd, sec, rel->r_offset, howto->name,\n+\t\t   (h) ? h->root.root.string : \"a local symbol\");\n \t      break;\n \t    default:\n \t      break;"
    },
    {
      "sha": "beba62e233da63151e932147477b2657a2a95966",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -1,3 +1,13 @@\n+2019-05-21  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n+\n+\t* testsuite/ld-mips-elf/pic-reloc-5.d: New test.\n+\t* testsuite/ld-mips-elf/pic-reloc-6.d: New test.\n+\t* testsuite/ld-mips-elf/pic-reloc-7.d: New test.\n+\t* testsuite/ld-mips-elf/pic-reloc-5.s: New test source.\n+\t* testsuite/ld-mips-elf/pic-reloc-6.s: New test source.\n+\t* testsuite/ld-mips-elf/pic-reloc-7.s: New test source.\n+\t* testsuite/ld-mips-elf/mips-elf.exp: Run the new tests.\n+\n 2019-05-21  Matthew Fortune  <matthew.fortune@mips.com>\n \t    Faraz Shahbazker  <fshahbazker@wavecomp.com>\n "
    },
    {
      "sha": "07d1dc3ecce19a7ace64f3dc6881162f4d515560",
      "filename": "ld/testsuite/ld-mips-elf/mips-elf.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/mips-elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/mips-elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/mips-elf.exp?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -1649,3 +1649,10 @@ run_dump_test \"pic-reloc-1\"\n run_dump_test \"pic-reloc-2\"\n run_dump_test \"pic-reloc-3\"\n run_dump_test \"pic-reloc-4\"\n+run_dump_test_o32 \"pic-reloc-5\"\n+run_dump_test_o32 \"pic-reloc-5\" [list [list name (microMIPS)] \\\n+\t\t\t\t      [list as \"-mmicromips\"]]\n+run_dump_test_o32 \"pic-reloc-6\"\n+run_dump_test_n64 \"pic-reloc-7\"\n+run_dump_test_n64 \"pic-reloc-7\" [list [list name (microMIPS)] \\\n+\t\t\t\t      [list as \"-mmicromips\"]]"
    },
    {
      "sha": "1b9d07ea6ee53e61507b12e16422ab681b0ed418",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-5.d",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-5.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-5.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-5.d?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -0,0 +1,6 @@\n+#name: MIPS PIC relocation 5\n+#ld: -shared -T pic-reloc-ordinary.ld\n+#target: [check_shared_lib_support]\n+#error: \\A[^\\n]*: in function `foo':\\n\n+#error:   \\(\\.text\\+0x0\\): relocation R_(MICRO|)MIPS_HI16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x8\\): relocation R_(MICRO|)MIPS_HI16 against `bar' cannot be used when making a shared object; recompile with -fPIC\\Z"
    },
    {
      "sha": "b8ebd8c2a216f009ea4f85d36e5395020f940fce",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-5.s",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-5.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-5.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-5.s?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -0,0 +1,10 @@\n+\t.text\n+\t.globl\tfoo\n+\t.ent\tfoo\n+foo:\n+$LCL:\n+\tlui\t$2, %hi($LCL)\n+\taddiu\t$2, %lo($LCL)\n+\tlui\t$2, %hi(bar)\n+\taddiu\t$2, %lo(bar)\n+\t.end\tfoo"
    },
    {
      "sha": "68be6873eabd29269ed80088cbbf7c612b456954",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-6.d",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-6.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-6.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-6.d?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -0,0 +1,7 @@\n+#name: MIPS PIC relocation 6 (MIPS16)\n+#ld: -shared -T pic-reloc-ordinary.ld\n+#target: [check_shared_lib_support]\n+#as: -mips16\n+#error: \\A[^\\n]*: in function `foo':\\n\n+#error:   \\(\\.text\\+0x0\\): relocation R_MIPS16_HI16 against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x8\\): relocation R_MIPS16_HI16 against `bar' cannot be used when making a shared object; recompile with -fPIC\\Z"
    },
    {
      "sha": "777ea260f10e0c77d2195f9e8546e75648b3bfb4",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-6.s",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-6.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-6.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-6.s?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -0,0 +1,10 @@\n+\t.text\n+\t.globl\tfoo\n+\t.ent\tfoo\n+foo:\n+$LCL:\n+\tli\t$2, %hi($LCL)\n+\taddiu\t$2, %lo($LCL)\n+\tli\t$2, %hi(bar)\n+\taddiu\t$2, %lo(bar)\n+\t.end\tfoo"
    },
    {
      "sha": "e5dfa58a47be316abcf56c153a94685e23132486",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-7.d",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-7.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-7.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-7.d?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -0,0 +1,8 @@\n+#name: MIPS PIC relocation 7\n+#ld: -shared -T pic-reloc-ordinary.ld\n+#target: [check_shared_lib_support]\n+#error: \\A[^\\n]*: in function `foo':\\n\n+#error:   \\(\\.text\\+0x0\\): relocation R_(MICRO|)MIPS_HIGHEST against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x4\\): relocation R_(MICRO|)MIPS_HIGHER against `a local symbol' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0x8\\): relocation R_(MICRO|)MIPS_HIGHEST against `bar' cannot be used when making a shared object; recompile with -fPIC\\n\n+#error:   \\(\\.text\\+0xc\\): relocation R_(MICRO|)MIPS_HIGHER against `bar' cannot be used when making a shared object; recompile with -fPIC\\Z"
    },
    {
      "sha": "3ad55f00129a982969923322f4952c8eccab3f98",
      "filename": "ld/testsuite/ld-mips-elf/pic-reloc-7.s",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-7.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/304f09d0d4b519f143144d213e1280a0691de8ba/ld/testsuite/ld-mips-elf/pic-reloc-7.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mips-elf/pic-reloc-7.s?ref=304f09d0d4b519f143144d213e1280a0691de8ba",
      "patch": "@@ -0,0 +1,10 @@\n+\t.text\n+\t.globl\tfoo\n+\t.ent\tfoo\n+foo:\n+$LCL:\n+\tlui\t$2, %highest($LCL)\n+\taddiu\t$2, %higher($LCL)\n+\tlui\t$2, %highest(bar)\n+\taddiu\t$2, %higher(bar)\n+\t.end\tfoo"
    }
  ]
}