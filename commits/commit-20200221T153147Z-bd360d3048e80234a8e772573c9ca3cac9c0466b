{
  "sha": "bd360d3048e80234a8e772573c9ca3cac9c0466b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmQzNjBkMzA0OGU4MDIzNGE4ZTc3MjU3M2M5Y2EzY2FjOWMwNDY2Yg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-02-19T14:06:45Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-02-21T15:31:47Z"
    },
    "message": "gdb/testsuite: Add test for case where gdb_demangle returns NULL\n\nThis adds a test for the commit:\n\n  commit 4f180d5396741eb65badba70cf5077b7d48f8641\n  Date:   Fri Feb 21 08:19:21 2020 -0700\n\n      Check for null result from gdb_demangle\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.dwarf2/cpp-linkage-name.c: New file.\n\t* gdb.dwarf2/cpp-linkage-name.exp: New file.",
    "tree": {
      "sha": "8adcea2484e65873e574bc44efe629b2748da94e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8adcea2484e65873e574bc44efe629b2748da94e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bd360d3048e80234a8e772573c9ca3cac9c0466b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bd360d3048e80234a8e772573c9ca3cac9c0466b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bd360d3048e80234a8e772573c9ca3cac9c0466b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bd360d3048e80234a8e772573c9ca3cac9c0466b/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4f180d5396741eb65badba70cf5077b7d48f8641",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4f180d5396741eb65badba70cf5077b7d48f8641",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4f180d5396741eb65badba70cf5077b7d48f8641"
    }
  ],
  "stats": {
    "total": 130,
    "additions": 130,
    "deletions": 0
  },
  "files": [
    {
      "sha": "6e9f94ff973e9a7871c38dfda9ee1ac68f9cdfde",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd360d3048e80234a8e772573c9ca3cac9c0466b/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd360d3048e80234a8e772573c9ca3cac9c0466b/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=bd360d3048e80234a8e772573c9ca3cac9c0466b",
      "patch": "@@ -1,3 +1,8 @@\n+2020-02-21  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.dwarf2/cpp-linkage-name.c: New file.\n+\t* gdb.dwarf2/cpp-linkage-name.exp: New file.\n+\n 2020-02-21  Shahab Vahedi  <shahab@synopsys.com>\n \n \t* lib/gdb.exp (gdb_wrapper_init): Reset"
    },
    {
      "sha": "c28dece9c383bf21e5702e7272e8acc67f61960e",
      "filename": "gdb/testsuite/gdb.dwarf2/cpp-linkage-name.c",
      "status": "added",
      "additions": 29,
      "deletions": 0,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd360d3048e80234a8e772573c9ca3cac9c0466b/gdb/testsuite/gdb.dwarf2/cpp-linkage-name.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd360d3048e80234a8e772573c9ca3cac9c0466b/gdb/testsuite/gdb.dwarf2/cpp-linkage-name.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/cpp-linkage-name.c?ref=bd360d3048e80234a8e772573c9ca3cac9c0466b",
      "patch": "@@ -0,0 +1,29 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+volatile struct\n+{\n+  int x;\n+  int y;\n+} global_var;\n+\n+int\n+main (void)\n+{\n+  asm (\"main_label: .globl main_label\");\n+  return global_var.x + global_var.y;\n+}"
    },
    {
      "sha": "414b43a7dd990370f1aea46e771ebb69df06048e",
      "filename": "gdb/testsuite/gdb.dwarf2/cpp-linkage-name.exp",
      "status": "added",
      "additions": 96,
      "deletions": 0,
      "changes": 96,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd360d3048e80234a8e772573c9ca3cac9c0466b/gdb/testsuite/gdb.dwarf2/cpp-linkage-name.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd360d3048e80234a8e772573c9ca3cac9c0466b/gdb/testsuite/gdb.dwarf2/cpp-linkage-name.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/cpp-linkage-name.exp?ref=bd360d3048e80234a8e772573c9ca3cac9c0466b",
      "patch": "@@ -0,0 +1,96 @@\n+# Copyright 2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# Some compilers give anonymous structures a linkage name, and that\n+# linkage name doesn't demangle (within GDB calling gdb_demangle\n+# return NULL).  At one point this caused GDB to crash due to\n+# dereferencing a NULL pointer.\n+\n+load_lib dwarf.exp\n+\n+# This test can only be run on targets which support DWARF-2 and use gas.\n+if {![dwarf2_support]} {\n+    return 0\n+}\n+\n+standard_testfile cpp-linkage-name.c cpp-linkage-name-debug.S\n+\n+# Set up the DWARF for the test.\n+set asm_file [standard_output_file $srcfile2]\n+Dwarf::assemble $asm_file {\n+    global srcdir subdir srcfile\n+\n+    lassign [function_range main ${srcdir}/${subdir}/${srcfile}] \\\n+\tmain_start main_length\n+\n+    cu {} {\n+\tDW_TAG_compile_unit {\n+\t    {DW_AT_language @DW_LANG_C_plus_plus}\n+\t    {DW_AT_name     ada-linkage-name.c}\n+\t    {DW_AT_comp_dir /tmp}\n+\n+\t} {\n+\t    declare_labels a_l b_l\n+\n+\t    a_l: DW_TAG_base_type {\n+\t\t{DW_AT_byte_size 4 DW_FORM_sdata}\n+\t\t{DW_AT_encoding  @DW_ATE_signed}\n+\t\t{DW_AT_name      int}\n+\t    }\n+\n+\t    # To expose the bug that existed at one point this\n+\t    # structure must have a linkage name, but no name, and the\n+\t    # linkage name is something that doesn't demangle.\n+\t    b_l: DW_TAG_structure_type {\n+\t\t{DW_AT_byte_size 8 DW_FORM_sdata}\n+\t\t{DW_AT_encoding  @DW_ATE_signed}\n+\t\t{DW_AT_linkage_name <anon>}\n+\t    } {\n+\t\tmember {\n+\t\t    {name x}\n+\t\t    {type :$a_l}\n+\t\t    {data_member_location 0 data1}\n+\t\t}\n+\t\tmember {\n+\t\t    {name y}\n+\t\t    {type :$a_l}\n+\t\t    {data_member_location 0 data1}\n+\t\t}\n+\t    }\n+\t    DW_TAG_subprogram {\n+\t\t{name \"main\"}\n+\t\t{low_pc $main_start addr}\n+\t\t{high_pc \"$main_start + $main_length\" addr}\n+\t\t{type :$a_l}\n+\t    }\n+\t    DW_TAG_variable {\n+\t\t{type :$b_l}\n+\t\t{external 1 flag}\n+\t\t{DW_AT_name global_var}\n+\t\t{DW_AT_location {\n+\t\t    DW_OP_addr [gdb_target_symbol global_var]\n+\t\t} SPECIAL_expr}\n+\t    }\n+\t}\n+    }\n+}\n+\n+if { [prepare_for_testing \"failed to prepare\" ${testfile} \\\n+\t  [list $srcfile $asm_file] {nodebug}] } {\n+    return -1\n+}\n+\n+gdb_assert [runto_main] \"run to main\"\n+gdb_test \"p global_var\" \" = {x = 0, y = 0}\""
    }
  ]
}