{
  "sha": "2ce40d1a5184271aa01675b55be8c04dfc320eee",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmNlNDBkMWE1MTg0MjcxYWEwMTY3NWI1NWJlOGMwNGRmYzMyMGVlZQ==",
  "commit": {
    "author": {
      "name": "Zebediah Figura",
      "email": "z.figura12@gmail.com",
      "date": "2021-01-13T10:55:46Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2021-01-13T10:55:46Z"
    },
    "message": "Add SEH support to code generated by dlltool.\n\n\tPR 27037\n\t* dlltool.c (i386_trampoline): Adjust %rsp immediately on entry\n\tand before exit.\n\t(i386_x64_trampoline): Add SEH annotations.\n\t(struct mac): Add how_seh field.\n\t(make_delay_head): If how_set field is true add SEh instructions.",
    "tree": {
      "sha": "a4c78ea77e06dcb8f1dc796fc43cf53a46a8cfdd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a4c78ea77e06dcb8f1dc796fc43cf53a46a8cfdd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2ce40d1a5184271aa01675b55be8c04dfc320eee",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2ce40d1a5184271aa01675b55be8c04dfc320eee",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2ce40d1a5184271aa01675b55be8c04dfc320eee",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2ce40d1a5184271aa01675b55be8c04dfc320eee/comments",
  "author": {
    "login": "zfigura",
    "id": 1936996,
    "node_id": "MDQ6VXNlcjE5MzY5OTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1936996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zfigura",
    "html_url": "https://github.com/zfigura",
    "followers_url": "https://api.github.com/users/zfigura/followers",
    "following_url": "https://api.github.com/users/zfigura/following{/other_user}",
    "gists_url": "https://api.github.com/users/zfigura/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zfigura/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zfigura/subscriptions",
    "organizations_url": "https://api.github.com/users/zfigura/orgs",
    "repos_url": "https://api.github.com/users/zfigura/repos",
    "events_url": "https://api.github.com/users/zfigura/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zfigura/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c54f3efdc2f85554a1604c68d5e9d0f55edfd330",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c54f3efdc2f85554a1604c68d5e9d0f55edfd330",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c54f3efdc2f85554a1604c68d5e9d0f55edfd330"
    }
  ],
  "stats": {
    "total": 59,
    "additions": 38,
    "deletions": 21
  },
  "files": [
    {
      "sha": "bff3c7051a06f7ac07fd56ecb9e657675a7404b3",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2ce40d1a5184271aa01675b55be8c04dfc320eee/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2ce40d1a5184271aa01675b55be8c04dfc320eee/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=2ce40d1a5184271aa01675b55be8c04dfc320eee",
      "patch": "@@ -1,3 +1,12 @@\n+2021-01-13  Zebediah Figura  <z.figura12@gmail.com>\n+\n+\tPR 27037\n+\t* dlltool.c (i386_trampoline): Adjust %rsp immediately on entry\n+\tand before exit.\n+\t(i386_x64_trampoline): Add SEH annotations.\n+\t(struct mac): Add how_seh field.\n+\t(make_delay_head): If how_set field is true add SEh instructions.\n+\n 2021-01-12  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR binutils/26792"
    },
    {
      "sha": "3d44a0b9630302ae9f60763267bd47f438083bf6",
      "filename": "binutils/dlltool.c",
      "status": "modified",
      "additions": 29,
      "deletions": 21,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2ce40d1a5184271aa01675b55be8c04dfc320eee/binutils/dlltool.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2ce40d1a5184271aa01675b55be8c04dfc320eee/binutils/dlltool.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dlltool.c?ref=2ce40d1a5184271aa01675b55be8c04dfc320eee",
      "patch": "@@ -570,19 +570,21 @@ static const char i386_trampoline[] =\n   \"\\tjmp *%%eax\\n\";\n \n static const char i386_x64_trampoline[] =\n-  \"\\tpushq %%rcx\\n\"\n-  \"\\tpushq %%rdx\\n\"\n-  \"\\tpushq %%r8\\n\"\n-  \"\\tpushq %%r9\\n\"\n-  \"\\tsubq  $40, %%rsp\\n\"\n+  \"\\tsubq $72, %%rsp\\n\"\n+  \"\\t.seh_stackalloc 72\\n\"\n+  \"\\t.seh_endprologue\\n\"\n+  \"\\tmovq %%rcx, 64(%%rsp)\\n\"\n+  \"\\tmovq %%rdx, 56(%%rsp)\\n\"\n+  \"\\tmovq %%r8, 48(%%rsp)\\n\"\n+  \"\\tmovq %%r9, 40(%%rsp)\\n\"\n   \"\\tmovq  %%rax, %%rdx\\n\"\n   \"\\tleaq  __DELAY_IMPORT_DESCRIPTOR_%s(%%rip), %%rcx\\n\"\n   \"\\tcall __delayLoadHelper2\\n\"\n-  \"\\taddq  $40, %%rsp\\n\"\n-  \"\\tpopq %%r9\\n\"\n-  \"\\tpopq %%r8\\n\"\n-  \"\\tpopq %%rdx\\n\"\n-  \"\\tpopq %%rcx\\n\"\n+  \"\\tmovq 40(%%rsp), %%r9\\n\"\n+  \"\\tmovq 48(%%rsp), %%r8\\n\"\n+  \"\\tmovq 56(%%rsp), %%rdx\\n\"\n+  \"\\tmovq 64(%%rsp), %%rcx\\n\"\n+  \"\\taddq $72, %%rsp\\n\"\n   \"\\tjmp *%%rax\\n\";\n \n struct mac\n@@ -609,6 +611,7 @@ struct mac\n   int how_dljtab_roff1; /* Offset for the ind 32 reloc into idata 5.  */\n   int how_dljtab_roff2; /* Offset for the ind 32 reloc into idata 5.  */\n   int how_dljtab_roff3; /* Offset for the ind 32 reloc into idata 5.  */\n+  bfd_boolean how_seh;\n   const char *trampoline;\n };\n \n@@ -622,7 +625,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"-mapcs-32\",\n     \"pe-arm-little\", bfd_arch_arm,\n     arm_jtab, sizeof (arm_jtab), 8,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -631,7 +634,7 @@ mtable[] =\n     \"jmp *\", \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"\",\n     \"pe-i386\",bfd_arch_i386,\n     i386_jtab, sizeof (i386_jtab), 2,\n-    i386_dljtab, sizeof (i386_dljtab), 2, 7, 12, i386_trampoline\n+    i386_dljtab, sizeof (i386_dljtab), 2, 7, 12, FALSE, i386_trampoline\n   }\n   ,\n   {\n@@ -641,7 +644,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"-mthumb-interwork\",\n     \"pe-arm-little\", bfd_arch_arm,\n     thumb_jtab, sizeof (thumb_jtab), 12,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n #define MARM_INTERWORK 3\n@@ -651,7 +654,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"-mthumb-interwork\",\n     \"pe-arm-little\", bfd_arch_arm,\n     arm_interwork_jtab, sizeof (arm_interwork_jtab), 12,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -661,7 +664,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"\",\n     \"pe-mcore-big\", bfd_arch_mcore,\n     mcore_be_jtab, sizeof (mcore_be_jtab), 8,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -671,7 +674,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"-EL\",\n     \"pe-mcore-little\", bfd_arch_mcore,\n     mcore_le_jtab, sizeof (mcore_le_jtab), 8,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -681,7 +684,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"\",\n     \"elf32-mcore-big\", bfd_arch_mcore,\n     mcore_be_jtab, sizeof (mcore_be_jtab), 8,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -691,7 +694,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"-EL\",\n     \"elf32-mcore-little\", bfd_arch_mcore,\n     mcore_le_jtab, sizeof (mcore_le_jtab), 8,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -701,7 +704,7 @@ mtable[] =\n     \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"-mapcs-32\",\n     \"pe-arm-wince-little\", bfd_arch_arm,\n     arm_jtab, sizeof (arm_jtab), 8,\n-    0, 0, 0, 0, 0, 0\n+    0, 0, 0, 0, 0, FALSE, 0\n   }\n   ,\n   {\n@@ -710,10 +713,10 @@ mtable[] =\n     \"jmp *\", \".global\", \".space\", \".align\\t2\",\".align\\t4\", \"\",\n     \"pe-x86-64\",bfd_arch_i386,\n     i386_jtab, sizeof (i386_jtab), 2,\n-    i386_x64_dljtab, sizeof (i386_x64_dljtab), 2, 9, 14, i386_x64_trampoline\n+    i386_x64_dljtab, sizeof (i386_x64_dljtab), 2, 9, 14, TRUE, i386_x64_trampoline\n   }\n   ,\n-  { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }\n+  { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }\n };\n \n typedef struct dlist\n@@ -947,6 +950,7 @@ asm_prefix (int mach, const char *name)\n #define HOW_JTAB_ROFF2\t\t(delay ? mtable[machine].how_dljtab_roff2 : 0)\n #define HOW_JTAB_ROFF3\t\t(delay ? mtable[machine].how_dljtab_roff3 : 0)\n #define ASM_SWITCHES\t\tmtable[machine].how_default_as_switches\n+#define HOW_SEH\t\t\tmtable[machine].how_seh\n \n static char **oav;\n \n@@ -2789,8 +2793,12 @@ make_delay_head (void)\n   fprintf (f, \"%s Import trampoline\\n\", ASM_C);\n   fprintf (f, \"\\t.section\\t.text\\n\");\n   fprintf(f,\"\\t%s\\t%s\\n\", ASM_GLOBAL, head_label);\n+  if (HOW_SEH)\n+    fprintf (f, \"\\t.seh_proc\\t%s\\n\", head_label);\n   fprintf (f, \"%s:\\n\", head_label);\n   fprintf (f, mtable[machine].trampoline, imp_name_lab);\n+  if (HOW_SEH)\n+    fprintf (f, \"\\t.seh_endproc\\n\");\n \n   /* Output the delay import descriptor */\n   fprintf (f, \"\\n%s DELAY_IMPORT_DESCRIPTOR\\n\", ASM_C);"
    }
  ]
}