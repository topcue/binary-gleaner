{
  "sha": "0df0352ad0b64e884977d8251cf1b88b6640600f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MGRmMDM1MmFkMGI2NGU4ODQ5NzdkODI1MWNmMWI4OGI2NjQwNjAwZg==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-09-29T21:58:21Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-09-29T21:58:21Z"
    },
    "message": "[gdb/contrib] cc-with-tweaks.sh: Create .dwz file in .tmp subdir\n\nWhen running a test-case gdb.base/foo.exp with cc-with-dwz-m, a file\nbuild/gdb/testsuite/outputs/gdb.base/foo/foo.dwz will be created, alongside\nexecutable build/gdb/testsuite/outputs/gdb.base/foo/foo.\n\nThis can cause problems in f.i. test-cases that test file name completion.\n\nMake these problems less likely by moving foo.dwz to a .tmp subdir:\nbuild/gdb/testsuite/outputs/gdb.base/foo/.tmp/foo.dwz.\n\nTested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2019-09-29  Tom de Vries  <tdevries@suse.de>\n\n\t* contrib/cc-with-tweaks.sh (get_tmpdir): New function.\n\tUse $tmpdir/$(basename \"$output_file\").dwz instead of\n\t\"${output_file}.dwz\".\n\ngdb/testsuite/ChangeLog:\n\n2019-09-29  Tom de Vries  <tdevries@suse.de>\n\n        * gdb.dwarf2/gdb-index.exp: Handle new location of .dwz file.",
    "tree": {
      "sha": "be678816da6274f8dc99685ca69ab9ee394d5f71",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/be678816da6274f8dc99685ca69ab9ee394d5f71"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0df0352ad0b64e884977d8251cf1b88b6640600f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0df0352ad0b64e884977d8251cf1b88b6640600f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0df0352ad0b64e884977d8251cf1b88b6640600f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0df0352ad0b64e884977d8251cf1b88b6640600f/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "73d9a918c6188ce0f1ec32e42dda063ca16e0362",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/73d9a918c6188ce0f1ec32e42dda063ca16e0362",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/73d9a918c6188ce0f1ec32e42dda063ca16e0362"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 26,
    "deletions": 6
  },
  "files": [
    {
      "sha": "077b74963233b2a2e5df7c246c1e2c89bfa9b287",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=0df0352ad0b64e884977d8251cf1b88b6640600f",
      "patch": "@@ -1,3 +1,9 @@\n+2019-09-29  Tom de Vries  <tdevries@suse.de>\n+\n+\t* contrib/cc-with-tweaks.sh (get_tmpdir): New function.\n+\tUse $tmpdir/$(basename \"$output_file\").dwz instead of\n+\t\"${output_file}.dwz\".\n+\n 2019-09-28  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \tPR gdb/25045"
    },
    {
      "sha": "98c4f89afc9be60f45b44045802a9b9589bc6ca0",
      "filename": "gdb/contrib/cc-with-tweaks.sh",
      "status": "modified",
      "additions": 12,
      "deletions": 4,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/contrib/cc-with-tweaks.sh",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/contrib/cc-with-tweaks.sh",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/contrib/cc-with-tweaks.sh?ref=0df0352ad0b64e884977d8251cf1b88b6640600f",
      "patch": "@@ -163,6 +163,12 @@ then\n     exit 1\n fi\n \n+get_tmpdir ()\n+{\n+    tmpdir=$(dirname \"$output_file\")/.tmp\n+    mkdir -p \"$tmpdir\"\n+}\n+\n if [ \"$want_objcopy_compress\" = true ]; then\n     $OBJCOPY --compress-debug-sections \"$output_file\"\n     rc=$?\n@@ -202,17 +208,19 @@ if [ \"$want_dwz\" = true ]; then\n \t;;\n     esac\n elif [ \"$want_multi\" = true ]; then\n+    get_tmpdir\n+    dwz_file=$tmpdir/$(basename \"$output_file\").dwz\n     # Remove the dwz output file if it exists, so we don't mistake it for a\n     # new file in case dwz fails.\n-    rm -f \"${output_file}.dwz\"\n+    rm -f \"$dwz_file\"\n \n     cp $output_file ${output_file}.alt\n-    $DWZ -m ${output_file}.dwz \"$output_file\" ${output_file}.alt > /dev/null\n+    $DWZ -m \"$dwz_file\" \"$output_file\" ${output_file}.alt > /dev/null\n     rm -f ${output_file}.alt\n \n     # Validate dwz's work by checking if the expected output file exists.\n-    if [ ! -f \"${output_file}.dwz\" ]; then\n-\techo \"$myname: dwz file ${output_file}.dwz missing.\"\n+    if [ ! -f \"$dwz_file\" ]; then\n+\techo \"$myname: dwz file $dwz_file missing.\"\n \texit 1\n     fi\n fi"
    },
    {
      "sha": "104303ffcafdbaab2acaa8b0e4b2ffb011813247",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=0df0352ad0b64e884977d8251cf1b88b6640600f",
      "patch": "@@ -1,3 +1,7 @@\n+2019-09-29  Tom de Vries  <tdevries@suse.de>\n+\n+        * gdb.dwarf2/gdb-index.exp: Handle new location of .dwz file.\n+\n 2019-09-29  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.dwarf2/gdb-index.exp: Use with_test_prefix for second objcopy."
    },
    {
      "sha": "1fe993accf8c3ba804a92e262a76b97a4a33ee0f",
      "filename": "gdb/testsuite/gdb.dwarf2/gdb-index.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/testsuite/gdb.dwarf2/gdb-index.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0df0352ad0b64e884977d8251cf1b88b6640600f/gdb/testsuite/gdb.dwarf2/gdb-index.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/gdb-index.exp?ref=0df0352ad0b64e884977d8251cf1b88b6640600f",
      "patch": "@@ -34,8 +34,10 @@ if { [prepare_for_testing \"failed to prepare\" \"${testfile}\" \\\n \n proc add_gdb_index { program } {\n     set index_file ${program}.gdb-index\n-    set dwz ${program}.dwz\n-    set dwz_index_file ${dwz}.gdb-index\n+    set dir [file dirname ${program}]\n+    set filename [file tail ${program}]\n+    set dwz $dir/.tmp/${filename}.dwz\n+    set dwz_index_file $program.dwz.gdb-index\n     verbose -log \"index_file: ${index_file}\"\n     remote_file host delete ${index_file}\n     remote_file host delete ${dwz_index_file}"
    }
  ]
}