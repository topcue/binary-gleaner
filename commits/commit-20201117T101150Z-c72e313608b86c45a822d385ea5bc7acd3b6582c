{
  "sha": "c72e313608b86c45a822d385ea5bc7acd3b6582c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzcyZTMxMzYwOGI4NmM0NWE4MjJkMzg1ZWE1YmM3YWNkM2I2NTgyYw==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-16T15:16:25Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-17T10:11:50Z"
    },
    "message": "gdb/testsuite: prevent timeout in gdb.gdb/unittest.exp\n\nWhen GDB is compiled with --enable-targets=all I would sometimes see\nthe 'maintenance selftest' in gdb.gdb/unittest.exp test timeout.\n\nThis one command causes GDB to run many separate self tests, this can\ntake some time.  The output of this command basically follows this\npattern:\n\n  (gdb) maintenance selftest\n  Running selftest aarch64-analyze-prologue.\n  Running selftest aarch64-process-record.\n  Running selftest arm-record.\n  Running selftest arm_analyze_prologue.\n  Running selftest array_view.\n  Running selftest child_path.\n  Running selftest cli_utils.\n  ..... snip lots more lines ....\n  Ran 79 unit tests, 0 failed\n\nCurrently the expect script waits for the final summary line (\"Ran 79\nunit test, 0 failed\") before declaring pass or fail.  The problem is\nthat if the summary line takes too long to appear the test will\ntimeout.\n\nAs this test makes use of gdb_test_multiple then all I've done is add\nan extra pattern that matches the 'Running selftest ....' lines and\nthen calls exp_continue.  Doing this means we find matches much more\nfrequently, and each time we do the timeout timer resets, preventing\nthe overall test from timing out.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.gdb/unittest.exp: Spot 'Running...' lines.",
    "tree": {
      "sha": "47f9f19ed6e142161045dbff125f61dca174ff83",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/47f9f19ed6e142161045dbff125f61dca174ff83"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c72e313608b86c45a822d385ea5bc7acd3b6582c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c72e313608b86c45a822d385ea5bc7acd3b6582c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c72e313608b86c45a822d385ea5bc7acd3b6582c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c72e313608b86c45a822d385ea5bc7acd3b6582c/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "037d7135de575c9e0c20e9158c105979bfee339c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/037d7135de575c9e0c20e9158c105979bfee339c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/037d7135de575c9e0c20e9158c105979bfee339c"
    }
  ],
  "stats": {
    "total": 11,
    "additions": 11,
    "deletions": 0
  },
  "files": [
    {
      "sha": "9c326d52431d49b6a53450a3d08c82facd98bd44",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c72e313608b86c45a822d385ea5bc7acd3b6582c/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c72e313608b86c45a822d385ea5bc7acd3b6582c/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=c72e313608b86c45a822d385ea5bc7acd3b6582c",
      "patch": "@@ -1,3 +1,7 @@\n+2020-11-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.gdb/unittest.exp: Spot 'Running...' lines.\n+\n 2020-11-17  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.base/completion.exp: Add new tests."
    },
    {
      "sha": "28a14520f4733966732df2749557cce16d904ad8",
      "filename": "gdb/testsuite/gdb.gdb/unittest.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c72e313608b86c45a822d385ea5bc7acd3b6582c/gdb/testsuite/gdb.gdb/unittest.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c72e313608b86c45a822d385ea5bc7acd3b6582c/gdb/testsuite/gdb.gdb/unittest.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.gdb/unittest.exp?ref=c72e313608b86c45a822d385ea5bc7acd3b6582c",
      "patch": "@@ -26,6 +26,13 @@ gdb_start\n \n set test \"maintenance selftest\"\n gdb_test_multiple $test $test {\n+  -re \".*Running selftest \\[^\\n\\r\\]+\\.\" {\n+\t# The selftests can take some time to complete.  To prevent\n+\t# timeout spot the 'Running ...' lines going past, so long as\n+\t# these are produced quickly enough then the overall test will\n+\t# not timeout.\n+\texp_continue\n+  }\n   -re \"Ran ($decimal) unit tests, 0 failed\\r\\n$gdb_prompt $\" {\n \tset num_ran $expect_out(1,string)\n \tgdb_assert \"$num_ran > 0\" $test"
    }
  ]
}