{
  "sha": "a7664973b24a242cd9ea17deb5eaf503065fc0bd",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTc2NjQ5NzNiMjRhMjQyY2Q5ZWExN2RlYjVlYWY1MDMwNjVmYzBiZA==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-04-26T08:41:35Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-04-26T08:41:35Z"
    },
    "message": "x86: correct overflow checking for 16-bit PC-relative relocs\n\nThe only insn requiring a truly 16-bit PC-relative relocation outside of\n16-bit mode is XBEGIN (with an operand size override). For it, the\nrelocation generated should behave similar to 8- and (for 64-bit) 32-bit\nPC-relatives ones, i.e. be checked for a signed value to fit the field.\nThis same mode is also correct for 16-bit code. Outside of 16-bit code,\nbranches with operand size overrides act in a truly PC-relative way only\nwhen living in the low 32k of address space, as they truncate rIP to 16\nbits. This can't be expressed by a PC-relative relocation.\n\nPutting in place a new testcase, I'd like to note that the two existing\nones (pcrel16 and pcrel16abs) appear to be pretty pointless: They don't\nexpect any error despite supposedly checking for overflow, and in fact\nthere can't possibly be any error for the\n- former since gas doesn't emit any relocation in the first place there,\n- latter because the way the relocation gets expressed by gas doesn't\n  allow the linker to notice the overflow; it should be detected by gas\n  if at all, but see above (an error would be reported here for x86-64\n  afaict, but this test doesn't get re-used there).",
    "tree": {
      "sha": "4022b58da916ab136085e8e19bbaf812e438a678",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4022b58da916ab136085e8e19bbaf812e438a678"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a7664973b24a242cd9ea17deb5eaf503065fc0bd",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7664973b24a242cd9ea17deb5eaf503065fc0bd",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a7664973b24a242cd9ea17deb5eaf503065fc0bd",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7664973b24a242cd9ea17deb5eaf503065fc0bd/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8fb8824599f37a726685197a1728e92bc7a953e5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8fb8824599f37a726685197a1728e92bc7a953e5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8fb8824599f37a726685197a1728e92bc7a953e5"
    }
  ],
  "stats": {
    "total": 42,
    "additions": 40,
    "deletions": 2
  },
  "files": [
    {
      "sha": "45397ef04b9a4f60ffee17ffb7af4102819db050",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -1,3 +1,10 @@\n+2021-04-26  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* elf32-i386.c (elf_howto_table): Switch R_386_PC16 to\n+\tcomplain_overflow_signed.\n+\t* elf64-x86-64.c (x86_64_elf_howto_table): Switch R_X86_64_PC16\n+\tto complain_overflow_signed.\n+\n 2021-04-23  Eric Botcazou  <ebotcazou@adacore.com>\n \n \t* elf.c (special_sections_p): Add .persistent.bss."
    },
    {
      "sha": "ffe764422fffc810c4c9c3665873a8b14ed20193",
      "filename": "bfd/elf32-i386.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/bfd/elf32-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/bfd/elf32-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-i386.c?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -93,7 +93,7 @@ static reloc_howto_type elf_howto_table[]=\n   HOWTO(R_386_16, 0, 1, 16, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_386_16\",\n \ttrue, 0xffff, 0xffff, false),\n-  HOWTO(R_386_PC16, 0, 1, 16, true, 0, complain_overflow_bitfield,\n+  HOWTO(R_386_PC16, 0, 1, 16, true, 0, complain_overflow_signed,\n \tbfd_elf_generic_reloc, \"R_386_PC16\",\n \ttrue, 0xffff, 0xffff, true),\n   HOWTO(R_386_8, 0, 0, 8, false, 0, complain_overflow_bitfield,"
    },
    {
      "sha": "840555c2000aadf63e428210a577c8db7c04e13d",
      "filename": "bfd/elf64-x86-64.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/bfd/elf64-x86-64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/bfd/elf64-x86-64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-x86-64.c?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -82,7 +82,7 @@ static reloc_howto_type x86_64_elf_howto_table[] =\n \tfalse),\n   HOWTO(R_X86_64_16, 0, 1, 16, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_X86_64_16\", false, 0xffff, 0xffff, false),\n-  HOWTO(R_X86_64_PC16,0, 1, 16, true, 0, complain_overflow_bitfield,\n+  HOWTO(R_X86_64_PC16, 0, 1, 16, true, 0, complain_overflow_signed,\n \tbfd_elf_generic_reloc, \"R_X86_64_PC16\", false, 0xffff, 0xffff, true),\n   HOWTO(R_X86_64_8, 0, 0, 8, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_X86_64_8\", false, 0xff, 0xff, false),"
    },
    {
      "sha": "9bb178e42485aeef2d80e17580f2daac57be6e22",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -1,3 +1,10 @@\n+2021-04-26  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* testsuite/ld-i386/pcrel16-2.s, testsuite/ld-i386/pcrel16-2.d,\n+\ttestsuite/ld-x86-64/pcrel16-2.d: New.\n+\t* testsuite/ld-i386/i386.exp: Run new test.\n+\t* testsuite/ld-x86-64/x86-64.exp: Likewise.\n+\n 2021-04-23  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27771"
    },
    {
      "sha": "d0b3f69fb8d2baa27931c690bcc930856e9fc394",
      "filename": "ld/testsuite/ld-i386/i386.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-i386/i386.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-i386/i386.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-i386/i386.exp?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -297,6 +297,7 @@ run_dump_test \"abs\"\n run_dump_test \"pcrel8\"\n run_dump_test \"pcrel16\"\n run_dump_test \"pcrel16abs\"\n+run_dump_test \"pcrel16-2\"\n run_dump_test \"alloc\"\n run_dump_test \"warn1\"\n run_dump_test \"tlsgd2\""
    },
    {
      "sha": "c1c340fc75cd5549c961ac2da822428a90b93594",
      "filename": "ld/testsuite/ld-i386/pcrel16-2.d",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-i386/pcrel16-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-i386/pcrel16-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-i386/pcrel16-2.d?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -0,0 +1,5 @@\n+#name: PCREL16 overflow (2)\n+#as: --32\n+#ld: -melf_i386\n+#error: .*relocation truncated to fit: R_386_PC16 .*t16.*\n+#error: .*relocation truncated to fit: R_386_PC16 .*_start.*"
    },
    {
      "sha": "2e974175ae81d85b99a7b1b4f80ac00d1b6eec0f",
      "filename": "ld/testsuite/ld-i386/pcrel16-2.s",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-i386/pcrel16-2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-i386/pcrel16-2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-i386/pcrel16-2.s?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -0,0 +1,12 @@\n+\t.text\n+\t.global _start\n+_start:\n+\tdata16 xbegin t16\n+\tret\n+\n+\t.fill 0x8000,1,0xcc\n+\n+\t.global t16\n+t16:\n+\tdata16 xbegin _start\n+\tret"
    },
    {
      "sha": "5346a5b619dd7d73bcbb4b797589ecaf245c6d69",
      "filename": "ld/testsuite/ld-x86-64/pcrel16-2.d",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-x86-64/pcrel16-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-x86-64/pcrel16-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pcrel16-2.d?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -0,0 +1,5 @@\n+#name: PCREL16 overflow (2)\n+#source: ../ld-i386/pcrel16-2.s\n+#ld:\n+#error: .*relocation truncated to fit: R_X86_64_PC16 .*t16.*\n+#error: .*relocation truncated to fit: R_X86_64_PC16 .*_start.*"
    },
    {
      "sha": "269f70d05b298a71133c558ce8f41409da9a5462",
      "filename": "ld/testsuite/ld-x86-64/x86-64.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-x86-64/x86-64.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7664973b24a242cd9ea17deb5eaf503065fc0bd/ld/testsuite/ld-x86-64/x86-64.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/x86-64.exp?ref=a7664973b24a242cd9ea17deb5eaf503065fc0bd",
      "patch": "@@ -261,6 +261,7 @@ run_dump_test \"abs-l1om\"\n run_dump_test \"apic\"\n run_dump_test \"pcrel8\"\n run_dump_test \"pcrel16\"\n+run_dump_test \"pcrel16-2\"\n run_dump_test \"tlsgd2\"\n run_dump_test \"tlsgd3\"\n run_dump_test \"tlsgd12\""
    }
  ]
}