{
  "sha": "31b4d3a16f200bf04db8439a63b72bba7af4e1be",
  "node_id": "C_kwDOANOeidoAKDMxYjRkM2ExNmYyMDBiZjA0ZGI4NDM5YTYzYjcyYmJhN2FmNGUxYmU",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2022-02-02T22:27:47Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2022-02-13T03:30:56Z"
    },
    "message": "PR28824, relro security issues, x86 keep COMMONPAGESIZE relro\n\nx86 treats MAXPAGESIZE as a memory optimisation parameter, actual\nhardware paging is always COMMPAGESIZE of 4k.  Use COMMONPAGESIZE for\nthe end of the relro segment alignment.\n\nThe previous patch regresses pr18176, increasing the testcase file\nsize from 322208 to 2099872 bytes.  Fixing this on x86 will require\nintroducing a gap after the end of the relro segment (of up to\nrelropagesize-1 bytes).\n\n\tPR 28824\n\tPR 18176\n\t* ld.h (ld_config_type): Add relro_use_commonpagesize field.\n\t* ldexp.c (fold_segment_align): Set relropagesize depending on\n\trelro_use_commonpagesize.\n\t* emultempl/elf-x86.em (elf_x86_create_output_section_statements):\n\tSet relro_use_commonpagesize.\n\t* testsuite/ld-x86-64/pr18176.d: xfail.",
    "tree": {
      "sha": "a422261355b8221ded5777ec889cc7054c99203f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a422261355b8221ded5777ec889cc7054c99203f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/31b4d3a16f200bf04db8439a63b72bba7af4e1be",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/31b4d3a16f200bf04db8439a63b72bba7af4e1be",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/31b4d3a16f200bf04db8439a63b72bba7af4e1be",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/31b4d3a16f200bf04db8439a63b72bba7af4e1be/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9833b7757d246f22db4eb24b8e5db7eb5e05b6d9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9833b7757d246f22db4eb24b8e5db7eb5e05b6d9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9833b7757d246f22db4eb24b8e5db7eb5e05b6d9"
    }
  ],
  "stats": {
    "total": 11,
    "additions": 10,
    "deletions": 1
  },
  "files": [
    {
      "sha": "134e4e1b61621ceb9eb55ef478a4d1affa51bcee",
      "filename": "ld/emultempl/elf-x86.em",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/emultempl/elf-x86.em",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/emultempl/elf-x86.em",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/emultempl/elf-x86.em?ref=31b4d3a16f200bf04db8439a63b72bba7af4e1be",
      "patch": "@@ -33,6 +33,7 @@ static struct elf_linker_x86_params params;\n static void\n elf_x86_create_output_section_statements (void)\n {\n+  config.relro_use_commonpagesize = true;\n   _bfd_elf_linker_x86_set_options (&link_info, &params);\n }\n "
    },
    {
      "sha": "c7e4ca3d334eafa76e23a499e5004df0a37c774b",
      "filename": "ld/ld.h",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/ld.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/ld.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ld.h?ref=31b4d3a16f200bf04db8439a63b72bba7af4e1be",
      "patch": "@@ -276,6 +276,10 @@ typedef struct\n   /* If set, code and non-code sections should never be in one segment.  */\n   bool separate_code;\n \n+  /* TRUE if the end of the relro segment should be aligned to\n+     COMMONPAGESIZE rather than MAXPAGESIZE.  */\n+  bool relro_use_commonpagesize;\n+\n   /* The rpath separation character.  Usually ':'.  */\n   char rpath_separator;\n "
    },
    {
      "sha": "ab724074732014ad3a07e4ae510f650d31f3cb5c",
      "filename": "ld/ldexp.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/ldexp.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/ldexp.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldexp.c?ref=31b4d3a16f200bf04db8439a63b72bba7af4e1be",
      "patch": "@@ -481,7 +481,10 @@ fold_segment_align (seg_align_type *seg, etree_value_type *lhs)\n \t      seg->base = expld.result.value;\n \t      seg->commonpagesize = commonpage;\n \t      seg->maxpagesize = maxpage;\n-\t      seg->relropagesize = maxpage;\n+\t      if (config.relro_use_commonpagesize)\n+\t\tseg->relropagesize = commonpage;\n+\t      else\n+\t\tseg->relropagesize = maxpage;\n \t      seg->relro_end = 0;\n \t    }\n \t  else"
    },
    {
      "sha": "728c15a3dd8bfe6da02da0742140d10ab4319881",
      "filename": "ld/testsuite/ld-x86-64/pr18176.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/testsuite/ld-x86-64/pr18176.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/31b4d3a16f200bf04db8439a63b72bba7af4e1be/ld/testsuite/ld-x86-64/pr18176.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr18176.d?ref=31b4d3a16f200bf04db8439a63b72bba7af4e1be",
      "patch": "@@ -3,6 +3,7 @@\n #ld: -melf_x86_64 -shared -z relro -T pr18176.t -z max-page-size=0x200000 -z common-page-size=0x1000 $NO_DT_RELR_LDFLAGS\n #readelf: -l --wide\n #target: x86_64-*-linux*\n+#xfail: *-*-*\n \n #...\n   GNU_RELRO      0x04bd17 0x000000000024bd17 0x000000000024bd17 0x0022e9 0x0022e9 R   0x1"
    }
  ]
}