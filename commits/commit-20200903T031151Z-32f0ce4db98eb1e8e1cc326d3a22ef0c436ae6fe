{
  "sha": "32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzJmMGNlNGRiOThlYjFlOGUxY2MzMjZkM2EyMmVmMGM0MzZhZTZmZQ==",
  "commit": {
    "author": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2020-08-18T09:48:34Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2020-09-03T03:11:51Z"
    },
    "message": "RISC-V: Report warnings rather than errors for the mis-matched ISA versions.\n\nSame as the privileged spec attributes check - different ISA versions\nshould be compatible, unless there are some known conflicts.  Therefore,\nwe should allow to link objects with different ISA versions, and update\nthe output ISA versions once the corresponding input ones are newer.\nBut it's better to also warn people that the conflicts may happen when\nthe ISA versions are mis-matched.\n\n\tbfd/\n\t* elfnn-riscv.c (riscv_version_mismatch): Change the return type\n\tfrom void to bfd_boolean.  Report warnings rather than errors\n\twhen the ISA versions are mis-matched.  Afterwards, remember to\n\tupdate the output ISA versions to the newest ones.\n\t(riscv_merge_std_ext): Allow to link objects with different\n\tstandard ISA versions.  Try to add output ISA versions to\n\tmerged_subsets first.\n\t(riscv_merge_multi_letter_ext): Likewise.  But for standard additional\n\tISA and non-standard ISA versions.\n\n\tld/\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d: Update the\n\tmessage from error to warning.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02.d: New testcases.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02a.s: Likewise.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02b.s: Likewise.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02c.s: Likewise.\n\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02d.s: Likewise.\n\t* testsuite/ld-riscv-elf/ld-riscv-elf.exp: Updated.",
    "tree": {
      "sha": "d20388d7924e00b1f98f0ddf41711e4c927768eb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d20388d7924e00b1f98f0ddf41711e4c927768eb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/72bd6912ea38224481f8bd0ed13b751e0fda4683",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/72bd6912ea38224481f8bd0ed13b751e0fda4683"
    }
  ],
  "stats": {
    "total": 134,
    "additions": 101,
    "deletions": 33
  },
  "files": [
    {
      "sha": "3bf4d2938895fad1c862104aca44da6cce2de90c",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -1,3 +1,15 @@\n+2020-09-03  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* elfnn-riscv.c (riscv_version_mismatch): Change the return type\n+\tfrom void to bfd_boolean.  Report warnings rather than errors\n+\twhen the ISA versions are mis-matched.  Afterwards, remember to\n+\tupdate the output ISA versions to the newest ones.\n+\t(riscv_merge_std_ext): Allow to link objects with different\n+\tstandard ISA versions.  Try to add output ISA versions to\n+\tmerged_subsets first.\n+\t(riscv_merge_multi_letter_ext): Likewise.  But for standard additional\n+\tISA and non-standard ISA versions.\n+\n 2020-09-03  Kito Cheng  <kito.cheng@sifive.com>\n \n \t* elfnn-riscv.c (riscv_merge_std_ext): Fix to report the correct"
    },
    {
      "sha": "83d4e63ceb4de344853987f7911fde163af666fa",
      "filename": "bfd/elfnn-riscv.c",
      "status": "modified",
      "additions": 39,
      "deletions": 32,
      "changes": 71,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/bfd/elfnn-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/bfd/elfnn-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-riscv.c?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -2618,19 +2618,42 @@ riscv_std_ext_p (const char *name)\n   return (strlen (name) == 1) && (name[0] != 'x') && (name[0] != 's');\n }\n \n-/* Error handler when version mis-match.  */\n+/* Check if the versions are compatible.  */\n \n-static void\n+static bfd_boolean\n riscv_version_mismatch (bfd *ibfd,\n \t\t\tstruct riscv_subset_t *in,\n \t\t\tstruct riscv_subset_t *out)\n {\n-  _bfd_error_handler\n-    (_(\"error: %pB: Mis-matched ISA version for '%s' extension. \"\n-       \"%d.%d vs %d.%d\"),\n-       ibfd, in->name,\n-       in->major_version, in->minor_version,\n-       out->major_version, out->minor_version);\n+  if (in == NULL || out == NULL)\n+    return TRUE;\n+\n+  /* Since there are no version conflicts for now, we just report\n+     warning when the versions are mis-matched.  */\n+  if (in->major_version != out->major_version\n+      || in->minor_version != out->minor_version)\n+    {\n+      _bfd_error_handler\n+\t(_(\"warning: %pB: mis-matched ISA version %d.%d for '%s' \"\n+\t   \"extension, the output version is %d.%d\"),\n+\t ibfd,\n+\t in->major_version,\n+\t in->minor_version,\n+\t in->name,\n+\t out->major_version,\n+\t out->minor_version);\n+\n+      /* Update the output ISA versions to the newest ones.  */\n+      if ((in->major_version > out->major_version)\n+\t  || (in->major_version == out->major_version\n+\t      && in->minor_version > out->minor_version))\n+\t{\n+\t  out->major_version = in->major_version;\n+\t  out->minor_version = in->minor_version;\n+\t}\n+    }\n+\n+  return TRUE;\n }\n \n /* Return true if subset is 'i' or 'e'.  */\n@@ -2692,16 +2715,11 @@ riscv_merge_std_ext (bfd *ibfd,\n \t ibfd, in->name, out->name);\n       return FALSE;\n     }\n-  else if ((in->major_version != out->major_version) ||\n-\t   (in->minor_version != out->minor_version))\n-    {\n-      /* TODO: Allow different merge policy.  */\n-      riscv_version_mismatch (ibfd, in, out);\n-      return FALSE;\n-    }\n+  else if (!riscv_version_mismatch (ibfd, in, out))\n+    return FALSE;\n   else\n     riscv_add_subset (&merged_subsets,\n-\t\t      in->name, in->major_version, in->minor_version);\n+\t\t      out->name, out->major_version, out->minor_version);\n \n   in = in->next;\n   out = out->next;\n@@ -2718,17 +2736,10 @@ riscv_merge_std_ext (bfd *ibfd,\n       if (find_in == NULL && find_out == NULL)\n \tcontinue;\n \n-      /* Check version is same or not.  */\n-      /* TODO: Allow different merge policy.  */\n-      if ((find_in != NULL && find_out != NULL)\n-\t  && ((find_in->major_version != find_out->major_version)\n-\t      || (find_in->minor_version != find_out->minor_version)))\n-\t{\n-\t  riscv_version_mismatch (ibfd, find_in, find_out);\n-\t  return FALSE;\n-\t}\n+      if (!riscv_version_mismatch (ibfd, find_in, find_out))\n+\treturn FALSE;\n \n-      struct riscv_subset_t *merged = find_in ? find_in : find_out;\n+      struct riscv_subset_t *merged = find_out ? find_out : find_in;\n       riscv_add_subset (&merged_subsets, merged->name,\n \t\t\tmerged->major_version, merged->minor_version);\n     }\n@@ -2812,12 +2823,8 @@ riscv_merge_multi_letter_ext (bfd *ibfd,\n       else\n \t{\n \t  /* Both present, check version and increment both.  */\n-\t  if ((in->major_version != out->major_version)\n-\t      || (in->minor_version != out->minor_version))\n-\t    {\n-\t      riscv_version_mismatch (ibfd, in, out);\n-\t      return FALSE;\n-\t    }\n+\t  if (!riscv_version_mismatch (ibfd, in, out))\n+\t    return FALSE;\n \n \t  riscv_add_subset (&merged_subsets, out->name, out->major_version,\n \t\t\t    out->minor_version);"
    },
    {
      "sha": "185f37b031fca950599e2a6512e2cd41020f6ffc",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -1,3 +1,14 @@\n+2020-09-03  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d: Update the\n+\tmessage from error to warning.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02.d: New testcases.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02a.s: Likewise.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02b.s: Likewise.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02c.s: Likewise.\n+\t* testsuite/ld-riscv-elf/attr-merge-arch-failed-02d.s: Likewise.\n+\t* testsuite/ld-riscv-elf/ld-riscv-elf.exp: Updated.\n+\n 2020-09-03  Kito Cheng  <kito.cheng@sifive.com>\n \n \t* testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d: Updated."
    },
    {
      "sha": "4b312388f72e5d8799b6f13e61c8e0b5dd9e3955",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-01.d?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -2,4 +2,10 @@\n #source: attr-merge-arch-failed-01b.s\n #as: -march-attr\n #ld: -r -melf32lriscv\n-#error: Mis-matched ISA version for 'a' extension. 3.0 vs 2.0\n+#warning: .*mis-matched ISA version 3.0 for 'a' extension, the output version is 2.0\n+#readelf: -A\n+\n+Attribute Section: riscv\n+File Attributes\n+  Tag_RISCV_arch: \".*a3p0.*\"\n+#.."
    },
    {
      "sha": "880ee1547379684814ef41debf6df8f6a67cf73a",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02.d",
      "status": "added",
      "additions": 27,
      "deletions": 0,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02.d?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -0,0 +1,27 @@\n+#source: attr-merge-arch-failed-02a.s\n+#source: attr-merge-arch-failed-02b.s\n+#source: attr-merge-arch-failed-02c.s\n+#source: attr-merge-arch-failed-02d.s\n+#as: -march-attr\n+#ld: -r -melf32lriscv\n+#warning: .*mis-matched ISA version 3.0 for 'i' extension, the output version is 2.0\n+#warning: .*mis-matched ISA version 3.0 for 'm' extension, the output version is 2.0\n+#warning: .*mis-matched ISA version 3.0 for 'a' extension, the output version is 2.0\n+#warning: .*mis-matched ISA version 3.0 for 'zicsr' extension, the output version is 2.0\n+#warning: .*mis-matched ISA version 3.0 for 'xunknown' extension, the output version is 2.0\n+#warning: .*mis-matched ISA version 2.1 for 'i' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 2.2 for 'm' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 2.3 for 'a' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 2.4 for 'zicsr' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 2.5 for 'xunknown' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 4.6 for 'i' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 4.7 for 'm' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 4.8 for 'a' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 4.9 for 'zicsr' extension, the output version is 3.0\n+#warning: .*mis-matched ISA version 4.0 for 'xunknown' extension, the output version is 3.0\n+#readelf: -A\n+\n+Attribute Section: riscv\n+File Attributes\n+  Tag_RISCV_arch: \"rv32i4p6_m4p7_a4p8_zicsr4p9_xunknown4p0\"\n+#.."
    },
    {
      "sha": "3dbf8a20d59286d69b82a5f44e6936eab516bc53",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02a.s",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02a.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02a.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02a.s?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -0,0 +1 @@\n+\t.attribute arch, \"rv32i2p0_m2p0_a2p0_zicsr2p0_xunknown2p0\""
    },
    {
      "sha": "7bbc39f425890f90a962557cbffb8fea05bcb0f2",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02b.s",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02b.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02b.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02b.s?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -0,0 +1 @@\n+\t.attribute arch, \"rv32i3p0_m3p0_a3p0_zicsr3p0_xunknown3p0\""
    },
    {
      "sha": "2a921e62dca5553dd3b38ba86c8880af51604688",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02c.s",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02c.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02c.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02c.s?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -0,0 +1 @@\n+\t.attribute arch, \"rv32i2p1_m2p2_a2p3_zicsr2p4_xunknown2p5\""
    },
    {
      "sha": "6ef5ee5851a987dae96c3b6756f7eae3b42fab39",
      "filename": "ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02d.s",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02d.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02d.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/attr-merge-arch-failed-02d.s?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -0,0 +1 @@\n+\t.attribute arch, \"rv32i4p6_m4p7_a4p8_zicsr4p9_xunknown4p0\""
    },
    {
      "sha": "2c008d4c35cdd3ed7041094652181358eddb9930",
      "filename": "ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe/ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp?ref=32f0ce4db98eb1e8e1cc326d3a22ef0c436ae6fe",
      "patch": "@@ -39,6 +39,7 @@ if [istarget \"riscv*-*-*\"] {\n     run_dump_test \"attr-merge-priv-spec-02\"\n     run_dump_test \"attr-merge-priv-spec-03\"\n     run_dump_test \"attr-merge-arch-failed-01\"\n+    run_dump_test \"attr-merge-arch-failed-02\"\n     run_dump_test \"attr-merge-stack-align-failed\"\n     run_dump_test \"attr-merge-priv-spec-failed-01\"\n     run_dump_test \"attr-merge-priv-spec-failed-02\""
    }
  ]
}