{
  "sha": "e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTUyYTBmMWJkOTQ5ZTFiNmI2YmNhZGMyODRjOGY4NDQ2NGQ0NmYyYw==",
  "commit": {
    "author": {
      "name": "Rainer Orth",
      "email": "ro@CeBiTec.Uni-Bielefeld.DE",
      "date": "2020-05-18T15:59:43Z"
    },
    "committer": {
      "name": "Rainer Orth",
      "email": "ro@CeBiTec.Uni-Bielefeld.DE",
      "date": "2020-05-18T15:59:43Z"
    },
    "message": "Avoid short i386 register names on Solaris/x86 [PR25981]\n\nThis is the 32-bit companion to\n\n\tRemove unused ps_lgetLDT etc. on Solaris/x86 [PR25981]\n        https://sourceware.org/pipermail/gdb-patches/2020-May/168713.html\n\nA 32-bit-default gdb fails to compile with the updated <sys/regset.h>.\nWhile it is also affected by the lack of a GS definition, which the\ncompantion patch above fixes, it also fails to compile i386-sol2-nat.c like\nthis\n\n/vol/src/gnu/gdb/hg/master/git/gdb/i386-sol2-nat.c:181:3: error: 'EAX' was not declared in this scope\n  181 |   EAX, ECX, EDX, EBX,\n      |   ^~~\n\nand several more.\n\nWhile this could be fixed by either including <ucontext.h> here or\nprovding fallback definitions of the register macros, I chose to do what\nthe 64-bit-default code in the same file\n(amd64_sol2_gregset32_reg_offset[]) does, namely just hardcode the\nnumeric values instead.  They are part of the ABI and thus guaranteed\nnot to change.\n\nWith this patch, a i386-pc-solaris2.11 configuration on master compiles\nagain, however, it doesn't work.  However, I could successfully test it\non the gdb-9 branch.\n\nCompiling and testing proved to be messy, unfortunately:\n\n* For one, Solaris <sys/procfs.h> and largefile support used to be\n  mutually exclusive (fixed in Solaris 11.4 and Illumos), which was\n  exacerbated by the fact that g++ predefines _FILE_OFFSET_BITS=64 since\n  GCC 9.1.0.  For now I've worked around this by adding\n  -U_FILE_OFFSET_BITS to CXXFLAGS and configuring with\n  --disable-largefile.  I hope to clean this up in a future patch.\n\n* gdb still defaults to startup-with-shell on.  However, /bin/bash is a\n  64-bit executable which cannot be debugged by a 32-bit gdb.  I hacked\n  around that part by pointing $SHELL at a 32-bit bash before running\n  make check.\n\n\tPR build/25981\n\t* i386-sol2-nat.c [PR_MODEL_NATIVE != PR_MODEL_LP64] (regmap):\n\tHardcode register numbers.",
    "tree": {
      "sha": "c4be1ff7be4c601cac38c4ba1adb594924ca0e31",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c4be1ff7be4c601cac38c4ba1adb594924ca0e31"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c/comments",
  "author": {
    "login": "rorth",
    "id": 3930951,
    "node_id": "MDQ6VXNlcjM5MzA5NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rorth",
    "html_url": "https://github.com/rorth",
    "followers_url": "https://api.github.com/users/rorth/followers",
    "following_url": "https://api.github.com/users/rorth/following{/other_user}",
    "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rorth/subscriptions",
    "organizations_url": "https://api.github.com/users/rorth/orgs",
    "repos_url": "https://api.github.com/users/rorth/repos",
    "events_url": "https://api.github.com/users/rorth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rorth/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "rorth",
    "id": 3930951,
    "node_id": "MDQ6VXNlcjM5MzA5NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3930951?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rorth",
    "html_url": "https://github.com/rorth",
    "followers_url": "https://api.github.com/users/rorth/followers",
    "following_url": "https://api.github.com/users/rorth/following{/other_user}",
    "gists_url": "https://api.github.com/users/rorth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rorth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rorth/subscriptions",
    "organizations_url": "https://api.github.com/users/rorth/orgs",
    "repos_url": "https://api.github.com/users/rorth/repos",
    "events_url": "https://api.github.com/users/rorth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rorth/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7f2043399809c0ba5c4819172214371ed820e8c6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7f2043399809c0ba5c4819172214371ed820e8c6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7f2043399809c0ba5c4819172214371ed820e8c6"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 20,
    "deletions": 4
  },
  "files": [
    {
      "sha": "cc13e41c6498f90ea5ae9a77caf6bb8f25e50303",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c",
      "patch": "@@ -1,5 +1,9 @@\n 2020-05-18  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n+\tPR build/25981\n+\t* i386-sol2-nat.c [PR_MODEL_NATIVE != PR_MODEL_LP64] (regmap):\n+\tHardcode register numbers.\n+\n \tPR build/25981\n \t* procfs.c [(__i386__ || __x86_64__) && sun] (proc_get_LDT_entry,\n \tprocfs_find_LDT_entry): Remove."
    },
    {
      "sha": "054d2ec81b6a5da9903107ff1bc756f37948b876",
      "filename": "gdb/i386-sol2-nat.c",
      "status": "modified",
      "additions": 16,
      "deletions": 4,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c/gdb/i386-sol2-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c/gdb/i386-sol2-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/i386-sol2-nat.c?ref=e52a0f1bd949e1b6b6bcadc284c8f84464d46f2c",
      "patch": "@@ -178,10 +178,22 @@ fill_fpregset (const struct regcache *regcache,\n    format and GDB's register array layout.  */\n static int regmap[] =\n {\n-  EAX, ECX, EDX, EBX,\n-  UESP, EBP, ESI, EDI,\n-  EIP, EFL, CS, SS,\n-  DS, ES, FS, GS\n+  11\t/* EAX */,\n+  10\t/* ECX */,\n+  9\t/* EDX */,\n+  8\t/* EBX */,\n+  17\t/* UESP */,\n+  6\t/* EBP */,\n+  5\t/* ESI */,\n+  4\t/* EDI */,\n+  14\t/* EIP */,\n+  16\t/* EFL */,\n+  15\t/* CS */,\n+  18\t/* SS */,\n+  3\t/* DS */,\n+  2\t/* ES */,\n+  1\t/* FS */,\n+  0\t/* GS */\n };\n \n /* Fill GDB's register array with the general-purpose register values"
    }
  ]
}