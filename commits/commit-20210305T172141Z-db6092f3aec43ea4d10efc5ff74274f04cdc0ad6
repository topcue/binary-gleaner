{
  "sha": "db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGI2MDkyZjNhZWM0M2VhNGQxMGVmYzVmZjc0Mjc0ZjA0Y2RjMGFkNg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-27T14:04:16Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-03-05T17:21:41Z"
    },
    "message": "bfd/binutils: add support for RISC-V CSRs in core files\n\nAdds support for including RISC-V control and status registers into\ncore files.\n\nThe value for the define NT_RISCV_CSR is set to 0x900, this\ncorresponds to a patch I have proposed for the Linux kernel here:\n\n  http://lists.infradead.org/pipermail/linux-riscv/2020-December/003910.html\n\nAs I have not yet heard if the above patch will be accepted into the\nkernel or not I have set the note name string to \"GDB\", and the note\ntype to NT_RISCV_CSR.\n\nThis means that if the above patch is rejected from the kernel, and\nthe note type number 0x900 is assigned to some other note type, we\nwill still be able to distinguish between the GDB produced\nNT_RISCV_CSR, and the kernel produced notes, where the name would be\nset to \"CORE\".\n\nbfd/ChangeLog:\n\n\t* elf-bfd.h (elfcore_write_riscv_csr): Declare.\n\t* elf.c (elfcore_grok_riscv_csr): New function.\n\t(elfcore_grok_note): Handle NT_RISCV_CSR.\n\t(elfcore_write_riscv_csr): New function.\n\t(elfcore_write_register_note): Handle '.reg-riscv-csr'.\n\nbinutils/ChangeLog:\n\n\t* readelf.c (get_note_type): Handle NT_RISCV_CSR.\n\ninclude/ChangeLog:\n\n\t* elf/common.h (NT_RISCV_CSR): Define.",
    "tree": {
      "sha": "f50ff118e61587a56f804b39683c114886f0b11a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f50ff118e61587a56f804b39683c114886f0b11a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "fb8f3fc0c3c4d04856547fddb86d7c9dabef681b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fb8f3fc0c3c4d04856547fddb86d7c9dabef681b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/fb8f3fc0c3c4d04856547fddb86d7c9dabef681b"
    }
  ],
  "stats": {
    "total": 60,
    "additions": 60,
    "deletions": 0
  },
  "files": [
    {
      "sha": "dac602b907616cad8181e2cf1bd5c96191564606",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -1,3 +1,12 @@\n+2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* elf-bfd.h (elfcore_write_riscv_csr): Declare.\n+\t* elf.c (elfcore_grok_riscv_csr): New function.\n+\t(elfcore_grok_note): Handle NT_RISCV_CSR.\n+\t(elfcore_write_riscv_csr): New function.\n+\t(elfcore_write_register_note): Handle '.reg-riscv-csr'.\n+\n 2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n \t    Andrew Burgess  <andrew.burgess@embecosm.com>\n "
    },
    {
      "sha": "c40030bdca639ef63c3215644d71da535da942f1",
      "filename": "bfd/elf-bfd.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/bfd/elf-bfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/bfd/elf-bfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf-bfd.h?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -2798,6 +2798,8 @@ extern char *elfcore_write_aarch_pauth\n   (bfd *, char *, int *, const void *, int);\n extern char *elfcore_write_arc_v2\n   (bfd *, char *, int *, const void *, int);\n+extern char *elfcore_write_riscv_csr\n+  (bfd *, char *, int *, const void *, int);\n extern char *elfcore_write_gdb_tdesc\n   (bfd *, char *, int *, const void *, int);\n extern char *elfcore_write_lwpstatus"
    },
    {
      "sha": "553fa65a1184118f706bf35682ef10f01a06c2d9",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 35,
      "deletions": 0,
      "changes": 35,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -9912,6 +9912,15 @@ elfcore_grok_arc_v2 (bfd *abfd, Elf_Internal_Note *note)\n   return elfcore_make_note_pseudosection (abfd, \".reg-arc-v2\", note);\n }\n \n+/* Convert NOTE into a bfd_section called \".reg-riscv-csr\".  Return TRUE if\n+   successful otherwise, return FALSE.  */\n+\n+static bfd_boolean\n+elfcore_grok_riscv_csr (bfd *abfd, Elf_Internal_Note *note)\n+{\n+  return elfcore_make_note_pseudosection (abfd, \".reg-riscv-csr\", note);\n+}\n+\n /* Convert NOTE into a bfd_section called \".gdb-tdesc\".  Return TRUE if\n    successful otherwise, return FALSE.  */\n \n@@ -10586,6 +10595,13 @@ elfcore_grok_note (bfd *abfd, Elf_Internal_Note *note)\n       else\n         return TRUE;\n \n+    case NT_RISCV_CSR:\n+      if (note->namesz == 4\n+          && strcmp (note->namedata, \"GDB\") == 0)\n+        return elfcore_grok_riscv_csr (abfd, note);\n+      else\n+\treturn TRUE;\n+\n     case NT_PRPSINFO:\n     case NT_PSINFO:\n       if (bed->elf_backend_grok_psinfo)\n@@ -11967,6 +11983,23 @@ elfcore_write_arc_v2 (bfd *abfd,\n \t\t\t     note_name, NT_ARC_V2, arc_v2, size);\n }\n \n+/* Write the buffer of csr values in CSRS (length SIZE) into the note\n+   buffer BUF and update *BUFSIZ.  ABFD is the bfd the note is being\n+   written into.  Return a pointer to the new start of the note buffer, to\n+   replace BUF which may no longer be valid.  */\n+\n+char *\n+elfcore_write_riscv_csr (bfd *abfd,\n+                         char *buf,\n+                         int *bufsiz,\n+                         const void *csrs,\n+                         int size)\n+{\n+  const char *note_name = \"GDB\";\n+  return elfcore_write_note (abfd, buf, bufsiz,\n+\t\t\t     note_name, NT_RISCV_CSR, csrs, size);\n+}\n+\n /* Write the target description (a string) pointed to by TDESC, length\n    SIZE, into the note buffer BUF, and update *BUFSIZ.  ABFD is the bfd the\n    note is being written into.  Return a pointer to the new start of the\n@@ -12070,6 +12103,8 @@ elfcore_write_register_note (bfd *abfd,\n     return elfcore_write_arc_v2 (abfd, buf, bufsiz, data, size);\n   if (strcmp (section, \".gdb-tdesc\") == 0)\n     return elfcore_write_gdb_tdesc (abfd, buf, bufsiz, data, size);\n+  if (strcmp (section, \".reg-riscv-csr\") == 0)\n+    return elfcore_write_riscv_csr (abfd, buf, bufsiz, data, size);\n   return NULL;\n }\n "
    },
    {
      "sha": "b5a9b56954cd59da49e9e6495c44c47182b6483e",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* readelf.c (get_note_type): Handle NT_RISCV_CSR.\n+\n 2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n \t    Andrew Burgess  <andrew.burgess@embecosm.com>\n "
    },
    {
      "sha": "1994eebd91065c83f6601c023ccacf8d177cca27",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -18577,6 +18577,8 @@ get_note_type (Filedata * filedata, unsigned e_type)\n \treturn _(\"NT_ARM_HW_WATCH (AArch hardware watchpoint registers)\");\n       case NT_ARC_V2:\n \treturn _(\"NT_ARC_V2 (ARC HS accumulator/extra registers)\");\n+      case NT_RISCV_CSR:\n+\treturn _(\"NT_RISCV_CSR (RISC-V control and status registers)\");\n       case NT_PSTATUS:\n \treturn _(\"NT_PSTATUS (pstatus structure)\");\n       case NT_FPREGS:"
    },
    {
      "sha": "0a6e4b6f535277cd4cca0298814962a876130f60",
      "filename": "include/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/include/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/include/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/ChangeLog?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* elf/common.h (NT_RISCV_CSR): Define.\n+\n 2021-03-05  Craig Blackmore  <craig.blackmore@embecosm.com>\n \t    Andrew Burgess  <andrew.burgess@embecosm.com>\n "
    },
    {
      "sha": "4cb3748e4fd6bb398987ac24525ef57ecd3f6858",
      "filename": "include/elf/common.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/include/elf/common.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db6092f3aec43ea4d10efc5ff74274f04cdc0ad6/include/elf/common.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/elf/common.h?ref=db6092f3aec43ea4d10efc5ff74274f04cdc0ad6",
      "patch": "@@ -674,6 +674,8 @@\n \t\t\t\t\t/*   note name must be \"LINUX\".  */\n #define NT_ARC_V2\t0x600\t\t/* ARC HS accumulator/extra registers.  */\n \t\t\t\t\t/*   note name must be \"LINUX\".  */\n+#define NT_RISCV_CSR    0x900\t\t/* RISC-V Control and Status Registers */\n+\t\t\t\t\t/*   note name must be \"CORE\".  */\n #define NT_SIGINFO\t0x53494749\t/* Fields of siginfo_t.  */\n #define NT_FILE\t\t0x46494c45\t/* Description of mapped files.  */\n "
    }
  ]
}