{
  "sha": "d806ea2d0ef362fcddd2c1659f537b68aa114203",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDgwNmVhMmQwZWYzNjJmY2RkZDJjMTY1OWY1MzdiNjhhYTExNDIwMw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-06-24T22:02:47Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-08-19T16:17:27Z"
    },
    "message": "Add Rust support to source highlighting\n\nCurrently, no release of GNU Source Highlight supports Rust.  However,\nI've checked in a patch to do so there, and I plan to make a new\nrelease sometime this summer.\n\nThis patch prepares gdb for that by adding support for Rust to the\nsource highlighting code.\n\nBecause Source Highlight will throw an exception if the language is\nunrecognized, this also changes gdb to ignore exceptions here.  This\nwill cause gdb to fall back to un-highlighted source text.\n\nThis updates gdb's configure script to reject the combination of\nSource Highlight and -static-libstdc++.  This is done because it's not\npossible to use -static-libstdc++ and then catch exceptions from a\nshared library.\n\nTested with the current and development versions of Source Highlight.\n\ngdb/ChangeLog\n2019-08-19  Tom Tromey  <tom@tromey.com>\n\n\t* configure: Rebuild.\n\t* configure.ac: Disallow the combination of -static-libstdc++ and\n\tsource highlight.\n\t* source-cache.c (get_language_name): Handle rust.\n\t(source_cache::get_source_lines): Ignore highlighting exceptions.",
    "tree": {
      "sha": "98a15b8aa7aa4a70d552bb115a60a465478f8ec7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/98a15b8aa7aa4a70d552bb115a60a465478f8ec7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d806ea2d0ef362fcddd2c1659f537b68aa114203",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d806ea2d0ef362fcddd2c1659f537b68aa114203",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d806ea2d0ef362fcddd2c1659f537b68aa114203",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d806ea2d0ef362fcddd2c1659f537b68aa114203/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c1a5d03a89a455d79f025c66dce83342de4d26ce",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c1a5d03a89a455d79f025c66dce83342de4d26ce",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c1a5d03a89a455d79f025c66dce83342de4d26ce"
    }
  ],
  "stats": {
    "total": 46,
    "additions": 39,
    "deletions": 7
  },
  "files": [
    {
      "sha": "c6548723d0e54825b2b8af5e248a435ecf0de70c",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=d806ea2d0ef362fcddd2c1659f537b68aa114203",
      "patch": "@@ -1,3 +1,11 @@\n+2019-08-19  Tom Tromey  <tom@tromey.com>\n+\n+\t* configure: Rebuild.\n+\t* configure.ac: Disallow the combination of -static-libstdc++ and\n+\tsource highlight.\n+\t* source-cache.c (get_language_name): Handle rust.\n+\t(source_cache::get_source_lines): Ignore highlighting exceptions.\n+\n 2019-08-16  Tom Tromey  <tom@tromey.com>\n \n \t* tui/tui.h (enum tui_win_type) <EXEC_INFO_WIN>: Remove."
    },
    {
      "sha": "cb71bbf057a24e04d37f4e2d8ae2066732dc79f8",
      "filename": "gdb/configure",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure?ref=d806ea2d0ef362fcddd2c1659f537b68aa114203",
      "patch": "@@ -11326,6 +11326,12 @@ $as_echo \"no - pkg-config not found\" >&6; }\n       as_fn_error $? \"pkg-config was not found in your system\" \"$LINENO\" 5\n     fi\n   else\n+    case \"$LDFLAGS\" in\n+      *static-libstdc*)\n+        as_fn_error $? \"source highlight is incompatible with -static-libstdc++; either use --disable-source-highlight or --without-static-standard-libraries\" \"$LINENO\" 5\n+        ;;\n+    esac\n+\n     if ${pkg_config_prog_path} --exists source-highlight; then\n       SRCHIGH_CFLAGS=`${pkg_config_prog_path} --cflags source-highlight`\n       SRCHIGH_LIBS=`${pkg_config_prog_path} --libs source-highlight`"
    },
    {
      "sha": "5a18c1640572b8c067670a4a184baa2732176023",
      "filename": "gdb/configure.ac",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure.ac?ref=d806ea2d0ef362fcddd2c1659f537b68aa114203",
      "patch": "@@ -1231,6 +1231,14 @@ if test \"${enable_source_highlight}\" != \"no\"; then\n       AC_MSG_ERROR([pkg-config was not found in your system])\n     fi\n   else\n+    case \"$LDFLAGS\" in\n+      *static-libstdc*)\n+        AC_MSG_ERROR([source highlight is incompatible with -static-libstdc++; dnl\n+either use --disable-source-highlight or dnl\n+--without-static-standard-libraries])\n+        ;;\n+    esac\n+\n     if ${pkg_config_prog_path} --exists source-highlight; then\n       SRCHIGH_CFLAGS=`${pkg_config_prog_path} --cflags source-highlight`\n       SRCHIGH_LIBS=`${pkg_config_prog_path} --libs source-highlight`"
    },
    {
      "sha": "18e2be989b4b14349ee74815b97d9c169da505e8",
      "filename": "gdb/source-cache.c",
      "status": "modified",
      "additions": 17,
      "deletions": 7,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/source-cache.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d806ea2d0ef362fcddd2c1659f537b68aa114203/gdb/source-cache.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source-cache.c?ref=d806ea2d0ef362fcddd2c1659f537b68aa114203",
      "patch": "@@ -135,8 +135,7 @@ get_language_name (enum language lang)\n       break;\n \n     case language_rust:\n-      /* Not handled by Source Highlight.  */\n-      break;\n+      return \"rust.lang\";\n \n     case language_ada:\n       return \"ada.lang\";\n@@ -197,11 +196,22 @@ source_cache::ensure (struct symtab *s)\n \t      highlighter->setStyleFile (\"esc.style\");\n \t    }\n \n-\t  std::istringstream input (contents);\n-\t  std::ostringstream output;\n-\t  highlighter->highlight (input, output, lang_name, fullname);\n-\n-\t  contents = output.str ();\n+\t  try\n+\t    {\n+\t      std::istringstream input (contents);\n+\t      std::ostringstream output;\n+\t      highlighter->highlight (input, output, lang_name, fullname);\n+\t      contents = output.str ();\n+\t    }\n+\t  catch (...)\n+\t    {\n+\t      /* Source Highlight will throw an exception if\n+\t\t highlighting fails.  One possible reason it can fail\n+\t\t is if the language is unknown -- which matters to gdb\n+\t\t because Rust support wasn't added until after 3.1.8.\n+\t\t Ignore exceptions here and fall back to\n+\t\t un-highlighted text. */\n+\t    }\n \t}\n     }\n #endif /* HAVE_SOURCE_HIGHLIGHT */"
    }
  ]
}