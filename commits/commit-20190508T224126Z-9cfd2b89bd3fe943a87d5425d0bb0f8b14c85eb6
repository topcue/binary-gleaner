{
  "sha": "9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OWNmZDJiODliZDNmZTk0M2E4N2Q1NDI1ZDBiYjBmOGIxNGM4NWViNg==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-05-08T22:41:26Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-05-08T22:41:26Z"
    },
    "message": "[gdb/testsuite] Fix gdb.arch/amd64-entry-value-paramref.S\n\nThe file gdb.arch/amd64-entry-value-paramref.S contains a DIE for function\nbar:\n...\nDIE29:  .uleb128 0x2    # (DIE (0x29) DW_TAG_subprogram)\n        .ascii \"bar\\0\"  # DW_AT_name\n        .byte   0x1     # DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n        .byte   0x15    # DW_AT_decl_line\n        .long   DIE45   # DW_AT_type\n        .byte   0x1     # DW_AT_inline\n...\nwhich refers to DIE45:\n...\nDIE45:\t.uleb128 0x4\t# (DIE (0x45) DW_TAG_base_type)\n\t.byte\t0x4\t# DW_AT_byte_size\n\t.byte\t0x5\t# DW_AT_encoding\n\t.ascii \"int\\0\"\t# DW_AT_name\n...\nusing a form DW_FORM_ref4:\n...\n\t.uleb128 0x2\t# (abbrev code)\n\t.uleb128 0x2e\t# (TAG: DW_TAG_subprogram)\n\t.byte\t0x1\t# DW_children_yes\n\t...\n\t.uleb128 0x49\t# (DW_AT_type)\n\t.uleb128 0x13\t# (DW_FORM_ref4)\n...\n\nHowever, the DW_FORM_ref4 is a CU-relative reference, while using a label for\nthe value will result in a section-relative value.\n\nSo, if linked in object files contain dwarf info and are placed in the\n.debug_info section before the compilation units generated from\namd64-entry-value-paramref.S, then the referenced type is at 0x108:\n...\n <1><108>: Abbrev Number: 4 (DW_TAG_base_type)\n    <109>   DW_AT_byte_size   : 4\n    <10a>   DW_AT_encoding    : 5       (signed)\n    <10b>   DW_AT_name        : int\n...\nbut the reference will point to a non-existing DIE at 0x1cf:\n...\n <1><f0>: Abbrev Number: 2 (DW_TAG_subprogram)\n    <f1>   DW_AT_name        : bar\n    <f5>   DW_AT_decl_file   : 1\n    <f6>   DW_AT_decl_line   : 21\n    <f7>   DW_AT_type        : <0x1cf>\n    <fb>   DW_AT_inline      : 1        (inlined)\n...\nwhich happens to cause a GDB internal error described in PR23270 - \"GDB\ninternal error: dwarf2read.c:18656: internal-error: could not find partial\nDIE 0x1b7 in cache\".\n\nFix the invalid DWARF by making the reference value CU-relative:\n...\n-       .long   DIE45   # DW_AT_type\n+       .long   DIE45 - .Ldebug_info0   # DW_AT_type\n...\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2019-05-09  Tom de Vries  <tdevries@suse.de>\n\n\t* gdb.arch/amd64-entry-value-paramref.S: Make DW_FORM_ref4 references\n\tCU-relative.",
    "tree": {
      "sha": "7223f7a73a35912a21ddd1eba53aef126562315f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7223f7a73a35912a21ddd1eba53aef126562315f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7a1021395e0ef7a92e1653533b753a2221396015",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7a1021395e0ef7a92e1653533b753a2221396015",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7a1021395e0ef7a92e1653533b753a2221396015"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 18,
    "deletions": 13
  },
  "files": [
    {
      "sha": "47e82c406d2bccde367ab7638b1582d1733ba962",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6",
      "patch": "@@ -1,3 +1,8 @@\n+2019-05-09  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gdb.arch/amd64-entry-value-paramref.S: Make DW_FORM_ref4 references\n+\tCU-relative.\n+\n 2019-05-08  Joel Brobecker  <brobecker@adacore.com>\n \n \t* gdb.ada/frame_arg_lang.exp: New testcase."
    },
    {
      "sha": "2e59aaec32c7b6080c4f330f8d977ab65786af8b",
      "filename": "gdb/testsuite/gdb.arch/amd64-entry-value-paramref.S",
      "status": "modified",
      "additions": 13,
      "deletions": 13,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6/gdb/testsuite/gdb.arch/amd64-entry-value-paramref.S",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6/gdb/testsuite/gdb.arch/amd64-entry-value-paramref.S",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.arch/amd64-entry-value-paramref.S?ref=9cfd2b89bd3fe943a87d5425d0bb0f8b14c85eb6",
      "patch": "@@ -121,32 +121,32 @@ DIE29:\t.uleb128 0x2\t# (DIE (0x29) DW_TAG_subprogram)\n \t.ascii \"bar\\0\"\t# DW_AT_name\n \t.byte\t0x1\t# DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n \t.byte\t0x15\t# DW_AT_decl_line\n-\t.long\tDIE45\t# DW_AT_type\n+\t.long\tDIE45 - .Ldebug_info0\t# DW_AT_type\n \t.byte\t0x1\t# DW_AT_inline\n DIE39:\t.uleb128 0x3\t# (DIE (0x39) DW_TAG_formal_parameter)\n \t.ascii \"ref\\0\"\t# DW_AT_name\n \t.byte\t0x1\t# DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n \t.byte\t0x15\t# DW_AT_decl_line\n-\t.long\tDIE4c\t# DW_AT_type\n+\t.long\tDIE4c - .Ldebug_info0\t# DW_AT_type\n \t.byte\t0\t# end of children of DIE 0x29\n DIE45:\t.uleb128 0x4\t# (DIE (0x45) DW_TAG_base_type)\n \t.byte\t0x4\t# DW_AT_byte_size\n \t.byte\t0x5\t# DW_AT_encoding\n \t.ascii \"int\\0\"\t# DW_AT_name\n DIE4c:\t.uleb128 0x5\t# (DIE (0x4c) DW_TAG_const_type)\n-\t.long\tDIE51\t# DW_AT_type\n+\t.long\tDIE51 - .Ldebug_info0\t# DW_AT_type\n DIE51:\t.uleb128 0x6\t# (DIE (0x51) DW_TAG_reference_type)\n \t.byte\t0x8\t# DW_AT_byte_size\n-\t.long\tDIE45\t# DW_AT_type\n+\t.long\tDIE45 - .Ldebug_info0\t# DW_AT_type\n DIE57:\t.uleb128 0x7\t# (DIE (0x57) DW_TAG_subprogram)\n-\t.long\tDIE29\t# DW_AT_abstract_origin\n+\t.long\tDIE29 - .Ldebug_info0\t# DW_AT_abstract_origin\n \t.quad\t.LFB2\t# DW_AT_low_pc\n \t.quad\t.LFE2-.LFB2\t# DW_AT_high_pc\n \t.uleb128 0x1\t# DW_AT_frame_base\n \t.byte\t0x9c\t# DW_OP_call_frame_cfa\n \t\t\t# DW_AT_GNU_all_call_sites\n DIE72:\t.uleb128 0x8\t# (DIE (0x72) DW_TAG_formal_parameter)\n-\t.long\tDIE39\t# DW_AT_abstract_origin\n+\t.long\tDIE39 - .Ldebug_info0\t# DW_AT_abstract_origin\n \t.uleb128 0x1\t# DW_AT_location\n \t.byte\t0x55\t# DW_OP_reg5\n \t.byte\t0\t# end of children of DIE 0x57\n@@ -155,7 +155,7 @@ DIE7a:\t.uleb128 0x9\t# (DIE (0x7a) DW_TAG_subprogram)\n \t.long\t.LASF3\t# DW_AT_name: \"main\"\n \t.byte\t0x1\t# DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n \t.byte\t0x1d\t# DW_AT_decl_line\n-\t.long\tDIE45\t# DW_AT_type\n+\t.long\tDIE45 - .Ldebug_info0\t# DW_AT_type\n \t.quad\t.LFB1\t# DW_AT_low_pc\n \t.quad\t.LFE1-.LFB1\t# DW_AT_high_pc\n \t.uleb128 0x1\t# DW_AT_frame_base\n@@ -168,13 +168,13 @@ DIEac:\t.uleb128 0xb\t# (DIE (0xac) DW_TAG_variable)\n \t.ascii \"var\\0\"\t# DW_AT_name\n \t.byte\t0x1\t# DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n \t.byte\t0x1f\t# DW_AT_decl_line\n-\t.long\tDIE45\t# DW_AT_type\n+\t.long\tDIE45 - .Ldebug_info0\t# DW_AT_type\n \t.uleb128 0x2\t# DW_AT_location\n \t.byte\t0x91\t# DW_OP_fbreg\n \t.sleb128 -12\n DIEba:\t.uleb128 0xc\t# (DIE (0xba) DW_TAG_GNU_call_site)\n \t.quad\t.LVL1\t# DW_AT_low_pc\n-\t.long\tDIE57\t# DW_AT_abstract_origin\n+\t.long\tDIE57 - .Ldebug_info0\t# DW_AT_abstract_origin\n DIEc7:\t.uleb128 0xd\t# (DIE (0xc7) DW_TAG_GNU_call_site_parameter)\n \t.uleb128 0x1\t# DW_AT_location\n \t.byte\t0x55\t# DW_OP_reg5\n@@ -200,25 +200,25 @@ DIEd2:\t.uleb128 0xe\t# (DIE (0xd2) DW_TAG_variable)\n \t.ascii \"vv\\0\"\t# DW_AT_name\n \t.byte\t0x1\t# DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n \t.byte\t0x12\t# DW_AT_decl_line\n-\t.long\tDIEe6\t# DW_AT_type\n+\t.long\tDIEe6 - .Ldebug_info0\t# DW_AT_type\n \t\t\t# DW_AT_external\n \t.uleb128 0x9\t# DW_AT_location\n \t.byte\t0x3\t# DW_OP_addr\n \t.quad\tvv\n DIEe6:\t.uleb128 0xf\t# (DIE (0xe6) DW_TAG_volatile_type)\n-\t.long\tDIE45\t# DW_AT_type\n+\t.long\tDIE45 - .Ldebug_info0\t# DW_AT_type\n DIEeb:\t.uleb128 0xe\t# (DIE (0xeb) DW_TAG_variable)\n \t.ascii \"p\\0\"\t# DW_AT_name\n \t.byte\t0x1\t# DW_AT_decl_file (gdb.arch/amd64-entry-value-paramref.cc)\n \t.byte\t0x12\t# DW_AT_decl_line\n-\t.long\tDIEfe\t# DW_AT_type\n+\t.long\tDIEfe - .Ldebug_info0\t# DW_AT_type\n \t\t\t# DW_AT_external\n \t.uleb128 0x9\t# DW_AT_location\n \t.byte\t0x3\t# DW_OP_addr\n \t.quad\tp\n DIEfe:\t.uleb128 0x10\t# (DIE (0xfe) DW_TAG_pointer_type)\n \t.byte\t0x8\t# DW_AT_byte_size\n-\t.long\tDIEe6\t# DW_AT_type\n+\t.long\tDIEe6 - .Ldebug_info0\t# DW_AT_type\n \t.byte\t0\t# end of children of DIE 0xb\n .Linfo_end:\n \t.section\t.debug_abbrev,\"\",@progbits"
    }
  ]
}