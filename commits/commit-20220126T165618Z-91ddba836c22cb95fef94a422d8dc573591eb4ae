{
  "sha": "91ddba836c22cb95fef94a422d8dc573591eb4ae",
  "node_id": "C_kwDOANOeidoAKDkxZGRiYTgzNmMyMmNiOTVmZWY5NGE0MjJkOGRjNTczNTkxZWI0YWU",
  "commit": {
    "author": {
      "name": "Keith Seitz",
      "email": "keiths@redhat.com",
      "date": "2022-01-26T16:56:18Z"
    },
    "committer": {
      "name": "Keith Seitz",
      "email": "keiths@redhat.com",
      "date": "2022-01-26T16:56:18Z"
    },
    "message": "Reference array of structs instead of first member during memcpy\n\naarch64-tdep.c defines the following macro:\n\n#define MEM_ALLOC(MEMS, LENGTH, RECORD_BUF) \\\n        do  \\\n          { \\\n            unsigned int mem_len = LENGTH; \\\n            if (mem_len) \\\n              { \\\n                MEMS =  XNEWVEC (struct aarch64_mem_r, mem_len);  \\\n                memcpy(&MEMS->len, &RECORD_BUF[0], \\\n                       sizeof(struct aarch64_mem_r) * LENGTH); \\\n              } \\\n          } \\\n          while (0)\n\nThis is simlpy allocating a new array and copying it. However, for\nthe destination address, it is actually copying into the first member\nof the first element of the array (`&MEMS->len\"). This elicits a\nwarning with GCC 12:\n\n../../binutils-gdb/gdb/aarch64-tdep.c: In function \u2018int aarch64_process_record(gdbarch*, regcache*, CORE_ADDR)\u2019:\n../../binutils-gdb/gdb/aarch64-tdep.c:3711:23: error: writing 16 bytes into a region of size 8 [-Werror=stringop-overflow=]\n 3711 |                 memcpy(&MEMS->len, &RECORD_BUF[0], \\\n      |                       ^\n../../binutils-gdb/gdb/aarch64-tdep.c:4394:3: note: in expansion of macro \u2018MEM_ALLOC\u2019\n 4394 |   MEM_ALLOC (aarch64_insn_r->aarch64_mems, aarch64_insn_r->mem_rec_count,\n      |   ^~~~~~~~~\n../../binutils-gdb/gdb/aarch64-tdep.c:3721:12: note: destination object \u2018aarch64_mem_r::len\u2019 of size 8\n 3721 |   uint64_t len;    /* Record length.  */\n      |            ^~~\n\nThe simple fix is to reference the array, `MEMS' as the destination of the copy.\n\nTested by rebuilding.\n\n\n# Please enter the commit message for your changes. Lines starting\n# with '#' will be kept; you may remove them yourself if you want to.\n# An empty message aborts the commit.\n#\n# Date:      Tue Jan 25 08:28:32 2022 -0800\n#\n# On branch master\n# Your branch is ahead of 'origin/master' by 1 commit.\n#   (use \"git push\" to publish your local commits)\n#\n# Changes to be committed:\n#\tmodified:   aarch64-tdep.c\n#",
    "tree": {
      "sha": "d137c58a515606931dab24c4366c871ddccb5b79",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d137c58a515606931dab24c4366c871ddccb5b79"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/91ddba836c22cb95fef94a422d8dc573591eb4ae",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/91ddba836c22cb95fef94a422d8dc573591eb4ae",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/91ddba836c22cb95fef94a422d8dc573591eb4ae",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/91ddba836c22cb95fef94a422d8dc573591eb4ae/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "5d10a2041eb843fd321ce1d850cf3e0df7648bc7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5d10a2041eb843fd321ce1d850cf3e0df7648bc7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5d10a2041eb843fd321ce1d850cf3e0df7648bc7"
    }
  ],
  "stats": {
    "total": 2,
    "additions": 1,
    "deletions": 1
  },
  "files": [
    {
      "sha": "b3efb3ebaffa936dc8e922cb45dfda20c525e06b",
      "filename": "gdb/aarch64-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91ddba836c22cb95fef94a422d8dc573591eb4ae/gdb/aarch64-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91ddba836c22cb95fef94a422d8dc573591eb4ae/gdb/aarch64-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/aarch64-tdep.c?ref=91ddba836c22cb95fef94a422d8dc573591eb4ae",
      "patch": "@@ -3708,7 +3708,7 @@ When on, AArch64 specific debugging is enabled.\"),\n \t    if (mem_len) \\\n \t      { \\\n \t\tMEMS =  XNEWVEC (struct aarch64_mem_r, mem_len);  \\\n-\t\tmemcpy(&MEMS->len, &RECORD_BUF[0], \\\n+\t\tmemcpy(MEMS, &RECORD_BUF[0], \\\n \t\t       sizeof(struct aarch64_mem_r) * LENGTH); \\\n \t      } \\\n \t  } \\"
    }
  ]
}