{
  "sha": "847d518374be1c73b812e312a26341115d3f6f5a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ODQ3ZDUxODM3NGJlMWM3M2I4MTJlMzEyYTI2MzQxMTE1ZDNmNmY1YQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-10-07T03:07:23Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-10-07T03:07:23Z"
    },
    "message": "Bogus \"final link failed\" messages\n\nThis patch is a result of noticing messages like the following:\ntmpdir/tls32.o: in function `_start':\n(.text+0x1c): unresolvable R_PPC_REL24 relocation against symbol `__tls_get_addr_opt'\n./ld-new: final link failed: symbol needs debug section which does not exist\n\nThe \"needs debug section\" comes from attempting to use debug info to\nfind source line information to print the first error message.  That\nerror isn't of interest to the user, and any previous bfd_error value\nwhich might be of interest is overwritten.  So save and restore\nbfd_error around the fancy error reporting code.\n\nThat still doesn't leave us with a clean bfd_error.  Now we get\n./ld-new: final link failed: nonrepresentable section on output\nAn unresolvable relocation surely doesn't mean there is some bfd\nsection that ld doesn't know how to output!  Digging into that showed\na _bfd_elf_section_from_bfd_section failure attempting to find an elf\nsection correcsponding to \".interp\".  So don't go looking for elf\nsections on linker created bfd sections.\n\nAnd then fix the linker testsuite which expected the bogus message..\n\nbfd/\n\t* elflink.c (elf_fixup_link_order): Don't attempt to find\n\tan elf_section for linker created bfd sections.\nld/\n\t* ldmisc.c (vfinfo): Save and restore bfd_error around bfd\n\tfunction calls that might set it.\n\t* testsuite/ld-elf/indirect.exp: Don't expect \"nonrepresentable\n\tsection\" message.",
    "tree": {
      "sha": "27fe3429795ec071efde47db3ab4adf691bf1a7b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/27fe3429795ec071efde47db3ab4adf691bf1a7b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/847d518374be1c73b812e312a26341115d3f6f5a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/847d518374be1c73b812e312a26341115d3f6f5a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/847d518374be1c73b812e312a26341115d3f6f5a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/847d518374be1c73b812e312a26341115d3f6f5a/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c3614cffc85be28c07ff5320fe5554e6717ee87c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c3614cffc85be28c07ff5320fe5554e6717ee87c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c3614cffc85be28c07ff5320fe5554e6717ee87c"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 17,
    "deletions": 3
  },
  "files": [
    {
      "sha": "607f37cfb27533a8022169c6667ce575167c1d23",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/847d518374be1c73b812e312a26341115d3f6f5a/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/847d518374be1c73b812e312a26341115d3f6f5a/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=847d518374be1c73b812e312a26341115d3f6f5a",
      "patch": "@@ -1,3 +1,8 @@\n+2019-10-07  Alan Modra  <amodra@gmail.com>\n+\n+\t* elflink.c (elf_fixup_link_order): Don't attempt to find\n+\tan elf_section for linker created bfd sections.\n+\n 2019-10-07  Alan Modra  <amodra@gmail.com>\n \n \t* elf32-ppc.c (ppc_elf_tls_optimize): Don't process R_PPC_TLSLD"
    },
    {
      "sha": "395d96d6cfb5ed6ccdcef1522a72b3d55e6cb885",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/847d518374be1c73b812e312a26341115d3f6f5a/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/847d518374be1c73b812e312a26341115d3f6f5a/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=847d518374be1c73b812e312a26341115d3f6f5a",
      "patch": "@@ -11535,7 +11535,8 @@ elf_fixup_link_order (bfd *abfd, asection *o)\n \t{\n \t  s = p->u.indirect.section;\n \t  sub = s->owner;\n-\t  if (bfd_get_flavour (sub) == bfd_target_elf_flavour\n+\t  if ((s->flags & SEC_LINKER_CREATED) == 0\n+\t      && bfd_get_flavour (sub) == bfd_target_elf_flavour\n \t      && elf_elfheader (sub)->e_ident[EI_CLASS] == bed->s->elfclass\n \t      && (elfsec = _bfd_elf_section_from_bfd_section (sub, s))\n \t      && elfsec < elf_numsections (sub)"
    },
    {
      "sha": "ddec8c79ce362018d2d329926533d89d5062ce2b",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/847d518374be1c73b812e312a26341115d3f6f5a/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/847d518374be1c73b812e312a26341115d3f6f5a/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=847d518374be1c73b812e312a26341115d3f6f5a",
      "patch": "@@ -1,3 +1,10 @@\n+2019-10-07  Alan Modra  <amodra@gmail.com>\n+\n+\t* ldmisc.c (vfinfo): Save and restore bfd_error around bfd\n+\tfunction calls that might set it.\n+\t* testsuite/ld-elf/indirect.exp: Don't expect \"nonrepresentable\n+\tsection\" message.\n+\n 2019-10-07  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-powerpc/tlsexe.r: Adjust for added TLSMARK symbol."
    },
    {
      "sha": "2e53d645985d7d4775c53f10361671fffcbecb00",
      "filename": "ld/ldmisc.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/847d518374be1c73b812e312a26341115d3f6f5a/ld/ldmisc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/847d518374be1c73b812e312a26341115d3f6f5a/ld/ldmisc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldmisc.c?ref=847d518374be1c73b812e312a26341115d3f6f5a",
      "patch": "@@ -322,6 +322,7 @@ vfinfo (FILE *fp, const char *fmt, va_list ap, bfd_boolean is_warning)\n \t\tunsigned int linenumber;\n \t\tbfd_boolean discard_last;\n \t\tbfd_boolean done;\n+\t\tbfd_error_type last_bfd_error = bfd_get_error ();\n \n \t\tabfd = args[arg_no].reladdr.abfd;\n \t\tsection = args[arg_no].reladdr.sec;\n@@ -406,6 +407,7 @@ vfinfo (FILE *fp, const char *fmt, va_list ap, bfd_boolean is_warning)\n \t\t  }\n \t\tif (!done)\n \t\t  lfinfo (fp, \"(%pA+0x%v)\", section, offset);\n+\t\tbfd_set_error (last_bfd_error);\n \n \t\tif (discard_last)\n \t\t  {"
    },
    {
      "sha": "6f1fed34e7fbb02c25417aa741a65a72245d031b",
      "filename": "ld/testsuite/ld-elf/indirect.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/847d518374be1c73b812e312a26341115d3f6f5a/ld/testsuite/ld-elf/indirect.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/847d518374be1c73b812e312a26341115d3f6f5a/ld/testsuite/ld-elf/indirect.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/indirect.exp?ref=847d518374be1c73b812e312a26341115d3f6f5a",
      "patch": "@@ -123,11 +123,10 @@ set testname \"Indirect symbol 1b\"\n set cmd \"$ld -e start -o tmpdir/indirect1 tmpdir/indirect1a.o tmpdir/libindirect1c.so tmpdir/indirect1b.o\"\n check_link_message \"$cmd\" [list $string1 $string] \"$testname\"\n \n-set string \": final link failed: nonrepresentable section on output\"\n set string2 \": no symbol version section for versioned symbol \\`foo@FOO\\'\"\n set testname \"Indirect symbol 2\"\n set cmd \"$ld -shared  -o tmpdir/indirect2.so tmpdir/indirect2.o\"\n-check_link_message \"$cmd\" [list $string2 $string] \"$testname\"\n+check_link_message \"$cmd\" [list $string2] \"$testname\"\n \n global NOPIE_CFLAGS NOPIE_LDFLAGS\n "
    }
  ]
}