{
  "sha": "484b1090630d273dfb70ee96b152ec6b527a1b65",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDg0YjEwOTA2MzBkMjczZGZiNzBlZTk2YjE1MmVjNmI1MjdhMWI2NQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-03-20T23:23:40Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-03-20T23:23:42Z"
    },
    "message": "Do not pass objfile to psymtab_discarder\n\nThis changes the psymtab_discarder to not assume that partial symtabs\nare attached to the objfile.  Instead, a psymtab_storage object is\npassed directly to it.\n\ngdb/ChangeLog\n2021-03-20  Tom Tromey  <tom@tromey.com>\n\n\t* psympriv.h (psymtab_discarder): Take psymtab_storage parameter.\n\t(~psymtab_discarder, keep): Update.\n\t<m_objfile>: Remove.\n\t<m_partial_symtabs>: New member.\n\t* dwarf2/read.c (dwarf2_build_psymtabs): Update.",
    "tree": {
      "sha": "0e0a8a9a6e33be2fb7d4dbca9ca632ef9735cca5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0e0a8a9a6e33be2fb7d4dbca9ca632ef9735cca5"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/484b1090630d273dfb70ee96b152ec6b527a1b65",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/484b1090630d273dfb70ee96b152ec6b527a1b65",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/484b1090630d273dfb70ee96b152ec6b527a1b65",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/484b1090630d273dfb70ee96b152ec6b527a1b65/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7e9c0476a7085cbebdc818d163d5c3bd46da6388",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e9c0476a7085cbebdc818d163d5c3bd46da6388",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7e9c0476a7085cbebdc818d163d5c3bd46da6388"
    }
  ],
  "stats": {
    "total": 27,
    "additions": 17,
    "deletions": 10
  },
  "files": [
    {
      "sha": "7bb862e43f002793b7e8c9f2ebb78b63db61bd1d",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/484b1090630d273dfb70ee96b152ec6b527a1b65/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/484b1090630d273dfb70ee96b152ec6b527a1b65/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=484b1090630d273dfb70ee96b152ec6b527a1b65",
      "patch": "@@ -1,3 +1,11 @@\n+2021-03-20  Tom Tromey  <tom@tromey.com>\n+\n+\t* psympriv.h (psymtab_discarder): Take psymtab_storage parameter.\n+\t(~psymtab_discarder, keep): Update.\n+\t<m_objfile>: Remove.\n+\t<m_partial_symtabs>: New member.\n+\t* dwarf2/read.c (dwarf2_build_psymtabs): Update.\n+\n 2021-03-20  Tom Tromey  <tom@tromey.com>\n \n \t* xcoffread.c (xcoff_end_psymtab): Add partial_symtabs parameter."
    },
    {
      "sha": "aad25f7c086306b5a2902ed42d41f87c3602d986",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/484b1090630d273dfb70ee96b152ec6b527a1b65/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/484b1090630d273dfb70ee96b152ec6b527a1b65/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=484b1090630d273dfb70ee96b152ec6b527a1b65",
      "patch": "@@ -6142,7 +6142,7 @@ dwarf2_build_psymtabs (struct objfile *objfile)\n       /* This isn't really ideal: all the data we allocate on the\n \t objfile's obstack is still uselessly kept around.  However,\n \t freeing it seems unsafe.  */\n-      psymtab_discarder psymtabs (objfile);\n+      psymtab_discarder psymtabs (objfile->partial_symtabs.get ());\n       dwarf2_build_psymtabs_hard (per_objfile);\n       psymtabs.keep ();\n "
    },
    {
      "sha": "0f24c104aca1cbf46033e3e15f2b2ab4166fced5",
      "filename": "gdb/psympriv.h",
      "status": "modified",
      "additions": 8,
      "deletions": 9,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/484b1090630d273dfb70ee96b152ec6b527a1b65/gdb/psympriv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/484b1090630d273dfb70ee96b152ec6b527a1b65/gdb/psympriv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psympriv.h?ref=484b1090630d273dfb70ee96b152ec6b527a1b65",
      "patch": "@@ -446,29 +446,28 @@ class psymtab_discarder\n {\n  public:\n \n-  psymtab_discarder (struct objfile *objfile)\n-    : m_objfile (objfile),\n-      m_psymtab (objfile->partial_symtabs->psymtabs)\n+  psymtab_discarder (psymtab_storage *partial_symtabs)\n+    : m_partial_symtabs (partial_symtabs),\n+      m_psymtab (partial_symtabs->psymtabs)\n   {\n   }\n \n   ~psymtab_discarder ()\n   {\n-    if (m_objfile != NULL)\n-      m_objfile->partial_symtabs->discard_psymtabs_to (m_psymtab);\n+    if (m_partial_symtabs != nullptr)\n+      m_partial_symtabs->discard_psymtabs_to (m_psymtab);\n   }\n \n   /* Keep any partial symbol tables that were built.  */\n   void keep ()\n   {\n-    m_objfile = NULL;\n+    m_partial_symtabs = nullptr;\n   }\n \n  private:\n \n-  /* The objfile.  If NULL this serves as a sentinel to indicate that\n-     the psymtabs should be kept.  */\n-  struct objfile *m_objfile;\n+  /* The partial symbol storage object.  */\n+  psymtab_storage *m_partial_symtabs;\n   /* How far back to free.  */\n   struct partial_symtab *m_psymtab;\n };"
    }
  ]
}