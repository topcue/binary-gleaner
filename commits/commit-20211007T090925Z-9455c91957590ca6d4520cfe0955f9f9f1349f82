{
  "sha": "9455c91957590ca6d4520cfe0955f9f9f1349f82",
  "node_id": "C_kwDOANOeidoAKDk0NTVjOTE5NTc1OTBjYTZkNDUyMGNmZTA5NTVmOWY5ZjEzNDlmODI",
  "commit": {
    "author": {
      "name": "Philipp Tomsich",
      "email": "philipp.tomsich@vrull.eu",
      "date": "2021-10-06T20:26:46Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-10-07T09:09:25Z"
    },
    "message": "RISC-V: Add support for Zbs instructions\n\nThis change adds the Zbs instructions from the Zbs 1.0.0 specification.\nSee\n  https://github.com/riscv/riscv-bitmanip/releases/tag/1.0.0\nfor the frozen specification.\n\n2021-01-09  Philipp Tomsich  <philipp.tomsich@vrull.eu>\n\n    bfd/\n\t* elfxx-riscv.c (riscv_supported_std_z_ext): Added zbs.\n    gas/\n\t* config/tc-riscv.c (riscv_multi_subset_supports): Handle INSN_CLASS_ZBS.\n\t* testsuite/gas/riscv/b-ext.d: Test Zbs instructions.\n\t* testsuite/gas/riscv/b-ext.s: Likewise.\n\t* testsuite/gas/riscv/b-ext-64.d: Likewise.\n\t* testsuite/gas/riscv/b-ext-64.s: Likewise.\n    include/\n\t* opcode/riscv-opc.h: Added MASK/MATCH/DECLARE_INSN for Zbs.\n\t* opcode/riscv.h (riscv_insn_class): Added INSN_CLASS_ZBS.\n    opcodes/\n\t* riscv-opc.c (riscv_supported_std_z_ext): Add zbs.\n\nSigned-off-by: Philipp Tomsich <philipp.tomsich@vrull.eu>",
    "tree": {
      "sha": "aad247fc0afd07817c5ebeb29f95b28a1e9015be",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/aad247fc0afd07817c5ebeb29f95b28a1e9015be"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9455c91957590ca6d4520cfe0955f9f9f1349f82",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9455c91957590ca6d4520cfe0955f9f9f1349f82",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9455c91957590ca6d4520cfe0955f9f9f1349f82",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9455c91957590ca6d4520cfe0955f9f9f1349f82/comments",
  "author": {
    "login": "ptomsich",
    "id": 14983582,
    "node_id": "MDQ6VXNlcjE0OTgzNTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/14983582?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ptomsich",
    "html_url": "https://github.com/ptomsich",
    "followers_url": "https://api.github.com/users/ptomsich/followers",
    "following_url": "https://api.github.com/users/ptomsich/following{/other_user}",
    "gists_url": "https://api.github.com/users/ptomsich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ptomsich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ptomsich/subscriptions",
    "organizations_url": "https://api.github.com/users/ptomsich/orgs",
    "repos_url": "https://api.github.com/users/ptomsich/repos",
    "events_url": "https://api.github.com/users/ptomsich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ptomsich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": null,
  "parents": [
    {
      "sha": "586dcfc81ee4a24c150362c624a47d633e4d6bdc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/586dcfc81ee4a24c150362c624a47d633e4d6bdc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/586dcfc81ee4a24c150362c624a47d633e4d6bdc"
    }
  ],
  "stats": {
    "total": 98,
    "additions": 96,
    "deletions": 2
  },
  "files": [
    {
      "sha": "cdb4fa0996ac92b28d8ced7d2847297109ebb5a3",
      "filename": "bfd/elfxx-riscv.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/bfd/elfxx-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/bfd/elfxx-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-riscv.c?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -1145,6 +1145,7 @@ static struct riscv_supported_ext riscv_supported_std_z_ext[] =\n   {\"zbb\",\t\tISA_SPEC_CLASS_DRAFT,\t\t1, 0,  0 },\n   {\"zba\",\t\tISA_SPEC_CLASS_DRAFT,\t\t1, 0,  0 },\n   {\"zbc\",\t\tISA_SPEC_CLASS_DRAFT,\t\t1, 0,  0 },\n+  {\"zbs\",               ISA_SPEC_CLASS_DRAFT,           1, 0,  0 },\n   {NULL, 0, 0, 0, 0}\n };\n "
    },
    {
      "sha": "f7e0c929aa04cc08a177abf22b8490566b6a15f1",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -283,6 +283,9 @@ riscv_multi_subset_supports (enum riscv_insn_class insn_class)\n     case INSN_CLASS_ZBC:\n       return riscv_subset_supports (\"zbc\");\n \n+    case INSN_CLASS_ZBS:\n+      return riscv_subset_supports (\"zbs\");\n+\n     default:\n       as_fatal (\"internal: unreachable\");\n       return false;"
    },
    {
      "sha": "339fa20a36757526339de62bcea4fe49c32bc276",
      "filename": "gas/testsuite/gas/riscv/b-ext-64.d",
      "status": "modified",
      "additions": 17,
      "deletions": 1,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext-64.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext-64.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/b-ext-64.d?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -1,4 +1,4 @@\n-#as: -march=rv64i_zba_zbb_zbc\n+#as: -march=rv64i_zba_zbb_zbc_zbs\n #source: b-ext-64.s\n #objdump: -d\n \n@@ -46,3 +46,19 @@ Disassembly of section .text:\n [ \t]+8c:[ \t]+08c5853b[ \t]+add.uw[ \t]+a0,a1,a2\n [ \t]+90:[ \t]+0805853b[ \t]+zext.w[ \t]+a0,a1\n [ \t]+94:[ \t]+0825951b[ \t]+slli.uw[ \t]+a0,a1,0x2\n+[ \t]+[0-9a-f]+:[ \t]+48059513[ \t]+bclri[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+49f59513[ \t]+bclri[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+28059513[ \t]+bseti[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+29f59513[ \t]+bseti[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+68059513[ \t]+binvi[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+69f59513[ \t]+binvi[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+4805d513[ \t]+bexti[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+49f5d513[ \t]+bexti[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+4bf59513[ \t]+bclri[ \t]+a0,a1,0x3f\n+[ \t]+[0-9a-f]+:[ \t]+2bf59513[ \t]+bseti[ \t]+a0,a1,0x3f\n+[ \t]+[0-9a-f]+:[ \t]+6bf59513[ \t]+binvi[ \t]+a0,a1,0x3f\n+[ \t]+[0-9a-f]+:[ \t]+4bf5d513[ \t]+bexti[ \t]+a0,a1,0x3f\n+[ \t]+[0-9a-f]+:[ \t]+48c59533[ \t]+bclr[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+28c59533[ \t]+bset[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+68c59533[ \t]+binv[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+48c5d533[ \t]+bext[ \t]+a0,a1,a2"
    },
    {
      "sha": "8ceb2b4fd1ccd5f0ec8e91781bd7c539d23f33e3",
      "filename": "gas/testsuite/gas/riscv/b-ext-64.s",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext-64.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext-64.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/b-ext-64.s?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -37,3 +37,19 @@ target:\n \tadd.uw\ta0, a1, a2\n \tzext.w\ta0, a1\n \tslli.uw\ta0, a1, 2\n+\tbclri   a0, a1, 0\n+\tbclri   a0, a1, 31\n+\tbseti   a0, a1, 0\n+\tbseti   a0, a1, 31\n+\tbinvi   a0, a1, 0\n+\tbinvi   a0, a1, 31\n+\tbexti   a0, a1, 0\n+\tbexti   a0, a1, 31\n+\tbclri   a0, a1, 63\n+\tbseti   a0, a1, 63\n+\tbinvi   a0, a1, 63\n+\tbexti   a0, a1, 63\n+\tbclr    a0, a1, a2\n+\tbset    a0, a1, a2\n+\tbinv    a0, a1, a2\n+\tbext    a0, a1, a2"
    },
    {
      "sha": "748c218fdd055bbbedcdd38b902ecfd55ddfcb34",
      "filename": "gas/testsuite/gas/riscv/b-ext.d",
      "status": "modified",
      "additions": 13,
      "deletions": 1,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/b-ext.d?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -1,4 +1,4 @@\n-#as: -march=rv32i_zba_zbb_zbc\n+#as: -march=rv32i_zba_zbb_zbc_zbs\n #source: b-ext.s\n #objdump: -d\n \n@@ -33,3 +33,15 @@ Disassembly of section .text:\n [ \t]+58:[ \t]+0ac59533[ \t]+clmul[ \t]+a0,a1,a2\n [ \t]+5c:[ \t]+0ac5b533[ \t]+clmulh[ \t]+a0,a1,a2\n [ \t]+60:[ \t]+0ac5a533[ \t]+clmulr[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+48059513[ \t]+bclri[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+49f59513[ \t]+bclri[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+28059513[ \t]+bseti[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+29f59513[ \t]+bseti[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+68059513[ \t]+binvi[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+69f59513[ \t]+binvi[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+4805d513[ \t]+bexti[ \t]+a0,a1,0x0\n+[ \t]+[0-9a-f]+:[ \t]+49f5d513[ \t]+bexti[ \t]+a0,a1,0x1f\n+[ \t]+[0-9a-f]+:[ \t]+48c59533[ \t]+bclr[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+28c59533[ \t]+bset[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+68c59533[ \t]+binv[ \t]+a0,a1,a2\n+[ \t]+[0-9a-f]+:[ \t]+48c5d533[ \t]+bext[ \t]+a0,a1,a2"
    },
    {
      "sha": "a13a797f0dce9d1e10b82473ee12b14659414caf",
      "filename": "gas/testsuite/gas/riscv/b-ext.s",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/gas/testsuite/gas/riscv/b-ext.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/b-ext.s?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -24,3 +24,15 @@ target:\n \tclmul\ta0, a1, a2\n \tclmulh\ta0, a1, a2\n \tclmulr\ta0, a1, a2\n+\tbclri   a0, a1, 0\n+\tbclri   a0, a1, 31\n+\tbseti   a0, a1, 0\n+\tbseti   a0, a1, 31\n+\tbinvi   a0, a1, 0\n+\tbinvi   a0, a1, 31\n+\tbexti   a0, a1, 0\n+\tbexti   a0, a1, 31\n+\tbclr    a0, a1, a2\n+\tbset    a0, a1, a2\n+\tbinv    a0, a1, a2\n+\tbext    a0, a1, a2"
    },
    {
      "sha": "45a207da0cdc79b57e6e3315512d8a709cfb51d2",
      "filename": "include/opcode/riscv-opc.h",
      "status": "modified",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/include/opcode/riscv-opc.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/include/opcode/riscv-opc.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/opcode/riscv-opc.h?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -495,6 +495,22 @@\n #define MASK_CLMULH  0xfe00707f\n #define MATCH_CLMULR 0xa002033\n #define MASK_CLMULR  0xfe00707f\n+#define MATCH_BCLRI 0x48001013\n+#define MASK_BCLRI  0xfc00707f\n+#define MATCH_BSETI 0x28001013\n+#define MASK_BSETI  0xfc00707f\n+#define MATCH_BINVI 0x68001013\n+#define MASK_BINVI  0xfc00707f\n+#define MATCH_BEXTI 0x48005013\n+#define MASK_BEXTI  0xfc00707f\n+#define MATCH_BCLR  0x48001033\n+#define MASK_BCLR   0xfe00707f\n+#define MATCH_BSET  0x28001033\n+#define MASK_BSET   0xfe00707f\n+#define MATCH_BINV  0x68001033\n+#define MASK_BINV   0xfe00707f\n+#define MATCH_BEXT  0x48005033\n+#define MASK_BEXT   0xfe00707f\n #define MATCH_FLW 0x2007\n #define MASK_FLW  0x707f\n #define MATCH_FLD 0x3007\n@@ -1102,6 +1118,14 @@ DECLARE_INSN(slli_uw, MATCH_SLLI_UW, MASK_SLLI_UW)\n DECLARE_INSN(clmul, MATCH_CLMUL, MASK_CLMUL)\n DECLARE_INSN(clmulh, MATCH_CLMULH, MASK_CLMULH)\n DECLARE_INSN(clmulr, MATCH_CLMULR, MASK_CLMULR)\n+DECLARE_INSN(bclri, MATCH_BCLRI, MASK_BCLRI)\n+DECLARE_INSN(bseti, MATCH_BSETI, MASK_BSETI)\n+DECLARE_INSN(binvi, MATCH_BINVI, MASK_BINVI)\n+DECLARE_INSN(bexti, MATCH_BEXTI, MASK_BEXTI)\n+DECLARE_INSN(bclr, MATCH_BCLR, MASK_BCLR)\n+DECLARE_INSN(bset, MATCH_BSET, MASK_BSET)\n+DECLARE_INSN(binv, MATCH_BINV, MASK_BINV)\n+DECLARE_INSN(bext, MATCH_BEXT, MASK_BEXT)\n DECLARE_INSN(flw, MATCH_FLW, MASK_FLW)\n DECLARE_INSN(fld, MATCH_FLD, MASK_FLD)\n DECLARE_INSN(flq, MATCH_FLQ, MASK_FLQ)"
    },
    {
      "sha": "afcd41ff1dd15991ac5d89299412145c208a4e8e",
      "filename": "include/opcode/riscv.h",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/include/opcode/riscv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/include/opcode/riscv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/opcode/riscv.h?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -319,6 +319,7 @@ enum riscv_insn_class\n   INSN_CLASS_ZBA,\n   INSN_CLASS_ZBB,\n   INSN_CLASS_ZBC,\n+  INSN_CLASS_ZBS,\n };\n \n /* This structure holds information for a particular instruction.  */"
    },
    {
      "sha": "1a4c9f0e4fecfeeefd9dec95fca2b0e77a04b944",
      "filename": "opcodes/riscv-opc.c",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9455c91957590ca6d4520cfe0955f9f9f1349f82/opcodes/riscv-opc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9455c91957590ca6d4520cfe0955f9f9f1349f82/opcodes/riscv-opc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/riscv-opc.c?ref=9455c91957590ca6d4520cfe0955f9f9f1349f82",
      "patch": "@@ -833,6 +833,15 @@ const struct riscv_opcode riscv_opcodes[] =\n {\"clmulh\",     0, INSN_CLASS_ZBC,  \"d,s,t\", MATCH_CLMULH, MASK_CLMULH, match_opcode, 0 },\n {\"clmulr\",     0, INSN_CLASS_ZBC,  \"d,s,t\", MATCH_CLMULR, MASK_CLMULR, match_opcode, 0 },\n \n+/* Zbs instructions */\n+{\"bclri\",     0, INSN_CLASS_ZBS,   \"d,s,>\",  MATCH_BCLRI, MASK_BCLRI, match_opcode, 0 },\n+{\"bseti\",     0, INSN_CLASS_ZBS,   \"d,s,>\",  MATCH_BSETI, MASK_BSETI, match_opcode, 0 },\n+{\"binvi\",     0, INSN_CLASS_ZBS,   \"d,s,>\",  MATCH_BINVI, MASK_BINVI, match_opcode, 0 },\n+{\"bexti\",     0, INSN_CLASS_ZBS,   \"d,s,>\",  MATCH_BEXTI, MASK_BEXTI, match_opcode, 0 },\n+{\"bclr\",      0, INSN_CLASS_ZBS,   \"d,s,t\",  MATCH_BCLR, MASK_BCLR, match_opcode, 0 },\n+{\"bset\",      0, INSN_CLASS_ZBS,   \"d,s,t\",  MATCH_BSET, MASK_BSET, match_opcode, 0 },\n+{\"binv\",      0, INSN_CLASS_ZBS,   \"d,s,t\",  MATCH_BINV, MASK_BINV, match_opcode, 0 },\n+{\"bext\",      0, INSN_CLASS_ZBS,   \"d,s,t\",  MATCH_BEXT, MASK_BEXT, match_opcode, 0 },\n \n /* Terminate the list.  */\n {0, 0, INSN_CLASS_NONE, 0, 0, 0, 0, 0}"
    }
  ]
}