{
  "sha": "87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ODdmYTdkNTY4ZGRkODA0ZmI3M2JiNzhlMzNhZTFjMjJkOWZlMzQzYw==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-03-09T07:52:32Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-03-09T07:52:32Z"
    },
    "message": "bfd: don't silently wrap or truncate PE image section RVAs\n\nIn PE images section addresses get expressed as addresses relative to\nthe image base. Therefore the VA of a section must be no less than the\nimage base, and after subtraction of the image base the resulting value\nshould fit in 32 bits. (The issue is particularly obvious to notice when\nsections, perhaps because of ELF assumptions, get placed at VA 0 by\ndefault. Debugging info sections as well as .comment, when input files\nare ELF, are a good example. All such sections need proper mentioning in\nthe linker script to avoid this warning.)\n\nThere are a number of test cases which previously produced bogus images,\nyet still declared the test a success. Like done for other tests\nalready, force a zero image base for these. This then also allows (and\nrequires) dropping again xfail-s which 39a7b38fac0e (\"Fix linker tests\nto work with 16-bit targets\") had added to ld-scripts/default-script*.d\n(originally as skip-s). This also depends on similar adjustments to\ntestsuite/ld-scripts/map-address.* made by an earlier patch.\n\nFor ld-scripts/print-memory-usage.* I suppose xcoff could be dropped\nfrom the exclusion list by suppressing garbage collection, just like\nalready done in e.g. (as seen in the diff here) ld-scripts/data.*, but I\ndidn't want to make unrelated adjustments.",
    "tree": {
      "sha": "3b7c6340553f16341999dc7a2bfe6fcfedc5ac54",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3b7c6340553f16341999dc7a2bfe6fcfedc5ac54"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "500e7d4cb32129c8f2a3a4af6fd599f676b4f694",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/500e7d4cb32129c8f2a3a4af6fd599f676b4f694",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/500e7d4cb32129c8f2a3a4af6fd599f676b4f694"
    }
  ],
  "stats": {
    "total": 88,
    "additions": 69,
    "deletions": 19
  },
  "files": [
    {
      "sha": "6c633ebe0b64e10cc25f1bcff5f3a979d5faf0c1",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -1,3 +1,7 @@\n+2021-03-09  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* peXXigen.c (_bfd_XXi_swap_scnhdr_out): Diagnose out of range RVA.\n+\n 2021-03-05  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27425"
    },
    {
      "sha": "83bbac51af78653bc612232596ab1ca378edfa86",
      "filename": "bfd/peXXigen.c",
      "status": "modified",
      "additions": 7,
      "deletions": 5,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/bfd/peXXigen.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/bfd/peXXigen.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/peXXigen.c?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -933,11 +933,13 @@ _bfd_XXi_swap_scnhdr_out (bfd * abfd, void * in, void * out)\n \n   memcpy (scnhdr_ext->s_name, scnhdr_int->s_name, sizeof (scnhdr_int->s_name));\n \n-  PUT_SCNHDR_VADDR (abfd,\n-\t\t    ((scnhdr_int->s_vaddr\n-\t\t      - pe_data (abfd)->pe_opthdr.ImageBase)\n-\t\t     & 0xffffffff),\n-\t\t    scnhdr_ext->s_vaddr);\n+  ss = scnhdr_int->s_vaddr - pe_data (abfd)->pe_opthdr.ImageBase;\n+  if (scnhdr_int->s_vaddr < pe_data (abfd)->pe_opthdr.ImageBase)\n+    _bfd_error_handler (\"%pB:%.8s: section below image base\",\n+                        abfd, scnhdr_int->s_name);\n+  else if(ss != (ss & 0xffffffff))\n+    _bfd_error_handler (\"%pB:%.8s: RVA truncated\", abfd, scnhdr_int->s_name);\n+  PUT_SCNHDR_VADDR (abfd, ss & 0xffffffff, scnhdr_ext->s_vaddr);\n \n   /* NT wants the size data to be rounded up to the next\n      NT_FILE_ALIGNMENT, but zero if it has no content (as in .bss,"
    },
    {
      "sha": "1b98c81a6a8a3e3330f9c494f28bc213b7bb49c5",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -1,3 +1,18 @@\n+2021-03-09  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* testsuite/ld-scripts/alignof.exp,\n+\ttestsuite/ld-scripts/data.exp,\n+\ttestsuite/ld-scripts/default-script.exp,\n+\ttestsuite/ld-scripts/log2.exp,\n+\ttestsuite/ld-scripts/print-memory-usage.exp,\n+\ttestsuite/ld-scripts/sizeof.exp,\n+\ttestsuite/ld-undefined/weak-undef.exp: Set image base to zero\n+\tfor PE/COFF.\n+\t* testsuite/ld-scripts/default-script1.d,\n+\ttestsuite/ld-scripts/default-script2.d,\n+\ttestsuite/ld-scripts/default-script3.d,\n+\ttestsuite/ld-scripts/default-script4.d: Drop xfail and comment.\n+\n 2021-03-05  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27425"
    },
    {
      "sha": "44aa93146c4e47a50effe223cc439d02f7b39065",
      "filename": "ld/testsuite/ld-scripts/alignof.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/alignof.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/alignof.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/alignof.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -32,7 +32,14 @@ if ![ld_assemble $as $srcdir/$subdir/alignof.s tmpdir/alignof.o] {\n     return\n }\n \n-if ![ld_link $ld tmpdir/alignof \"-T $srcdir/$subdir/alignof.t tmpdir/alignof.o\"] {\n+if { [is_pecoff_format] } {\n+    set IMAGE_BASE \"--image-base 0\"\n+} else {\n+    set IMAGE_BASE \"\"\n+}\n+\n+if ![ld_link $ld tmpdir/alignof \"-T $srcdir/$subdir/alignof.t \\\n+\t$IMAGE_BASE tmpdir/alignof.o\"] {\n     fail $testname\n     return\n }"
    },
    {
      "sha": "8f7fe2dafac60977a71d1650b92e87ee9b395fce",
      "filename": "ld/testsuite/ld-scripts/data.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/data.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/data.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/data.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -20,7 +20,9 @@\n # MA 02110-1301, USA.\n \n set old_LDFLAGS $LDFLAGS\n-if { [is_xcoff_format] } then {\n+if { [is_pecoff_format] } then {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n+} elseif { [is_xcoff_format] } then {\n     set LDFLAGS \"$LDFLAGS -bnogc\"\n }\n "
    },
    {
      "sha": "753085e4364332185f187ed60e7b83de96603556",
      "filename": "ld/testsuite/ld-scripts/default-script.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/default-script.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -21,6 +21,8 @@\n set old_ldflags $LDFLAGS\n if { [istarget spu*-*-*] } {\n     set LDFLAGS \"$LDFLAGS --local-store 0:0\"\n+} elseif { [is_pecoff_format] } {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n } elseif { [is_xcoff_format] } {\n     set LDFLAGS \"$LDFLAGS -bnogc\"\n }"
    },
    {
      "sha": "97758084640e78add929949aab038a29189b9f33",
      "filename": "ld/testsuite/ld-scripts/default-script1.d",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/default-script1.d?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -1,8 +1,6 @@\n #source: default-script.s\n #ld: -defsym _START=0x800 -T default-script.t\n #nm: -n\n-#xfail: {[is_pecoff_format x86_64-*]}\n-# Skipped on Mingw64 and Cygwin because the image base defaults to 0x100000000\n \n #...\n 0*800 . _START"
    },
    {
      "sha": "39c24e001484d1259d2b09c7aabe866818656c2f",
      "filename": "ld/testsuite/ld-scripts/default-script2.d",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/default-script2.d?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -1,8 +1,6 @@\n #source: default-script.s\n #ld: -T default-script.t -defsym _START=0x800\n #nm: -n\n-#xfail: {[is_pecoff_format x86_64-*]}\n-# Skipped on Mingw64 and Cygwin because the image base defaults to 0x100000000\n \n #...\n 0*800 . _START"
    },
    {
      "sha": "7a7dda651307e1142061e8603e358119d7241632",
      "filename": "ld/testsuite/ld-scripts/default-script3.d",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script3.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script3.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/default-script3.d?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -1,8 +1,6 @@\n #source: default-script.s\n #ld: -defsym _START=0x800 -dT default-script.t\n #nm: -n\n-#xfail: {[is_pecoff_format x86_64-*]}\n-# Skipped on Mingw64 and Cygwin because the image base defaults to 0x100000000\n \n #...\n 0*800 . _START"
    },
    {
      "sha": "7f905b3f36e3ccc26dd10eac3849c9a8ca10811b",
      "filename": "ld/testsuite/ld-scripts/default-script4.d",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script4.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/default-script4.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/default-script4.d?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -1,8 +1,6 @@\n #source: default-script.s\n #ld: --default-script default-script.t -defsym _START=0x800\n #nm: -n\n-#xfail: {[is_pecoff_format x86_64-*]}\n-# Skipped on Mingw64 and Cygwin because the image base defaults to 0x100000000\n \n #...\n 0*800 . _START"
    },
    {
      "sha": "ba00d95aa9e1318701b761c0faef1f3159edfa19",
      "filename": "ld/testsuite/ld-scripts/log2.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/log2.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/log2.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/log2.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -26,7 +26,14 @@ if {![ld_assemble $as $srcdir/$subdir/log2.s tmpdir/log2.o]} {\n     return\n }\n \n-if {![ld_link $ld tmpdir/log2 \"$LDFLAGS -T $srcdir/$subdir/log2.t tmpdir/log2.o\"]} {\n+if { [is_pecoff_format] } {\n+    set IMAGE_BASE \"--image-base 0\"\n+} else {\n+    set IMAGE_BASE \"\"\n+}\n+\n+if {![ld_link $ld tmpdir/log2 \"$LDFLAGS -T $srcdir/$subdir/log2.t \\\n+\t$IMAGE_BASE tmpdir/log2.o\"]} {\n     fail $testname\n } else {\n     pass $testname"
    },
    {
      "sha": "a84c525882d1f737746772ea31f307df78b9f5dc",
      "filename": "ld/testsuite/ld-scripts/print-memory-usage.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/print-memory-usage.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/print-memory-usage.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/print-memory-usage.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -33,6 +33,11 @@ if { [istarget mips*-*-*]\n     return\n }\n \n+set old_LDFLAGS $LDFLAGS\n+if { [is_pecoff_format] } {\n+    set LDFLAGS \"$LDFLAGS --image-base 0\"\n+}\n+\n run_ld_link_tests {\n     {\n \t\"print-memory-usage-1\"\n@@ -66,3 +71,4 @@ run_ld_link_tests {\n \n }\n \n+set LDFLAGS $old_LDFLAGS"
    },
    {
      "sha": "4624fa1cdcab3be694812af0e9d58332a9370288",
      "filename": "ld/testsuite/ld-scripts/sizeof.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/sizeof.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-scripts/sizeof.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-scripts/sizeof.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -27,7 +27,14 @@ if ![ld_assemble $as $srcdir/$subdir/sizeof.s tmpdir/sizeof.o] {\n     return\n }\n \n-if ![ld_link $ld tmpdir/sizeof \"$LDFLAGS -T $srcdir/$subdir/sizeof.t tmpdir/sizeof.o\"] {\n+if { [is_pecoff_format] } {\n+    set IMAGE_BASE \"--image-base 0\"\n+} else {\n+    set IMAGE_BASE \"\"\n+}\n+\n+if ![ld_link $ld tmpdir/sizeof \"$LDFLAGS -T $srcdir/$subdir/sizeof.t \\\n+\t$IMAGE_BASE tmpdir/sizeof.o\"] {\n     fail $testname\n     return\n }"
    },
    {
      "sha": "443dce2fbfec2c6dd185951ebf8dc02376275869",
      "filename": "ld/testsuite/ld-undefined/weak-undef.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 2,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-undefined/weak-undef.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/87fa7d568ddd804fb73bb78e33ae1c22d9fe343c/ld/testsuite/ld-undefined/weak-undef.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-undefined/weak-undef.exp?ref=87fa7d568ddd804fb73bb78e33ae1c22d9fe343c",
      "patch": "@@ -23,14 +23,20 @@\n # some a.out targets too.\n set testname \"weak undefined data symbols\"\n \n+if { [is_pecoff_format] } then {\n+    set IMAGE_BASE \"--image-base 0\"\n+} else {\n+    set IMAGE_BASE \"\"\n+}\n+\n if { ![is_elf_format] && ![is_pecoff_format] } then {\n     unsupported $testname\n } elseif {![ld_assemble $as $srcdir/$subdir/weak-undef.s \\\n \t    tmpdir/weak-undef.o]} then {\n     # It's OK if .weak doesn't work on this target.\n     unsupported $testname\n-} elseif {![ld_link $ld tmpdir/weak-undef \\\n-\t\t\"tmpdir/weak-undef.o -T $srcdir/$subdir/weak-undef.t\"]} then {\n+} elseif {![ld_link $ld tmpdir/weak-undef \"tmpdir/weak-undef.o \\\n+\t\t-T $srcdir/$subdir/weak-undef.t $IMAGE_BASE\"]} then {\n     # Weak symbols are broken for non-i386 PE targets.\n     if {! [istarget i?86-*-*]} {\n \tsetup_xfail *-*-pe*"
    }
  ]
}