{
  "sha": "d86bd7cba1965c621b63792179febcf9eeb273ad",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDg2YmQ3Y2JhMTk2NWM2MjFiNjM3OTIxNzlmZWJjZjllZWIyNzNhZA==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-08-05T13:41:04Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-08-05T13:41:04Z"
    },
    "message": "[gdb/testsuite] Run read1 timeout tests with with_read1_timeout_factor\n\nWhen running tests with check-read1, we run into some timeouts where the tests\nare not easy to rewrite using gdb_test_sequence:\n...\nFAIL: gdb.base/help.exp: help data (timeout)\nFAIL: gdb.base/help.exp: help files (timeout)\nFAIL: gdb.base/help.exp: help internals (timeout)\nFAIL: gdb.base/help.exp: help user-defined (timeout)\nFAIL: gdb.base/help.exp: help breakpoint \"b\" abbreviation (timeout)\nFAIL: gdb.base/help.exp: help breakpoint \"br\" abbreviation (timeout)\nFAIL: gdb.base/help.exp: help breakpoint \"bre\" abbreviation (timeout)\nFAIL: gdb.base/info-macros.exp: info macros 2 (timeout)\nFAIL: gdb.base/info-macros.exp: next (timeout)\nFAIL: gdb.base/info-macros.exp: info macros 3 (timeout)\nFAIL: gdb.base/info-macros.exp: next (timeout)\nFAIL: gdb.base/info-macros.exp: next (timeout)\nFAIL: gdb.base/info-macros.exp: info macros (timeout)\nFAIL: gdb.base/info-macros.exp: next (timeout)\nFAIL: gdb.base/info-macros.exp: next (timeout)\nFAIL: gdb.base/info-macros.exp: info macros 7 (timeout)\nFAIL: gdb.cp/nested-types.exp: ptype S10 (limit = -1) // parse failed (timeout)\nFAIL: gdb.cp/nested-types.exp: set print type nested-type-limit 1 (timeout)\n...\n\nFix these by increasing the timeout by a factor 10.\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2019-08-05  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/24863\n\t* lib/gdb.exp (with_read1_timeout_factor): New proc.\n\t* gdb.base/help.exp: Use with_read1_timeout_factor.\n\t* gdb.base/info-macros.exp: Same.\n\t* gdb.cp/nested-types.exp: Same.",
    "tree": {
      "sha": "9f7184ec615830080c6ea3216ad3bb13cbac1849",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9f7184ec615830080c6ea3216ad3bb13cbac1849"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d86bd7cba1965c621b63792179febcf9eeb273ad",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d86bd7cba1965c621b63792179febcf9eeb273ad",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d86bd7cba1965c621b63792179febcf9eeb273ad",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d86bd7cba1965c621b63792179febcf9eeb273ad/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8abfcabcb49fcd8b95854a5b59e7928e3c6000ff",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8abfcabcb49fcd8b95854a5b59e7928e3c6000ff",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8abfcabcb49fcd8b95854a5b59e7928e3c6000ff"
    }
  ],
  "stats": {
    "total": 106,
    "additions": 73,
    "deletions": 33
  },
  "files": [
    {
      "sha": "00b8a14715ccb40e3dcc1b264de15709155a793d",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=d86bd7cba1965c621b63792179febcf9eeb273ad",
      "patch": "@@ -1,3 +1,11 @@\n+2019-08-05  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/24863\n+\t* lib/gdb.exp (with_read1_timeout_factor): New proc.\n+\t* gdb.base/help.exp: Use with_read1_timeout_factor.\n+\t* gdb.base/info-macros.exp: Same.\n+\t* gdb.cp/nested-types.exp: Same.\n+\n 2019-08-05  Tom de Vries  <tdevries@suse.de>\n \n \t* lib/gdb.exp (version_at_least): Factor out of ..."
    },
    {
      "sha": "19933db79b1c45d1b58292460f58531676123012",
      "filename": "gdb/testsuite/gdb.base/help.exp",
      "status": "modified",
      "additions": 30,
      "deletions": 24,
      "changes": 54,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/gdb.base/help.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/gdb.base/help.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/help.exp?ref=d86bd7cba1965c621b63792179febcf9eeb273ad",
      "patch": "@@ -29,13 +29,15 @@ test_class_help \"aliases\" {\"Aliases of other commands\\.\\[\\r\\n\\]+\"}\n test_class_help \"breakpoints\" {\n     \"Making program stop at certain points\\.\\[\\r\\n\\]+\"\n }\n-test_class_help \"data\" {\"Examining data\\.\\[\\r\\n\\]+\"}\n-test_class_help \"files\" {\"Specifying and examining files\\.\\[\\r\\n\\]+\"}\n-test_class_help \"internals\" {\n-    \"Maintenance commands\\.\\[\\r\\n\\]+\"\n-    \"Some gdb commands are provided just for use by gdb maintainers\\.\\[\\r\\n\\]+\"\n-    \"These commands are subject to frequent change, and may not be as\\[\\r\\n\\]+\"\n-    \"well documented as user commands\\.\\[\\r\\n\\]+\"\n+with_read1_timeout_factor 10 {\n+    test_class_help \"data\" {\"Examining data\\.\\[\\r\\n\\]+\"}\n+    test_class_help \"files\" {\"Specifying and examining files\\.\\[\\r\\n\\]+\"}\n+    test_class_help \"internals\" {\n+\t\"Maintenance commands\\.\\[\\r\\n\\]+\"\n+\t\"Some gdb commands are provided just for use by gdb maintainers\\.\\[\\r\\n\\]+\"\n+\t\"These commands are subject to frequent change, and may not be as\\[\\r\\n\\]+\"\n+\t\"well documented as user commands\\.\\[\\r\\n\\]+\"\n+    }\n }\n test_class_help \"obscure\" {\"Obscure features\\.\\[\\r\\n\\]+\"}\n test_class_help \"running\" {\"Running the program\\.\\[\\r\\n\\]+\"}\n@@ -44,25 +46,29 @@ test_class_help \"stack\" {\n     \"When the program being debugged stops, gdb selects the innermost frame\\.\\[\\r\\n\\]+\"\n     \"The commands below can be used to select other frames by number or address\\.\\[\\r\\n\\]+\"\n }\n-test_class_help \"status\" {\n-    \"Status inquiries\\.\\[\\r\\n\\]+\"\n-}\n-test_class_help \"support\" {\"Support facilities\\.\\[\\r\\n\\]+\"}\n-test_class_help \"tracepoints\" {\n-    \"Tracing of program execution without stopping the program\\.\\[\\r\\n\\]+\"\n+with_read1_timeout_factor 10 {\n+    test_class_help \"status\" {\n+\t\"Status inquiries\\.\\[\\r\\n\\]+\"\n+    }\n+    test_class_help \"support\" {\"Support facilities\\.\\[\\r\\n\\]+\"}\n+    test_class_help \"tracepoints\" {\n+\t\"Tracing of program execution without stopping the program\\.\\[\\r\\n\\]+\"\n+    }\n }\n \n-test_user_defined_class_help\n-\n-# Test help of an abbreviated command.  \"break\" is picked at random.\n-set help_breakpoint_text \"Set breakpoint at specified location\\..*\"\n-# test help breakpoint \"b\" abbreviation\n-gdb_test \"help b\" $help_breakpoint_text \"help breakpoint \\\"b\\\" abbreviation\"\n-# test help breakpoint \"br\" abbreviation\n-gdb_test \"help br\" $help_breakpoint_text \"help breakpoint \\\"br\\\" abbreviation\"\n-# test help breakpoint \"bre\" abbreviation\n-gdb_test \"help bre\" $help_breakpoint_text \"help breakpoint \\\"bre\\\" abbreviation\"\n-# test help breakpoint \"brea\" abbreviation\n+with_read1_timeout_factor 10 {\n+    test_user_defined_class_help\n+\n+    # Test help of an abbreviated command.  \"break\" is picked at random.\n+    set help_breakpoint_text \"Set breakpoint at specified location\\..*\"\n+    # test help breakpoint \"b\" abbreviation\n+    gdb_test \"help b\" $help_breakpoint_text \"help breakpoint \\\"b\\\" abbreviation\"\n+    # test help breakpoint \"br\" abbreviation\n+    gdb_test \"help br\" $help_breakpoint_text \"help breakpoint \\\"br\\\" abbreviation\"\n+    # test help breakpoint \"bre\" abbreviation\n+    gdb_test \"help bre\" $help_breakpoint_text \"help breakpoint \\\"bre\\\" abbreviation\"\n+    # test help breakpoint \"brea\" abbreviation\n+}\n gdb_test \"help brea\" $help_breakpoint_text \"help breakpoint \\\"brea\\\" abbreviation\"\n # test help breakpoint \"break\" abbreviation\n gdb_test \"help break\" $help_breakpoint_text \"help breakpoint \\\"break\\\" abbreviation\""
    },
    {
      "sha": "e2385faa3e1fb10e13e682c5e02575c29da66ecf",
      "filename": "gdb/testsuite/gdb.base/info-macros.exp",
      "status": "modified",
      "additions": 14,
      "deletions": 7,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/gdb.base/info-macros.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/gdb.base/info-macros.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/info-macros.exp?ref=d86bd7cba1965c621b63792179febcf9eeb273ad",
      "patch": "@@ -132,12 +132,19 @@ set test \"info macro  -a  --  FOO\"\n set testname \"$test\"\n gdb_test \"$test\" \"$r1$r2$r3$r4\" \"$testname\"\n \n+proc gdb_test_multiple_with_read1_timeout_factor { factor command message \\\n+\t\t\t\t\t\t       user_code } {\n+    with_read1_timeout_factor $factor {\n+        uplevel [list gdb_test_multiple $command $message $user_code]\n+    }\n+}\n+\n set test \"info macros\"\n set r1 \".*#define FOO \\\"hello\\\"\"\n set r2 \".*#define ONE\"\n set r3 \".*\\r\\n$gdb_prompt\"\n set testname \"$test 2\"\n-gdb_test_multiple \"$test\" $testname {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $testname {\n   -re \"$r1$r2$r3\" {\n      pass $testname\n   }\n@@ -158,7 +165,7 @@ set r2 \".*#define ONE\"\n set r3 \".*#define TWO\"\n set r4 \".*\\r\\n$gdb_prompt\"\n set testname \"$test 3\"\n-gdb_test_multiple \"$test\" $testname {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $testname {\n   -re \".*#define THREE.*\\r\\n$gdb_prompt\" {\n      fail $testname\n   }\n@@ -178,7 +185,7 @@ set r3 \".*#define THREE\"\n set r4 \".*#define TWO\"\n set r5 \".*\\r\\n$gdb_prompt\"\n set testname \"$test 4\"\n-gdb_test_multiple \"$test\" $testname {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $testname {\n   -re \".*#define FOUR.*\\r\\n$gdb_prompt\" {\n      fail $testname\n   }\n@@ -188,7 +195,7 @@ gdb_test_multiple \"$test\" $testname {\n }\n # same as above with a linespec.\n set test \"info macros *\\$pc\"\n-gdb_test_multiple \"$test\" $test {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $test {\n   -re \".*#define FOUR.*\\r\\n$gdb_prompt\" {\n      fail $test\n   }\n@@ -204,7 +211,7 @@ set r3 \".*#define TWO.\"\n set r4 \".*\\r\\n$gdb_prompt\"\n set test \"info macros\"\n set testname \"$test 5\"\n-gdb_test_multiple \"$test\" $test {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $test {\n   -re \".*#define THREE.*\\r\\n$gdb_prompt\" {\n      fail $testname\n   }\n@@ -221,7 +228,7 @@ gdb_test \"next\" \".*\" \"\"\n set r1 \".*#define DEF_MACROS\"\n set r2 \".*\\r\\n$gdb_prompt\"\n set testname \"$test 6\"\n-gdb_test_multiple \"$test\" $testname {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $testname {\n   -re \".*#define FOO \\\" \\\".*\\r\\n$gdb_prompt\" {\n      fail $testname\n   }\n@@ -257,7 +264,7 @@ set r2 \".*#define FOO\\\\(a\\\\) foo = a\"\n set r3 \".*#define FOUR\"\n set r4 \".*\\r\\n$gdb_prompt\"\n set testname \"$test 7\"\n-gdb_test_multiple \"$test\" $testname {\n+gdb_test_multiple_with_read1_timeout_factor 10 \"$test\" $testname {\n   -re \".*#define FOO \\\" \\\".*\\r\\n$gdb_prompt\" {\n      fail $testname\n   }"
    },
    {
      "sha": "f0c9922d0e8535a235d3621ca4f05695bfdd73c4",
      "filename": "gdb/testsuite/gdb.cp/nested-types.exp",
      "status": "modified",
      "additions": 9,
      "deletions": 2,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/gdb.cp/nested-types.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/gdb.cp/nested-types.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.cp/nested-types.exp?ref=d86bd7cba1965c621b63792179febcf9eeb273ad",
      "patch": "@@ -278,13 +278,20 @@ proc test_nested_limit {limit log} {\n     node_result result 10 $limit {} 0 $log\n \n     if {!$log} {\n+\tif {$limit < 0 || $limit >= 8 } {\n+\t    set read1_timeout_factor 10\n+\t} else {\n+\t    set read1_timeout_factor 1\n+\t}\n \t# The only output we check for is the contents of the struct,\n \t# ignoring the leading \"type = struct S10 {\" and trailing \"}\" of\n \t# the outermost node.\n \tset result [lindex $result 0]\n \tlassign $result type access key name children\n-\tcp_test_ptype_class $name \"ptype $name (limit = $limit)\" $key \\\n-\t    $name $children\n+\twith_read1_timeout_factor $read1_timeout_factor {\n+\t    cp_test_ptype_class $name \"ptype $name (limit = $limit)\" $key \\\n+\t\t$name $children\n+\t}\n     }\n }\n "
    },
    {
      "sha": "edc8dfcdfde80a547f34b74b781311701e1ecb29",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d86bd7cba1965c621b63792179febcf9eeb273ad/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=d86bd7cba1965c621b63792179febcf9eeb273ad",
      "patch": "@@ -2364,6 +2364,18 @@ proc with_timeout_factor { factor body } {\n     }\n }\n \n+# Run BODY with timeout factor FACTOR if check-read1 is used.\n+\n+proc with_read1_timeout_factor { factor body } {\n+    if { [info exists ::env(READ1)] == 1 && $::env(READ1) == 1 } {\n+\t# Use timeout factor\n+    } else {\n+\t# Reset timeout factor\n+\tset factor 1\n+    }\n+    return [uplevel [list with_timeout_factor $factor $body]]\n+}\n+\n # Return 1 if _Complex types are supported, otherwise, return 0.\n \n gdb_caching_proc support_complex_tests {"
    }
  ]
}