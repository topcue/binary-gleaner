{
  "sha": "bc521517b7058a231a08bf8f3deae7cd41cd62d7",
  "node_id": "C_kwDOANOeidoAKGJjNTIxNTE3YjcwNThhMjMxYTA4YmY4ZjNkZWFlN2NkNDFjZDYyZDc",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-12-27T04:49:48Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2022-01-06T15:56:20Z"
    },
    "message": "Introduce target_announce_attach\n\nThis introduces target_announce_attach, by analog with\ntarget_announce_detach.  Then it converts existing targets to use\nthis, rather than emitting their own output by hand.",
    "tree": {
      "sha": "ae7a824e59ff285cd070bc89d41e286f786e55a5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ae7a824e59ff285cd070bc89d41e286f786e55a5"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bc521517b7058a231a08bf8f3deae7cd41cd62d7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bc521517b7058a231a08bf8f3deae7cd41cd62d7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bc521517b7058a231a08bf8f3deae7cd41cd62d7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bc521517b7058a231a08bf8f3deae7cd41cd62d7/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "10a85f29c74ab562db622cfc4f58997e859c6ed6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/10a85f29c74ab562db622cfc4f58997e859c6ed6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/10a85f29c74ab562db622cfc4f58997e859c6ed6"
    }
  ],
  "stats": {
    "total": 107,
    "additions": 30,
    "deletions": 77
  },
  "files": [
    {
      "sha": "e9c24dcc5dca1df48b653fa3fc7087036b56a615",
      "filename": "gdb/darwin-nat.c",
      "status": "modified",
      "additions": 1,
      "deletions": 11,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/darwin-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/darwin-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/darwin-nat.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -2002,17 +2002,7 @@ darwin_nat_target::attach (const char *args, int from_tty)\n   if (pid == getpid ())\t\t/* Trying to masturbate?  */\n     error (_(\"I refuse to debug myself!\"));\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_unfiltered (_(\"Attaching to program: %s, %s\\n\"), exec_file,\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-      else\n-\tprintf_unfiltered (_(\"Attaching to %s\\n\"),\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-    }\n+  target_announce_attach (from_tty, pid);\n \n   if (pid == 0 || ::kill (pid, 0) < 0)\n     error (_(\"Can't attach to process %d: %s (%d)\"),"
    },
    {
      "sha": "f99aeb193476f1e11a3eac1569f1f585867399f6",
      "filename": "gdb/gnu-nat.c",
      "status": "modified",
      "additions": 1,
      "deletions": 10,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/gnu-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/gnu-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gnu-nat.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -2170,16 +2170,7 @@ gnu_nat_target::attach (const char *args, int from_tty)\n   if (pid == getpid ())\t\t/* Trying to masturbate?  */\n     error (_(\"I refuse to debug myself!\"));\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_unfiltered (\"Attaching to program `%s', pid %d\\n\",\n-\t\t\t   exec_file, pid);\n-      else\n-\tprintf_unfiltered (\"Attaching to pid %d\\n\", pid);\n-    }\n+  target_announce_attach (from_tty, pid);\n \n   inf_debug (inf, \"attaching to pid: %d\", pid);\n "
    },
    {
      "sha": "6e4706a3d20a6fc0dd7e964f34eac33fbf5b64da",
      "filename": "gdb/inf-ptrace.c",
      "status": "modified",
      "additions": 1,
      "deletions": 11,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/inf-ptrace.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/inf-ptrace.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inf-ptrace.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -148,17 +148,7 @@ inf_ptrace_target::attach (const char *args, int from_tty)\n       unpusher.reset (this);\n     }\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_unfiltered (_(\"Attaching to program: %s, %s\\n\"), exec_file,\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-      else\n-\tprintf_unfiltered (_(\"Attaching to %s\\n\"),\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-    }\n+  target_announce_attach (from_tty, pid);\n \n #ifdef PT_ATTACH\n   errno = 0;"
    },
    {
      "sha": "da0feaedff9fab03228f492add19923d4a048b04",
      "filename": "gdb/nto-procfs.c",
      "status": "modified",
      "additions": 1,
      "deletions": 10,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/nto-procfs.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/nto-procfs.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nto-procfs.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -701,17 +701,8 @@ nto_procfs_target::attach (const char *args, int from_tty)\n   if (pid == getpid ())\n     error (_(\"Attaching GDB to itself is not a good idea...\"));\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n+  target_announce_attach (from_tty, pid);\n \n-      if (exec_file)\n-\tprintf_unfiltered (\"Attaching to program `%s', %s\\n\", exec_file,\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-      else\n-\tprintf_unfiltered (\"Attaching to %s\\n\",\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-    }\n   ptid_t ptid = do_attach (ptid_t (pid));\n   inf = current_inferior ();\n   inferior_appeared (inf, pid);"
    },
    {
      "sha": "ddc8623b1e175b85d4a08ca57b348abcdd963e48",
      "filename": "gdb/procfs.c",
      "status": "modified",
      "additions": 1,
      "deletions": 13,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/procfs.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/procfs.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/procfs.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -1775,19 +1775,7 @@ procfs_target::attach (const char *args, int from_tty)\n       unpusher.reset (this);\n     }\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_filtered (_(\"Attaching to program `%s', %s\\n\"),\n-\t\t\t exec_file, target_pid_to_str (ptid_t (pid)).c_str ());\n-      else\n-\tprintf_filtered (_(\"Attaching to %s\\n\"),\n-\t\t\t target_pid_to_str (ptid_t (pid)).c_str ());\n-\n-      fflush (stdout);\n-    }\n+  target_announce_attach (from_tty, pid);\n \n   do_attach (ptid_t (pid));\n "
    },
    {
      "sha": "290edd07cd17912f7e146015678b2d49f5150c34",
      "filename": "gdb/remote.c",
      "status": "modified",
      "additions": 1,
      "deletions": 11,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/remote.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/remote.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -6115,17 +6115,7 @@ extended_remote_target::attach (const char *args, int from_tty)\n   if (packet_support (PACKET_vAttach) == PACKET_DISABLE)\n     error (_(\"This target does not support attaching to a process\"));\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_unfiltered (_(\"Attaching to program: %s, %s\\n\"), exec_file,\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-      else\n-\tprintf_unfiltered (_(\"Attaching to %s\\n\"),\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-    }\n+  target_announce_attach (from_tty, pid);\n \n   xsnprintf (rs->buf.data (), get_remote_packet_size (), \"vAttach;%x\", pid);\n   putpkt (rs->buf);"
    },
    {
      "sha": "a48845d6add16a16b1a399288d2077f0e728d154",
      "filename": "gdb/target.c",
      "status": "modified",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/target.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/target.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -3637,6 +3637,24 @@ target_announce_detach (int from_tty)\n \t\t     target_pid_to_str (ptid_t (pid)).c_str ());\n }\n \n+/* See target.h  */\n+\n+void\n+target_announce_attach (int from_tty, int pid)\n+{\n+  if (!from_tty)\n+    return;\n+\n+  const char *exec_file = get_exec_file (0);\n+\n+  if (exec_file)\n+    printf_unfiltered (\"Attaching to program: %s, %s\\n\", exec_file,\n+\t\t       target_pid_to_str (ptid_t (pid)).c_str ());\n+  else\n+    printf_unfiltered (\"Attaching to %s\\n\",\n+\t\t       target_pid_to_str (ptid_t (pid)).c_str ());\n+}\n+\n /* The inferior process has died.  Long live the inferior!  */\n \n void"
    },
    {
      "sha": "1ac7a4554dc56ac024723e5331e1433d744fb9cb",
      "filename": "gdb/target.h",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/target.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/target.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target.h?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -1448,6 +1448,11 @@ extern bool target_attach_no_wait ();\n \n extern void target_post_attach (int pid);\n \n+/* Display a message indicating we're about to attach to a given\n+   process.  */\n+\n+extern void target_announce_attach (int from_tty, int pid);\n+\n /* Display a message indicating we're about to detach from the current\n    inferior process.  */\n "
    },
    {
      "sha": "c85f7c0d652cf0d48de88d54e45e2efd34cd592d",
      "filename": "gdb/windows-nat.c",
      "status": "modified",
      "additions": 1,
      "deletions": 11,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/windows-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bc521517b7058a231a08bf8f3deae7cd41cd62d7/gdb/windows-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/windows-nat.c?ref=bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "patch": "@@ -1929,17 +1929,7 @@ windows_nat_target::attach (const char *args, int from_tty)\n \n   DebugSetProcessKillOnExit (FALSE);\n \n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_unfiltered (\"Attaching to program `%s', %s\\n\", exec_file,\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-      else\n-\tprintf_unfiltered (\"Attaching to %s\\n\",\n-\t\t\t   target_pid_to_str (ptid_t (pid)).c_str ());\n-    }\n+  target_announce_attach (from_tty, pid);\n \n #ifdef __x86_64__\n   HANDLE h = OpenProcess (PROCESS_QUERY_INFORMATION, FALSE, pid);"
    }
  ]
}