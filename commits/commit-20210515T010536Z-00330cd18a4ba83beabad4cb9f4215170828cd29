{
  "sha": "00330cd18a4ba83beabad4cb9f4215170828cd29",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDAzMzBjZDE4YTRiYTgzYmVhYmFkNGNiOWY0MjE1MTcwODI4Y2QyOQ==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-24T18:35:14Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-05-15T01:05:36Z"
    },
    "message": "sim: callback: convert time interface to 64-bit\n\nPR sim/27705\nRather than rely on time_t being the right size between the host &\ntarget, have the interface always be 64-bit.  We can figure out if\nwe need to truncate when actually outputting it to the right target.",
    "tree": {
      "sha": "5e2c26d6fa4f383e0ac7e933f33005d6b136fbcd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5e2c26d6fa4f383e0ac7e933f33005d6b136fbcd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/00330cd18a4ba83beabad4cb9f4215170828cd29",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/00330cd18a4ba83beabad4cb9f4215170828cd29",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/00330cd18a4ba83beabad4cb9f4215170828cd29",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/00330cd18a4ba83beabad4cb9f4215170828cd29/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "fcf102ba7abe6c8a64b2db41bfd02ac80e79e094",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fcf102ba7abe6c8a64b2db41bfd02ac80e79e094",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/fcf102ba7abe6c8a64b2db41bfd02ac80e79e094"
    }
  ],
  "stats": {
    "total": 65,
    "additions": 43,
    "deletions": 22
  },
  "files": [
    {
      "sha": "393b7b8262e46c3a0446ef676097d23e6d67b153",
      "filename": "include/sim/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/include/sim/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/include/sim/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/sim/ChangeLog?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* callback.h: Include stdint.h.\n+\t(struct host_callback_struct): Change time return to int64_t.  Delete\n+\t2nd arg.\n+\n 2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n \n \t* callback.h (p1, p2): Change PTR to void*."
    },
    {
      "sha": "f40385e5761672c692f6e271fad4fe3bd8797f08",
      "filename": "include/sim/callback.h",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/include/sim/callback.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/include/sim/callback.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/sim/callback.h?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -47,6 +47,7 @@\n \n #include <ansidecl.h>\n #include <stdarg.h>\n+#include <stdint.h>\n /* Needed for enum bfd_endian.  */\n #include \"bfd.h\"\n \f\n@@ -78,7 +79,7 @@ struct host_callback_struct\n   int (*read_stdin) ( host_callback *, char *, int);\n   int (*rename) (host_callback *, const char *, const char *);\n   int (*system) (host_callback *, const char *);\n-  long (*time) (host_callback *, long *);\n+  int64_t (*time) (host_callback *);\n   int (*unlink) (host_callback *, const char *);\n   int (*write) (host_callback *,int, const char *, int);\n   int (*write_stdout) (host_callback *, const char *, int);"
    },
    {
      "sha": "5282e70a81a2430ee75ac21024c5906abef5a84d",
      "filename": "sim/arm/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/arm/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/arm/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/arm/ChangeLog?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -1,3 +1,7 @@\n+2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* armos.c (ARMul_OSHandleSWI): Delete 2nd arg to time callback.\n+\n 2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n \n \t* armos.c: Update include path."
    },
    {
      "sha": "72bdf599718ae99f00f4b7c2e62d24ddd17195e3",
      "filename": "sim/arm/armos.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/arm/armos.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/arm/armos.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/arm/armos.c?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -437,7 +437,7 @@ ARMul_OSHandleSWI (ARMul_State * state, ARMword number)\n     case SWI_Time:\n       if (swi_mask & SWI_MASK_DEMON)\n \t{\n-\t  state->Reg[0] = (ARMword) sim_callback->time (sim_callback, NULL);\n+\t  state->Reg[0] = (ARMword) sim_callback->time (sim_callback);\n \t  OSptr->ErrorNo = sim_callback->get_errno (sim_callback);\n \t}\n       else\n@@ -592,7 +592,7 @@ ARMul_OSHandleSWI (ARMul_State * state, ARMword number)\n \t      break;\n \n \t    case AngelSWI_Reason_Time:\n-\t      state->Reg[0] = (ARMword) sim_callback->time (sim_callback, NULL);\n+\t      state->Reg[0] = (ARMword) sim_callback->time (sim_callback);\n \t      OSptr->ErrorNo = sim_callback->get_errno (sim_callback);\n \t      break;\n \n@@ -781,7 +781,7 @@ ARMul_OSHandleSWI (ARMul_State * state, ARMword number)\n \t      break;\n \n \t    case 17: /* Utime.  */\n-\t      state->Reg[0] = state->Reg[1] = (ARMword) sim_callback->time (sim_callback, NULL);\n+\t      state->Reg[0] = state->Reg[1] = (ARMword) sim_callback->time (sim_callback);\n \t      OSptr->ErrorNo = sim_callback->get_errno (sim_callback);\n \t      break;\n "
    },
    {
      "sha": "879aac96a956f7b8d8ce947ba8dbfe2b3dc05e09",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -1,3 +1,12 @@\n+2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* callback.c (os_time): Change return to int64_t.  Delete 2nd arg.\n+\t(os_fstat): Delete 2nd arg to time callback.\n+\t* sim-io.c (sim_io_time): Change return to int64_t.  Delete 2nd arg\n+\tto time callback.\n+\t* sim-io.h (sim_io_time): Change return to int64_t.\n+\t* syscall.c (cb_syscall): Delete 2nd arg to time callback.\n+\n 2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n \n \t* callback.c (cb_host_to_target_stat): Change PTR to void*."
    },
    {
      "sha": "fb5e86431cc21cfe11b8553c5b518716c21763d3",
      "filename": "sim/common/callback.c",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/callback.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/callback.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/callback.c?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -420,12 +420,12 @@ os_system (host_callback *p, const char *s)\n   return result;\n }\n \n-static long\n-os_time (host_callback *p, long *t)\n+static int64_t\n+os_time (host_callback *p)\n {\n-  long result;\n+  int64_t result;\n \n-  result = time (t);\n+  result = time (NULL);\n   p->last_errno = errno;\n   return result;\n }\n@@ -466,7 +466,7 @@ os_fstat (host_callback *p, int fd, struct stat *buf)\n   if (p->ispipe[fd])\n     {\n #if defined (HAVE_STRUCT_STAT_ST_ATIME) || defined (HAVE_STRUCT_STAT_ST_CTIME) || defined (HAVE_STRUCT_STAT_ST_MTIME)\n-      time_t t = (*p->time) (p, NULL);\n+      time_t t = (*p->time) (p);\n #endif\n \n       /* We have to fake the struct stat contents, since the pipe is"
    },
    {
      "sha": "e5da7f1fdaac7ddc5d23ab4d33f29c9b7fb6751c",
      "filename": "sim/common/sim-io.c",
      "status": "modified",
      "additions": 3,
      "deletions": 4,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/sim-io.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/sim-io.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/sim-io.c?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -68,11 +68,10 @@ sim_io_unlink (SIM_DESC sd,\n }\n \n \n-long\n-sim_io_time (SIM_DESC sd,\n-\t     long *t)\n+int64_t\n+sim_io_time (SIM_DESC sd)\n {\n-  return STATE_CALLBACK (sd)->time (STATE_CALLBACK (sd), t);\n+  return STATE_CALLBACK (sd)->time (STATE_CALLBACK (sd));\n }\n \n "
    },
    {
      "sha": "a091fd08e4694ecf9ec1b2a2207f0a9f75dfe0ed",
      "filename": "sim/common/sim-io.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/sim-io.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/sim-io.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/sim-io.h?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -31,7 +31,7 @@ int sim_io_shutdown (SIM_DESC sd);\n \n int sim_io_unlink (SIM_DESC sd, const char *);\n \n-long sim_io_time (SIM_DESC sd, long *);\n+int64_t sim_io_time (SIM_DESC sd);\n \n int sim_io_system (SIM_DESC sd, const char *);\n "
    },
    {
      "sha": "0a1d3f4114da63da2b168fd8c336e1f30e5048f1",
      "filename": "sim/common/syscall.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/syscall.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/common/syscall.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/syscall.c?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -588,7 +588,7 @@ cb_syscall (host_callback *cb, CB_SYSCALL *sc)\n \t   We might also want gettimeofday or times, but if system calls\n \t   can be built on others, we can keep the number we have to support\n \t   here down.  */\n-\ttime_t t = (*cb->time) (cb, (time_t *) 0);\n+\ttime_t t = (*cb->time) (cb);\n \tresult = t;\n \t/* It is up to target code to process the argument to time().  */\n       }"
    },
    {
      "sha": "68cd0bfd52cfca5e28b32b46549219fbc9cc05a6",
      "filename": "sim/cris/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/cris/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/cris/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/cris/ChangeLog?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-14  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* traps.c (cris_break_13_handler): Delete 2nd arg to time callback.\n+\t(cris_time): Change return to int64_t.  Delete 2nd arg.\n+\n 2021-05-04  Tom Tromey  <tromey@adacore.com>\n \n \t* mloop.in: Include <stdlib.h>."
    },
    {
      "sha": "483747fb4e097676934a36d2046d9eb209caced4",
      "filename": "sim/cris/traps.c",
      "status": "modified",
      "additions": 4,
      "deletions": 7,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/cris/traps.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/00330cd18a4ba83beabad4cb9f4215170828cd29/sim/cris/traps.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/cris/traps.c?ref=00330cd18a4ba83beabad4cb9f4215170828cd29",
      "patch": "@@ -2234,7 +2234,7 @@ cris_break_13_handler (SIM_CPU *current_cpu, USI callnum, USI arg1,\n \n \tcase TARGET_SYS_time:\n \t  {\n-\t    retval = (int) (*cb->time) (cb, 0L);\n+\t    retval = (int) (*cb->time) (cb);\n \n \t    /* At time of this writing, CB_SYSCALL_time doesn't do the\n \t       part of setting *arg1 to the return value.  */\n@@ -3327,13 +3327,10 @@ cris_pipe_empty (host_callback *cb,\n \n /* We have a simulator-specific notion of time.  See TARGET_TIME.  */\n \n-static long\n-cris_time (host_callback *cb ATTRIBUTE_UNUSED, long *t)\n+static int64_t\n+cris_time (host_callback *cb ATTRIBUTE_UNUSED)\n {\n-  long retval = TARGET_TIME (current_cpu_for_cb_callback);\n-  if (t)\n-    *t = retval;\n-  return retval;\n+  return TARGET_TIME (current_cpu_for_cb_callback);\n }\n \n /* Set target-specific callback data. */"
    }
  ]
}