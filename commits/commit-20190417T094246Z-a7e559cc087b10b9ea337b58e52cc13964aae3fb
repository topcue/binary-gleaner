{
  "sha": "a7e559cc087b10b9ea337b58e52cc13964aae3fb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTdlNTU5Y2MwODdiMTBiOWVhMzM3YjU4ZTUyY2MxMzk2NGFhZTNmYg==",
  "commit": {
    "author": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-04-16T09:37:47Z"
    },
    "committer": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-04-17T09:42:46Z"
    },
    "message": "gdbserver: Ensure all debug output uses debug functions\n\nAll debug output needs to go via debug functions to ensure it writes to the\ncorrect output stream.\n\ngdb/ChangeLog:\n\n\t* nat/linux-waitpid.c (linux_debug): Call debug_vprintf.\n\ngdb/gdbserver/ChangeLog:\n\n\t* ax.c (ax_vdebug): Call debug_printf.\n\t* debug.c (debug_write): New function.\n\t* debug.h (debug_write): New declaration.\n\t* linux-low.c (sigchld_handler): Call debug_write.",
    "tree": {
      "sha": "9d37b96a5ec1c3c53df5d92c2f2d86fcad65523c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9d37b96a5ec1c3c53df5d92c2f2d86fcad65523c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a7e559cc087b10b9ea337b58e52cc13964aae3fb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7e559cc087b10b9ea337b58e52cc13964aae3fb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a7e559cc087b10b9ea337b58e52cc13964aae3fb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7e559cc087b10b9ea337b58e52cc13964aae3fb/comments",
  "author": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "aeb2e706e1b9c491d20c88c8ead1ae9df9cee04a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aeb2e706e1b9c491d20c88c8ead1ae9df9cee04a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/aeb2e706e1b9c491d20c88c8ead1ae9df9cee04a"
    }
  ],
  "stats": {
    "total": 36,
    "additions": 31,
    "deletions": 5
  },
  "files": [
    {
      "sha": "2fb4b8724488acf8a7a4556e49010525a8b8e499",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -1,3 +1,7 @@\n+2019-04-17  Alan Hayward  <alan.hayward@arm.com>\n+\n+\t* nat/linux-waitpid.c (linux_debug): Call debug_vprintf.\n+\n 2019-04-17  Jim Wilson  <jimw@sifive.com>\n \t    Andrew Burgess  <andrew.burgess@embecosm.com>\n "
    },
    {
      "sha": "f8f600e46d271444ba9f97128da09f21ba92e13b",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -1,3 +1,10 @@\n+2019-04-17  Alan Hayward  <alan.hayward@arm.com>\n+\n+\t* ax.c (ax_vdebug): Call debug_printf.\n+\t* debug.c (debug_write): New function.\n+\t* debug.h (debug_write): New declaration.\n+\t* linux-low.c (sigchld_handler): Call debug_write.\n+\n 2019-04-17  Alan Hayward  <alan.hayward@arm.com>\n \n \t* debug.c (debug_set_output): New function."
    },
    {
      "sha": "7b8df917492debf251c4eba54f944d02d83a5798",
      "filename": "gdb/gdbserver/ax.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/ax.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/ax.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ax.c?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -36,7 +36,11 @@ ax_vdebug (const char *fmt, ...)\n \n   va_start (ap, fmt);\n   vsprintf (buf, fmt, ap);\n+#ifdef IN_PROCESS_AGENT\n   fprintf (stderr, PROG \"/ax: %s\\n\", buf);\n+#else\n+  debug_printf (PROG \"/ax: %s\\n\", buf);\n+#endif\n   va_end (ap);\n }\n "
    },
    {
      "sha": "a1cf5dbf7aa918ed39052978fa4fa8fda7bec032",
      "filename": "gdb/gdbserver/debug.c",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/debug.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/debug.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/debug.c?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -130,3 +130,12 @@ do_debug_exit (const char *function_name)\n   if (function_name != NULL)\n     debug_printf (\"<<<< exiting %s\\n\", function_name);\n }\n+\n+/* See debug.h.  */\n+\n+size_t\n+debug_write (const void *buf, size_t nbyte)\n+{\n+  int fd = fileno (debug_file);\n+  return write (fd, buf, nbyte);\n+}"
    },
    {
      "sha": "29e58ad8a488311d7b9ef24f09db7959047e8388",
      "filename": "gdb/gdbserver/debug.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/debug.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/debug.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/debug.h?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -35,6 +35,9 @@ void debug_flush (void);\n void do_debug_enter (const char *function_name);\n void do_debug_exit (const char *function_name);\n \n+/* Async signal safe debug output function that calls write directly.  */\n+size_t debug_write (const void *buf, size_t nbyte);\n+\n /* These macros are for use in major functions that produce a lot of\n    debugging output.  They help identify in the mass of debugging output\n    when these functions enter and exit.  debug_enter is intended to be"
    },
    {
      "sha": "917b1c290bcdc0dde742a405907eb920d9f8ae90",
      "filename": "gdb/gdbserver/linux-low.c",
      "status": "modified",
      "additions": 3,
      "deletions": 4,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/linux-low.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/gdbserver/linux-low.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/linux-low.c?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -6185,10 +6185,9 @@ sigchld_handler (int signo)\n     {\n       do\n \t{\n-\t  /* fprintf is not async-signal-safe, so call write\n-\t     directly.  */\n-\t  if (write (2, \"sigchld_handler\\n\",\n-\t\t     sizeof (\"sigchld_handler\\n\") - 1) < 0)\n+\t  /* Use the async signal safe debug function.  */\n+\t  if (debug_write (\"sigchld_handler\\n\",\n+\t\t\t   sizeof (\"sigchld_handler\\n\") - 1) < 0)\n \t    break; /* just ignore */\n \t} while (0);\n     }"
    },
    {
      "sha": "a7d11ab8d32aa48ec5dbe7f45031806f16981bb8",
      "filename": "gdb/nat/linux-waitpid.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/nat/linux-waitpid.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7e559cc087b10b9ea337b58e52cc13964aae3fb/gdb/nat/linux-waitpid.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/linux-waitpid.c?ref=a7e559cc087b10b9ea337b58e52cc13964aae3fb",
      "patch": "@@ -42,7 +42,7 @@ linux_debug (const char *format, ...)\n     {\n       va_list args;\n       va_start (args, format);\n-      vfprintf (stderr, format, args);\n+      debug_vprintf (format, args);\n       va_end (args);\n     }\n #endif"
    }
  ]
}