{
  "sha": "66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjY0NTJiZWI3NzM1NjhjN2Y2MGRiYzZiN2M3MGY2NzFhOGM5Y2Y0Yg==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-04-30T20:18:48Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-05-04T05:22:01Z"
    },
    "message": "Fix leaks by clearing registers and frame caches.\n\nValgrind reports leaks such as the below in the tests:\ngdb.threads/corethreads.exp\ngdb.threads/gcore-thread.exp\ngdb.ada/task_switch_in_core.exp\ngdb.trace/tfile.exp\ngdb.base/siginfo-thread.exp\n\n==12701== 1,123 (72 direct, 1,051 indirect) bytes in 1 blocks are definitely lost in loss record 2,928 of 3,247\n==12701==    at 0x4C2C4CC: operator new(unsigned long) (vg_replace_malloc.c:344)\n==12701==    by 0x5CF771: get_thread_arch_aspace_regcache(ptid_t, gdbarch*, address_space*) (regcache.c:330)\n==12701==    by 0x5CF92A: get_thread_regcache (regcache.c:366)\n==12701==    by 0x5CF92A: get_current_regcache() (regcache.c:372)\n==12701==    by 0x4C7964: get_current_frame() (frame.c:1587)\n==12701==    by 0x4C7A3C: get_selected_frame(char const*) (frame.c:1651)\n==12701==    by 0x669EAD: print_thread_info_1(ui_out*, char const*, int, int, int) (thread.c:1151)\n==12701==    by 0x66A9A1: info_threads_command(char const*, int) (thread.c:1217)\n==12701==    by 0x40A878: cmd_func(cmd_list_element*, char const*, int) (cli-decode.c:1892)\n...\n\nFix these leaks by clearing registers and frame caches.\nThis leak and fix is similar to the leak fixed by 799efbe8e01",
    "tree": {
      "sha": "9607e4db13f6abac22064fa6f0ee8b585940f661",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9607e4db13f6abac22064fa6f0ee8b585940f661"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "bde09ab7026edf3d79122872b79c6a8f164ee0ff",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bde09ab7026edf3d79122872b79c6a8f164ee0ff",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bde09ab7026edf3d79122872b79c6a8f164ee0ff"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 12,
    "deletions": 0
  },
  "files": [
    {
      "sha": "0b8d5625d58a32686d48ed7bf0762ed7a12f5f02",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
      "patch": "@@ -1,3 +1,9 @@\n+2019-05-04  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* corelow.c (core_target::detach): Ensure frame cache and\n+\tregister caches are cleared.\n+\tinferior.c (exit_inferior_1): Likewise.\n+\n 2019-05-03  Sandra Loosemore  <sandra@codesourcery.com>\n \t    Tom Tromey  <tom@tromey.com>\n "
    },
    {
      "sha": "9fcc2d23727203a9b788bfa3b7503b2ffd92a11a",
      "filename": "gdb/corelow.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/gdb/corelow.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/gdb/corelow.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/corelow.c?ref=66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
      "patch": "@@ -535,6 +535,8 @@ core_target::detach (inferior *inf, int from_tty)\n      'this'.  */\n   unpush_target (this);\n \n+  /* Clear the register cache and the frame cache.  */\n+  registers_changed ();\n   reinit_frame_cache ();\n   maybe_say_no_core_file_now (from_tty);\n }"
    },
    {
      "sha": "abfef700c386f0a11c17e4619beebf50dbeb46df",
      "filename": "gdb/inferior.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/gdb/inferior.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/66452beb773568c7f60dbc6b7c70f671a8c9cf4b/gdb/inferior.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inferior.c?ref=66452beb773568c7f60dbc6b7c70f671a8c9cf4b",
      "patch": "@@ -208,6 +208,10 @@ exit_inferior_1 (struct inferior *inftoex, int silent)\n   inf->pending_detach = 0;\n   /* Reset it.  */\n   inf->control = inferior_control_state (NO_STOP_QUIETLY);\n+\n+  /* Clear the register cache and the frame cache.  */\n+  registers_changed ();\n+  reinit_frame_cache ();\n }\n \n void"
    }
  ]
}