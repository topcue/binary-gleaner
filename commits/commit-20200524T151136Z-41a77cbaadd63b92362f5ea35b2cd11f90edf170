{
  "sha": "41a77cbaadd63b92362f5ea35b2cd11f90edf170",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDFhNzdjYmFhZGQ2M2I5MjM2MmY1ZWEzNWIyY2QxMWY5MGVkZjE3MA==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-05-11T21:18:25Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-05-24T15:11:36Z"
    },
    "message": "gdb: make gdbarch.sh write gdbarch.{c,h} directly\n\nIt was suggested in this thread [1] that gdbarch.sh should write to\ngdbarch.h and gdbarch.c directly.  This patch implements that.\n\nWhen running gdbarch.sh, we currently need to move new-gdbarch.c over\ngdbarch.c and new-gdbarch.h over gdbarch.h.  It might have been useful\nat some point to not have gdbarch.sh overwrite gdbarch.h and gdbarch.c,\nbut with git it's really unnecessary.  Any changes to gdbarch.sh can be\ninspected using `git diff`.\n\nA next step would be to have the Makefile automatically run gdbarch.sh\nif it sees that gdbarch.c and gdbarch.h are out of date.  Or maybe even\nremove gdbarch.c and gdbarch.h from the tree and generate them in the\nbuild directory when building.  But that requires more thinking and\ndiscussions, and I think that this change is already useful in itself.\n\n[1] https://sourceware.org/pipermail/gdb-patches/2020-May/168265.html\n\ngdb/ChangeLog;\n\n\t* gdbarch.sh: Write to gdbarch.c/gdbarch.h directly.  Don't\n\tcompare old and new versions.\n\t(compare_new): Remove.\n\nChange-Id: I7970a9e8af0afc0145cb5a28e73d94fbaa1e25b9",
    "tree": {
      "sha": "90873d1b17f04d3a6a6117dfe0c8a26dbd0a674b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/90873d1b17f04d3a6a6117dfe0c8a26dbd0a674b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/41a77cbaadd63b92362f5ea35b2cd11f90edf170",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/41a77cbaadd63b92362f5ea35b2cd11f90edf170",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/41a77cbaadd63b92362f5ea35b2cd11f90edf170",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/41a77cbaadd63b92362f5ea35b2cd11f90edf170/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e08bd6c5081f4957ddb60117ac94775dcd618db7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e08bd6c5081f4957ddb60117ac94775dcd618db7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e08bd6c5081f4957ddb60117ac94775dcd618db7"
    }
  ],
  "stats": {
    "total": 63,
    "additions": 8,
    "deletions": 55
  },
  "files": [
    {
      "sha": "55e4a67e2c5a9cc14be9c55001c1187b98ca63e9",
      "filename": "gdb/gdbarch.c",
      "status": "modified",
      "additions": 1,
      "deletions": 11,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41a77cbaadd63b92362f5ea35b2cd11f90edf170/gdb/gdbarch.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41a77cbaadd63b92362f5ea35b2cd11f90edf170/gdb/gdbarch.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch.c?ref=41a77cbaadd63b92362f5ea35b2cd11f90edf170",
      "patch": "@@ -20,17 +20,7 @@\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n \n-/* This file was created with the aid of ``gdbarch.sh''.\n-\n-   The Bourne shell script ``gdbarch.sh'' creates the files\n-   ``new-gdbarch.c'' and ``new-gdbarch.h and then compares them\n-   against the existing ``gdbarch.[hc]''.  Any differences found\n-   being reported.\n-\n-   If editing this file, please also run gdbarch.sh and merge any\n-   changes into that script. Conversely, when making sweeping changes\n-   to this file, modifying gdbarch.sh and using its output may prove\n-   easier.  */\n+/* This file was created with the aid of ``gdbarch.sh''.  */\n \n \n #include \"defs.h\""
    },
    {
      "sha": "c7621f2fda1470ef4ecb0ce3a20a6a853163eb67",
      "filename": "gdb/gdbarch.h",
      "status": "modified",
      "additions": 1,
      "deletions": 11,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41a77cbaadd63b92362f5ea35b2cd11f90edf170/gdb/gdbarch.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41a77cbaadd63b92362f5ea35b2cd11f90edf170/gdb/gdbarch.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch.h?ref=41a77cbaadd63b92362f5ea35b2cd11f90edf170",
      "patch": "@@ -20,17 +20,7 @@\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n \n-/* This file was created with the aid of ``gdbarch.sh''.\n-\n-   The Bourne shell script ``gdbarch.sh'' creates the files\n-   ``new-gdbarch.c'' and ``new-gdbarch.h and then compares them\n-   against the existing ``gdbarch.[hc]''.  Any differences found\n-   being reported.\n-\n-   If editing this file, please also run gdbarch.sh and merge any\n-   changes into that script. Conversely, when making sweeping changes\n-   to this file, modifying gdbarch.sh and using its output may prove\n-   easier.  */\n+/* This file was created with the aid of ``gdbarch.sh''.  */\n \n #ifndef GDBARCH_H\n #define GDBARCH_H"
    },
    {
      "sha": "e297b1c56a09b4fb63874f34a4ad818ec010b629",
      "filename": "gdb/gdbarch.sh",
      "status": "modified",
      "additions": 6,
      "deletions": 33,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41a77cbaadd63b92362f5ea35b2cd11f90edf170/gdb/gdbarch.sh",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41a77cbaadd63b92362f5ea35b2cd11f90edf170/gdb/gdbarch.sh",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch.sh?ref=41a77cbaadd63b92362f5ea35b2cd11f90edf170",
      "patch": "@@ -24,22 +24,6 @@\n LANG=C ; export LANG\n LC_ALL=C ; export LC_ALL\n \n-\n-compare_new ()\n-{\n-    file=$1\n-    if test ! -r \"${file}\"\n-    then\n-\techo \"${file} missing? cp new-${file} ${file}\" 1>&2\n-    elif diff -u \"${file}\" \"new-${file}\"\n-    then\n-\techo \"${file} unchanged\" 1>&2\n-    else\n-\techo \"${file} has changed? cp new-${file} ${file}\" 1>&2\n-    fi\n-}\n-\n-\n # Format of the input table\n read=\"class returntype function formal actual staticdefault predefault postdefault invalid_p print garbage_at_eol\"\n \n@@ -1203,7 +1187,7 @@ EOF\n #\n # The .log file\n #\n-exec > new-gdbarch.log\n+exec > gdbarch.log\n function_list | while do_read\n do\n     cat <<EOF\n@@ -1239,7 +1223,6 @@ EOF\n done\n \n exec 1>&2\n-compare_new gdbarch.log\n \n \n copyright ()\n@@ -1267,17 +1250,7 @@ cat <<EOF\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n \n-/* This file was created with the aid of \\`\\`gdbarch.sh''.\n-\n-   The Bourne shell script \\`\\`gdbarch.sh'' creates the files\n-   \\`\\`new-gdbarch.c'' and \\`\\`new-gdbarch.h and then compares them\n-   against the existing \\`\\`gdbarch.[hc]''.  Any differences found\n-   being reported.\n-\n-   If editing this file, please also run gdbarch.sh and merge any\n-   changes into that script. Conversely, when making sweeping changes\n-   to this file, modifying gdbarch.sh and using its output may prove\n-   easier.  */\n+/* This file was created with the aid of \\`\\`gdbarch.sh''.  */\n \n EOF\n }\n@@ -1695,8 +1668,8 @@ gdbarch_num_cooked_regs (gdbarch *arch)\n #endif\n EOF\n exec 1>&2\n-#../move-if-change new-gdbarch.h gdbarch.h\n-compare_new gdbarch.h\n+../move-if-change new-gdbarch.h gdbarch.h\n+rm -f new-gdbarch.h\n \n \n #\n@@ -2605,5 +2578,5 @@ EOF\n \n # close things off\n exec 1>&2\n-#../move-if-change new-gdbarch.c gdbarch.c\n-compare_new gdbarch.c\n+../move-if-change new-gdbarch.c gdbarch.c\n+rm -f new-gdbarch.c"
    }
  ]
}