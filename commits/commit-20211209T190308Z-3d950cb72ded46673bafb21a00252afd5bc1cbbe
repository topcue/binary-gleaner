{
  "sha": "3d950cb72ded46673bafb21a00252afd5bc1cbbe",
  "node_id": "C_kwDOANOeidoAKDNkOTUwY2I3MmRlZDQ2NjczYmFmYjIxYTAwMjUyYWZkNWJjMWNiYmU",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-12-08T02:56:48Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-12-09T19:03:08Z"
    },
    "message": "gdb/testsuite: fix default behavior of runto\n\nThe documented behavior of proc runto is to not emit a PASS when\nsucceeding to to run to the specified location, but emit a FAIL when\nfailing to do so.  I suppose the intent is that it won't pollute the\nresults normally passing tests (although I don't see why we would care),\nbut make visible any problems.\n\nHowever, it seems like the implementation makes it default to never\nprint anything.  \"no-message\" is prependend to \"args\", so if \"message\"\nis not passed, we will always take the   path that sets print_fail to 0,\nwhich will silence any failure.\n\nThis unfortunately means that tests relying on runto_main won't emit a\nFAIL if failing to run to main.  And since commit 4dfef5be6812\n(\"gdb/testsuite: make runto_main not pass no-message to runto\"), tests\ndon't emit a FAIL themselves when failing to run to main.  This means\nthat tests failing to run to main just fail silently, and that's bad.\n\nThis can be reproduced by hacking gdb.base/template.exp like so:\n\n    diff --git a/gdb/testsuite/gdb.base/template.c b/gdb/testsuite/gdb.base/template.c\n    index bcf39c377d92..052be5b79d73 100644\n    --- a/gdb/testsuite/gdb.base/template.c\n    +++ b/gdb/testsuite/gdb.base/template.c\n    @@ -15,6 +15,14 @@\n        You should have received a copy of the GNU General Public License\n        along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n\n    +#include <stdlib.h>\n    +\n    +__attribute__((constructor))\n    +static void c (void)\n    +{\n    +  exit (1);\n    +}\n    +\n     int\n     main (void)\n     {\n\nRunning the modified gdb.base/template.exp shows that it exits without\nprinting any result.\n\nRemove the line that prepends no-message to args, that should make\nrunto's behavior match its documentation.\n\nThis patch will appear to add many failures, but in reality they already\nexisted, they were just silenced.\n\nChange-Id: I2a730d5bc72b6ef0698cd6aad962d9902aa7c3d6",
    "tree": {
      "sha": "f34a7498cce2eef826ce4df25dfa26de42093e4a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f34a7498cce2eef826ce4df25dfa26de42093e4a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3d950cb72ded46673bafb21a00252afd5bc1cbbe",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3d950cb72ded46673bafb21a00252afd5bc1cbbe",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3d950cb72ded46673bafb21a00252afd5bc1cbbe",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3d950cb72ded46673bafb21a00252afd5bc1cbbe/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ab7baf103d2fb381361da3257b971a372a449f50",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab7baf103d2fb381361da3257b971a372a449f50",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ab7baf103d2fb381361da3257b971a372a449f50"
    }
  ],
  "stats": {
    "total": 5,
    "additions": 1,
    "deletions": 4
  },
  "files": [
    {
      "sha": "95220f6fc8d46ea3235d960fdaf3859edabaa76e",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 4,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3d950cb72ded46673bafb21a00252afd5bc1cbbe/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3d950cb72ded46673bafb21a00252afd5bc1cbbe/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=3d950cb72ded46673bafb21a00252afd5bc1cbbe",
      "patch": "@@ -616,7 +616,7 @@ proc gdb_breakpoint { function args } {\n #\n # If there are additional arguments, pass them to gdb_breakpoint.\n # We recognize no-message/message ourselves.\n-# The default is no-message.\n+#\n # no-message is messed up here, like gdb_breakpoint: to preserve\n # historical usage fails are always printed by default.\n # no-message: turns off printing of fails (and passes, but they're already off)\n@@ -628,9 +628,6 @@ proc runto { function args } {\n \n     delete_breakpoints\n \n-    # Default to \"no-message\".\n-    set args \"no-message $args\"\n-\n     set print_pass 0\n     set print_fail 1\n     set no_message_loc [lsearch -exact $args no-message]"
    }
  ]
}