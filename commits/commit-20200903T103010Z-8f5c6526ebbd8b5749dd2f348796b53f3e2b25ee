{
  "sha": "8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGY1YzY1MjZlYmJkOGI1NzQ5ZGQyZjM0ODc5NmI1M2YzZTJiMjVlZQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-09-03T10:30:10Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-09-03T10:30:10Z"
    },
    "message": "[gdb/breakpoint, PIE] Handle setting breakpoint on label without address\n\nWhen adding:\n...\nif ![runto_main] then {\n    fail \"can't run to main\"\n    return 0\n}\n...\nto test-case gdb.base/label-without-address.exp and running it with target\nboard unix/-fPIE/-pie, we run into:\n...\n(gdb) break main:L1^M\nBreakpoint 2 at 0x555555554000: file label-without-address.c, line 22.^M\n...\nThat is, for a label with optimized-out address, we set a breakpoint at the\nrelocation base.\n\nThe root cause is that the dwarf reader, despite finding that attribute\nDW_AT_low_pc is missing, still tags the L1 symbol as having LOC_LABEL, which\nmeans it has a valid address, which defaults to 0.\n\nFix this by instead tagging the L1 symbol with LOC_OPTIMIZED_OUT.\n\nTested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2020-09-03  Tom de Vries  <tdevries@suse.de>\n\n\tPR breakpoint/26546\n\t* dwarf2/read.c (new_symbol): Tag label symbol without DW_AT_low_pc as\n\tLOC_OPTIMIZED_OUT instead of LOC_LABEL.\n\ngdb/testsuite/ChangeLog:\n\n2020-09-03  Tom de Vries  <tdevries@suse.de>\n\n\tPR breakpoint/26546\n\t* gdb.base/label-without-address.exp: Runto main first.",
    "tree": {
      "sha": "bc5dad38b60871dccc205aa07d9e929a73946c6d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/bc5dad38b60871dccc205aa07d9e929a73946c6d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9184ef8a92371746d0f36580adf2ad6845f1ced3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9184ef8a92371746d0f36580adf2ad6845f1ced3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9184ef8a92371746d0f36580adf2ad6845f1ced3"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 19,
    "deletions": 1
  },
  "files": [
    {
      "sha": "ca251b27b42f7763e52a51c6fbfd41e5e1d9ce53",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
      "patch": "@@ -1,3 +1,9 @@\n+2020-09-03  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR breakpoint/26546\n+\t* dwarf2/read.c (new_symbol): Tag label symbol without DW_AT_low_pc as\n+\tLOC_OPTIMIZED_OUT instead of LOC_LABEL.\n+\n 2020-09-02  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* maint.c (index_digits): New function."
    },
    {
      "sha": "865f9e2118ba26075479eafb1f8bfe24a327c924",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
      "patch": "@@ -21447,10 +21447,12 @@ new_symbol (struct die_info *die, struct type *type, struct dwarf2_cu *cu,\n \t      addr = attr->value_as_address ();\n \t      addr = gdbarch_adjust_dwarf2_addr (gdbarch, addr + baseaddr);\n \t      SET_SYMBOL_VALUE_ADDRESS (sym, addr);\n+\t      SYMBOL_ACLASS_INDEX (sym) = LOC_LABEL;\n \t    }\n+\t  else\n+\t    SYMBOL_ACLASS_INDEX (sym) = LOC_OPTIMIZED_OUT;\n \t  SYMBOL_TYPE (sym) = objfile_type (objfile)->builtin_core_addr;\n \t  SYMBOL_DOMAIN (sym) = LABEL_DOMAIN;\n-\t  SYMBOL_ACLASS_INDEX (sym) = LOC_LABEL;\n \t  add_symbol_to_list (sym, cu->list_in_scope);\n \t  break;\n \tcase DW_TAG_subprogram:"
    },
    {
      "sha": "8fd4e8c5e46591a61e52d6e1b76cfc3c89d0abf4",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
      "patch": "@@ -1,3 +1,8 @@\n+2020-09-03  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR breakpoint/26546\n+\t* gdb.base/label-without-address.exp: Runto main first.\n+\n 2020-09-02  Tom Tromey  <tromey@adacore.com>\n \n \t* gdb.ada/mi_var_access.exp: Test children of access variable."
    },
    {
      "sha": "c688149cf3815b591e2417ede9af57deb9c74d0a",
      "filename": "gdb/testsuite/gdb.base/label-without-address.exp",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/testsuite/gdb.base/label-without-address.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee/gdb/testsuite/gdb.base/label-without-address.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/label-without-address.exp?ref=8f5c6526ebbd8b5749dd2f348796b53f3e2b25ee",
      "patch": "@@ -19,6 +19,11 @@ if {[prepare_for_testing \"failed to prepare\" $testfile $srcfile debug]} {\n     return -1\n }\n \n+if ![runto_main] then {\n+    fail \"can't run to main\"\n+    return 0\n+}\n+\n set supported 0\n gdb_test_multiple \"l main:L1\" \"\" {\n     -wrap -re \"No label \\\"L1\\\" defined in function \\\"main\\\"\\.\" {"
    }
  ]
}