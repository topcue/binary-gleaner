{
  "sha": "b2c7007bddb0df76006f41025117596b0c613760",
  "node_id": "C_kwDOANOeidoAKGIyYzcwMDdiZGRiMGRmNzYwMDZmNDEwMjUxMTc1OTZiMGM2MTM3NjA",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-12-14T19:35:03Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-12-14T19:35:03Z"
    },
    "message": "gdbserver/tracepoint.cc: work around -Wstringop-truncation error\n\nWhen building gdb with  on AArch64 with g++ 11.1.0 (and some preceding\nversions too), -O2 and -fsanitize=address, I get this error.\n\n      CXX    tracepoint-ipa.o\n    cc1plus: warning: command-line option \u2018-Wmissing-prototypes\u2019 is valid for C/ObjC but not for C++\n    In file included from /usr/include/string.h:519,\n                     from ../gnulib/import/string.h:41,\n                     from /home/simark/src/binutils-gdb/gdbserver/../gdbsupport/common-defs.h:95,\n                     from /home/simark/src/binutils-gdb/gdbserver/server.h:22,\n                     from /home/simark/src/binutils-gdb/gdbserver/tracepoint.cc:19:\n    In function \u2018char* strncpy(char*, const char*, size_t)\u2019,\n        inlined from \u2018int init_named_socket(const char*)\u2019 at /home/simark/src/binutils-gdb/gdbserver/tracepoint.cc:6902:11,\n        inlined from \u2018int gdb_agent_socket_init()\u2019 at /home/simark/src/binutils-gdb/gdbserver/tracepoint.cc:6953:26,\n        inlined from \u2018void* gdb_agent_helper_thread(void*)\u2019 at /home/simark/src/binutils-gdb/gdbserver/tracepoint.cc:7204:41:\n    /usr/include/bits/string_fortified.h:95:34: error: \u2018char* __builtin_strncpy(char*, const char*, long unsigned int)\u2019 output may be truncated copying 107 bytes from a string of length 107 [-Werror=stringop-truncation]\n       95 |   return __builtin___strncpy_chk (__dest, __src, __len,\n          |          ~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~\n       96 |                                   __glibc_objsize (__dest));\n          |                                   ~~~~~~~~~~~~~~~~~~~~~~~~~\n\nNote that _FORTIFY_SOURCE changes the message a bit, but I get a similar\nerror if I use -D_FORTIFY_SOURCE=0.\n\nI am pretty sure it's spurious and might be related to this GCC bug:\n\n  https://gcc.gnu.org/bugzilla/show_bug.cgi?id=88780\n\nFrom what I can see, we are copying from a static 108 bytes long buffer\n(the global array agent_socket_name) to a 108 bytes long array,\nsockaddr_un::sun_path.  I don't see anything wrong.\n\nStill, it would make things easier if we didn't see this error.  Change\nthe code to check that the source string length is smaller than the\ndestination buffer (including space for the NULL byte) and use strcpy.\n\nFor anybody who would like to try to reproduce, the full command line\nis:\n\n    g++     -I. -I/home/simark/src/binutils-gdb/gdbserver -I/home/simark/src/binutils-gdb/gdbserver/../gdb/regformats -I/home/simark/src/binutils-gdb/gdbserver/.. -I/home/simark/src/binutils-gdb/gdbserver/../include -I/home/simark/src/binutils-gdb/gdbserver/../gdb -I/home/simark/src/binutils-gdb/gdbserver/../gnulib/import -I../gnulib/import -I/home/simark/src/binutils-gdb/gdbserver/.. -I..   -pthread -Wall -Wpointer-arith -Wno-unused -Wunused-value -Wunused-variable -Wunused-function -Wno-switch -Wno-char-subscripts -Wempty-body -Wunused-but-set-parameter -Wunused-but-set-variable -Wno-sign-compare -Wno-error=maybe-uninitialized -Wno-mismatched-tags -Wsuggest-override -Wimplicit-fallthrough=3 -Wduplicated-cond -Wshadow=local -Wdeprecated-copy -Wdeprecated-copy-dtor -Wredundant-move -Wmissing-declarations -Wmissing-prototypes -Wstrict-null-sentinel -Wformat -Wformat-nonliteral -Werror -DGDBSERVER  -DCONFIG_UST_GDB_INTEGRATION -Drpl_strerror_r=strerror_r -Drpl_free=free -fPIC -DIN_PROCESS_AGENT -fvisibility=hidden -g3 -O2 -fsanitize=address   -c -o tracepoint-ipa.o -MT tracepoint-ipa.o -MMD -MP -MF ./.deps/tracepoint-ipa.Tpo /home/simark/src/binutils-gdb/gdbserver/tracepoint.cc\n\nChange-Id: I18e86c0487feead7e7677e69398405e7057cf464",
    "tree": {
      "sha": "d1da4e2828c4f03440c249451595cb46ab7165c3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d1da4e2828c4f03440c249451595cb46ab7165c3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b2c7007bddb0df76006f41025117596b0c613760",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b2c7007bddb0df76006f41025117596b0c613760",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b2c7007bddb0df76006f41025117596b0c613760",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b2c7007bddb0df76006f41025117596b0c613760/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9bc8e54b1f1c281c7a4ecf49a4e9300e334beb0a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9bc8e54b1f1c281c7a4ecf49a4e9300e334beb0a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9bc8e54b1f1c281c7a4ecf49a4e9300e334beb0a"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 7,
    "deletions": 2
  },
  "files": [
    {
      "sha": "a62d9a7233ce2cd521696402199e0627866ca494",
      "filename": "gdbserver/tracepoint.cc",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2c7007bddb0df76006f41025117596b0c613760/gdbserver/tracepoint.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2c7007bddb0df76006f41025117596b0c613760/gdbserver/tracepoint.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/tracepoint.cc?ref=b2c7007bddb0df76006f41025117596b0c613760",
      "patch": "@@ -6895,8 +6895,13 @@ init_named_socket (const char *name)\n \n   addr.sun_family = AF_UNIX;\n \n-  strncpy (addr.sun_path, name, UNIX_PATH_MAX);\n-  addr.sun_path[UNIX_PATH_MAX - 1] = '\\0';\n+  if (strlen (name) >= ARRAY_SIZE (addr.sun_path))\n+    {\n+      warning (\"socket name too long for sockaddr_un::sun_path field: %s\", name);\n+      return -1;\n+    }\n+\n+  strcpy (addr.sun_path, name);\n \n   result = access (name, F_OK);\n   if (result == 0)"
    }
  ]
}