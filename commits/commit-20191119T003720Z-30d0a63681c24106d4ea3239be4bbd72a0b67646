{
  "sha": "30d0a63681c24106d4ea3239be4bbd72a0b67646",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzBkMGE2MzY4MWMyNDEwNmQ0ZWEzMjM5YmU0YmJkNzJhMGI2NzY0Ng==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-10-08T09:09:31Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-11-19T00:37:20Z"
    },
    "message": "gdb/testsuite: Introduce skip_ctf_tests guard function\n\nMost versions of GCC in the wild don't support CTF debug format right\nnow, so, rather than attempting to compile the tests and failing each\ntime, this patch introduces a guard function to check if the compiler\nsupports CTF.  If we don't have CTF support then the CTF tests are\nskipped.\n\nThis patch only updates 3 of the 4 CTF tests, the fourth will be\nhandled in the next patch.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.base/ctf-constvars.exp: Skip test if CTF is not supported in\n\tthe compiler.  Clean up header comment a little.\n\t* gdb.base/ctf-ptype.exp: Likewise.\n\t* gdb.base/ctf-whatis.exp: Likewise.\n\t* lib/gdb.exp (skip_ctf_tests): New proc.\n\nChange-Id: I505c11169a9bc9871a31fc0c61e119f92f32cc63",
    "tree": {
      "sha": "27639a84f195ea7a08603dc67f32455ec8cd69db",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/27639a84f195ea7a08603dc67f32455ec8cd69db"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/30d0a63681c24106d4ea3239be4bbd72a0b67646",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/30d0a63681c24106d4ea3239be4bbd72a0b67646",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/30d0a63681c24106d4ea3239be4bbd72a0b67646",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/30d0a63681c24106d4ea3239be4bbd72a0b67646/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "494409bb8a043b259435ad5034c66aa3fee15f52",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/494409bb8a043b259435ad5034c66aa3fee15f52",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/494409bb8a043b259435ad5034c66aa3fee15f52"
    }
  ],
  "stats": {
    "total": 62,
    "additions": 42,
    "deletions": 20
  },
  "files": [
    {
      "sha": "f924966ae782a9edb309c997c55fcc2bfceacf85",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=30d0a63681c24106d4ea3239be4bbd72a0b67646",
      "patch": "@@ -1,3 +1,11 @@\n+2019-11-19  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.base/ctf-constvars.exp: Skip test if CTF is not supported in\n+\tthe compiler.  Clean up header comment a little.\n+\t* gdb.base/ctf-ptype.exp: Likewise.\n+\t* gdb.base/ctf-whatis.exp: Likewise.\n+\t* lib/gdb.exp (skip_ctf_tests): New proc.\n+\n 2019-11-18  Sergio Durigan Junior  <sergiodj@redhat.com>\n \n \thttps://bugzilla.redhat.com/show_bug.cgi?id=1765117"
    },
    {
      "sha": "fd46d64454094051e0e8310a61e2806d89ed2d3e",
      "filename": "gdb/testsuite/gdb.base/ctf-constvars.exp",
      "status": "modified",
      "additions": 11,
      "deletions": 10,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/gdb.base/ctf-constvars.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/gdb.base/ctf-constvars.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/ctf-constvars.exp?ref=30d0a63681c24106d4ea3239be4bbd72a0b67646",
      "patch": "@@ -18,20 +18,21 @@\n #\n # This file is part of the gdb testsuite\n #\n-# tests for const variables\n-#           const pointers to vars\n-#           pointers to const variables\n-#           const pointers to const vars\n-# with mixed types\n+# Tests for: const variables,\n+#            const pointers to vars\n+#            pointers to const variables\n+#            const pointers to const vars\n+# with mixed types.\n \n-#\n-# test running programs\n-#\n-# -gt generates full-fledged CTF.\n+if [skip_ctf_tests] {\n+    unsupported \"no ctf debug format support\"\n+    return 0\n+}\n \n standard_testfile .c\n-set opts \"additional_flags=-gt\"\n \n+# Using `-gt` generates full-fledged CTF debug information.\n+set opts \"additional_flags=-gt\"\n if { [prepare_for_testing \"failed to prepare\" ${testfile} \\\n \t  [list $srcfile] [list $opts nowarnings]] } {\n     return 0"
    },
    {
      "sha": "68a9662c8971cb7ed098ebce5729e7ecc9de6f79",
      "filename": "gdb/testsuite/gdb.base/ctf-ptype.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 5,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/gdb.base/ctf-ptype.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/gdb.base/ctf-ptype.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/ctf-ptype.exp?ref=30d0a63681c24106d4ea3239be4bbd72a0b67646",
      "patch": "@@ -15,14 +15,15 @@\n \n # This file is a subset of ptype.exp written by Rob Savoye. (rob@cygnus.com)\n \n-#\n-# test running programs\n-#\n-# -gt generates full-fledged CTF.\n+if [skip_ctf_tests] {\n+    unsupported \"no ctf debug format support\"\n+    return 0\n+}\n \n standard_testfile .c\n-set opts \"additional_flags=-gt\"\n \n+# Using `-gt` generates full-fledged CTF debug information.\n+set opts \"additional_flags=-gt\"\n if { [prepare_for_testing \"failed to prepare\" ${testfile} \\\n \t  [list $srcfile] [list $opts nowarnings]] } {\n     return 0"
    },
    {
      "sha": "626aecb87814fc7229b8594ed51931592a22a14d",
      "filename": "gdb/testsuite/gdb.base/ctf-whatis.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 5,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/gdb.base/ctf-whatis.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/gdb.base/ctf-whatis.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/ctf-whatis.exp?ref=30d0a63681c24106d4ea3239be4bbd72a0b67646",
      "patch": "@@ -15,14 +15,15 @@\n \n # This file is a subset of whatis.exp written by Rob Savoye. (rob@cygnus.com)\n \n-#\n-# test running programs\n-#\n-# -gt generates full-fledged CTF.\n+if [skip_ctf_tests] {\n+    unsupported \"no ctf debug format support\"\n+    return 0\n+}\n \n standard_testfile .c\n-set opts \"additional_flags=-gt\"\n \n+# Using `-gt` generates full-fledged CTF debug information.\n+set opts \"additional_flags=-gt\"\n if { [prepare_for_testing \"failed to prepare\" ${testfile} \\\n           [list $srcfile] [list $opts nowarnings]] } {\n     return 0"
    },
    {
      "sha": "828c91dd9e919346385a0cb2e144757133216167",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30d0a63681c24106d4ea3239be4bbd72a0b67646/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=30d0a63681c24106d4ea3239be4bbd72a0b67646",
      "patch": "@@ -6787,5 +6787,16 @@ proc cmp_file_string { file str msg } {\n     }\n }\n \n+# Does the compiler support CTF debug output using '-gt' compiler\n+# flag?  If not then we should skip these tests.\n+\n+gdb_caching_proc skip_ctf_tests {\n+    return ![gdb_can_simple_compile ctfdebug {\n+\tint main () {\n+\t    return 0;\n+\t}\n+    } executable \"additional_flags=-gt\"]\n+}\n+\n # Always load compatibility stuff.\n load_lib future.exp"
    }
  ]
}