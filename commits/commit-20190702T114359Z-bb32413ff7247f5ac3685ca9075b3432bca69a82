{
  "sha": "bb32413ff7247f5ac3685ca9075b3432bca69a82",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmIzMjQxM2ZmNzI0N2Y1YWMzNjg1Y2E5MDc1YjM0MzJiY2E2OWE4Mg==",
  "commit": {
    "author": {
      "name": "Srinath Parvathaneni",
      "email": "srinath.parvathaneni@arm.com",
      "date": "2019-07-02T11:43:59Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2019-07-02T11:43:59Z"
    },
    "message": "Ensure that debug information is retained for ARMv8-M security functions.\n\nConsider a file containing only Armv8-M secure entry functions.\nThis file is compiled and linked with \"-march=armv8-m.main -mfloat-abi=hard\n-mfpu=fpv5-sp-d16 -mcmse -static --specs=rdimon.specs\n-Wl,--section-start,.gnu.sgstubs=0x190000 -ffunction-sections\n-fdata-sections\n-Wl,--gc-sections -g\" options to generate an executable.\n\nThe executable generated does not contain any debug information of these\nsecure entry functions even though it contains secure entry functions in\nthe .text section.  This patch fixes this problem.",
    "tree": {
      "sha": "7080f32670d5b6264ba6953f4cbd05a9240ffd22",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7080f32670d5b6264ba6953f4cbd05a9240ffd22"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bb32413ff7247f5ac3685ca9075b3432bca69a82",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bb32413ff7247f5ac3685ca9075b3432bca69a82",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bb32413ff7247f5ac3685ca9075b3432bca69a82",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bb32413ff7247f5ac3685ca9075b3432bca69a82/comments",
  "author": null,
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "01c1ee4a70478178eb37e46692a02fb846a2f77b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/01c1ee4a70478178eb37e46692a02fb846a2f77b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/01c1ee4a70478178eb37e46692a02fb846a2f77b"
    }
  ],
  "stats": {
    "total": 230,
    "additions": 230,
    "deletions": 0
  },
  "files": [
    {
      "sha": "2d300759f69b5db90fa68cb2071d539e34b8fbb6",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -1,3 +1,9 @@\n+2019-07-02  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n+\n+\t* elf32-arm.c (elf32_arm_gc_mark_extra_sections): Mark debug\n+\tsections when .text section contain secure entry functions\n+\tis marked.\n+\n 2019-07-01  Nick Clifton  <nickc@redhat.com>\n \n \tPR 23839"
    },
    {
      "sha": "fc7a41c8d23daa869d645a11f7d7dac2754da4f2",
      "filename": "bfd/elf32-arm.c",
      "status": "modified",
      "additions": 19,
      "deletions": 0,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/bfd/elf32-arm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/bfd/elf32-arm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-arm.c?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -15903,6 +15903,8 @@ elf32_arm_gc_mark_extra_sections (struct bfd_link_info *info,\n   struct elf_link_hash_entry **sym_hashes;\n   struct elf32_arm_link_hash_entry *cmse_hash;\n   bfd_boolean again, is_v8m, first_bfd_browse = TRUE;\n+  bfd_boolean debug_sec_need_to_be_marked = FALSE;\n+  asection *isec;\n \n   _bfd_elf_gc_mark_extra_sections (info, gc_mark_hook);\n \n@@ -15964,8 +15966,25 @@ elf32_arm_gc_mark_extra_sections (struct bfd_link_info *info,\n \t\t      if (!cmse_sec->gc_mark\n \t\t\t  && !_bfd_elf_gc_mark (info, cmse_sec, gc_mark_hook))\n \t\t\treturn FALSE;\n+\t\t      /* The debug sections related to these secure entry\n+\t\t\t functions are marked on enabling below flag.  */\n+\t\t      debug_sec_need_to_be_marked = TRUE;\n \t\t    }\n \t\t}\n+\n+\t      if (debug_sec_need_to_be_marked)\n+\t\t{\n+\t\t  /* Looping over all the sections of the object file containing\n+\t\t     Armv8-M secure entry functions and marking all the debug\n+\t\t     sections.  */\n+\t\t  for (isec = sub->sections; isec != NULL; isec = isec->next)\n+\t\t    {\n+\t\t      /* If not a debug sections, skip it.  */\n+\t\t      if (!isec->gc_mark && (isec->flags & SEC_DEBUGGING))\n+\t\t\tisec->gc_mark = 1 ;\n+\t\t    }\n+\t\t  debug_sec_need_to_be_marked = FALSE;\n+\t\t}\n \t    }\n \t}\n       first_bfd_browse = FALSE;"
    },
    {
      "sha": "0f0619626d109a220652090d48a71a754f256e3e",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -1,3 +1,10 @@\n+2019-07-02  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n+\n+\t* testsuite/ld-arm/arm-elf.exp: Add tests.\n+\t* testsuite/ld-arm/cmse_main.s: New test.\n+\t* testsuite/ld-arm/cmse_main_sec_debug.d: Likewise.\n+\t* testsuite/ld-arm/cmse_sec_debug.s: Likewise.\n+\n 2019-07-01  Nick Clifton  <nickc@redhat.com>\n \n \tPR 23839"
    },
    {
      "sha": "72036785270a0ce79f314772737b57969b894fc9",
      "filename": "ld/testsuite/ld-arm/arm-elf.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/arm-elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/arm-elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-arm/arm-elf.exp?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -787,6 +787,12 @@ set armeabitests_nonacl {\n      {cmse-implib.s}\n      {{ld cmse-new-wrong-implib.out}}\n      \"cmse-new-wrong-implib\"}\n+    {\"Secure gateway veneers:cmse functions debug information missing\"\n+      \"--section-start .gnu.sgstubs=0x190000 --gc-sections -e0\" \"\"\n+      \"-march=armv8-m.main -mthumb\"\n+      {cmse_main.s cmse_sec_debug.s}\n+      {{objdump --dwarf=info cmse_main_sec_debug.d}}\n+      \"cmse_main_sec_debug\"}\n \n     {\"R_ARM_THM_JUMP19 Relocation veneers: Short\"\n      \"--section-start destsect=0x000108002 --section-start .text=0x8000\" \"\""
    },
    {
      "sha": "5047c02f46ebd0df0f211e8ee5c67e8a81e0d71b",
      "filename": "ld/testsuite/ld-arm/cmse_main.s",
      "status": "added",
      "additions": 21,
      "deletions": 0,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/cmse_main.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/cmse_main.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-arm/cmse_main.s?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -0,0 +1,21 @@\n+\t.arch armv8-m.main\n+\t.file\t\"cmse_main.c\"\n+\t.text\n+.Ltext0:\n+\t.cfi_sections\t.debug_frame\n+\t.section\t.text.main,\"ax\",%progbits\n+\t.align\t1\n+\t.global\tmain\n+\t.arch armv8-m.main\n+\t.syntax unified\n+\t.thumb\n+\t.thumb_func\n+\t.fpu fpv5-sp-d16\n+\t.type\tmain, %function\n+main:\n+.LFB0:\n+\t.file 1 \"cmse_main.c\"\n+\t.loc 1 2 1\n+\t.cfi_startproc\n+\t.cfi_endproc\n+.LFE0:"
    },
    {
      "sha": "61280b769c146ac1005bc19f7c547cb797d4baa2",
      "filename": "ld/testsuite/ld-arm/cmse_main_sec_debug.d",
      "status": "added",
      "additions": 29,
      "deletions": 0,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/cmse_main_sec_debug.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/cmse_main_sec_debug.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-arm/cmse_main_sec_debug.d?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -0,0 +1,29 @@\n+\n+tmpdir/cmse_main_sec_debug:     .*\n+\n+Contents of the \\.debug_info section:\n+\n+  Compilation Unit @ offset 0x0:\n+   Length:        0x34 \\(32-bit\\)\n+   Version:       4\n+   Abbrev Offset: 0x0\n+   Pointer Size:  4\n+ <0><b>: Abbrev Number: 1 \\(DW_TAG_compile_unit\\)\n+    <c>   DW_AT_producer    : \\(indirect string, offset: 0x6\\): GNU C17 10.0.0 20190617\n+    <10>   DW_AT_language    : 12\t\\(ANSI C99\\)\n+    <11>   DW_AT_name        : \\(indirect string, offset: 0x0\\): sec.c\n+    <15>   DW_AT_comp_dir    : \\(indirect string, offset: 0x2b\\): Blinky\n+    <19>   DW_AT_ranges      : 0x0\n+    <1d>   DW_AT_low_pc      : 0x0\n+    <21>   DW_AT_stmt_list   : 0x0\n+ <1><25>: Abbrev Number: 2 \\(DW_TAG_subprogram\\)\n+    <26>   DW_AT_external    : 1\n+    <26>   DW_AT_name        : \\(indirect string, offset: 0x1e\\): SecureLED_On\n+    <2a>   DW_AT_decl_file   : 1\n+    <2b>   DW_AT_decl_line   : 2\n+    <2c>   DW_AT_decl_column : 1\n+    <2d>   DW_AT_low_pc      : 0x8000\n+    <31>   DW_AT_high_pc     : 0xc\n+    <35>   DW_AT_frame_base  : 1 byte block: 9c \t\\(DW_OP_call_frame_cfa\\)\n+    <37>   DW_AT_GNU_all_call_sites: 1\n+ <1><37>: Abbrev Number: 0"
    },
    {
      "sha": "0ca949e3e5e7c23e556ecebf4b76ff4624dfa158",
      "filename": "ld/testsuite/ld-arm/cmse_sec_debug.s",
      "status": "added",
      "additions": 142,
      "deletions": 0,
      "changes": 142,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/cmse_sec_debug.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb32413ff7247f5ac3685ca9075b3432bca69a82/ld/testsuite/ld-arm/cmse_sec_debug.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-arm/cmse_sec_debug.s?ref=bb32413ff7247f5ac3685ca9075b3432bca69a82",
      "patch": "@@ -0,0 +1,142 @@\n+\t.arch armv8-m.main\n+\t.file\t\"sec.c\"\n+\t.text\n+.Ltext0:\n+\t.cfi_sections\t.debug_frame\n+\t.section\t.text.SecureLED_On,\"ax\",%progbits\n+\t.align\t1\n+\t.global\tSecureLED_On\n+\t.global\t__acle_se_SecureLED_On\n+\t.arch armv8-m.main\n+\t.syntax unified\n+\t.thumb\n+\t.thumb_func\n+\t.fpu fpv5-sp-d16\n+\t.type\t__acle_se_SecureLED_On, %function\n+\t.syntax unified\n+\t.thumb\n+\t.thumb_func\n+\t.fpu fpv5-sp-d16\n+\t.type\tSecureLED_On, %function\n+SecureLED_On:\n+__acle_se_SecureLED_On:\n+.LFB0:\n+\t.file 1 \"sec.c\"\n+\t.loc 1 3 1\n+\t.cfi_startproc\n+\tpush\t{r7}\n+\t.cfi_def_cfa_offset 4\n+\t.cfi_offset 7, -4\n+\tadd\tr7, sp, #0\n+\t.cfi_def_cfa_register 7\n+\t.loc 1 4 1\n+\tmov\tsp, r7\n+\t.cfi_def_cfa_register 13\n+\tldr\tr7, [sp], #4\n+\t.cfi_restore 7\n+\t.cfi_def_cfa_offset 0\n+\tbxns\tlr\n+\t.cfi_endproc\n+.LFE0:\n+\t.size\tSecureLED_On, .-SecureLED_On\n+\t.text\n+.Letext0:\n+\t.section\t.debug_info,\"\",%progbits\n+.Ldebug_info0:\n+\t.4byte\t0x34\n+\t.2byte\t0x4\n+\t.4byte\t.Ldebug_abbrev0\n+\t.byte\t0x4\n+\t.uleb128 0x1\n+\t.4byte\t.LASF0\n+\t.byte\t0xc\n+\t.4byte\t.LASF1\n+\t.4byte\t.LASF2\n+\t.4byte\t.Ldebug_ranges0+0\n+\t.4byte\t0\n+\t.4byte\t.Ldebug_line0\n+\t.uleb128 0x2\n+\t.4byte\t.LASF3\n+\t.byte\t0x1\n+\t.byte\t0x2\n+\t.byte\t0x1\n+\t.4byte\t.LFB0\n+\t.4byte\t.LFE0-.LFB0\n+\t.uleb128 0x1\n+\t.byte\t0x9c\n+\t.byte\t0\n+\t.section\t.debug_abbrev,\"\",%progbits\n+.Ldebug_abbrev0:\n+\t.uleb128 0x1\n+\t.uleb128 0x11\n+\t.byte\t0x1\n+\t.uleb128 0x25\n+\t.uleb128 0xe\n+\t.uleb128 0x13\n+\t.uleb128 0xb\n+\t.uleb128 0x3\n+\t.uleb128 0xe\n+\t.uleb128 0x1b\n+\t.uleb128 0xe\n+\t.uleb128 0x55\n+\t.uleb128 0x17\n+\t.uleb128 0x11\n+\t.uleb128 0x1\n+\t.uleb128 0x10\n+\t.uleb128 0x17\n+\t.byte\t0\n+\t.byte\t0\n+\t.uleb128 0x2\n+\t.uleb128 0x2e\n+\t.byte\t0\n+\t.uleb128 0x3f\n+\t.uleb128 0x19\n+\t.uleb128 0x3\n+\t.uleb128 0xe\n+\t.uleb128 0x3a\n+\t.uleb128 0xb\n+\t.uleb128 0x3b\n+\t.uleb128 0xb\n+\t.uleb128 0x39\n+\t.uleb128 0xb\n+\t.uleb128 0x11\n+\t.uleb128 0x1\n+\t.uleb128 0x12\n+\t.uleb128 0x6\n+\t.uleb128 0x40\n+\t.uleb128 0x18\n+\t.uleb128 0x2117\n+\t.uleb128 0x19\n+\t.byte\t0\n+\t.byte\t0\n+\t.byte\t0\n+\t.section\t.debug_aranges,\"\",%progbits\n+\t.4byte\t0x1c\n+\t.2byte\t0x2\n+\t.4byte\t.Ldebug_info0\n+\t.byte\t0x4\n+\t.byte\t0\n+\t.2byte\t0\n+\t.2byte\t0\n+\t.4byte\t.LFB0\n+\t.4byte\t.LFE0-.LFB0\n+\t.4byte\t0\n+\t.4byte\t0\n+\t.section\t.debug_ranges,\"\",%progbits\n+.Ldebug_ranges0:\n+\t.4byte\t.LFB0\n+\t.4byte\t.LFE0\n+\t.4byte\t0\n+\t.4byte\t0\n+\t.section\t.debug_line,\"\",%progbits\n+.Ldebug_line0:\n+\t.section\t.debug_str,\"MS\",%progbits,1\n+.LASF1:\n+\t.ascii\t\"sec.c\\000\"\n+.LASF0:\n+\t.ascii\t\"GNU C17 10.0.0 20190617\\000\"\n+.LASF3:\n+\t.ascii\t\"SecureLED_On\\000\"\n+.LASF2:\n+\t.ascii\t\"Blinky\\000\"\n+\t.ident\t\"GCC: (GNU) 10.0.0 20190617 (experimental)\""
    }
  ]
}