{
  "sha": "3945d2d77e373c828ebbbb05b3ba06adf39019ab",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Mzk0NWQyZDc3ZTM3M2M4MjhlYmJiYjA1YjNiYTA2YWRmMzkwMTlhYg==",
  "commit": {
    "author": {
      "name": "Gaius Mulley",
      "email": "gaiusmod2@gmail.com",
      "date": "2020-08-25T08:39:27Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-08-25T09:28:06Z"
    },
    "message": "gdb/modula-2: parsing of multi-subscript arrays\n\nFix bug PR m2/26372, GDB's inability to parse multi-dimensional\nmodula-2 arrays.\n\nWe previously had two rules for handling the parsing of array\nsub-scripts.  I have reproduced them here with the actual handler\nblocks removed to make the bug clearer:\n\n  exp     :    exp '[' non_empty_arglist ']'\n          ;\n\n  exp     :    exp '[' exp ']'\n          ;\n\n  non_empty_arglist\n          :       exp\n          ;\n\n  non_empty_arglist\n          :       non_empty_arglist ',' exp\n          ;\n\nThis is ambiguous as the pattern \"exp '[' exp\" could match either of\nthe 'exp' rules.  Currently it just so happens that the parser picks\nthe second 'exp' rule which means we can only handle a single array\nindex.\n\nAs the handler code for the first 'exp' pattern will correctly handle\nand number of array indexes then lets just remove the second pattern.\n\ngdb/ChangeLog:\n\n\tPR m2/26372\n        * m2-exp.y (exp): Improve comment for non_empty_arglist case, add\n\tan assert.  Remove single element array indexing pattern as the\n\tMULTI_SUBSCRIPT support will handle this case too.\n\ngdb/testsuite/ChangeLog:\n\n\tPR m2/26372\n        * gdb.modula2/multidim.c: New file.\n        * gdb.modula2/multidim.exp: New file.",
    "tree": {
      "sha": "99bf6cac80354c51f7d533e4cfb972b6a7a39692",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/99bf6cac80354c51f7d533e4cfb972b6a7a39692"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3945d2d77e373c828ebbbb05b3ba06adf39019ab",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3945d2d77e373c828ebbbb05b3ba06adf39019ab",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3945d2d77e373c828ebbbb05b3ba06adf39019ab",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3945d2d77e373c828ebbbb05b3ba06adf39019ab/comments",
  "author": null,
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "419cca029e5d4b9b648402f9da3c38f302ca7b0a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/419cca029e5d4b9b648402f9da3c38f302ca7b0a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/419cca029e5d4b9b648402f9da3c38f302ca7b0a"
    }
  ],
  "stats": {
    "total": 103,
    "additions": 96,
    "deletions": 7
  },
  "files": [
    {
      "sha": "4592b84a495a2f4efbc6f6525a917a05009e2bb0",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=3945d2d77e373c828ebbbb05b3ba06adf39019ab",
      "patch": "@@ -1,3 +1,11 @@\n+2020-08-25  Gaius Mulley  <gaiusmod2@gmail.com>\n+\t    Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\tPR m2/26372\n+        * m2-exp.y (exp): Improve comment for non_empty_arglist case, add\n+\tan assert.  Remove single element array indexing pattern as the\n+\tMULTI_SUBSCRIPT support will handle this case too.\n+\n 2020-08-24  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* value.h (valprint_check_validity): Move declaration from"
    },
    {
      "sha": "c79c1f25828b3a0a95b39d0b678ec37adc9a8fc4",
      "filename": "gdb/m2-exp.y",
      "status": "modified",
      "additions": 6,
      "deletions": 7,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/m2-exp.y",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/m2-exp.y",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/m2-exp.y?ref=3945d2d77e373c828ebbbb05b3ba06adf39019ab",
      "patch": "@@ -293,21 +293,20 @@ set\t:\t'{' arglist '}'\n \t;\n \n \n-/* Modula-2 array subscript notation [a,b,c...] */\n+/* Modula-2 array subscript notation [a,b,c...].  */\n exp     :       exp '['\n                         /* This function just saves the number of arguments\n \t\t\t   that follow in the list.  It is *not* specific to\n \t\t\t   function types */\n                         { pstate->start_arglist(); }\n                 non_empty_arglist ']'  %prec DOT\n-                        { write_exp_elt_opcode (pstate, MULTI_SUBSCRIPT);\n+\t\t\t{\n+\t\t\t  gdb_assert (pstate->arglist_len > 0);\n+\t\t\t  write_exp_elt_opcode (pstate, MULTI_SUBSCRIPT);\n \t\t\t  write_exp_elt_longcst (pstate,\n \t\t\t\t\t\t pstate->end_arglist());\n-\t\t\t  write_exp_elt_opcode (pstate, MULTI_SUBSCRIPT); }\n-        ;\n-\n-exp\t:\texp '[' exp ']'\n-\t\t\t{ write_exp_elt_opcode (pstate, BINOP_SUBSCRIPT); }\n+\t\t\t  write_exp_elt_opcode (pstate, MULTI_SUBSCRIPT);\n+\t\t\t}\n \t;\n \n exp\t:\texp '('"
    },
    {
      "sha": "f5c258b432c04f78a065ce8dd6f28b1eddc4ccfc",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=3945d2d77e373c828ebbbb05b3ba06adf39019ab",
      "patch": "@@ -1,3 +1,9 @@\n+2020-08-25  Gaius Mulley  <gaiusmod2@gmail.com>\n+\n+\tPR m2/26372\n+        * gdb.modula2/multidim.c: New file.\n+        * gdb.modula2/multidim.exp: New file.\n+\n 2020-08-24  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* lib/gdb.exp (runto): Always emit fail on internal error."
    },
    {
      "sha": "b0ce84886817da4952ab0ca5671453c914a737d3",
      "filename": "gdb/testsuite/gdb.modula2/multidim.c",
      "status": "added",
      "additions": 39,
      "deletions": 0,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/testsuite/gdb.modula2/multidim.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/testsuite/gdb.modula2/multidim.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.modula2/multidim.c?ref=3945d2d77e373c828ebbbb05b3ba06adf39019ab",
      "patch": "@@ -0,0 +1,39 @@\n+/* This test script is part of GDB, the GNU debugger.\n+\n+   Copyright 2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+\n+static int a[10][20];\n+\n+static void\n+here (void)\n+{\n+}\n+\n+int\n+main ()\n+{\n+  int i, j;\n+  int count = 0;\n+\n+  for (i = 0; i < 10; i++)\n+    for (j = 0; j < 20; j++)\n+      {\n+\ta[i][j] = count;\n+\tcount += 1;\n+      }\n+  here ();\n+}"
    },
    {
      "sha": "ccccaa2598193d26aaa3044ca63fadc363522341",
      "filename": "gdb/testsuite/gdb.modula2/multidim.exp",
      "status": "added",
      "additions": 37,
      "deletions": 0,
      "changes": 37,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/testsuite/gdb.modula2/multidim.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3945d2d77e373c828ebbbb05b3ba06adf39019ab/gdb/testsuite/gdb.modula2/multidim.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.modula2/multidim.exp?ref=3945d2d77e373c828ebbbb05b3ba06adf39019ab",
      "patch": "@@ -0,0 +1,37 @@\n+# Copyright 2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# This file is part of the gdb testsuite.  It contains tests for printing\n+# the elements of an unbounded array using the Modula-2 language mode of\n+# gdb.\n+\n+standard_testfile multidim.c\n+\n+if {[prepare_for_testing \"failed to prepare\" $testfile $srcfile \\\n+\t {debug quiet}]} {\n+    return -1\n+}\n+\n+if ![runto here] then {\n+    perror \"couldn't run to breakpoint 'here'\"\n+    continue\n+}\n+\n+gdb_test \"set lang modula-2\" \".*does not match.*\" \"switch to modula-2\"\n+\n+gdb_test \"print a\\[1,2\\]\" \".*= 22.*\" \"second row third column\"\n+gdb_test \"print a\\[2,1\\]\" \".*= 41.*\" \"fifth row second column\"\n+gdb_test \"print a\\[a\\[0,1\\],a\\[0,2\\]\\]\" \".*= 22.*\" \\\n+    \"second row third column again\""
    }
  ]
}