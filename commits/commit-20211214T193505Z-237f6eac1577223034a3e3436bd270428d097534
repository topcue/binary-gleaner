{
  "sha": "237f6eac1577223034a3e3436bd270428d097534",
  "node_id": "C_kwDOANOeidoAKDIzN2Y2ZWFjMTU3NzIyMzAzNGEzZTM0MzZiZDI3MDQyOGQwOTc1MzQ",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-12-14T19:34:57Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-12-14T19:35:05Z"
    },
    "message": "gdbserver/tracepoint.cc: use snprintf in gdb_agent_socket_init\n\nIf we modify tracepoint.cc to try to use a too long unix socket name,\nfor example by modifying SOCK_DIR to be:\n\n    #define SOCK_DIR \"/tmp/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut/salut\"\n\n... trying to start an application with libinproctrace.so loaded\ncrashes:\n\n    $ LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libasan.so.6:./libinproctrace.so /bin/ls\n    /home/smarchi/src/binutils-gdb/gdbserver/../gdbsupport/common-utils.cc:69: A problem internal to GDBserver in-process agent has been detected.\n    xsnprintf: Assertion `ret < size' failed.\n\nLooking at the rest of the socket initialization code, the intent seems\nto be that if something goes wrong, we warn but let the program\nexecute.  So crashing on this failed assertions seems against the intent.\n\nCommit 6cebaf6e1ae4 (\"use xsnprintf instead of snprintf.\") changed this\ncode to use xsnprintf instead of snprintf, introducing this assertion.\nBefore that, snprintf would return a value bigger that UNIX_PATH_MAX and\nthe \"if\" after would catch it and emit a warning, which is exactly what\nwe want.  That change was done because LynxOS didn't have snprintf.\nSince LynxOS isn't supported anymore, we can simply revert to use\nsnprintf there.\n\nWith this patch, we get a warning (printed by the caller of\ngdb_agent_socket_init), but the program keeps executing:\n\n    $ LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libasan.so.6:./libinproctrace.so /bin/ls\n    ipa: could not create sync socket\n    ...\n\nChange-Id: I78bca52d5dc3145335abeae45a42052701e3f5dd",
    "tree": {
      "sha": "fe2ce6d27aa2c9ed58b90c40be9c6f72bd98633d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fe2ce6d27aa2c9ed58b90c40be9c6f72bd98633d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/237f6eac1577223034a3e3436bd270428d097534",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/237f6eac1577223034a3e3436bd270428d097534",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/237f6eac1577223034a3e3436bd270428d097534",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/237f6eac1577223034a3e3436bd270428d097534/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b2c7007bddb0df76006f41025117596b0c613760",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b2c7007bddb0df76006f41025117596b0c613760",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b2c7007bddb0df76006f41025117596b0c613760"
    }
  ],
  "stats": {
    "total": 4,
    "additions": 2,
    "deletions": 2
  },
  "files": [
    {
      "sha": "97d8fa5877f13862e20fe0205e25c5c1b128508f",
      "filename": "gdbserver/tracepoint.cc",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/237f6eac1577223034a3e3436bd270428d097534/gdbserver/tracepoint.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/237f6eac1577223034a3e3436bd270428d097534/gdbserver/tracepoint.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/tracepoint.cc?ref=237f6eac1577223034a3e3436bd270428d097534",
      "patch": "@@ -6943,8 +6943,8 @@ gdb_agent_socket_init (void)\n {\n   int result, fd;\n \n-  result = xsnprintf (agent_socket_name, UNIX_PATH_MAX, \"%s/gdb_ust%d\",\n-\t\t      SOCK_DIR, getpid ());\n+  result = snprintf (agent_socket_name, UNIX_PATH_MAX, \"%s/gdb_ust%d\",\n+\t\t     SOCK_DIR, getpid ());\n   if (result >= UNIX_PATH_MAX)\n     {\n       trace_debug (\"string overflow allocating socket name\");"
    }
  ]
}