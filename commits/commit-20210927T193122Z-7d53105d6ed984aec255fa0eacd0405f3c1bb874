{
  "sha": "7d53105d6ed984aec255fa0eacd0405f3c1bb874",
  "node_id": "C_kwDOANOeidoAKDdkNTMxMDVkNmVkOTg0YWVjMjU1ZmEwZWFjZDA0MDVmM2MxYmI4NzQ",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-09-27T19:31:21Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-09-27T19:31:22Z"
    },
    "message": "libctf: link against libiberty before linking in libbfd or libctf-nobfd\n\nThis ensures that the CTF_LIBADD, which always contains at least this\nwhen doing a shared link:\n\n-L`pwd`/../libiberty/pic -liberty\n\nappears in the link line before any requirements pulled in by libbfd.la,\nwhich include -liberty but because it is install-time do not include the\n-L`pwd`/../libiberty/pic portion (in an indirect dep like this, the path\ncomes from the libbfd.la file, and is an install path).  libiberty also\nappears after libbfd in the link line by virtue of libctf-nobfd.la,\nbecause libctf-nobfd has to follow libbfd in the link line, and that\nneeds symbols from libiberty too.\n\nWithout this, an installed liberty might well be pulled in by libbfd,\nand if --enable-install-libiberty is not specified this libiberty might\nbe completely incompatible with what is being installed and break either\nor boht of libbfd and libctf. (The specific problem observed here is\nthat bsearch_r was not present, but other problems might easily be\nobserved in future too.)\n\nBecause ld links against libctf, this has a tendency to break the system\nlinker at install time too, if installing with --prefix=/usr.  That's\nquite unpleasant to recover from.\n\nlibctf/ChangeLog\n2021-09-27  Nick Alcock  <nick.alcock@oracle.com>\n\n\tPR libctf/27360\n\t* Makefile.am (libctf_la_LIBADD): Link against libiberty\n\tbefore pulling in libbfd.la or pulling in libctf-nobfd.la.\n\t* Makefile.in: Regenerate.",
    "tree": {
      "sha": "b5de7c5ab7f38dec4586a73b5f0a91c507a00c3e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b5de7c5ab7f38dec4586a73b5f0a91c507a00c3e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7d53105d6ed984aec255fa0eacd0405f3c1bb874",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7d53105d6ed984aec255fa0eacd0405f3c1bb874",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7d53105d6ed984aec255fa0eacd0405f3c1bb874",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7d53105d6ed984aec255fa0eacd0405f3c1bb874/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7f92ed6b41c441ab2111c9f1212cbbc13222edcc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7f92ed6b41c441ab2111c9f1212cbbc13222edcc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7f92ed6b41c441ab2111c9f1212cbbc13222edcc"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 18,
    "deletions": 2
  },
  "files": [
    {
      "sha": "da361e4450d530f3306746fc9190f5f37941889c",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d53105d6ed984aec255fa0eacd0405f3c1bb874/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d53105d6ed984aec255fa0eacd0405f3c1bb874/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=7d53105d6ed984aec255fa0eacd0405f3c1bb874",
      "patch": "@@ -1,3 +1,10 @@\n+2021-09-27  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\tPR libctf/27360\n+\t* Makefile.am (libctf_la_LIBADD): Link against libiberty\n+\tbefore pulling in libbfd.la or pulling in libctf-nobfd.la.\n+\t* Makefile.in: Regenerate.\n+\n 2021-07-03  Nick Clifton  <nickc@redhat.com>\n \n \t* 2.37 release branch created."
    },
    {
      "sha": "970b66dc6081af831ad4107111e26a21b6522bfd",
      "filename": "libctf/Makefile.am",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d53105d6ed984aec255fa0eacd0405f3c1bb874/libctf/Makefile.am",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d53105d6ed984aec255fa0eacd0405f3c1bb874/libctf/Makefile.am",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/Makefile.am?ref=7d53105d6ed984aec255fa0eacd0405f3c1bb874",
      "patch": "@@ -52,7 +52,11 @@ if NEED_CTF_QSORT_R\n libctf_nobfd_la_SOURCES += ctf-qsort_r.c\n endif\n \n-libctf_la_LIBADD = ../bfd/libbfd.la $(libctf_nobfd_la_LIBADD)\n+# @CTF_LIBADD@ appears here twice: once, to force libiberty to get searched before\n+# install-time libbfd adds a -L to the install dir (possibly pointing at an\n+# incompatible libiberty), and once via lictf_nobfd_la_LIBADD so that the\n+# references in there get picked up.\n+libctf_la_LIBADD =  @CTF_LIBADD@ ../bfd/libbfd.la $(libctf_nobfd_la_LIBADD)\n libctf_la_CPPFLAGS = $(AM_CPPFLAGS) -DNOBFD=0\n libctf_la_LDFLAGS = $(libctf_nobfd_la_LDFLAGS)\n libctf_la_SOURCES = $(libctf_nobfd_la_SOURCES) ctf-open-bfd.c"
    },
    {
      "sha": "e8a1443ba2860c0e1d9972e1ef8f898c94a6cc10",
      "filename": "libctf/Makefile.in",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d53105d6ed984aec255fa0eacd0405f3c1bb874/libctf/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d53105d6ed984aec255fa0eacd0405f3c1bb874/libctf/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/Makefile.in?ref=7d53105d6ed984aec255fa0eacd0405f3c1bb874",
      "patch": "@@ -476,7 +476,12 @@ libctf_nobfd_la_SOURCES = ctf-archive.c ctf-dump.c ctf-create.c \\\n \tctf-decl.c ctf-error.c ctf-hash.c ctf-labels.c ctf-dedup.c \\\n \tctf-link.c ctf-lookup.c ctf-open.c ctf-serialize.c ctf-sha1.c \\\n \tctf-string.c ctf-subr.c ctf-types.c ctf-util.c $(am__append_1)\n-libctf_la_LIBADD = ../bfd/libbfd.la $(libctf_nobfd_la_LIBADD)\n+\n+# @CTF_LIBADD@ appears here twice: once, to force libiberty to get searched before\n+# install-time libbfd adds a -L to the install dir (possibly pointing at an\n+# incompatible libiberty), and once via lictf_nobfd_la_LIBADD so that the\n+# references in there get picked up.\n+libctf_la_LIBADD = @CTF_LIBADD@ ../bfd/libbfd.la $(libctf_nobfd_la_LIBADD)\n libctf_la_CPPFLAGS = $(AM_CPPFLAGS) -DNOBFD=0\n libctf_la_LDFLAGS = $(libctf_nobfd_la_LDFLAGS)\n libctf_la_SOURCES = $(libctf_nobfd_la_SOURCES) ctf-open-bfd.c"
    }
  ]
}