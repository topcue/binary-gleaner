{
  "sha": "a5884035977f95b09c28d4bb2276ac4869930e96",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTU4ODQwMzU5NzdmOTViMDljMjhkNGJiMjI3NmFjNDg2OTkzMGU5Ng==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-05-07T04:08:43Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-05-07T04:34:03Z"
    },
    "message": "sim: m32c: switch from custom fgets to getline\n\nNo need to implement this ourselves when POSIX has a nice API.",
    "tree": {
      "sha": "e0effd688b93b263dd881924a635357344c31a23",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e0effd688b93b263dd881924a635357344c31a23"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a5884035977f95b09c28d4bb2276ac4869930e96",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a5884035977f95b09c28d4bb2276ac4869930e96",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a5884035977f95b09c28d4bb2276ac4869930e96",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a5884035977f95b09c28d4bb2276ac4869930e96/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b"
    }
  ],
  "stats": {
    "total": 122,
    "additions": 17,
    "deletions": 105
  },
  "files": [
    {
      "sha": "ad2bece00e266b47d03ae62191b3e79ab7581f18",
      "filename": "sim/m32c/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a5884035977f95b09c28d4bb2276ac4869930e96/sim/m32c/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a5884035977f95b09c28d4bb2276ac4869930e96/sim/m32c/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/ChangeLog?ref=a5884035977f95b09c28d4bb2276ac4869930e96",
      "patch": "@@ -1,3 +1,10 @@\n+2021-05-07  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* Makefile.in: Delete safe-fgets.\n+\t* opc2c.c: Delete safe-fgets.h include.\n+\t(main): Replace safe_fgets with getline.\n+\t* safe-fgets.c, safe-fgets.h: Removed.\n+\n 2021-05-05  Mike Frysinger  <vapier@gentoo.org>\n \n \t* gdb-if.c: Include libiberty.h."
    },
    {
      "sha": "0c101a835cf94f8b2e1b476ff5236cedeb1902e7",
      "filename": "sim/m32c/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 5,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a5884035977f95b09c28d4bb2276ac4869930e96/sim/m32c/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a5884035977f95b09c28d4bb2276ac4869930e96/sim/m32c/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/Makefile.in?ref=a5884035977f95b09c28d4bb2276ac4869930e96",
      "patch": "@@ -56,14 +56,11 @@ m32c.c : m32c.opc opc2c\n \t$(OPC2C) -l m32c.out $(srcdir)/m32c.opc > m32c.c.tmp\n \tmv m32c.c.tmp m32c.c\n \n-opc2c : opc2c.o safe-fgets.o\n+opc2c : opc2c.o\n \t$(LINK_FOR_BUILD) $^\n \n encodings:\n \tgrep '/\\* [01]' $(srcdir)/r8c.opc | sort\n \n-opc2c.o : opc2c.c safe-fgets.h\n+opc2c.o : opc2c.c\n \t$(COMPILE_FOR_BUILD) -c $(srcdir)/opc2c.c\n-\n-safe-fgets.o : safe-fgets.c safe-fgets.h\n-\t$(COMPILE_FOR_BUILD) -c $(srcdir)/safe-fgets.c"
    },
    {
      "sha": "4c976449433b014e83c5a0e2f8518a3455e7c1e1",
      "filename": "sim/m32c/opc2c.c",
      "status": "modified",
      "additions": 8,
      "deletions": 4,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a5884035977f95b09c28d4bb2276ac4869930e96/sim/m32c/opc2c.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a5884035977f95b09c28d4bb2276ac4869930e96/sim/m32c/opc2c.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/opc2c.c?ref=a5884035977f95b09c28d4bb2276ac4869930e96",
      "patch": "@@ -24,8 +24,6 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n #include <ctype.h>\n #include <stdlib.h>\n \n-#include \"safe-fgets.h\"\n-\n static int errors = 0;\n \n #define MAX_BYTES 10\n@@ -504,10 +502,11 @@ log_indirect (Indirect * ind, int byte)\n int\n main (int argc, char **argv)\n {\n-  char *line;\n+  char *linebuf;\n   FILE *in;\n   int lineno = 0;\n   int i;\n+  size_t len;\n \n   if (argc > 2 && strcmp (argv[1], \"-l\") == 0)\n     {\n@@ -536,8 +535,12 @@ main (int argc, char **argv)\n   opcodes = (opcode **) malloc (sizeof (opcode *));\n   op = &prefix_text;\n   op->lineno = 1;\n-  while ((line = safe_fgets (in)) != 0)\n+  linebuf = NULL;\n+  len = 0;\n+  while (getline (&linebuf, &len, in) >= 0)\n     {\n+      char *line = linebuf;\n+\n       lineno++;\n       if (strncmp (line, \"  /** \", 6) == 0\n \t  && (isdigit (line[6]) || memcmp (line + 6, \"VARY\", 4) == 0))\n@@ -629,6 +632,7 @@ main (int argc, char **argv)\n \t  op->lines[op->nlines - 1] = strdup (line);\n \t}\n     }\n+  free (linebuf);\n \n   {\n     int i, j;"
    },
    {
      "sha": "3516fa80bd0f2ca4f9a0bdfb59749991c4399513",
      "filename": "sim/m32c/safe-fgets.c",
      "status": "removed",
      "additions": 0,
      "deletions": 69,
      "changes": 69,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b/sim/m32c/safe-fgets.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b/sim/m32c/safe-fgets.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/safe-fgets.c?ref=8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b",
      "patch": "@@ -1,69 +0,0 @@\n-/* safe-fgets.c --- like fgets, but allocates its own static buffer.\n-\n-Copyright (C) 2005-2021 Free Software Foundation, Inc.\n-Contributed by Red Hat, Inc.\n-\n-This file is part of the GNU simulators.\n-\n-This program is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3 of the License, or\n-(at your option) any later version.\n-\n-This program is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n-\n-\n-#include <stdio.h>\n-#include <stdlib.h>\n-\n-#include \"safe-fgets.h\"\n-\n-static char *line_buf = 0;\n-static int line_buf_size = 0;\n-\n-#define LBUFINCR 100\n-\n-char *\n-safe_fgets (FILE * f)\n-{\n-  char *line_ptr;\n-\n-  if (line_buf == 0)\n-    {\n-      line_buf = (char *) malloc (LBUFINCR);\n-      line_buf_size = LBUFINCR;\n-    }\n-\n-  /* points to last byte */\n-  line_ptr = line_buf + line_buf_size - 1;\n-\n-  /* so we can see if fgets put a 0 there */\n-  *line_ptr = 1;\n-  if (fgets (line_buf, line_buf_size, f) == 0)\n-    return 0;\n-\n-  /* we filled the buffer? */\n-  while (line_ptr[0] == 0 && line_ptr[-1] != '\\n')\n-    {\n-      /* Make the buffer bigger and read more of the line */\n-      line_buf_size += LBUFINCR;\n-      line_buf = (char *) realloc (line_buf, line_buf_size);\n-\n-      /* points to last byte again */\n-      line_ptr = line_buf + line_buf_size - 1;\n-      /* so we can see if fgets put a 0 there */\n-      *line_ptr = 1;\n-\n-      if (fgets (line_buf + line_buf_size - LBUFINCR - 1, LBUFINCR + 1, f) ==\n-\t  0)\n-\treturn 0;\n-    }\n-\n-  return line_buf;\n-}"
    },
    {
      "sha": "7c03f27e26a79e0e864cb352d46765099d1ced5d",
      "filename": "sim/m32c/safe-fgets.h",
      "status": "removed",
      "additions": 0,
      "deletions": 27,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b/sim/m32c/safe-fgets.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b/sim/m32c/safe-fgets.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/safe-fgets.h?ref=8e78e9b9950a899a3c10f48e4f23ea4fd9bafe9b",
      "patch": "@@ -1,27 +0,0 @@\n-/* safe-fgets.h --- interface to safe version of fgets.\n-\n-Copyright (C) 2005-2021 Free Software Foundation, Inc.\n-Contributed by Red Hat, Inc.\n-\n-This file is part of the GNU simulators.\n-\n-This program is free software; you can redistribute it and/or modify\n-it under the terms of the GNU General Public License as published by\n-the Free Software Foundation; either version 3 of the License, or\n-(at your option) any later version.\n-\n-This program is distributed in the hope that it will be useful,\n-but WITHOUT ANY WARRANTY; without even the implied warranty of\n-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-GNU General Public License for more details.\n-\n-You should have received a copy of the GNU General Public License\n-along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n-\n-\n-#ifndef _safe_gets_h_\n-#define _safe_gets_h_\n-\n-char *safe_fgets (FILE * f);\n-\n-#endif"
    }
  ]
}