{
  "sha": "f956ecde56495cbcd5f8a3b440220090ee39ff56",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Zjk1NmVjZGU1NjQ5NWNiY2Q1ZjhhM2I0NDAyMjAwOTBlZTM5ZmY1Ng==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-19T02:31:19Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-19T03:01:08Z"
    },
    "message": "sim: m32c: switch syscalls to common nltvals\n\nRather than hand duplicate the syscall table, switch to the common\nnltvals framework.  We have to tweak the constant names, but we get\neverything else for free.  I made sure the constants have the same\nvalues before & after too :).",
    "tree": {
      "sha": "ae897b81fbdce2334a3ee8109a171ce9c6fa048d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ae897b81fbdce2334a3ee8109a171ce9c6fa048d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f956ecde56495cbcd5f8a3b440220090ee39ff56",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f956ecde56495cbcd5f8a3b440220090ee39ff56",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f956ecde56495cbcd5f8a3b440220090ee39ff56",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f956ecde56495cbcd5f8a3b440220090ee39ff56/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2390d779430a64350be827929a0ebf73155f4fd7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2390d779430a64350be827929a0ebf73155f4fd7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2390d779430a64350be827929a0ebf73155f4fd7"
    }
  ],
  "stats": {
    "total": 116,
    "additions": 56,
    "deletions": 60
  },
  "files": [
    {
      "sha": "8806233d47cbb784829ebb1c9b5890c815bc96b5",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -1,3 +1,8 @@\n+2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* gennltvals.py (TARGETS): Add m32c.\n+\t* nltvals.def: Regenerate.\n+\n 2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n \n \t* gennltvals.py (TARGETS): Add iq2000."
    },
    {
      "sha": "168ce4b5ecb9f21652fa9f5da087c4b6c8dc69fe",
      "filename": "sim/common/gennltvals.py",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/common/gennltvals.py",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/common/gennltvals.py",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/gennltvals.py?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -62,6 +62,7 @@\n     'i960',\n     'iq2000',\n     'lm32',\n+    'm32c',\n     'm32r',\n     'mcore',\n     'mn10200',"
    },
    {
      "sha": "fb3144a855623902ff24b62838929b2a9cd7cf5b",
      "filename": "sim/common/nltvals.def",
      "status": "modified",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/common/nltvals.def",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/common/nltvals.def",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/nltvals.def?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -404,6 +404,37 @@\n /* end lm32 sys target macros */\n #endif\n #endif\n+#ifdef NL_TARGET_m32c\n+#ifdef sys_defs\n+/* from syscall.h */\n+/* begin m32c sys target macros */\n+ { \"SYS_argc\", 22 },\n+ { \"SYS_argn\", 24 },\n+ { \"SYS_argnlen\", 23 },\n+ { \"SYS_argv\", 13 },\n+ { \"SYS_argvlen\", 12 },\n+ { \"SYS_chdir\", 14 },\n+ { \"SYS_chmod\", 16 },\n+ { \"SYS_close\", 3 },\n+ { \"SYS_exit\", 1 },\n+ { \"SYS_fstat\", 10 },\n+ { \"SYS_getpid\", 8 },\n+ { \"SYS_gettimeofday\", 19 },\n+ { \"SYS_kill\", 9 },\n+ { \"SYS_link\", 21 },\n+ { \"SYS_lseek\", 6 },\n+ { \"SYS_open\", 2 },\n+ { \"SYS_read\", 4 },\n+ { \"SYS_reconfig\", 25 },\n+ { \"SYS_stat\", 15 },\n+ { \"SYS_time\", 18 },\n+ { \"SYS_times\", 20 },\n+ { \"SYS_unlink\", 7 },\n+ { \"SYS_utime\", 17 },\n+ { \"SYS_write\", 5 },\n+/* end m32c sys target macros */\n+#endif\n+#endif\n #ifdef NL_TARGET_m32r\n #ifdef sys_defs\n /* from syscall.h */"
    },
    {
      "sha": "26c7c98e06dc0e334d8c0f660aec1e31e05b10ff",
      "filename": "sim/m32c/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/m32c/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/m32c/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/ChangeLog?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -1,3 +1,10 @@\n+2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* Makefile.in (NL_TARGET): Define.\n+\t* syscalls.c: Change syscall.h include to targ-vals.h.\n+\t(m32c_syscall): Add TARGET_ prefix to all SYS_ constants.\n+\t* syscall.h: Removed.\n+\n 2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n \n \t* configure: Regenerate."
    },
    {
      "sha": "15ade0b74be06120b47624e372f554191a089b66",
      "filename": "sim/m32c/Makefile.in",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/m32c/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/m32c/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/Makefile.in?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -18,6 +18,9 @@\n ### You should have received a copy of the GNU General Public License\n ### along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n+# This selects the newlib/libgloss syscall definitions.\n+NL_TARGET = -DNL_TARGET_m32c\n+\n ## COMMON_PRE_CONFIG_FRAG\n \n SIM_EXTRA_CFLAGS = -Wall -DTIMER_A"
    },
    {
      "sha": "0194e039e7fe86758bf8fc788ff70449f25903c0",
      "filename": "sim/m32c/syscall.h",
      "status": "removed",
      "additions": 0,
      "deletions": 50,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/m32c/syscall.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/m32c/syscall.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/syscall.h?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -1,50 +0,0 @@\n-/* Copied from libgloss */\n-/* General use syscall.h file.\n-   The more ports that use this file, the simpler sim/common/nltvals.def\n-   remains.  */\n-\n-#ifndef LIBGLOSS_SYSCALL_H\n-#define LIBGLOSS_SYSCALL_H\n-\n-/* Note: This file may be included by assembler source.  */\n-\n-/* These should be as small as possible to allow a port to use a trap type\n-   instruction, which the system call # as the trap (the d10v for instance\n-   supports traps 0..31).  An alternative would be to define one trap for doing\n-   system calls, and put the system call number in a register that is not used\n-   for the normal calling sequence (so that you don't have to shift down the\n-   arguments to add the system call number).  Obviously, if these system call\n-   numbers are ever changed, all of the simulators and potentially user code\n-   will need to be updated.  */\n-\n-/* There is no current need for the following: SYS_execv, SYS_creat, SYS_wait,\n-   etc. etc.  Don't add them.  */\n-\n-/* These are required by the ANSI C part of newlib (excluding system() of\n-   course).  */\n-#define\tSYS_exit\t1\n-#define\tSYS_open\t2\n-#define\tSYS_close\t3\n-#define\tSYS_read\t4\n-#define\tSYS_write\t5\n-#define\tSYS_lseek\t6\n-#define\tSYS_unlink\t7\n-#define\tSYS_getpid\t8\n-#define\tSYS_kill\t9\n-#define SYS_fstat       10\n-/*#define SYS_sbrk\t11 - not currently a system call, but reserved.  */\n-\n-/* ARGV support.  */\n-#define SYS_argvlen\t12\n-#define SYS_argv\t13\n-\n-/* These are extras added for one reason or another.  */\n-#define SYS_chdir\t 14\n-#define SYS_stat\t 15\n-#define SYS_chmod \t 16\n-#define SYS_utime \t 17\n-#define SYS_time \t 18\n-#define SYS_gettimeofday 19\n-#define SYS_times\t 20\n-#define SYS_link\t 21\n-#endif"
    },
    {
      "sha": "86695cb4dde7a3df251149ac23e3dd0cb07bebbe",
      "filename": "sim/m32c/syscalls.c",
      "status": "modified",
      "additions": 9,
      "deletions": 10,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/m32c/syscalls.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f956ecde56495cbcd5f8a3b440220090ee39ff56/sim/m32c/syscalls.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32c/syscalls.c?ref=f956ecde56495cbcd5f8a3b440220090ee39ff56",
      "patch": "@@ -30,8 +30,7 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n #include \"cpu.h\"\n #include \"mem.h\"\n #include \"syscalls.h\"\n-\n-#include \"syscall.h\"\n+#include \"targ-vals.h\"\n \n /* The current syscall callbacks we're using.  */\n static struct host_callback_struct *callbacks;\n@@ -184,7 +183,7 @@ m32c_syscall (int id)\n     printf (\"\\033[31m/* SYSCALL(%d) = %s */\\033[0m\\n\", id, callnames[id]);\n   switch (id)\n     {\n-    case SYS_exit:\n+    case TARGET_SYS_exit:\n       {\n \tint ec = arg (2);\n \tif (verbose)\n@@ -193,7 +192,7 @@ m32c_syscall (int id)\n       }\n       break;\n \n-    case SYS_open:\n+    case TARGET_SYS_open:\n       {\n \tint path = arg (PTRSZ);\n \tint oflags = arg (2);\n@@ -228,7 +227,7 @@ m32c_syscall (int id)\n       }\n       break;\n \n-    case SYS_close:\n+    case TARGET_SYS_close:\n       {\n \tint fd = arg (2);\n \n@@ -244,7 +243,7 @@ m32c_syscall (int id)\n       }\n       break;\n \n-    case SYS_read:\n+    case TARGET_SYS_read:\n       {\n \tint fd = arg (2);\n \tint addr = arg (PTRSZ);\n@@ -264,7 +263,7 @@ m32c_syscall (int id)\n       }\n       break;\n \n-    case SYS_write:\n+    case TARGET_SYS_write:\n       {\n \tint fd = arg (2);\n \tint addr = arg (PTRSZ);\n@@ -287,11 +286,11 @@ m32c_syscall (int id)\n       }\n       break;\n \n-    case SYS_getpid:\n+    case TARGET_SYS_getpid:\n       put_reg (r0, 42);\n       break;\n \n-    case SYS_gettimeofday:\n+    case TARGET_SYS_gettimeofday:\n       {\n \tint tvaddr = arg (PTRSZ);\n \tstruct timeval tv;\n@@ -306,7 +305,7 @@ m32c_syscall (int id)\n       }\n       break;\n \n-    case SYS_kill:\n+    case TARGET_SYS_kill:\n       {\n \tint pid = arg (2);\n \tint sig = arg (2);"
    }
  ]
}