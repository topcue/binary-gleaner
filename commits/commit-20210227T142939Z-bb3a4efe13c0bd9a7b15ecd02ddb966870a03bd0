{
  "sha": "bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmIzYTRlZmUxM2MwYmQ5YTdiMTVlY2QwMmRkYjk2Njg3MGEwM2JkMA==",
  "commit": {
    "author": {
      "name": "Lancelot SIX",
      "email": "lsix@lancelotsix.com",
      "date": "2021-02-25T00:30:49Z"
    },
    "committer": {
      "name": "Lancelot SIX",
      "email": "lsix@lancelotsix.com",
      "date": "2021-02-27T14:29:39Z"
    },
    "message": "[PR gdb/27393] set directories: handle empty dirs.\n\nAs reported in gdb/27393, the 'directory' and 'set directories' commands\nfail when parsing an empty dir name:\n\n    (gdb) set directories \"\"\n    /home/lsix/dev/gnu/binutils-gdb/gdbsupport/pathstuff.cc:132: internal-error: gdb::unique_xmalloc_ptr<char> gdb_abspath(const char*): Assertion `path != NULL && path[0] != '\\0'' failed.\n\nor\n\n    (gdb) dir :\n    /home/lsix/dev/gnu/binutils-gdb/gdbsupport/pathstuff.cc:132: internal-error: gdb::unique_xmalloc_ptr<char> gdb_abspath(const char*): Assertion `path != NULL && path[0] != '\\0'' failed.\n\nThis patch fixes this issue by ignoring any attempt to add an empty\nname to the source directories list.  'set dir \"\"' will reset the\ndirectories list the same way 'set dir' would do it.\n\nTested on x86_64.",
    "tree": {
      "sha": "2fba83defaddb1b33723dd84e7c3276a5c3c2603",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2fba83defaddb1b33723dd84e7c3276a5c3c2603"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/comments",
  "author": {
    "login": "lsix",
    "id": 724339,
    "node_id": "MDQ6VXNlcjcyNDMzOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/724339?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lsix",
    "html_url": "https://github.com/lsix",
    "followers_url": "https://api.github.com/users/lsix/followers",
    "following_url": "https://api.github.com/users/lsix/following{/other_user}",
    "gists_url": "https://api.github.com/users/lsix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lsix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lsix/subscriptions",
    "organizations_url": "https://api.github.com/users/lsix/orgs",
    "repos_url": "https://api.github.com/users/lsix/repos",
    "events_url": "https://api.github.com/users/lsix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lsix/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "lsix",
    "id": 724339,
    "node_id": "MDQ6VXNlcjcyNDMzOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/724339?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lsix",
    "html_url": "https://github.com/lsix",
    "followers_url": "https://api.github.com/users/lsix/followers",
    "following_url": "https://api.github.com/users/lsix/following{/other_user}",
    "gists_url": "https://api.github.com/users/lsix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lsix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lsix/subscriptions",
    "organizations_url": "https://api.github.com/users/lsix/orgs",
    "repos_url": "https://api.github.com/users/lsix/repos",
    "events_url": "https://api.github.com/users/lsix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lsix/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "573dc0cc43f2c3ce4d28ec1aa1bf05fc43810cda",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/573dc0cc43f2c3ce4d28ec1aa1bf05fc43810cda",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/573dc0cc43f2c3ce4d28ec1aa1bf05fc43810cda"
    }
  ],
  "stats": {
    "total": 54,
    "additions": 54,
    "deletions": 0
  },
  "files": [
    {
      "sha": "bb7b2de0b58f6e2d21bee6cb6968aec503ed3ef1",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
      "patch": "@@ -1,3 +1,8 @@\n+2021-02-27  Lancelot Six  <lsix@lancelotsix.com>\n+\n+\tPR gdb/27393\n+\t* source.c (add_path): Skip empty dirnames.\n+\n 2021-02-25  Kevin Buettner  <kevinb@redhat.com>\n \n \t* nat/aarch64-sve-linux-ptrace.h: Add comment regarding"
    },
    {
      "sha": "3a8f829759bea1c1d98ca5fbec4ceb0068834a3e",
      "filename": "gdb/source.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/source.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/source.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source.c?ref=bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
      "patch": "@@ -572,6 +572,8 @@ add_path (const char *dirname, char **which_path, int parse_separators)\n \t    break;\n \t}\n \n+      if (name[0] == '\\0')\n+        goto skip_dup;\n       if (name[0] == '~')\n \tnew_name_holder.reset (tilde_expand (name));\n #ifdef HAVE_DOS_BASED_FILE_SYSTEM"
    },
    {
      "sha": "b92e67c9557fe68871ae29b07fd3f35d54e23a59",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
      "patch": "@@ -1,3 +1,9 @@\n+2021-02-27  Lancelot Six  <lsix@lancelotix.com>\n+\n+\tPR gdb/27393\n+\t* gdb.base/source-dir.exp: Test that empty dirnames are skipped.\n+\n+\n 2021-02-26  Tom Tromey  <tom@tromey.com>\n \n \t* lib/gdb.exp (skip_ctf_tests): Use expr on result."
    },
    {
      "sha": "eff683199be57b19fd922e2f493985efb1951586",
      "filename": "gdb/testsuite/gdb.base/source-dir.exp",
      "status": "modified",
      "additions": 41,
      "deletions": 0,
      "changes": 41,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/testsuite/gdb.base/source-dir.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0/gdb/testsuite/gdb.base/source-dir.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/source-dir.exp?ref=bb3a4efe13c0bd9a7b15ecd02ddb966870a03bd0",
      "patch": "@@ -163,5 +163,46 @@ proc test_truncated_comp_dir {} {\n \t\"info source after setting directory search list\"\n }\n \n+proc test_change_search_directory_with_empty_dirname {} {\n+    gdb_start\n+\n+    # Add 3 entries to the source directories list:\n+    # - \"\"\n+    # - \"/foo\"\n+    # - \"/bar\"\n+    # Since /foo and /bar probably do not exist, ignore the warnings printed by\n+    # GDB.\n+    if { [ishost *-*-mingw*] } {\n+\tgdb_test \"set directories ;/foo;/bar\" \".*\"\n+    } else {\n+\tgdb_test \"set directories :/foo:/bar\" \".*\"\n+    }\n+\n+    # The first entry added (\"\") should be ignored, only /foo and /bar are\n+    # effectively added.\n+    with_test_prefix \"initial_directory_state\" {\n+\tgdb_test \"show directories\" \\\n+\t    [search_dir_list [list \\\n+\t\t\t\t  \"/foo\" \\\n+\t\t\t\t  \"/bar\" \\\n+\t\t\t\t  \"\\\\\\$cdir\" \\\n+\t\t\t\t  \"\\\\\\$cwd\"]]\n+    }\n+\n+    # Arguments can be quoted.  Check a empty string has the same effect as\n+    # 'set directory' (i.e. reset to $cdir:$cwd)\n+    gdb_test_no_output \"set directories \\\"\\\"\"\n+\n+    with_test_prefix \"directory_after_reset\" {\n+\tgdb_test \"show directories\" \\\n+\t    [search_dir_list [list \\\n+\t\t\t\t  \"\\\\\\$cdir\" \\\n+\t\t\t\t  \"\\\\\\$cwd\"]]\n+    }\n+\n+    gdb_exit\n+}\n+\n test_changing_search_directory\n+test_change_search_directory_with_empty_dirname\n test_truncated_comp_dir"
    }
  ]
}