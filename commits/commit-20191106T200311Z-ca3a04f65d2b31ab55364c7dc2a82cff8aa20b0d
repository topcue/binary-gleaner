{
  "sha": "ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2EzYTA0ZjY1ZDJiMzFhYjU1MzY0YzdkYzJhODJjZmY4YWEyMGIwZA==",
  "commit": {
    "author": {
      "name": "Christian Biesinger",
      "email": "cbiesinger@google.com",
      "date": "2019-11-02T17:09:31Z"
    },
    "committer": {
      "name": "Christian Biesinger",
      "email": "cbiesinger@google.com",
      "date": "2019-11-06T20:03:11Z"
    },
    "message": "Use strtok_r instead of strtok\n\nImproves threadsafety. This will be important when the patch series at\nhttps://gnutoolchain-gerrit.osci.io/r/c/binutils-gdb/+/176\nlands.\n\ngdb/ChangeLog:\n\n2019-11-06  Christian Biesinger  <cbiesinger@google.com>\n\n\t* linux-tdep.c (linux_info_proc): Use strtok_r instead of strtok.\n\t* mi/mi-main.c (output_cores): Likewise.\n\t* nat/linux-osdata.c (linux_xfer_osdata_cpus): Likewise.\n\t(linux_xfer_osdata_modules): Likewise.\n\t* remote.c (register_remote_support_xml): Likewise.\n\t* sparc64-tdep.c (adi_is_addr_mapped): Likewise.\n\t* xml-syscall.c (syscall_create_syscall_desc): Likewise.\n\ngdb/gdbserver/ChangeLog:\n\n2019-11-06  Christian Biesinger  <cbiesinger@google.com>\n\n\t* linux-x86-low.c (x86_linux_process_qsupported): Use strtok_r\n\tinstead of strtok.\n\t* server.c (handle_query): Likewise.\n\t(captured_main): Likewise.\n\nChange-Id: Ief6138965a24398e5fc064598cd8f2abd3b5047c",
    "tree": {
      "sha": "13e76a87a14d4363437ff398b2e89aed63f2f1eb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/13e76a87a14d4363437ff398b2e89aed63f2f1eb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/comments",
  "author": {
    "login": "cbiesinger",
    "id": 1483109,
    "node_id": "MDQ6VXNlcjE0ODMxMDk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1483109?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cbiesinger",
    "html_url": "https://github.com/cbiesinger",
    "followers_url": "https://api.github.com/users/cbiesinger/followers",
    "following_url": "https://api.github.com/users/cbiesinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/cbiesinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cbiesinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cbiesinger/subscriptions",
    "organizations_url": "https://api.github.com/users/cbiesinger/orgs",
    "repos_url": "https://api.github.com/users/cbiesinger/repos",
    "events_url": "https://api.github.com/users/cbiesinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cbiesinger/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "cbiesinger",
    "id": 1483109,
    "node_id": "MDQ6VXNlcjE0ODMxMDk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1483109?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cbiesinger",
    "html_url": "https://github.com/cbiesinger",
    "followers_url": "https://api.github.com/users/cbiesinger/followers",
    "following_url": "https://api.github.com/users/cbiesinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/cbiesinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cbiesinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cbiesinger/subscriptions",
    "organizations_url": "https://api.github.com/users/cbiesinger/orgs",
    "repos_url": "https://api.github.com/users/cbiesinger/repos",
    "events_url": "https://api.github.com/users/cbiesinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cbiesinger/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "848288b363337e49bcd54104cd83d4b8fb2247b8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/848288b363337e49bcd54104cd83d4b8fb2247b8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/848288b363337e49bcd54104cd83d4b8fb2247b8"
    }
  ],
  "stats": {
    "total": 83,
    "additions": 56,
    "deletions": 27
  },
  "files": [
    {
      "sha": "f43d3a5aed8afd891620a681aba8f41dc6891dd9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -1,3 +1,13 @@\n+2019-11-06  Christian Biesinger  <cbiesinger@google.com>\n+\n+\t* linux-tdep.c (linux_info_proc): Use strtok_r instead of strtok.\n+\t* mi/mi-main.c (output_cores): Likewise.\n+\t* nat/linux-osdata.c (linux_xfer_osdata_cpus): Likewise.\n+\t(linux_xfer_osdata_modules): Likewise.\n+\t* remote.c (register_remote_support_xml): Likewise.\n+\t* sparc64-tdep.c (adi_is_addr_mapped): Likewise.\n+\t* xml-syscall.c (syscall_create_syscall_desc): Likewise.\n+\n 2019-11-06  Tom Tromey  <tom@tromey.com>\n \n \t* tui/tui-interp.c: Don't include readline.h."
    },
    {
      "sha": "9d0afaaf28e61eb5ae46a7e559bb24ae905f22de",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -1,3 +1,13 @@\n+2019-11-06  Christian Biesinger  <cbiesinger@google.com>\n+\n+\t* linux-tdep.c (linux_info_proc): Use strtok_r instead of strtok.\n+\t* mi/mi-main.c (output_cores): Likewise.\n+\t* nat/linux-osdata.c (linux_xfer_osdata_cpus): Likewise.\n+\t(linux_xfer_osdata_modules): Likewise.\n+\t* remote.c (register_remote_support_xml): Likewise.\n+\t* sparc64-tdep.c (adi_is_addr_mapped): Likewise.\n+\t* xml-syscall.c (syscall_create_syscall_desc): Likewise.\n+\n 2019-11-01  Christian Biesinger  <cbiesinger@google.com>\n \n \t* configure: Regenerate."
    },
    {
      "sha": "54bd2a26de8eb59973fb575445abfe9f036e0954",
      "filename": "gdb/gdbserver/linux-x86-low.c",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/gdbserver/linux-x86-low.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/gdbserver/linux-x86-low.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/linux-x86-low.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -912,9 +912,11 @@ x86_linux_process_qsupported (char **features, int count)\n       if (startswith (feature, \"xmlRegisters=\"))\n \t{\n \t  char *copy = xstrdup (feature + 13);\n-\t  char *p;\n \n-\t  for (p = strtok (copy, \",\"); p != NULL; p = strtok (NULL, \",\"))\n+\t  char *saveptr;\n+\t  for (char *p = strtok_r (copy, \",\", &saveptr);\n+\t       p != NULL;\n+\t       p = strtok_r (NULL, \",\", &saveptr))\n \t    {\n \t      if (strcmp (p, \"i386\") == 0)\n \t\t{"
    },
    {
      "sha": "c5f7176cff83755ea98072ce2013695b43b64223",
      "filename": "gdb/gdbserver/server.c",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/gdbserver/server.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/gdbserver/server.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/server.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -2268,9 +2268,10 @@ handle_query (char *own_buf, int packet_len, int *new_packet_len_p)\n \n \t  /* Two passes, to avoid nested strtok calls in\n \t     target_process_qsupported.  */\n-\t  for (p = strtok (p + 1, \";\");\n+\t  char *saveptr;\n+\t  for (p = strtok_r (p + 1, \";\", &saveptr);\n \t       p != NULL;\n-\t       p = strtok (NULL, \";\"))\n+\t       p = strtok_r (NULL, \";\", &saveptr))\n \t    {\n \t      count++;\n \t      qsupported = XRESIZEVEC (char *, qsupported, count);\n@@ -3633,12 +3634,11 @@ captured_main (int argc, char *argv[])\n \t}\n       else if (startswith (*next_arg, \"--disable-packet=\"))\n \t{\n-\t  char *packets, *tok;\n-\n-\t  packets = *next_arg += sizeof (\"--disable-packet=\") - 1;\n-\t  for (tok = strtok (packets, \",\");\n+\t  char *packets = *next_arg += sizeof (\"--disable-packet=\") - 1;\n+\t  char *saveptr;\n+\t  for (char *tok = strtok_r (packets, \",\", &saveptr);\n \t       tok != NULL;\n-\t       tok = strtok (NULL, \",\"))\n+\t       tok = strtok_r (NULL, \",\", &saveptr))\n \t    {\n \t      if (strcmp (\"vCont\", tok) == 0)\n \t\tdisable_packet_vCont = true;"
    },
    {
      "sha": "18cee91dd3e88f2b67a19c5a82406d115adf164c",
      "filename": "gdb/linux-tdep.c",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/linux-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/linux-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/linux-tdep.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -839,9 +839,10 @@ linux_info_proc (struct gdbarch *gdbarch, const char *args,\n \t\t\t   \"      Size\", \"    Offset\", \"objfile\");\n \t    }\n \n-\t  for (line = strtok (map.get (), \"\\n\");\n+\t  char *saveptr;\n+\t  for (line = strtok_r (map.get (), \"\\n\", &saveptr);\n \t       line;\n-\t       line = strtok (NULL, \"\\n\"))\n+\t       line = strtok_r (NULL, \"\\n\", &saveptr))\n \t    {\n \t      ULONGEST addr, endaddr, offset, inode;\n \t      const char *permissions, *device, *mapping_filename;"
    },
    {
      "sha": "c14897a5f719caf48d080be6301ff818a7c3a784",
      "filename": "gdb/mi/mi-main.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/mi/mi-main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/mi/mi-main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mi/mi-main.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -696,8 +696,9 @@ output_cores (struct ui_out *uiout, const char *field_name, const char *xcores)\n   ui_out_emit_list list_emitter (uiout, field_name);\n   auto cores = make_unique_xstrdup (xcores);\n   char *p = cores.get ();\n+  char *saveptr;\n \n-  for (p = strtok (p, \",\"); p;  p = strtok (NULL, \",\"))\n+  for (p = strtok_r (p, \",\", &saveptr); p;  p = strtok_r (NULL, \",\", &saveptr))\n     uiout->field_string (NULL, p);\n }\n "
    },
    {
      "sha": "84357e29559ee1577f8573c3cfabdade074f42fc",
      "filename": "gdb/nat/linux-osdata.c",
      "status": "modified",
      "additions": 10,
      "deletions": 9,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/nat/linux-osdata.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/nat/linux-osdata.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/linux-osdata.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -566,11 +566,12 @@ linux_xfer_osdata_cpus (struct buffer *buffer)\n \t      char *key, *value;\n \t      int i = 0;\n \n-\t      key = strtok (buf, \":\");\n+\t      char *saveptr;\n+\t      key = strtok_r (buf, \":\", &saveptr);\n \t      if (key == NULL)\n \t\tcontinue;\n \n-\t      value = strtok (NULL, \":\");\n+\t      value = strtok_r (NULL, \":\", &saveptr);\n \t      if (value == NULL)\n \t\tcontinue;\n \n@@ -1216,36 +1217,36 @@ linux_xfer_osdata_modules (struct buffer *buffer)\n \t{\n \t  if (fgets (buf, sizeof (buf), fp.get ()))\n \t    {\n-\t      char *name, *dependencies, *status, *tmp;\n+\t      char *name, *dependencies, *status, *tmp, *saveptr;\n \t      unsigned int size;\n \t      unsigned long long address;\n \t      int uses;\n \n-\t      name = strtok (buf, \" \");\n+\t      name = strtok_r (buf, \" \", &saveptr);\n \t      if (name == NULL)\n \t\tcontinue;\n \n-\t      tmp = strtok (NULL, \" \");\n+\t      tmp = strtok_r (NULL, \" \", &saveptr);\n \t      if (tmp == NULL)\n \t\tcontinue;\n \t      if (sscanf (tmp, \"%u\", &size) != 1)\n \t\tcontinue;\n \n-\t      tmp = strtok (NULL, \" \");\n+\t      tmp = strtok_r (NULL, \" \", &saveptr);\n \t      if (tmp == NULL)\n \t\tcontinue;\n \t      if (sscanf (tmp, \"%d\", &uses) != 1)\n \t\tcontinue;\n \n-\t      dependencies = strtok (NULL, \" \");\n+\t      dependencies = strtok_r (NULL, \" \", &saveptr);\n \t      if (dependencies == NULL)\n \t\tcontinue;\n \n-\t      status = strtok (NULL, \" \");\n+\t      status = strtok_r (NULL, \" \", &saveptr);\n \t      if (status == NULL)\n \t\tcontinue;\n \n-\t      tmp = strtok (NULL, \"\\n\");\n+\t      tmp = strtok_r (NULL, \"\\n\", &saveptr);\n \t      if (tmp == NULL)\n \t\tcontinue;\n \t      if (sscanf (tmp, \"%llx\", &address) != 1)"
    },
    {
      "sha": "1ac9013408dbc57f6b61bf2aef7d1768905f5196",
      "filename": "gdb/remote.c",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/remote.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/remote.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -5169,7 +5169,8 @@ register_remote_support_xml (const char *xml)\n   else\n     {\n       char *copy = xstrdup (remote_support_xml + 13);\n-      char *p = strtok (copy, \",\");\n+      char *saveptr;\n+      char *p = strtok_r (copy, \",\", &saveptr);\n \n       do\n \t{\n@@ -5180,7 +5181,7 @@ register_remote_support_xml (const char *xml)\n \t      return;\n \t    }\n \t}\n-      while ((p = strtok (NULL, \",\")) != NULL);\n+      while ((p = strtok_r (NULL, \",\", &saveptr)) != NULL);\n       xfree (copy);\n \n       remote_support_xml = reconcat (remote_support_xml,"
    },
    {
      "sha": "fc73b23145de5809a11e71f2c82a263606f67cd4",
      "filename": "gdb/sparc64-tdep.c",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/sparc64-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/sparc64-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/sparc64-tdep.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -316,8 +316,10 @@ adi_is_addr_mapped (CORE_ADDR vaddr, size_t cnt)\n   if (data)\n     {\n       adi_stat_t adi_stat = get_adi_info (pid);\n-      char *line;\n-      for (line = strtok (data.get (), \"\\n\"); line; line = strtok (NULL, \"\\n\"))\n+      char *saveptr;\n+      for (char *line = strtok_r (data.get (), \"\\n\", &saveptr);\n+\t   line;\n+\t   line = strtok_r (NULL, \"\\n\", &saveptr))\n         {\n           ULONGEST addr, endaddr;\n "
    },
    {
      "sha": "3830faa43652fdce9e09efeaa2c0629ab7c8d46e",
      "filename": "gdb/xml-syscall.c",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/xml-syscall.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d/gdb/xml-syscall.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/xml-syscall.c?ref=ca3a04f65d2b31ab55364c7dc2a82cff8aa20b0d",
      "patch": "@@ -221,9 +221,10 @@ syscall_create_syscall_desc (struct syscalls_info *syscalls_info,\n   /*  Add syscall to its groups.  */\n   if (groups != NULL)\n     {\n-      for (char *group = strtok (groups, \",\");\n+      char *saveptr;\n+      for (char *group = strtok_r (groups, \",\", &saveptr);\n \t   group != NULL;\n-\t   group = strtok (NULL, \",\"))\n+\t   group = strtok_r (NULL, \",\", &saveptr))\n \tsyscall_group_add_syscall (syscalls_info, sysdesc, group);\n     }\n }"
    }
  ]
}