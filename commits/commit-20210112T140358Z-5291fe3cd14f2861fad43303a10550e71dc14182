{
  "sha": "5291fe3cd14f2861fad43303a10550e71dc14182",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTI5MWZlM2NkMTRmMjg2MWZhZDQzMzAzYTEwNTUwZTcxZGMxNDE4Mg==",
  "commit": {
    "author": {
      "name": "Srinath Parvathaneni",
      "email": "srinath.parvathaneni@arm.com",
      "date": "2021-01-12T13:57:23Z"
    },
    "committer": {
      "name": "Srinath Parvathaneni",
      "email": "srinath.parvathaneni@arm.com",
      "date": "2021-01-12T14:03:58Z"
    },
    "message": "aarch64: Add support for bfloat16 in gdb.\n\nThis patch adds support for bfloat16 in AArch64 gdb.\nAlso adds the field \"bf\" to vector registers h0-h31.\nAlso adds the vector \"bf\" to h field in vector registers v0-v31.\n\nThe following is how the vector register h and v looks like.\n\nBefore this patch:\n(gdb) p $h0\n$1 = {f = 0, u = 0, s = 0}\n(gdb) p/x $h0\n$2 = {f = 0x0, u = 0x0, s = 0x0}\n(gdb) p $v0.h\n$3 = {f = {0, 0, 0, 0, 0, 0, 0, 0}, u = {0, 0, 0, 0, 0, 0, 0, 0}, s = {0, 0, 0, 0, 0, 0, 0, 0}}\n(gdb) p/x $v0.h\n$4 = {f = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}, u = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0},\n      s = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}}\n\nAfter this patch:\n(gdb) p $h0\n$1 = {bf = 0, f = 0, u = 0, s = 0}\n(gdb) p/x $h0\n$2 = {bf = 0x0, f = 0x0, u = 0x0, s = 0x0}\n(gdb) p $v0.h\n$3 = {bf = {0, 0, 0, 0, 0, 0, 0, 0}, f = {0, 0, 0, 0, 0, 0, 0, 0}, u = {0, 0, 0, 0, 0, 0, 0, 0},\n      s = {0, 0, 0, 0, 0, 0, 0, 0}}\n(gdb) p/x $v0.h\n$4 = {bf = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}, f = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0},\n      u = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}, s = {0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}}\n\ngdb/ChangeLog:\n\n2021-01-12  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n\n\t* aarch64-tdep.c (aarch64_vnh_type): Add \"bf\" field in h registers.\n\t(aarch64_vnv_type): Add \"bf\" type in h field of v registers.\n\t* features/aarch64-fpu.c (create_feature_aarch64_fpu): Regenerated.\n\t* features/aarch64-fpu.xml: Add bfloat16 type.\n\ngdb/testsuite/ChangeLog:\n\n2021-01-12  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n\n\t* gdb.arch/aarch64-fp.exp: Modify to test bfloat16 support.",
    "tree": {
      "sha": "80ab70388403d31b63df0fcc67a505e059164c7c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/80ab70388403d31b63df0fcc67a505e059164c7c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5291fe3cd14f2861fad43303a10550e71dc14182",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5291fe3cd14f2861fad43303a10550e71dc14182",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5291fe3cd14f2861fad43303a10550e71dc14182",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5291fe3cd14f2861fad43303a10550e71dc14182/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "d546b61084cec687e0063b2e0e169b4690341c23",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d546b61084cec687e0063b2e0e169b4690341c23",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d546b61084cec687e0063b2e0e169b4690341c23"
    }
  ],
  "stats": {
    "total": 48,
    "additions": 48,
    "deletions": 0
  },
  "files": [
    {
      "sha": "27d5b96f141215ae03dfcc127a2efb3a69071a4b",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5291fe3cd14f2861fad43303a10550e71dc14182",
      "patch": "@@ -1,3 +1,10 @@\n+2021-01-12  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n+\n+\t* aarch64-tdep.c (aarch64_vnh_type): Add \"bf\" field in h registers.\n+\t(aarch64_vnv_type): Add \"bf\" type in h field of v registers.\n+\t* features/aarch64-fpu.c (create_feature_aarch64_fpu): Regenerated.\n+\t* features/aarch64-fpu.xml: Add bfloat16 type.\n+\n 2021-01-12  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* expprint.c (dump_subexp_body_standard): Handle OP_BOOL."
    },
    {
      "sha": "7099f180101f70b98f46a0f4adf528973ebe5b1d",
      "filename": "gdb/aarch64-tdep.c",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/aarch64-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/aarch64-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/aarch64-tdep.c?ref=5291fe3cd14f2861fad43303a10550e71dc14182",
      "patch": "@@ -2040,6 +2040,9 @@ aarch64_vnh_type (struct gdbarch *gdbarch)\n       t = arch_composite_type (gdbarch, \"__gdb_builtin_type_vnh\",\n \t\t\t       TYPE_CODE_UNION);\n \n+      elem = builtin_type (gdbarch)->builtin_bfloat16;\n+      append_composite_type_field (t, \"bf\", elem);\n+\n       elem = builtin_type (gdbarch)->builtin_half;\n       append_composite_type_field (t, \"f\", elem);\n \n@@ -2121,6 +2124,8 @@ aarch64_vnv_type (struct gdbarch *gdbarch)\n \n       sub = arch_composite_type (gdbarch, \"__gdb_builtin_type_vnh\",\n \t\t\t\t TYPE_CODE_UNION);\n+      append_composite_type_field (sub, \"bf\",\n+\t\t\t\t   init_vector_type (bt->builtin_bfloat16, 8));\n       append_composite_type_field (sub, \"f\",\n \t\t\t\t   init_vector_type (bt->builtin_half, 8));\n       append_composite_type_field (sub, \"u\","
    },
    {
      "sha": "a80b7d4c1b8676571325ff9cb19723928a051338",
      "filename": "gdb/features/aarch64-fpu.c",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/features/aarch64-fpu.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/features/aarch64-fpu.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/aarch64-fpu.c?ref=5291fe3cd14f2861fad43303a10550e71dc14182",
      "patch": "@@ -37,6 +37,9 @@ create_feature_aarch64_fpu (struct target_desc *result, long regnum)\n   element_type = tdesc_named_type (feature, \"int16\");\n   tdesc_create_vector (feature, \"v8i\", element_type, 8);\n \n+  element_type = tdesc_named_type (feature, \"bfloat16\");\n+  tdesc_create_vector (feature, \"v8bf16\", element_type, 8);\n+\n   element_type = tdesc_named_type (feature, \"uint8\");\n   tdesc_create_vector (feature, \"v16u\", element_type, 16);\n \n@@ -68,6 +71,8 @@ create_feature_aarch64_fpu (struct target_desc *result, long regnum)\n   tdesc_add_field (type_with_fields, \"s\", field_type);\n \n   type_with_fields = tdesc_create_union (feature, \"vnh\");\n+  field_type = tdesc_named_type (feature, \"v8bf16\");\n+  tdesc_add_field (type_with_fields, \"bf\", field_type);\n   field_type = tdesc_named_type (feature, \"v8f\");\n   tdesc_add_field (type_with_fields, \"f\", field_type);\n   field_type = tdesc_named_type (feature, \"v8u\");"
    },
    {
      "sha": "2235d072a094065cf7406176e11964d0725dcf91",
      "filename": "gdb/features/aarch64-fpu.xml",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/features/aarch64-fpu.xml",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/features/aarch64-fpu.xml",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/aarch64-fpu.xml?ref=5291fe3cd14f2861fad43303a10550e71dc14182",
      "patch": "@@ -17,6 +17,7 @@\n   <vector id=\"v8f\" type=\"ieee_half\" count=\"8\"/>\n   <vector id=\"v8u\" type=\"uint16\" count=\"8\"/>\n   <vector id=\"v8i\" type=\"int16\" count=\"8\"/>\n+  <vector id=\"v8bf16\" type=\"bfloat16\" count=\"8\"/>\n   <vector id=\"v16u\" type=\"uint8\" count=\"16\"/>\n   <vector id=\"v16i\" type=\"int8\" count=\"16\"/>\n   <vector id=\"v1u\" type=\"uint128\" count=\"1\"/>\n@@ -32,6 +33,7 @@\n     <field name=\"s\" type=\"v4i\"/>\n   </union>\n   <union id=\"vnh\">\n+    <field name=\"bf\" type=\"v8bf16\"/>\n     <field name=\"f\" type=\"v8f\"/>\n     <field name=\"u\" type=\"v8u\"/>\n     <field name=\"s\" type=\"v8i\"/>"
    },
    {
      "sha": "eb42dedc18e09ac6c1779a0cd1a9150cf838ac79",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=5291fe3cd14f2861fad43303a10550e71dc14182",
      "patch": "@@ -1,3 +1,7 @@\n+2021-01-12  Srinath Parvathaneni  <srinath.parvathaneni@arm.com>\n+\n+\t* gdb.arch/aarch64-fp.exp: Modify to test bfloat16 support.\n+\n 2021-01-12  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.base/disasm-optim.exp: Require is_amd64_regs_target."
    },
    {
      "sha": "4fb8e343c49e26ac9c03b1835b5f31f3c9c2e88e",
      "filename": "gdb/testsuite/gdb.arch/aarch64-fp.exp",
      "status": "modified",
      "additions": 25,
      "deletions": 0,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/testsuite/gdb.arch/aarch64-fp.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5291fe3cd14f2861fad43303a10550e71dc14182/gdb/testsuite/gdb.arch/aarch64-fp.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.arch/aarch64-fp.exp?ref=5291fe3cd14f2861fad43303a10550e71dc14182",
      "patch": "@@ -75,3 +75,28 @@ gdb_test \"p/x \\$fpcr\" \\\n     \"fpcr.*0x\\[0-9a-fA-F\\].*\" \\\n     \"check register fpcr value\"\n \n+with_test_prefix \"bfloat16\" {\n+    gdb_test \"set \\$h0.bf = 1.185e-38\" \\\n+    \".*\" \\\n+    \"set h0.bf to 129\"\n+\n+    gdb_test \"p \\$h0\" \\\n+    \"h0.*{bf = 1.185e-38, f = 7.689e-06, u = 129, s = 129}\" \\\n+    \"h0 fields are valid\"\n+\n+    gdb_test \"set \\$v0.h.bf\\[0\\] = 0\" \\\n+    \"v0.* = 0\" \\\n+    \"set v0.h.bf\\[0\\] to 0\"\n+\n+    gdb_test \"p \\$v0.h.s\\[0\\]\" \\\n+    \"v0.* = 0\" \\\n+    \"v0.h.s\\[0\\] is 0\"\n+\n+    gdb_test \"set \\$v0.h.bf\\[0\\] = 1.185e-38\" \\\n+    \"v0.* = 1.185e-38\" \\\n+    \"set v0.h.bf\\[0\\] to 129\"\n+\n+    gdb_test \"p \\$v0.h.s\\[0\\]\" \\\n+    \"v0.* = 129\" \\\n+    \"v0.h.s\\[0\\] is 129\"\n+}"
    }
  ]
}