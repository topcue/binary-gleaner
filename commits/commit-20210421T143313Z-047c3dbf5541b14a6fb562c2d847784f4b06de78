{
  "sha": "047c3dbf5541b14a6fb562c2d847784f4b06de78",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDQ3YzNkYmY1NTQxYjE0YTZmYjU2MmMyZDg0Nzc4NGY0YjA2ZGU3OA==",
  "commit": {
    "author": {
      "name": "Nick Lott",
      "email": "nick.lott@gmail.com",
      "date": "2021-04-21T14:33:13Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2021-04-21T14:33:13Z"
    },
    "message": "Add ability to select numeric base when displaying symbol values in readelf.\n\n\tPR 27672\n\t* readelf.c (sym_base): New variable.\n\t(enum print_mode): Add more modes.\n\t(print_vma): Add suport for new modes.\n\t(options): Add sym-base.\n\t(usage): Add sym-base.\n\t(parse_args): Add support for --sym-base.\n\t(print_dynamic_symbol_size): New function.\n\t(print_dynamic_symbol): Use new function.\n\t* doc/binutils.texi: Document the new feature.\n\t* NEWS: Mention the new feature.",
    "tree": {
      "sha": "d14e956b967429659a03fd79736e0f730fc4bb64",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d14e956b967429659a03fd79736e0f730fc4bb64"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/047c3dbf5541b14a6fb562c2d847784f4b06de78",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/047c3dbf5541b14a6fb562c2d847784f4b06de78",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/047c3dbf5541b14a6fb562c2d847784f4b06de78",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/047c3dbf5541b14a6fb562c2d847784f4b06de78/comments",
  "author": {
    "login": "brokentoaster",
    "id": 566180,
    "node_id": "MDQ6VXNlcjU2NjE4MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/566180?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/brokentoaster",
    "html_url": "https://github.com/brokentoaster",
    "followers_url": "https://api.github.com/users/brokentoaster/followers",
    "following_url": "https://api.github.com/users/brokentoaster/following{/other_user}",
    "gists_url": "https://api.github.com/users/brokentoaster/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/brokentoaster/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/brokentoaster/subscriptions",
    "organizations_url": "https://api.github.com/users/brokentoaster/orgs",
    "repos_url": "https://api.github.com/users/brokentoaster/repos",
    "events_url": "https://api.github.com/users/brokentoaster/events{/privacy}",
    "received_events_url": "https://api.github.com/users/brokentoaster/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "fd34472cdce1d49bee6fa840caffff6f06de00de",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fd34472cdce1d49bee6fa840caffff6f06de00de",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/fd34472cdce1d49bee6fa840caffff6f06de00de"
    }
  ],
  "stats": {
    "total": 119,
    "additions": 110,
    "deletions": 9
  },
  "files": [
    {
      "sha": "e15d036123689123fb23156cccbb83e38c1795bb",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=047c3dbf5541b14a6fb562c2d847784f4b06de78",
      "patch": "@@ -1,3 +1,17 @@\n+2021-04-21  Nick Lott  <nick.lott@gmail.com>\n+\n+\tPR 27672\n+\t* readelf.c (sym_base): New variable.\n+\t(enum print_mode): Add more modes.\n+\t(print_vma): Add suport for new modes.\n+\t(options): Add sym-base.\n+\t(usage): Add sym-base.\n+\t(parse_args): Add support for --sym-base.\n+\t(print_dynamic_symbol_size): New function.\n+\t(print_dynamic_symbol): Use new function.\n+\t* doc/binutils.texi: Document the new feature.\n+\t* NEWS: Mention the new feature.\n+\n 2021-04-21  Nick Clifton  <nickc@redhat.com>\n \n \t* testsuite/binutils-all/mips/global-local-symtab-sort-n64t.d:"
    },
    {
      "sha": "d21f219251b0d42b979a0aa4d2dd9e4b98e84176",
      "filename": "binutils/NEWS",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/NEWS?ref=047c3dbf5541b14a6fb562c2d847784f4b06de78",
      "patch": "@@ -1,5 +1,11 @@\n -*- text -*-\n \n+* The readelf tool has a new command line option which can be used to specify\n+  how the numeric values of symbols are reported.  --sym-base=0|8|10|16 tells\n+  readelf to display the values in base 8, base 10 or base 16.  A sym base of 0\n+  represents the default action of displaying values under 10000 in base 10 and\n+  values above that in base 16.\n+\n * Binutils now requires a C99 compiler and library to build.\n \n * A new format has been added to the nm program.  Specifying"
    },
    {
      "sha": "a8157ade3c1a2b175f348aa38934e1c851615604",
      "filename": "binutils/doc/binutils.texi",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/doc/binutils.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/doc/binutils.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/doc/binutils.texi?ref=047c3dbf5541b14a6fb562c2d847784f4b06de78",
      "patch": "@@ -4788,6 +4788,7 @@ readelf [@option{-a}|@option{--all}]\n         [@option{-e}|@option{--headers}]\n         [@option{-s}|@option{--syms}|@option{--symbols}]\n         [@option{--dyn-syms}|@option{--lto-syms}]\n+        [@option{--sym-base=[0|8|10|16]}]\n         [@option{--demangle@var{=style}}|@option{--no-demangle}]\n         [@option{--quiet}]\n         [@option{--recurse-limit}|@option{--no-recurse-limit}]\n@@ -4917,6 +4918,18 @@ has one.  The output format is the same as the format used by the\n @cindex LTO symbol table\n Displays the contents of any LTO symbol tables in the file.\n \n+@item --sym-base=[0|8|10|16]\n+@cindex symbol table size base\n+Forces the size field of the symbol table to use the given base.  Any\n+unrecognized options will be treated as @samp{0}.  @option{--sym-base=0}\n+represents the default and legacy behaviour.  This will output sizes as decimal\n+for numbers less than 100000.  For sizes 100000 and greater hexadecimal notation\n+will be used with a 0x prefix.\n+@option{--sym-base=8} will give the symbol sizes in octal.\n+@option{--sym-base=10} will always give the symbol sizes in decimal.\n+@option{--sym-base=16} will always give the symbol sizes in hexadecimal with a\n+0x prefix.\n+\n @item -C\n @itemx --demangle[=@var{style}]\n @cindex demangling in nm"
    },
    {
      "sha": "e63deaf96363735ffeebb9004bf04f6f53ad802f",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 77,
      "deletions": 9,
      "changes": 86,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/047c3dbf5541b14a6fb562c2d847784f4b06de78/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=047c3dbf5541b14a6fb562c2d847784f4b06de78",
      "patch": "@@ -238,6 +238,7 @@ static bool do_not_show_symbol_truncation = false;\n static bool do_demangle = false;\t/* Pretty print C++ symbol names.  */\n static bool process_links = false;\n static int demangle_flags = DMGL_ANSI | DMGL_PARAMS;\n+static int sym_base = 0;\n \n static char *dump_ctf_parent_name;\n static char *dump_ctf_symtab_name;\n@@ -312,12 +313,17 @@ typedef struct filedata\n typedef enum print_mode\n {\n   HEX,\n+  HEX_5,\n   DEC,\n   DEC_5,\n   UNSIGNED,\n+  UNSIGNED_5,\n   PREFIX_HEX,\n+  PREFIX_HEX_5,\n   FULL_HEX,\n-  LONG_HEX\n+  LONG_HEX,\n+  OCTAL,\n+  OCTAL_5\n }\n print_mode;\n \n@@ -529,18 +535,34 @@ print_vma (bfd_vma vma, print_mode mode)\n     case HEX:\n       return nc + printf (\"%\" BFD_VMA_FMT \"x\", vma);\n \n+    case PREFIX_HEX_5:\n+      nc = printf (\"0x\");\n+      /* Fall through.  */\n+    case HEX_5:\n+      return nc + printf (\"%05\" BFD_VMA_FMT \"x\", vma);\n+\n     case DEC:\n       return printf (\"%\" BFD_VMA_FMT \"d\", vma);\n \n     case UNSIGNED:\n       return printf (\"%\" BFD_VMA_FMT \"u\", vma);\n \n+    case UNSIGNED_5:\n+      return printf (\"%5\" BFD_VMA_FMT \"u\", vma);\n+\n+    case OCTAL:\n+      return printf (\"%\" BFD_VMA_FMT \"o\", vma);\n+\n+    case OCTAL_5:\n+      return printf (\"%5\" BFD_VMA_FMT \"o\", vma);\n+\n     default:\n       /* FIXME: Report unrecognised mode ?  */\n       return 0;\n     }\n }\n \n+\n /* Display a symbol on stdout.  Handles the display of control characters and\n    multibye characters (assuming the host environment supports them).\n \n@@ -4523,7 +4545,8 @@ enum long_option_values\n   OPTION_WITH_SYMBOL_VERSIONS,\n   OPTION_RECURSE_LIMIT,\n   OPTION_NO_RECURSE_LIMIT,\n-  OPTION_NO_DEMANGLING\n+  OPTION_NO_DEMANGLING,\n+  OPTION_SYM_BASE\n };\n \n static struct option options[] =\n@@ -4580,6 +4603,7 @@ static struct option options[] =\n   {\"ctf-strings\",      required_argument, 0, OPTION_CTF_STRINGS},\n   {\"ctf-parent\",       required_argument, 0, OPTION_CTF_PARENT},\n #endif\n+  {\"sym-base\",\t       optional_argument, 0, OPTION_SYM_BASE},\n \n   {0,\t\t       no_argument, 0, 0}\n };\n@@ -4603,6 +4627,9 @@ usage (FILE * stream)\n      --symbols           An alias for --syms\\n\\\n      --dyn-syms          Display the dynamic symbol table\\n\\\n      --lto-syms          Display LTO symbol tables\\n\\\n+     --sym-base=[0|8|10|16] \\n\\\n+                         Force base for symbol sizes.  The options are \\n\\\n+                         mixed (the default), octal, decimal, hexadecimal.\\n\\\n   -C --demangle[=STYLE]  Decode low-level symbol names into user-level names\\n\\\n                           The STYLE, if specified, can be `auto' (the default),\\n\\\n                           `gnu', `lucid', `arm', `hp', `edg', `gnu-v3', `java'\\n\\\n@@ -4962,6 +4989,26 @@ parse_args (struct dump_data *dumpdata, int argc, char ** argv)\n \t  /* Ignored for backward compatibility.  */\n \t  break;\n \n+\tcase OPTION_SYM_BASE:\n+\t  sym_base = 0;\n+\t  if (optarg != NULL)\n+\t    {\n+\t      sym_base = strtoul (optarg, NULL, 0);\n+\t      switch (sym_base)\n+\t\t{\n+\t\t  case 0:\n+\t\t  case 8:\n+\t\t  case 10:\n+\t\t  case 16:\n+\t\t    break;\n+\n+\t\t  default:\n+\t\t    sym_base = 0;\n+\t\t    break;\n+\t\t}\n+\t    }\n+\t  break;\n+\n \tdefault:\n \t  /* xgettext:c-format */\n \t  error (_(\"Invalid option '-%c'\\n\"), c);\n@@ -7213,7 +7260,7 @@ process_section_groups (Filedata * filedata)\n \n   if (filedata->is_separate)\n     printf (_(\"Section groups in linked file '%s'\\n\"), filedata->file_name);\n-      \n+\n   for (i = 0, section = filedata->section_headers, group = filedata->section_groups;\n        i < filedata->file_header.e_shnum;\n        i++, section++)\n@@ -7664,7 +7711,6 @@ process_relocs (Filedata * filedata)\n \t\tprintf\n \t\t  (_(\"\\n'%s' relocation section at offset 0x%lx contains %ld bytes:\\n\"),\n \t\t   name, rel_offset, rel_size);\n-\t\t\n \n \t      dump_relocations (filedata,\n \t\t\t\toffset_from_vma (filedata, rel_offset, rel_size),\n@@ -11353,7 +11399,7 @@ process_version_sections (Filedata * filedata)\n \t\t\t\tsection->sh_info),\n \t\t      printable_section_name (filedata, section),\n \t\t      section->sh_info);\n-\t      \n+\n \t    printf (_(\" Addr: 0x\"));\n \t    printf_vma (section->sh_addr);\n \t    printf (_(\"  Offset: %#08lx  Link: %u (%s)\\n\"),\n@@ -11500,7 +11546,7 @@ process_version_sections (Filedata * filedata)\n \t\t\t\tsection->sh_info),\n \t\t      printable_section_name (filedata, section),\n \t\t      section->sh_info);\n-\t      \n+\n \t    printf (_(\" Addr: 0x\"));\n \t    printf_vma (section->sh_addr);\n \t    printf (_(\"  Offset: %#08lx  Link: %u (%s)\\n\"),\n@@ -12372,6 +12418,28 @@ get_symbol_version_string (Filedata *                   filedata,\n   return NULL;\n }\n \n+/* Display a symbol size on stdout.  Format is based on --sym-base setting.  */\n+\n+static unsigned int\n+print_dynamic_symbol_size (bfd_vma vma, int base)\n+{\n+  switch (base)\n+    {\n+    case 8:\n+      return print_vma (vma, OCTAL_5);\n+\n+    case 10:\n+      return print_vma (vma, UNSIGNED_5);\n+\n+    case 16:\n+      return print_vma (vma, PREFIX_HEX_5);\n+\n+    case 0:\n+    default:\n+      return print_vma (vma, DEC_5);\n+    }\n+}\n+\n static void\n print_dynamic_symbol (Filedata *filedata, unsigned long si,\n \t\t      Elf_Internal_Sym *symtab,\n@@ -12388,7 +12456,7 @@ print_dynamic_symbol (Filedata *filedata, unsigned long si,\n   printf (\"%6ld: \", si);\n   print_vma (psym->st_value, LONG_HEX);\n   putchar (' ');\n-  print_vma (psym->st_size, DEC_5);\n+  print_dynamic_symbol_size (psym->st_size, sym_base);\n   printf (\" %-7s\", get_symbol_type (filedata, ELF_ST_TYPE (psym->st_info)));\n   printf (\" %-6s\", get_symbol_binding (filedata, ELF_ST_BIND (psym->st_info)));\n   if (filedata->file_header.e_ident[EI_OSABI] == ELFOSABI_SOLARIS)\n@@ -12540,7 +12608,7 @@ display_lto_symtab (Filedata *           filedata,\n       else\n \tprintf (_(\"\\nLTO Symbol table '%s' is empty!\\n\"),\n \t\tprintable_section_name (filedata, section));\n-      \n+\n       return true;\n     }\n \n@@ -15536,7 +15604,7 @@ process_section_contents (Filedata * filedata)\n \n       if (filedata->is_separate && ! process_links)\n \tdump &= DEBUG_DUMP;\n-      \n+\n #ifdef SUPPORT_DISASSEMBLY\n       if (dump & DISASS_DUMP)\n \t{"
    }
  ]
}