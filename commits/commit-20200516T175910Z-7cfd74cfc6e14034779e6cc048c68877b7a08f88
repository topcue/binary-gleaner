{
  "sha": "7cfd74cfc6e14034779e6cc048c68877b7a08f88",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6N2NmZDc0Y2ZjNmUxNDAzNDc3OWU2Y2MwNDhjNjg4NzdiN2EwOGY4OA==",
  "commit": {
    "author": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2020-05-16T17:59:10Z"
    },
    "committer": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2020-05-16T17:59:10Z"
    },
    "message": "Fix gdb.multi/multi-re-run.exp with native-gdbserver\n\nThe new exec-file-mismatch feature reveals that when running\ngdb.multi/multi-re-run.exp against --target_board=native-gdbserver,\nwe've been starting gdbserver with the wrong program:\n\n (gdb) spawn /home/pedro/brno/pedro/gdb/binutils-gdb/build/gdb/testsuite/../../gdbserver/gdbserver --once localhost:2347 /home/pedro/brno/pedro/gdb/binutils-gdb/build/gdb/te\n stsuite/outputs/gdb.multi/multi-re-run/multi-re-run-2\n Process /home/pedro/brno/pedro/gdb/binutils-gdb/build/gdb/testsuite/outputs/gdb.multi/multi-re-run/multi-re-run-2 created; pid = 6280\n Listening on port 2347\n target remote localhost:2347\n Remote debugging using localhost:2347\n warning: Mismatch between current exec-file /home/pedro/brno/pedro/gdb/binutils-gdb/build/gdb/testsuite/outputs/gdb.multi/multi-re-run/multi-re-run-1\n and automatically determined exec-file /home/pedro/brno/pedro/gdb/binutils-gdb/build/gdb/testsuite/outputs/gdb.multi/multi-re-run/multi-re-run-2\n exec-file-mismatch handling is currently \"ask\"\n Load new symbol table from \"/home/pedro/brno/pedro/gdb/binutils-gdb/build/gdb/testsuite/outputs/gdb.multi/multi-re-run/multi-re-run-2\"? (y or n) Quit\n (gdb) FAIL: gdb.multi/multi-re-run.exp: re_run_inf=1: iter=1: running to all_started in runto\n\nThe problem is that gdb_reload uses the last loaded file as binary to\nspawn, but we load the program for inferior 2 and then switch to\ninferior 1 and run it, so the last loaded file is the program for\ninferior 2.\n\nFix this by tweaking last_loaded_file.\n\ngdb/testsuite/ChangeLog:\n2020-05-16  Pedro Alves  <palves@redhat.com>\n\n\t* gdb.multi/multi-re-run.exp (test_re_run): Switch\n\tLAST_LOADED_FILE accordingly.",
    "tree": {
      "sha": "3ed186de3f8db31030312bbac9eae420b3e81bb9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3ed186de3f8db31030312bbac9eae420b3e81bb9"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7cfd74cfc6e14034779e6cc048c68877b7a08f88",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7cfd74cfc6e14034779e6cc048c68877b7a08f88",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7cfd74cfc6e14034779e6cc048c68877b7a08f88",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7cfd74cfc6e14034779e6cc048c68877b7a08f88/comments",
  "author": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7d93a1e0b6af703c75daa93456608f8bb5f34f13",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7d93a1e0b6af703c75daa93456608f8bb5f34f13",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7d93a1e0b6af703c75daa93456608f8bb5f34f13"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 12,
    "deletions": 0
  },
  "files": [
    {
      "sha": "0be2fd3386c3619b4994ec5d9f14710504986973",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7cfd74cfc6e14034779e6cc048c68877b7a08f88/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7cfd74cfc6e14034779e6cc048c68877b7a08f88/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=7cfd74cfc6e14034779e6cc048c68877b7a08f88",
      "patch": "@@ -1,3 +1,8 @@\n+2020-05-16  Pedro Alves  <palves@redhat.com>\n+\n+\t* gdb.multi/multi-re-run.exp (test_re_run): Switch\n+\tLAST_LOADED_FILE accordingly.\n+\n 2020-05-15  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n \n \t* gdb.base/alias.exp: Verify 'help aliases' shows user defined aliases."
    },
    {
      "sha": "a243293482406a9affb598817b9ed2994c2763c7",
      "filename": "gdb/testsuite/gdb.multi/multi-re-run.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7cfd74cfc6e14034779e6cc048c68877b7a08f88/gdb/testsuite/gdb.multi/multi-re-run.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7cfd74cfc6e14034779e6cc048c68877b7a08f88/gdb/testsuite/gdb.multi/multi-re-run.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.multi/multi-re-run.exp?ref=7cfd74cfc6e14034779e6cc048c68877b7a08f88",
      "patch": "@@ -51,6 +51,7 @@ proc test_re_run {re_run_inf} {\n     global binfile1 binfile2\n     global inferior_exited_re\n     global gdb_prompt\n+    global last_loaded_file\n \n     clean_restart ${binfile1}\n \n@@ -65,12 +66,17 @@ proc test_re_run {re_run_inf} {\n \n     if {$re_run_inf == 1} {\n \tset steady_inf 2\n+\tset steady_binfile $binfile2\n+\tset re_run_binfile $binfile1\n     } else {\n \tset steady_inf 1\n+\tset steady_binfile $binfile1\n+\tset re_run_binfile $binfile2\n     }\n \n     gdb_test \"inferior $steady_inf\" \"Switching to inferior $steady_inf.*\" \\\n \t\"switch to steady inferior\"\n+    set last_loaded_file $steady_binfile\n \n     # Run the steady inferior to a breakpoint, and let it stay stopped\n     # there.\n@@ -81,6 +87,7 @@ proc test_re_run {re_run_inf} {\n \n     gdb_test \"inferior $re_run_inf\" \"Switching to inferior $re_run_inf.*\" \\\n \t\"switch to re-run inferior\"\n+    set last_loaded_file $re_run_binfile\n \n     # Now run the RE_RUN_INF inferior a couple times.  GDB used to\n     # have a bug that caused the second run to fail to load"
    }
  ]
}