{
  "sha": "1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTI3M2IyZjhhYzg3NzhmMGM2ZjBmM2I0OTI5NDBlM2E1YmRkNzc3Ng==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-05-28T16:34:10Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-05-28T16:34:28Z"
    },
    "message": "x86: Restore PC16 relocation overflow check\n\nThe x86-64 psABI has\n\n---\nA program or object file using R_X86_64_8, R_X86_64_16, R_X86_64_PC16\nor R_X86_64_PC8 relocations is not conformant to this ABI, these\nrelocations are only added for documentation purposes.\n---\n\nSince x86 PC16 relocations have been used for 16-bit programs in an ELF32\nor ELF64 container, PC16 relocation should wrap-around in 16-bit address\nspace.  Revert\n\ncommit a7664973b24a242cd9ea17deb5eaf503065fc0bd\nAuthor: Jan Beulich <jbeulich@suse.com>\nDate:   Mon Apr 26 10:41:35 2021 +0200\n\n    x86: correct overflow checking for 16-bit PC-relative relocs\n\nand xfail the related tests.  Also revert\n\ncommit 50c95a739c91ae70cf8481936611aa1f5397a384\nAuthor: H.J. Lu <hjl.tools@gmail.com>\nDate:   Wed May 26 12:13:13 2021 -0700\n\n    x86: Propery check PC16 reloc overflow in 16-bit mode instructions\n\nwhile keeping PR ld/27905 tests for PC16 relocation in 16-bit programs.\n\nbfd/\n\n\tPR ld/27905\n\t* elf32-i386.c: Don't include \"libiberty.h\".\n\t(elf_howto_table): Revert commits a7664973b24 and 50c95a739c9.\n\t(elf_i386_rtype_to_howto): Revert commit 50c95a739c9.\n\t(elf_i386_info_to_howto_rel): Likewise.\n\t(elf_i386_tls_transition): Likewise.\n\t(elf_i386_relocate_section): Likewise.\n\t* elf64-x86-64.c (x86_64_elf_howto_table): Revert commits\n\ta7664973b24 and 50c95a739c9.\n\t(elf_x86_64_rtype_to_howto): Revert commit 50c95a739c9.\n\t* elfxx-x86.c (_bfd_x86_elf_parse_gnu_properties): Likewise.\n\t* elfxx-x86.h (elf_x86_obj_tdata): Likewise.\n\t(elf_x86_has_code16): Likewise.\n\nbinutils/\n\n\tPR ld/27905\n\t* readelf.c (decode_x86_feature_2): Revert commit 50c95a739c9.\n\ngas/\n\n\tPR ld/27905\n\t* config/tc-i386.c (set_code_flag): Revert commit 50c95a739c9.\n\t(set_16bit_gcc_code_flag): Likewise.\n\t(x86_cleanup): Likewise.\n\t* testsuite/gas/i386/code16-2.d: Updated.\n\t* testsuite/gas/i386/x86-64-code16-2.d: Likewise.\n\ninclude/\n\n\tPR ld/27905\n\t* elf/common.h (GNU_PROPERTY_X86_FEATURE_2_CODE16): Removed.\n\nld/\n\n\tPR ld/27905\n\t* testsuite/ld-i386/pcrel16-2.d: xfail.\n\t* testsuite/ld-x86-64/pcrel16-2.d: Likewise.",
    "tree": {
      "sha": "235fa6d65ad5972c26832a21c0b23d65793e6c9f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/235fa6d65ad5972c26832a21c0b23d65793e6c9f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9d7c4ba5e5b711824bb2cc5de21d28e3fd6de002",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d7c4ba5e5b711824bb2cc5de21d28e3fd6de002",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9d7c4ba5e5b711824bb2cc5de21d28e3fd6de002"
    }
  ],
  "stats": {
    "total": 166,
    "additions": 70,
    "deletions": 96
  },
  "files": [
    {
      "sha": "6242f3c76c7e0d72eb9f8846ae3fcf28299a2ede",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -1,3 +1,19 @@\n+2021-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27905\n+\t* elf32-i386.c: Don't include \"libiberty.h\".\n+\t(elf_howto_table): Revert commits a7664973b24 and 50c95a739c9.\n+\t(elf_i386_rtype_to_howto): Revert commit 50c95a739c9.\n+\t(elf_i386_info_to_howto_rel): Likewise.\n+\t(elf_i386_tls_transition): Likewise.\n+\t(elf_i386_relocate_section): Likewise.\n+\t* elf64-x86-64.c (x86_64_elf_howto_table): Revert commits\n+\ta7664973b24 and 50c95a739c9.\n+\t(elf_x86_64_rtype_to_howto): Revert commit 50c95a739c9.\n+\t* elfxx-x86.c (_bfd_x86_elf_parse_gnu_properties): Likewise.\n+\t* elfxx-x86.h (elf_x86_obj_tdata): Likewise.\n+\t(elf_x86_has_code16): Likewise.\n+\n 2021-05-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27905"
    },
    {
      "sha": "cf7cd076b1728fc8458e88ad16b23a11b7b19270",
      "filename": "bfd/elf32-i386.c",
      "status": "modified",
      "additions": 7,
      "deletions": 18,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elf32-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elf32-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-i386.c?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -22,7 +22,6 @@\n #include \"elf-vxworks.h\"\n #include \"dwarf2.h\"\n #include \"opcode/i386.h\"\n-#include \"libiberty.h\"\n \n /* 386 uses REL relocations instead of RELA.  */\n #define USE_REL\t1\n@@ -94,7 +93,7 @@ static reloc_howto_type elf_howto_table[]=\n   HOWTO(R_386_16, 0, 1, 16, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_386_16\",\n \ttrue, 0xffff, 0xffff, false),\n-  HOWTO(R_386_PC16, 0, 1, 16, true, 0, complain_overflow_signed,\n+  HOWTO(R_386_PC16, 0, 1, 16, true, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_386_PC16\",\n \ttrue, 0xffff, 0xffff, true),\n   HOWTO(R_386_8, 0, 0, 8, false, 0, complain_overflow_bitfield,\n@@ -176,14 +175,10 @@ static reloc_howto_type elf_howto_table[]=\n \t false,\t\t\t/* partial_inplace */\n \t 0,\t\t\t/* src_mask */\n \t 0,\t\t\t/* dst_mask */\n-\t false),\t\t/* pcrel_offset */\n+\t false)\t\t\t/* pcrel_offset */\n \n #define R_386_vt (R_386_GNU_VTENTRY + 1 - R_386_vt_offset)\n \n-/* Use complain_overflow_bitfield on R_386_PC16 for code16.  */\n-  HOWTO(R_386_PC16, 0, 1, 16, true, 0, complain_overflow_bitfield,\n-\tbfd_elf_generic_reloc, \"R_386_PC16\",\n-\ttrue, 0xffff, 0xffff, true)\n };\n \n #define X86_PCREL_TYPE_P(TYPE) ((TYPE) == R_386_PC32)\n@@ -374,7 +369,7 @@ elf_i386_reloc_name_lookup (bfd *abfd ATTRIBUTE_UNUSED,\n }\n \n static reloc_howto_type *\n-elf_i386_rtype_to_howto (bfd *abfd, unsigned r_type)\n+elf_i386_rtype_to_howto (unsigned r_type)\n {\n   unsigned int indx;\n \n@@ -389,11 +384,6 @@ elf_i386_rtype_to_howto (bfd *abfd, unsigned r_type)\n   /* PR 17512: file: 0f67f69d.  */\n   if (elf_howto_table [indx].type != r_type)\n     return NULL;\n-\n-  /* Use complain_overflow_bitfield on R_386_PC16 for code16.  */\n-  if (r_type == (unsigned int) R_386_PC16 && elf_x86_has_code16 (abfd))\n-    indx = ARRAY_SIZE (elf_howto_table) - 1;\n-\n   return &elf_howto_table[indx];\n }\n \n@@ -404,8 +394,7 @@ elf_i386_info_to_howto_rel (bfd *abfd,\n {\n   unsigned int r_type = ELF32_R_TYPE (dst->r_info);\n \n-  if ((cache_ptr->howto = elf_i386_rtype_to_howto (abfd, r_type))\n-      == NULL)\n+  if ((cache_ptr->howto = elf_i386_rtype_to_howto (r_type)) == NULL)\n     {\n       /* xgettext:c-format */\n       _bfd_error_handler (_(\"%pB: unsupported relocation type %#x\"),\n@@ -1153,8 +1142,8 @@ elf_i386_tls_transition (struct bfd_link_info *info, bfd *abfd,\n       reloc_howto_type *from, *to;\n       const char *name;\n \n-      from = elf_i386_rtype_to_howto (abfd, from_type);\n-      to = elf_i386_rtype_to_howto (abfd, to_type);\n+      from = elf_i386_rtype_to_howto (from_type);\n+      to = elf_i386_rtype_to_howto (to_type);\n \n       if (h)\n \tname = h->root.root.string;\n@@ -2085,7 +2074,7 @@ elf_i386_relocate_section (bfd *output_bfd,\n \t  continue;\n \t}\n \n-      howto = elf_i386_rtype_to_howto (input_bfd, r_type);\n+      howto = elf_i386_rtype_to_howto (r_type);\n       if (howto == NULL)\n \treturn _bfd_unrecognized_reloc (input_bfd, input_section, r_type);\n "
    },
    {
      "sha": "98fb88113c0d257056c08caa7b4e3797815bb1d8",
      "filename": "bfd/elf64-x86-64.c",
      "status": "modified",
      "additions": 1,
      "deletions": 13,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elf64-x86-64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elf64-x86-64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-x86-64.c?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -82,7 +82,7 @@ static reloc_howto_type x86_64_elf_howto_table[] =\n \tfalse),\n   HOWTO(R_X86_64_16, 0, 1, 16, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_X86_64_16\", false, 0, 0xffff, false),\n-  HOWTO(R_X86_64_PC16, 0, 1, 16, true, 0, complain_overflow_signed,\n+  HOWTO(R_X86_64_PC16, 0, 1, 16, true, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_X86_64_PC16\", false, 0, 0xffff, true),\n   HOWTO(R_X86_64_8, 0, 0, 8, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_X86_64_8\", false, 0, 0xff, false),\n@@ -187,10 +187,6 @@ static reloc_howto_type x86_64_elf_howto_table[] =\n \t _bfd_elf_rel_vtable_reloc_fn, \"R_X86_64_GNU_VTENTRY\", false, 0, 0,\n \t false),\n \n-/* Use complain_overflow_bitfield on R_X86_64_PC16 for code16.  */\n-  HOWTO(R_X86_64_PC16, 0, 1, 16, true, 0, complain_overflow_bitfield,\n-\tbfd_elf_generic_reloc, \"R_X86_64_PC16\", false, 0, 0xffff, true),\n-\n /* Use complain_overflow_bitfield on R_X86_64_32 for x32.  */\n   HOWTO(R_X86_64_32, 0, 2, 32, false, 0, complain_overflow_bitfield,\n \tbfd_elf_generic_reloc, \"R_X86_64_32\", false, 0, 0xffffffff,\n@@ -274,14 +270,6 @@ elf_x86_64_rtype_to_howto (bfd *abfd, unsigned r_type)\n       else\n \ti = ARRAY_SIZE (x86_64_elf_howto_table) - 1;\n     }\n-  else if (r_type == (unsigned int) R_X86_64_PC16)\n-    {\n-      /* Use complain_overflow_bitfield on R_X86_64_PC16 for code16.  */\n-      if (elf_x86_has_code16 (abfd))\n-\ti = ARRAY_SIZE (x86_64_elf_howto_table) - 2;\n-      else\n-\ti = r_type;\n-    }\n   else if (r_type < (unsigned int) R_X86_64_GNU_VTINHERIT\n \t   || r_type >= (unsigned int) R_X86_64_max)\n     {"
    },
    {
      "sha": "62d516aab8d3bba2aec7f436c99705ea6d4ea740",
      "filename": "bfd/elfxx-x86.c",
      "status": "modified",
      "additions": 1,
      "deletions": 8,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elfxx-x86.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elfxx-x86.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-x86.c?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -2353,7 +2353,6 @@ _bfd_x86_elf_parse_gnu_properties (bfd *abfd, unsigned int type,\n       || (type >= GNU_PROPERTY_X86_UINT32_OR_AND_LO\n \t  && type <= GNU_PROPERTY_X86_UINT32_OR_AND_HI))\n     {\n-      unsigned int number;\n       if (datasz != 4)\n \t{\n \t  _bfd_error_handler\n@@ -2362,13 +2361,7 @@ _bfd_x86_elf_parse_gnu_properties (bfd *abfd, unsigned int type,\n \t  return property_corrupt;\n \t}\n       prop = _bfd_elf_get_property (abfd, type, datasz);\n-      number = bfd_h_get_32 (abfd, ptr);\n-      if ((abfd->flags\n-\t   & (DYNAMIC | BFD_LINKER_CREATED | BFD_PLUGIN)) == 0\n-\t  && type == GNU_PROPERTY_X86_FEATURE_2_USED\n-\t  && (number & GNU_PROPERTY_X86_FEATURE_2_CODE16) != 0)\n-\telf_x86_has_code16 (abfd) = 1;\n-      prop->u.number |= number;\n+      prop->u.number |= bfd_h_get_32 (abfd, ptr);\n       prop->pr_kind = property_number;\n       return property_number;\n     }"
    },
    {
      "sha": "db11327e96f403bed1d4f582117fc04493c9735d",
      "filename": "bfd/elfxx-x86.h",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elfxx-x86.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/bfd/elfxx-x86.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-x86.h?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -549,9 +549,6 @@ struct elf_x86_obj_tdata\n \n   /* GOTPLT entries for TLS descriptors.  */\n   bfd_vma *local_tlsdesc_gotent;\n-\n-  /* Set if the objec file has 16-bit code.  */\n-  unsigned int has_code16 : 1;\n };\n \n enum elf_x86_plt_type\n@@ -587,9 +584,6 @@ struct elf_x86_plt\n #define elf_x86_local_tlsdesc_gotent(abfd) \\\n   (elf_x86_tdata (abfd)->local_tlsdesc_gotent)\n \n-#define elf_x86_has_code16(abfd) \\\n-  (elf_x86_tdata (abfd)->has_code16)\n-\n #define elf_x86_compute_jump_table_size(htab) \\\n   ((htab)->elf.srelplt->reloc_count * (htab)->got_entry_size)\n "
    },
    {
      "sha": "384c12eca17ce60c49de65ac8ec33fe1102ea47e",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27905\n+\t* readelf.c (decode_x86_feature_2): Revert commit 50c95a739c9.\n+\n 2021-05-27  Alan Modra  <amodra@gmail.com>\n \n \t* readelf (usage): Order -w letters to match --debug-dump= and"
    },
    {
      "sha": "d773b9a49314abbccaee07b071ada2bbba6003b1",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 0,
      "deletions": 3,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -19139,9 +19139,6 @@ decode_x86_feature_2 (unsigned int bitmask)\n \tcase GNU_PROPERTY_X86_FEATURE_2_XSAVEC:\n \t  printf (\"XSAVEC\");\n \t  break;\n-\tcase GNU_PROPERTY_X86_FEATURE_2_CODE16:\n-\t  printf (\"CODE16\");\n-\t  break;\n \tdefault:\n \t  printf (_(\"<unknown: %x>\"), bit);\n \t  break;"
    },
    {
      "sha": "49d2ceb058b5a3baf7d347abcda8b7d85df01109",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -1,3 +1,12 @@\n+2021-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27905\n+\t* config/tc-i386.c (set_code_flag): Revert commit 50c95a739c9.\n+\t(set_16bit_gcc_code_flag): Likewise.\n+\t(x86_cleanup): Likewise.\n+\t* testsuite/gas/i386/code16-2.d: Updated.\n+\t* testsuite/gas/i386/x86-64-code16-2.d: Likewise.\n+\n 2021-05-27  Peter Bergner  <bergner@linux.ibm.com>\n \n \t* testsuite/gas/ppc/vsx.d <xxmr, xxlnot>: Add tests."
    },
    {
      "sha": "d3441988e3475e7690658b36e9bbdb01cea0abcf",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 18,
      "deletions": 37,
      "changes": 55,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -2695,10 +2695,6 @@ static void\n set_code_flag (int value)\n {\n   update_code_flag (value, 0);\n-#if defined (OBJ_ELF) || defined (OBJ_MAYBE_ELF)\n-  if (value == CODE_16BIT)\n-    x86_feature_2_used |= GNU_PROPERTY_X86_FEATURE_2_CODE16;\n-#endif\n }\n \n static void\n@@ -2710,10 +2706,6 @@ set_16bit_gcc_code_flag (int new_code_flag)\n   cpu_arch_flags.bitfield.cpu64 = 0;\n   cpu_arch_flags.bitfield.cpuno64 = 1;\n   stackop_size = LONG_MNEM_SUFFIX;\n-#if defined (OBJ_ELF) || defined (OBJ_MAYBE_ELF)\n-  if (new_code_flag == CODE_16BIT)\n-    x86_feature_2_used |= GNU_PROPERTY_X86_FEATURE_2_CODE16;\n-#endif\n }\n \n static void\n@@ -9040,7 +9032,7 @@ x86_cleanup (void)\n   unsigned int isa_1_descsz_raw, feature_2_descsz_raw;\n   unsigned int padding;\n \n-  if (!IS_ELF || (!x86_used_note && !x86_feature_2_used))\n+  if (!IS_ELF || !x86_used_note)\n     return;\n \n   x86_feature_2_used |= GNU_PROPERTY_X86_FEATURE_2_X86;\n@@ -9080,23 +9072,15 @@ x86_cleanup (void)\n   bfd_set_section_alignment (sec, alignment);\n   elf_section_type (sec) = SHT_NOTE;\n \n-  if (x86_used_note)\n-    {\n-      /* GNU_PROPERTY_X86_ISA_1_USED: 4-byte type + 4-byte data size\n-\t + 4-byte data  */\n-      isa_1_descsz_raw = 4 + 4 + 4;\n-      /* Align GNU_PROPERTY_X86_ISA_1_USED.  */\n-      isa_1_descsz = (isa_1_descsz_raw + align_size_1) & ~align_size_1;\n-    }\n-  else\n-    {\n-      isa_1_descsz_raw = 0;\n-      isa_1_descsz = 0;\n-    }\n+  /* GNU_PROPERTY_X86_ISA_1_USED: 4-byte type + 4-byte data size\n+\t\t\t\t  + 4-byte data  */\n+  isa_1_descsz_raw = 4 + 4 + 4;\n+  /* Align GNU_PROPERTY_X86_ISA_1_USED.  */\n+  isa_1_descsz = (isa_1_descsz_raw + align_size_1) & ~align_size_1;\n \n   feature_2_descsz_raw = isa_1_descsz;\n   /* GNU_PROPERTY_X86_FEATURE_2_USED: 4-byte type + 4-byte data size\n-     + 4-byte data  */\n+\t\t\t\t      + 4-byte data  */\n   feature_2_descsz_raw += 4 + 4 + 4;\n   /* Align GNU_PROPERTY_X86_FEATURE_2_USED.  */\n   feature_2_descsz = ((feature_2_descsz_raw + align_size_1)\n@@ -9118,23 +9102,20 @@ x86_cleanup (void)\n   /* Write n_name.  */\n   memcpy (p + 4 * 3, \"GNU\", 4);\n \n-  if (isa_1_descsz != 0)\n-    {\n-      /* Write 4-byte type.  */\n-      md_number_to_chars (p + 4 * 4,\n-\t\t\t  (valueT) GNU_PROPERTY_X86_ISA_1_USED, 4);\n+  /* Write 4-byte type.  */\n+  md_number_to_chars (p + 4 * 4,\n+\t\t      (valueT) GNU_PROPERTY_X86_ISA_1_USED, 4);\n \n-      /* Write 4-byte data size.  */\n-      md_number_to_chars (p + 4 * 5, (valueT) 4, 4);\n+  /* Write 4-byte data size.  */\n+  md_number_to_chars (p + 4 * 5, (valueT) 4, 4);\n \n-      /* Write 4-byte data.  */\n-      md_number_to_chars (p + 4 * 6, (valueT) x86_isa_1_used, 4);\n+  /* Write 4-byte data.  */\n+  md_number_to_chars (p + 4 * 6, (valueT) x86_isa_1_used, 4);\n \n-      /* Zero out paddings.  */\n-      padding = isa_1_descsz - isa_1_descsz_raw;\n-      if (padding)\n-\tmemset (p + 4 * 7, 0, padding);\n-    }\n+  /* Zero out paddings.  */\n+  padding = isa_1_descsz - isa_1_descsz_raw;\n+  if (padding)\n+    memset (p + 4 * 7, 0, padding);\n \n   /* Write 4-byte type.  */\n   md_number_to_chars (p + isa_1_descsz + 4 * 4,"
    },
    {
      "sha": "f18c8cd62da1aac91ea3b8fd70a5a72e5cc73cd9",
      "filename": "gas/testsuite/gas/i386/code16-2.d",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/testsuite/gas/i386/code16-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/testsuite/gas/i386/code16-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/code16-2.d?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -1,8 +1,3 @@\n #name: i386 code16 2\n #as: -mx86-used-note=no --generate-missing-build-notes=no\n #readelf: -n\n-\n-Displaying notes found in: .note.gnu.property\n-[ \t]+Owner[ \t]+Data size[ \t]+Description\n-  GNU                  0x[0-9a-f]+\tNT_GNU_PROPERTY_TYPE_0\n-      Properties: x86 feature used: x86, CODE16"
    },
    {
      "sha": "5052353c00d88e69787fe98e7a2f262f7de7b54d",
      "filename": "gas/testsuite/gas/i386/x86-64-code16-2.d",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/testsuite/gas/i386/x86-64-code16-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/gas/testsuite/gas/i386/x86-64-code16-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-code16-2.d?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -2,8 +2,3 @@\n #name: x86-64 code16 2\n #as: -mx86-used-note=no --generate-missing-build-notes=no\n #readelf: -n\n-\n-Displaying notes found in: .note.gnu.property\n-[ \t]+Owner[ \t]+Data size[ \t]+Description\n-  GNU                  0x[0-9a-f]+\tNT_GNU_PROPERTY_TYPE_0\n-      Properties: x86 feature used: x86, CODE16"
    },
    {
      "sha": "19dc8e3db6f12821d3fce306b262b6ccec8b053c",
      "filename": "include/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/include/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/include/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/ChangeLog?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27905\n+\t* elf/common.h (GNU_PROPERTY_X86_FEATURE_2_CODE16): Removed.\n+\n 2021-05-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27905"
    },
    {
      "sha": "24d0a09b7c8f74558aaabbce295e19792f264b6d",
      "filename": "include/elf/common.h",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/include/elf/common.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/include/elf/common.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/elf/common.h?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -872,7 +872,6 @@\n #define GNU_PROPERTY_X86_FEATURE_2_XSAVEC\t(1U << 9)\n #define GNU_PROPERTY_X86_FEATURE_2_TMM\t\t(1U << 10)\n #define GNU_PROPERTY_X86_FEATURE_2_MASK\t\t(1U << 11)\n-#define GNU_PROPERTY_X86_FEATURE_2_CODE16\t(1U << 12)\n \n #define GNU_PROPERTY_X86_COMPAT_2_ISA_1_NEEDED \\\n   (GNU_PROPERTY_X86_UINT32_OR_LO + 0)"
    },
    {
      "sha": "263dee0305994f029d47129fc12fe60b800d6078",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27905\n+\t* testsuite/ld-i386/pcrel16-2.d: xfail.\n+\t* testsuite/ld-x86-64/pcrel16-2.d: Likewise.\n+\n 2021-05-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27905"
    },
    {
      "sha": "de9c779e81025ee06bf38d33f8877c859847e8f0",
      "filename": "ld/testsuite/ld-i386/pcrel16-2.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/ld/testsuite/ld-i386/pcrel16-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/ld/testsuite/ld-i386/pcrel16-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-i386/pcrel16-2.d?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -3,3 +3,4 @@\n #ld: -melf_i386\n #error: .*relocation truncated to fit: R_386_PC16 .*t16.*\n #error: .*relocation truncated to fit: R_386_PC16 .*_start.*\n+#xfail: *-*-*"
    },
    {
      "sha": "991dcd09646b90ec02936ed91fb3d3df9d01c237",
      "filename": "ld/testsuite/ld-x86-64/pcrel16-2.d",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/ld/testsuite/ld-x86-64/pcrel16-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776/ld/testsuite/ld-x86-64/pcrel16-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pcrel16-2.d?ref=1273b2f8ac8778f0c6f0f3b492940e3a5bdd7776",
      "patch": "@@ -3,3 +3,4 @@\n #ld:\n #error: .*relocation truncated to fit: R_X86_64_PC16 .*t16.*\n #error: .*relocation truncated to fit: R_X86_64_PC16 .*_start.*\n+#xfail: *-*-*"
    }
  ]
}