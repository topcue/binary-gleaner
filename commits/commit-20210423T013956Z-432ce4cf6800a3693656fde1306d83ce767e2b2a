{
  "sha": "432ce4cf6800a3693656fde1306d83ce767e2b2a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDMyY2U0Y2Y2ODAwYTM2OTM2NTZmZGUxMzA2ZDgzY2U3NjdlMmIyYQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-04-23T01:39:56Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-04-23T01:39:56Z"
    },
    "message": "Fix ptype/o bug with \"<no data fields>\"\n\nI noticed that when using ptype/o, the \"<no data fields>\" text that\nmay be emitted is indented incorrectly.  This patch fixes the bug and\nadds a new test case.\n\nI also removed a stray backslash from ptype-offsets.exp that I noticed\nwhile writing the test.  This seemed too trivial to warrant a separate\npatch.\n\ngdb/ChangeLog\n2021-04-22  Tom Tromey  <tom@tromey.com>\n\n\t* c-typeprint.c (c_type_print_base_struct_union): Use\n\tprint_spaces_filtered_with_print_options.\n\ngdb/testsuite/ChangeLog\n2021-04-22  Tom Tromey  <tom@tromey.com>\n\n\t* gdb.base/ptype-offsets.cc (struct empty_member): New.\n\t(main): Use empty_member.\n\t* gdb.base/ptype-offsets.exp: Add new test.",
    "tree": {
      "sha": "bdcee743c2655bfc754a470e1e64b500d3517239",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/bdcee743c2655bfc754a470e1e64b500d3517239"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/432ce4cf6800a3693656fde1306d83ce767e2b2a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/432ce4cf6800a3693656fde1306d83ce767e2b2a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/432ce4cf6800a3693656fde1306d83ce767e2b2a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/432ce4cf6800a3693656fde1306d83ce767e2b2a/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ae6a3f81a178760dc2e1dafcb680b69dc4be9a92",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ae6a3f81a178760dc2e1dafcb680b69dc4be9a92",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ae6a3f81a178760dc2e1dafcb680b69dc4be9a92"
    }
  ],
  "stats": {
    "total": 42,
    "additions": 37,
    "deletions": 5
  },
  "files": [
    {
      "sha": "5d869dbfa7d4ed45e695a7a22a3d1b72e5964d5b",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=432ce4cf6800a3693656fde1306d83ce767e2b2a",
      "patch": "@@ -1,3 +1,8 @@\n+2021-04-22  Tom Tromey  <tom@tromey.com>\n+\n+\t* c-typeprint.c (c_type_print_base_struct_union): Use\n+\tprint_spaces_filtered_with_print_options.\n+\n 2021-04-22  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \tPR gdb/27757"
    },
    {
      "sha": "72616a59af0063de9a3ccb94732dae5a4e649f70",
      "filename": "gdb/c-typeprint.c",
      "status": "modified",
      "additions": 3,
      "deletions": 4,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/c-typeprint.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/c-typeprint.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/c-typeprint.c?ref=432ce4cf6800a3693656fde1306d83ce767e2b2a",
      "patch": "@@ -1121,13 +1121,12 @@ c_type_print_base_struct_union (struct type *type, struct ui_file *stream,\n       if (type->num_fields () == 0 && TYPE_NFN_FIELDS (type) == 0\n \t  && TYPE_TYPEDEF_FIELD_COUNT (type) == 0)\n \t{\n+\t  print_spaces_filtered_with_print_options (level + 4, stream, flags);\n \t  if (type->is_stub ())\n-\t    fprintf_filtered (stream, _(\"%*s%p[<incomplete type>%p]\\n\"),\n-\t\t\t      level + 4, \"\",\n+\t    fprintf_filtered (stream, _(\"%p[<incomplete type>%p]\\n\"),\n \t\t\t      metadata_style.style ().ptr (), nullptr);\n \t  else\n-\t    fprintf_filtered (stream, _(\"%*s%p[<no data fields>%p]\\n\"),\n-\t\t\t      level + 4, \"\",\n+\t    fprintf_filtered (stream, _(\"%p[<no data fields>%p]\\n\"),\n \t\t\t      metadata_style.style ().ptr (), nullptr);\n \t}\n "
    },
    {
      "sha": "1a181f374755fe51a7ca5f21ded919ceb4f9de29",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=432ce4cf6800a3693656fde1306d83ce767e2b2a",
      "patch": "@@ -1,3 +1,9 @@\n+2021-04-22  Tom Tromey  <tom@tromey.com>\n+\n+\t* gdb.base/ptype-offsets.cc (struct empty_member): New.\n+\t(main): Use empty_member.\n+\t* gdb.base/ptype-offsets.exp: Add new test.\n+\n 2021-04-22  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* gdb.python/flexible-array-member.exp: Add check for Python"
    },
    {
      "sha": "dc21e34752f43619323694c5cc0a3ed58657fcf6",
      "filename": "gdb/testsuite/gdb.base/ptype-offsets.cc",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/testsuite/gdb.base/ptype-offsets.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/testsuite/gdb.base/ptype-offsets.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/ptype-offsets.cc?ref=432ce4cf6800a3693656fde1306d83ce767e2b2a",
      "patch": "@@ -185,6 +185,12 @@ struct static_member\n   int abc;\n };\n \n+struct empty_member\n+{\n+  struct { } empty;\n+  int an_int;\n+};\n+\n int\n main (int argc, char *argv[])\n {\n@@ -196,6 +202,7 @@ main (int argc, char *argv[])\n   struct asd f;\n   uint8_t i;\n   static_member stmember;\n+  empty_member emember;\n \n   return 0;\n }"
    },
    {
      "sha": "0a0bbc8706245c350aa6790e98985752fcf32a2c",
      "filename": "gdb/testsuite/gdb.base/ptype-offsets.exp",
      "status": "modified",
      "additions": 16,
      "deletions": 1,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/testsuite/gdb.base/ptype-offsets.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/432ce4cf6800a3693656fde1306d83ce767e2b2a/gdb/testsuite/gdb.base/ptype-offsets.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/ptype-offsets.exp?ref=432ce4cf6800a3693656fde1306d83ce767e2b2a",
      "patch": "@@ -336,7 +336,22 @@ gdb_test \"ptype/o static_member\" \\\n     [string_to_regexp [multi_line \\\n \"/* offset    |  size */  type = struct static_member \\{\" \\\n \"                           static static_member Empty;\" \\\n-\"\\/*    0      |     4 */    int abc;\" \\\n+\"/*    0      |     4 */    int abc;\" \\\n \"\" \\\n \"                           /* total size (bytes):    4 */\" \\\n \"                         \\}\"]]\n+\n+# Test that the \"no data fields\" text is indented properly.\n+gdb_test \"ptype/o empty_member\" \\\n+    [string_to_regexp [multi_line \\\n+\"/* offset    |  size */  type = struct empty_member \\{\" \\\n+\"/*    0      |     1 */    struct {\" \\\n+\"                               <no data fields>\" \\\n+\"\" \\\n+\"                               /* total size (bytes):    1 */\" \\\n+\"                           } empty;\" \\\n+\"/* XXX  3-byte hole  */\" \\\n+\"/*    4      |     4 */    int an_int;\" \\\n+\"\" \\\n+\"                           /* total size (bytes):    8 */\" \\\n+\"                         \\}\"]]"
    }
  ]
}