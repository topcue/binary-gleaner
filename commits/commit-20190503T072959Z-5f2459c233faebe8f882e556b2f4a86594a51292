{
  "sha": "5f2459c233faebe8f882e556b2f4a86594a51292",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWYyNDU5YzIzM2ZhZWJlOGY4ODJlNTU2YjJmNGE4NjU5NGE1MTI5Mg==",
  "commit": {
    "author": {
      "name": "Eli Zaretskii",
      "email": "eliz@gnu.org",
      "date": "2019-05-03T07:29:59Z"
    },
    "committer": {
      "name": "Eli Zaretskii",
      "email": "eliz@gnu.org",
      "date": "2019-05-03T07:29:59Z"
    },
    "message": "Fix lookup of separate debug file on MS-Windows.\n\nIf you put the separate debug file in a global debug directory, GDB on\nMS-Windows would fail to find it.  This happens because we obtain the\ndirectory to look up the debug file by concatenating the debug\ndirectory name with the leading directories of the executable, and the\nlatter includes the drive letter on MS-Windows.  So we get an invalid\nfile name like\n\n   d:/usr/lib/debug/d:/usr/bin/foo.debug\n\nThis commit fixes that by removing the colon of the drive letter,\nthus producing\n\n   d:/usr/lib/debug/d/usr/bin/foo.debug\n\ngdb/ChangeLog:\n2019-05-03  Eli Zaretskii  <eliz@gnu.org>\n\n\t* symfile.c (find_separate_debug_file): Remove colon from the\n\tdrive spec of DOS/Windows file names of the target, so that the\n\tfile name produced from DEBUGDIR and the target's directory will\n\tbe valid on DOS/Windows systems.\n\ngdb/doc/ChangeLog:\n2019-05-03  Eli Zaretskii  <eliz@gnu.org>\n\n\t* gdb.texinfo (Separate Debug Files): Document how the\n\tsubdirectory of the global debug directory is computed on\n\tMS-Windows/MS-DOS.",
    "tree": {
      "sha": "5af48662e4786e65e149b61ae9f2df9ef06b01f0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5af48662e4786e65e149b61ae9f2df9ef06b01f0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5f2459c233faebe8f882e556b2f4a86594a51292",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5f2459c233faebe8f882e556b2f4a86594a51292",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5f2459c233faebe8f882e556b2f4a86594a51292",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5f2459c233faebe8f882e556b2f4a86594a51292/comments",
  "author": {
    "login": "Eli-Zaretskii",
    "id": 20908835,
    "node_id": "MDQ6VXNlcjIwOTA4ODM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/20908835?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Eli-Zaretskii",
    "html_url": "https://github.com/Eli-Zaretskii",
    "followers_url": "https://api.github.com/users/Eli-Zaretskii/followers",
    "following_url": "https://api.github.com/users/Eli-Zaretskii/following{/other_user}",
    "gists_url": "https://api.github.com/users/Eli-Zaretskii/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Eli-Zaretskii/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Eli-Zaretskii/subscriptions",
    "organizations_url": "https://api.github.com/users/Eli-Zaretskii/orgs",
    "repos_url": "https://api.github.com/users/Eli-Zaretskii/repos",
    "events_url": "https://api.github.com/users/Eli-Zaretskii/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Eli-Zaretskii/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "Eli-Zaretskii",
    "id": 20908835,
    "node_id": "MDQ6VXNlcjIwOTA4ODM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/20908835?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Eli-Zaretskii",
    "html_url": "https://github.com/Eli-Zaretskii",
    "followers_url": "https://api.github.com/users/Eli-Zaretskii/followers",
    "following_url": "https://api.github.com/users/Eli-Zaretskii/following{/other_user}",
    "gists_url": "https://api.github.com/users/Eli-Zaretskii/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Eli-Zaretskii/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Eli-Zaretskii/subscriptions",
    "organizations_url": "https://api.github.com/users/Eli-Zaretskii/orgs",
    "repos_url": "https://api.github.com/users/Eli-Zaretskii/repos",
    "events_url": "https://api.github.com/users/Eli-Zaretskii/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Eli-Zaretskii/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "41f61c65a2e1cfdb4aca3bccf6e11025495ba02e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/41f61c65a2e1cfdb4aca3bccf6e11025495ba02e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/41f61c65a2e1cfdb4aca3bccf6e11025495ba02e"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 42,
    "deletions": 3
  },
  "files": [
    {
      "sha": "efe07afd82acc7070eaf1f9f2786ed094f32e022",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5f2459c233faebe8f882e556b2f4a86594a51292",
      "patch": "@@ -1,3 +1,10 @@\n+2019-05-03  Eli Zaretskii  <eliz@gnu.org>\n+\n+\t* symfile.c (find_separate_debug_file): Remove colon from the\n+\tdrive spec of DOS/Windows file names of the target, so that the\n+\tfile name produced from DEBUGDIR and the target's directory will\n+\tbe valid on DOS/Windows systems.\n+\n 2019-05-02  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* rust-lang.c (val_print_struct): Handle printing structures"
    },
    {
      "sha": "a26e20c823cacab6091975a6d3500b8d9cb77368",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=5f2459c233faebe8f882e556b2f4a86594a51292",
      "patch": "@@ -1,3 +1,9 @@\n+2019-05-03  Eli Zaretskii  <eliz@gnu.org>\n+\n+\t* gdb.texinfo (Separate Debug Files): Document how the\n+\tsubdirectory of the global debug directory is computed on\n+\tMS-Windows/MS-DOS.\n+\n 2019-04-29  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.texinfo (Print Settings): Document 'print max-depth'."
    },
    {
      "sha": "dd8ae91b937c5f85a67b4908952d582586e2e163",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=5f2459c233faebe8f882e556b2f4a86594a51292",
      "patch": "@@ -20007,9 +20007,13 @@ uses two different methods of looking for the debug file:\n @item\n For the ``debug link'' method, @value{GDBN} looks up the named file in\n the directory of the executable file, then in a subdirectory of that\n-directory named @file{.debug}, and finally under each one of the global debug\n-directories, in a subdirectory whose name is identical to the leading\n-directories of the executable's absolute file name.\n+directory named @file{.debug}, and finally under each one of the\n+global debug directories, in a subdirectory whose name is identical to\n+the leading directories of the executable's absolute file name.  (On\n+MS-Windows/MS-DOS, the drive letter of the executable's leading\n+directories is converted to a one-letter subdirectory, i.e.@:\n+@file{d:/usr/bin/} is converted to @file{/d/usr/bin/}, because Windows\n+filesystems disallow colons in file names.)\n \n @item\n For the ``build ID'' method, @value{GDBN} looks in the"
    },
    {
      "sha": "af99da18f7affb8e386cad0894e6efa4302ffeb7",
      "filename": "gdb/symfile.c",
      "status": "modified",
      "additions": 22,
      "deletions": 0,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/symfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f2459c233faebe8f882e556b2f4a86594a51292/gdb/symfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile.c?ref=5f2459c233faebe8f882e556b2f4a86594a51292",
      "patch": "@@ -1443,11 +1443,33 @@ find_separate_debug_file (const char *dir,\n     = dirnames_to_char_ptr_vec (debug_file_directory);\n   gdb::unique_xmalloc_ptr<char> canon_sysroot = gdb_realpath (gdb_sysroot);\n \n+ /* MS-Windows/MS-DOS don't allow colons in file names; we must\n+    convert the drive letter into a one-letter directory, so that the\n+    file name resulting from splicing below will be valid.\n+\n+    FIXME: The below only works when GDB runs on MS-Windows/MS-DOS.\n+    There are various remote-debugging scenarios where such a\n+    transformation of the drive letter might be required when GDB runs\n+    on a Posix host, see\n+\n+    https://sourceware.org/ml/gdb-patches/2019-04/msg00605.html\n+\n+    If some of those scenarions need to be supported, we will need to\n+    use a different condition for HAS_DRIVE_SPEC and a different macro\n+    instead of STRIP_DRIVE_SPEC, which work on Posix systems as well.  */\n+  std::string drive;\n+  if (HAS_DRIVE_SPEC (dir_notarget))\n+    {\n+      drive = dir_notarget[0];\n+      dir_notarget = STRIP_DRIVE_SPEC (dir_notarget);\n+    }\n+\n   for (const gdb::unique_xmalloc_ptr<char> &debugdir : debugdir_vec)\n     {\n       debugfile = target_prefix ? \"target:\" : \"\";\n       debugfile += debugdir.get ();\n       debugfile += \"/\";\n+      debugfile += drive;\n       debugfile += dir_notarget;\n       debugfile += debuglink;\n "
    }
  ]
}