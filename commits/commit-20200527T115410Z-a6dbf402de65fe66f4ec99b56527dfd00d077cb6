{
  "sha": "a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTZkYmY0MDJkZTY1ZmU2NmY0ZWM5OWI1NjUyN2RmZDAwZDA3N2NiNg==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-05-27T11:53:54Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-05-27T11:54:10Z"
    },
    "message": "ld: Add --warn-textrel and obsolete --warn-shared-textrel\n\n--warn-shared-textrel and -z text apply to both shared object and PIE.\nAdd --warn-textrel and obsolete --warn-shared-textrel.  Consolidate\n--warn-textrel and -z text/notext/textoff implementation.\n\nbfd/\n\n\tPR ld/22909\n\t* elflink.c (bfd_elf_final_link): Use bfd_link_textrel_check.\n\tCheck bfd_link_dll when issue a DT_TEXTREL warning.\n\t* elfxx-x86.c (maybe_set_textrel): Likewise.\n\t(_bfd_x86_elf_size_dynamic_sections): Likewise.\n\ninclude/\n\n\tPR ld/22909\n\t* bfdlink.h (textrel_check_method): New enum.\n\t(bfd_link_textrel_check): New.\n\t(bfd_link_info): Replace warn_shared_textrel and error_textrel\n\twith textrel_check.\n\nld/\n\n\tPR ld/22909\n\t* NEWS: Mention --warn-textrel.\n\t* ld.texi: Update -z text/notext/textoff.  Add --warn-textrel.\n\tRemove --warn-shared-textrel.\n\t* ldlex.h (option_values): Rename OPTION_WARN_SHARED_TEXTREL to\n\tOPTION_WARN_TEXTREL.\n\t* lexsup.c (ld_options): Add --warn-textrel.  Obsolete\n\t--warn-shared-textrel.\n\t(parse_args): Updated.\n\t(elf_shlib_list_options): Check link_info.textrel_check.\n\t* emultempl/elf.em: Updated.\n\t* testsuite/ld-elf/pr19539.d: Replace -z notext with\n\t--warn-textrel.  Expect a warning.\n\t* testsuite/ld-i386/warn1.d: Update expected warning.",
    "tree": {
      "sha": "a264f6b6544f748f3d7dea562ee44cb47a8d9dd1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a264f6b6544f748f3d7dea562ee44cb47a8d9dd1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "25e1eca8faf1c29d28e57b37d6b5e3810b7b870b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/25e1eca8faf1c29d28e57b37d6b5e3810b7b870b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/25e1eca8faf1c29d28e57b37d6b5e3810b7b870b"
    }
  ],
  "stats": {
    "total": 133,
    "additions": 98,
    "deletions": 35
  },
  "files": [
    {
      "sha": "0fe164458ed97ec9b68f78e01fc910d28ab2c01f",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1,3 +1,11 @@\n+2020-05-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/22909\n+\t* elflink.c (bfd_elf_final_link): Use bfd_link_textrel_check.\n+\tCheck bfd_link_dll when issue a DT_TEXTREL warning.\n+\t* elfxx-x86.c (maybe_set_textrel): Likewise.\n+\t(_bfd_x86_elf_size_dynamic_sections): Likewise.\n+\n 2020-05-26  Nick Clifton  <nickc@redhat.com>\n \n \t* plugin.c (try_load_plugin): Extend error message when a plugin"
    },
    {
      "sha": "f87927f0bd8f7b71d41ff23c517d49d8895728ad",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 6,
      "deletions": 4,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -12896,8 +12896,7 @@ bfd_elf_final_link (bfd *abfd, struct bfd_link_info *info)\n \tgoto error_return;\n \n       /* Check for DT_TEXTREL (late, in case the backend removes it).  */\n-      if (((info->warn_shared_textrel && bfd_link_pic (info))\n-\t   || info->error_textrel)\n+      if (bfd_link_textrel_check (info)\n \t  && (o = bfd_get_linker_section (dynobj, \".dynamic\")) != NULL)\n \t{\n \t  bfd_byte *dyncon, *dynconend;\n@@ -12912,12 +12911,15 @@ bfd_elf_final_link (bfd *abfd, struct bfd_link_info *info)\n \n \t      if (dyn.d_tag == DT_TEXTREL)\n \t\t{\n-\t\t  if (info->error_textrel)\n+\t\t  if (info->textrel_check == textrel_check_error)\n \t\t    info->callbacks->einfo\n \t\t      (_(\"%P%X: read-only segment has dynamic relocations\\n\"));\n+\t\t  else if (bfd_link_dll (info))\n+\t\t    info->callbacks->einfo\n+\t\t      (_(\"%P: warning: creating DT_TEXTREL in a shared object\\n\"));\n \t\t  else\n \t\t    info->callbacks->einfo\n-\t\t      (_(\"%P: warning: creating a DT_TEXTREL in a shared object\\n\"));\n+\t\t      (_(\"%P: warning: creating DT_TEXTREL in a PIE\\n\"));\n \t\t  break;\n \t\t}\n \t    }"
    },
    {
      "sha": "6cc47afd7eadc1b6f5b42a33cf84dbd6183effda",
      "filename": "bfd/elfxx-x86.c",
      "status": "modified",
      "additions": 2,
      "deletions": 4,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/bfd/elfxx-x86.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/bfd/elfxx-x86.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-x86.c?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -575,8 +575,7 @@ maybe_set_textrel (struct elf_link_hash_entry *h, void *inf)\n \t\t\t\t\"in read-only section `%pA'\\n\"),\n \t\t\t      sec->owner, h->root.root.string, sec);\n \n-      if ((info->warn_shared_textrel && bfd_link_pic (info))\n-\t  || info->error_textrel)\n+      if (bfd_link_textrel_check (info))\n \t/* xgettext:c-format */\n \tinfo->callbacks->einfo (_(\"%P: %pB: warning: relocation against `%s' \"\n \t\t\t\t  \"in read-only section `%pA'\\n\"),\n@@ -1117,8 +1116,7 @@ _bfd_x86_elf_size_dynamic_sections (bfd *output_bfd,\n \t\t      && (info->flags & DF_TEXTREL) == 0)\n \t\t    {\n \t\t      info->flags |= DF_TEXTREL;\n-\t\t      if ((info->warn_shared_textrel && bfd_link_pic (info))\n-\t\t\t  || info->error_textrel)\n+\t\t      if (bfd_link_textrel_check (info))\n \t\t\t/* xgettext:c-format */\n \t\t\tinfo->callbacks->einfo\n \t\t\t  (_(\"%P: %pB: warning: relocation \""
    },
    {
      "sha": "7d114012b13310e2ecc15892eb1303fd3dda4bf2",
      "filename": "include/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/include/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/include/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/ChangeLog?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1,3 +1,11 @@\n+2020-05-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/22909\n+\t* bfdlink.h (textrel_check_method): New enum.\n+\t(bfd_link_textrel_check): New.\n+\t(bfd_link_info): Replace warn_shared_textrel and error_textrel\n+\twith textrel_check.\n+\n 2020-05-25  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* elf/common.h: Update comments for ET_EXEC and ET_DYN."
    },
    {
      "sha": "34a0d2ec4efaec3334af336e729be2d1cb1a6e93",
      "filename": "include/bfdlink.h",
      "status": "modified",
      "additions": 14,
      "deletions": 5,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/include/bfdlink.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/include/bfdlink.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/bfdlink.h?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -273,6 +273,18 @@ enum report_method\n   RM_DIAGNOSE,\n };\n \n+/* How to handle DT_TEXTREL.  */\n+\n+enum textrel_check_method\n+{\n+  textrel_check_none,\n+  textrel_check_warning,\n+  textrel_check_error\n+};\n+\n+#define bfd_link_textrel_check(info) \\\n+  (info->textrel_check != textrel_check_none)\n+\n typedef enum {with_flags, without_flags} flag_type;\n \n /* A section flag list.  */\n@@ -410,11 +422,8 @@ struct bfd_link_info\n      should be created.  1 for DWARF2 tables, 2 for compact tables.  */\n   unsigned int eh_frame_hdr_type: 2;\n \n-  /* TRUE if we should warn when adding a DT_TEXTREL to a shared object.  */\n-  unsigned int warn_shared_textrel: 1;\n-\n-  /* TRUE if we should error when adding a DT_TEXTREL.  */\n-  unsigned int error_textrel: 1;\n+  /* What to do with DT_TEXTREL in output.  */\n+  ENUM_BITFIELD (textrel_check_method) textrel_check: 2;\n \n   /* TRUE if .hash section should be created.  */\n   unsigned int emit_hash: 1;"
    },
    {
      "sha": "3fd9b7457ee87d3fbb1c923e8576fe5e27db2f64",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1,3 +1,20 @@\n+2020-05-27  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/22909\n+\t* NEWS: Mention --warn-textrel.\n+\t* ld.texi: Update -z text/notext/textoff.  Add --warn-textrel.\n+\tRemove --warn-shared-textrel.\n+\t* ldlex.h (option_values): Rename OPTION_WARN_SHARED_TEXTREL to\n+\tOPTION_WARN_TEXTREL.\n+\t* lexsup.c (ld_options): Add --warn-textrel.  Obsolete\n+\t--warn-shared-textrel.\n+\t(parse_args): Updated.\n+\t(elf_shlib_list_options): Check link_info.textrel_check.\n+\t* emultempl/elf.em: Updated.\n+\t* testsuite/ld-elf/pr19539.d: Replace -z notext with\n+\t--warn-textrel.  Expect a warning.\n+\t* testsuite/ld-i386/warn1.d: Update expected warning.\n+\n 2020-05-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* testsuite/ld-ifunc/ifunc-23a-x86.d: Skip *-*-lynxos *-*-nto*."
    },
    {
      "sha": "0aaa13d4874c1428849391422a56abd3708fcfe6",
      "filename": "ld/NEWS",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/NEWS?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1,5 +1,8 @@\n -*- text -*-\n \n+* Add a command-line option for ELF linker, --warn-textrel, to warn that\n+  DT_TEXTREL is set in a position-independent executable or shared object.\n+\n * Add command-line options --enable-non-contiguous-regions and\n   --enable-non-contiguous-regions-warnings.\n "
    },
    {
      "sha": "c4979eb9538234f9629bc32a5272ad07c2d358cd",
      "filename": "ld/emultempl/elf.em",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/emultempl/elf.em",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/emultempl/elf.em",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/emultempl/elf.em?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -803,11 +803,11 @@ fragment <<EOF\n       else if (strcmp (optarg, \"nocommon\") == 0)\n \tlink_info.elf_stt_common = no_elf_stt_common;\n       else if (strcmp (optarg, \"text\") == 0)\n-\tlink_info.error_textrel = TRUE;\n+\tlink_info.textrel_check = textrel_check_error;\n       else if (strcmp (optarg, \"notext\") == 0)\n-\tlink_info.error_textrel = FALSE;\n+\tlink_info.textrel_check = textrel_check_none;\n       else if (strcmp (optarg, \"textoff\") == 0)\n-\tlink_info.error_textrel = FALSE;\n+\tlink_info.textrel_check = textrel_check_none;\n EOF\n fi\n "
    },
    {
      "sha": "a7ec0d01b3dd2675937ac6a5b57cd72e6f827cf1",
      "filename": "ld/ld.texi",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/ld.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/ld.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ld.texi?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1358,9 +1358,9 @@ Specifying zero will override any default non-zero sized\n @item text\n @itemx notext\n @itemx textoff\n-Report an error if DT_TEXTREL is set, i.e., if the binary has dynamic\n-relocations in read-only sections.  Don't report an error if\n-@samp{notext} or @samp{textoff}.\n+Report an error if DT_TEXTREL is set, i.e., if the position-independent\n+or shared object has dynamic relocations in read-only sections.  Don't\n+report an error if @samp{notext} or @samp{textoff}.\n \n @item undefs\n Do not report unresolved symbol references from regular object files,\n@@ -2404,9 +2404,10 @@ The address will only be changed if it not explicitly specified; that\n is, if the @code{SECTIONS} command does not specify a start address for\n the section (@pxref{SECTIONS}).\n \n-@kindex --warn-shared-textrel\n-@item --warn-shared-textrel\n-Warn if the linker adds a DT_TEXTREL to a shared object.\n+@kindex --warn-textrel\n+@item --warn-textrel\n+Warn if the linker adds DT_TEXTREL to a position-independent executable\n+or shared object.\n \n @kindex --warn-alternate-em\n @item --warn-alternate-em"
    },
    {
      "sha": "318ac7a789d663969ea9c5b99e30b5acf847f7a7",
      "filename": "ld/ldlex.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/ldlex.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/ldlex.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlex.h?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -130,7 +130,7 @@ enum option_values\n   OPTION_UNRESOLVED_SYMBOLS,\n   OPTION_WARN_UNRESOLVED_SYMBOLS,\n   OPTION_ERROR_UNRESOLVED_SYMBOLS,\n-  OPTION_WARN_SHARED_TEXTREL,\n+  OPTION_WARN_TEXTREL,\n   OPTION_WARN_ALTERNATE_EM,\n   OPTION_REDUCE_MEMORY_OVERHEADS,\n #ifdef ENABLE_PLUGINS"
    },
    {
      "sha": "3733a7c8935a6c16286a6ff587978767dab6a4c3",
      "filename": "ld/lexsup.c",
      "status": "modified",
      "additions": 26,
      "deletions": 10,
      "changes": 36,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/lexsup.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/lexsup.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/lexsup.c?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -516,9 +516,11 @@ static const struct ld_option ld_options[] =\n   { {\"warn-section-align\", no_argument, NULL, OPTION_WARN_SECTION_ALIGN},\n     '\\0', NULL, N_(\"Warn if start of section changes due to alignment\"),\n     TWO_DASHES },\n-  { {\"warn-shared-textrel\", no_argument, NULL, OPTION_WARN_SHARED_TEXTREL},\n-    '\\0', NULL, N_(\"Warn if shared object has DT_TEXTREL\"),\n+  { {\"warn-textrel\", no_argument, NULL, OPTION_WARN_TEXTREL},\n+    '\\0', NULL, N_(\"Warn if outpout has DT_TEXTREL\"),\n     TWO_DASHES },\n+  { {\"warn-shared-textrel\", no_argument, NULL, OPTION_WARN_TEXTREL},\n+    '\\0', NULL, NULL, NO_HELP },\n   { {\"warn-alternate-em\", no_argument, NULL, OPTION_WARN_ALTERNATE_EM},\n     '\\0', NULL, N_(\"Warn if an object has alternate ELF machine code\"),\n     TWO_DASHES },\n@@ -1438,8 +1440,8 @@ parse_args (unsigned argc, char **argv)\n \tcase OPTION_WARN_SECTION_ALIGN:\n \t  config.warn_section_align = TRUE;\n \t  break;\n-\tcase OPTION_WARN_SHARED_TEXTREL:\n-\t  link_info.warn_shared_textrel = TRUE;\n+\tcase OPTION_WARN_TEXTREL:\n+\t  link_info.textrel_check = textrel_check_warning;\n \t  break;\n \tcase OPTION_WARN_ALTERNATE_EM:\n \t  link_info.warn_alternate_em = TRUE;\n@@ -1846,12 +1848,26 @@ elf_shlib_list_options (FILE *file)\n   -z nocommon                 Generate common symbols with STT_OBJECT type\\n\"));\n   fprintf (file, _(\"\\\n   -z stack-size=SIZE          Set size of stack segment\\n\"));\n-  fprintf (file, _(\"\\\n-  -z text                     Treat DT_TEXTREL in shared object as error\\n\"));\n-  fprintf (file, _(\"\\\n-  -z notext                   Don't treat DT_TEXTREL in shared object as error\\n\"));\n-  fprintf (file, _(\"\\\n-  -z textoff                  Don't treat DT_TEXTREL in shared object as error\\n\"));\n+  if (link_info.textrel_check == textrel_check_error)\n+    fprintf (file, _(\"\\\n+  -z text                     Treat DT_TEXTREL in output as error (default)\\n\"));\n+  else\n+    fprintf (file, _(\"\\\n+  -z text                     Treat DT_TEXTREL in output as error\\n\"));\n+  if (link_info.textrel_check == textrel_check_none)\n+    {\n+      fprintf (file, _(\"\\\n+  -z notext                   Don't treat DT_TEXTREL in output as error (default)\\n\"));\n+      fprintf (file, _(\"\\\n+  -z textoff                  Don't treat DT_TEXTREL in output as error (default)\\n\"));\n+    }\n+  else\n+    {\n+      fprintf (file, _(\"\\\n+  -z notext                   Don't treat DT_TEXTREL in output as error\\n\"));\n+      fprintf (file, _(\"\\\n+  -z textoff                  Don't treat DT_TEXTREL in output as error\\n\"));\n+    }\n }\n \n static void"
    },
    {
      "sha": "211d3e16398ad272278fb297fa0c2eb5faab0ee3",
      "filename": "ld/testsuite/ld-elf/pr19539.d",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/testsuite/ld-elf/pr19539.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/testsuite/ld-elf/pr19539.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr19539.d?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1,7 +1,8 @@\n #source: start.s\n #source: pr19539.s\n-#ld: -pie -T pr19539.t -z notext\n+#ld: -pie -T pr19539.t --warn-textrel\n #readelf : --dyn-syms --wide\n+#warning: .*: creating DT_TEXTREL in a PIE\n #target: *-*-linux* *-*-gnu* *-*-solaris* arm*-*-uclinuxfdpiceabi\n #xfail: cris*-*-* ![check_pie_support] \n "
    },
    {
      "sha": "c00fdb36dc19196014be855ba690d5943ecc196a",
      "filename": "ld/testsuite/ld-i386/warn1.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/testsuite/ld-i386/warn1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a6dbf402de65fe66f4ec99b56527dfd00d077cb6/ld/testsuite/ld-i386/warn1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-i386/warn1.d?ref=a6dbf402de65fe66f4ec99b56527dfd00d077cb6",
      "patch": "@@ -1,4 +1,4 @@\n #name: --warn-shared-textrel --fatal-warnings\n #as: --32\n #ld: -shared -melf_i386 --warn-shared-textrel --fatal-warnings\n-#error: .*warning: creating a DT_TEXTREL in a shared object\n+#error: .*warning: creating DT_TEXTREL in a shared object"
    }
  ]
}