{
  "sha": "1ef3994a3740f657e9af9dc354962a2c093586df",
  "node_id": "C_kwDOANOeidoAKDFlZjM5OTRhMzc0MGY2NTdlOWFmOWRjMzU0OTYyYTJjMDkzNTg2ZGY",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2022-01-06T13:17:40Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2022-01-06T13:17:40Z"
    },
    "message": "x86-64: restrict PC32 -> PLT32 conversion\n\nNeither non-64-bit code nor uses with a non-zero offset from a symbol\nshould be converted to PLT32, as an eventual PLT entry would not express\nwhat was requested.",
    "tree": {
      "sha": "ad8ea8e3b78f0b79c6fed3313807005f643684dd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ad8ea8e3b78f0b79c6fed3313807005f643684dd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1ef3994a3740f657e9af9dc354962a2c093586df",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1ef3994a3740f657e9af9dc354962a2c093586df",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1ef3994a3740f657e9af9dc354962a2c093586df",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1ef3994a3740f657e9af9dc354962a2c093586df/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1f927a4a28e1cda3ada934ea118f81e3707e3911",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1f927a4a28e1cda3ada934ea118f81e3707e3911",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1f927a4a28e1cda3ada934ea118f81e3707e3911"
    }
  ],
  "stats": {
    "total": 10,
    "additions": 7,
    "deletions": 3
  },
  "files": [
    {
      "sha": "387fa6074efd88f95cd838bd82b53816e826054c",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1ef3994a3740f657e9af9dc354962a2c093586df/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1ef3994a3740f657e9af9dc354962a2c093586df/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=1ef3994a3740f657e9af9dc354962a2c093586df",
      "patch": "@@ -8857,6 +8857,8 @@ output_branch (void)\n       off = 0;\n     }\n \n+  frag_now->tc_frag_data.code64 = flag_code == CODE_64BIT;\n+\n   /* 1 possible extra opcode + 4 byte displacement go in var part.\n      Pass reloc in fr_var.  */\n   frag_var (rs_machine_dependent, 5, i.reloc[0], subtype, sym, off, p);\n@@ -8985,8 +8987,8 @@ output_jump (void)\n     }\n \n #if defined (OBJ_ELF) || defined (OBJ_MAYBE_ELF)\n-  if (size == 4\n-      && jump_reloc == NO_RELOC\n+  if (flag_code == CODE_64BIT && size == 4\n+      && jump_reloc == NO_RELOC && i.op[0].disps->X_add_number == 0\n       && need_plt32_p (i.op[0].disps->X_add_symbol))\n     jump_reloc = BFD_RELOC_X86_64_PLT32;\n #endif\n@@ -12294,7 +12296,8 @@ md_estimate_size_before_relax (fragS *fragP, segT segment)\n       else if (size == 2)\n \treloc_type = BFD_RELOC_16_PCREL;\n #if defined (OBJ_ELF) || defined (OBJ_MAYBE_ELF)\n-      else if (need_plt32_p (fragP->fr_symbol))\n+      else if (fragP->tc_frag_data.code64 && fragP->fr_offset == 0\n+\t       && need_plt32_p (fragP->fr_symbol))\n \treloc_type = BFD_RELOC_X86_64_PLT32;\n #endif\n       else"
    },
    {
      "sha": "603ae475bbcd56db1499f97afe816401dde29165",
      "filename": "gas/config/tc-i386.h",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1ef3994a3740f657e9af9dc354962a2c093586df/gas/config/tc-i386.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1ef3994a3740f657e9af9dc354962a2c093586df/gas/config/tc-i386.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.h?ref=1ef3994a3740f657e9af9dc354962a2c093586df",
      "patch": "@@ -283,6 +283,7 @@ struct i386_tc_frag_data\n   unsigned int mf_type : 3;\n   unsigned int classified : 1;\n   unsigned int branch_type : 3;\n+  unsigned int code64 : 1; /* Only set by output_branch for now.  */\n };\n \n /* We need to emit the right NOP pattern in .align frags.  This is"
    }
  ]
}