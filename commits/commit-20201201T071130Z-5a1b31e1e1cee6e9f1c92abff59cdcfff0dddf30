{
  "sha": "5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWExYjMxZTFlMWNlZTZlOWYxYzkyYWJmZjU5Y2RjZmZmMGRkZGYzMA==",
  "commit": {
    "author": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2020-11-20T07:35:17Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2020-12-01T07:11:30Z"
    },
    "message": "RISC-V: Add zifencei and prefixed h class extensions.\n\n\tbfd/\n\t* elfxx-riscv.c (riscv_parse_std_ext): Stop parsing standard\n\textensions when parsed h keyword.\n\t(riscv_get_prefix_class): Support prefixed h class.\n\t(riscv_std_h_ext_strtab): Likewise.\n\t(riscv_ext_h_valid_p): Likewise.\n\t(parse_config): Likewise.\n\t(riscv_std_z_ext_strtab): Add zifencei.\n\t* elfxx-riscv.h (riscv_isa_ext_class): Add RV_ISA_CLASS_H.\n\n\tgas/\n\t* testsuite/gas/riscv/march-fail-order-z.d: New testcase, check\n\torders of prefixed z extensions.\n\t* testsuite/gas/riscv/march-fail-order-z.l: Likewise.\n\t* testsuite/gas/riscv/march-fail-single-char-h.d: New testcase.\n\t* testsuite/gas/riscv/march-fail-single-char.l: Updated.\n\t* testsuite/gas/riscv/march-fail-unknown-h.d: New testcase.\n\t* testsuite/gas/riscv/march-fail-unknown.l: Updated.\n\n\topcodes/\n\t* riscv-opc.c (riscv_ext_version_table): Add zifencei.",
    "tree": {
      "sha": "d531eba64273f93e572e27c610ddab9013bd0389",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d531eba64273f93e572e27c610ddab9013bd0389"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "e8d4709e6a5f4e3fad8479b8069c52294be54488",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e8d4709e6a5f4e3fad8479b8069c52294be54488",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e8d4709e6a5f4e3fad8479b8069c52294be54488"
    }
  ],
  "stats": {
    "total": 65,
    "additions": 61,
    "deletions": 4
  },
  "files": [
    {
      "sha": "726a377f74d2bd9f4db1d9da1fa0eb709c941cab",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -1,3 +1,14 @@\n+2020-12-01  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* elfxx-riscv.c (riscv_parse_std_ext): Stop parsing standard\n+\textensions when parsed h keyword.\n+\t(riscv_get_prefix_class): Support prefixed h class.\n+\t(riscv_std_h_ext_strtab): Likewise.\n+\t(riscv_ext_h_valid_p): Likewise.\n+\t(parse_config): Likewise.\n+\t(riscv_std_z_ext_strtab): Add zifencei.\n+\t* elfxx-riscv.h (riscv_isa_ext_class): Add RV_ISA_CLASS_H.\n+\n 2020-12-01  Nelson Chu  <nelson.chu@sifive.com>\n \n \t* elfxx-riscv.c (riscv_parse_subset): ISA string cannot contain"
    },
    {
      "sha": "24eafcd25415431b957026fbd7a7be6d7c04333c",
      "filename": "bfd/elfxx-riscv.c",
      "status": "modified",
      "additions": 19,
      "deletions": 2,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/bfd/elfxx-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/bfd/elfxx-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-riscv.c?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -1225,7 +1225,7 @@ riscv_parse_std_ext (riscv_parse_subset_t *rps,\n \n   while (p != NULL && *p != '\\0')\n     {\n-      if (*p == 'x' || *p == 's' || *p == 'z')\n+      if (*p == 'x' || *p == 's' || *p == 'h' || *p == 'z')\n \tbreak;\n \n       if (*p == '_')\n@@ -1281,6 +1281,7 @@ riscv_get_prefix_class (const char *arch)\n   switch (*arch)\n     {\n     case 's': return RV_ISA_CLASS_S;\n+    case 'h': return RV_ISA_CLASS_H;\n     case 'x': return RV_ISA_CLASS_X;\n     case 'z': return RV_ISA_CLASS_Z;\n     default: return RV_ISA_CLASS_UNKNOWN;\n@@ -1362,6 +1363,7 @@ riscv_parse_prefixed_ext (riscv_parse_subset_t *rps,\n       /* Check that the prefix extension is known.\n \t For 'x', anything goes but it cannot simply be 'x'.\n \t For 's', it must be known from a list and cannot simply be 's'.\n+\t For 'h', it must be known from a list and cannot simply be 'h'.\n \t For 'z', it must be known from a list and cannot simply be 'z'.  */\n \n       /* Check that the extension name is well-formed.  */\n@@ -1432,14 +1434,19 @@ riscv_parse_prefixed_ext (riscv_parse_subset_t *rps,\n \n static const char * const riscv_std_z_ext_strtab[] =\n {\n-  \"zicsr\", NULL\n+  \"zicsr\", \"zifencei\", NULL\n };\n \n static const char * const riscv_std_s_ext_strtab[] =\n {\n   NULL\n };\n \n+static const char * const riscv_std_h_ext_strtab[] =\n+{\n+  NULL\n+};\n+\n /* For the extension `ext`, search through the list of known extensions\n    `known_exts` for a match, and return TRUE if found.  */\n \n@@ -1486,12 +1493,22 @@ riscv_ext_s_valid_p (const char *arg)\n   return riscv_multi_letter_ext_valid_p (arg, riscv_std_s_ext_strtab);\n }\n \n+/* Predicator function for 'h' prefixed extensions.\n+   Only known h-extensions are permitted.  */\n+\n+static bfd_boolean\n+riscv_ext_h_valid_p (const char *arg)\n+{\n+  return riscv_multi_letter_ext_valid_p (arg, riscv_std_h_ext_strtab);\n+}\n+\n /* Parsing order of the prefixed extensions that is specified by\n    the ISA spec.  */\n \n static const riscv_parse_config_t parse_config[] =\n {\n   {RV_ISA_CLASS_S, \"s\", riscv_ext_s_valid_p},\n+  {RV_ISA_CLASS_H, \"h\", riscv_ext_h_valid_p},\n   {RV_ISA_CLASS_Z, \"z\", riscv_ext_z_valid_p},\n   {RV_ISA_CLASS_X, \"x\", riscv_ext_x_valid_p},\n   {RV_ISA_CLASS_UNKNOWN, NULL, NULL}"
    },
    {
      "sha": "6b7cc5b0bf99d2e0a802c2216ffef6d9b9d397d3",
      "filename": "bfd/elfxx-riscv.h",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/bfd/elfxx-riscv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/bfd/elfxx-riscv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-riscv.h?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -102,6 +102,7 @@ riscv_estimate_digit (unsigned);\n typedef enum riscv_isa_ext_class\n {\n   RV_ISA_CLASS_S,\n+  RV_ISA_CLASS_H,\n   RV_ISA_CLASS_Z,\n   RV_ISA_CLASS_X,\n   RV_ISA_CLASS_UNKNOWN"
    },
    {
      "sha": "64d2fa7ff1487eaf3ad7a02587185f0e28d43d4a",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -1,3 +1,13 @@\n+2020-12-01  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* testsuite/gas/riscv/march-fail-order-z.d: New testcase, check\n+\torders of prefixed z extensions.\n+\t* testsuite/gas/riscv/march-fail-order-z.l: Likewise.\n+\t* testsuite/gas/riscv/march-fail-single-char-h.d: New testcase.\n+\t* testsuite/gas/riscv/march-fail-single-char.l: Updated.\n+\t* testsuite/gas/riscv/march-fail-unknown-h.d: New testcase.\n+\t* testsuite/gas/riscv/march-fail-unknown.l: Updated.\n+\n 2020-12-01  Nelson Chu  <nelson.chu@sifive.com>\n \n \t* testsuite/gas/riscv/march-fail-uppercase-base.d: Updated."
    },
    {
      "sha": "dd076c6d35adf5536426b49d1cd7e9110c62194a",
      "filename": "gas/testsuite/gas/riscv/march-fail-order-z.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-order-z.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-order-z.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/march-fail-order-z.d?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -0,0 +1,3 @@\n+#as: -march=rv32i_zifencei2p0_zicsr2p0\n+#source: empty.s\n+#error_output: march-fail-order-z.l"
    },
    {
      "sha": "1129219f2b5622353a7699c5ead5ebe865ec68b4",
      "filename": "gas/testsuite/gas/riscv/march-fail-order-z.l",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-order-z.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-order-z.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/march-fail-order-z.l?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -0,0 +1,2 @@\n+.*Assembler messages:\n+.*Fatal error: .*z ISA extension `zicsr' is not in alphabetical order.  It must come before `zifencei'"
    },
    {
      "sha": "7fca9576bf3cc72952dc4ebe07d11d4efe720f6a",
      "filename": "gas/testsuite/gas/riscv/march-fail-single-char-h.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-single-char-h.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-single-char-h.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/march-fail-single-char-h.d?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -0,0 +1,3 @@\n+#as: -march=rv32ih\n+#source: empty.s\n+#error_output: march-fail-single-char.l"
    },
    {
      "sha": "6466e164ff8fefd2f7b0954e4ccec20f5da8a609",
      "filename": "gas/testsuite/gas/riscv/march-fail-single-char.l",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-single-char.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-single-char.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/march-fail-single-char.l?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -1,2 +1,2 @@\n .*Assembler messages:\n-.*Fatal error: .*unknown (s|z|x) ISA extension `(s|z|x)'\n+.*Fatal error: .*unknown (s|h|z|x) ISA extension `(s|h|z|x)'"
    },
    {
      "sha": "b0b83231aa4c7b6e02bd001ca2f9734af3f42ff2",
      "filename": "gas/testsuite/gas/riscv/march-fail-unknown-h.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-unknown-h.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-unknown-h.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/march-fail-unknown-h.d?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -0,0 +1,3 @@\n+#as: -march=rv32ihfoo2p0\n+#source: empty.s\n+#error_output: march-fail-unknown.l"
    },
    {
      "sha": "28a864dbb71de3e0d46ba8d13dbbd4c3a0f640f8",
      "filename": "gas/testsuite/gas/riscv/march-fail-unknown.l",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-unknown.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/gas/testsuite/gas/riscv/march-fail-unknown.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/march-fail-unknown.l?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -1,2 +1,2 @@\n .*Assembler messages:\n-.*Fatal error: .*unknown (s|z) ISA extension `(s|z)foo'\n+.*Fatal error: .*unknown (s|h|z) ISA extension `(s|h|z)foo'"
    },
    {
      "sha": "4f6160d47642598e00b1438991db8b80434adddf",
      "filename": "opcodes/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/opcodes/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/opcodes/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/ChangeLog?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -1,3 +1,7 @@\n+2020-12-01  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* riscv-opc.c (riscv_ext_version_table): Add zifencei.\n+\n 2020-11-28 Borislav Petkov  <bp@suse.de>\n \n \t* i386-dis.c (print_insn): Set active_seg_prefix for branch hint insns"
    },
    {
      "sha": "121f3fee415bacebcb0d77f44f4253bd90294010",
      "filename": "opcodes/riscv-opc.c",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/opcodes/riscv-opc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30/opcodes/riscv-opc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/riscv-opc.c?ref=5a1b31e1e1cee6e9f1c92abff59cdcfff0dddf30",
      "patch": "@@ -935,6 +935,9 @@ const struct riscv_ext_version riscv_ext_version_table[] =\n {\"zicsr\", ISA_SPEC_CLASS_20191213, 2, 0},\n {\"zicsr\", ISA_SPEC_CLASS_20190608, 2, 0},\n \n+{\"zifencei\", ISA_SPEC_CLASS_20191213, 2, 0},\n+{\"zifencei\", ISA_SPEC_CLASS_20190608, 2, 0},\n+\n /* Terminate the list.  */\n {NULL, 0, 0, 0}\n };"
    }
  ]
}