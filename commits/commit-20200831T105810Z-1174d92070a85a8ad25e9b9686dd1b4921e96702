{
  "sha": "1174d92070a85a8ad25e9b9686dd1b4921e96702",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTE3NGQ5MjA3MGE4NWE4YWQyNWU5Yjk2ODZkZDFiNDkyMWU5NjcwMg==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-08-31T03:47:06Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-08-31T10:58:10Z"
    },
    "message": "PR26493 UBSAN: elfnn-riscv.c left shift of negative value\n\ninclude/\n\tPR 26493\n\t* opcode/riscv.h (OP_MASK_CSR, OP_MASK_CUSTOM_IMM)\n\t(OP_MASK_FUNCT7, OP_MASK_RS3): Make unsigned.\nbfd/\n\tPR 26493\n\t* elfnn-riscv.c (riscv_make_plt_header): Cast PLT_HEADER_SIZE to\n\tunsigned when using with RISCV_ITYPE.\n\t(_bfd_riscv_relax_call): Use an unsigned foff.",
    "tree": {
      "sha": "490ec9444c93d0d8bfe006afa9292a83eda0d8b1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/490ec9444c93d0d8bfe006afa9292a83eda0d8b1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1174d92070a85a8ad25e9b9686dd1b4921e96702",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1174d92070a85a8ad25e9b9686dd1b4921e96702",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1174d92070a85a8ad25e9b9686dd1b4921e96702",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1174d92070a85a8ad25e9b9686dd1b4921e96702/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "227d539b17c60a74c583dc66a2c0467243eb4bb2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/227d539b17c60a74c583dc66a2c0467243eb4bb2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/227d539b17c60a74c583dc66a2c0467243eb4bb2"
    }
  ],
  "stats": {
    "total": 27,
    "additions": 20,
    "deletions": 7
  },
  "files": [
    {
      "sha": "861655c9de09080e77f7f186f4954b56a2d7a4d3",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1174d92070a85a8ad25e9b9686dd1b4921e96702/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1174d92070a85a8ad25e9b9686dd1b4921e96702/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=1174d92070a85a8ad25e9b9686dd1b4921e96702",
      "patch": "@@ -1,3 +1,10 @@\n+2020-08-31  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 26493\n+\t* elfnn-riscv.c (riscv_make_plt_header): Cast PLT_HEADER_SIZE to\n+\tunsigned when using with RISCV_ITYPE.\n+\t(_bfd_riscv_relax_call): Use an unsigned foff.\n+\n 2020-08-31  Alan Modra  <amodra@gmail.com>\n \n \tPR 26476"
    },
    {
      "sha": "8a3338c4728c68bcf03b13f074b05076b07d1e01",
      "filename": "bfd/elfnn-riscv.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1174d92070a85a8ad25e9b9686dd1b4921e96702/bfd/elfnn-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1174d92070a85a8ad25e9b9686dd1b4921e96702/bfd/elfnn-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-riscv.c?ref=1174d92070a85a8ad25e9b9686dd1b4921e96702",
      "patch": "@@ -199,7 +199,7 @@ riscv_make_plt_header (bfd *output_bfd, bfd_vma gotplt_addr, bfd_vma addr,\n   entry[0] = RISCV_UTYPE (AUIPC, X_T2, gotplt_offset_high);\n   entry[1] = RISCV_RTYPE (SUB, X_T1, X_T1, X_T3);\n   entry[2] = RISCV_ITYPE (LREG, X_T3, X_T2, gotplt_offset_low);\n-  entry[3] = RISCV_ITYPE (ADDI, X_T1, X_T1, -(PLT_HEADER_SIZE + 12));\n+  entry[3] = RISCV_ITYPE (ADDI, X_T1, X_T1, (uint32_t) -(PLT_HEADER_SIZE + 12));\n   entry[4] = RISCV_ITYPE (ADDI, X_T0, X_T2, gotplt_offset_low);\n   entry[5] = RISCV_ITYPE (SRLI, X_T1, X_T1, 4 - RISCV_ELF_LOG_WORD_BYTES);\n   entry[6] = RISCV_ITYPE (LREG, X_T0, X_T0, RISCV_ELF_WORD_BYTES);\n@@ -3455,7 +3455,7 @@ _bfd_riscv_relax_call (bfd *abfd, asection *sec, asection *sym_sec,\n \t\t       bfd_boolean undefined_weak ATTRIBUTE_UNUSED)\n {\n   bfd_byte *contents = elf_section_data (sec)->this_hdr.contents;\n-  bfd_signed_vma foff = symval - (sec_addr (sec) + rel->r_offset);\n+  bfd_vma foff = symval - (sec_addr (sec) + rel->r_offset);\n   bfd_boolean near_zero = (symval + RISCV_IMM_REACH/2) < RISCV_IMM_REACH;\n   bfd_vma auipc, jalr;\n   int rd, r_type, len = 4, rvc = elf_elfheader (abfd)->e_flags & EF_RISCV_RVC;\n@@ -3469,7 +3469,7 @@ _bfd_riscv_relax_call (bfd *abfd, asection *sec, asection *sym_sec,\n       if (sym_sec->output_section == sec->output_section\n \t  && sym_sec->output_section != bfd_abs_section_ptr)\n \tmax_alignment = (bfd_vma) 1 << sym_sec->output_section->alignment_power;\n-      foff += (foff < 0 ? -max_alignment : max_alignment);\n+      foff += ((bfd_signed_vma) foff < 0 ? -max_alignment : max_alignment);\n     }\n \n   /* See if this function call can be shortened.  */"
    },
    {
      "sha": "9daa866d72522c5e11cae1db409112fda17aee81",
      "filename": "include/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1174d92070a85a8ad25e9b9686dd1b4921e96702/include/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1174d92070a85a8ad25e9b9686dd1b4921e96702/include/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/ChangeLog?ref=1174d92070a85a8ad25e9b9686dd1b4921e96702",
      "patch": "@@ -1,3 +1,9 @@\n+2020-08-31  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 26493\n+\t* opcode/riscv.h (OP_MASK_CSR, OP_MASK_CUSTOM_IMM)\n+\t(OP_MASK_FUNCT7, OP_MASK_RS3): Make unsigned.\n+\n 2020-08-31  Alan Modra  <amodra@gmail.com>\n \n \tPR 26457"
    },
    {
      "sha": "2f1bc793e5ca409f4de6403748b5d5fdd7f89364",
      "filename": "include/opcode/riscv.h",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1174d92070a85a8ad25e9b9686dd1b4921e96702/include/opcode/riscv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1174d92070a85a8ad25e9b9686dd1b4921e96702/include/opcode/riscv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/opcode/riscv.h?ref=1174d92070a85a8ad25e9b9686dd1b4921e96702",
      "patch": "@@ -204,7 +204,7 @@ static const char * const riscv_pred_succ[16] =\n #define OP_SH_RS2\t\t20\n #define OP_MASK_RS1\t\t0x1f\n #define OP_SH_RS1\t\t15\n-#define OP_MASK_RS3\t\t0x1f\n+#define OP_MASK_RS3\t\t0x1fU\n #define OP_SH_RS3\t\t27\n #define OP_MASK_RD\t\t0x1f\n #define OP_SH_RD\t\t7\n@@ -223,14 +223,14 @@ static const char * const riscv_pred_succ[16] =\n #define OP_MASK_RL\t\t0x1\n #define OP_SH_RL\t\t25\n \n-#define OP_MASK_CUSTOM_IMM\t0x7f\n+#define OP_MASK_CUSTOM_IMM\t0x7fU\n #define OP_SH_CUSTOM_IMM\t25\n-#define OP_MASK_CSR\t\t0xfff\n+#define OP_MASK_CSR\t\t0xfffU\n #define OP_SH_CSR\t\t20\n \n #define OP_MASK_FUNCT3         0x7\n #define OP_SH_FUNCT3           12\n-#define OP_MASK_FUNCT7         0x7f\n+#define OP_MASK_FUNCT7         0x7fU\n #define OP_SH_FUNCT7           25\n #define OP_MASK_FUNCT2         0x3\n #define OP_SH_FUNCT2           25"
    }
  ]
}