{
  "sha": "fe1f847d9a73c090527d2620eb9883185351aea0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmUxZjg0N2Q5YTczYzA5MDUyN2QyNjIwZWI5ODgzMTg1MzUxYWVhMA==",
  "commit": {
    "author": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-05-26T02:34:13Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-05-26T03:02:29Z"
    },
    "message": "RISC-V: Allow to link the objects with unknown prefixed extensions.\n\nSince the policies of GNU and llvm toolchain are different for now,\ncurrent binutils mainline cannot accept any draft extensions, including\nrvv, zfh, ....  The Clang/LLVM allows these draft stuff on mainline,\nbut the GNU ld might be used with them, so this causes the link time\nproblems.\n\nThe patch allows ld to link the objects with unknown prefixed extensions,\nwhich are probably generated by LLVM or customized toolchains.\n\nbfd/\n    * elfxx-riscv.h (check_unknown_prefixed_ext): New bool.\n    * elfxx-riscv.c (riscv_parse_prefixed_ext): Do not check the\n    prefixed extension name if check_unknown_prefixed_ext is false.\n    * elfnn-riscv.c (riscv_merge_arch_attr_info): Set\n    check_unknown_prefixed_ext to false for linker.\ngas/\n    * config/tc-riscv.c (riscv_set_arch): Set\n    check_unknown_prefixed_ext to true for assembler.",
    "tree": {
      "sha": "7e08c1ee26e1a041aceed72797f36b0272f51407",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7e08c1ee26e1a041aceed72797f36b0272f51407"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/fe1f847d9a73c090527d2620eb9883185351aea0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fe1f847d9a73c090527d2620eb9883185351aea0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/fe1f847d9a73c090527d2620eb9883185351aea0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fe1f847d9a73c090527d2620eb9883185351aea0/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "9495896335a297b6810f9a9b03dfe06cc8d82607",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9495896335a297b6810f9a9b03dfe06cc8d82607",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9495896335a297b6810f9a9b03dfe06cc8d82607"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 19,
    "deletions": 1
  },
  "files": [
    {
      "sha": "608ea545ad7c765860d3090036e1be201ae13c94",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=fe1f847d9a73c090527d2620eb9883185351aea0",
      "patch": "@@ -1,3 +1,11 @@\n+2021-05-26  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* elfxx-riscv.h (check_unknown_prefixed_ext): New bool.\n+\t* elfxx-riscv.c (riscv_parse_prefixed_ext): Do not check the\n+\tprefixed extension name if check_unknown_prefixed_ext is false.\n+\t* elfnn-riscv.c (riscv_merge_arch_attr_info): Set\n+\tcheck_unknown_prefixed_ext to false for linker.\n+\n 2021-05-25  Nick Clifton  <nickc@redhat.com>\n \n \t* elf32-arn.c (struct elf_arm_obj_tdata): Add num_entries field."
    },
    {
      "sha": "d2781f3099350859d413cb855d034d90d17d3b17",
      "filename": "bfd/elfnn-riscv.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/elfnn-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/elfnn-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-riscv.c?ref=fe1f847d9a73c090527d2620eb9883185351aea0",
      "patch": "@@ -3558,11 +3558,13 @@ riscv_merge_arch_attr_info (bfd *ibfd, char *in_arch, char *out_arch)\n   rpe_in.error_handler = _bfd_error_handler;\n   rpe_in.xlen = &xlen_in;\n   rpe_in.get_default_version = NULL;\n+  rpe_in.check_unknown_prefixed_ext = false;\n \n   rpe_out.subset_list = &out_subsets;\n   rpe_out.error_handler = _bfd_error_handler;\n   rpe_out.xlen = &xlen_out;\n   rpe_out.get_default_version = NULL;\n+  rpe_out.check_unknown_prefixed_ext = false;\n \n   if (in_arch == NULL && out_arch == NULL)\n     return NULL;"
    },
    {
      "sha": "39b69e2b0a54449b98bed53e2fa4e039bda0e3d1",
      "filename": "bfd/elfxx-riscv.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/elfxx-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/elfxx-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-riscv.c?ref=fe1f847d9a73c090527d2620eb9883185351aea0",
      "patch": "@@ -1681,7 +1681,8 @@ riscv_parse_prefixed_ext (riscv_parse_subset_t *rps,\n \t and cannot simply be the prefixed name.  */\n \n       /* Check that the extension name is well-formed.  */\n-      if (!riscv_valid_prefixed_ext (subset))\n+      if (rps->check_unknown_prefixed_ext\n+\t  && !riscv_valid_prefixed_ext (subset))\n \t{\n \t  rps->error_handler\n \t    (_(\"-march=%s: unknown prefixed ISA extension `%s'\"),"
    },
    {
      "sha": "c2fff92608624f71406b0ca66a1f6c8e2a6a910f",
      "filename": "bfd/elfxx-riscv.h",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/elfxx-riscv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fe1f847d9a73c090527d2620eb9883185351aea0/bfd/elfxx-riscv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-riscv.h?ref=fe1f847d9a73c090527d2620eb9883185351aea0",
      "patch": "@@ -74,6 +74,7 @@ typedef struct\n   void (*get_default_version) (const char *,\n \t\t\t       int *,\n \t\t\t       int *);\n+  bool check_unknown_prefixed_ext;\n } riscv_parse_subset_t;\n \n extern bool"
    },
    {
      "sha": "eac946f13c14ff6c3891e183c280fe5617fa39d5",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fe1f847d9a73c090527d2620eb9883185351aea0/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fe1f847d9a73c090527d2620eb9883185351aea0/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=fe1f847d9a73c090527d2620eb9883185351aea0",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-26  Nelson Chu  <nelson.chu@sifive.com>\n+\n+\t* config/tc-riscv.c (riscv_set_arch): Set\n+\tcheck_unknown_prefixed_ext to true for assembler.\n+\n 2021-05-25  Tamar Christina  <tamar.christina@arm.com>\n \n \tPR gas/25235"
    },
    {
      "sha": "42e575293691ea481679a9845f96a8785b63456e",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fe1f847d9a73c090527d2620eb9883185351aea0/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fe1f847d9a73c090527d2620eb9883185351aea0/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=fe1f847d9a73c090527d2620eb9883185351aea0",
      "patch": "@@ -410,6 +410,7 @@ riscv_set_arch (const char *s)\n   rps.error_handler = as_bad;\n   rps.xlen = &xlen;\n   rps.get_default_version = riscv_get_default_ext_version;\n+  rps.check_unknown_prefixed_ext = true;\n \n   if (s == NULL)\n     return;"
    }
  ]
}