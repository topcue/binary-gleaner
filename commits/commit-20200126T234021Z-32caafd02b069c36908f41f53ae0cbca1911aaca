{
  "sha": "32caafd02b069c36908f41f53ae0cbca1911aaca",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzJjYWFmZDAyYjA2OWMzNjkwOGY0MWY1M2FlMGNiY2ExOTExYWFjYQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-10-22T22:57:35Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-01-26T23:40:21Z"
    },
    "message": "Change allocate_psymtab to be a constructor\n\nThis is the next step in getting the symbol readers to allocate\npsymtabs themselves: change allocate_psymtab to be an ordinary\nconstructor, and then use \"new\" at the previous call sites.  Note that\nthis doesn't get us all the way -- start_psymtab_common is still\nallocating a partial symtab.\n\ngdb/ChangeLog\n2020-01-26  Tom Tromey  <tom@tromey.com>\n\n\t* xcoffread.c (xcoff_end_psymtab): Use new.\n\t* psymtab.c (start_psymtab_common): Use new.\n\t(partial_symtab::partial_symtab): Rename from allocate_psymtab.\n\tUpdate.\n\t* psympriv.h (struct partial_symtab): Add parameters to\n\tconstructor.  Don't inline.\n\t(allocate_psymtab): Don't declare.\n\t* mdebugread.c (new_psymtab): Use new.\n\t* dwarf2read.c (dwarf2_create_include_psymtab): Use new.\n\t* dbxread.c (dbx_end_psymtab): Use new.\n\nChange-Id: Iffeae64c925050b90b9916cbc36e15b26ff42226",
    "tree": {
      "sha": "100fcb2c3ac32456eb3fdc8d452f0bf1766afd17",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/100fcb2c3ac32456eb3fdc8d452f0bf1766afd17"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/32caafd02b069c36908f41f53ae0cbca1911aaca",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32caafd02b069c36908f41f53ae0cbca1911aaca",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/32caafd02b069c36908f41f53ae0cbca1911aaca",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32caafd02b069c36908f41f53ae0cbca1911aaca/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "abaa2f2340a400fd19aea2973f705fe813d620d4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/abaa2f2340a400fd19aea2973f705fe813d620d4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/abaa2f2340a400fd19aea2973f705fe813d620d4"
    }
  ],
  "stats": {
    "total": 66,
    "additions": 35,
    "deletions": 31
  },
  "files": [
    {
      "sha": "854ac3144cf6b9f7cb6e9bfe2aa69a37075fee2d",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -1,3 +1,16 @@\n+2020-01-26  Tom Tromey  <tom@tromey.com>\n+\n+\t* xcoffread.c (xcoff_end_psymtab): Use new.\n+\t* psymtab.c (start_psymtab_common): Use new.\n+\t(partial_symtab::partial_symtab): Rename from allocate_psymtab.\n+\tUpdate.\n+\t* psympriv.h (struct partial_symtab): Add parameters to\n+\tconstructor.  Don't inline.\n+\t(allocate_psymtab): Don't declare.\n+\t* mdebugread.c (new_psymtab): Use new.\n+\t* dwarf2read.c (dwarf2_create_include_psymtab): Use new.\n+\t* dbxread.c (dbx_end_psymtab): Use new.\n+\n 2020-01-26  Tom Tromey  <tom@tromey.com>\n \n \t* psymtab.h (class psymtab_storage) <install_psymtab>: Rename from"
    },
    {
      "sha": "95270856a07df78b7e1733f512d17dab70025876",
      "filename": "gdb/dbxread.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/dbxread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/dbxread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dbxread.c?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -2025,7 +2025,7 @@ dbx_end_psymtab (struct objfile *objfile, struct partial_symtab *pst,\n   for (i = 0; i < num_includes; i++)\n     {\n       struct partial_symtab *subpst =\n-\tallocate_psymtab (include_list[i], objfile);\n+\tnew partial_symtab (include_list[i], objfile);\n \n       subpst->read_symtab_private =\n \tXOBNEW (&objfile->objfile_obstack, struct symloc);"
    },
    {
      "sha": "2cac2864350036cf660a0557811c2160df427bc0",
      "filename": "gdb/dwarf2read.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/dwarf2read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/dwarf2read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.c?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -6695,7 +6695,7 @@ static void\n dwarf2_create_include_psymtab (const char *name, struct partial_symtab *pst,\n                                struct objfile *objfile)\n {\n-  struct partial_symtab *subpst = allocate_psymtab (name, objfile);\n+  struct partial_symtab *subpst = new partial_symtab (name, objfile);\n \n   if (!IS_ABSOLUTE_PATH (subpst->filename))\n     {"
    },
    {
      "sha": "2ec30ec1deb7244263e815068435960accd111b4",
      "filename": "gdb/mdebugread.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/mdebugread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/mdebugread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mdebugread.c?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -4662,7 +4662,7 @@ new_psymtab (const char *name, struct objfile *objfile)\n {\n   struct partial_symtab *psymtab;\n \n-  psymtab = allocate_psymtab (name, objfile);\n+  psymtab = new partial_symtab (name, objfile);\n \n   /* Keep a backpointer to the file's symbols.  */\n "
    },
    {
      "sha": "74ff10ef6a6f2c1ac48b77dbe078723795d8ee6b",
      "filename": "gdb/psympriv.h",
      "status": "modified",
      "additions": 8,
      "deletions": 16,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/psympriv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/psympriv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psympriv.h?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -104,12 +104,14 @@ enum psymtab_search_status\n \n struct partial_symtab\n {\n-  partial_symtab ()\n-    : searched_flag (PST_NOT_SEARCHED),\n-      text_low_valid (0),\n-      text_high_valid (0)\n-  {\n-  }\n+  /* Allocate a new partial symbol table associated with OBJFILE.\n+     FILENAME (which must be non-NULL) is the filename of this partial\n+     symbol table; it is copied into the appropriate storage.  The\n+     partial symtab will also be installed using\n+     psymtab_storage::install.  */\n+\n+  partial_symtab (const char *filename, struct objfile *objfile)\n+    ATTRIBUTE_NONNULL (2) ATTRIBUTE_NONNULL (3);\n \n   /* Return the raw low text address of this partial_symtab.  */\n   CORE_ADDR raw_text_low () const\n@@ -329,16 +331,6 @@ extern struct partial_symtab *start_psymtab_common (struct objfile *,\n \n extern void end_psymtab_common (struct objfile *, struct partial_symtab *);\n \n-/* Allocate a new partial symbol table associated with OBJFILE.\n-   FILENAME (which must be non-NULL) is the filename of this partial\n-   symbol table; it is copied into the appropriate storage.  A new\n-   partial symbol table is returned; aside from \"next\" and \"filename\",\n-   its fields are initialized to zero.  */\n-\n-extern struct partial_symtab *allocate_psymtab (const char *filename,\n-\t\t\t\t\t\tstruct objfile *objfile)\n-  ATTRIBUTE_NONNULL (1);\n-\n static inline void\n discard_psymtab (struct objfile *objfile, struct partial_symtab *pst)\n {"
    },
    {
      "sha": "844e71861422434b8b3534a4c7e2f1073983c9f2",
      "filename": "gdb/psymtab.c",
      "status": "modified",
      "additions": 10,
      "deletions": 11,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/psymtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/psymtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psymtab.c?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -1487,7 +1487,7 @@ start_psymtab_common (struct objfile *objfile,\n {\n   struct partial_symtab *psymtab;\n \n-  psymtab = allocate_psymtab (filename, objfile);\n+  psymtab = new partial_symtab (filename, objfile);\n   psymtab->set_text_low (textlow);\n   psymtab->set_text_high (psymtab->raw_text_low ()); /* default */\n   psymtab->globals_offset = objfile->partial_symtabs->global_psymbols.size ();\n@@ -1646,16 +1646,17 @@ init_psymbol_list (struct objfile *objfile, int total_symbols)\n \n /* See psympriv.h.  */\n \n-struct partial_symtab *\n-allocate_psymtab (const char *filename, struct objfile *objfile)\n+partial_symtab::partial_symtab (const char *filename_, struct objfile *objfile)\n+  : searched_flag (PST_NOT_SEARCHED),\n+    text_low_valid (0),\n+    text_high_valid (0)\n {\n-  struct partial_symtab *psymtab = new partial_symtab;\n-  objfile->partial_symtabs->install_psymtab (psymtab);\n+  objfile->partial_symtabs->install_psymtab (this);\n \n-  psymtab->filename\n+  filename\n     = ((const char *) objfile->per_bfd->filename_cache.insert\n-       (filename, strlen (filename) + 1));\n-  psymtab->compunit_symtab = NULL;\n+       (filename_, strlen (filename_) + 1));\n+  compunit_symtab = NULL;\n \n   if (symtab_create_debug)\n     {\n@@ -1674,10 +1675,8 @@ allocate_psymtab (const char *filename, struct objfile *objfile)\n \t}\n       fprintf_filtered (gdb_stdlog,\n \t\t\t\"Created psymtab %s for module %s.\\n\",\n-\t\t\thost_address_to_string (psymtab), filename);\n+\t\t\thost_address_to_string (this), filename);\n     }\n-\n-  return psymtab;\n }\n \n void"
    },
    {
      "sha": "be10c4f3d5c834e2ea99ddc52af2175a018c05a1",
      "filename": "gdb/xcoffread.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/xcoffread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32caafd02b069c36908f41f53ae0cbca1911aaca/gdb/xcoffread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/xcoffread.c?ref=32caafd02b069c36908f41f53ae0cbca1911aaca",
      "patch": "@@ -2065,7 +2065,7 @@ xcoff_end_psymtab (struct objfile *objfile, struct partial_symtab *pst,\n   for (i = 0; i < num_includes; i++)\n     {\n       struct partial_symtab *subpst =\n-\tallocate_psymtab (include_list[i], objfile);\n+\tnew partial_symtab (include_list[i], objfile);\n \n       subpst->read_symtab_private = XOBNEW (&objfile->objfile_obstack, symloc);\n       ((struct symloc *) subpst->read_symtab_private)->first_symnum = 0;"
    }
  ]
}