{
  "sha": "91bae99160e9d81cfe340b937f9613d43dc90293",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTFiYWU5OTE2MGU5ZDgxY2ZlMzQwYjkzN2Y5NjEzZDQzZGM5MDI5Mw==",
  "commit": {
    "author": {
      "name": "John Darrington",
      "email": "john@darrington.wattle.id.au",
      "date": "2019-02-01T16:42:54Z"
    },
    "committer": {
      "name": "John Darrington",
      "email": "john@darrington.wattle.id.au",
      "date": "2019-02-01T17:08:06Z"
    },
    "message": "S12Z: GAS: Fix incorrect range test for 16-bit PC relative offsets.\n\nThe limits for PC relative offsets were incorrect.  This change fixes\nthem and adds some tests.\n\ngas/\n\t* config/tc-s12z.c (md_apply_fix): Fix incorrect limits.\n\t* testsuite/gas/s12z/pc-rel-bad.d: New file.\n\t* testsuite/gas/s12z/pc-rel-bad.l: New file.\n\t* testsuite/gas/s12z/pc-rel-bad.s: New file.\n\t* testsuite/gas/s12z/pc-rel-good.d: New file.\n\t* testsuite/gas/s12z/pc-rel-good.s: New file.\n\t* testsuite/gas/s12z/s12z.exp: Add them.",
    "tree": {
      "sha": "ea4ee1c0eb6208868c56ddf82965fdfbcf1a0887",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ea4ee1c0eb6208868c56ddf82965fdfbcf1a0887"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/91bae99160e9d81cfe340b937f9613d43dc90293",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/91bae99160e9d81cfe340b937f9613d43dc90293",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/91bae99160e9d81cfe340b937f9613d43dc90293",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/91bae99160e9d81cfe340b937f9613d43dc90293/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "1d4d86699fcc9641c1f4dfb3a44a1588353c2137",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1d4d86699fcc9641c1f4dfb3a44a1588353c2137",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1d4d86699fcc9641c1f4dfb3a44a1588353c2137"
    }
  ],
  "stats": {
    "total": 64,
    "additions": 63,
    "deletions": 1
  },
  "files": [
    {
      "sha": "a02430dd16707da83c5750db68e53715f5d53351",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -1,3 +1,13 @@\n+2019-01-31  John Darrington <john@darrington.wattle.id.au>\n+\n+\t* config/tc-s12z.c (md_apply_fix): Fix incorrect limits.\n+\t* testsuite/gas/s12z/pc-rel-bad.d: New file.\n+\t* testsuite/gas/s12z/pc-rel-bad.l: New file.\n+\t* testsuite/gas/s12z/pc-rel-bad.s: New file.\n+\t* testsuite/gas/s12z/pc-rel-good.d: New file.\n+\t* testsuite/gas/s12z/pc-rel-good.s: New file.\n+\t* testsuite/gas/s12z/s12z.exp: Add them.\n+\n 2019-01-31  John Darrington <john@darrington.wattle.id.au>\n \n \t* config/tc-s12z.c (tfr): Emit warning if operands are the same."
    },
    {
      "sha": "8b56b685b8e990d009112c19ed8e5b611a9bb2cc",
      "filename": "gas/config/tc-s12z.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/config/tc-s12z.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/config/tc-s12z.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-s12z.c?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -3853,7 +3853,7 @@ md_apply_fix (fixS *fixP, valueT *valP, segT seg ATTRIBUTE_UNUSED)\n       bfd_putb32 ((bfd_vma) value, (unsigned char *) where);\n       break;\n     case BFD_RELOC_16_PCREL:\n-      if (value < -0x8000 || value > 0x7FFF)\n+      if (value < -0x4000 || value > 0x3FFF)\n \tas_bad_where (fixP->fx_file, fixP->fx_line,\n \t\t      _(\"Value out of 16-bit range.\"));\n "
    },
    {
      "sha": "ae01a7fa638868cd9ccda76ea0e965790c9edc92",
      "filename": "gas/testsuite/gas/s12z/pc-rel-bad.d",
      "status": "added",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-bad.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-bad.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/s12z/pc-rel-bad.d?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -0,0 +1,9 @@\n+#objdump: -d -r -t\n+#name:    PC relative branches which are out of range.\n+#source:  pc-rel-bad.s\n+#error_output: pc-rel-bad.l\n+\n+.*:     file format elf32-s12z\n+\n+\n+Disassembly of section .text:"
    },
    {
      "sha": "e3d63c3c09466636822ad45c5baed8ba5b7ed572",
      "filename": "gas/testsuite/gas/s12z/pc-rel-bad.l",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-bad.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-bad.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/s12z/pc-rel-bad.l?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -0,0 +1,3 @@\n+.*: Assembler messages:\n+.*:4: Error: Value out of 16-bit range.\n+.*:8: Error: Value out of 16-bit range."
    },
    {
      "sha": "a79b4d624492df68b0c6a8337685210bf3580209",
      "filename": "gas/testsuite/gas/s12z/pc-rel-bad.s",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-bad.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-bad.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/s12z/pc-rel-bad.s?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -0,0 +1,8 @@\n+\n+;;; Both the BNE instructions should fail\n+;;; because the destination is out of range.\n+\tbne .label\n+\t.fill 0x3FFD, 1, 0  \t; 0x3FFF minus 3 (the length of the BNE insn)\n+.label:\n+\t.fill 0x4001, 1, 0\n+\tbne .label"
    },
    {
      "sha": "acc7e6301c9556c1703d9bb78ca24215804f8f93",
      "filename": "gas/testsuite/gas/s12z/pc-rel-good.d",
      "status": "added",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-good.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-good.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/s12z/pc-rel-good.d?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -0,0 +1,24 @@\n+#objdump: -d -r -t\n+#name:    PC relative branches (close to the limit)\n+#source:  pc-rel-good.s\n+\n+\n+.*:     file format elf32-s12z\n+\n+SYMBOL TABLE:\n+00000000 l    d  .text\t00000000 .text\n+00000000 l    d  .data\t00000000 .data\n+00000000 l    d  .bss\t00000000 .bss\n+00003fff l       .text\t00000000 .label\n+\n+\n+\n+Disassembly of section .text:\n+\n+00000000 <.label-0x3fff>:\n+       0:\t26 bf ff    \tbne .label\n+\t...\n+\n+00003fff <.label>:\n+\t...\n+    7fff:\t26 c0 00    \tbne .label"
    },
    {
      "sha": "f64d1975da5065e216ed3fc4ed8fdbba6bc9ea5d",
      "filename": "gas/testsuite/gas/s12z/pc-rel-good.s",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-good.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/pc-rel-good.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/s12z/pc-rel-good.s?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -0,0 +1,6 @@\n+\n+\tbne .label\n+\t.fill 0x3FFC, 1, 0\n+.label:\n+\t.fill 0x4000, 1, 0\n+\tbne .label"
    },
    {
      "sha": "d9746d3d919906fac07e738abb1808400de37c2b",
      "filename": "gas/testsuite/gas/s12z/s12z.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/s12z.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/91bae99160e9d81cfe340b937f9613d43dc90293/gas/testsuite/gas/s12z/s12z.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/s12z/s12z.exp?ref=91bae99160e9d81cfe340b937f9613d43dc90293",
      "patch": "@@ -90,6 +90,8 @@ run_dump_test opr-idx3-reg\n run_dump_test opr-idx3-xysp-24\n run_dump_test or-imm\n run_dump_test or-opr\n+run_dump_test pc-rel-bad\n+run_dump_test pc-rel-good\n run_dump_test page2-inh\n run_dump_test psh-pul\n run_dump_test qmul"
    }
  ]
}