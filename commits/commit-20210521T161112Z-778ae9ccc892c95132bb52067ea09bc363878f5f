{
  "sha": "778ae9ccc892c95132bb52067ea09bc363878f5f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Nzc4YWU5Y2NjODkyYzk1MTMyYmI1MjA2N2VhMDliYzM2Mzg3OGY1Zg==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-05-21T16:11:12Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-05-21T16:11:12Z"
    },
    "message": "[gdb/testsuite] Add target board cc-with-gnu-debuglink.exp\n\nAdd target board cc-with-gnu-debuglink.exp that splits off debuginfo into a\nseperate .debug file and links to it using .gnu_debuglink.\n\nTested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2021-05-21  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/25047\n\t* contrib/cc-with-tweaks.sh: Handle -l.\n\ngdb/testsuite/ChangeLog:\n\n2021-05-21  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/25047\n\t* boards/cc-with-gnu-debuglink.exp: New file.",
    "tree": {
      "sha": "97df231b199fef31948488c0e41abec4d65ea963",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/97df231b199fef31948488c0e41abec4d65ea963"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/778ae9ccc892c95132bb52067ea09bc363878f5f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/778ae9ccc892c95132bb52067ea09bc363878f5f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/778ae9ccc892c95132bb52067ea09bc363878f5f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/778ae9ccc892c95132bb52067ea09bc363878f5f/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ca43e66033ca0d72bb93837c9b1ab482977e06e6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca43e66033ca0d72bb93837c9b1ab482977e06e6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ca43e66033ca0d72bb93837c9b1ab482977e06e6"
    }
  ],
  "stats": {
    "total": 82,
    "additions": 81,
    "deletions": 1
  },
  "files": [
    {
      "sha": "f15bd050a174e666cdac8a1be2fa859f19428d82",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=778ae9ccc892c95132bb52067ea09bc363878f5f",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-21  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/25047\n+\t* contrib/cc-with-tweaks.sh: Handle -l.\n+\n 2021-05-21  Tom de Vries  <tdevries@suse.de>\n \n \tPR breakpoint/27889"
    },
    {
      "sha": "8653dfb260e6da0f68afe51eb9ea3b4672264131",
      "filename": "gdb/contrib/cc-with-tweaks.sh",
      "status": "modified",
      "additions": 45,
      "deletions": 1,
      "changes": 46,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/contrib/cc-with-tweaks.sh",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/contrib/cc-with-tweaks.sh",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/contrib/cc-with-tweaks.sh?ref=778ae9ccc892c95132bb52067ea09bc363878f5f",
      "patch": "@@ -45,6 +45,7 @@\n # -i make an index (.gdb_index)\n # -n make a dwarf5 index (.debug_names)\n # -p create .dwp files (Fission), you need to also use gcc option -gsplit-dwarf\n+# -l creates separate debuginfo files linked to using .gnu_debuglink\n # If nothing is given, no changes are made\n \n myname=cc-with-tweaks.sh\n@@ -83,6 +84,7 @@ want_dwz=false\n want_multi=false\n want_dwp=false\n want_objcopy_compress=false\n+want_gnu_debuglink=false\n \n while [ $# -gt 0 ]; do\n     case \"$1\" in\n@@ -92,6 +94,7 @@ while [ $# -gt 0 ]; do\n \t-n) want_index=true; index_options=-dwarf-5;;\n \t-m) want_multi=true ;;\n \t-p) want_dwp=true ;;\n+\t-l) want_gnu_debuglink=true ;;\n \t*) break ;;\n     esac\n     shift\n@@ -158,7 +161,12 @@ fi\n \n get_tmpdir ()\n {\n-    tmpdir=$(dirname \"$output_file\")/.tmp\n+    subdir=\"$1\"\n+    if [ \"$subdir\" = \"\" ]; then\n+\tsubdir=.tmp\n+    fi\n+\n+    tmpdir=$(dirname \"$output_file\")/\"$subdir\"\n     mkdir -p \"$tmpdir\"\n }\n \n@@ -234,4 +242,40 @@ if [ \"$want_dwp\" = true ]; then\n     fi\n fi\n \n+if [ \"$want_gnu_debuglink\" = true ]; then\n+    # Based on gdb_gnu_strip_debug.\n+\n+    # Gdb looks for the .gnu_debuglink file in the .debug subdirectory\n+    # of the directory of the executable.\n+    get_tmpdir .debug\n+\n+    stripped_file=\"$tmpdir\"/$(basename \"$output_file\").stripped\n+    debug_file=\"$tmpdir\"/$(basename \"$output_file\").debug\n+\n+    # Create stripped and debug versions of output_file.\n+    strip --strip-debug \"${output_file}\" \\\n+\t  -o \"${stripped_file}\"\n+    rc=$?\n+    [ $rc != 0 ] && exit $rc\n+    strip --only-keep-debug \"${output_file}\" \\\n+\t  -o \"${debug_file}\"\n+    rc=$?\n+    [ $rc != 0 ] && exit $rc\n+\n+    # The .gnu_debuglink is supposed to contain no leading directories.\n+    link=$(basename \"${debug_file}\")\n+\n+    (\n+\t# Temporarily cd to tmpdir to allow objcopy to find $link\n+\tcd \"$tmpdir\" || exit 1\n+\n+\t# Overwrite output_file with stripped version containing\n+\t# .gnu_debuglink to debug_file.\n+\tobjcopy --add-gnu-debuglink=\"$link\" \"${stripped_file}\" \\\n+\t\t\"${output_file}\"\n+\trc=$?\n+\t[ $rc != 0 ] && exit $rc\n+    )\n+fi\n+\n exit $rc"
    },
    {
      "sha": "df1ba09d502fe820e8cda715532a38ad3ed07f5d",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=778ae9ccc892c95132bb52067ea09bc363878f5f",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-21  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/25047\n+\t* boards/cc-with-gnu-debuglink.exp: New file.\n+\n 2021-05-21  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n \n \t* gdb.dwarf2/dw2-inline-with-lexical-scope.c (func): Replace"
    },
    {
      "sha": "ca977d9f165ba89d502a25dfcb77f3370f22b074",
      "filename": "gdb/testsuite/boards/cc-with-gnu-debuglink.exp",
      "status": "added",
      "additions": 26,
      "deletions": 0,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/testsuite/boards/cc-with-gnu-debuglink.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/778ae9ccc892c95132bb52067ea09bc363878f5f/gdb/testsuite/boards/cc-with-gnu-debuglink.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/boards/cc-with-gnu-debuglink.exp?ref=778ae9ccc892c95132bb52067ea09bc363878f5f",
      "patch": "@@ -0,0 +1,26 @@\n+# Copyright 2021 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# This file is a dejagnu \"board file\" and is used to run the testsuite\n+# with contrib/cc-with-tweaks.sh -l.\n+#\n+# Example usage:\n+# bash$ cd $objdir\n+# bash$ make check-gdb \\\n+#   RUNTESTFLAGS='--target_board=cc-with-gnu-debuglink'\n+#\n+\n+set CC_WITH_TWEAKS_FLAGS \"-l\"\n+load_board_description \"cc-with-tweaks\""
    }
  ]
}