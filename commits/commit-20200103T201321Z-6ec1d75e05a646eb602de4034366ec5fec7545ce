{
  "sha": "6ec1d75e05a646eb602de4034366ec5fec7545ce",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmVjMWQ3NWUwNWE2NDZlYjYwMmRlNDAzNDM2NmVjNWZlYzc1NDVjZQ==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-12-15T16:58:16Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2020-01-03T20:13:21Z"
    },
    "message": "Ensure GDB warnings are styled.\n\nWhile handling the comments of Tom related to\n  [RFC] Have an option to tell GDB to detect and possibly handle mismatched exec-files.\n  https://sourceware.org/ml/gdb-patches/2019-12/msg00621.html\nI saw that GDB warnings are produced ignoring the given styles.\n\nThis patch:\n  * ensures that style markups are properly handled by \"warning\".\n  * changes 'set/show data-directory' so that file style is used\n    in warnings and in 'show message'\n  * changes all other messages in top.c to use file style when appropriate.\n  * Uses the above data-directory changes in gdb.base/style.exp\n\n2020-01-03  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* ui-file.c (stdio_file::can_emit_style_escape)\n\t(tee_file::can_emit_style_escape): Ensure style is used also on\n\tgdb_stderr when gdb_stderr is a tty supporting styling, similarly\n\tto gdb_stdout.\n\t* main.c (set_gdb_data_directory): Use file style to output the\n\twarning that the given pathname is not a directory.\n\t* top.c (show_history_filename, gdb_safe_append_history)\n\t(show_gdb_datadir): Use file style.\n\n2020-01-03  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* gdb.base/style.exp: Test that warnings are styled.",
    "tree": {
      "sha": "69c29a3159e27912cd1faa5d665543b37ff07c36",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/69c29a3159e27912cd1faa5d665543b37ff07c36"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6ec1d75e05a646eb602de4034366ec5fec7545ce",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6ec1d75e05a646eb602de4034366ec5fec7545ce",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6ec1d75e05a646eb602de4034366ec5fec7545ce",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6ec1d75e05a646eb602de4034366ec5fec7545ce/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "44f81a76542dbeada2541a05de191ae0ac0fbc2c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/44f81a76542dbeada2541a05de191ae0ac0fbc2c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/44f81a76542dbeada2541a05de191ae0ac0fbc2c"
    }
  ],
  "stats": {
    "total": 44,
    "additions": 35,
    "deletions": 9
  },
  "files": [
    {
      "sha": "7bd889777b42407e51df72f2fd4034eaed8e8fb9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=6ec1d75e05a646eb602de4034366ec5fec7545ce",
      "patch": "@@ -1,3 +1,14 @@\n+2020-01-03  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* ui-file.c (stdio_file::can_emit_style_escape)\n+\t(tee_file::can_emit_style_escape): Ensure style is used also on\n+\tgdb_stderr when gdb_stderr is a tty supporting styling, similarly\n+\tto gdb_stdout.\n+\t* main.c (set_gdb_data_directory): Use file style to output the\n+\twarning that the given pathname is not a directory.\n+\t* top.c (show_history_filename, gdb_safe_append_history)\n+\t(show_gdb_datadir): Use file style.\n+\n 2020-01-03  Hannes Domani  <ssbssa@yahoo.de>\n \n \t* solib-target.c (struct lm_info_target):"
    },
    {
      "sha": "d5e5a678baa729d7b9210fecf9ef650f5c5233e9",
      "filename": "gdb/main.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/main.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/main.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/main.c?ref=6ec1d75e05a646eb602de4034366ec5fec7545ce",
      "patch": "@@ -124,7 +124,8 @@ set_gdb_data_directory (const char *new_datadir)\n       print_sys_errmsg (new_datadir, save_errno);\n     }\n   else if (!S_ISDIR (st.st_mode))\n-    warning (_(\"%s is not a directory.\"), new_datadir);\n+    warning (_(\"%ps is not a directory.\"),\n+\t     styled_string (file_name_style.style (), new_datadir));\n \n   gdb_datadir = gdb_realpath (new_datadir).get ();\n "
    },
    {
      "sha": "78f9700f25713b57073f66734638bd523108445d",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=6ec1d75e05a646eb602de4034366ec5fec7545ce",
      "patch": "@@ -1,3 +1,7 @@\n+2020-01-03  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* gdb.base/style.exp: Test that warnings are styled.\n+\n 2019-12-29  Bernd Edlinger  <bernd.edlinger@hotmail.de>\n \n \t* gdb.base/line65535.exp: New file."
    },
    {
      "sha": "0457c3dc4ad0a61f0382720cbf07ef49aa34a01b",
      "filename": "gdb/testsuite/gdb.base/style.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/testsuite/gdb.base/style.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/testsuite/gdb.base/style.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/style.exp?ref=6ec1d75e05a646eb602de4034366ec5fec7545ce",
      "patch": "@@ -139,4 +139,10 @@ save_vars { env(TERM) } {\n \n     gdb_test \"show logging file\" \\\n \t\"The current logfile is \\\"[style .*? file]\\\"\\\\..*\"\n+\n+    # Check warnings are styled by setting a rubbish data directory.\n+    gdb_test \"set data-directory Makefile\" \\\n+\t\"warning: [style .*? file] is not a directory\\\\..*\"\n+    gdb_test \"show data-directory\" \\\n+\t\"GDB's data directory is \\\"[style .*? file]\\\"\\\\..*\"\n }"
    },
    {
      "sha": "3b93683cfafae5e9a36ce8fb8409c3497cd383b9",
      "filename": "gdb/top.c",
      "status": "modified",
      "additions": 10,
      "deletions": 6,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.c?ref=6ec1d75e05a646eb602de4034366ec5fec7545ce",
      "patch": "@@ -55,6 +55,7 @@\n #include \"gdbsupport/scope-exit.h\"\n #include \"gdbarch.h\"\n #include \"gdbsupport/pathstuff.h\"\n+#include \"cli/cli-style.h\"\n \n /* readline include files.  */\n #include \"readline/readline.h\"\n@@ -924,8 +925,8 @@ show_history_filename (struct ui_file *file, int from_tty,\n \t\t       struct cmd_list_element *c, const char *value)\n {\n   fprintf_filtered (file, _(\"The filename in which to record \"\n-\t\t\t    \"the command history is \\\"%s\\\".\\n\"),\n-\t\t    value);\n+\t\t\t    \"the command history is \\\"%ps\\\".\\n\"),\n+\t\t    styled_string (file_name_style.style (), value));\n }\n \n /* This is like readline(), but it has some gdb-specific behavior.\n@@ -1192,8 +1193,10 @@ gdb_safe_append_history (void)\n   saved_errno = errno;\n   if (ret < 0 && saved_errno != ENOENT)\n     {\n-      warning (_(\"Could not rename %s to %s: %s\"),\n-\t       history_filename, local_history_filename.c_str (),\n+      warning (_(\"Could not rename %ps to %ps: %s\"),\n+\t       styled_string (file_name_style.style (), history_filename),\n+\t       styled_string (file_name_style.style (),\n+\t\t\t      local_history_filename.c_str ()),\n \t       safe_strerror (saved_errno));\n     }\n   else\n@@ -2094,8 +2097,9 @@ static void\n show_gdb_datadir (struct ui_file *file, int from_tty,\n \t\t  struct cmd_list_element *c, const char *value)\n {\n-  fprintf_filtered (file, _(\"GDB's data directory is \\\"%s\\\".\\n\"),\n-\t\t    gdb_datadir.c_str ());\n+  fprintf_filtered (file, _(\"GDB's data directory is \\\"%ps\\\".\\n\"),\n+\t\t    styled_string (file_name_style.style (),\n+\t\t\t\t   gdb_datadir.c_str ()));\n }\n \n static void"
    },
    {
      "sha": "af128b08f54f73575d567e7c19a6ad60311ca746",
      "filename": "gdb/ui-file.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/ui-file.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6ec1d75e05a646eb602de4034366ec5fec7545ce/gdb/ui-file.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ui-file.c?ref=6ec1d75e05a646eb602de4034366ec5fec7545ce",
      "patch": "@@ -302,7 +302,7 @@ stdio_file::isatty ()\n bool\n stdio_file::can_emit_style_escape ()\n {\n-  return (this == gdb_stdout\n+  return ((this == gdb_stdout || this == gdb_stderr)\n \t  && this->isatty ()\n \t  && term_cli_styling ());\n }\n@@ -391,7 +391,7 @@ tee_file::term_out ()\n bool\n tee_file::can_emit_style_escape ()\n {\n-  return (this == gdb_stdout\n+  return ((this == gdb_stdout || this == gdb_stderr)\n \t  && m_one->term_out ()\n \t  && term_cli_styling ());\n }"
    }
  ]
}