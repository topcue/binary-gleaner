{
  "sha": "c47860a4bad058631c433490c1e3ec672d613553",
  "node_id": "C_kwDOANOeidoAKGM0Nzg2MGE0YmFkMDU4NjMxYzQzMzQ5MGMxZTNlYzY3MmQ2MTM1NTM",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-11-02T08:27:48Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-11-02T08:27:48Z"
    },
    "message": "[gdb/testsuite] Fix stepi test-cases with unix/-m32/-fPIE/-pie\n\nWhen running test-case gdb.base/step-indirect-call-thunk.exp with target board\nunix/-m32/-fPIE/-pie, I run into:\n...\n(gdb) stepi^M\n0x5655552e      22      {                /* inc.1 */^M\n(gdb) stepi^M\n0x56555530      22      {                /* inc.1 */^M\n(gdb) stepi^M\n0x565555f7 in __x86.get_pc_thunk.ax ()^M\n(gdb) FAIL: gdb.base/step-indirect-call-thunk.exp: stepi into return thunk\n...\n\nIn contrast, with unix/-m32 we have instead:\n...\n(gdb) stepi^M\n0x08048407      22      {                /* inc.1 */^M\n(gdb) stepi^M\n23        return x + 1;  /* inc.2 */^M\n(gdb) stepi^M\n0x0804840c      23        return x + 1;  /* inc.2 */^M\n(gdb) stepi^M\n24      }                /* inc.3 */^M\n(gdb) stepi^M\n0x08048410      24      }                /* inc.3 */^M\n(gdb) stepi^M\n0x0804848f in __x86_return_thunk ()^M\n(gdb) PASS: gdb.base/step-indirect-call-thunk.exp: stepi into return thunk\n...\n\nThe test-case doesn't expect to run into __x86.get_pc_thunk.ax, which is a\nPIC helper function for x86_64-linux.\n\nFix this by insn-stepping through it.\n\nLikewise in a few other test-cases.\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "6c63ce5298a793b220175d58ccb509ec3d007ecb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6c63ce5298a793b220175d58ccb509ec3d007ecb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c47860a4bad058631c433490c1e3ec672d613553",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c47860a4bad058631c433490c1e3ec672d613553",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c47860a4bad058631c433490c1e3ec672d613553",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c47860a4bad058631c433490c1e3ec672d613553/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "317db249c7a361aa6e723fefc09116fd9cd75978",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/317db249c7a361aa6e723fefc09116fd9cd75978",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/317db249c7a361aa6e723fefc09116fd9cd75978"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 31,
    "deletions": 4
  },
  "files": [
    {
      "sha": "579dbf9c16f5e386ed06e9af54c2b7d50e772c3e",
      "filename": "gdb/testsuite/gdb.base/step-indirect-call-thunk.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.base/step-indirect-call-thunk.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.base/step-indirect-call-thunk.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/step-indirect-call-thunk.exp?ref=c47860a4bad058631c433490c1e3ec672d613553",
      "patch": "@@ -64,9 +64,12 @@ gdb_test \"step\" \"inc\\.2.*\" \"step through call thunk into inc\"\n gdb_test \"step\" \"inc\\.3.*\" \"step inside inc\"\n gdb_test \"step\" \"thrice\\.4.*\" \"step through return thunk back into thrice\"\n \n+set alphanum_re \"\\[a-zA-Z0-9\\]\"\n+set pic_thunk_re  \"__$alphanum_re*\\\\.get_pc_thunk\\\\.$alphanum_re* \\\\(\\\\)\"\n+\n # We can use instruction stepping to step into thunks.\n stepi_until \"thrice\" \"indirect_thunk\" \"stepi into call thunk\"\n stepi_until \"indirect_thunk\" \"inc.\" \"stepi out of call thunk into inc\"\n-stepi_until \"inc\" \"return_thunk\" \"stepi into return thunk\"\n+stepi_until \"(inc|$pic_thunk_re)\" \"return_thunk\" \"stepi into return thunk\"\n stepi_until \"return_thunk\" \"thrice\" \\\n     \"stepi out of return thunk back into thrice\""
    },
    {
      "sha": "b7acb588e44ec99d7944c5cd05faf09bf34a0713",
      "filename": "gdb/testsuite/gdb.base/step-test.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.base/step-test.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.base/step-test.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/step-test.exp?ref=c47860a4bad058631c433490c1e3ec672d613553",
      "patch": "@@ -127,8 +127,10 @@ test_i \"stepi into function\" \"stepi\" \\\n # Continue to step until we reach the function's body.  This makes it\n # more likely that we've actually completed the prologue, so \"finish\"\n # will work.\n+set alphanum_re \"\\[a-zA-Z0-9\\]\"\n+set pic_thunk_re  \"__$alphanum_re*\\\\.get_pc_thunk\\\\.$alphanum_re* \\\\(\\\\)\"\n test_i \"stepi into function's first source line\" \"stepi\" \\\n-\t\".*${decimal}.*int callee\" \\\n+\t\"(${decimal}.*int callee|$pic_thunk_re)\" \\\n \t\".*${decimal}.*myglob.*; return 0;\"\n \n # Have to be careful here, if the finish does not work, "
    },
    {
      "sha": "8fe108b1e5e389af0483f032ee06389dd7d2e8fd",
      "filename": "gdb/testsuite/gdb.reverse/step-indirect-call-thunk.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.reverse/step-indirect-call-thunk.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.reverse/step-indirect-call-thunk.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.reverse/step-indirect-call-thunk.exp?ref=c47860a4bad058631c433490c1e3ec672d613553",
      "patch": "@@ -85,15 +85,17 @@ gdb_test \"reverse-next\" \"apply\\.2.*\" \\\n step_until \"stepi\" \"apply\\.2\" \"indirect_thunk\" \"stepi into call thunk\"\n step_until \"stepi\" \"indirect_thunk\" \"inc\" \\\n     \"stepi out of call thunk into inc\"\n-step_until \"stepi\" \"inc\" \"return_thunk\" \"stepi into return thunk\"\n+set alphanum_re \"\\[a-zA-Z0-9\\]\"\n+set pic_thunk_re  \"__$alphanum_re*\\\\.get_pc_thunk\\\\.$alphanum_re* \\\\(\\\\)\"\n+step_until \"stepi\" \"(inc|$pic_thunk_re)\" \"return_thunk\" \"stepi into return thunk\"\n step_until \"stepi\" \"return_thunk\" \"apply\" \\\n     \"stepi out of return thunk back into apply\"\n \n step_until \"reverse-stepi\" \"apply\" \"return_thunk\" \\\n     \"reverse-stepi into return thunk\"\n step_until \"reverse-stepi\" \"return_thunk\" \"inc\" \\\n     \"reverse-stepi out of return thunk into inc\"\n-step_until \"reverse-stepi\" \"inc\" \"indirect_thunk\" \\\n+step_until \"reverse-stepi\" \"(inc|$pic_thunk_re)\" \"indirect_thunk\" \\\n     \"reverse-stepi into call thunk\"\n step_until \"reverse-stepi\" \"indirect_thunk\" \"apply\" \\\n     \"reverse-stepi out of call thunk into apply\""
    },
    {
      "sha": "e85cdabfb7336d68883e83e9f5879e8fcda72450",
      "filename": "gdb/testsuite/gdb.reverse/step-precsave.exp",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.reverse/step-precsave.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.reverse/step-precsave.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.reverse/step-precsave.exp?ref=c47860a4bad058631c433490c1e3ec672d613553",
      "patch": "@@ -124,6 +124,8 @@ gdb_test_multiple \"stepi\" \"$test_message\" {\n \n # stepi into a function call\n \n+set alphanum_re \"\\[a-zA-Z0-9\\]\"\n+set pic_thunk_re  \"__$alphanum_re*\\\\.get_pc_thunk\\\\.$alphanum_re* \\\\(\\\\)\"\n set test_message \"stepi into function call\"\n gdb_test_multiple \"stepi\" \"$test_message\" {\n     -re \"ARRIVED IN CALLEE.*$gdb_prompt $\" {\n@@ -143,6 +145,10 @@ gdb_test_multiple \"stepi\" \"$test_message\" {\n \tsend_gdb \"stepi\\n\"\n \texp_continue\n     }\n+    -re \"$pic_thunk_re.*$gdb_prompt $\" {\n+\tsend_gdb \"stepi\\n\"\n+\texp_continue\n+    }\n }\n \n # stepi thru return of a function call\n@@ -216,6 +222,10 @@ gdb_test_multiple \"stepi\" \"$test_message\" {\n \tsend_gdb \"stepi\\n\" \n \texp_continue\n     }\n+    -re \"$pic_thunk_re.*$gdb_prompt $\" {\n+\tsend_gdb \"stepi\\n\"\n+\texp_continue\n+    }\n     -re \"${hex} in main .*:$stepi_location.*STEPI TEST.*$gdb_prompt $\" {\n \tsend_gdb \"stepi\\n\"\n \texp_continue"
    },
    {
      "sha": "32c18faaaa6c7aca065658a330ca94fcb0361373",
      "filename": "gdb/testsuite/gdb.reverse/step-reverse.exp",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.reverse/step-reverse.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c47860a4bad058631c433490c1e3ec672d613553/gdb/testsuite/gdb.reverse/step-reverse.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.reverse/step-reverse.exp?ref=c47860a4bad058631c433490c1e3ec672d613553",
      "patch": "@@ -87,6 +87,8 @@ gdb_test_multiple \"stepi\" \"$test_message\" {\n \n # stepi into a function call\n \n+set alphanum_re \"\\[a-zA-Z0-9\\]\"\n+set pic_thunk_re  \"__$alphanum_re*\\\\.get_pc_thunk\\\\.$alphanum_re* \\\\(\\\\)\"\n set test_message \"stepi into function call\"\n gdb_test_multiple \"stepi\" \"$test_message\" {\n     -re \"ARRIVED IN CALLEE.*$gdb_prompt $\" {\n@@ -106,6 +108,10 @@ gdb_test_multiple \"stepi\" \"$test_message\" {\n \tsend_gdb \"stepi\\n\"\n \texp_continue\n     }\n+    -re \"$pic_thunk_re.*$gdb_prompt $\" {\n+\tsend_gdb \"stepi\\n\"\n+\texp_continue\n+    }\n }\n \n # stepi thru return of a function call\n@@ -179,6 +185,10 @@ gdb_test_multiple \"stepi\" \"$test_message\" {\n \tsend_gdb \"stepi\\n\" \n \texp_continue\n     }\n+    -re \"$pic_thunk_re.*$gdb_prompt $\" {\n+\tsend_gdb \"stepi\\n\"\n+\texp_continue\n+    }\n     -re \"${hex} in main .*:$stepi_location.*STEPI TEST.*$gdb_prompt $\" {\n \tsend_gdb \"stepi\\n\"\n \texp_continue"
    }
  ]
}