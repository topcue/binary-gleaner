{
  "sha": "268533381f80d18698fea9b15f942427f1d34cba",
  "node_id": "C_kwDOANOeidoAKDI2ODUzMzM4MWY4MGQxODY5OGZlYTliMTVmOTQyNDI3ZjFkMzRjYmE",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2022-01-13T13:43:05Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2022-01-13T13:48:47Z"
    },
    "message": "Reapply libiberty: Pass --plugin to AR and RANLIB\n\nReapply the patch to detect GCC LTO plugin used for libiberty build to\nsupport LTO build in libiberty.\n\n\t* Makefile.in (AR): Add @AR_PLUGIN_OPTION@\n\t(RANLIB): Add @RANLIB_PLUGIN_OPTION@.\n\t(configure_deps): Depend on ../config/gcc-plugin.m4.\n\t* aclocal.m4: Include ../config/gcc-plugin.m4.\n\t* configure.ac: AC_SUBST AR_PLUGIN_OPTION and\n\tRANLIB_PLUGIN_OPTION.\n\t* configure: Regenerate.",
    "tree": {
      "sha": "86c20a8cbf98654b87fabdad2d8ea968daf99540",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/86c20a8cbf98654b87fabdad2d8ea968daf99540"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/268533381f80d18698fea9b15f942427f1d34cba",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/268533381f80d18698fea9b15f942427f1d34cba",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/268533381f80d18698fea9b15f942427f1d34cba",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/268533381f80d18698fea9b15f942427f1d34cba/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2f83249c13d86065b4c7cdb198ea871017b4bba1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f83249c13d86065b4c7cdb198ea871017b4bba1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2f83249c13d86065b4c7cdb198ea871017b4bba1"
    }
  ],
  "stats": {
    "total": 172,
    "additions": 157,
    "deletions": 15
  },
  "files": [
    {
      "sha": "abef3c4601b74e7199d4328175f2398283bd87e1",
      "filename": "libiberty/Makefile.in",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/268533381f80d18698fea9b15f942427f1d34cba/libiberty/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/268533381f80d18698fea9b15f942427f1d34cba/libiberty/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libiberty/Makefile.in?ref=268533381f80d18698fea9b15f942427f1d34cba",
      "patch": "@@ -50,13 +50,13 @@ mkinstalldirs = $(SHELL) $(libiberty_topdir)/mkinstalldirs\n # Some compilers can't handle cc -c blah.c -o foo/blah.o.\n OUTPUT_OPTION = @OUTPUT_OPTION@\n \n-AR = @AR@\n+AR = @AR@ @AR_PLUGIN_OPTION@\n AR_FLAGS = rc\n \n CC = @CC@\n CFLAGS = @CFLAGS@\n CPPFLAGS = @CPPFLAGS@\n-RANLIB = @RANLIB@\n+RANLIB = @RANLIB@ @RANLIB_PLUGIN_OPTION@\n MAKEINFO = @MAKEINFO@\n PERL = @PERL@\n \n@@ -507,6 +507,7 @@ aclocal_deps = \\\n \t$(srcdir)/../config/acx.m4 \\\n \t$(srcdir)/../config/cet.m4 \\\n \t$(srcdir)/../config/enable.m4 \\\n+\t$(srcdir)/../config/gcc-plugin.m4 \\\n \t$(srcdir)/../config/no-executables.m4 \\\n \t$(srcdir)/../config/override.m4 \\\n \t$(srcdir)/../config/picflag.m4 \\"
    },
    {
      "sha": "0757688d52a4c8c620f4cd79e45608f61122a01d",
      "filename": "libiberty/aclocal.m4",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/268533381f80d18698fea9b15f942427f1d34cba/libiberty/aclocal.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/268533381f80d18698fea9b15f942427f1d34cba/libiberty/aclocal.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libiberty/aclocal.m4?ref=268533381f80d18698fea9b15f942427f1d34cba",
      "patch": "@@ -15,6 +15,7 @@ m4_ifndef([AC_CONFIG_MACRO_DIRS], [m4_defun([_AM_CONFIG_MACRO_DIRS], [])m4_defun\n m4_include([../config/acx.m4])\n m4_include([../config/cet.m4])\n m4_include([../config/enable.m4])\n+m4_include([../config/gcc-plugin.m4])\n m4_include([../config/no-executables.m4])\n m4_include([../config/picflag.m4])\n m4_include([../config/warnings.m4])"
    },
    {
      "sha": "e09ddd91e584f8d6947f27aa6680848840cb7277",
      "filename": "libiberty/configure",
      "status": "modified",
      "additions": 141,
      "deletions": 13,
      "changes": 154,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/268533381f80d18698fea9b15f942427f1d34cba/libiberty/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/268533381f80d18698fea9b15f942427f1d34cba/libiberty/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libiberty/configure?ref=268533381f80d18698fea9b15f942427f1d34cba",
      "patch": "@@ -645,6 +645,8 @@ CPPFLAGS\n LDFLAGS\n CFLAGS\n CC\n+RANLIB_PLUGIN_OPTION\n+AR_PLUGIN_OPTION\n RANLIB\n AR\n host_os\n@@ -682,7 +684,6 @@ infodir\n docdir\n oldincludedir\n includedir\n-runstatedir\n localstatedir\n sharedstatedir\n sysconfdir\n@@ -762,7 +763,6 @@ datadir='${datarootdir}'\n sysconfdir='${prefix}/etc'\n sharedstatedir='${prefix}/com'\n localstatedir='${prefix}/var'\n-runstatedir='${localstatedir}/run'\n includedir='${prefix}/include'\n oldincludedir='/usr/include'\n docdir='${datarootdir}/doc/${PACKAGE}'\n@@ -1015,15 +1015,6 @@ do\n   | -silent | --silent | --silen | --sile | --sil)\n     silent=yes ;;\n \n-  -runstatedir | --runstatedir | --runstatedi | --runstated \\\n-  | --runstate | --runstat | --runsta | --runst | --runs \\\n-  | --run | --ru | --r)\n-    ac_prev=runstatedir ;;\n-  -runstatedir=* | --runstatedir=* | --runstatedi=* | --runstated=* \\\n-  | --runstate=* | --runstat=* | --runsta=* | --runst=* | --runs=* \\\n-  | --run=* | --ru=* | --r=*)\n-    runstatedir=$ac_optarg ;;\n-\n   -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)\n     ac_prev=sbindir ;;\n   -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \\\n@@ -1161,7 +1152,7 @@ fi\n for ac_var in\texec_prefix prefix bindir sbindir libexecdir datarootdir \\\n \t\tdatadir sysconfdir sharedstatedir localstatedir includedir \\\n \t\toldincludedir docdir infodir htmldir dvidir pdfdir psdir \\\n-\t\tlibdir localedir mandir runstatedir\n+\t\tlibdir localedir mandir\n do\n   eval ac_val=\\$$ac_var\n   # Remove trailing slashes.\n@@ -1314,7 +1305,6 @@ Fine tuning of the installation directories:\n   --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]\n   --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]\n   --localstatedir=DIR     modifiable single-machine data [PREFIX/var]\n-  --runstatedir=DIR       modifiable per-process data [LOCALSTATEDIR/run]\n   --libdir=DIR            object code libraries [EPREFIX/lib]\n   --includedir=DIR        C header files [PREFIX/include]\n   --oldincludedir=DIR     C header files for non-gcc [/usr/include]\n@@ -2947,6 +2937,144 @@ else\n fi\n \n \n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for -plugin option\" >&5\n+$as_echo_n \"checking for -plugin option... \" >&6; }\n+\n+plugin_names=\"liblto_plugin.so liblto_plugin-0.dll cyglto_plugin-0.dll\"\n+plugin_option=\n+for plugin in $plugin_names; do\n+  plugin_so=`${CC} ${CFLAGS} --print-prog-name $plugin`\n+  if test x$plugin_so = x$plugin; then\n+    plugin_so=`${CC} ${CFLAGS} --print-file-name $plugin`\n+  fi\n+  if test x$plugin_so != x$plugin; then\n+    plugin_option=\"--plugin $plugin_so\"\n+    break\n+  fi\n+done\n+if test -n \"$ac_tool_prefix\"; then\n+  # Extract the first word of \"${ac_tool_prefix}ar\", so it can be a program name with args.\n+set dummy ${ac_tool_prefix}ar; ac_word=$2\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $ac_word\" >&5\n+$as_echo_n \"checking for $ac_word... \" >&6; }\n+if ${ac_cv_prog_AR+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  if test -n \"$AR\"; then\n+  ac_cv_prog_AR=\"$AR\" # Let the user override the test.\n+else\n+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+    for ac_exec_ext in '' $ac_executable_extensions; do\n+  if as_fn_executable_p \"$as_dir/$ac_word$ac_exec_ext\"; then\n+    ac_cv_prog_AR=\"${ac_tool_prefix}ar\"\n+    $as_echo \"$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext\" >&5\n+    break 2\n+  fi\n+done\n+  done\n+IFS=$as_save_IFS\n+\n+fi\n+fi\n+AR=$ac_cv_prog_AR\n+if test -n \"$AR\"; then\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $AR\" >&5\n+$as_echo \"$AR\" >&6; }\n+else\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+fi\n+\n+\n+fi\n+if test -z \"$ac_cv_prog_AR\"; then\n+  ac_ct_AR=$AR\n+  # Extract the first word of \"ar\", so it can be a program name with args.\n+set dummy ar; ac_word=$2\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for $ac_word\" >&5\n+$as_echo_n \"checking for $ac_word... \" >&6; }\n+if ${ac_cv_prog_ac_ct_AR+:} false; then :\n+  $as_echo_n \"(cached) \" >&6\n+else\n+  if test -n \"$ac_ct_AR\"; then\n+  ac_cv_prog_ac_ct_AR=\"$ac_ct_AR\" # Let the user override the test.\n+else\n+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR\n+for as_dir in $PATH\n+do\n+  IFS=$as_save_IFS\n+  test -z \"$as_dir\" && as_dir=.\n+    for ac_exec_ext in '' $ac_executable_extensions; do\n+  if as_fn_executable_p \"$as_dir/$ac_word$ac_exec_ext\"; then\n+    ac_cv_prog_ac_ct_AR=\"ar\"\n+    $as_echo \"$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext\" >&5\n+    break 2\n+  fi\n+done\n+  done\n+IFS=$as_save_IFS\n+\n+fi\n+fi\n+ac_ct_AR=$ac_cv_prog_ac_ct_AR\n+if test -n \"$ac_ct_AR\"; then\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_ct_AR\" >&5\n+$as_echo \"$ac_ct_AR\" >&6; }\n+else\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+fi\n+\n+  if test \"x$ac_ct_AR\" = x; then\n+    AR=\"\"\n+  else\n+    case $cross_compiling:$ac_tool_warned in\n+yes:)\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: using cross tools not prefixed with host triplet\" >&5\n+$as_echo \"$as_me: WARNING: using cross tools not prefixed with host triplet\" >&2;}\n+ac_tool_warned=yes ;;\n+esac\n+    AR=$ac_ct_AR\n+  fi\n+else\n+  AR=\"$ac_cv_prog_AR\"\n+fi\n+\n+if test \"${AR}\" = \"\" ; then\n+  as_fn_error $? \"Required archive tool 'ar' not found on PATH.\" \"$LINENO\" 5\n+fi\n+touch conftest.c\n+${AR} $plugin_option rc conftest.a conftest.c\n+if test \"$?\" != 0; then\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: WARNING: Failed: $AR $plugin_option rc\" >&5\n+$as_echo \"$as_me: WARNING: Failed: $AR $plugin_option rc\" >&2;}\n+  plugin_option=\n+fi\n+rm -f conftest.*\n+if test -n \"$plugin_option\"; then\n+  PLUGIN_OPTION=\"$plugin_option\"\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: $plugin_option\" >&5\n+$as_echo \"$plugin_option\" >&6; }\n+else\n+  { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\n+$as_echo \"no\" >&6; }\n+fi\n+\n+if test -n \"$PLUGIN_OPTION\"; then\n+  if $AR --help 2>&1 | grep -q \"\\--plugin\"; then\n+    AR_PLUGIN_OPTION=\"$PLUGIN_OPTION\"\n+\n+  fi\n+  if $RANLIB --help 2>&1 | grep -q \"\\--plugin\"; then\n+    RANLIB_PLUGIN_OPTION=\"$PLUGIN_OPTION\"\n+\n+  fi\n+fi\n+\n # Add --enable-multilib to configure.\n # Default to --enable-multilib\n # Check whether --enable-multilib was given."
    },
    {
      "sha": "f59f35e1f208cb493a0696faac9c0ea836f09263",
      "filename": "libiberty/configure.ac",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/268533381f80d18698fea9b15f942427f1d34cba/libiberty/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/268533381f80d18698fea9b15f942427f1d34cba/libiberty/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libiberty/configure.ac?ref=268533381f80d18698fea9b15f942427f1d34cba",
      "patch": "@@ -113,6 +113,18 @@ dnl to call AC_CHECK_PROG.\n AC_CHECK_TOOL(AR, ar)\n AC_CHECK_TOOL(RANLIB, ranlib, :)\n \n+GCC_PLUGIN_OPTION(PLUGIN_OPTION)\n+if test -n \"$PLUGIN_OPTION\"; then\n+  if $AR --help 2>&1 | grep -q \"\\--plugin\"; then\n+    AR_PLUGIN_OPTION=\"$PLUGIN_OPTION\"\n+    AC_SUBST(AR_PLUGIN_OPTION)\n+  fi\n+  if $RANLIB --help 2>&1 | grep -q \"\\--plugin\"; then\n+    RANLIB_PLUGIN_OPTION=\"$PLUGIN_OPTION\"\n+    AC_SUBST(RANLIB_PLUGIN_OPTION)\n+  fi\n+fi\n+\n dnl When switching to automake, replace the following with AM_ENABLE_MULTILIB.\n # Add --enable-multilib to configure.\n # Default to --enable-multilib"
    }
  ]
}