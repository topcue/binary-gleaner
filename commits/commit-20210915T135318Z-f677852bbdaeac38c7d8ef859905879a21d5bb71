{
  "sha": "f677852bbdaeac38c7d8ef859905879a21d5bb71",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjY3Nzg1MmJiZGFlYWMzOGM3ZDhlZjg1OTkwNTg3OWEyMWQ1YmI3MQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-15T13:53:18Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-15T13:53:18Z"
    },
    "message": "[gdb/testsuite] Use function_range in gdb.dwarf2/dw2-abs-hi-pc.exp\n\nWhen I run test-case gdb.dwarf2/dw2-abs-hi-pc.exp with gcc, we have:\n...\n(gdb) break hello^M\nBreakpoint 1 at 0x4004c0: file dw2-abs-hi-pc-hello.c, line 24.^M\n(gdb) PASS: gdb.dwarf2/dw2-abs-hi-pc.exp: break hello\n...\nbut with clang, I run into:\n...\n(gdb) break hello^M\nBreakpoint 1 at 0x4004e4^M\n(gdb) FAIL: gdb.dwarf2/dw2-abs-hi-pc.exp: break hello\n...\n\nThe problem is that the CU and function both have an empty address range:\n...\n <0><d2>: Abbrev Number: 1 (DW_TAG_compile_unit)\n    <108>   DW_AT_name        : dw2-abs-hi-pc-hello.c\n    <123>   DW_AT_low_pc      : 0x4004e0\n    <127>   DW_AT_high_pc     : 0x4004e0\n <1><12f>: Abbrev Number: 2 (DW_TAG_subprogram)\n    <131>   DW_AT_name        : hello\n    <13a>   DW_AT_low_pc      : 0x4004e0\n    <13e>   DW_AT_high_pc     : 0x4004e0\n...\n\nThe address ranges are set like this in dw2-abs-hi-pc-hello-dbg.S:\n...\n        .4byte  .hello_start    /* DW_AT_low_pc */\n        .4byte  .hello_end      /* DW_AT_high_pc */\n...\nwhere the labels refer to dw2-abs-hi-pc-hello.c:\n...\nextern int v;\n\nasm (\".hello_start: .globl .hello_start\\n\");\nvoid\nhello (void)\n{\nasm (\".hello0: .globl .hello0\\n\");\n  v++;\nasm (\".hello1: .globl .hello1\\n\");\n}\nasm (\".hello_end: .globl .hello_end\\n\");\n...\n\nUsing asm labels in global scope is a known source of problems, as explained\nin the comment of proc function_range in gdb/testsuite/lib/dwarf.exp.\n\nFix this by using function_range instead.\n\nTested on x86_64-linux with gcc and clang-7 and clang-12.",
    "tree": {
      "sha": "9a4a66677ed20586e4f18c98af615e4f97df79cc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9a4a66677ed20586e4f18c98af615e4f97df79cc"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f677852bbdaeac38c7d8ef859905879a21d5bb71",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f677852bbdaeac38c7d8ef859905879a21d5bb71",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f677852bbdaeac38c7d8ef859905879a21d5bb71",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f677852bbdaeac38c7d8ef859905879a21d5bb71/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "720f6ee0959d9b493051d63f75d0d609d3d392ad",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/720f6ee0959d9b493051d63f75d0d609d3d392ad",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/720f6ee0959d9b493051d63f75d0d609d3d392ad"
    }
  ],
  "stats": {
    "total": 59,
    "additions": 41,
    "deletions": 18
  },
  "files": [
    {
      "sha": "8f7103d89770750081aa3b94109ef0b4b52bf704",
      "filename": "gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello-dbg.S",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello-dbg.S",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello-dbg.S",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello-dbg.S?ref=f677852bbdaeac38c7d8ef859905879a21d5bb71",
      "patch": "@@ -24,17 +24,17 @@\n \t.byte\t0x1\t/* DW_AT_language */\n \t.ascii\t\"dw2-abs-hi-pc-hello.c\\0\"     /* DW_AT_name */\n \t.ascii  \"/tmp\\0\"        /* DW_AT_comp_dir */\n-\t.4byte\t.hello_start\t/* DW_AT_low_pc */\n-\t.4byte\t.hello_end\t/* DW_AT_high_pc */\n+\t.4byte\tHELLO_START\t/* DW_AT_low_pc */\n+\t.4byte\tHELLO_END\t/* DW_AT_high_pc */\n \t.4byte\t.Ldebug_line0\t/* DW_AT_stmt_list */\n \t.uleb128 0x2\t/* (DIE (0x2d) DW_TAG_subprogram) */\n \t.byte\t0x1\t/* DW_AT_external */\n \t.ascii\t\"hello\\0\"\n \t.byte\t0x1\t/* DW_AT_decl_file (hello.c) */\n \t.byte\t0x13\t/* DW_AT_decl_line */\n \t.byte\t0x1\t/* DW_AT_prototyped */\n-\t.4byte\t.hello_start\t/* DW_AT_low_pc */\n-\t.4byte\t.hello_end\t/* DW_AT_high_pc */\n+\t.4byte\tHELLO_START\t/* DW_AT_low_pc */\n+\t.4byte\tHELLO_END\t/* DW_AT_high_pc */\n \t.byte\t0\t/* end of children of DIE 0xb */\n .Ledebug_info0:\n \n@@ -114,7 +114,7 @@ LELTP:\n         .byte   0        /* set address to .hello_start */\n         .uleb128 0x5\n         .byte   0x2\n-        .4byte  .hello_start\n+        .4byte  HELLO_START\n         .byte   0x3      /* DW_LNS_advance_line */\n         .sleb128 22      /* ... to 23 */\n         .byte   0x5      /* column 0 */\n@@ -144,7 +144,7 @@ LELTP:\n         .byte   0        /* set address to .hello_end */\n         .uleb128 0x5\n         .byte   0x2\n-        .4byte  .hello_end\n+        .4byte  HELLO_END\n         .byte   0        /* end sequence */\n         .uleb128 0x1\n         .byte   0x1"
    },
    {
      "sha": "ab24c9e72d10e9b77179e183b764fcd5c5632551",
      "filename": "gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-hello.c?ref=f677852bbdaeac38c7d8ef859905879a21d5bb71",
      "patch": "@@ -17,12 +17,11 @@\n \n extern int v;\n \n-asm (\".hello_start: .globl .hello_start\\n\");\n void\n hello (void)\n {\n+asm (\"hello_label: .globl hello_label\\n\");\n asm (\".hello0: .globl .hello0\\n\");\n   v++;\n asm (\".hello1: .globl .hello1\\n\");\n }\n-asm (\".hello_end: .globl .hello_end\\n\");"
    },
    {
      "sha": "ed74c990672f6653b0bfae370e1a7efd1ed4e65c",
      "filename": "gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world-dbg.S",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world-dbg.S",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world-dbg.S",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world-dbg.S?ref=f677852bbdaeac38c7d8ef859905879a21d5bb71",
      "patch": "@@ -24,17 +24,17 @@\n \t.byte\t0x1\t/* DW_AT_language */\n \t.ascii\t\"dw2-abs-hi-pc-world.c\\0\"     /* DW_AT_name */\n \t.ascii  \"/tmp\\0\"        /* DW_AT_comp_dir */\n-\t.4byte\t.world_start\t/* DW_AT_low_pc */\n-\t.4byte\t.world_end\t/* DW_AT_high_pc */\n+\t.4byte\tWORLD_START\t/* DW_AT_low_pc */\n+\t.4byte\tWORLD_END\t/* DW_AT_high_pc */\n \t.4byte\t.Ldebug_line0\t/* DW_AT_stmt_list */\n \t.uleb128 0x2\t/* (DIE (0x2d) DW_TAG_subprogram) */\n \t.byte\t0x1\t/* DW_AT_external */\n \t.ascii\t\"world\\0\"\n \t.byte\t0x1\t/* DW_AT_decl_file (world.c) */\n \t.byte\t0x13\t/* DW_AT_decl_line */\n \t.byte\t0x1\t/* DW_AT_prototyped */\n-\t.4byte\t.world_start\t/* DW_AT_low_pc */\n-\t.4byte\t.world_end\t/* DW_AT_high_pc */\n+\t.4byte\tWORLD_START\t/* DW_AT_low_pc */\n+\t.4byte\tWORLD_END\t/* DW_AT_high_pc */\n \t.byte\t0\t/* end of children of DIE 0xb */\n .Ledebug_info0:\n \n@@ -114,7 +114,7 @@ LELTP:\n         .byte   0        /* set address to .world_start */\n         .uleb128 0x5\n         .byte   0x2\n-        .4byte  .world_start\n+        .4byte  WORLD_START\n         .byte   0x3      /* DW_LNS_advance_line */\n         .sleb128 22      /* ... to 23 */\n         .byte   0x5      /* column 0 */\n@@ -144,7 +144,7 @@ LELTP:\n         .byte   0        /* set address to .world_end */\n         .uleb128 0x5\n         .byte   0x2\n-        .4byte  .world_end\n+        .4byte  WORLD_END\n         .byte   0        /* end sequence */\n         .uleb128 0x1\n         .byte   0x1"
    },
    {
      "sha": "d06734cb5b19779b73a2cedc4eabaec9ea989d0c",
      "filename": "gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc-world.c?ref=f677852bbdaeac38c7d8ef859905879a21d5bb71",
      "patch": "@@ -17,12 +17,11 @@\n \n extern int v;\n \n-asm (\".world_start: .globl .world_start\\n\");\n void\n world (void)\n {\n+asm (\"world_label: .globl world_label\\n\");\n asm (\".world0: .globl .world0\\n\");\n   v++;\n asm (\".world1: .globl .world1\\n\");\n }\n-asm (\".world_end: .globl .world_end\\n\");"
    },
    {
      "sha": "0bb49f1c10c41b584d68fd7144b31afc626baa2e",
      "filename": "gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc.exp",
      "status": "modified",
      "additions": 27,
      "deletions": 2,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f677852bbdaeac38c7d8ef859905879a21d5bb71/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/dw2-abs-hi-pc.exp?ref=f677852bbdaeac38c7d8ef859905879a21d5bb71",
      "patch": "@@ -20,9 +20,34 @@ if {![dwarf2_support]} {\n }\n \n standard_testfile\n-set executable ${testfile}\n \n-if {[build_executable ${testfile}.exp ${executable} \"${testfile}.c ${testfile}-hello-dbg.S ${testfile}-hello.c ${testfile}-world-dbg.S ${testfile}-world.c\" \"nodebug\"] == -1} {\n+set sources \\\n+    [list \\\n+\t ${testfile}.c \\\n+\t ${testfile}-hello.c \\\n+\t ${testfile}-world.c]\n+set sources [lmap i $sources { string cat \"${srcdir}/${subdir}/\" $i }]\n+lassign [function_range hello $sources] \\\n+    hello_start hello_len\n+lassign [function_range world $sources] \\\n+    world_start world_len\n+\n+set sources \\\n+    [list \\\n+\t ${testfile}.c \\\n+\t ${testfile}-hello-dbg.S \\\n+\t ${testfile}-hello.c \\\n+\t ${testfile}-world-dbg.S \\\n+\t ${testfile}-world.c]\n+set flags \\\n+    [list \\\n+\t \"nodebug\" \\\n+\t \"additional_flags=\\\"-DHELLO_START=$hello_start\\\"\" \\\n+\t \"additional_flags=\\\"-DHELLO_END=$hello_start + $hello_len\\\"\" \\\n+\t \"additional_flags=\\\"-DWORLD_START=$world_start\\\"\" \\\n+\t \"additional_flags=\\\"-DWORLD_END=$world_start + $world_len\\\"\"]\n+set executable ${testfile}\n+if {[build_executable ${testfile}.exp ${executable} $sources $flags] == -1} {\n     return -1\n }\n "
    }
  ]
}