{
  "sha": "38f8aa06d9c422934e635779783107c0d3be419a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzhmOGFhMDZkOWM0MjI5MzRlNjM1Nzc5NzgzMTA3YzBkM2JlNDE5YQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-08-08T21:34:19Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-08-08T21:34:19Z"
    },
    "message": "[gdb/build] Fix missing implicit constructor call with gcc 4.8\n\nWhen building gdb on x86_64-linux with --enable-targets riscv64-suse-linux, I\nrun into:\n...\nsrc/gdb/arch/riscv.c:112:45:   required from here\n/usr/include/c++/4.8/bits/hashtable_policy.h:195:39: error: no matching \\\n  function for call to 'std::pair<const riscv_gdbarch_features, const \\\n  std::unique_ptr<target_desc, target_desc_deleter> >::pair(const \\\n  riscv_gdbarch_features&, target_desc*&)'\n  : _M_v(std::forward<_Args>(__args)...) { }\n                                       ^\n...\nfor this code in riscv_lookup_target_description:\n...\n  /* Add to the cache.  */\n  riscv_tdesc_cache.emplace (features, tdesc);\n...\n\nWork around this compiler problem (filed as PR gcc/96537), similar to how that\nwas done in commit 6d0cf4464e \"Fix build with gcc-4.8.x\":\n...\n-  riscv_tdesc_cache.emplace (features, tdesc);\n+  riscv_tdesc_cache.emplace (features, target_desc_up (tdesc));\n...\nThat is, call the target_desc_up constructor explictly instead of implicitly.\n\nAlso, work around a similar issue in get_thread_arch_aspace_regcache.\n\nBuild on x86_64-linux with --enable-targets riscv64-suse-linux, and\nreg-tested.\n\ngdb/ChangeLog:\n\n2020-08-08  Tom de Vries  <tdevries@suse.de>\n\n\tPR build/26344\n\t* arch/riscv.c (riscv_lookup_target_description): Use an explicit\n\tconstructor.\n\t* regcache.c (get_thread_arch_aspace_regcache): Same.",
    "tree": {
      "sha": "d1fa5acfabf19f93827184c184f70ae214675c00",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d1fa5acfabf19f93827184c184f70ae214675c00"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/38f8aa06d9c422934e635779783107c0d3be419a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/38f8aa06d9c422934e635779783107c0d3be419a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/38f8aa06d9c422934e635779783107c0d3be419a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/38f8aa06d9c422934e635779783107c0d3be419a/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "bc853409cc6887e9d9ea9279b0c2b7e4ccdf230e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bc853409cc6887e9d9ea9279b0c2b7e4ccdf230e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bc853409cc6887e9d9ea9279b0c2b7e4ccdf230e"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 13,
    "deletions": 3
  },
  "files": [
    {
      "sha": "72bd0447fe20b984a7803fb9027b35a2304335fd",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/38f8aa06d9c422934e635779783107c0d3be419a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/38f8aa06d9c422934e635779783107c0d3be419a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=38f8aa06d9c422934e635779783107c0d3be419a",
      "patch": "@@ -1,3 +1,10 @@\n+2020-08-08  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR build/26344\n+\t* arch/riscv.c (riscv_lookup_target_description): Use an explicit\n+\tconstructor.\n+\t* regcache.c (get_thread_arch_aspace_regcache): Same.\n+\n 2020-08-07  Tom Tromey  <tromey@adacore.com>\n \n \t* ravenscar-thread.c"
    },
    {
      "sha": "8f5709092e92b36f836e2e93e8e5ac6054fc59e3",
      "filename": "gdb/arch/riscv.c",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/38f8aa06d9c422934e635779783107c0d3be419a/gdb/arch/riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/38f8aa06d9c422934e635779783107c0d3be419a/gdb/arch/riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arch/riscv.c?ref=38f8aa06d9c422934e635779783107c0d3be419a",
      "patch": "@@ -108,8 +108,9 @@ riscv_lookup_target_description (const struct riscv_gdbarch_features features)\n \n   target_desc *tdesc = riscv_create_target_description (features);\n \n-  /* Add to the cache.  */\n-  riscv_tdesc_cache.emplace (features, tdesc);\n+  /* Add to the cache.  Work around a problem with g++ 4.8 (PR96537):\n+     Call the target_desc_up constructor explictly instead of implicitly.  */\n+  riscv_tdesc_cache.emplace (features, target_desc_up (tdesc));\n \n   return tdesc;\n }"
    },
    {
      "sha": "cd54bc6b5f9f3081cfa824416d67bf2f90e31dee",
      "filename": "gdb/regcache.c",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/38f8aa06d9c422934e635779783107c0d3be419a/gdb/regcache.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/38f8aa06d9c422934e635779783107c0d3be419a/gdb/regcache.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/regcache.c?ref=38f8aa06d9c422934e635779783107c0d3be419a",
      "patch": "@@ -354,7 +354,9 @@ get_thread_arch_aspace_regcache (process_stratum_target *target,\n   /* It does not exist, create it.  */\n   regcache *new_regcache = new regcache (target, arch, aspace);\n   new_regcache->set_ptid (ptid);\n-  ptid_regc_map.insert (std::make_pair (ptid, new_regcache));\n+  /* Work around a problem with g++ 4.8 (PR96537): Call the regcache_up\n+     constructor explictly instead of implicitly.  */\n+  ptid_regc_map.insert (std::make_pair (ptid, regcache_up (new_regcache)));\n \n   return new_regcache;\n }"
    }
  ]
}