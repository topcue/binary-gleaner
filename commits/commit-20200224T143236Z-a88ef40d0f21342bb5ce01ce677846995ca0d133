{
  "sha": "a88ef40d0f21342bb5ce01ce677846995ca0d133",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTg4ZWY0MGQwZjIxMzQyYmI1Y2UwMWNlNjc3ODQ2OTk1Y2EwZDEzMw==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-02-24T14:32:36Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-02-24T14:32:36Z"
    },
    "message": "[gdb] Ensure listing of unused static var in info locals\n\nConsider a test-case compiled with -g:\n...\nint main (void) {\n  static int b = 2;\n  return 0;\n}\n...\n\nWhen running info locals in main, we get:\n...\n(gdb) info locals\nNo locals.\n...\n\nThe info locals documentation states:\n...\nPrint the local variables of the selected frame, each on a separate line.\nThese are all variables (declared either static or automatic) accessible at\nthe point of execution of the selected frame.\n...\nSo, \"info locals\" should have printed static variable b.\n\nThe variable is present in dwarf info:\n...\n <2><14a>: Abbrev Number: 6 (DW_TAG_variable)\n    <14b>   DW_AT_name        : b\n    <153>   DW_AT_const_value : 2\n...\nbut instead of a location attribute, it has a const_value attribute, which\ncauses the corresponding symbol to have LOC_CONST, which causes info locals to\nskip it.\n\nFix this by handling LOC_CONST in iterate_over_block_locals.\n\nBuild and reg-tested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2020-02-24  Tom de Vries  <tdevries@suse.de>\n\n\tPR gdb/25592\n\t* stack.c (iterate_over_block_locals): Handle LOC_CONST.\n\ngdb/testsuite/ChangeLog:\n\n2020-02-24  Tom de Vries  <tdevries@suse.de>\n\n\tPR gdb/25592\n\t* gdb.base/info-locals-unused-static-var.c: New test.\n\t* gdb.base/info-locals-unused-static-var.exp: New file.",
    "tree": {
      "sha": "f39875b106d267f37ed3513477ad8668231ed1f8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f39875b106d267f37ed3513477ad8668231ed1f8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a88ef40d0f21342bb5ce01ce677846995ca0d133",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a88ef40d0f21342bb5ce01ce677846995ca0d133",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a88ef40d0f21342bb5ce01ce677846995ca0d133",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a88ef40d0f21342bb5ce01ce677846995ca0d133/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c9af65210c36aa0b5362b8ce2814ca8a5b09af92",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c9af65210c36aa0b5362b8ce2814ca8a5b09af92",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c9af65210c36aa0b5362b8ce2814ca8a5b09af92"
    }
  ],
  "stats": {
    "total": 76,
    "additions": 76,
    "deletions": 0
  },
  "files": [
    {
      "sha": "43ae8e8e36d7419ffc3ca08d100e99575d23878b",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=a88ef40d0f21342bb5ce01ce677846995ca0d133",
      "patch": "@@ -1,3 +1,8 @@\n+2020-02-24  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR gdb/25592\n+\t* stack.c (iterate_over_block_locals): Handle LOC_CONST.\n+\n 2020-02-24  Tom de Vries  <tdevries@suse.de>\n \n \t* tui/tui-layout.c (_initialize_tui_layout): Fix help messages for"
    },
    {
      "sha": "266d771e35f390b567dfc955b88ec12306d58e5f",
      "filename": "gdb/stack.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/stack.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/stack.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/stack.c?ref=a88ef40d0f21342bb5ce01ce677846995ca0d133",
      "patch": "@@ -2237,6 +2237,7 @@ iterate_over_block_locals (const struct block *b,\n     {\n       switch (SYMBOL_CLASS (sym))\n \t{\n+\tcase LOC_CONST:\n \tcase LOC_LOCAL:\n \tcase LOC_REGISTER:\n \tcase LOC_STATIC:"
    },
    {
      "sha": "6e507851827501a2b966bad5ffe7d9f2179d94bc",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=a88ef40d0f21342bb5ce01ce677846995ca0d133",
      "patch": "@@ -1,3 +1,9 @@\n+2020-02-24  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR gdb/25592\n+\t* gdb.base/info-locals-unused-static-var.c: New test.\n+\t* gdb.base/info-locals-unused-static-var.exp: New file.\n+\n 2020-02-22  Tom Tromey  <tom@tromey.com>\n \n \t* gdb.python/tui-window.exp: New file."
    },
    {
      "sha": "86d34b35792462997c78063390ec8f6cf480bea1",
      "filename": "gdb/testsuite/gdb.base/info-locals-unused-static-var.c",
      "status": "added",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/testsuite/gdb.base/info-locals-unused-static-var.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/testsuite/gdb.base/info-locals-unused-static-var.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/info-locals-unused-static-var.c?ref=a88ef40d0f21342bb5ce01ce677846995ca0d133",
      "patch": "@@ -0,0 +1,24 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+int\n+main (void)\n+{\n+  static int b = 2;\n+\n+  return 0;\n+}"
    },
    {
      "sha": "79f02c25e6ca1a8b7bbb0aa2cda91ac381637307",
      "filename": "gdb/testsuite/gdb.base/info-locals-unused-static-var.exp",
      "status": "added",
      "additions": 40,
      "deletions": 0,
      "changes": 40,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/testsuite/gdb.base/info-locals-unused-static-var.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a88ef40d0f21342bb5ce01ce677846995ca0d133/gdb/testsuite/gdb.base/info-locals-unused-static-var.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/info-locals-unused-static-var.exp?ref=a88ef40d0f21342bb5ce01ce677846995ca0d133",
      "patch": "@@ -0,0 +1,40 @@\n+# Copyright 2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+# Test if an unused static local var is listed with info locals.\n+#\n+# Note: with gcc 4.8.5, we have:\n+# ...\n+# (gdb) info addr b\n+# Symbol \"b\" is static storage at address $hex\n+# ...\n+# but with gcc 7.5.0, we have instead:\n+# ...\n+# (gdb) info addr b\n+# Symbol \"b\" is constant.\n+# ...\n+\n+standard_testfile\n+\n+if {[prepare_for_testing \"failed to prepare\" $testfile $srcfile debug]} {\n+    return -1\n+}\n+\n+if ![runto_main] then {\n+    fail \"can't run to main\"\n+    return 0\n+}\n+\n+gdb_test \"info locals\" \"\\r\\nb = .*\""
    }
  ]
}