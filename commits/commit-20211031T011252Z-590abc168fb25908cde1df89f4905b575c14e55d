{
  "sha": "590abc168fb25908cde1df89f4905b575c14e55d",
  "node_id": "C_kwDOANOeidoAKDU5MGFiYzE2OGZiMjU5MDhjZGUxZGY4OWY0OTA1YjU3NWMxNGU1NWQ",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-10-30T23:38:15Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-10-31T01:12:52Z"
    },
    "message": "Don't include coff/pe.h in coff-x86_64.c\n\nThis (and other) code from coffcode.h is broken for x86_64_coff_vec,\nand has been ever since support was added in 2006 commit 99ad839030c1\nHere, bfd_coff_aoutsz must match coff_swap_aouthdr_out otherwise we\nend up writing garbage.\n\n      /* Note that peicode.h fills in a PEAOUTHDR, not an AOUTHDR.\n\t include/coff/pe.h sets AOUTSZ == sizeof (PEAOUTHDR)).  */\n      char * buff;\n      bfd_size_type amount = bfd_coff_aoutsz (abfd);\n\n      buff = (char *) bfd_malloc (amount);\n      if (buff == NULL)\n\treturn false;\n\n      coff_swap_aouthdr_out (abfd, & internal_a, buff);\n      amount = bfd_bwrite (buff, amount, abfd);\n\nWe have removed support for --target=x86_64-coff, likely because it\nnever worked properly, but still produce coff-x86_64.o with\n--enable-targets=all.  This means objcopy can recognize x86_64 COFF\nfiles but will write garbage to the output file, a fact found by\nfuzzers.  I suspect x86_64 COFF is still broken after this fix, and\nmention of coff-x86_64.* should be removed from bfd/Makefile.am.\n\n\t* coff-x86_64.c: Don't include coff/pe.h.\n\t(COFF_WITH_pex64): Don't define here.\n\t* pe-x86_64.c: Include coff/pe.h and other headers.\n\t(PEI_HEADERS): Define.",
    "tree": {
      "sha": "7acf9238680c5b56af5602ecc69930961ccf128c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7acf9238680c5b56af5602ecc69930961ccf128c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/590abc168fb25908cde1df89f4905b575c14e55d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/590abc168fb25908cde1df89f4905b575c14e55d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/590abc168fb25908cde1df89f4905b575c14e55d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/590abc168fb25908cde1df89f4905b575c14e55d/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1c5e9d8d8cfdc4528ec4713dc6001e8b66c28134",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1c5e9d8d8cfdc4528ec4713dc6001e8b66c28134",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1c5e9d8d8cfdc4528ec4713dc6001e8b66c28134"
    }
  ],
  "stats": {
    "total": 10,
    "additions": 5,
    "deletions": 5
  },
  "files": [
    {
      "sha": "9bd1c573834329298da5ce293abe550f6aa4e481",
      "filename": "bfd/coff-x86_64.c",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/590abc168fb25908cde1df89f4905b575c14e55d/bfd/coff-x86_64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/590abc168fb25908cde1df89f4905b575c14e55d/bfd/coff-x86_64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/coff-x86_64.c?ref=590abc168fb25908cde1df89f4905b575c14e55d",
      "patch": "@@ -20,10 +20,6 @@\n \n    Written by Kai Tietz, OneVision Software GmbH&CoKg.  */\n \n-#ifndef COFF_WITH_pex64\n-#define COFF_WITH_pex64\n-#endif\n-\n /* Note we have to make sure not to include headers twice.\n    Not all headers are wrapped in #ifdef guards, so we define\n    PEI_HEADERS to prevent double including here.  */\n@@ -33,7 +29,6 @@\n #include \"libbfd.h\"\n #include \"coff/x86_64.h\"\n #include \"coff/internal.h\"\n-#include \"coff/pe.h\"\n #include \"libcoff.h\"\n #include \"libiberty.h\"\n #endif"
    },
    {
      "sha": "1c1b23fb8c52ce68c163abfa1898630f69704908",
      "filename": "bfd/pe-x86_64.c",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/590abc168fb25908cde1df89f4905b575c14e55d/bfd/pe-x86_64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/590abc168fb25908cde1df89f4905b575c14e55d/bfd/pe-x86_64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/pe-x86_64.c?ref=590abc168fb25908cde1df89f4905b575c14e55d",
      "patch": "@@ -20,9 +20,14 @@\n \n    Written by Kai Tietz, OneVision Software GmbH&CoKg.  */\n \n+#define PEI_HEADERS\n #include \"sysdep.h\"\n #include \"bfd.h\"\n+#include \"libbfd.h\"\n+#include \"libiberty.h\"\n+#include \"coff/x86_64.h\"\n #include \"coff/internal.h\"\n+#include \"coff/pe.h\"\n #include \"libcoff.h\"\n \n #define TARGET_SYM\t\tx86_64_pe_vec"
    }
  ]
}