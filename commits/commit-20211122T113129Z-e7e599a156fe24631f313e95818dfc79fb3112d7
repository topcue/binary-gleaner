{
  "sha": "e7e599a156fe24631f313e95818dfc79fb3112d7",
  "node_id": "C_kwDOANOeidoAKGU3ZTU5OWExNTZmZTI0NjMxZjMxM2U5NTgxOGRmYzc5ZmIzMTEyZDc",
  "commit": {
    "author": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-11-22T10:21:15Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-11-22T11:31:29Z"
    },
    "message": "RISC-V: Replace .option rvc/norvc with .option arch, +c/-c.\n\nSince the .option rvc/norvc directives are obsolete, replace them with\nthe new proposed diretives: .option arch, +c/-c.  And also reset the\nriscv_opts.rvc flag for the .option arch directives.\n\ngas/\n\t* config/tc-riscv.c (s_riscv_option): Reset the riscv_opts.rvc\n\tfor the .option arch directives.\n\t* testsuite/gas/riscv/align-1.s: Replace the obsolete .option\n\trvc/norvc with .option arch, +c/-c.\n\t* testsuite/gas/riscv/c-add-addi.s: Likewise.\n\t* testsuite/gas/riscv/c-nonzero-imm.s: Likewise.\n\t* testsuite/gas/riscv/c-nonzero-reg.s: Likewise.\n\t* testsuite/gas/riscv/c-zero-imm-64.s: Likewise.\n\t* testsuite/gas/riscv/c-zero-imm.s: Likewise.\n\t* testsuite/gas/riscv/c-zero-reg.s: Likewise.\n\t* testsuite/gas/riscv/ext.s: Likewise.\n\t* testsuite/gas/riscv/mapping-01.s: Likewise.\n\t* testsuite/gas/riscv/mapping-02.s: Likewise.\n\t* testsuite/gas/riscv/mapping-03.s: Likewise.\n\t* testsuite/gas/riscv/mapping-04.s: Likewise.\n\t* testsuite/gas/riscv/no-relax-align-2.s: Likewise.\n\t* testsuite/gas/riscv/shamt-32.s: Likewise.\n\t* testsuite/gas/riscv/shamt-64.s: Likewise.",
    "tree": {
      "sha": "096d29a2cbffb669478590dce52b2f5de29dcb53",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/096d29a2cbffb669478590dce52b2f5de29dcb53"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e7e599a156fe24631f313e95818dfc79fb3112d7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e7e599a156fe24631f313e95818dfc79fb3112d7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e7e599a156fe24631f313e95818dfc79fb3112d7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e7e599a156fe24631f313e95818dfc79fb3112d7/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "a92d031d7ef6e192fb404a86d53fa834e1e3eb8c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a92d031d7ef6e192fb404a86d53fa834e1e3eb8c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a92d031d7ef6e192fb404a86d53fa834e1e3eb8c"
    }
  ],
  "stats": {
    "total": 40,
    "additions": 22,
    "deletions": 18
  },
  "files": [
    {
      "sha": "e8061217e7cd63e423c4266c61c7f2d5c1abf283",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -3773,6 +3773,10 @@ s_riscv_option (int x ATTRIBUTE_UNUSED)\n       if (ISSPACE (*name) && *name != '\\0')\n \tname++;\n       riscv_update_subset (&riscv_rps_as, name);\n+\n+      riscv_set_rvc (false);\n+      if (riscv_subset_supports (&riscv_rps_as, \"c\"))\n+\triscv_set_rvc (true);\n     }\n   else if (strcmp (name, \"push\") == 0)\n     {"
    },
    {
      "sha": "ec28556e7be65636ce57dfa83a2ab1bceb2f93df",
      "filename": "gas/testsuite/gas/riscv/align-1.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/align-1.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/align-1.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/align-1.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,3 +1,3 @@\n-\t.option norvc\n+\t.option arch, -c\n \t.align 2\n \t.align 1"
    },
    {
      "sha": "8cfcea103db05c76b16c5b6bd35dc5687f68a013",
      "filename": "gas/testsuite/gas/riscv/c-add-addi.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-add-addi.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-add-addi.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/c-add-addi.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,3 +1,3 @@\n-.option rvc\n+.option arch, +c\n addi a2, zero, 1\n add a0, zero, a1"
    },
    {
      "sha": "75b25ae465b38af30fb0be91a0d34996b2122a3b",
      "filename": "gas/testsuite/gas/riscv/c-nonzero-imm.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-nonzero-imm.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-nonzero-imm.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/c-nonzero-imm.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,3 +1,3 @@\n-\t.option rvc\n+\t.option arch, +c\n \tc.nop 0\n \tc.nop 1"
    },
    {
      "sha": "4f9245b7ff393082640b5bbb0b6f671c7a104366",
      "filename": "gas/testsuite/gas/riscv/c-nonzero-reg.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-nonzero-reg.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-nonzero-reg.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/c-nonzero-reg.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,3 +1,3 @@\n-\t.option rvc\n+\t.option arch, +c\n \tc.addiw x0, 10\n \tc.jr x0"
    },
    {
      "sha": "de7564595a11a3ad5f2cbda1af3d8b41071bf7be",
      "filename": "gas/testsuite/gas/riscv/c-zero-imm-64.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-zero-imm-64.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-zero-imm-64.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/c-zero-imm-64.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option rvc\n+\t.option arch, +c\n \t# These are valid instructions.\n \taddiw a6,a6,0\n \tc.addiw a7,0"
    },
    {
      "sha": "4c5a5c276f82e0dbf4d96cbc822187c17ea45b41",
      "filename": "gas/testsuite/gas/riscv/c-zero-imm.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-zero-imm.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-zero-imm.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/c-zero-imm.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option rvc\n+\t.option arch, +c\n \t# These are valid instructions.\n \tli a0,0\n \tc.li a1,0"
    },
    {
      "sha": "2d32d4445e940e32a66d4949795a0d2ff8bbeb36",
      "filename": "gas/testsuite/gas/riscv/c-zero-reg.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-zero-reg.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/c-zero-reg.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/c-zero-reg.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option rvc\n+\t.option arch, +c\n \t# These are hints.\n \tc.li x0, 1\n \tc.lui x0, 2"
    },
    {
      "sha": "0268dcafc1d3576cba112fa0c4a8bca1ad830933",
      "filename": "gas/testsuite/gas/riscv/ext.s",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/ext.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/ext.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/ext.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,5 +1,5 @@\n target:\n-\t.option norvc\n+\t.option arch, -c\n \tzext.b\ta0, a0\n \tzext.h\ta0, a0\n \tsext.b\ta0, a0\n@@ -18,7 +18,7 @@ target:\n \tsext.w\ta1, a2\n .endif\n \n-\t.option rvc\n+\t.option arch, +c\n \tzext.b\ta0, a0\n \tzext.h\ta0, a0\n \tsext.b\ta0, a0"
    },
    {
      "sha": "989463f91eed5ee22ee5cef62cb32f9d65ad3e78",
      "filename": "gas/testsuite/gas/riscv/mapping-01.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-01.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-01.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/mapping-01.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option norvc\n+\t.option arch, -c\n \t.text\n \t.global\tfuncA\n funcA:"
    },
    {
      "sha": "79468c0d14f18564e4953dffde3b26ff8de322b6",
      "filename": "gas/testsuite/gas/riscv/mapping-02.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-02.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-02.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/mapping-02.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option norvc\n+\t.option arch, -c\n \t.text\n \t.word\t1\n \tadd\ta0, a0, a0"
    },
    {
      "sha": "88f2601568d1457c2292eb79b9bf65ddfa257098",
      "filename": "gas/testsuite/gas/riscv/mapping-03.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-03.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-03.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/mapping-03.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option norvc\n+\t.option arch, -c\n \t.text\n \tadd\ta0, a0, a0\n \t.long\t0"
    },
    {
      "sha": "804b0397737c4f7135f947e5a8006dba8e99f190",
      "filename": "gas/testsuite/gas/riscv/mapping-04.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-04.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/mapping-04.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/mapping-04.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,5 +1,5 @@\n \t.text\n-\t.option\tnorvc\n+\t.option\tarch, -c\n \t.fill\t2, 4, 0x1001\n \t.byte\t1\n \t.word\t0"
    },
    {
      "sha": "8ed0ed3b44d06ef25c5447039df027b54f080abb",
      "filename": "gas/testsuite/gas/riscv/no-relax-align-2.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/no-relax-align-2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/no-relax-align-2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/no-relax-align-2.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,5 +1,5 @@\n \t.option norelax\n-\t.option rvc\n+\t.option arch, +c\n \t.byte 0\n \t.align 4\n \tnop"
    },
    {
      "sha": "a673f8810dc4c9f6888af0479fd0722b5074eda3",
      "filename": "gas/testsuite/gas/riscv/shamt-32.s",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/shamt-32.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/shamt-32.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/shamt-32.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option norvc\n+\t.option arch, -c\n \tslli\ta0, a0, 0\n \tslli\ta0, a0, 31\n \tslli\ta0, a0, 32\n@@ -14,7 +14,7 @@\n \tsrai\ta0, a0, 32\n \tsrai\ta0, a0, 63\n \n-\t.option rvc\n+\t.option arch, +c\n \tslli\ta0, a0, 0\n \tslli\ta0, a0, 31\n \tslli\ta0, a0, 32"
    },
    {
      "sha": "8878318f4a709dd20428f00b938d50065a733c2a",
      "filename": "gas/testsuite/gas/riscv/shamt-64.s",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/shamt-64.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e7e599a156fe24631f313e95818dfc79fb3112d7/gas/testsuite/gas/riscv/shamt-64.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/shamt-64.s?ref=e7e599a156fe24631f313e95818dfc79fb3112d7",
      "patch": "@@ -1,4 +1,4 @@\n-\t.option norvc\n+\t.option arch, -c\n \tslli\ta0, a0, 0\n \tslli\ta0, a0, 31\n \tslli\ta0, a0, 32\n@@ -29,7 +29,7 @@\n \tsraiw\ta0, a0, 32\n \tsraiw\ta0, a0, 63\n \n-\t.option rvc\n+\t.option arch, +c\n \tslli\ta0, a0, 0\n \tslli\ta0, a0, 31\n \tslli\ta0, a0, 32"
    }
  ]
}