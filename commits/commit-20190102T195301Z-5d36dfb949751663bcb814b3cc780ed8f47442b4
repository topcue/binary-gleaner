{
  "sha": "5d36dfb949751663bcb814b3cc780ed8f47442b4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWQzNmRmYjk0OTc1MTY2M2JjYjgxNGIzY2M3ODBlZDhmNDc0NDJiNA==",
  "commit": {
    "author": {
      "name": "Andrey Utkin",
      "email": "autkin@undo.io",
      "date": "2018-11-09T19:09:40Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@ericsson.com",
      "date": "2019-01-02T19:53:01Z"
    },
    "message": "Fix search of debug files for remote debuggee\n\nWhen using remote debugging server, and when debuggee filename is\ninferred via qXfer:exec-file:read request, or sysroot starts with\n\"target:\", this \"target:\" prefix of filepaths is not treated correctly\nduring debug file search - it appears in the middle of the looked up\npaths.\n\nIn the following example, unpatched GDB can't find separate debug files for\nneither the executable, nor standard libraries:\n\n     $ gdb -ex 'set debug separate-debug-file 1' -ex 'set sysroot target:/' -ex 'set debug-file-directory /usr/lib/debug:/home/j/hide' -ex 'target remote :3333' -ex 'break main' -ex 'continue' -ex 'bt' -ex 'info sharedlibrary' -ex 'set confirm off' -ex 'quit'\n    GNU gdb (Gentoo 9999 vanilla) 8.2.50.20181109-git\n    Copyright (C) 2018 Free Software Foundation, Inc.\n    License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n    This is free software: you are free to change and redistribute it.\n    There is NO WARRANTY, to the extent permitted by law.\n    Type \"show copying\" and \"show warranty\" for details.\n    This GDB was configured as \"x86_64-pc-linux-gnu\".\n    Type \"show configuration\" for configuration details.\n    For bug reporting instructions, please see:\n    <https://bugs.gentoo.org/>.\n    Find the GDB manual and other documentation resources online at:\n        <http://www.gnu.org/software/gdb/documentation/>.\n\n    For help, type \"help\".\n    Type \"apropos word\" to search for commands related to \"word\".\n    Remote debugging using :3333\n    Reading /home/j/test from remote target...\n    warning: File transfers from remote targets can be slow. Use \"set sysroot\" to access files locally instead.\n    Reading /home/j/test from remote target...\n    Reading symbols from target:/home/j/test...\n\n    Looking for separate debug info (debug link) for target:/home/j/test\n      Trying target:/home/j/test.debug\n    Reading /home/j/test.debug from remote target...\n      Trying target:/home/j/.debug/test.debug\n    Reading /home/j/.debug/test.debug from remote target...\n      Trying /usr/lib/debug/target:/home/j/test.debug\n      Trying /home/j/hide/target:/home/j/test.debug\n    (No debugging symbols found in target:/home/j/test)\n    Reading /lib64/ld-linux-x86-64.so.2 from remote target...\n    Reading /lib64/ld-linux-x86-64.so.2 from remote target...\n    Reading symbols from target:/lib64/ld-linux-x86-64.so.2...\n\n    Looking for separate debug info (debug link) for target:/lib64/ld-linux-x86-64.so.2\n      Trying target:/lib64/ld-2.27.so.debug\n    Reading /lib64/ld-2.27.so.debug from remote target...\n      Trying target:/lib64/.debug/ld-2.27.so.debug\n    Reading /lib64/.debug/ld-2.27.so.debug from remote target...\n      Trying /usr/lib/debug/target:/lib64/ld-2.27.so.debug\n      Trying /home/j/hide/target:/lib64/ld-2.27.so.debug\n    (No debugging symbols found in target:/lib64/ld-linux-x86-64.so.2)\n\n    Looking for separate debug info (build-id) for system-supplied DSO at 0x7ffff7ffa000\n      Trying /usr/lib/debug/.build-id/fd/03d584bc1a90ba28be457635a02662c9f9c1f2.debug\n      Trying /home/j/hide/.build-id/fd/03d584bc1a90ba28be457635a02662c9f9c1f2.debug\n    0x00007ffff7dd7000 in ?? () from target:/lib64/ld-linux-x86-64.so.2\n    Breakpoint 1 at 0x4005eb\n    Continuing.\n    Reading /lib64/libpthread.so.0 from remote target...\n    Reading /lib64/libc.so.6 from remote target...\n\n    Looking for separate debug info (debug link) for target:/lib64/libpthread.so.0\n      Trying target:/lib64/libpthread-2.27.so.debug\n    Reading /lib64/libpthread-2.27.so.debug from remote target...\n      Trying target:/lib64/.debug/libpthread-2.27.so.debug\n    Reading /lib64/.debug/libpthread-2.27.so.debug from remote target...\n      Trying /usr/lib/debug/target:/lib64/libpthread-2.27.so.debug\n      Trying /home/j/hide/target:/lib64/libpthread-2.27.so.debug\n\n    Looking for separate debug info (debug link) for target:/lib64/libc.so.6\n      Trying target:/lib64/libc-2.27.so.debug\n    Reading /lib64/libc-2.27.so.debug from remote target...\n      Trying target:/lib64/.debug/libc-2.27.so.debug\n    Reading /lib64/.debug/libc-2.27.so.debug from remote target...\n      Trying /usr/lib/debug/target:/lib64/libc-2.27.so.debug\n      Trying /home/j/hide/target:/lib64/libc-2.27.so.debug\n\n    Breakpoint 1, 0x00000000004005eb in main ()\n    #0  0x00000000004005eb in main ()\n    From                To                  Syms Read   Shared Object Library\n    0x00007ffff7dd6e80  0x00007ffff7df4650  Yes (*)     target:/lib64/ld-linux-x86-64.so.2\n    0x00007ffff7bbbb70  0x00007ffff7bcbfee  Yes (*)     target:/lib64/libpthread.so.0\n    0x00007ffff780f200  0x00007ffff7962d7c  Yes (*)     target:/lib64/libc.so.6\n    (*): Shared library is missing debugging information.\n\nWith current fix, the paths used always have target: in the beginning\nand this helps to find all debug files:\n\n     $ gdb -ex 'set debug separate-debug-file 1' -ex 'set sysroot target:/' -ex 'set debug-file-directory /usr/lib/debug:/home/j/hide' -ex 'target remote :3333' -ex 'break main' -ex 'continue' -ex 'bt' -ex 'info sharedlibrary' -ex 'set confirm off' -ex 'quit'\n    GNU gdb (Gentoo 9999 vanilla) 8.2.50.20181109-git\n    Copyright (C) 2018 Free Software Foundation, Inc.\n    License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n    This is free software: you are free to change and redistribute it.\n    There is NO WARRANTY, to the extent permitted by law.\n    Type \"show copying\" and \"show warranty\" for details.\n    This GDB was configured as \"x86_64-pc-linux-gnu\".\n    Type \"show configuration\" for configuration details.\n    For bug reporting instructions, please see:\n    <https://bugs.gentoo.org/>.\n    Find the GDB manual and other documentation resources online at:\n        <http://www.gnu.org/software/gdb/documentation/>.\n\n    For help, type \"help\".\n    Type \"apropos word\" to search for commands related to \"word\".\n    Remote debugging using :3333\n    Reading /home/j/test from remote target...\n    warning: File transfers from remote targets can be slow. Use \"set sysroot\" to access files locally instead.\n    Reading /home/j/test from remote target...\n    Reading symbols from target:/home/j/test...\n\n    Looking for separate debug info (debug link) for target:/home/j/test\n      Trying target:/home/j/test.debug\n    Reading /home/j/test.debug from remote target...\n      Trying target:/home/j/.debug/test.debug\n    Reading /home/j/.debug/test.debug from remote target...\n      Trying target:/usr/lib/debug//home/j/test.debug\n    Reading /usr/lib/debug//home/j/test.debug from remote target...\n      Trying target:/home/j/hide//home/j/test.debug\n    Reading /home/j/hide//home/j/test.debug from remote target...\n    Reading /home/j/hide//home/j/test.debug from remote target...\n    Reading symbols from target:/home/j/hide//home/j/test.debug...\n    Reading /lib64/ld-linux-x86-64.so.2 from remote target...\n    Reading /lib64/ld-linux-x86-64.so.2 from remote target...\n    Reading symbols from target:/lib64/ld-linux-x86-64.so.2...\n\n    Looking for separate debug info (debug link) for target:/lib64/ld-linux-x86-64.so.2\n      Trying target:/lib64/ld-2.27.so.debug\n    Reading /lib64/ld-2.27.so.debug from remote target...\n      Trying target:/lib64/.debug/ld-2.27.so.debug\n    Reading /lib64/.debug/ld-2.27.so.debug from remote target...\n      Trying target:/usr/lib/debug//lib64/ld-2.27.so.debug\n    Reading /usr/lib/debug//lib64/ld-2.27.so.debug from remote target...\n    Reading /usr/lib/debug//lib64/ld-2.27.so.debug from remote target...\n    Reading symbols from target:/usr/lib/debug//lib64/ld-2.27.so.debug...\n\n    Looking for separate debug info (build-id) for system-supplied DSO at 0x7ffff7ffa000\n      Trying /usr/lib/debug/.build-id/fd/03d584bc1a90ba28be457635a02662c9f9c1f2.debug\n      Trying /home/j/hide/.build-id/fd/03d584bc1a90ba28be457635a02662c9f9c1f2.debug\n    0x00007ffff7dd7000 in _start () from target:/lib64/ld-linux-x86-64.so.2\n    Breakpoint 1 at 0x4005ef: file test/test16.c, line 13.\n    Continuing.\n    Reading /lib64/libpthread.so.0 from remote target...\n    Reading /lib64/libc.so.6 from remote target...\n\n    Looking for separate debug info (debug link) for target:/lib64/libpthread.so.0\n      Trying target:/lib64/libpthread-2.27.so.debug\n    Reading /lib64/libpthread-2.27.so.debug from remote target...\n      Trying target:/lib64/.debug/libpthread-2.27.so.debug\n    Reading /lib64/.debug/libpthread-2.27.so.debug from remote target...\n      Trying target:/usr/lib/debug//lib64/libpthread-2.27.so.debug\n    Reading /usr/lib/debug//lib64/libpthread-2.27.so.debug from remote target...\n    Reading /usr/lib/debug//lib64/libpthread-2.27.so.debug from remote target...\n\n    Looking for separate debug info (debug link) for target:/lib64/libc.so.6\n      Trying target:/lib64/libc-2.27.so.debug\n    Reading /lib64/libc-2.27.so.debug from remote target...\n      Trying target:/lib64/.debug/libc-2.27.so.debug\n    Reading /lib64/.debug/libc-2.27.so.debug from remote target...\n      Trying target:/usr/lib/debug//lib64/libc-2.27.so.debug\n    Reading /usr/lib/debug//lib64/libc-2.27.so.debug from remote target...\n    Reading /usr/lib/debug//lib64/libc-2.27.so.debug from remote target...\n\n    Breakpoint 1, main () at test/test16.c:13\n    13          for ( i=0; i<10; ++i)\n    #0  main () at test/test16.c:13\n    From                To                  Syms Read   Shared Object Library\n    0x00007ffff7dd6e80  0x00007ffff7df4650  Yes         target:/lib64/ld-linux-x86-64.so.2\n    0x00007ffff7bbbb70  0x00007ffff7bcbfee  Yes         target:/lib64/libpthread.so.0\n    0x00007ffff780f200  0x00007ffff7962d7c  Yes         target:/lib64/libc.so.6\n\ngdb/ChangeLog:\n\n2018-11-09  Andrey Utkin  <autkin@undo.io>\n\n        * symfile.c (find_separate_debug_file): Fix search of debug files for\n        remote debuggee.\n\nSigned-off-by: Andrey Utkin <autkin@undo.io>",
    "tree": {
      "sha": "ad7ed01d2b3dfbb3964e20445a9b9e3717ee1e2b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ad7ed01d2b3dfbb3964e20445a9b9e3717ee1e2b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5d36dfb949751663bcb814b3cc780ed8f47442b4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5d36dfb949751663bcb814b3cc780ed8f47442b4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5d36dfb949751663bcb814b3cc780ed8f47442b4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5d36dfb949751663bcb814b3cc780ed8f47442b4/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "8833fbf05c5b93fb3ccf666d5a3bd0e51e75d1bd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8833fbf05c5b93fb3ccf666d5a3bd0e51e75d1bd",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8833fbf05c5b93fb3ccf666d5a3bd0e51e75d1bd"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 12,
    "deletions": 3
  },
  "files": [
    {
      "sha": "3ec0d95d8856c1f2f724b4c6aea930c44583adc0",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5d36dfb949751663bcb814b3cc780ed8f47442b4/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5d36dfb949751663bcb814b3cc780ed8f47442b4/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5d36dfb949751663bcb814b3cc780ed8f47442b4",
      "patch": "@@ -1,3 +1,8 @@\n+2019-01-02  Andrey Utkin  <autkin@undo.io>\n+\n+\t* symfile.c (find_separate_debug_file): Fix search of debug files for\n+\tremote debuggee.\n+\n 2019-01-02  Tom Tromey  <tom@tromey.com>\n \n \t* python/py-inferior.c (gdbpy_initialize_inferior): Fix"
    },
    {
      "sha": "8858098f48dbf3925578a053edd3fed6b6ab55a1",
      "filename": "gdb/symfile.c",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5d36dfb949751663bcb814b3cc780ed8f47442b4/gdb/symfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5d36dfb949751663bcb814b3cc780ed8f47442b4/gdb/symfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile.c?ref=5d36dfb949751663bcb814b3cc780ed8f47442b4",
      "patch": "@@ -1433,14 +1433,17 @@ find_separate_debug_file (const char *dir,\n      Keep backward compatibility so that DEBUG_FILE_DIRECTORY being \"\" will\n      cause \"/...\" lookups.  */\n \n+  bool target_prefix = startswith (dir, \"target:\");\n+  const char *dir_notarget = target_prefix ? dir + strlen (\"target:\") : dir;\n   std::vector<gdb::unique_xmalloc_ptr<char>> debugdir_vec\n     = dirnames_to_char_ptr_vec (debug_file_directory);\n \n   for (const gdb::unique_xmalloc_ptr<char> &debugdir : debugdir_vec)\n     {\n-      debugfile = debugdir.get ();\n+      debugfile = target_prefix ? \"target:\" : \"\";\n+      debugfile += debugdir.get ();\n       debugfile += \"/\";\n-      debugfile += dir;\n+      debugfile += dir_notarget;\n       debugfile += debuglink;\n \n       if (separate_debug_file_exists (debugfile, crc32, objfile))\n@@ -1453,7 +1456,8 @@ find_separate_debug_file (const char *dir,\n \t\t\t    strlen (gdb_sysroot)) == 0\n \t  && IS_DIR_SEPARATOR (canon_dir[strlen (gdb_sysroot)]))\n \t{\n-\t  debugfile = debugdir.get ();\n+\t  debugfile = target_prefix ? \"target:\" : \"\";\n+\t  debugfile += debugdir.get ();\n \t  debugfile += (canon_dir + strlen (gdb_sysroot));\n \t  debugfile += \"/\";\n \t  debugfile += debuglink;"
    }
  ]
}