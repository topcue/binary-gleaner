{
  "sha": "e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
  "node_id": "C_kwDOANOeidoAKGUyY2JmNGRmODNmZTU3ODkyYTZhYWVkZjczN2I4NGJhYTYzMjFmYTc",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2022-01-06T16:45:16Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2022-01-12T13:15:18Z"
    },
    "message": "elf: Pass need_layout to _bfd_elf_map_sections_to_segments\n\nOn some targets, the DT_RELR section size can be computed only after all\nsymbols addresses can be determined.  Update ldelf_map_segments to pass\nneed_layout to _bfd_elf_map_sections_to_segments which will size DT_RELR\nsection and set need_layout to true if the DT_RELR section size is changed.\n\nbfd/\n\n\t* elf-bfd.h (_bfd_elf_map_sections_to_segments): Add a bool\n\tpointer argument.\n\t* elf.c (_bfd_elf_map_sections_to_segments): Add a bool pointer\n\targument to indicate if section layout needs update.\n\t(assign_file_positions_for_load_sections): Pass NULL to\n\t_bfd_elf_map_sections_to_segments.\n\t* elflink.c (_bfd_elf_strip_zero_sized_dynamic_sections): Pass\n\tNULL to _bfd_elf_map_sections_to_segments.\n\nld/\n\n\t* ldelfgen.c (ldelf_map_segments): Pass &need_layout to\n\t_bfd_elf_map_sections_to_segments.",
    "tree": {
      "sha": "900d45cb8e5c64d097999b4532be7d38753c645e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/900d45cb8e5c64d097999b4532be7d38753c645e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "fc07cf22c679002bb57e9259eca5dfd6891eb962",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fc07cf22c679002bb57e9259eca5dfd6891eb962",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/fc07cf22c679002bb57e9259eca5dfd6891eb962"
    }
  ],
  "stats": {
    "total": 17,
    "additions": 11,
    "deletions": 6
  },
  "files": [
    {
      "sha": "0d9c76444857a9b6db05ae92dc1a9431b0799464",
      "filename": "bfd/elf-bfd.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/bfd/elf-bfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/bfd/elf-bfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf-bfd.h?ref=e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
      "patch": "@@ -2716,7 +2716,7 @@ extern struct elf_segment_map * _bfd_elf_make_dynamic_segment\n   (bfd *, asection *);\n \n extern bool _bfd_elf_map_sections_to_segments\n-  (bfd *, struct bfd_link_info *);\n+  (bfd *, struct bfd_link_info *, bool *);\n \n extern bool _bfd_elf_is_function_type (unsigned int);\n "
    },
    {
      "sha": "8b866b63e1858b2ebf1781efe7051579dbcfcf5d",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
      "patch": "@@ -4609,10 +4609,13 @@ elf_modify_segment_map (bfd *abfd,\n #define IS_TBSS(s) \\\n   ((s->flags & (SEC_THREAD_LOCAL | SEC_LOAD)) == SEC_THREAD_LOCAL)\n \n-/* Set up a mapping from BFD sections to program segments.  */\n+/* Set up a mapping from BFD sections to program segments.  Update\n+   NEED_LAYOUT if the section layout is changed.  */\n \n bool\n-_bfd_elf_map_sections_to_segments (bfd *abfd, struct bfd_link_info *info)\n+_bfd_elf_map_sections_to_segments (bfd *abfd,\n+\t\t\t\t   struct bfd_link_info *info,\n+\t\t\t\t   bool *need_layout ATTRIBUTE_UNUSED)\n {\n   unsigned int count;\n   struct elf_segment_map *m;\n@@ -5416,7 +5419,7 @@ assign_file_positions_for_load_sections (bfd *abfd,\n   unsigned int opb = bfd_octets_per_byte (abfd, NULL);\n \n   if (link_info == NULL\n-      && !_bfd_elf_map_sections_to_segments (abfd, link_info))\n+      && !_bfd_elf_map_sections_to_segments (abfd, link_info, NULL))\n     return false;\n \n   alloc = 0;"
    },
    {
      "sha": "46bff2771498d807f092c93ccb60ff453c07f26b",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
      "patch": "@@ -3676,7 +3676,8 @@ _bfd_elf_strip_zero_sized_dynamic_sections (struct bfd_link_info *info)\n     {\n       /* Regenerate program headers.  */\n       elf_seg_map (info->output_bfd) = NULL;\n-      return _bfd_elf_map_sections_to_segments (info->output_bfd, info);\n+      return _bfd_elf_map_sections_to_segments (info->output_bfd, info,\n+\t\t\t\t\t\tNULL);\n     }\n \n   return true;"
    },
    {
      "sha": "58b37c65bc92bcb765570436a7893d04908bf40c",
      "filename": "ld/ldelfgen.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/ld/ldelfgen.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2cbf4df83fe57892a6aaedf737b84baa6321fa7/ld/ldelfgen.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldelfgen.c?ref=e2cbf4df83fe57892a6aaedf737b84baa6321fa7",
      "patch": "@@ -304,7 +304,8 @@ ldelf_map_segments (bool need_layout)\n \t  if (lang_phdr_list == NULL)\n \t    elf_seg_map (link_info.output_bfd) = NULL;\n \t  if (!_bfd_elf_map_sections_to_segments (link_info.output_bfd,\n-\t\t\t\t\t\t  &link_info))\n+\t\t\t\t\t\t  &link_info,\n+\t\t\t\t\t\t  &need_layout))\n \t    einfo (_(\"%F%P: map sections to segments failed: %E\\n\"));\n \n \t  if (phdr_size != elf_program_header_size (link_info.output_bfd))"
    }
  ]
}