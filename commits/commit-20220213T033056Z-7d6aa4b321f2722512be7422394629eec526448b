{
  "sha": "7d6aa4b321f2722512be7422394629eec526448b",
  "node_id": "C_kwDOANOeidoAKDdkNmFhNGIzMjFmMjcyMjUxMmJlNzQyMjM5NDYyOWVlYzUyNjQ0OGI",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2022-02-08T00:03:17Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2022-02-13T03:30:56Z"
    },
    "message": "Remove bfd ELF_RELROPAGESIZE\n\nNow that ld properly aligns the end of the relro segment, the hack to\nmake relro work on powerpc can disappear.\n\nbfd/\n\t* bfd.c (bfd_emul_get_commonpagesize): Remove relro param.\n\tDon't return bed->relropagesize.\n\t* elf-bfd.h (struct elf_backend_data): Remove relropagesize.\n\t* elfxx-target.h (ELF_RELROPAGESIZE): Remove.\n\t* elf32-ppc.c (ELF_RELROPAGESIZE): Don't define.\n\t* elf64-ppc.c: Likewise.\n\t* bfd-in2.h: Regenerate.\nld/\n\t* ldemul.c (after_parse_default): Adjust\n\tbfd_emul_get_commonpagesize call.",
    "tree": {
      "sha": "7d133ad767ab4844a056e2682ed5eccc9ab2e4bf",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7d133ad767ab4844a056e2682ed5eccc9ab2e4bf"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7d6aa4b321f2722512be7422394629eec526448b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7d6aa4b321f2722512be7422394629eec526448b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7d6aa4b321f2722512be7422394629eec526448b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7d6aa4b321f2722512be7422394629eec526448b/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "31b4d3a16f200bf04db8439a63b72bba7af4e1be",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/31b4d3a16f200bf04db8439a63b72bba7af4e1be",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/31b4d3a16f200bf04db8439a63b72bba7af4e1be"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 5,
    "deletions": 25
  },
  "files": [
    {
      "sha": "3b2a4f49a9b4f541625643ff57473a8e48d3b001",
      "filename": "bfd/bfd-in2.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/bfd/bfd-in2.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/bfd/bfd-in2.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/bfd-in2.h?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -7273,7 +7273,7 @@ bool bfd_alt_mach_code (bfd *abfd, int alternative);\n \n bfd_vma bfd_emul_get_maxpagesize (const char *);\n \n-bfd_vma bfd_emul_get_commonpagesize (const char *, bool);\n+bfd_vma bfd_emul_get_commonpagesize (const char *);\n \n char *bfd_demangle (bfd *, const char *, int);\n "
    },
    {
      "sha": "913ce2d6abe9cfd1b30d58feff10b7f8e5adde42",
      "filename": "bfd/bfd.c",
      "status": "modified",
      "additions": 3,
      "deletions": 6,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/bfd/bfd.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/bfd/bfd.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/bfd.c?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -2344,7 +2344,7 @@ FUNCTION\n \tbfd_emul_get_commonpagesize\n \n SYNOPSIS\n-\tbfd_vma bfd_emul_get_commonpagesize (const char *, bool);\n+\tbfd_vma bfd_emul_get_commonpagesize (const char *);\n \n DESCRIPTION\n \tReturns the common page size, in bytes, as determined by\n@@ -2355,7 +2355,7 @@ RETURNS\n */\n \n bfd_vma\n-bfd_emul_get_commonpagesize (const char *emul, bool relro)\n+bfd_emul_get_commonpagesize (const char *emul)\n {\n   const bfd_target *target;\n \n@@ -2366,10 +2366,7 @@ bfd_emul_get_commonpagesize (const char *emul, bool relro)\n       const struct elf_backend_data *bed;\n \n       bed = xvec_get_elf_backend_data (target);\n-      if (relro)\n-\treturn bed->relropagesize;\n-      else\n-\treturn bed->commonpagesize;\n+      return bed->commonpagesize;\n     }\n   return 0;\n }"
    },
    {
      "sha": "889a4746371e66cdbf567003eab1135538e612eb",
      "filename": "bfd/elf-bfd.h",
      "status": "modified",
      "additions": 0,
      "deletions": 3,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/bfd/elf-bfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/bfd/elf-bfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf-bfd.h?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -946,9 +946,6 @@ struct elf_backend_data\n   /* The common page size for this backend.  */\n   bfd_vma commonpagesize;\n \n-  /* The value of commonpagesize to use when -z relro for this backend.  */\n-  bfd_vma relropagesize;\n-\n   /* The p_align value for this backend.  If it is set, p_align of\n       PT_LOAD alignment will be to p_align by default.  */\n   bfd_vma p_align;"
    },
    {
      "sha": "42273ca06fe740fa82e3b6d3143f6632b50b7a60",
      "filename": "bfd/elf32-ppc.c",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/bfd/elf32-ppc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/bfd/elf32-ppc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-ppc.c?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -10373,7 +10373,6 @@ ppc_elf_finish_dynamic_sections (bfd *output_bfd,\n #define ELF_MACHINE_CODE\tEM_PPC\n #define ELF_MAXPAGESIZE\t\t0x10000\n #define ELF_COMMONPAGESIZE\t0x1000\n-#define ELF_RELROPAGESIZE\tELF_MAXPAGESIZE\n #define elf_info_to_howto\tppc_elf_info_to_howto\n \n #ifdef  EM_CYGNUS_POWERPC"
    },
    {
      "sha": "dd79c05bb6161ef3bc5194a4dc043af27ceea5a4",
      "filename": "bfd/elf64-ppc.c",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/bfd/elf64-ppc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/bfd/elf64-ppc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-ppc.c?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -75,7 +75,6 @@ static bfd_vma opd_entry_value\n #define ELF_MACHINE_CODE\tEM_PPC64\n #define ELF_MAXPAGESIZE\t\t0x10000\n #define ELF_COMMONPAGESIZE\t0x1000\n-#define ELF_RELROPAGESIZE\tELF_MAXPAGESIZE\n #define elf_info_to_howto\tppc64_elf_info_to_howto\n \n #define elf_backend_want_got_sym 0"
    },
    {
      "sha": "0579f64d1a031fe25ef11d57bcf2e85934a6e52d",
      "filename": "bfd/elfxx-target.h",
      "status": "modified",
      "additions": 0,
      "deletions": 11,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/bfd/elfxx-target.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/bfd/elfxx-target.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-target.h?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -379,26 +379,16 @@\n #define ELF_COMMONPAGESIZE ELF_MAXPAGESIZE\n #endif\n \n-#ifndef ELF_RELROPAGESIZE\n-#define ELF_RELROPAGESIZE ELF_COMMONPAGESIZE\n-#endif\n-\n #ifndef ELF_MINPAGESIZE\n #define ELF_MINPAGESIZE ELF_COMMONPAGESIZE\n #endif\n \n #if ELF_COMMONPAGESIZE > ELF_MAXPAGESIZE\n # error ELF_COMMONPAGESIZE > ELF_MAXPAGESIZE\n #endif\n-#if ELF_RELROPAGESIZE > ELF_MAXPAGESIZE\n-# error ELF_RELROPAGESIZE > ELF_MAXPAGESIZE\n-#endif\n #if ELF_MINPAGESIZE > ELF_COMMONPAGESIZE\n # error ELF_MINPAGESIZE > ELF_COMMONPAGESIZE\n #endif\n-#if ELF_MINPAGESIZE > ELF_RELROPAGESIZE\n-# error ELF_MINPAGESIZE > ELF_RELROPAGESIZE\n-#endif\n \n #ifndef ELF_P_ALIGN\n #define ELF_P_ALIGN 0\n@@ -822,7 +812,6 @@ static const struct elf_backend_data elfNN_bed =\n   ELF_MAXPAGESIZE,\t\t/* maxpagesize */\n   ELF_MINPAGESIZE,\t\t/* minpagesize */\n   ELF_COMMONPAGESIZE,\t\t/* commonpagesize */\n-  ELF_RELROPAGESIZE,\t\t/* commonpagesize to use with -z relro */\n   ELF_P_ALIGN,\t\t\t/* p_align */\n   ELF_DYNAMIC_SEC_FLAGS,\t/* dynamic_sec_flags */\n   elf_backend_arch_data,"
    },
    {
      "sha": "85c00ded75e045c6b7da4c2ae076843c3464c2e7",
      "filename": "ld/ldemul.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7d6aa4b321f2722512be7422394629eec526448b/ld/ldemul.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7d6aa4b321f2722512be7422394629eec526448b/ld/ldemul.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldemul.c?ref=7d6aa4b321f2722512be7422394629eec526448b",
      "patch": "@@ -235,8 +235,7 @@ after_parse_default (void)\n   if (link_info.maxpagesize == 0)\n     link_info.maxpagesize = bfd_emul_get_maxpagesize (default_target);\n   if (link_info.commonpagesize == 0)\n-    link_info.commonpagesize = bfd_emul_get_commonpagesize (default_target,\n-\t\t\t\t\t\t\t    link_info.relro);\n+    link_info.commonpagesize = bfd_emul_get_commonpagesize (default_target);\n }\n \n void"
    }
  ]
}