{
  "sha": "970f9d091dae835304d1a96805bdb5c081a40b48",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTcwZjlkMDkxZGFlODM1MzA0ZDFhOTY4MDViZGI1YzA4MWE0MGI0OA==",
  "commit": {
    "author": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2019-07-03T12:34:17Z"
    },
    "committer": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2019-07-03T12:34:17Z"
    },
    "message": "Fix defaults of some \"maint test-settings\" subcommands\n\nNew tests added later for the incoming \"with\" command exposed a couple\ninvalid-default-value bugs in the \"maint test-settings\" commands:\n\n- var_filename commands don't allow setting the filename to the empty\n  string (unlike var_optional_filename commands), yet, \"maint\n  test-settings filename\"'s control variable was not initialized, so\n  on startup, \"maint test-settings show filename\" shows an empty\n  string.\n\n- \"maint test-settings enum\"'s control variable was not initialized,\n  so on startup, \"maint test-settings show enum\" shows an empty value\n  instead of a valid enum value.\n\nBoth issues are fixed by initializing the control variables.\n\ngdb/ChangeLog:\n2019-07-03  Pedro Alves  <palves@redhat.com>\n\n\t* maint-test-settings.c (maintenance_test_settings_xxx)\n\t(maintenance_test_settings_yyy, maintenance_test_settings_zzz):\n\tNew.\n\t(maintenance_test_settings_enums): Use them.\n\t(maintenance_test_settings_enum): Default to\n\tmaintenance_test_settings_xxx.\n\t(_initialize_maint_test_settings): Initialize\n\tMAINTENANCE_TEST_SETTINGS_FILENAME.\n\ngdb/testsuite/ChangeLog:\n2019-07-03  Pedro Alves  <palves@redhat.com>\n\n\t* gdb.base/settings.exp (test-string): Adjust expected out when\n\ttesting \"maint test-settings show filename\"",
    "tree": {
      "sha": "7727811aaf25fcbbc4c33afefbe9000a7841e229",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7727811aaf25fcbbc4c33afefbe9000a7841e229"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/970f9d091dae835304d1a96805bdb5c081a40b48",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/970f9d091dae835304d1a96805bdb5c081a40b48",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/970f9d091dae835304d1a96805bdb5c081a40b48",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/970f9d091dae835304d1a96805bdb5c081a40b48/comments",
  "author": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f3869b1a41a809f208b964ee00cea74bd905b75f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f3869b1a41a809f208b964ee00cea74bd905b75f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f3869b1a41a809f208b964ee00cea74bd905b75f"
    }
  ],
  "stats": {
    "total": 41,
    "additions": 35,
    "deletions": 6
  },
  "files": [
    {
      "sha": "05c25b4f716d21f701eddc8eab485c9b7122c4f0",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=970f9d091dae835304d1a96805bdb5c081a40b48",
      "patch": "@@ -1,3 +1,14 @@\n+2019-07-03  Pedro Alves  <palves@redhat.com>\n+\n+\t* maint-test-settings.c (maintenance_test_settings_xxx)\n+\t(maintenance_test_settings_yyy, maintenance_test_settings_zzz):\n+\tNew.\n+\t(maintenance_test_settings_enums): Use them.\n+\t(maintenance_test_settings_enum): Default to\n+\tmaintenance_test_settings_xxx.\n+\t(_initialize_maint_test_settings): Initialize\n+\tMAINTENANCE_TEST_SETTINGS_FILENAME.\n+\n 2019-07-02  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* breakpoint.h (remove_breakpoints_inf): Change return type to"
    },
    {
      "sha": "79e002e727f6704d524918562d57aed85ade61d4",
      "filename": "gdb/maint-test-settings.c",
      "status": "modified",
      "additions": 13,
      "deletions": 3,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/maint-test-settings.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/maint-test-settings.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/maint-test-settings.c?ref=970f9d091dae835304d1a96805bdb5c081a40b48",
      "patch": "@@ -85,14 +85,22 @@ static char *maintenance_test_settings_optional_filename;\n \n static char *maintenance_test_settings_filename;\n \n-static const char *maintenance_test_settings_enum;\n-\n /* Enum values for the \"maintenance test-settings set/show boolean\"\n    commands.  */\n+static const char maintenance_test_settings_xxx[] = \"xxx\";\n+static const char maintenance_test_settings_yyy[] = \"yyy\";\n+static const char maintenance_test_settings_zzz[] = \"zzz\";\n+\n static const char *const maintenance_test_settings_enums[] = {\n-  \"xxx\", \"yyy\", \"zzz\", nullptr\n+  maintenance_test_settings_xxx,\n+  maintenance_test_settings_yyy,\n+  maintenance_test_settings_zzz,\n+  nullptr\n };\n \n+static const char *maintenance_test_settings_enum\n+  = maintenance_test_settings_xxx;\n+\n /* The \"maintenance test-options show xxx\" commands.  */\n \n static void\n@@ -107,6 +115,8 @@ maintenance_test_settings_show_value_cmd\n void\n _initialize_maint_test_settings (void)\n {\n+  maintenance_test_settings_filename = xstrdup (\"/foo/bar\");\n+\n   add_prefix_cmd (\"test-settings\", no_class,\n \t\t  maintenance_test_settings_cmd,\n \t\t  _(\"\\"
    },
    {
      "sha": "9129c11a518afc1fd41d23a18ef40919bd925922",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=970f9d091dae835304d1a96805bdb5c081a40b48",
      "patch": "@@ -1,3 +1,8 @@\n+2019-07-03  Pedro Alves  <palves@redhat.com>\n+\n+\t* gdb.base/settings.exp (test-string): Adjust expected out when\n+\ttesting \"maint test-settings show filename\"\n+\n 2019-07-02  Pedro Alves  <palves@redhat.com>\n \n \t* gdb.base/options.exp (test-info-threads): New procedure."
    },
    {
      "sha": "b691ad8cf68940e455dcc483507537e57175b823",
      "filename": "gdb/testsuite/gdb.base/settings.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/testsuite/gdb.base/settings.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/970f9d091dae835304d1a96805bdb5c081a40b48/gdb/testsuite/gdb.base/settings.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/settings.exp?ref=970f9d091dae835304d1a96805bdb5c081a40b48",
      "patch": "@@ -447,9 +447,12 @@ proc test-string {variant} {\n     set set_cmd \"maint test-settings set $variant\"\n     set show_cmd \"maint test-settings show $variant\"\n \n-    # Empty string.  Also checks that gdb doesn't crash if we haven't\n-    # set the string yet.\n-    gdb_test \"$show_cmd\" \"^$show_cmd\\r\\n\" \"$show_cmd: empty first time\"\n+    # Checks that gdb doesn't crash if we haven't set the string yet.\n+    if {$variant != \"filename\"} {\n+\tgdb_test \"$show_cmd\" \"^$show_cmd\\r\\n\" \"$show_cmd: show default\"\n+    } else {\n+\tgdb_test \"$show_cmd\" \"/foo/bar\" \"$show_cmd: show default\"\n+    }\n \n     # A string value.\n     gdb_test_no_output \"$set_cmd hello world\""
    }
  ]
}