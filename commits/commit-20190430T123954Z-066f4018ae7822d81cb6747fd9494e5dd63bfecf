{
  "sha": "066f4018ae7822d81cb6747fd9494e5dd63bfecf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDY2ZjQwMThhZTc4MjJkODFjYjY3NDdmZDk0OTRlNWRkNjNiZmVjZg==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-04-30T07:01:01Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-04-30T12:39:54Z"
    },
    "message": "PowerPC64 GOT indirect to GOT relative optimisation\n\nThis implements an optimisation that converts sequences like\n  addis r9,r2,sym@got@ha\n  ld r3,sym@got@l(r9)\nto\n  addis r9,r2,sym@toc@ha\n  addi r3,r9,sym@toc@l\nwhen \"sym\" is locally defined and can't be overridden.\n\nbfd/\n\t* elf64-ppc.c (struct ppc64_elf_obj_tdata): Add has_gotrel.\n\t(struct _ppc64_elf_section_data): Likewise.\n\t(ppc64_elf_check_relocs): Set above fields.\n\t(ppc64_elf_edit_toc): Add a pass over GOT relocs.\n\t(ppc64_elf_relocate_section): Edit GOT indirect to GOT relative\n\twhen possible.\nld/\n\t* testsuite/ld-powerpc/elfv2exe.d: Update.\n\t* testsuite/ld-powerpc/elfv2so.d: Update.\n\t* testsuite/ld-powerpc/tocopt.d: Update.\n\t* testsuite/ld-powerpc/tocopt.s: Update.\n\t* testsuite/ld-powerpc/tocopt5.d: Update.\n\t* testsuite/ld-powerpc/tocopt5.s: Update.\n\t* testsuite/ld-powerpc/tocopt7.d: Update.\n\t* testsuite/ld-powerpc/tocopt7.s: Update.\n\t* testsuite/ld-powerpc/tocopt8.d: Update.\n\t* testsuite/ld-powerpc/tocopt8.s: Update.",
    "tree": {
      "sha": "d840b2ca4e38182f327d99d34a053d5b73a7b6a4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d840b2ca4e38182f327d99d34a053d5b73a7b6a4"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/066f4018ae7822d81cb6747fd9494e5dd63bfecf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/066f4018ae7822d81cb6747fd9494e5dd63bfecf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/066f4018ae7822d81cb6747fd9494e5dd63bfecf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/066f4018ae7822d81cb6747fd9494e5dd63bfecf/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8107ddcea1da07f1c4e902c17f045684beb78079",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8107ddcea1da07f1c4e902c17f045684beb78079",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8107ddcea1da07f1c4e902c17f045684beb78079"
    }
  ],
  "stats": {
    "total": 303,
    "additions": 263,
    "deletions": 40
  },
  "files": [
    {
      "sha": "0b68dc0a991586f4094b9c39824730f2bf303c53",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -1,3 +1,12 @@\n+2019-04-30  Alan Modra  <amodra@gmail.com>\n+\n+\t* elf64-ppc.c (struct ppc64_elf_obj_tdata): Add has_gotrel.\n+\t(struct _ppc64_elf_section_data): Likewise.\n+\t(ppc64_elf_check_relocs): Set above fields.\n+\t(ppc64_elf_edit_toc): Add a pass over GOT relocs.\n+\t(ppc64_elf_relocate_section): Edit GOT indirect to GOT relative\n+\twhen possible.\n+\n 2019-04-26  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/24486"
    },
    {
      "sha": "4eb0153dfba3fff4d56568a8f6ea25bb16622f75",
      "filename": "bfd/elf64-ppc.c",
      "status": "modified",
      "additions": 207,
      "deletions": 3,
      "changes": 210,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/bfd/elf64-ppc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/bfd/elf64-ppc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-ppc.c?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -1594,6 +1594,9 @@ struct ppc64_elf_obj_tdata\n   /* Set if toc/got ha relocs detected not using r2, or lo reloc\n      instruction not one we handle.  */\n   unsigned int unexpected_toc_insn : 1;\n+\n+  /* Set if got relocs that can be optimised are present in this file.  */\n+  unsigned int has_gotrel : 1;\n };\n \n #define ppc64_elf_tdata(bfd) \\\n@@ -1793,6 +1796,9 @@ struct _ppc64_elf_section_data\n \n   /* Flag set when PLTCALL relocs are detected.  */\n   unsigned int has_pltcall:1;\n+\n+  /* Flag set when section has GOT relocations that can be optimised.  */\n+  unsigned int has_gotrel:1;\n };\n \n #define ppc64_elf_section_data(sec) \\\n@@ -4383,14 +4389,19 @@ ppc64_elf_check_relocs (bfd *abfd, struct bfd_link_info *info,\n \t  tls_type = TLS_TLS | TLS_DTPREL;\n \tdogottls:\n \t  sec->has_tls_reloc = 1;\n-\t  /* Fall through */\n+\t  goto dogot;\n \n-\tcase R_PPC64_GOT16:\n \tcase R_PPC64_GOT16_DS:\n \tcase R_PPC64_GOT16_HA:\n+\tcase R_PPC64_GOT16_LO_DS:\n+\t  ppc64_elf_tdata (abfd)->has_gotrel = 1;\n+\t  ppc64_elf_section_data (sec)->has_gotrel = 1;\n+\t  /* Fall through.  */\n+\n+\tcase R_PPC64_GOT16:\n \tcase R_PPC64_GOT16_HI:\n \tcase R_PPC64_GOT16_LO:\n-\tcase R_PPC64_GOT16_LO_DS:\n+\tdogot:\n \t  /* This symbol requires a global offset table entry.  */\n \t  sec->has_toc_reloc = 1;\n \t  if (r_type == R_PPC64_GOT_TLSLD16\n@@ -8579,6 +8590,161 @@ ppc64_elf_edit_toc (struct bfd_link_info *info)\n       free (skip);\n     }\n \n+  /* Look for cases where we can change an indirect GOT access to\n+     a GOT relative access, possibly reducing the number of GOT\n+     entries.  */\n+  for (ibfd = info->input_bfds; ibfd != NULL; ibfd = ibfd->link.next)\n+    {\n+      asection *sec;\n+      Elf_Internal_Shdr *symtab_hdr;\n+      Elf_Internal_Sym *local_syms;\n+      Elf_Internal_Rela *relstart, *rel;\n+      bfd_vma got;\n+\n+      if (!is_ppc64_elf (ibfd))\n+\tcontinue;\n+\n+      if (!ppc64_elf_tdata (ibfd)->has_gotrel)\n+\tcontinue;\n+\n+      sec = ppc64_elf_tdata (ibfd)->got;\n+      got = sec->output_section->vma + sec->output_offset + 0x8000;\n+\n+      local_syms = NULL;\n+      symtab_hdr = &elf_symtab_hdr (ibfd);\n+\n+      for (sec = ibfd->sections; sec != NULL; sec = sec->next)\n+\t{\n+\t  if (sec->reloc_count == 0\n+\t      || !ppc64_elf_section_data (sec)->has_gotrel\n+\t      || discarded_section (sec))\n+\t    continue;\n+\n+\t  relstart = _bfd_elf_link_read_relocs (ibfd, sec, NULL, NULL,\n+\t\t\t\t\t\tinfo->keep_memory);\n+\t  if (relstart == NULL)\n+\t    {\n+\t    got_error_ret:\n+\t      if (local_syms != NULL\n+\t\t  && symtab_hdr->contents != (unsigned char *) local_syms)\n+\t\tfree (local_syms);\n+\t      if (sec != NULL\n+\t\t  && relstart != NULL\n+\t\t  && elf_section_data (sec)->relocs != relstart)\n+\t\tfree (relstart);\n+\t      return FALSE;\n+\t    }\n+\n+\t  for (rel = relstart; rel < relstart + sec->reloc_count; ++rel)\n+\t    {\n+\t      enum elf_ppc64_reloc_type r_type;\n+\t      unsigned long r_symndx;\n+\t      Elf_Internal_Sym *sym;\n+\t      asection *sym_sec;\n+\t      struct elf_link_hash_entry *h;\n+\t      struct got_entry *ent;\n+\t      bfd_vma val;\n+\t      unsigned char buf[4];\n+\t      unsigned int insn;\n+\n+\t      r_type = ELF64_R_TYPE (rel->r_info);\n+\t      switch (r_type)\n+\t\t{\n+\t\tdefault:\n+\t\t  continue;\n+\n+\t\tcase R_PPC64_GOT16_DS:\n+\t\tcase R_PPC64_GOT16_HA:\n+\t\tcase R_PPC64_GOT16_LO_DS:\n+\t\t  break;\n+\t\t}\n+\n+\t      r_symndx = ELF64_R_SYM (rel->r_info);\n+\t      if (!get_sym_h (&h, &sym, &sym_sec, NULL, &local_syms,\n+\t\t\t      r_symndx, ibfd))\n+\t\tgoto got_error_ret;\n+\n+\t      if (!SYMBOL_REFERENCES_LOCAL (info, h))\n+\t\tcontinue;\n+\n+\t      if (h != NULL)\n+\t\tval = h->root.u.def.value;\n+\t      else\n+\t\tval = sym->st_value;\n+\t      val += rel->r_addend;\n+\t      val += sym_sec->output_section->vma + sym_sec->output_offset;\n+\n+\t      switch (r_type)\n+\t\t{\n+\t\tdefault:\n+\t\t  continue;\n+\n+\t\tcase R_PPC64_GOT16_DS:\n+\t\t  if (val - got + 0x8000 >= 0x10000)\n+\t\t    continue;\n+\t\t  if (!bfd_get_section_contents (ibfd, sec, buf,\n+\t\t\t\t\t\t rel->r_offset & ~3, 4))\n+\t\t    goto got_error_ret;\n+\t\t  insn = bfd_get_32 (ibfd, buf);\n+\t\t  if ((insn & (0x3f << 26 | 0x3)) != 58u << 26 /* ld */)\n+\t\t    continue;\n+\t\t  break;\n+\n+\t\tcase R_PPC64_GOT16_HA:\n+\t\t  if (val - got + 0x80008000ULL >= 0x100000000ULL)\n+\t\t    continue;\n+\n+\t\t  if (!bfd_get_section_contents (ibfd, sec, buf,\n+\t\t\t\t\t\t rel->r_offset & ~3, 4))\n+\t\t    goto got_error_ret;\n+\t\t  insn = bfd_get_32 (ibfd, buf);\n+\t\t  if (((insn & ((0x3f << 26) | 0x1f << 16))\n+\t\t       != ((15u << 26) | (2 << 16)) /* addis rt,2,imm */))\n+\t\t    continue;\n+\t\t  break;\n+\n+\t\tcase R_PPC64_GOT16_LO_DS:\n+\t\t  if (val - got + 0x80008000ULL >= 0x100000000ULL)\n+\t\t    continue;\n+\t\t  if (!bfd_get_section_contents (ibfd, sec, buf,\n+\t\t\t\t\t\t rel->r_offset & ~3, 4))\n+\t\t    goto got_error_ret;\n+\t\t  insn = bfd_get_32 (ibfd, buf);\n+\t\t  if ((insn & (0x3f << 26 | 0x3)) != 58u << 26 /* ld */)\n+\t\t    continue;\n+\t\t  break;\n+\t\t}\n+\n+\t      if (h != NULL)\n+\t\tent = h->got.glist;\n+\t      else\n+\t\t{\n+\t\t  struct got_entry **local_got_ents = elf_local_got_ents (ibfd);\n+\t\t  ent = local_got_ents[r_symndx];\n+\t\t}\n+\t      for (; ent != NULL; ent = ent->next)\n+\t\tif (ent->addend == rel->r_addend\n+\t\t    && ent->owner == ibfd\n+\t\t    && ent->tls_type == 0)\n+\t\t  break;\n+\t      BFD_ASSERT (ent && ent->got.refcount > 0);\n+\t      ent->got.refcount -= 1;\n+\t    }\n+\n+\t  if (elf_section_data (sec)->relocs != relstart)\n+\t    free (relstart);\n+\t}\n+\n+      if (local_syms != NULL\n+\t  && symtab_hdr->contents != (unsigned char *) local_syms)\n+\t{\n+\t  if (!info->keep_memory)\n+\t    free (local_syms);\n+\t  else\n+\t    symtab_hdr->contents = (unsigned char *) local_syms;\n+\t}\n+    }\n+\n   return TRUE;\n }\n \n@@ -14397,6 +14563,44 @@ ppc64_elf_relocate_section (bfd *output_bfd,\n \t      goto copy_reloc;\n \t    }\n \t  break;\n+\n+\tcase R_PPC64_GOT16_DS:\n+\t  from = TOCstart + htab->sec_info[input_section->id].toc_off;\n+\t  if (relocation + addend - from + 0x8000 < 0x10000\n+\t      && SYMBOL_REFERENCES_LOCAL (info, &h->elf))\n+\t    {\n+\t      insn = bfd_get_32 (input_bfd, contents + (rel->r_offset & ~3));\n+\t      if ((insn & (0x3f << 26 | 0x3)) == 58u << 26 /* ld */)\n+\t\t{\n+\t\t  insn += (14u << 26) - (58u << 26);\n+\t\t  bfd_put_32 (input_bfd, insn, contents + (rel->r_offset & ~3));\n+\t\t  r_type = R_PPC64_TOC16;\n+\t\t  rel->r_info = ELF64_R_INFO (r_symndx, r_type);\n+\t\t}\n+\t    }\n+\t  break;\n+\n+\tcase R_PPC64_GOT16_LO_DS:\n+\tcase R_PPC64_GOT16_HA:\n+\t  from = TOCstart + htab->sec_info[input_section->id].toc_off;\n+\t  if (relocation + addend - from + 0x80008000ULL < 0x100000000ULL\n+\t      && SYMBOL_REFERENCES_LOCAL (info, &h->elf))\n+\t    {\n+\t      insn = bfd_get_32 (input_bfd, contents + (rel->r_offset & ~3));\n+\t      if ((insn & (0x3f << 26 | 0x3)) == 58u << 26 /* ld */)\n+\t\t{\n+\t\t  insn += (14u << 26) - (58u << 26);\n+\t\t  bfd_put_32 (input_bfd, insn, contents + (rel->r_offset & ~3));\n+\t\t  r_type = R_PPC64_TOC16_LO;\n+\t\t  rel->r_info = ELF64_R_INFO (r_symndx, r_type);\n+\t\t}\n+\t      else if ((insn & (0x3f << 26)) == 15u << 26 /* addis */)\n+\t\t{\n+\t\t  r_type = R_PPC64_TOC16_HA;\n+\t\t  rel->r_info = ELF64_R_INFO (r_symndx, r_type);\n+\t\t}\n+\t    }\n+\t  break;\n \t}\n \n       /* Set `addend'.  */"
    },
    {
      "sha": "40b90fbc1a636d36b947cea1cfbe5bc52b611388",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -1,3 +1,16 @@\n+2019-04-30  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-powerpc/elfv2exe.d: Update.\n+\t* testsuite/ld-powerpc/elfv2so.d: Update.\n+\t* testsuite/ld-powerpc/tocopt.d: Update.\n+\t* testsuite/ld-powerpc/tocopt.s: Update.\n+\t* testsuite/ld-powerpc/tocopt5.d: Update.\n+\t* testsuite/ld-powerpc/tocopt5.s: Update.\n+\t* testsuite/ld-powerpc/tocopt7.d: Update.\n+\t* testsuite/ld-powerpc/tocopt7.s: Update.\n+\t* testsuite/ld-powerpc/tocopt8.d: Update.\n+\t* testsuite/ld-powerpc/tocopt8.s: Update.\n+\n 2019-04-30  Alan Modra  <amodra@gmail.com>\n \n \t* ld.texi (How GNU properties are merged): Avoid pod2man error."
    },
    {
      "sha": "769f8469a1688466c302821ee68a80541bf35e9b",
      "filename": "ld/testsuite/ld-powerpc/elfv2exe.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/elfv2exe.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/elfv2exe.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/elfv2exe.d?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -34,7 +34,7 @@ Disassembly of section \\.text:\n .*:\t(e8 62 80 08|08 80 62 e8) \tld      r3,-32760\\(r2\\)\n .*:\t(4b .. .. ..|.. .. .. 4b) \tbl      .*\\.plt_branch\\.f2>\n .*:\t(60 00 00 00|00 00 00 60) \tnop\n-.*:\t(e8 62 80 10|10 80 62 e8) \tld      r3,-32752\\(r2\\)\n+.*:\t(38 62 80 10|10 80 62 38) \taddi    r3,r2,-32752\n .*:\t(48 .. .. ..|.. .. .. 48) \tbl      10008888 <f3>\n .*:\t(60 00 00 00|00 00 00 60) \tnop\n .*:\t(4b .. .. ..|.. .. .. 4b) \tbl      .*\\.plt_branch\\.f4>"
    },
    {
      "sha": "081eb4937f702f6d998e2991f9b955e1bdcf5530",
      "filename": "ld/testsuite/ld-powerpc/elfv2so.d",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/elfv2so.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/elfv2so.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/elfv2so.d?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -9,35 +9,35 @@ Disassembly of section \\.text:\n \n .* <.*\\.plt_call\\.f4>:\n .*:\t(f8 41 00 18|18 00 41 f8) \tstd     r2,24\\(r1\\)\n-.*:\t(e9 82 80 40|40 80 82 e9) \tld      r12,-32704\\(r2\\)\n+.*:\t(e9 82 80 38|38 80 82 e9) \tld      r12,-32712\\(r2\\)\n .*:\t(7d 89 03 a6|a6 03 89 7d) \tmtctr   r12\n .*:\t(4e 80 04 20|20 04 80 4e) \tbctr\n \t\\.\\.\\.\n \n .* <.*\\.plt_call\\.f3>:\n .*:\t(f8 41 00 18|18 00 41 f8) \tstd     r2,24\\(r1\\)\n-.*:\t(e9 82 80 30|30 80 82 e9) \tld      r12,-32720\\(r2\\)\n+.*:\t(e9 82 80 28|28 80 82 e9) \tld      r12,-32728\\(r2\\)\n .*:\t(7d 89 03 a6|a6 03 89 7d) \tmtctr   r12\n .*:\t(4e 80 04 20|20 04 80 4e) \tbctr\n \t\\.\\.\\.\n \n .* <.*\\.plt_call\\.f5>:\n .*:\t(f8 41 00 18|18 00 41 f8) \tstd     r2,24\\(r1\\)\n-.*:\t(e9 82 80 28|28 80 82 e9) \tld      r12,-32728\\(r2\\)\n+.*:\t(e9 82 80 20|20 80 82 e9) \tld      r12,-32736\\(r2\\)\n .*:\t(7d 89 03 a6|a6 03 89 7d) \tmtctr   r12\n .*:\t(4e 80 04 20|20 04 80 4e) \tbctr\n \t\\.\\.\\.\n \n .* <.*\\.plt_call\\.f1>:\n .*:\t(f8 41 00 18|18 00 41 f8) \tstd     r2,24\\(r1\\)\n-.*:\t(e9 82 80 48|48 80 82 e9) \tld      r12,-32696\\(r2\\)\n+.*:\t(e9 82 80 40|40 80 82 e9) \tld      r12,-32704\\(r2\\)\n .*:\t(7d 89 03 a6|a6 03 89 7d) \tmtctr   r12\n .*:\t(4e 80 04 20|20 04 80 4e) \tbctr\n \t\\.\\.\\.\n \n .* <.*\\.plt_call\\.f2>:\n .*:\t(f8 41 00 18|18 00 41 f8) \tstd     r2,24\\(r1\\)\n-.*:\t(e9 82 80 38|38 80 82 e9) \tld      r12,-32712\\(r2\\)\n+.*:\t(e9 82 80 30|30 80 82 e9) \tld      r12,-32720\\(r2\\)\n .*:\t(7d 89 03 a6|a6 03 89 7d) \tmtctr   r12\n .*:\t(4e 80 04 20|20 04 80 4e) \tbctr\n \t\\.\\.\\.\n@@ -52,7 +52,7 @@ Disassembly of section \\.text:\n .*:\t(e8 62 80 08|08 80 62 e8) \tld      r3,-32760\\(r2\\)\n .*:\t(4b .. .. ..|.. .. .. 4b) \tbl      .*\\.plt_call\\.f2>\n .*:\t(e8 41 00 18|18 00 41 e8) \tld      r2,24\\(r1\\)\n-.*:\t(e8 62 80 10|10 80 62 e8) \tld      r3,-32752\\(r2\\)\n+.*:\t(38 62 80 48|48 80 62 38) \taddi    r3,r2,-32696\n .*:\t(4b .. .. ..|.. .. .. 4b) \tbl      .*\\.plt_call\\.f3>\n .*:\t(e8 41 00 18|18 00 41 e8) \tld      r2,24\\(r1\\)\n .*:\t(4b .. .. ..|.. .. .. 4b) \tbl      .*\\.plt_call\\.f4>"
    },
    {
      "sha": "5980589c7c9dc1f7a305cc9c883eb3eb5feddf43",
      "filename": "ld/testsuite/ld-powerpc/tocopt.d",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt.d?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -2,13 +2,13 @@\n .*:     file format .*\n \n Contents of section \\.text:\n- 100000b0 (3d220000|0000223d) (e9298018|188029e9) (3c820000|0000823c) (38a48020|2080a438)  .*\n- 100000c0 (e8c50000|0000c5e8) (3fa00000|0000a03f) (3bbd8028|2880bd3b) (7c62e82a|2ae8627c)  .*\n- 100000d0 (3d220000|0000223d) (39298033|33802939) (3c820000|0000823c) (38a48008|0880a438)  .*\n+ 100000b0 (3d220000|0000223d) (39298028|28802939) (3c820000|0000823c) (38a48018|1880a438)  .*\n+ 100000c0 (e8c50000|0000c5e8) (3fa00000|0000a03f) (3bbd8020|2080bd3b) (7c62e82a|2ae8627c)  .*\n+ 100000d0 (3d220000|0000223d) (3929802b|2b802939) (3c820000|0000823c) (38a48008|0880a438)  .*\n  100000e0 (e8c50000|0000c5e8) (3fa00000|0000a03f) (3bbd8010|1080bd3b) (7c62e82a|2ae8627c)  .*\n Contents of section \\.got:\n- 10010100 (00000000|00810110) (10018100|00000000) (00000000|34010110) (10010134|00000000)  .*\n- 10010110 (00000000|35010110) (10010135|00000000) (00000000|30010110) (10010130|00000000)  .*\n- 10010120 (00000000|31010110) (10010131|00000000) (00000000|32010110) (10010132|00000000)  .*\n+ 10010100 (00000000|00810110) (10018100|00000000) (00000000|2c010110) (1001012c|00000000)  .*\n+ 10010110 (00000000|2d010110) (1001012d|00000000) (00000000|29010110) (10010129|00000000)  .*\n+ 10010120 (00000000|2a010110) (1001012a|00000000) .*\n Contents of section \\.sdata:\n- 10010130 01020304 0506                        .*\n+ 10010128 01020304 0506                        .*"
    },
    {
      "sha": "cb5cc3e459f74b12a5f3c3cde88a98ea64189e08",
      "filename": "ld/testsuite/ld-powerpc/tocopt.s",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt.s?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -24,7 +24,8 @@ x6:\n  .text\n _start:\n # no need for got entry, optimise to nop,addi\n-# note: ld doesn't yet do got optimisation, so we get nop,ld\n+# note that due to unexpected toc/got insns the full optimisation is\n+# not done.  see tocopt5 for test without unexpected insns.\n  addis 9,2,x1@got@ha\n  ld 9,x1@got@l(9)\n # must keep got entry, optimise to nop,addi,ld"
    },
    {
      "sha": "39291d5cc14dc3df69cc30a02c75b2a1d75ca3e5",
      "filename": "ld/testsuite/ld-powerpc/tocopt5.d",
      "status": "modified",
      "additions": 5,
      "deletions": 6,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt5.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt5.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt5.d?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -2,12 +2,11 @@\n .*:     file format .*\n \n Contents of section \\.text:\n- 100000b0 (60000000|00000060) (e9228018|188022e9) (60000000|00000060) (38a28020|2080a238)  .*\n- 100000c0 (e8c50000|0000c5e8) (60000000|00000060) (3922802b|2b802239) (60000000|00000060)  .*\n+ 100000b0 (60000000|00000060) (39228020|20802239) (60000000|00000060) (38a28018|1880a238)  .*\n+ 100000c0 (e8c50000|0000c5e8) (60000000|00000060) (39228023|23802239) (60000000|00000060)  .*\n  100000d0 (38a28008|0880a238) (e8c50000|0000c5e8)                    .*\n Contents of section \\.got:\n- 10010100 (00000000|00810110) (10018100|00000000) (00000000|2c010110) (1001012c|00000000)  .*\n- 10010110 (00000000|2d010110) (1001012d|00000000) (00000000|28010110) (10010128|00000000)  .*\n- 10010120 (00000000|29010110) (10010129|00000000)                    .*\n+ 10010100 (00000000|00810110) (10018100|00000000) (00000000|24010110) (10010124|00000000)  .*\n+ 10010110 (00000000|25010110) (10010125|00000000) (00000000|21010110) (10010121|00000000)  .*\n Contents of section \\.sdata:\n- 10010128 01020304 0506                        .*\n+ 10010120 01020304 0506                        .*"
    },
    {
      "sha": "8eb0b9ff15567526b1c31f41d30bea118949d68c",
      "filename": "ld/testsuite/ld-powerpc/tocopt5.s",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt5.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt5.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt5.s?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -24,7 +24,6 @@ x6:\n  .text\n _start:\n # no need for got entry, optimise to nop,addi\n-# note: ld doesn't yet do got optimisation, so we get nop,ld\n  addis 9,2,x1@got@ha\n  ld 9,x1@got@l(9)\n # must keep got entry, optimise to nop,addi,ld"
    },
    {
      "sha": "baaf20059509583225329238aba06b892ea798ff",
      "filename": "ld/testsuite/ld-powerpc/tocopt7.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt7.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt7.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt7.d?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -2,7 +2,7 @@\n .*:     file format .*\n \n Contents of section \\.text:\n- 100000b0 (0000223d|3d220000) (288029e9|e9298028) (0000823c|3c820000) (3080a438|38a48030) .*\n+ 100000b0 (0000223d|3d220000) (40802939|39298040) (0000823c|3c820000) (3080a438|38a48030) .*\n  100000c0 (0000c5e8|e8c50000) (0000823f|3f820000) (29803ce9|e93c8029) (0000223d|3d220000) .*\n  100000d0 (108029e9|e9298010) (0000823c|3c820000) (1880a438|38a48018) (0000c5e8|e8c50000) .*\n  100000e0 (0000823f|3f820000) (11803ce9|e93c8011) (0000823c|3c820000) (3080a438|38a48030) .*"
    },
    {
      "sha": "e402ee7f629f61d8cbc9c161d78b7c521f678b38",
      "filename": "ld/testsuite/ld-powerpc/tocopt7.s",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt7.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt7.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt7.s?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -26,7 +26,6 @@ x6:\n  .text\n _start:\n # no need for got entry, optimise to nop,addi\n-# note: ld doesn't yet do got optimisation, so we get nop,ld\n  addis 9,2,x1@got@ha\n  ld 9,x1@got@l(9)\n # must keep got entry, optimise to nop,addi,ld"
    },
    {
      "sha": "fe5923c7cfefe67f2e84726bbfa8afefea13c844",
      "filename": "ld/testsuite/ld-powerpc/tocopt8.d",
      "status": "modified",
      "additions": 12,
      "deletions": 12,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt8.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt8.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt8.d?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -2,28 +2,28 @@\n .*:     file format .*\n \n Contents of section \\.text:\n- 100000b0 (00000060|60000000) (108022e9|e9228010) (00000060|60000000) (1880a238|38a28018) .*\n+ 100000b0 (00000060|60000000) (20802239|39228020) (00000060|60000000) (1080a238|38a28010) .*\n  100000c0 (0000c5e8|e8c50000) (00000060|60000000) (38802239|39228038) (00000060|60000000) .*\n  100000d0 (0880a238|38a28008) (0000c5e8|e8c50000) (00000060|60000000) (088022e9|e9228008) .*\n- 100000e0 (00000060|60000000) (1880a238|38a28018) (0000c580|80c50000) (00000060|60000000) .*\n+ 100000e0 (00000060|60000000) (1080a238|38a28010) (0000c580|80c50000) (00000060|60000000) .*\n  100000f0 (20802281|81228020) (00000060|60000000) (0880a238|38a28008) (0000c580|80c50000) .*\n- 10000100 (00000060|60000000) (1880a238|38a28018) (0200c5e8|e8c50002) (00000060|60000000) .*\n+ 10000100 (00000060|60000000) (1080a238|38a28010) (0200c5e8|e8c50002) (00000060|60000000) .*\n  10000110 (228022e9|e9228022) (00000060|60000000) (0880a238|38a28008) (0200c5e8|e8c50002) .*\n- 10000120 (00000060|60000000) (1880a238|38a28018) (0000c5a0|a0c50000) (00000060|60000000) .*\n+ 10000120 (00000060|60000000) (1080a238|38a28010) (0000c5a0|a0c50000) (00000060|60000000) .*\n  10000130 (208022a1|a1228020) (00000060|60000000) (0880a238|38a28008) (0000c5a0|a0c50000) .*\n- 10000140 (00000060|60000000) (1880a238|38a28018) (0000c5a8|a8c50000) (00000060|60000000) .*\n+ 10000140 (00000060|60000000) (1080a238|38a28010) (0000c5a8|a8c50000) (00000060|60000000) .*\n  10000150 (208022a9|a9228020) (00000060|60000000) (0880a238|38a28008) (0000c5a8|a8c50000) .*\n- 10000160 (00000060|60000000) (1880a238|38a28018) (0000c588|88c50000) (00000060|60000000) .*\n+ 10000160 (00000060|60000000) (1080a238|38a28010) (0000c588|88c50000) (00000060|60000000) .*\n  10000170 (20802289|89228020) (00000060|60000000) (0880a238|38a28008) (0000c588|88c50000) .*\n- 10000180 (00000060|60000000) (1880a238|38a28018) (0000c5c0|c0c50000) (00000060|60000000) .*\n+ 10000180 (00000060|60000000) (1080a238|38a28010) (0000c5c0|c0c50000) (00000060|60000000) .*\n  10000190 (208022c1|c1228020) (00000060|60000000) (0880a238|38a28008) (0000c5c0|c0c50000) .*\n- 100001a0 (00000060|60000000) (1880a238|38a28018) (0000c5c8|c8c50000) (00000060|60000000) .*\n+ 100001a0 (00000060|60000000) (1080a238|38a28010) (0000c5c8|c8c50000) (00000060|60000000) .*\n  100001b0 (208022c9|c9228020) (00000060|60000000) (0880a238|38a28008) (0000c5c8|c8c50000) .*\n- 100001c0 (00000060|60000000) (1880a238|38a28018) (0100c5f4|f4c50001) (00000060|60000000) .*\n+ 100001c0 (00000060|60000000) (1080a238|38a28010) (0100c5f4|f4c50001) (00000060|60000000) .*\n  100001d0 (218022f5|f5228021) (00000060|60000000) (2080a238|38a28020) (0100c5f4|f4c50001) .*\n- 100001e0 (00000060|60000000) (1880a238|38a28018) (0200c5e4|e4c50002) (00000060|60000000) .*\n+ 100001e0 (00000060|60000000) (1080a238|38a28010) (0200c5e4|e4c50002) (00000060|60000000) .*\n  100001f0 (228022e5|e5228022) (00000060|60000000) (0880a238|38a28008) (0200c5e4|e4c50002) .*\n- 10000200 (00000060|60000000) (1880a238|38a28018) (0300c5e4|e4c50003) (00000060|60000000) .*\n+ 10000200 (00000060|60000000) (1080a238|38a28010) (0300c5e4|e4c50003) (00000060|60000000) .*\n  10000210 (238022e5|e5228023) (00000060|60000000) (0880a238|38a28008) (0300c5e4|e4c50003) .*\n  10000220 (00000060|60000000) (208022f9|f9228020) (00000060|60000000) (0880a238|38a28008) .*\n  10000230 (0000c5f8|f8c50000) (00000060|60000000) (20802291|91228020) (00000060|60000000) .*\n@@ -39,7 +39,7 @@ Contents of section \\.text:\n  100002d0 (0300c5f4|f4c50003) .*\n Contents of section \\.got:\n  10010300 (00830110|00000000) (00000000|10018300) (40030110|00000000) (00000000|10010340) .*\n- 10010310 (20030110|00000000) (00000000|10010320) (28030110|00000000) (00000000|10010328) .*\n+ 10010310 (28030110|00000000) (00000000|10010328) .*\n Contents of section \\.sdata:\n  10010320 (01000000|00000000) (00000000|00000001) (02000000|00000000) (00000000|00000002) .*\n  10010330 (03000000|00000000) (00000000|00000003) (04000000|00000000) (00000000|00000004) .*"
    },
    {
      "sha": "1d71b2866b5fced15956da06d02612f75a614511",
      "filename": "ld/testsuite/ld-powerpc/tocopt8.s",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt8.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/066f4018ae7822d81cb6747fd9494e5dd63bfecf/ld/testsuite/ld-powerpc/tocopt8.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/tocopt8.s?ref=066f4018ae7822d81cb6747fd9494e5dd63bfecf",
      "patch": "@@ -23,7 +23,6 @@ x6:\n  .text\n _start:\n # no need for got entry, optimise to nop,addi\n-# note: ld doesn't yet do got optimisation, so we get nop,ld\n  addis 9,2,x1@got@ha\n  ld 9,x1@got@l(9)\n # must keep got entry, optimise to nop,addi,ld"
    }
  ]
}