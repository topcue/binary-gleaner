{
  "sha": "e0cdfe3c14b2aa55422fb02ba4c32e644d953d69",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTBjZGZlM2MxNGIyYWE1NTQyMmZiMDJiYTRjMzJlNjQ0ZDk1M2Q2OQ==",
  "commit": {
    "author": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2019-12-23T15:38:13Z"
    },
    "committer": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-01-16T20:14:47Z"
    },
    "message": "Add type for $_tlb->process_environment_block->process_parameters\n\nThe type then looks like this:\n\n(gdb) pt $_tlb->process_environment_block->process_parameters\ntype = struct rtl_user_process_parameters {\n    DWORD32 maximum_length;\n    DWORD32 length;\n    DWORD32 flags;\n    DWORD32 debug_flags;\n    void *console_handle;\n    DWORD32 console_flags;\n    void *standard_input;\n    void *standard_output;\n    void *standard_error;\n    unicode_string current_directory;\n    void *current_directory_handle;\n    unicode_string dll_path;\n    unicode_string image_path_name;\n    unicode_string command_line;\n    void *environment;\n    DWORD32 starting_x;\n    DWORD32 starting_y;\n    DWORD32 count_x;\n    DWORD32 count_y;\n    DWORD32 count_chars_x;\n    DWORD32 count_chars_y;\n    DWORD32 fill_attribute;\n    DWORD32 window_flags;\n    DWORD32 show_window_flags;\n    unicode_string window_title;\n    unicode_string desktop_info;\n    unicode_string shell_info;\n    unicode_string runtime_data;\n} *\n\nIt's mainly useful to get the current directory, or the full command line:\n\n(gdb) p $_tlb->process_environment_block->process_parameters->current_directory\n$1 = {\n  length = 26,\n  maximum_length = 520,\n  buffer = 0xe36c8 L\"C:\\\\src\\\\tests\\\\\"\n}\n(gdb) p $_tlb->process_environment_block->process_parameters->command_line\n$2 = {\n  length = 94,\n  maximum_length = 96,\n  buffer = 0xe32aa L\"\\\"C:\\\\gdb\\\\build64\\\\gdb-git\\\\gdb\\\\gdb.exe\\\" access.exe\"\n}\n\nThe type names are all lowercase because the existing types created\nby windows_get_tlb_type are also lowercase.\n\nType unicode_string is documented at [1].\nThe official documentation [2] for rtl_user_process_parameters is limited,\nso I've used this other page [3].\n\n[1] https://docs.microsoft.com/en-us/windows/win32/api/ntdef/ns-ntdef-_unicode_string\n[2] https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-rtl_user_process_parameters\n[3] https://www.nirsoft.net/kernel_struct/vista/RTL_USER_PROCESS_PARAMETERS.html\n\ngdb/ChangeLog:\n\n2020-01-16  Hannes Domani  <ssbssa@yahoo.de>\n\n\t* windows-tdep.c (windows_get_tlb_type):\n\tAdd rtl_user_process_parameters type.",
    "tree": {
      "sha": "72a72457cc64fdefd1be1d2dab632082deba3991",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/72a72457cc64fdefd1be1d2dab632082deba3991"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69/comments",
  "author": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "790f17188a22e722bab9915e1d50307f8cb7c0f9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/790f17188a22e722bab9915e1d50307f8cb7c0f9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/790f17188a22e722bab9915e1d50307f8cb7c0f9"
    }
  ],
  "stats": {
    "total": 66,
    "additions": 65,
    "deletions": 1
  },
  "files": [
    {
      "sha": "cc3a43cf2d7b7e103c731ee8892e3e23c4801174",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=e0cdfe3c14b2aa55422fb02ba4c32e644d953d69",
      "patch": "@@ -1,3 +1,8 @@\n+2020-01-16  Hannes Domani  <ssbssa@yahoo.de>\n+\n+\t* windows-tdep.c (windows_get_tlb_type):\n+\tAdd rtl_user_process_parameters type.\n+\n 2020-01-16  Pedro Alves  <palves@redhat.com>\n             Norbert Lange  <nolange79@gmail.com>\n "
    },
    {
      "sha": "1fc2748581886bbf15f34496d8309615bd9de66b",
      "filename": "gdb/windows-tdep.c",
      "status": "modified",
      "additions": 60,
      "deletions": 1,
      "changes": 61,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69/gdb/windows-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0cdfe3c14b2aa55422fb02ba4c32e644d953d69/gdb/windows-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/windows-tdep.c?ref=e0cdfe3c14b2aa55422fb02ba4c32e644d953d69",
      "patch": "@@ -165,6 +165,8 @@ windows_get_tlb_type (struct gdbarch *gdbarch)\n   struct type *peb_type, *peb_ptr_type, *list_type;\n   struct type *module_list_ptr_type;\n   struct type *tib_type, *seh_type, *tib_ptr_type, *seh_ptr_type;\n+  struct type *word_type, *wchar_type, *wchar_ptr_type;\n+  struct type *uni_str_type, *rupp_type, *rupp_ptr_type;\n \n   /* Do not rebuild type if same gdbarch as last time.  */\n   if (last_tlb_type && last_gdbarch == gdbarch)\n@@ -174,7 +176,13 @@ windows_get_tlb_type (struct gdbarch *gdbarch)\n \t\t\t\t 1, \"DWORD_PTR\");\n   dword32_type = arch_integer_type (gdbarch, 32,\n \t\t\t\t 1, \"DWORD32\");\n+  word_type = arch_integer_type (gdbarch, 16,\n+\t\t\t\t 1, \"WORD\");\n+  wchar_type = arch_integer_type (gdbarch, 16,\n+\t\t\t\t  1, \"wchar_t\");\n   void_ptr_type = lookup_pointer_type (builtin_type (gdbarch)->builtin_void);\n+  wchar_ptr_type = arch_pointer_type (gdbarch, gdbarch_ptr_bit (gdbarch),\n+\t\t\t\t      NULL, wchar_type);\n \n   /* list entry */\n \n@@ -219,6 +227,57 @@ windows_get_tlb_type (struct gdbarch *gdbarch)\n \t\t\t\tNULL);\n   TYPE_TARGET_TYPE (peb_ldr_ptr_type) = peb_ldr_type;\n \n+  /* struct UNICODE_STRING */\n+  uni_str_type = arch_composite_type (gdbarch, \"unicode_string\",\n+\t\t\t\t      TYPE_CODE_STRUCT);\n+\n+  append_composite_type_field (uni_str_type, \"length\", word_type);\n+  append_composite_type_field (uni_str_type, \"maximum_length\", word_type);\n+  append_composite_type_field_aligned (uni_str_type, \"buffer\",\n+\t\t\t\t       wchar_ptr_type,\n+\t\t\t\t       TYPE_LENGTH (wchar_ptr_type));\n+\n+  /* struct _RTL_USER_PROCESS_PARAMETERS */\n+  rupp_type = arch_composite_type (gdbarch, \"rtl_user_process_parameters\",\n+\t\t\t\t   TYPE_CODE_STRUCT);\n+\n+  append_composite_type_field (rupp_type, \"maximum_length\", dword32_type);\n+  append_composite_type_field (rupp_type, \"length\", dword32_type);\n+  append_composite_type_field (rupp_type, \"flags\", dword32_type);\n+  append_composite_type_field (rupp_type, \"debug_flags\", dword32_type);\n+  append_composite_type_field (rupp_type, \"console_handle\", void_ptr_type);\n+  append_composite_type_field (rupp_type, \"console_flags\", dword32_type);\n+  append_composite_type_field_aligned (rupp_type, \"standard_input\",\n+\t\t\t\t       void_ptr_type,\n+\t\t\t\t       TYPE_LENGTH (void_ptr_type));\n+  append_composite_type_field (rupp_type, \"standard_output\", void_ptr_type);\n+  append_composite_type_field (rupp_type, \"standard_error\", void_ptr_type);\n+  append_composite_type_field (rupp_type, \"current_directory\", uni_str_type);\n+  append_composite_type_field (rupp_type, \"current_directory_handle\",\n+\t\t\t       void_ptr_type);\n+  append_composite_type_field (rupp_type, \"dll_path\", uni_str_type);\n+  append_composite_type_field (rupp_type, \"image_path_name\", uni_str_type);\n+  append_composite_type_field (rupp_type, \"command_line\", uni_str_type);\n+  append_composite_type_field (rupp_type, \"environment\", void_ptr_type);\n+  append_composite_type_field (rupp_type, \"starting_x\", dword32_type);\n+  append_composite_type_field (rupp_type, \"starting_y\", dword32_type);\n+  append_composite_type_field (rupp_type, \"count_x\", dword32_type);\n+  append_composite_type_field (rupp_type, \"count_y\", dword32_type);\n+  append_composite_type_field (rupp_type, \"count_chars_x\", dword32_type);\n+  append_composite_type_field (rupp_type, \"count_chars_y\", dword32_type);\n+  append_composite_type_field (rupp_type, \"fill_attribute\", dword32_type);\n+  append_composite_type_field (rupp_type, \"window_flags\", dword32_type);\n+  append_composite_type_field (rupp_type, \"show_window_flags\", dword32_type);\n+  append_composite_type_field_aligned (rupp_type, \"window_title\",\n+\t\t\t\t       uni_str_type,\n+\t\t\t\t       TYPE_LENGTH (void_ptr_type));\n+  append_composite_type_field (rupp_type, \"desktop_info\", uni_str_type);\n+  append_composite_type_field (rupp_type, \"shell_info\", uni_str_type);\n+  append_composite_type_field (rupp_type, \"runtime_data\", uni_str_type);\n+\n+  rupp_ptr_type = arch_pointer_type (gdbarch, gdbarch_ptr_bit (gdbarch),\n+\t\t\t\t     NULL, rupp_type);\n+\n \n   /* struct process environment block */\n   peb_type = arch_composite_type (gdbarch, NULL, TYPE_CODE_STRUCT);\n@@ -229,7 +288,7 @@ windows_get_tlb_type (struct gdbarch *gdbarch)\n   append_composite_type_field (peb_type, \"mutant\", void_ptr_type);\n   append_composite_type_field (peb_type, \"image_base_address\", void_ptr_type);\n   append_composite_type_field (peb_type, \"ldr\", peb_ldr_ptr_type);\n-  append_composite_type_field (peb_type, \"process_parameters\", void_ptr_type);\n+  append_composite_type_field (peb_type, \"process_parameters\", rupp_ptr_type);\n   append_composite_type_field (peb_type, \"sub_system_data\", void_ptr_type);\n   append_composite_type_field (peb_type, \"process_heap\", void_ptr_type);\n   append_composite_type_field (peb_type, \"fast_peb_lock\", void_ptr_type);"
    }
  ]
}