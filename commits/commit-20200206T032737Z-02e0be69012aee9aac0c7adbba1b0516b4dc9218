{
  "sha": "02e0be69012aee9aac0c7adbba1b0516b4dc9218",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDJlMGJlNjkwMTJhZWU5YWFjMGM3YWRiYmExYjA1MTZiNGRjOTIxOA==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-02-05T05:49:17Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-02-06T03:27:37Z"
    },
    "message": "mbind gas tests and supports_gnu_osabi testsuite infrastructure\n\nWith the addition of section16 tests we have multiple tests\nadvertising themselves as \"mbind sections\" and \"mbind section\ncontents\".  This patch fixes that, and fails on quite a few targets\nthat force an OSABI value.  It's a pain specifying all the relevant\narm targets on an xfail line, so I wrote supports_gnu_osabi.\n\nbinutils/\n\t* testsuite/lib/binutils-common.exp (match_target): Accept '!' before\n\tTCL procedure.\n\t(supports_gnu_osabi): New procedure.\n\t(is_generic): New, from ld-lib.exp.\n\t(supports_gnu_unique): Use the above.\ngas/\n\t* testsuite/gas/elf/section12a.d: Use supports_gnu_osabi in\n\txfail, and rename test.\n\t* testsuite/gas/elf/section12b.d: Likewise.\n\t* testsuite/gas/elf/section16a.d: Likewise.\n\t* testsuite/gas/elf/section16b.d: Likewise.\nld/\n\t* testsuite/lib/ld-lib.exp (is_generic): Delete.\n\t* testsuite/ld-unique/unique.exp: Exclude tic6x.",
    "tree": {
      "sha": "f254f35a15e747f8f6775349b2bf29ca7ce478aa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f254f35a15e747f8f6775349b2bf29ca7ce478aa"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/02e0be69012aee9aac0c7adbba1b0516b4dc9218",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/02e0be69012aee9aac0c7adbba1b0516b4dc9218",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/02e0be69012aee9aac0c7adbba1b0516b4dc9218",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/02e0be69012aee9aac0c7adbba1b0516b4dc9218/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b88237bc21d0e847d5c8808bfd9a789ed213cfb2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b88237bc21d0e847d5c8808bfd9a789ed213cfb2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b88237bc21d0e847d5c8808bfd9a789ed213cfb2"
    }
  ],
  "stats": {
    "total": 114,
    "additions": 71,
    "deletions": 43
  },
  "files": [
    {
      "sha": "7dc97dbd85c7e95792732c0e1c7cb7b619046bb0",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,3 +1,11 @@\n+2020-02-06  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/lib/binutils-common.exp (match_target): Accept '!' before\n+\tTCL procedure.\n+\t(supports_gnu_osabi): New procedure.\n+\t(is_generic): New, from ld-lib.exp.\n+\t(supports_gnu_unique): Use the above.\n+\n 2020-02-04  Alan Modra  <amodra@gmail.com>\n \n \t* Makefile.am (CFILES): Add od-elf32_avr.c."
    },
    {
      "sha": "57b94f528a71b14dc7605cf944285de4b514bcb8",
      "filename": "binutils/testsuite/lib/binutils-common.exp",
      "status": "modified",
      "additions": 41,
      "deletions": 18,
      "changes": 59,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/binutils/testsuite/lib/binutils-common.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/binutils/testsuite/lib/binutils-common.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/testsuite/lib/binutils-common.exp?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -171,32 +171,38 @@ proc is_rela { binary_file } {\n # in square brackets or as machine triplet otherwise.\n #\n proc match_target { target } {\n-   if [string match {\\[*\\]} $target] {\n+   if [regexp {^!?\\[.*\\]$} $target] {\n \treturn $target\n    } else {\n \treturn [istarget $target]\n    }\n }\n \n-# True if the ELF target supports STB_GNU_UNIQUE with the ELF header's\n-# OSABI field set to ELFOSABI_GNU.\n+# True if the ELF target supports setting the ELF header OSABI field\n+# to ELFOSABI_GNU or ELFOSABI_FREEBSD, a requirement for STT_GNU_IFUNC\n+# symbol and SHF_GNU_MBIND section support.\n #\n # This generally depends on the target OS only, however there are a\n # number of exceptions for bare metal targets as follows.  The MSP430\n-# and Visium targets set OSABI to ELFOSABI_STANDALONE and cannot\n-# support STB_GNU_UNIQUE.  Likewise non-EABI ARM targets set OSABI to\n-# ELFOSABI_ARM, and TI C6X targets to ELFOSABI_C6000_*.  Finally\n-# rather than `bfd_elf_final_link' a number of targets use\n-# `_bfd_generic_final_link', which does not support STB_GNU_UNIQUE\n-# symbol binding causing assertion failures.\n+# and Visium targets set OSABI to ELFOSABI_STANDALONE.  Likewise\n+# non-EABI ARM targets set OSABI to ELFOSABI_ARM\n #\n-proc supports_gnu_unique {} {\n+# Note that some TI C6X targets use ELFOSABI_C6000_* but one doesn't,\n+# so we don't try to sort out tic6x here.  (The effect is that linker\n+# testcases will generally need to exclude tic6x or use a -m option.)\n+#\n+proc supports_gnu_osabi {} {\n     if { [istarget *-*-gnu*]\n \t || [istarget *-*-linux*]\n-\t || [istarget *-*-nacl*] } {\n-\treturn 1\n-    }\n-    if { [istarget \"arm*-*-*eabi*\"] } {\n+\t || [istarget *-*-nacl*]\n+\t || ( [istarget *-*-*bsd*] && ![istarget arm*-*-netbsd*] )\n+\t || [istarget *-*-symbianelf]\n+\t || [istarget *-*-lynxos]\n+\t || ( [istarget *-*-nto*] && ![istarget arm*-*-*] )\n+\t || [istarget *-*-irix*]\n+\t || [istarget *-*-*eabi*]\n+\t || [istarget *-*-rtems*]\n+\t || [istarget *-*-solaris*] } {\n \treturn 1\n     }\n     if { [istarget \"wasm32*-*-*\"] } {\n@@ -207,19 +213,36 @@ proc supports_gnu_unique {} {\n     }\n     if { [istarget \"arm*-*-*\"]\n \t || [istarget \"msp430-*-*\"]\n-\t || [istarget \"tic6x-*-*\"]\n \t || [istarget \"visium-*-*\"] } {\n \treturn 0\n     }\n-    if { [istarget \"am33_2.0-*-*\"]\n-\t || [istarget \"d30v-*-*\"]\n+    return 1\n+}\n+\n+# Return true if target uses the generic_link_hash_table linker.\n+proc is_generic { } {\n+    if { [istarget \"d30v-*-*\"]\n \t || [istarget \"dlx-*-*\"]\n \t || [istarget \"pj*-*-*\"]\n \t || [istarget \"s12z-*-*\"]\n \t || [istarget \"xgate-*-*\"] } {\n+\treturn 1\n+    }\n+    return 0\n+}\n+\n+# True if the ELF target supports STB_GNU_UNIQUE.\n+#\n+# This require ELFOSABI_GNU, and `bfd_elf_final_link'.\n+#\n+proc supports_gnu_unique {} {\n+    if { [istarget *-*-freebsd*] } {\n \treturn 0\n     }\n-    return 1\n+    if { [supports_gnu_osabi] && ![is_generic] } {\n+\treturn 1\n+    }\n+    return 0\n }\n \n # True for targets that do not sort .symtab as per the ELF standard."
    },
    {
      "sha": "ef7a8eeb4a8e9e77f3ebf5403d77c606e3c95a9a",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,3 +1,11 @@\n+2020-02-06  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/gas/elf/section12a.d: Use supports_gnu_osabi in\n+\txfail, and rename test.\n+\t* testsuite/gas/elf/section12b.d: Likewise.\n+\t* testsuite/gas/elf/section16a.d: Likewise.\n+\t* testsuite/gas/elf/section16b.d: Likewise.\n+\n 2020-02-02  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gas/25380"
    },
    {
      "sha": "15801617d58dfd1653d7d4029f9f0b8b6a1c592a",
      "filename": "gas/testsuite/gas/elf/section12a.d",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section12a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section12a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/section12a.d?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,10 +1,9 @@\n #source: section12.s\n #as: --no-pad-sections\n #readelf: -Sg --wide\n-#name: mbind sections\n+#name: mbind sections 12\n # A number of targets do not support SHF_GNU_MBIND\n-#xfail: arm*-*-netbsdelf* arm*-*-nto* msp430-*-* visium-*-*\n-#xfail: *-*-hpux* *-*-cloudabi\n+#xfail: ![supports_gnu_osabi]\n \n #...\n   \\[[ 0-9]+\\] \\.mbind\\.data[ \t]+PROGBITS[ \t]+0+0 0+[0-9a-f]+ 0+1 00 WAD  0   0  1"
    },
    {
      "sha": "98a4b9521d7d1d5f61246118b240b862cc82471d",
      "filename": "gas/testsuite/gas/elf/section12b.d",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section12b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section12b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/section12b.d?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,13 +1,12 @@\n #source: section12.s\n #as: --no-pad-sections\n #objdump: -s\n-#name: mbind section contents\n+#name: mbind section contents 16\n # RX annoyingly reorders the sections so that they do not match the sequence\n # expected below.\n #xfail: rx-*-*\n # A number of targets do not support SHF_GNU_MBIND\n-#xfail: arm*-*-netbsdelf* arm*-*-nto* msp430-*-* visium-*-*\n-#xfail: *-*-hpux* *-*-cloudabi\n+#xfail: ![supports_gnu_osabi]\n \n #...\n Contents of section .mbind.data:"
    },
    {
      "sha": "0d664752d8d1af37b1200548db7d72ba614c33d5",
      "filename": "gas/testsuite/gas/elf/section16a.d",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section16a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section16a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/section16a.d?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,10 +1,9 @@\n #source: section16.s\n #as: --no-pad-sections\n #readelf: -Sg --wide\n-#name: mbind sections\n+#name: mbind sections 16\n # A number of targets do not support SHF_GNU_MBIND\n-#xfail: arm*-*-netbsdelf* arm*-*-nto* msp430-*-* visium-*-*\n-#xfail: *-*-hpux* *-*-cloudabi\n+#xfail: ![supports_gnu_osabi]\n \n #...\n   \\[[ 0-9]+\\] \\.mbind\\.data[ \t]+PROGBITS[ \t]+0+0 0+[0-9a-f]+ 0+1 00 WAD  0   0  1"
    },
    {
      "sha": "9014fab9e7b3b4a1eb795d1b1dc14145e1f10c66",
      "filename": "gas/testsuite/gas/elf/section16b.d",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section16b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/gas/testsuite/gas/elf/section16b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/section16b.d?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,13 +1,12 @@\n #source: section16.s\n #as: --no-pad-sections\n #objdump: -s\n-#name: mbind section contents\n+#name: mbind section contents 16\n # RX annoyingly reorders the sections so that they do not match the sequence\n # expected below.\n #xfail: rx-*-*\n # A number of targets do not support SHF_GNU_MBIND\n-#xfail: arm*-*-netbsdelf* arm*-*-nto* msp430-*-* visium-*-*\n-#xfail: *-*-hpux* *-*-cloudabi\n+#xfail: ![supports_gnu_osabi]\n \n #...\n Contents of section .mbind.data:"
    },
    {
      "sha": "21f51c98b2e7c685f09b3b8f4e44277d53e645d8",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1,3 +1,8 @@\n+2020-02-06  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/lib/ld-lib.exp (is_generic): Delete.\n+\t* testsuite/ld-unique/unique.exp: Exclude tic6x.\n+\n 2020-02-06  Alan Modra  <amodra@gmail.com>\n \n \t* configure.tgt (i[3-7]86-*-moss*): Don't clear targ_extra_ofiles."
    },
    {
      "sha": "1f80b39c05b43069edae317db7e2f6ca1780d318",
      "filename": "ld/testsuite/ld-unique/unique.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/ld/testsuite/ld-unique/unique.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/ld/testsuite/ld-unique/unique.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-unique/unique.exp?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -30,7 +30,7 @@ if { ![is_elf_format] } {\n }\n \n # Require STB_GNU_UNIQUE support with OSABI set to GNU.\n-if { ![supports_gnu_unique] } {\n+if { ![supports_gnu_unique] || [istarget tic6x-*-*] } {\n     verbose \"UNIQUE tests not run - target does not support UNIQUE\"\n     return\n }"
    },
    {
      "sha": "bed5add77f01a9a15967138e514fc6b0be436d9d",
      "filename": "ld/testsuite/lib/ld-lib.exp",
      "status": "modified",
      "additions": 0,
      "deletions": 12,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/02e0be69012aee9aac0c7adbba1b0516b4dc9218/ld/testsuite/lib/ld-lib.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/02e0be69012aee9aac0c7adbba1b0516b4dc9218/ld/testsuite/lib/ld-lib.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/lib/ld-lib.exp?ref=02e0be69012aee9aac0c7adbba1b0516b4dc9218",
      "patch": "@@ -1088,18 +1088,6 @@ proc check_gc_sections_available { } {\n     return $gc_sections_available_saved\n }\n \n-# Return true if target uses the generic_link_hash_table linker.\n-proc is_generic { } {\n-    if { [istarget \"d30v-*-*\"]\n-\t || [istarget \"dlx-*-*\"]\n-\t || [istarget \"pj*-*-*\"]\n-\t || [istarget \"s12z-*-*\"]\n-\t || [istarget \"xgate-*-*\"] } {\n-\treturn 1\n-    }\n-    return 0\n-}\n-\n # Return true if target uses genelf.em.\n proc uses_genelf { } {\n     if { [istarget \"d30v-*-*\"]"
    }
  ]
}