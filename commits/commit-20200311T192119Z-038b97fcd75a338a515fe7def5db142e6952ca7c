{
  "sha": "038b97fcd75a338a515fe7def5db142e6952ca7c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDM4Yjk3ZmNkNzVhMzM4YTUxNWZlN2RlZjVkYjE0MmU2OTUyY2E3Yw==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-03-11T19:21:19Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-03-11T19:21:19Z"
    },
    "message": "testsuite: use `pwd -W` to convert from Unix to Windows paths\n\nWhen on a MinGW host, standard_output_file uses a regular expression to\nconvert Unix-style paths of the form \"/c/foo\" to \"c:/foo\".  This is\nneeded because the paths we pass to GDB (for example, with the \"file\"\ncommand) need to be in the Windows form.\n\nHowever, the regexp only works if your binutils-gdb repo is under a\n`/[a-z]/...` path (the Unix paths mapping to Windows drives).\nPresumably, that works if you clone the repo in Windows, then access it\nthrough `/c/...`.\n\nIn my case, I've cloned the repository directly inside my MinGW shell,\nso in /home/smarchi.  The regexp therefore doesn't work for me.  The\npath doesn't get transformed, and the file command fails when running\nany test:\n\n    (gdb) file /home/smarchi/build/binutils-gdb/gdb/testsuite/outputs/gdb.arch/i386-bp_permanent/i386-bp_permanent\n    /home/smarchi/build/binutils-gdb/gdb/testsuite/outputs/gdb.arch/i386-bp_permanent/i386-bp_permanent: No such file or directory.\n\nA safer way to do this is to execute `pwd -W` while in the directory we\nwant the path for, this is what this patch does.\n\nI have also considered using the using the cygpath utility to do the\nconversion.  It can be used to convert any MinGW path into its Windows\nequivalent.  Despite originally coming from Cygwin, the cygpath utility\nis distributed by MinGW-w64 and can be used in that environment.\nHowever, it's not distributed with the non-MinGW-w64 MinGW.\n\nThe `pwd -W` trick only works with directories that exist, which is the\ncase here, so it's sufficient.\n\nWith this, the file command in the test succeeds:\n\n    (gdb) file C:/msys64/home/smarchi/build/binutils-gdb/gdb/testsuite/outputs/gdb.arch/i386-bp_permanent/i386-bp_permanent\n    Reading symbols from C:/msys64/home/smarchi/build/binutils-gdb/gdb/testsuite/outputs/gdb.arch/i386-bp_permanent/i386-bp_permanent...\n\ngdb/testsuite/ChangeLog:\n\n\t* lib/gdb.exp (standard_output_file): Use `pwd -W` to convert\n\tfrom Unix to Windows path.",
    "tree": {
      "sha": "1f07105a7d06a85c768e35beb623570155f87336",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1f07105a7d06a85c768e35beb623570155f87336"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/038b97fcd75a338a515fe7def5db142e6952ca7c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/038b97fcd75a338a515fe7def5db142e6952ca7c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/038b97fcd75a338a515fe7def5db142e6952ca7c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/038b97fcd75a338a515fe7def5db142e6952ca7c/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a0761e34f054767de6d6389929d27e9015fb299b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a0761e34f054767de6d6389929d27e9015fb299b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a0761e34f054767de6d6389929d27e9015fb299b"
    }
  ],
  "stats": {
    "total": 7,
    "additions": 6,
    "deletions": 1
  },
  "files": [
    {
      "sha": "19114c29366797e2666f7092e60bd8a08eb55596",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/038b97fcd75a338a515fe7def5db142e6952ca7c/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/038b97fcd75a338a515fe7def5db142e6952ca7c/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=038b97fcd75a338a515fe7def5db142e6952ca7c",
      "patch": "@@ -1,3 +1,8 @@\n+2020-03-11  Simon Marchi  <simon.marchi@efficios.com>\n+\n+\t* lib/gdb.exp (standard_output_file): Use `pwd -W` to convert\n+\tfrom Unix to Windows path.\n+\n 2020-03-11  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.ada/minsyms.exp: Set language to ada."
    },
    {
      "sha": "9e903ba34776a98312236c728fb9c7c4f9fbe996",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/038b97fcd75a338a515fe7def5db142e6952ca7c/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/038b97fcd75a338a515fe7def5db142e6952ca7c/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=038b97fcd75a338a515fe7def5db142e6952ca7c",
      "patch": "@@ -4899,7 +4899,7 @@ proc standard_output_file {basename} {\n     file mkdir $dir\n     # If running on MinGW, replace /c/foo with c:/foo\n     if { [ishost *-*-mingw*] } {\n-        set dir [regsub {^/([a-z])/} $dir {\\1:/}]\n+        set dir [exec sh -c \"cd ${dir} && pwd -W\"]\n     }\n     return [file join $dir $basename]\n }"
    }
  ]
}