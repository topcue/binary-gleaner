{
  "sha": "5486c5174894a1a6e68b9fdf1865b838b9c792d8",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTQ4NmM1MTc0ODk0YTFhNmU2OGI5ZmRmMTg2NWI4MzhiOWM3OTJkOA==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-09-19T17:54:49Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-09-19T17:54:55Z"
    },
    "message": "Use gdb_bfd_sections in generic_load\n\nThis changes generic_load to avoid bfd_map_over_sections, in favor of\niteration.\n\ngdb/ChangeLog\n2020-09-19  Tom Tromey  <tom@tromey.com>\n\n\t* symfile.c (add_section_size_callback): Remove.\n\t(load_one_section): Rename from load_section_callback.  Change\n\tparameters.\n\t(generic_load): Use foreach.",
    "tree": {
      "sha": "54880f25923ec74e2eaaa9b28c4e583d99ef177b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/54880f25923ec74e2eaaa9b28c4e583d99ef177b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5486c5174894a1a6e68b9fdf1865b838b9c792d8",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5486c5174894a1a6e68b9fdf1865b838b9c792d8",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5486c5174894a1a6e68b9fdf1865b838b9c792d8",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5486c5174894a1a6e68b9fdf1865b838b9c792d8/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8a6bb1d130b61887011463417bd8662dc41757fa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8a6bb1d130b61887011463417bd8662dc41757fa",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8a6bb1d130b61887011463417bd8662dc41757fa"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 14,
    "deletions": 16
  },
  "files": [
    {
      "sha": "131ec931708c58b1a85def02079f297c6cd7dfe9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5486c5174894a1a6e68b9fdf1865b838b9c792d8/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5486c5174894a1a6e68b9fdf1865b838b9c792d8/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5486c5174894a1a6e68b9fdf1865b838b9c792d8",
      "patch": "@@ -1,3 +1,10 @@\n+2020-09-19  Tom Tromey  <tom@tromey.com>\n+\n+\t* symfile.c (add_section_size_callback): Remove.\n+\t(load_one_section): Rename from load_section_callback.  Change\n+\tparameters.\n+\t(generic_load): Use foreach.\n+\n 2020-09-19  Tom Tromey  <tom@tromey.com>\n \n \t* exec.c (add_to_section_table): Remove."
    },
    {
      "sha": "baed72e936eac2f7a61e7e9e7318891c1a244a04",
      "filename": "gdb/symfile.c",
      "status": "modified",
      "additions": 7,
      "deletions": 16,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5486c5174894a1a6e68b9fdf1865b838b9c792d8/gdb/symfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5486c5174894a1a6e68b9fdf1865b838b9c792d8/gdb/symfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile.c?ref=5486c5174894a1a6e68b9fdf1865b838b9c792d8",
      "patch": "@@ -1842,16 +1842,6 @@ load_command (const char *arg, int from_tty)\n \n static int validate_download = 0;\n \n-/* Callback service function for generic_load (bfd_map_over_sections).  */\n-\n-static void\n-add_section_size_callback (bfd *abfd, asection *asec, void *data)\n-{\n-  bfd_size_type *sum = (bfd_size_type *) data;\n-\n-  *sum += bfd_section_size (asec);\n-}\n-\n /* Opaque data for load_progress.  */\n struct load_progress_data\n {\n@@ -1966,12 +1956,12 @@ load_progress (ULONGEST bytes, void *untyped_arg)\n \t\t\t\t   totals->total_size);\n }\n \n-/* Callback service function for generic_load (bfd_map_over_sections).  */\n+/* Service function for generic_load.  */\n \n static void\n-load_section_callback (bfd *abfd, asection *asec, void *data)\n+load_one_section (bfd *abfd, asection *asec,\n+\t\t  struct load_section_data *args)\n {\n-  struct load_section_data *args = (struct load_section_data *) data;\n   bfd_size_type size = bfd_section_size (asec);\n   const char *sect_name = bfd_section_name (asec);\n \n@@ -2040,10 +2030,11 @@ generic_load (const char *args, int from_tty)\n \t     bfd_errmsg (bfd_get_error ()));\n     }\n \n-  bfd_map_over_sections (loadfile_bfd.get (), add_section_size_callback,\n-\t\t\t (void *) &total_progress.total_size);\n+  for (asection *asec : gdb_bfd_sections (loadfile_bfd))\n+    total_progress.total_size += bfd_section_size (asec);\n \n-  bfd_map_over_sections (loadfile_bfd.get (), load_section_callback, &cbdata);\n+  for (asection *asec : gdb_bfd_sections (loadfile_bfd))\n+    load_one_section (loadfile_bfd.get (), asec, &cbdata);\n \n   using namespace std::chrono;\n "
    }
  ]
}