{
  "sha": "a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YTdiMzRhYmE2MmNlMzQ3YjRlNjRjYTE5N2E1YzhiOTk3ZTNiNzJkZg==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-05-27T10:30:11Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-05-28T01:25:21Z"
    },
    "message": "Obsolete tic30-aout, and linker segmentation faults\n\nSee also the FIXME.  tic30-aout linker support is so bad (and has been\nthat way since the initial tic30-aout commit) that I'm obsoleting the\ntarget.  This patch fixes numerous linker testsuite segmentation faults.\n\n\tPR 24596\n\t* aout-tic30.c (MY_bfd_final_link): Don't segfault on missing\n\tcreate_object_symbols_section, obj_textsec, obj_datasec or\n\tobj_bsssec.  Fix other errors in placement.\n\t* config.bfd: Obsolete tic30-aout.",
    "tree": {
      "sha": "b9385b316cffcab665d9c580d6353bba23859770",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b9385b316cffcab665d9c580d6353bba23859770"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0eb32b6e1dee07ac199b4bba855205e4de099213",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0eb32b6e1dee07ac199b4bba855205e4de099213",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0eb32b6e1dee07ac199b4bba855205e4de099213"
    }
  ],
  "stats": {
    "total": 107,
    "additions": 75,
    "deletions": 32
  },
  "files": [
    {
      "sha": "254ebcb2cd540ca20945a546daf666f94c0b416b",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
      "patch": "@@ -1,3 +1,11 @@\n+2019-05-28  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 24596\n+\t* aout-tic30.c (MY_bfd_final_link): Don't segfault on missing\n+\tcreate_object_symbols_section, obj_textsec, obj_datasec or\n+\tobj_bsssec.  Fix other errors in placement.\n+\t* config.bfd: Obsolete tic30-aout.\n+\n 2019-05-28  Alan Modra  <amodra@gmail.com>\n \n \tPR 24596"
    },
    {
      "sha": "49463181f0957af2c2152e746fad3337f29b664a",
      "filename": "bfd/aout-tic30.c",
      "status": "modified",
      "additions": 66,
      "deletions": 32,
      "changes": 98,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/bfd/aout-tic30.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/bfd/aout-tic30.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/aout-tic30.c?ref=a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
      "patch": "@@ -710,53 +710,87 @@ static bfd_boolean\n MY_bfd_final_link (bfd *abfd, struct bfd_link_info *info)\n {\n   struct internal_exec *execp = exec_hdr (abfd);\n+  asection *objsym_section;\n   file_ptr pos;\n   bfd_vma vma = 0;\n-  int pad;\n \n   /* Set the executable header size to 0, as we don't want one for an\n-     output.  */\n+     output.  FIXME: Really?  tic30_aout_object_p doesn't accept such\n+     an executable!  */\n   adata (abfd).exec_bytes_size = 0;\n+\n   pos = adata (abfd).exec_bytes_size;\n+  /* ??? Why are we looking at create_object_symbols_section?  */\n+  objsym_section = info->create_object_symbols_section;\n+  if (objsym_section != NULL)\n+    vma = objsym_section->vma;\n+\n   /* Text.  */\n-  vma = info->create_object_symbols_section->vma;\n-  pos += vma;\n-  obj_textsec (abfd)->filepos = pos;\n-  obj_textsec (abfd)->vma = vma;\n-  obj_textsec (abfd)->user_set_vma = 1;\n-  pos += obj_textsec (abfd)->size;\n-  vma += obj_textsec (abfd)->size;\n+  if (obj_textsec (abfd) != NULL)\n+    {\n+      pos += vma;\n+      obj_textsec (abfd)->filepos = pos;\n+      obj_textsec (abfd)->vma = vma;\n+      obj_textsec (abfd)->user_set_vma = 1;\n+      execp->a_text = obj_textsec (abfd)->size;\n+      pos += obj_textsec (abfd)->size;\n+      vma += obj_textsec (abfd)->size;\n+    }\n \n   /* Data.  */\n-  if (abfd->flags & D_PAGED)\n+  if (obj_datasec (abfd) != NULL)\n     {\n-      if (info->create_object_symbols_section->next->vma > 0)\n-\tobj_datasec (abfd)->vma = info->create_object_symbols_section->next->vma;\n+      if (abfd->flags & D_PAGED)\n+\t{\n+\t  if (objsym_section != NULL\n+\t      && objsym_section->next != NULL\n+\t      && objsym_section->next->vma != 0)\n+\t    obj_datasec (abfd)->vma = objsym_section->next->vma;\n+\t  else\n+\t    obj_datasec (abfd)->vma = BFD_ALIGN (vma, adata (abfd).segment_size);\n+\t}\n       else\n-\tobj_datasec (abfd)->vma = BFD_ALIGN (vma, adata (abfd).segment_size);\n-    }\n-  else\n-    obj_datasec (abfd)->vma = BFD_ALIGN (vma, 4);\n+\tobj_datasec (abfd)->vma = BFD_ALIGN (vma, 4);\n \n-  if (obj_datasec (abfd)->vma < vma)\n-    obj_datasec (abfd)->vma = BFD_ALIGN (vma, 4);\n+      if (obj_datasec (abfd)->vma < vma)\n+\tobj_datasec (abfd)->vma = BFD_ALIGN (vma, 4);\n \n-  obj_datasec (abfd)->user_set_vma = 1;\n-  vma = obj_datasec (abfd)->vma;\n-  obj_datasec (abfd)->filepos = vma + adata (abfd).exec_bytes_size;\n-  execp->a_text = vma - obj_textsec (abfd)->vma;\n-  obj_textsec (abfd)->size = execp->a_text;\n+      pos += obj_datasec (abfd)->vma - vma;\n+      obj_datasec (abfd)->filepos = pos;\n+      obj_datasec (abfd)->user_set_vma = 1;\n+\n+      vma = obj_datasec (abfd)->vma;\n+      if (obj_textsec (abfd) != NULL)\n+\t{\n+\t  execp->a_text = vma - obj_textsec (abfd)->vma;\n+\t  obj_textsec (abfd)->size = execp->a_text;\n+\t}\n+      execp->a_data = obj_datasec (abfd)->size;\n+      vma += obj_datasec (abfd)->size;\n+    }\n \n   /* Since BSS follows data immediately, see if it needs alignment.  */\n-  vma += obj_datasec (abfd)->size;\n-  pad = align_power (vma, obj_bsssec (abfd)->alignment_power) - vma;\n-  obj_datasec (abfd)->size += pad;\n-  pos += obj_datasec (abfd)->size;\n-  execp->a_data = obj_datasec (abfd)->size;\n-\n-  /* BSS.  */\n-  obj_bsssec (abfd)->vma = vma;\n-  obj_bsssec (abfd)->user_set_vma = 1;\n+  if (obj_bsssec (abfd) != NULL)\n+    {\n+      int pad;\n+\n+      pad = align_power (vma, obj_bsssec (abfd)->alignment_power) - vma;\n+      if (obj_datasec (abfd) != NULL)\n+\t{\n+\t  obj_datasec (abfd)->size += pad;\n+\t  execp->a_data += pad;\n+\t}\n+      else if (obj_textsec (abfd) != NULL)\n+\t{\n+\t  obj_textsec (abfd)->size += pad;\n+\t  execp->a_text += pad;\n+\t}\n+\n+      /* BSS.  */\n+      vma += pad;\n+      obj_bsssec (abfd)->vma = vma;\n+      obj_bsssec (abfd)->user_set_vma = 1;\n+    }\n \n   /* We are fully resized, so don't readjust in final_link.  */\n   adata (abfd).magic = z_magic;"
    },
    {
      "sha": "c6b04ea4a58a7c1938a7baf399a83e96fffb26e5",
      "filename": "bfd/config.bfd",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/bfd/config.bfd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a7b34aba62ce347b4e64ca197a5c8b997e3b72df/bfd/config.bfd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/config.bfd?ref=a7b34aba62ce347b4e64ca197a5c8b997e3b72df",
      "patch": "@@ -53,6 +53,7 @@ case $targ in\n     echo \"*** Use or1k-*-elf or or1k-*-linux as the target instead\" >&2\n     exit 1\n     ;;\n+ c30-*-*aout* | tic30-*-*aout* | \\\n  null)\n     if test \"x$enable_obsolete\" != xyes; then\n       echo \"*** Configuration $targ is obsolete.\" >&2"
    }
  ]
}