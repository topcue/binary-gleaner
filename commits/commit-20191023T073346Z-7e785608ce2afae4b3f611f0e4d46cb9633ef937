{
  "sha": "7e785608ce2afae4b3f611f0e4d46cb9633ef937",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6N2U3ODU2MDhjZTJhZmFlNGIzZjYxMWYwZTRkNDZjYjk2MzNlZjkzNw==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-10-23T07:33:46Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-10-23T07:33:46Z"
    },
    "message": "[gdb/breakpoints] Fix fullname.exp when run from symlink dir\n\nI run into this error with gdb.base/fullname.exp:\n...\n(gdb) file /data/gdb_versions/devel/build/gdb/testsuite/outputs/\\\n  gdb.base/fullname/fullname\nReading symbols from /data/gdb_versions/devel/build/gdb/testsuite/outputs/\\\n  gdb.base/fullname/fullname...\n(gdb) break /data/gdb_versions/devel/build/gdb/testsuite/\\\n  outputs/gdb.base/fullname/tmp-fullname.c:21\nNo source file named /data/gdb_versions/devel/build/gdb/testsuite/outputs/\\\n  gdb.base/fullname/tmp-fullname.c.\nMake breakpoint pending on future shared library load? (y or [n]) n\n(gdb) FAIL: gdb.base/fullname.exp: set breakpoint by full path before loading symbols - built relative\n...\n\nThe FAIL is due to this comparison in iterate_over_some_symtabs failing:\n...\n481                   if (FILENAME_CMP (real_path, fullname) == 0)\n(gdb) p real_path\n$2 = 0x1a201f0 \"/data/gdb_versions/devel/build/gdb/testsuite/outputs/\\\n  gdb.base/fullname/tmp-fullname.c\"\n(gdb) p fullname\n$3 = 0x1a1de80 \"/home/vries/gdb_versions/devel/build/gdb/testsuite/outputs/\\\n  gdb.base/fullname/tmp-fullname.c\"\n...\n\nThe difference in pathnames is due to having a symlink dir:\n...\n$ ls -la /home/vries/gdb_versions\nlrwxrwxrwx 1 vries users 18 26 jun  2018 /home/vries/gdb_versions -> /data/gdb_versions\n...\nand the test passses when eliminating it:\n...\n$ ( cd $(pwd -P); make check RUNTESTFLAGS=gdb.base/fullname.exp )\n...\n\nThe FAIL is a regression from commit a0c1ffedcf1 \"Only compute realpath when\nbasenames_may_differ is set\".  Before, find_and_open_source was returning a\nreal-path, resulting in variable 'fullname' being the same as varible\n'real_path' in the comparison listed above.  But after, that's no longer the\ncase.\n\nFix the FAIL by applying gdb_realpath on the fullname variable before the\ncomparison.\n\nTested on x86_64-linux.\n\nI wasn't able to write a test-case.  The FAIL starts at:\n...\n$ cd build/gdb\n$ mv testsuite testsuite.bla\n$ ln -s testsuite.bla testsuite\n...\nbut already this doesn't trigger it anymore:\n...\n$ cd build/gdb/outputs\n$ mv outputs outputs.bla\n$ ln -s outputs.bla outputs\n...\n\ngdb/ChangeLog:\n\n2019-10-23  Tom de Vries  <tdevries@suse.de>\n\n\tPR breakpoints/24687\n\t* symtab.c (iterate_over_some_symtabs): Apply gdb_realpath on fullname.\n\nChange-Id: I1ace62a234458781e958980f3b425edf1490df27",
    "tree": {
      "sha": "8cd6e87559a45b0d6c11d17563fa6080784b9c53",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8cd6e87559a45b0d6c11d17563fa6080784b9c53"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7e785608ce2afae4b3f611f0e4d46cb9633ef937",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e785608ce2afae4b3f611f0e4d46cb9633ef937",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7e785608ce2afae4b3f611f0e4d46cb9633ef937",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e785608ce2afae4b3f611f0e4d46cb9633ef937/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6a093f341b4647777144499add6c30c9e74864c9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6a093f341b4647777144499add6c30c9e74864c9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6a093f341b4647777144499add6c30c9e74864c9"
    }
  ],
  "stats": {
    "total": 8,
    "additions": 8,
    "deletions": 0
  },
  "files": [
    {
      "sha": "253c74f37709412ef704ae9fd3ceeab2b64e00b1",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e785608ce2afae4b3f611f0e4d46cb9633ef937/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e785608ce2afae4b3f611f0e4d46cb9633ef937/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=7e785608ce2afae4b3f611f0e4d46cb9633ef937",
      "patch": "@@ -1,3 +1,8 @@\n+2019-10-23  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR breakpoints/24687\n+\t* symtab.c (iterate_over_some_symtabs): Apply gdb_realpath on fullname.\n+\n 2019-10-22  Christian Biesinger  <cbiesinger@google.com>\n \n \t* symtab.c (struct demangled_name_entry) <language>: Change from"
    },
    {
      "sha": "160a4c08e961a02350602410cc17082453421e5f",
      "filename": "gdb/symtab.c",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e785608ce2afae4b3f611f0e4d46cb9633ef937/gdb/symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e785608ce2afae4b3f611f0e4d46cb9633ef937/gdb/symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.c?ref=7e785608ce2afae4b3f611f0e4d46cb9633ef937",
      "patch": "@@ -480,6 +480,9 @@ iterate_over_some_symtabs (const char *name,\n \n \t      gdb_assert (IS_ABSOLUTE_PATH (real_path));\n \t      gdb_assert (IS_ABSOLUTE_PATH (name));\n+\t      gdb::unique_xmalloc_ptr<char> fullname_real_path\n+\t\t= gdb_realpath (fullname);\n+\t      fullname = fullname_real_path.get ();\n \t      if (FILENAME_CMP (real_path, fullname) == 0)\n \t\t{\n \t\t  if (callback (s))"
    }
  ]
}