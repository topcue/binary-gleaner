{
  "sha": "6dc55ce97db90a9e6f201d67ca05608e19287ba1",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmRjNTVjZTk3ZGI5MGE5ZTZmMjAxZDY3Y2EwNTYwOGUxOTI4N2JhMQ==",
  "commit": {
    "author": {
      "name": "nitachra",
      "email": "Nitika.Achra@amd.com",
      "date": "2020-05-09T08:03:51Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-05-09T08:03:51Z"
    },
    "message": "Fix for the complaint observed when symbol reading due to unsupported .debug_names form\n\nFollowing complaint is observed with the executable compiled with -gdwarf-5\nand -gpubnames flags - \"During symbol reading: Unsupported .debug_names form\nDW_FORM_ref4\".  This is the form corresponding to DW_IDX_die_offset attribute.\nThis patch fixes this complaint.  Tested with clang 10.0.0.  Test case used -\n\nint main()\n{\nint sum,a,b;\nsum = a + b;\nreturn sum;\n}\n\nclang -gdwarf-5 -gpubnames test.c -o test.out\n\ngdb -q test.out -ex \"set complaints 1\" -ex \"start\"\n\nReading symbols from test.out...\nDuring symbol reading: Unsupported .debug_names form DW_FORM_ref4 \\\n  [in module test.out]\nTemporary breakpoint 1 at 0x400484\nStarting program: test.out\nDuring symbol reading: Unsupported .debug_names form DW_FORM_ref4 \\\n  [in module test.out]\nDuring symbol reading: Unsupported .debug_names form DW_FORM_ref4 \\\n  [in module test.out]\nDuring symbol reading: Unsupported .debug_names form DW_FORM_ref4 \\\n  [in module test.out]\n\ngdb/dwarf2/ChangeLog:\n\n2020-05-09  Nitika Achra  <Nitika.Achra@amd.com>\n\n\tPR symtab/25952\n\t* read.c (dw2_debug_names_iterator::next): Handle DW_FORM_ref*\n\tand DW_IDX_die_offset.  If there is no compilation unit attribute in\n\tthe index entry, then there is a single CU.  Return the CU at O index\n\tof compilation unit vector.\n\ngdb/testsuite/ChangeLog:\n\n2020-05-09  Tom de Vries  <tdevries@suse.de>\n\n\t* gdb.dwarf2/clang-debug-names.exp: Remove PR25952 kfail.",
    "tree": {
      "sha": "3a0b0ab8ff6228d10a5fd20d1002440c3048947f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3a0b0ab8ff6228d10a5fd20d1002440c3048947f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6dc55ce97db90a9e6f201d67ca05608e19287ba1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6dc55ce97db90a9e6f201d67ca05608e19287ba1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6dc55ce97db90a9e6f201d67ca05608e19287ba1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6dc55ce97db90a9e6f201d67ca05608e19287ba1/comments",
  "author": null,
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b326e6b0deed5d5ad22767c2800f490f61b37824",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b326e6b0deed5d5ad22767c2800f490f61b37824",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b326e6b0deed5d5ad22767c2800f490f61b37824"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 23,
    "deletions": 12
  },
  "files": [
    {
      "sha": "4c8a0717c785b63126713703d944c4f5261af449",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6dc55ce97db90a9e6f201d67ca05608e19287ba1/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6dc55ce97db90a9e6f201d67ca05608e19287ba1/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=6dc55ce97db90a9e6f201d67ca05608e19287ba1",
      "patch": "@@ -5352,6 +5352,18 @@ dw2_debug_names_iterator::next ()\n \t  ull = read_unsigned_leb128 (abfd, m_addr, &bytes_read);\n \t  m_addr += bytes_read;\n \t  break;\n+\tcase DW_FORM_ref4:\n+\t  ull = read_4_bytes (abfd, m_addr);\n+\t  m_addr += 4;\n+\t  break;\n+\tcase DW_FORM_ref8:\n+\t  ull = read_8_bytes (abfd, m_addr);\n+\t  m_addr += 8;\n+\t  break;\n+\tcase DW_FORM_ref_sig8:\n+\t  ull = read_8_bytes (abfd, m_addr);\n+\t  m_addr += 8;\n+\t  break;\n \tdefault:\n \t  complaint (_(\"Unsupported .debug_names form %s [in module %s]\"),\n \t\t     dwarf_form_name (attr.form),\n@@ -5384,6 +5396,12 @@ dw2_debug_names_iterator::next ()\n \t    }\n \t  per_cu = &dwarf2_per_objfile->get_tu (ull)->per_cu;\n \t  break;\n+\tcase DW_IDX_die_offset:\n+\t  /* In a per-CU index (as opposed to a per-module index), index\n+\t     entries without CU attribute implicitly refer to the single CU.  */\n+\t  if (per_cu == NULL)\n+\t    per_cu = dwarf2_per_objfile->get_cu (0);\n+\t  break;\n \tcase DW_IDX_GNU_internal:\n \t  if (!m_map.augmentation_is_gdb)\n \t    break;"
    },
    {
      "sha": "eccba674a4bac5def8783fa25bfab6a246aea6c5",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6dc55ce97db90a9e6f201d67ca05608e19287ba1/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6dc55ce97db90a9e6f201d67ca05608e19287ba1/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=6dc55ce97db90a9e6f201d67ca05608e19287ba1",
      "patch": "@@ -1,3 +1,7 @@\n+2020-05-09  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gdb.dwarf2/clang-debug-names.exp: Remove PR25952 kfail.\n+\n 2020-05-08  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.dwarf2/clang-debug-names.c: New test."
    },
    {
      "sha": "a6e33c1d8995090fb41511838d097ed73d88089f",
      "filename": "gdb/testsuite/gdb.dwarf2/clang-debug-names.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 12,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6dc55ce97db90a9e6f201d67ca05608e19287ba1/gdb/testsuite/gdb.dwarf2/clang-debug-names.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6dc55ce97db90a9e6f201d67ca05608e19287ba1/gdb/testsuite/gdb.dwarf2/clang-debug-names.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.dwarf2/clang-debug-names.exp?ref=6dc55ce97db90a9e6f201d67ca05608e19287ba1",
      "patch": "@@ -142,15 +142,4 @@ set pass_re \\\n     [multi_line \\\n \t $cmd \\\n \t \"type = int \\\\(\\\\)\"]\n-set kfail_re \\\n-    [multi_line \\\n-\t $cmd \\\n-\t \"type = <unknown return type> \\\\(\\\\)\"]\n-gdb_test_multiple $cmd \"\" {\n-    -re -wrap $pass_re {\n-\tpass $gdb_test_name\n-    }\n-    -re -wrap $kfail_re {\n-\tkfail symtab/25952 $gdb_test_name\n-    }\n-}\n+gdb_test $cmd $pass_re"
    }
  ]
}