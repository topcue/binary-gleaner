{
  "sha": "f67210ff1c4200ea668189d086c6b39145cd876f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjY3MjEwZmYxYzQyMDBlYTY2ODE4OWQwODZjNmIzOTE0NWNkODc2Zg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-03-20T13:30:13Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-03-20T14:31:17Z"
    },
    "message": "Avoid stringop-truncation errors\n\nI configured with -fsanitize=address and built gdb.  linux-tdep.c and\nada-tasks.c failed to build due to some stringop-truncation errors,\ne.g.:\n\nIn function \u2018char* strncpy(char*, const char*, size_t)\u2019,\n    inlined from \u2018int linux_fill_prpsinfo(elf_internal_linux_prpsinfo*)\u2019 at ../../binutils-gdb/gdb/linux-tdep.c:1742:11,\n    inlined from \u2018char* linux_make_corefile_notes(gdbarch*, bfd*, int*)\u2019 at ../../binutils-gdb/gdb/linux-tdep.c:1878:27:\n/usr/include/bits/string_fortified.h:106:34: error: \u2018char* __builtin_strncpy(char*, const char*, long unsigned int)\u2019 specified bound 81 equals destination size [-Werror=stringop-truncation]\n\nThis patch fixes the problem by using \"sizeof - 1\" in the call to\nstrndup, as recommended in the GCC manual.  This doesn't make a\ndifference here because the next line, in all cases, sets the final\nelement to '\\0' anyway.\n\ngdb/ChangeLog\n2020-03-20  Tom Tromey  <tromey@adacore.com>\n\n\t* ada-tasks.c (read_atcb): Use smaller length in strncpy call.\n\t* linux-tdep.c (linux_fill_prpsinfo): Use smaller length in\n\tstrncpy call.",
    "tree": {
      "sha": "8eade1f1e0acf3beb6782761f22b53223bd10bcc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8eade1f1e0acf3beb6782761f22b53223bd10bcc"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f67210ff1c4200ea668189d086c6b39145cd876f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f67210ff1c4200ea668189d086c6b39145cd876f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f67210ff1c4200ea668189d086c6b39145cd876f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f67210ff1c4200ea668189d086c6b39145cd876f/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1773be9ea2207d42442222e6dc3c8fdbe638e28e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1773be9ea2207d42442222e6dc3c8fdbe638e28e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1773be9ea2207d42442222e6dc3c8fdbe638e28e"
    }
  ],
  "stats": {
    "total": 13,
    "additions": 10,
    "deletions": 3
  },
  "files": [
    {
      "sha": "583ec9c81e32c9a5961c61796a9d4e8afa963889",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f67210ff1c4200ea668189d086c6b39145cd876f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f67210ff1c4200ea668189d086c6b39145cd876f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=f67210ff1c4200ea668189d086c6b39145cd876f",
      "patch": "@@ -1,3 +1,9 @@\n+2020-03-20  Tom Tromey  <tromey@adacore.com>\n+\n+\t* ada-tasks.c (read_atcb): Use smaller length in strncpy call.\n+\t* linux-tdep.c (linux_fill_prpsinfo): Use smaller length in\n+\tstrncpy call.\n+\n 2020-03-20  Tom Tromey  <tromey@adacore.com>\n \n \t* symmisc.c (maintenance_print_one_line_table): Use ui_out."
    },
    {
      "sha": "589d5e84e0a0f60905c94cf5825b5e1f16358e9c",
      "filename": "gdb/ada-tasks.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f67210ff1c4200ea668189d086c6b39145cd876f/gdb/ada-tasks.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f67210ff1c4200ea668189d086c6b39145cd876f/gdb/ada-tasks.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ada-tasks.c?ref=f67210ff1c4200ea668189d086c6b39145cd876f",
      "patch": "@@ -679,7 +679,8 @@ read_atcb (CORE_ADDR task_id, struct ada_task_info *task_info)\n \t\t  task_name = p + 2;\n \n \t      /* Copy the task name.  */\n-\t      strncpy (task_info->name, task_name, sizeof (task_info->name));\n+\t      strncpy (task_info->name, task_name,\n+\t\t       sizeof (task_info->name) - 1);\n \t      task_info->name[sizeof (task_info->name) - 1] = 0;\n \t    }\n \t  else"
    },
    {
      "sha": "e50946ce379af94793436572889631484c537e93",
      "filename": "gdb/linux-tdep.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f67210ff1c4200ea668189d086c6b39145cd876f/gdb/linux-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f67210ff1c4200ea668189d086c6b39145cd876f/gdb/linux-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/linux-tdep.c?ref=f67210ff1c4200ea668189d086c6b39145cd876f",
      "patch": "@@ -1729,7 +1729,7 @@ linux_fill_prpsinfo (struct elf_internal_linux_prpsinfo *p)\n \n   /* Copying the program name.  Only the basename matters.  */\n   basename = lbasename (fname.get ());\n-  strncpy (p->pr_fname, basename, sizeof (p->pr_fname));\n+  strncpy (p->pr_fname, basename, sizeof (p->pr_fname) - 1);\n   p->pr_fname[sizeof (p->pr_fname) - 1] = '\\0';\n \n   infargs = get_inferior_args ();\n@@ -1739,7 +1739,7 @@ linux_fill_prpsinfo (struct elf_internal_linux_prpsinfo *p)\n   if (infargs != NULL)\n     psargs = psargs + \" \" + infargs;\n \n-  strncpy (p->pr_psargs, psargs.c_str (), sizeof (p->pr_psargs));\n+  strncpy (p->pr_psargs, psargs.c_str (), sizeof (p->pr_psargs) - 1);\n   p->pr_psargs[sizeof (p->pr_psargs) - 1] = '\\0';\n \n   xsnprintf (filename, sizeof (filename), \"/proc/%d/stat\", (int) pid);"
    }
  ]
}