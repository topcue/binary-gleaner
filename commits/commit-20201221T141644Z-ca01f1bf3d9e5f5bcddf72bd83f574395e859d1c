{
  "sha": "ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2EwMWYxYmYzZDllNWY1YmNkZGY3MmJkODNmNTc0Mzk1ZTg1OWQxYw==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-12-21T14:16:28Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-12-21T14:16:44Z"
    },
    "message": "gdb/testsuite: use gdb_test in gdb.base/list.exp\n\nUse gdb_test instead of send_gdb + gdb_expect.  Use proc_with_prefix to\nhelp with name uniqueness.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.base/list.exp: Replace send_gdb + gdb_expect with\n\t  gdb_test.  Use proc_with_prefix.\n\nChange-Id: Ieee8fb2c80f596f60397fab7633773a7f8c8c879",
    "tree": {
      "sha": "fa7611a83a69acf0c1af2970472fc955b4b09546",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fa7611a83a69acf0c1af2970472fc955b4b09546"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0fe69a94d4c4793d7247442e0611e5d3b8f542f5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0fe69a94d4c4793d7247442e0611e5d3b8f542f5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0fe69a94d4c4793d7247442e0611e5d3b8f542f5"
    }
  ],
  "stats": {
    "total": 186,
    "additions": 35,
    "deletions": 151
  },
  "files": [
    {
      "sha": "3e08608edda8fefe2d1d2c8b8d5691d575e3f61e",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c",
      "patch": "@@ -1,3 +1,8 @@\n+2020-12-21  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* gdb.base/list.exp: Replace send_gdb + gdb_expect with\n+\t  gdb_test.  Use proc_with_prefix.\n+\n 2020-12-21  Markus Metzger  <markus.t.metzger@intel.com>\n \n \t* gdb.btrace/exception.exp: Build with nopie."
    },
    {
      "sha": "4be28e00f7878a713b0f399ed76ec6b8b6daf6d4",
      "filename": "gdb/testsuite/gdb.base/list.exp",
      "status": "modified",
      "additions": 30,
      "deletions": 151,
      "changes": 181,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c/gdb/testsuite/gdb.base/list.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c/gdb/testsuite/gdb.base/list.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/list.exp?ref=ca01f1bf3d9e5f5bcddf72bd83f574395e859d1c",
      "patch": "@@ -144,54 +144,18 @@ proc test_list_include_file {} {\n # Test \"list filename:number\" for C source file\n #\n \n-proc test_list_filename_and_number {} {\n-    global gdb_prompt\n-\n-    set testcnt 0\n-\n-    send_gdb \"list list0.c:1\\n\"\n-    gdb_expect {\n-\t-re \"1\\[ \\t\\]+#include \\\"list0.h\\\".*10\\[ \\t\\]+foo .x\\[+)\\]+;\\r\\n$gdb_prompt $\" {\n-\t    incr testcnt \n-\t}\n-\t-re \".*$gdb_prompt $\" { fail \"list list0.c:1\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list0.c:1 (timeout)\" ; gdb_suppress_tests }\n-    }\n-    send_gdb \"list list0.c:10\\n\"\n-    gdb_expect {\n-\t-re \"5\\[ \\t\\]+int x;.*14\\[ \\t\\]+foo .x\\[+)\\]+;\\r\\n$gdb_prompt $\" {\n-\t    incr testcnt \n-\t}\n-\t-re \".*$gdb_prompt $\" { fail \"list list.c:10\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list.c:10 (timeout)\" ; gdb_suppress_tests }\n-    }\n-    send_gdb \"list list1.c:1\\n\"\n-    gdb_expect {\n-\t-re \"1\\[ \\t\\]+\\#include.*4\\[ \\t\\]+.*int oof\\[ \\t\\]*\\(.*\\);\\r\\n.*$gdb_prompt $\" {\n-\t    incr testcnt \n-\t}\n-\t-re \".*$gdb_prompt $\" { fail \"list list1.c:1\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list1.c:1 (timeout)\" ; gdb_suppress_tests }\n-    }\n-    send_gdb \"list list1.c:12\\n\"\n-    gdb_expect {\n-\t-re \"12\\[ \\t\\]+long_line \\[(\\]+.*\\[)\\]+;.*13\\[ \\t\\]+\\}\\r\\n.*$gdb_prompt $\" {\n-\t    incr testcnt \n-\t}\n-\t-re \".*$gdb_prompt $\" { fail \"list list1.c:12\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list1.c:12 (timeout)\" ; gdb_suppress_tests }\n-    }\n-    pass \"list filename:number ($testcnt tests)\"\n-    gdb_stop_suppressing_tests\n+proc_with_prefix test_list_filename_and_number {} {\n+    gdb_test \"list list0.c:1\" \"1\\[ \\t\\]+#include \\\"list0.h\\\".*10\\[ \\t\\]+foo .x\\[+)\\]+;\"\n+    gdb_test \"list list0.c:10\" \"5\\[ \\t\\]+int x;.*14\\[ \\t\\]+foo .x\\[+)\\]+;\"\n+    gdb_test \"list list1.c:1\" \"1\\[ \\t\\]+\\#include.*4\\[ \\t\\]+.*int oof\\[ \\t\\]*\\(.*\\);\\r\\n.*\"\n+    gdb_test \"list list1.c:12\" \"12\\[ \\t\\]+long_line \\[(\\]+.*\\[)\\]+;.*13\\[ \\t\\]+\\}\\r\\n.*\"\n }\n \n #\n # Test \"list function\" for C source file\n #\n \n-proc test_list_function {} {\n-    global gdb_prompt\n-\n+proc_with_prefix test_list_function {} {\n     # gcc appears to generate incorrect debugging information for code\n     # in include files, which breaks this test.\n     # SunPRO cc is the second case below, it's also correct.\n@@ -207,134 +171,49 @@ proc test_list_function {} {\n     gdb_test \"list -q foo\" \"(3\\[ \\t\\]+.*12\\[ \\t\\]+bar \\[(\\]+.*\\[)\\]+;|2\\[ \\t\\]+including file.*11\\[ \\t\\]+bar \\[(\\]+.*\\[)\\]+;|1\\[ \\t\\]+/. An include file.*10\\[ \\t\\]+bar \\[(\\]+.*\\[)\\]+;)\" \"list function in include file\"\n }\n \n-proc test_list_forward {} {\n-    global gdb_prompt\n+proc_with_prefix test_list_forward {} {\n     global last_line_re\n \n-    set testcnt 0\n-\n-    send_gdb \"list list0.c:10\\n\"\n-    gdb_expect {\n-\t-re \"5\\[ \\t\\]+int x;.*14\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list list0.c:10\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list0.c:10 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"list\\n\"\n-    gdb_expect {\n-\t-re \"15\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*24\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 15-24\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 15-24 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"list\\n\"\n-    gdb_expect {\n-\t-re \"25\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*34\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 25-34\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 25-34 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"list\\n\"\n-    gdb_expect {\n-\t-re \"35\\[ \\t\\]+foo \\\\(.*\\\\);.*${last_line_re}\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 35-42\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 35-42 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    pass \"successive list commands to page forward ($testcnt tests)\"\n-\n+    gdb_test \"list list0.c:10\" \"5\\[ \\t\\]+int x;.*14\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\"\n+    gdb_test \"list\" \"15\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*24\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\" \\\n+\t\"list 15-24\"\n+    gdb_test \"list\" \"25\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*34\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\" \\\n+\t\"list 25-34\"\n+    gdb_test \"list\" \"35\\[ \\t\\]+foo \\\\(.*\\\\);.*${last_line_re}\" \\\n+\t\"list 35-42\"\n     gdb_test \"list\" \"Line number 44 out of range; \\[^\\r\\n\\]+ has 43 lines\\.\" \\\n \t\"end of file error after \\\"list\\\" command\"\n-\n-    gdb_stop_suppressing_tests\n }\n \n # Test that repeating the list linenum command doesn't print the same\n # lines over again.  Note that this test makes sure that the argument\n # linenum is dropped, when we repeat the previous command. 'x/5i $pc'\n # works the same way.  \n \n-proc test_repeat_list_command {} {\n-    global gdb_prompt\n+proc_with_prefix test_repeat_list_command {} {\n     global last_line_re\n \n-    set testcnt 0\n-\n-    send_gdb \"list list0.c:10\\n\"\n-    gdb_expect {\n-\t-re \"5\\[ \\t\\]+int x;.*14\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list list0.c:10\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list0.c:10 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"\\n\"\n-    gdb_expect {\n-\t-re \"15\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*24\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 15-24\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 15-24 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"\\n\"\n-    gdb_expect {\n-\t-re \"25\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*34\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 25-34\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 25-34 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"\\n\"\n-    gdb_expect {\n-\t-re \"35\\[ \\t\\]+foo \\\\(.*\\\\);.*${last_line_re}\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 35-42\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 35-42 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    pass \"repeat list commands to page forward using 'return' ($testcnt tests)\"\n-\n+    gdb_test \"list list0.c:10\" \"5\\[ \\t\\]+int x;.*14\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\"\n+    gdb_test \" \" \"15\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*24\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\" \\\n+\t\"list 15-24\"\n+    gdb_test \" \" \"25\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*34\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\" \\\n+\t\"list 25-34\"\n+    gdb_test \" \" \"35\\[ \\t\\]+foo \\\\(.*\\\\);.*${last_line_re}\" \\\n+\t\"list 35-42\"\n     gdb_test \"list\" \"Line number 44 out of range; \\[^\\r\\n\\]+ has 43 lines\\.\" \\\n \t\"end of file error after using 'return' to repeat the list command\"\n-\n-    gdb_stop_suppressing_tests\n }\n \n-proc test_list_backwards {} {\n-    global gdb_prompt\n-\n-    set testcnt 0\n-\n-    send_gdb \"list list0.c:33\\n\"\n-    gdb_expect {\n-\t-re \"28\\[ \\t\\]+foo \\\\(.*\\\\);.*37\\[ \\t\\]+\\}\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list list0.c:33\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list list0.c:33 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"list -\\n\"\n-    gdb_expect {\n-\t-re \"18\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*27\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 18-27\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 18-27 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"list -\\n\"\n-    gdb_expect {\n-\t-re \"8\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*17\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 8-17\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 8-17 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    send_gdb \"list -\\n\"\n-    gdb_expect {\n-\t-re \"1\\[ \\t\\]+#include .*7\\[ \\t\\]+x = 0;\\r\\n$gdb_prompt $\" { incr testcnt }\n-\t-re \".*$gdb_prompt $\" { fail \"list 1-7\" ; gdb_suppress_tests }\n-\ttimeout { fail \"list 1-7 (timeout)\" ; gdb_suppress_tests }\n-    }\n-\n-    pass \"$testcnt successive \\\"list -\\\" commands to page backwards\"\n-\n+proc_with_prefix test_list_backwards {} {\n+    gdb_test \"list list0.c:33\" \"28\\[ \\t\\]+foo \\\\(.*\\\\);.*37\\[ \\t\\]+\\}\"\n+    gdb_test \"list -\" \"18\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*27\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\" \\\n+\t\"list 18-27\"\n+    gdb_test \"list -\" \"8\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;.*17\\[ \\t\\]+foo \\[(\\]+.*\\[)\\]+;\" \\\n+\t\"list 8-17\"\n+    gdb_test \"list -\" \"1\\[ \\t\\]+#include .*7\\[ \\t\\]+x = 0;\" \\\n+\t\"list 1-7\"\n     gdb_test \"list -\" \"Already at the start of .*\\.\" \\\n \t\"beginning of file error after \\\"list -\\\" command\"\n-\n-    gdb_stop_suppressing_tests\n }\n \n #"
    }
  ]
}