{
  "sha": "2cc83d1e0eeaad9927553ee157f810e43d47d24f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmNjODNkMWUwZWVhYWQ5OTI3NTUzZWUxNTdmODEwZTQzZDQ3ZDI0Zg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-01-23T18:58:33Z"
    },
    "committer": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2019-01-23T19:06:11Z"
    },
    "message": "Remove cleanup_delete_std_terminate_breakpoint\n\nThis removes cleanup_delete_std_terminate_breakpoint, replacing it\nwith a use of SCOPE_EXIT.\n\ngdb/ChangeLog:\n2019-01-23  Tom Tromey  <tom@tromey.com>\n\t    Pedro Alves  <palves@redhat.com>\n\n\t* infcall.c (cleanup_delete_std_terminate_breakpoint): Remove.\n\t(call_function_by_hand_dummy): Use SCOPE_EXIT.",
    "tree": {
      "sha": "f2fc177c3d2f11e1f17ea1733364d2601037ee69",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f2fc177c3d2f11e1f17ea1733364d2601037ee69"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2cc83d1e0eeaad9927553ee157f810e43d47d24f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2cc83d1e0eeaad9927553ee157f810e43d47d24f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2cc83d1e0eeaad9927553ee157f810e43d47d24f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2cc83d1e0eeaad9927553ee157f810e43d47d24f/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "694c6bf5425024a8654a5541dec88e4dd6ddafb5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/694c6bf5425024a8654a5541dec88e4dd6ddafb5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/694c6bf5425024a8654a5541dec88e4dd6ddafb5"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 8,
    "deletions": 11
  },
  "files": [
    {
      "sha": "21b72e3bcba827578cfb4183ace83d758b31da70",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2cc83d1e0eeaad9927553ee157f810e43d47d24f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2cc83d1e0eeaad9927553ee157f810e43d47d24f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=2cc83d1e0eeaad9927553ee157f810e43d47d24f",
      "patch": "@@ -1,3 +1,9 @@\n+2019-01-23  Tom Tromey  <tom@tromey.com>\n+\t    Pedro Alves  <palves@redhat.com>\n+\n+\t* infcall.c (cleanup_delete_std_terminate_breakpoint): Remove.\n+\t(call_function_by_hand_dummy): Use SCOPE_EXIT.\n+\n 2019-01-23  Tom Tromey  <tom@tromey.com>\n \t    Andrew Burgess  <andrew.burgess@embecosm.com>\n \t    Pedro Alves  <palves@redhat.com>"
    },
    {
      "sha": "6ca479ac1fc90384e1b67d239391099988b4d314",
      "filename": "gdb/infcall.c",
      "status": "modified",
      "additions": 2,
      "deletions": 11,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2cc83d1e0eeaad9927553ee157f810e43d47d24f/gdb/infcall.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2cc83d1e0eeaad9927553ee157f810e43d47d24f/gdb/infcall.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/infcall.c?ref=2cc83d1e0eeaad9927553ee157f810e43d47d24f",
      "patch": "@@ -40,6 +40,7 @@\n #include \"interps.h\"\n #include \"thread-fsm.h\"\n #include <algorithm>\n+#include \"common/scope-exit.h\"\n \n /* If we can't find a function's name from its address,\n    we print this instead.  */\n@@ -675,13 +676,6 @@ run_inferior_call (struct call_thread_fsm *sm,\n   return caught_error;\n }\n \n-/* A cleanup function that calls delete_std_terminate_breakpoint.  */\n-static void\n-cleanup_delete_std_terminate_breakpoint (void *ignore)\n-{\n-  delete_std_terminate_breakpoint ();\n-}\n-\n /* See infcall.h.  */\n \n struct value *\n@@ -727,7 +721,6 @@ call_function_by_hand_dummy (struct value *function,\n   struct frame_id dummy_id;\n   struct frame_info *frame;\n   struct gdbarch *gdbarch;\n-  struct cleanup *terminate_bp_cleanup;\n   ptid_t call_thread_ptid;\n   struct gdb_exception e;\n   char name_buf[RAW_FUNCTION_ADDRESS_SIZE];\n@@ -1122,8 +1115,7 @@ call_function_by_hand_dummy (struct value *function,\n \t\t\t       dummy_dtor, dummy_dtor_data);\n \n   /* Register a clean-up for unwind_on_terminating_exception_breakpoint.  */\n-  terminate_bp_cleanup = make_cleanup (cleanup_delete_std_terminate_breakpoint,\n-\t\t\t\t       NULL);\n+  SCOPE_EXIT { delete_std_terminate_breakpoint (); };\n \n   /* - SNIP - SNIP - SNIP - SNIP - SNIP - SNIP - SNIP - SNIP - SNIP -\n      If you're looking to implement asynchronous dummy-frames, then\n@@ -1184,7 +1176,6 @@ call_function_by_hand_dummy (struct value *function,\n \n \t    maybe_remove_breakpoints ();\n \n-\t    do_cleanups (terminate_bp_cleanup);\n \t    gdb_assert (retval != NULL);\n \t    return retval;\n \t  }"
    }
  ]
}