{
  "sha": "591732169550b26608f186c9927f4cf9a47d99d5",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTkxNzMyMTY5NTUwYjI2NjA4ZjE4NmM5OTI3ZjRjZjlhNDdkOTlkNQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-05-17T18:55:18Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-05-17T19:06:05Z"
    },
    "message": "Fix ubsan build\n\nI tried a build using the undefined behavior sanitizer, and gcc gave\nthis error:\n\nIn file included from /usr/include/string.h:495,\n                 from ../gnulib/import/string.h:41,\n                 from ../../binutils-gdb/gdb/../gdbsupport/common-defs.h:95,\n                 from ../../binutils-gdb/gdb/nat/linux-osdata.c:20:\nIn function 'char* strncpy(char*, const char*, size_t)',\n    inlined from 'void time_from_time_t(char*, int, TIME_T)' at ../../binutils-gdb/gdb/nat/linux-osdata.c:923:15,\n    inlined from 'void time_from_time_t(char*, int, TIME_T)' at ../../binutils-gdb/gdb/nat/linux-osdata.c:911:1,\n    inlined from 'void linux_xfer_osdata_sem(buffer*)' at ../../binutils-gdb/gdb/nat/linux-osdata.c:1082:22:\n/usr/include/bits/string_fortified.h:106:34: error: 'char* __builtin_strncpy(char*, const char*, long unsigned int)' specified bound 32 equals destination size [-Werror=stringop-truncation]\n\nThis patch fixes the problem by subtracting one from the length\nparameter to strncpy.\n\nI changed a couple of other similar functions -- gcc does not warn\nabout these, but I didn't see any substantial difference between the\ndifferent cases, and I think these are just latent warnings, to be\ntriggered in the future by a change to inlining heuristics.\n\ngdb/ChangeLog\n2021-05-17  Tom Tromey  <tromey@adacore.com>\n\n\t* nat/linux-osdata.c (user_from_uid, time_from_time_t)\n\t(group_from_gid): Subtract one from strncpy length.",
    "tree": {
      "sha": "62cb2535ab510fa1d484933b042fe871dde85130",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/62cb2535ab510fa1d484933b042fe871dde85130"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/591732169550b26608f186c9927f4cf9a47d99d5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/591732169550b26608f186c9927f4cf9a47d99d5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/591732169550b26608f186c9927f4cf9a47d99d5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/591732169550b26608f186c9927f4cf9a47d99d5/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "baea2f9d52d606f6b58a736420017c98351f5b5c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/baea2f9d52d606f6b58a736420017c98351f5b5c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/baea2f9d52d606f6b58a736420017c98351f5b5c"
    }
  ],
  "stats": {
    "total": 11,
    "additions": 8,
    "deletions": 3
  },
  "files": [
    {
      "sha": "39cdb3a50ef8e3b0f09e42f4c3790f54462e2198",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/591732169550b26608f186c9927f4cf9a47d99d5/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/591732169550b26608f186c9927f4cf9a47d99d5/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=591732169550b26608f186c9927f4cf9a47d99d5",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-17  Tom Tromey  <tromey@adacore.com>\n+\n+\t* nat/linux-osdata.c (user_from_uid, time_from_time_t)\n+\t(group_from_gid): Subtract one from strncpy length.\n+\n 2021-05-17  Tom Tromey  <tromey@adacore.com>\n \n \t* source.c (add_path): Check 'p' before using 'p[-1]'."
    },
    {
      "sha": "12f66d3c981605b05114f37c154fa9e2427ad375",
      "filename": "gdb/nat/linux-osdata.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/591732169550b26608f186c9927f4cf9a47d99d5/gdb/nat/linux-osdata.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/591732169550b26608f186c9927f4cf9a47d99d5/gdb/nat/linux-osdata.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/linux-osdata.c?ref=591732169550b26608f186c9927f4cf9a47d99d5",
      "patch": "@@ -212,7 +212,7 @@ user_from_uid (char *user, int maxlen, uid_t uid)\n \n   if (pwentry)\n     {\n-      strncpy (user, pwentry->pw_name, maxlen);\n+      strncpy (user, pwentry->pw_name, maxlen - 1);\n       /* Ensure that the user name is null-terminated.  */\n       user[maxlen - 1] = '\\0';\n     }\n@@ -920,7 +920,7 @@ time_from_time_t (char *time, int maxlen, TIME_T seconds)\n \t characters long.  */\n       char buf[30];\n       const char *time_str = ctime_r (&t, buf);\n-      strncpy (time, time_str, maxlen);\n+      strncpy (time, time_str, maxlen - 1);\n       time[maxlen - 1] = '\\0';\n     }\n }\n@@ -935,7 +935,7 @@ group_from_gid (char *group, int maxlen, gid_t gid)\n \n   if (grentry)\n     {\n-      strncpy (group, grentry->gr_name, maxlen);\n+      strncpy (group, grentry->gr_name, maxlen - 1);\n       /* Ensure that the group name is null-terminated.  */\n       group[maxlen - 1] = '\\0';\n     }"
    }
  ]
}