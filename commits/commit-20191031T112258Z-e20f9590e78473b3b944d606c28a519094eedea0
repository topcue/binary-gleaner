{
  "sha": "e20f9590e78473b3b944d606c28a519094eedea0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTIwZjk1OTBlNzg0NzNiM2I5NDRkNjA2YzI4YTUxOTA5NGVlZGVhMA==",
  "commit": {
    "author": {
      "name": "Mihail Ionescu",
      "email": "mihail.ionescu@arm.com",
      "date": "2019-10-31T11:22:58Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2019-10-31T11:22:58Z"
    },
    "message": "Add support for context sensitive '.arch_extension' to the ARM assembler.\n\nIf the extension is not found in the context sensitive table, the legacy\ntables are still checked as a fallback.  This is particularly useful for\nArmv8.1-M as it enables  the use of '.arch_extension' with the 'mve' and\n'mve.fp' extensions which are not part of the legacy table.\n\n\t* config/tc-arm.c (selected_ctx_ext_table) New static variable.\n\t(arm_parse_arch): Set context sensitive extension table based on the\n\tchosen base architecture.\n\t(s_arm_arch_extension): Change to lookup extensions in the new context\n\tsensitive tables.\n\t* gas/testsuite/gas/arm/mve-ext.s: New.\n\t* gas/testsuite/gas/arm/mve-ext.d: New.\n\t* gas/testsuite/gas/arm/mvefp-ext.s: New.\n\t* gas/testsuite/gas/arm/mvefp-ext.d: New.",
    "tree": {
      "sha": "8fea0061965fd8f3fd6f4f547e9a5f66a32e8606",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8fea0061965fd8f3fd6f4f547e9a5f66a32e8606"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e20f9590e78473b3b944d606c28a519094eedea0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e20f9590e78473b3b944d606c28a519094eedea0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e20f9590e78473b3b944d606c28a519094eedea0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e20f9590e78473b3b944d606c28a519094eedea0/comments",
  "author": null,
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c7e49b689b01e54020a945214e75d4d3f8b6a226",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c7e49b689b01e54020a945214e75d4d3f8b6a226",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c7e49b689b01e54020a945214e75d4d3f8b6a226"
    }
  ],
  "stats": {
    "total": 68,
    "additions": 68,
    "deletions": 0
  },
  "files": [
    {
      "sha": "25a504b37489576891a3a0db9755c856a3678985",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e20f9590e78473b3b944d606c28a519094eedea0/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e20f9590e78473b3b944d606c28a519094eedea0/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=e20f9590e78473b3b944d606c28a519094eedea0",
      "patch": "@@ -1,3 +1,15 @@\n+2019-10-31  Mihail Ionescu  <mihail.ionescu@arm.com>\n+\n+\t* config/tc-arm.c (selected_ctx_ext_table) New static variable.\n+\t(arm_parse_arch): Set context sensitive extension table based on the\n+\tchosen base architecture.\n+\t(s_arm_arch_extension): Change to lookup extensions in the new context\n+\tsensitive tables.\n+\t* gas/testsuite/gas/arm/mve-ext.s: New.\n+\t* gas/testsuite/gas/arm/mve-ext.d: New.\n+\t* gas/testsuite/gas/arm/mvefp-ext.s: New.\n+\t* gas/testsuite/gas/arm/mvefp-ext.d: New.\n+\n 2019-10-30  Delia Burduv  <Delia.Burduv@arm.com>\n \n \t* config/tc-aarch64.c (parse_address_main): Accept the omission of"
    },
    {
      "sha": "0a3e77a1ecd666801ec595abb6723ff15185d6e5",
      "filename": "gas/config/tc-arm.c",
      "status": "modified",
      "additions": 31,
      "deletions": 0,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e20f9590e78473b3b944d606c28a519094eedea0/gas/config/tc-arm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e20f9590e78473b3b944d606c28a519094eedea0/gas/config/tc-arm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-arm.c?ref=e20f9590e78473b3b944d606c28a519094eedea0",
      "patch": "@@ -355,6 +355,7 @@ static arm_feature_set selected_fpu = FPU_NONE;\n /* Feature bits selected by the last .object_arch directive.  */\n static arm_feature_set selected_object_arch = ARM_ARCH_NONE;\n /* Must be long enough to hold any of the names in arm_cpus.  */\n+static const struct arm_ext_table * selected_ctx_ext_table = NULL;\n static char selected_cpu_name[20];\n \n extern FLONUM_TYPE generic_floating_point_number;\n@@ -31502,6 +31503,7 @@ arm_parse_arch (const char *str)\n \t  march_ext_opt = XNEW (arm_feature_set);\n \t*march_ext_opt = arm_arch_none;\n \tmarch_fpu_opt = &opt->default_fpu;\n+\tselected_ctx_ext_table = opt->ext_table;\n \tstrcpy (selected_cpu_name, opt->name);\n \n \tif (ext != NULL)\n@@ -32361,6 +32363,35 @@ s_arm_arch_extension (int ignored ATTRIBUTE_UNUSED)\n       name += 2;\n     }\n \n+  /* Check the context specific extension table */\n+  if (selected_ctx_ext_table)\n+    {\n+      const struct arm_ext_table * ext_opt;\n+      for (ext_opt = selected_ctx_ext_table; ext_opt->name != NULL; ext_opt++)\n+        {\n+          if (streq (ext_opt->name, name))\n+\t    {\n+\t      if (adding_value)\n+\t\t{\n+\t\t  if (ARM_FEATURE_ZERO (ext_opt->merge))\n+\t\t    /* TODO: Option not supported.  When we remove the\n+\t\t    legacy table this case should error out.  */\n+\t\t    continue;\n+\t\t  ARM_MERGE_FEATURE_SETS (selected_ext, selected_ext,\n+\t\t\t\t\t  ext_opt->merge);\n+\t\t}\n+\t      else\n+\t\tARM_CLEAR_FEATURE (selected_ext, selected_ext, ext_opt->clear);\n+\n+\t      ARM_MERGE_FEATURE_SETS (selected_cpu, selected_arch, selected_ext);\n+\t      ARM_MERGE_FEATURE_SETS (cpu_variant, selected_cpu, selected_fpu);\n+\t      *input_line_pointer = saved_char;\n+\t      demand_empty_rest_of_line ();\n+\t      return;\n+\t    }\n+\t}\n+    }\n+\n   for (opt = arm_extensions; opt->name != NULL; opt++)\n     if (streq (opt->name, name))\n       {"
    },
    {
      "sha": "3529231bcf46ad0c9f2f0b950fabbb012e5f0617",
      "filename": "gas/testsuite/gas/arm/mve-ext.d",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mve-ext.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mve-ext.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/mve-ext.d?ref=e20f9590e78473b3b944d606c28a519094eedea0",
      "patch": "@@ -0,0 +1,8 @@\n+# name: MVE context sensitive .arch_extension\n+# as: -march=armv8.1-m.main\n+# objdump: -dr --prefix-addresses --show-raw-insn -marmv8.1-m.main\n+\n+.*: +file format .*arm.*\n+\n+Disassembly of section .text:\n+0[0-9a-f]+ <[^>]+> ea52 136f \tasrl\tr2, r3, #5"
    },
    {
      "sha": "8d4c7c68e59a5de6f2820e0cd91d0da3873a3f17",
      "filename": "gas/testsuite/gas/arm/mve-ext.s",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mve-ext.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mve-ext.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/mve-ext.s?ref=e20f9590e78473b3b944d606c28a519094eedea0",
      "patch": "@@ -0,0 +1,4 @@\n+.syntax unified\n+.arch_extension mve\n+\n+asrl\tr2, r3, #5"
    },
    {
      "sha": "530a73561e05f5e81e18cf6073aacc98436e1df9",
      "filename": "gas/testsuite/gas/arm/mvefp-ext.d",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mvefp-ext.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mvefp-ext.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/mvefp-ext.d?ref=e20f9590e78473b3b944d606c28a519094eedea0",
      "patch": "@@ -0,0 +1,8 @@\n+# name: MVE fp context sensitive .arch_extension\n+# as: -march=armv8.1-m.main\n+# objdump: -dr --prefix-addresses --show-raw-insn -marmv8.1-m.main\n+\n+.*: +file format .*arm.*\n+\n+Disassembly of section .text:\n+[^>]*> eea1 0fc0 \tvshlc\tq0, r0, #1"
    },
    {
      "sha": "28c5f94ea807be0c899e2a70770aeec7582bb9be",
      "filename": "gas/testsuite/gas/arm/mvefp-ext.s",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mvefp-ext.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e20f9590e78473b3b944d606c28a519094eedea0/gas/testsuite/gas/arm/mvefp-ext.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/mvefp-ext.s?ref=e20f9590e78473b3b944d606c28a519094eedea0",
      "patch": "@@ -0,0 +1,5 @@\n+.syntax unified\n+.thumb\n+.arch_extension mve.fp\n+\n+vshlc q0, r0, #1"
    }
  ]
}