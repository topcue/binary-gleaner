{
  "sha": "db77748be8aaa4926946d75b74947fff3775edcf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGI3Nzc0OGJlOGFhYTQ5MjY5NDZkNzViNzQ5NDdmZmYzNzc1ZWRjZg==",
  "commit": {
    "author": {
      "name": "Felix Willgerodt",
      "email": "felix.willgerodt@intel.com",
      "date": "2021-05-06T12:14:07Z"
    },
    "committer": {
      "name": "Felix Willgerodt",
      "email": "felix.willgerodt@intel.com",
      "date": "2021-06-11T15:16:46Z"
    },
    "message": "gdb, testsuite: Fix mi-var-child-f.exp for Intel compilers.\n\nmi-var-child-f.exp uses array.f as the inferior, which uses an unnamed\nmain function.  This causes false positive fails for Intel compilers, as\nthey emit the following DWARF:\n\n~~~\n0x0000002a:   DW_TAG_subprogram\n                DW_AT_low_pc    (0x0000000000404800)\n                DW_AT_high_pc   (0x000000000040484c)\n                DW_AT_frame_base        (DW_OP_reg6 RBP)\n                DW_AT_linkage_name      (\"MAIN__\")\n                DW_AT_name      (\"_unnamed_main$$\")\n                DW_AT_decl_file (\"array.f\")\n                DW_AT_decl_line (16)\n                DW_AT_external  (true)\n                DW_AT_main_subprogram   (true)\n~~~\n\nThe testsuite for fortran uses test_compiler_info to determine a hardcoded\nstring which is used to run to main and as a testing regex:\n\n~~~\nproc fortran_main {} {\n    if {[test_compiler_info {gcc-4-[012]-*}]\n         || [test_compiler_info {gcc-*}]\n         || [test_compiler_info {icc-*}] {\n\treturn \"MAIN__\"\n    } elseif {[test_compiler_info {clang-*}]} {\n\treturn \"MAIN_\"\n    } else {\n\treturn \"unknown\"\n    }\n}\n~~~\n\nGDB however uses DW_AT_name mostly in its output, which fails the regex.\nTo fix this testcase immediately, I modernized array.f and gave it a named\nmain.  There was no specific reason it was unnamed anyway.  Fixing\nthe testsuite properly is not straightforward.  fortran_main and\ntest_compiler_info would need some changes, which has broader influences.\nI might look at this later down the road.\n\ngdb/testsuite/ChangeLog:\n2021-06-11  Felix Willgerodt  <felix.willgerodt@intel.com>\n\n\t* gdb.mi/array.f: Convert into...\n\t* gdb.mi/array.f90: ...this.\n\t* gdb.mi/mi-var-child-f.exp: Use array.f90.",
    "tree": {
      "sha": "88f4bee44d6bd75fe208c684dd33398c63a7a1e1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/88f4bee44d6bd75fe208c684dd33398c63a7a1e1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/db77748be8aaa4926946d75b74947fff3775edcf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/db77748be8aaa4926946d75b74947fff3775edcf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/db77748be8aaa4926946d75b74947fff3775edcf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/db77748be8aaa4926946d75b74947fff3775edcf/comments",
  "author": {
    "login": "felix-willgerodt",
    "id": 68062808,
    "node_id": "MDQ6VXNlcjY4MDYyODA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/68062808?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/felix-willgerodt",
    "html_url": "https://github.com/felix-willgerodt",
    "followers_url": "https://api.github.com/users/felix-willgerodt/followers",
    "following_url": "https://api.github.com/users/felix-willgerodt/following{/other_user}",
    "gists_url": "https://api.github.com/users/felix-willgerodt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/felix-willgerodt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/felix-willgerodt/subscriptions",
    "organizations_url": "https://api.github.com/users/felix-willgerodt/orgs",
    "repos_url": "https://api.github.com/users/felix-willgerodt/repos",
    "events_url": "https://api.github.com/users/felix-willgerodt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/felix-willgerodt/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "felix-willgerodt",
    "id": 68062808,
    "node_id": "MDQ6VXNlcjY4MDYyODA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/68062808?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/felix-willgerodt",
    "html_url": "https://github.com/felix-willgerodt",
    "followers_url": "https://api.github.com/users/felix-willgerodt/followers",
    "following_url": "https://api.github.com/users/felix-willgerodt/following{/other_user}",
    "gists_url": "https://api.github.com/users/felix-willgerodt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/felix-willgerodt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/felix-willgerodt/subscriptions",
    "organizations_url": "https://api.github.com/users/felix-willgerodt/orgs",
    "repos_url": "https://api.github.com/users/felix-willgerodt/repos",
    "events_url": "https://api.github.com/users/felix-willgerodt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/felix-willgerodt/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "48ec4c05c68bfec4b79e95807bd82e0df4634a6c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/48ec4c05c68bfec4b79e95807bd82e0df4634a6c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/48ec4c05c68bfec4b79e95807bd82e0df4634a6c"
    }
  ],
  "stats": {
    "total": 51,
    "additions": 29,
    "deletions": 22
  },
  "files": [
    {
      "sha": "ba11a4d3d7f95ac2d15630902cde00024ec70e66",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db77748be8aaa4926946d75b74947fff3775edcf/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db77748be8aaa4926946d75b74947fff3775edcf/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=db77748be8aaa4926946d75b74947fff3775edcf",
      "patch": "@@ -1,3 +1,9 @@\n+2021-06-11  Felix Willgerodt  <felix.willgerodt@intel.com>\n+\n+\t* gdb.mi/array.f: Convert into...\n+\t* gdb.mi/array.f90: ...this.\n+\t* gdb.mi/mi-var-child-f.exp: Use array.f90.\n+\n 2021-06-11  Tom Tromey  <tom@tromey.com>\n \n \tPR rust/23427"
    },
    {
      "sha": "2d31ecae984ca146210243d21e670637b842e212",
      "filename": "gdb/testsuite/gdb.mi/array.f",
      "status": "removed",
      "additions": 0,
      "deletions": 20,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/48ec4c05c68bfec4b79e95807bd82e0df4634a6c/gdb/testsuite/gdb.mi/array.f",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/48ec4c05c68bfec4b79e95807bd82e0df4634a6c/gdb/testsuite/gdb.mi/array.f",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/array.f?ref=48ec4c05c68bfec4b79e95807bd82e0df4634a6c",
      "patch": "@@ -1,20 +0,0 @@\n-c Copyright 2006-2021 Free Software Foundation, Inc.\n-\n-c This program is free software; you can redistribute it and/or modify\n-c it under the terms of the GNU General Public License as published by\n-c the Free Software Foundation; either version 3 of the License, or\n-c (at your option) any later version.\n-c\n-c This program is distributed in the hope that it will be useful,\n-c but WITHOUT ANY WARRANTY; without even the implied warranty of\n-c MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n-c GNU General Public License for more details.\n-c\n-c You should have received a copy of the GNU General Public License\n-c along with this program.  If not, see <http://www.gnu.org/licenses/>.\n-\n-      INTEGER array(1:2,-1:1)\n-      DATA array/11,21,12,22,13,23/\n-      CONTINUE\n-      STOP\n-      END"
    },
    {
      "sha": "b414b27e02694a5f2b0fde767d52392587ce1523",
      "filename": "gdb/testsuite/gdb.mi/array.f90",
      "status": "added",
      "additions": 21,
      "deletions": 0,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db77748be8aaa4926946d75b74947fff3775edcf/gdb/testsuite/gdb.mi/array.f90",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db77748be8aaa4926946d75b74947fff3775edcf/gdb/testsuite/gdb.mi/array.f90",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/array.f90?ref=db77748be8aaa4926946d75b74947fff3775edcf",
      "patch": "@@ -0,0 +1,21 @@\n+! Copyright 2006-2021 Free Software Foundation, Inc.\n+\n+! This program is free software; you can redistribute it and/or modify\n+! it under the terms of the GNU General Public License as published by\n+! the Free Software Foundation; either version 3 of the License, or\n+! (at your option) any later version.\n+!\n+! This program is distributed in the hope that it will be useful,\n+! but WITHOUT ANY WARRANTY; without even the implied warranty of\n+! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+! GNU General Public License for more details.\n+!\n+! You should have received a copy of the GNU General Public License\n+! along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+program prog_array\n+  INTEGER array (1:2,-1:1)\n+  DATA array/11,21,12,22,13,23/\n+  CONTINUE\n+  STOP\n+end program prog_array"
    },
    {
      "sha": "f35c0cdd6d3848efbc63f38514a4cd82fce4fdce",
      "filename": "gdb/testsuite/gdb.mi/mi-var-child-f.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/db77748be8aaa4926946d75b74947fff3775edcf/gdb/testsuite/gdb.mi/mi-var-child-f.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/db77748be8aaa4926946d75b74947fff3775edcf/gdb/testsuite/gdb.mi/mi-var-child-f.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-var-child-f.exp?ref=db77748be8aaa4926946d75b74947fff3775edcf",
      "patch": "@@ -26,7 +26,7 @@ if [mi_gdb_start] {\n     continue\n }\n \n-standard_testfile array.f\n+standard_testfile array.f90\n \n if {[gdb_compile \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" \\\n \t executable {debug f90}] != \"\"} {\n@@ -36,7 +36,7 @@ if {[gdb_compile \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" \\\n mi_gdb_reinitialize_dir $srcdir/$subdir\n mi_gdb_load ${binfile}\n \n-mi_runto [fortran_main]\n+mi_runto prog_array\n \n mi_create_varobj \"array\" \"array\" \"create local variable array\"\n "
    }
  ]
}