{
  "sha": "c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzM2OTNhMWQ5NDY2YmM5ZDNhYmUwMDRlNjZmMWI1NmZlZDIyYmE2MQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-10-22T23:08:16Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-01-26T23:40:21Z"
    },
    "message": "Turn start_psymtab_common into a constructor\n\nThis turns start_psymtab_common into a constructor, and then changes\nthe callers to use \"new\" directly.  This completes the psymtab\nallocation transition -- now it is possible for symbol readers to\nsubclass struct partial_symtab.\n\ngdb/ChangeLog\n2020-01-26  Tom Tromey  <tom@tromey.com>\n\n\t* xcoffread.c (xcoff_start_psymtab): Use new.\n\t* psymtab.c (partial_symtab::partial_symtab): New constructor,\n\trenamed from start_psymtab_common.\n\t* psympriv.h (struct partial_symtab): Add new constructor.\n\t(start_psymtab_common): Don't declare.\n\t* mdebugread.c (parse_partial_symbols): Use new.\n\t* dwarf2read.c (create_partial_symtab): Use new.\n\t* dbxread.c (start_psymtab): Use new.\n\t* ctfread.c (create_partial_symtab): Use new.\n\nChange-Id: I5a0217bcb52bcfa442559771954bb66bd9ccbf02",
    "tree": {
      "sha": "8e9f5a9fda035595e06d889abd595b4e173af616",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8e9f5a9fda035595e06d889abd595b4e173af616"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "32caafd02b069c36908f41f53ae0cbca1911aaca",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32caafd02b069c36908f41f53ae0cbca1911aaca",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/32caafd02b069c36908f41f53ae0cbca1911aaca"
    }
  ],
  "stats": {
    "total": 68,
    "additions": 37,
    "deletions": 31
  },
  "files": [
    {
      "sha": "6353a00c151403cf5fe4436ca35c0016ed1fa945",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -1,3 +1,15 @@\n+2020-01-26  Tom Tromey  <tom@tromey.com>\n+\n+\t* xcoffread.c (xcoff_start_psymtab): Use new.\n+\t* psymtab.c (partial_symtab::partial_symtab): New constructor,\n+\trenamed from start_psymtab_common.\n+\t* psympriv.h (struct partial_symtab): Add new constructor.\n+\t(start_psymtab_common): Don't declare.\n+\t* mdebugread.c (parse_partial_symbols): Use new.\n+\t* dwarf2read.c (create_partial_symtab): Use new.\n+\t* dbxread.c (start_psymtab): Use new.\n+\t* ctfread.c (create_partial_symtab): Use new.\n+\n 2020-01-26  Tom Tromey  <tom@tromey.com>\n \n \t* xcoffread.c (xcoff_end_psymtab): Use new."
    },
    {
      "sha": "e3931fbd3e4ed58621ebb1a5f86d615a4b30d37f",
      "filename": "gdb/ctfread.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/ctfread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/ctfread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ctfread.c?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -1299,7 +1299,7 @@ create_partial_symtab (const char *name,\n   struct partial_symtab *pst;\n   struct ctf_context *ccx;\n \n-  pst = start_psymtab_common (objfile, name, 0);\n+  pst = new partial_symtab (name, objfile, 0);\n \n   ccx = XOBNEW (&objfile->objfile_obstack, struct ctf_context);\n   ccx->fp = cfp;"
    },
    {
      "sha": "4e388fae50eb6e730727ad22afad15ede8c99c1e",
      "filename": "gdb/dbxread.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/dbxread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/dbxread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dbxread.c?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -1903,8 +1903,8 @@ static struct partial_symtab *\n start_psymtab (struct objfile *objfile, const char *filename, CORE_ADDR textlow,\n \t       int ldsymoff)\n {\n-  struct partial_symtab *result =\n-    start_psymtab_common (objfile, filename, textlow);\n+  struct partial_symtab *result = new partial_symtab (filename, objfile,\n+\t\t\t\t\t\t      textlow);\n \n   result->read_symtab_private =\n     XOBNEW (&objfile->objfile_obstack, struct symloc);"
    },
    {
      "sha": "f865fa484826a0a204f4f2b427c7447be1e5e830",
      "filename": "gdb/dwarf2read.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/dwarf2read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/dwarf2read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.c?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -8027,7 +8027,7 @@ create_partial_symtab (struct dwarf2_per_cu_data *per_cu, const char *name)\n   struct objfile *objfile = per_cu->dwarf2_per_objfile->objfile;\n   struct partial_symtab *pst;\n \n-  pst = start_psymtab_common (objfile, name, 0);\n+  pst = new partial_symtab (name, objfile, 0);\n \n   pst->psymtabs_addrmap_supported = true;\n "
    },
    {
      "sha": "dafc7f4c9cd76b035e5426dc9584667f46f5f2b8",
      "filename": "gdb/mdebugread.c",
      "status": "modified",
      "additions": 1,
      "deletions": 3,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/mdebugread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/mdebugread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/mdebugread.c?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -2609,9 +2609,7 @@ parse_partial_symbols (minimal_symbol_reader &reader,\n \ttextlow = fh->adr;\n       else\n \ttextlow = 0;\n-      pst = start_psymtab_common (objfile,\n-\t\t\t\t  fdr_name (fh),\n-\t\t\t\t  textlow);\n+      pst = new partial_symtab (fdr_name (fh), objfile, textlow);\n       pst->read_symtab_private = XOBNEW (&objfile->objfile_obstack, symloc);\n       memset (pst->read_symtab_private, 0, sizeof (struct symloc));\n "
    },
    {
      "sha": "82ae1b5d2516e5fdc4e23e48da758f5d9d80af4c",
      "filename": "gdb/psympriv.h",
      "status": "modified",
      "additions": 8,
      "deletions": 3,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/psympriv.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/psympriv.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psympriv.h?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -113,6 +113,14 @@ struct partial_symtab\n   partial_symtab (const char *filename, struct objfile *objfile)\n     ATTRIBUTE_NONNULL (2) ATTRIBUTE_NONNULL (3);\n \n+  /* Like the above, but also sets the initial text low and text high\n+     from the ADDR argument, and sets the global- and\n+     static-offsets.  */\n+\n+  partial_symtab (const char *filename, struct objfile *objfile,\n+\t\t  CORE_ADDR addr)\n+    ATTRIBUTE_NONNULL (2) ATTRIBUTE_NONNULL (3);\n+\n   /* Return the raw low text address of this partial_symtab.  */\n   CORE_ADDR raw_text_low () const\n   {\n@@ -326,9 +334,6 @@ extern void add_psymbol_to_list (gdb::string_view name,\n \n extern void init_psymbol_list (struct objfile *objfile, int total_symbols);\n \n-extern struct partial_symtab *start_psymtab_common (struct objfile *,\n-\t\t\t\t\t\t    const char *, CORE_ADDR);\n-\n extern void end_psymtab_common (struct objfile *, struct partial_symtab *);\n \n static inline void"
    },
    {
      "sha": "b31461c3318097077c8d23b8e6819cd23021cf69",
      "filename": "gdb/psymtab.c",
      "status": "modified",
      "additions": 10,
      "deletions": 16,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/psymtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/psymtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psymtab.c?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -1475,24 +1475,18 @@ sort_pst_symbols (struct objfile *objfile, struct partial_symtab *pst)\n     });\n }\n \n-/* Allocate and partially fill a partial symtab.  It will be\n-   completely filled at the end of the symbol list.\n+/* Partially fill a partial symtab.  It will be completely filled at\n+   the end of the symbol list.  */\n \n-   FILENAME is the name of the symbol-file we are reading from.  */\n-\n-struct partial_symtab *\n-start_psymtab_common (struct objfile *objfile,\n-\t\t      const char *filename,\n-\t\t      CORE_ADDR textlow)\n+partial_symtab::partial_symtab (const char *filename,\n+\t\t\t\tstruct objfile *objfile,\n+\t\t\t\tCORE_ADDR textlow)\n+  : partial_symtab (filename, objfile)\n {\n-  struct partial_symtab *psymtab;\n-\n-  psymtab = new partial_symtab (filename, objfile);\n-  psymtab->set_text_low (textlow);\n-  psymtab->set_text_high (psymtab->raw_text_low ()); /* default */\n-  psymtab->globals_offset = objfile->partial_symtabs->global_psymbols.size ();\n-  psymtab->statics_offset = objfile->partial_symtabs->static_psymbols.size ();\n-  return psymtab;\n+  set_text_low (textlow);\n+  set_text_high (raw_text_low ()); /* default */\n+  globals_offset = objfile->partial_symtabs->global_psymbols.size ();\n+  statics_offset = objfile->partial_symtabs->static_psymbols.size ();\n }\n \n /* Perform \"finishing up\" operations of a partial symtab.  */"
    },
    {
      "sha": "901c13469fbef41db894ab337f4a41e877b5d972",
      "filename": "gdb/xcoffread.c",
      "status": "modified",
      "additions": 2,
      "deletions": 5,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/xcoffread.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3693a1d9466bc9d3abe004e66f1b56fed22ba61/gdb/xcoffread.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/xcoffread.c?ref=c3693a1d9466bc9d3abe004e66f1b56fed22ba61",
      "patch": "@@ -2007,11 +2007,8 @@ static struct partial_symtab *\n xcoff_start_psymtab (struct objfile *objfile,\n \t\t     const char *filename, int first_symnum)\n {\n-  struct partial_symtab *result =\n-    start_psymtab_common (objfile,\n-\t\t\t  filename,\n-\t\t\t  /* We fill in textlow later.  */\n-\t\t\t  0);\n+  /* We fill in textlow later.  */\n+  struct partial_symtab *result = new partial_symtab (filename, objfile, 0);\n \n   result->read_symtab_private =\n     XOBNEW (&objfile->objfile_obstack, struct symloc);"
    }
  ]
}