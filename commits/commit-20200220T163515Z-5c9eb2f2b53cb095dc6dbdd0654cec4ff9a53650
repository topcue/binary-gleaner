{
  "sha": "5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWM5ZWIyZjJiNTNjYjA5NWRjNmRiZGQwNjU0Y2VjNGZmOWE1MzY1MA==",
  "commit": {
    "author": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-02-17T15:12:00Z"
    },
    "committer": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-02-20T16:35:15Z"
    },
    "message": "gdbserver: turn target op 'stabilize_threads' into a method\n\ngdbserver/ChangeLog:\n2020-02-20  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n\n\tTurn process_stratum_target's stabilize_threads op into a\n\tmethod of process_target.\n\n\t* target.h (struct process_stratum_target): Remove the target op.\n\t(class process_target): Add the target op.\n\t(target_stabilize_threads): Update the macro.\n\t* target.cc (process_target::stabilize_threads): Define.\n\n\tUpdate the derived classes and callers below.\n\n\t* server.cc (handle_status): Update.\n\t* tracepoint.cc (cmd_qtdp): Update.\n\t(cmd_qtstart): Update.\n\t* linux-low.cc (linux_target_ops): Update.\n\t(linux_stabilize_threads): Turn into ...\n\t(linux_process_target::stabilize_threads): ... this.\n\t(linux_wait_1): Update.\n\t* linux-low.h (class linux_process_target): Update.\n\t* lynx-low.cc (lynx_target_ops): Update.\n\t* nto-low.cc (nto_target_ops): Update.\n\t* win32-low.cc (win32_target_ops): Update.",
    "tree": {
      "sha": "11c35a9e0642546185909669dd33439c608001f0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/11c35a9e0642546185909669dd33439c608001f0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/comments",
  "author": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "29e8dc09ff78e102ede0cdbb802cb771613bb8b1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/29e8dc09ff78e102ede0cdbb802cb771613bb8b1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/29e8dc09ff78e102ede0cdbb802cb771613bb8b1"
    }
  ],
  "stats": {
    "total": 64,
    "additions": 44,
    "deletions": 20
  },
  "files": [
    {
      "sha": "e15a43312cb9cedc607eda81a46b14b24957a170",
      "filename": "gdbserver/ChangeLog",
      "status": "modified",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/ChangeLog?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -1,3 +1,27 @@\n+2020-02-20  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n+\n+\tTurn process_stratum_target's stabilize_threads op into a\n+\tmethod of process_target.\n+\n+\t* target.h (struct process_stratum_target): Remove the target op.\n+\t(class process_target): Add the target op.\n+\t(target_stabilize_threads): Update the macro.\n+\t* target.cc (process_target::stabilize_threads): Define.\n+\n+\tUpdate the derived classes and callers below.\n+\n+\t* server.cc (handle_status): Update.\n+\t* tracepoint.cc (cmd_qtdp): Update.\n+\t(cmd_qtstart): Update.\n+\t* linux-low.cc (linux_target_ops): Update.\n+\t(linux_stabilize_threads): Turn into ...\n+\t(linux_process_target::stabilize_threads): ... this.\n+\t(linux_wait_1): Update.\n+\t* linux-low.h (class linux_process_target): Update.\n+\t* lynx-low.cc (lynx_target_ops): Update.\n+\t* nto-low.cc (nto_target_ops): Update.\n+\t* win32-low.cc (win32_target_ops): Update.\n+\n 2020-02-20  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n \n \tTurn process_stratum_target's pause_all and unpause_all ops"
    },
    {
      "sha": "1e516d6bc7097077b361591a1ad8594e3020f847",
      "filename": "gdbserver/linux-low.cc",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/linux-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/linux-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/linux-low.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -1628,7 +1628,7 @@ linux_process_target::detach (process_info *process)\n #endif\n \n   /* Stabilize threads (move out of jump pads).  */\n-  stabilize_threads ();\n+  target_stabilize_threads ();\n \n   /* Detach from the clone lwps first.  If the thread group exits just\n      while we're detaching, we must reap the clone lwps before we're\n@@ -2934,8 +2934,8 @@ static ptid_t linux_wait_1 (ptid_t ptid,\n    since for something else in the new run, the thread would now\n    execute the wrong / random instructions.  */\n \n-static void\n-linux_stabilize_threads (void)\n+void\n+linux_process_target::stabilize_threads ()\n {\n   thread_info *thread_stuck = find_thread (stuck_in_jump_pad_callback);\n \n@@ -3721,7 +3721,7 @@ linux_wait_1 (ptid_t ptid,\n \n       /* Stabilize threads (move out of jump pads).  */\n       if (!non_stop)\n-\tstabilize_threads ();\n+\ttarget_stabilize_threads ();\n     }\n   else\n     {\n@@ -7455,7 +7455,6 @@ linux_get_hwcap2 (int wordsize)\n static linux_process_target the_linux_target;\n \n static process_stratum_target linux_target_ops = {\n-  linux_stabilize_threads,\n   linux_install_fast_tracepoint_jump_pad,\n   linux_emit_ops,\n   linux_supports_disable_randomization,"
    },
    {
      "sha": "d3866de03a27dceee9c740e7eb5721ba37ec9cd3",
      "filename": "gdbserver/linux-low.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/linux-low.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/linux-low.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/linux-low.h?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -400,6 +400,8 @@ class linux_process_target : public process_target\n   void pause_all (bool freeze) override;\n \n   void unpause_all (bool unfreeze) override;\n+\n+  void stabilize_threads () override;\n };\n \n #define get_thread_lwp(thr) ((struct lwp_info *) (thread_target_data (thr)))"
    },
    {
      "sha": "5ea50b4415daf632af0d2b252b415243b7fb0da8",
      "filename": "gdbserver/lynx-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/lynx-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/lynx-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/lynx-low.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -735,7 +735,6 @@ static lynx_process_target the_lynx_target;\n /* The LynxOS target_ops vector.  */\n \n static process_stratum_target lynx_target_ops = {\n-  NULL,  /* stabilize_threads */\n   NULL,  /* install_fast_tracepoint_jump_pad */\n   NULL,  /* emit_ops */\n   NULL,  /* supports_disable_randomization */"
    },
    {
      "sha": "ef7a70ad97ab734656dc3a63334c946de741c411",
      "filename": "gdbserver/nto-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/nto-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/nto-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/nto-low.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -947,7 +947,6 @@ nto_sw_breakpoint_from_kind (int kind, int *size)\n static nto_process_target the_nto_target;\n \n static process_stratum_target nto_target_ops = {\n-  NULL, /* stabilize_threads */\n   NULL, /* install_fast_tracepoint_jump_pad */\n   NULL, /* emit_ops */\n   NULL, /* supports_disable_randomization */"
    },
    {
      "sha": "448089fd47c454b2150c48894957d27c682d5270",
      "filename": "gdbserver/server.cc",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/server.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/server.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/server.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -3324,7 +3324,7 @@ handle_status (char *own_buf)\n       thread_info *thread = NULL;\n \n       target_pause_all (false);\n-      stabilize_threads ();\n+      target_stabilize_threads ();\n       gdb_wants_all_threads_stopped ();\n \n       /* We can only report one status, but we might be coming out of"
    },
    {
      "sha": "42f22846d026789b63792f9e6b419245ac01e91b",
      "filename": "gdbserver/target.cc",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/target.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/target.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/target.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -662,3 +662,9 @@ process_target::unpause_all (bool unfreeze)\n {\n   /* Nop.  */\n }\n+\n+void\n+process_target::stabilize_threads ()\n+{\n+  /* Nop.  */\n+}"
    },
    {
      "sha": "c56267fb1f827173e3df44af60911848c73b7296",
      "filename": "gdbserver/target.h",
      "status": "modified",
      "additions": 5,
      "deletions": 9,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/target.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/target.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/target.h?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -70,9 +70,6 @@ class process_target;\n    shared code.  */\n struct process_stratum_target\n {\n-  /* Stabilize all threads.  That is, force them out of jump pads.  */\n-  void (*stabilize_threads) (void);\n-\n   /* Install a fast tracepoint jump pad.  TPOINT is the address of the\n      tracepoint internal object as used by the IPA agent.  TPADDR is\n      the address of tracepoint.  COLLECTOR is address of the function\n@@ -494,6 +491,9 @@ class process_target\n      pair should not end up resuming threads that were stopped before\n      the pause call.  */\n   virtual void unpause_all (bool unfreeze);\n+\n+  /* Stabilize all threads.  That is, force them out of jump pads.  */\n+  virtual void stabilize_threads ();\n };\n \n extern process_stratum_target *the_target;\n@@ -574,12 +574,8 @@ int kill_inferior (process_info *proc);\n #define target_unpause_all(unfreeze)\t\t\\\n   the_target->pt->unpause_all (unfreeze)\n \n-#define stabilize_threads()\t\t\t\\\n-  do\t\t\t\t\t\t\\\n-    {\t\t\t\t\t\t\\\n-      if (the_target->stabilize_threads)     \t\\\n-\t(*the_target->stabilize_threads) ();  \t\\\n-    } while (0)\n+#define target_stabilize_threads()\t\t\\\n+  the_target->pt->stabilize_threads ()\n \n #define install_fast_tracepoint_jump_pad(tpoint, tpaddr,\t\t\\\n \t\t\t\t\t collector, lockaddr,\t\t\\"
    },
    {
      "sha": "be40c9b4cf1c9a7beff77237d341ed61c8f5cdb9",
      "filename": "gdbserver/tracepoint.cc",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/tracepoint.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/tracepoint.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/tracepoint.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -2606,7 +2606,7 @@ cmd_qtdp (char *own_buf)\n \n       /* download_tracepoint will update global `tracepoints'\n \t list, so it is unsafe to leave threads in jump pad.  */\n-      stabilize_threads ();\n+      target_stabilize_threads ();\n \n       /* Freeze threads.  */\n       target_pause_all (true);\n@@ -3226,7 +3226,7 @@ cmd_qtstart (char *packet)\n      top level command.  And, required to do here, since we're\n      deleting/rewriting jump pads.  */\n \n-  stabilize_threads ();\n+  target_stabilize_threads ();\n \n   /* Freeze threads.  */\n   target_pause_all (true);"
    },
    {
      "sha": "8e0be15fdaf8d294ed155162f36d2c68db68a292",
      "filename": "gdbserver/win32-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/win32-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650/gdbserver/win32-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/win32-low.cc?ref=5c9eb2f2b53cb095dc6dbdd0654cec4ff9a53650",
      "patch": "@@ -1858,7 +1858,6 @@ win32_sw_breakpoint_from_kind (int kind, int *size)\n static win32_process_target the_win32_target;\n \n static process_stratum_target win32_target_ops = {\n-  NULL, /* stabilize_threads */\n   NULL, /* install_fast_tracepoint_jump_pad */\n   NULL, /* emit_ops */\n   NULL, /* supports_disable_randomization */"
    }
  ]
}