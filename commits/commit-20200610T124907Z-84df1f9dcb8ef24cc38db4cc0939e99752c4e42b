{
  "sha": "84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ODRkZjFmOWRjYjhlZjI0Y2MzOGRiNGNjMDkzOWU5OTc1MmM0ZTQyYg==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-06-10T03:38:15Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-06-10T12:49:07Z"
    },
    "message": "Fix x86 ld testsuite fails with glibc < 2.28\n\n\t* testsuite/ld-elf/linux-x86.exp: Build tests when non-native.\n\t(check_pr25749b): Add optional args.  Set expected pass file\n\tfrom args.  Run -1b and -2a tests with passall.out.\n\t* testsuite/ld-elf/passall.out: New file.\n\t* testsuite/ld-elf/pr25749-1.c: Adjust to pass with older glibc.\n\t* testsuite/ld-elf/pr25749-2.c: Likewise.\n\t* testsuite/lib/ld-lib.exp (run_ld_link_exec_tests): Use\n\tregexp_diff to compare expected output from running binary.",
    "tree": {
      "sha": "e86e56f70a0991e1b6a5313c88787109615b7974",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e86e56f70a0991e1b6a5313c88787109615b7974"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7ab967941150b2f79fc089893bf51e6bb53d245b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7ab967941150b2f79fc089893bf51e6bb53d245b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7ab967941150b2f79fc089893bf51e6bb53d245b"
    }
  ],
  "stats": {
    "total": 61,
    "additions": 41,
    "deletions": 20
  },
  "files": [
    {
      "sha": "18fec01e5abe209363b8ba9b185993232caf8434",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
      "patch": "@@ -1,3 +1,14 @@\n+2020-06-10  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-elf/linux-x86.exp: Build tests when non-native.\n+\t(check_pr25749b): Add optional args.  Set expected pass file\n+\tfrom args.  Run -1b and -2a tests with passall.out.\n+\t* testsuite/ld-elf/passall.out: New file.\n+\t* testsuite/ld-elf/pr25749-1.c: Adjust to pass with older glibc.\n+\t* testsuite/ld-elf/pr25749-2.c: Likewise.\n+\t* testsuite/lib/ld-lib.exp (run_ld_link_exec_tests): Use\n+\tregexp_diff to compare expected output from running binary.\n+\n 2020-06-10  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/26094"
    },
    {
      "sha": "aae75d443fecab99a8c706c6a5306cb80c3e7d10",
      "filename": "ld/testsuite/ld-elf/linux-x86.exp",
      "status": "modified",
      "additions": 12,
      "deletions": 10,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/linux-x86.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/linux-x86.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/linux-x86.exp?ref=84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
      "patch": "@@ -48,10 +48,6 @@ run_ld_link_tests [list \\\n ]\n \n # Test very simple native Linux/x86 programs with linux-x86.S.\n-if { ![isnative] || ![check_compiler_available] } {\n-    return\n-}\n-\n run_ld_link_exec_tests [list \\\n     [list \\\n \t\"Run PR ld/23428 test\" \\\n@@ -215,7 +211,7 @@ if { [istarget \"i?86-*-linux*\"] } {\n     }\n }\n \n-proc check_pr25749b {testname srcfilea srcfileb cflags ldflags dsoldflags} {\n+proc check_pr25749b {testname srcfilea srcfileb cflags ldflags dsoldflags args} {\n     global objcopy\n     global srcdir\n     global subdir\n@@ -253,14 +249,20 @@ proc check_pr25749b {testname srcfilea srcfileb cflags ldflags dsoldflags} {\n \t    \"lib${testname}.so\" \\\n \t] \\\n     ]\n+\n+    set pass \"pass.out\"\n+    if { [llength $args] > 0 } {\n+\tset pass [lindex $args 0]\n+    }\n+\n     run_ld_link_exec_tests [list \\\n \t[list \\\n \t    \"Run ${testname}b ($ldflags $cflags)\" \\\n \t    \"$ldflags -Wl,--no-as-needed tmpdir/lib${testname}.so\" \\\n \t    \"\" \\\n \t    [list $srcfilea]\\\n \t    \"${testname}b\" \\\n-\t    \"pass.out\" \\\n+\t    \"$pass\" \\\n \t    \"$cflags -I../bfd\" \\\n \t] \\\n     ]\n@@ -269,13 +271,13 @@ proc check_pr25749b {testname srcfilea srcfileb cflags ldflags dsoldflags} {\n check_pr25749b \"pr25749-1a\" \"pr25749-1.c\" \"pr25749-1a.c\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"\"\n check_pr25749b \"pr25749-1a\" \"pr25749-1.c\" \"pr25749-1a.c\" \"-fPIE\" \"-pie\" \"\"\n check_pr25749b \"pr25749-1a\" \"pr25749-1.c\" \"pr25749-1a.c\" \"-fPIE\" \"-pie\" \"-Wl,-Bsymbolic\"\n-check_pr25749b \"pr25749-1b\" \"pr25749-1.c\" \"pr25749-1b.c\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"\"\n-check_pr25749b \"pr25749-1b\" \"pr25749-1.c\" \"pr25749-1b.c\" \"-fPIE\" \"-pie\" \"\"\n+check_pr25749b \"pr25749-1b\" \"pr25749-1.c\" \"pr25749-1b.c\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"\" \"passall.out\"\n+check_pr25749b \"pr25749-1b\" \"pr25749-1.c\" \"pr25749-1b.c\" \"-fPIE\" \"-pie\" \"\" \"passall.out\"\n check_pr25749b \"pr25749-1b\" \"pr25749-1.c\" \"pr25749-1b.c\" \"-fPIE\" \"-pie\" \"-Wl,-Bsymbolic\"\n check_pr25749b \"pr25749-1d\" \"pr25749-1.c\" \"pr25749-1d.c\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"-Wl,-defsym=_begin=0\"\n check_pr25749b \"pr25749-1d\" \"pr25749-1.c\" \"pr25749-1d.c\" \"-fPIE\" \"-pie\" \"-Wl,-defsym=_begin=0\"\n check_pr25749b \"pr25749-1d\" \"pr25749-1.c\" \"pr25749-1d.c\" \"-fPIE\" \"-pie\" \"-Wl,-Bsymbolic -Wl,-defsym=_begin=0\"\n-check_pr25749b \"pr25749-2a\" \"pr25749-2.c\" \"pr25749-2a.s\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"\"\n-check_pr25749b \"pr25749-2a\" \"pr25749-2.c\" \"pr25749-2a.s\" \"-fPIE\" \"-pie\" \"\"\n+check_pr25749b \"pr25749-2a\" \"pr25749-2.c\" \"pr25749-2a.s\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"\" \"passall.out\"\n+check_pr25749b \"pr25749-2a\" \"pr25749-2.c\" \"pr25749-2a.s\" \"-fPIE\" \"-pie\" \"\" \"passall.out\"\n check_pr25749b \"pr25749-2b\" \"pr25749-2.c\" \"pr25749-2b.s\" \"$NOPIE_CFLAGS\" \"$NOPIE_LDFLAGS\" \"\"\n check_pr25749b \"pr25749-2b\" \"pr25749-2.c\" \"pr25749-2b.s\" \"-fPIE\" \"-pie\" \"\""
    },
    {
      "sha": "beec04bc6bcdb2bd2ce7a7725ffc30c314d8511f",
      "filename": "ld/testsuite/ld-elf/passall.out",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/passall.out",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/passall.out",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/passall.out?ref=84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
      "patch": "@@ -0,0 +1 @@\n+PASS.*"
    },
    {
      "sha": "12d0574a013391595dab708e128cb9d83d0f83f4",
      "filename": "ld/testsuite/ld-elf/pr25749-1.c",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/pr25749-1.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/pr25749-1.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25749-1.c?ref=84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
      "patch": "@@ -6,7 +6,13 @@ extern intptr_t size (void);\n int\n main ()\n {\n-  if (size () == 147)\n+  if (size () == 303 /* size of this file */)\n     printf (\"PASS\\n\");\n+#ifdef __GLIBC_PREREQ\n+# if !__GLIBC_PREREQ (2, 28)\n+  else\n+    printf (\"PASS (incorrect result due to glibc bug)\\n\");\n+# endif\n+#endif\n   return 0;\n }"
    },
    {
      "sha": "3ef6f0c6a7bff5aec7e4043d66d8e99429df34f8",
      "filename": "ld/testsuite/ld-elf/pr25749-2.c",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/pr25749-2.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/ld-elf/pr25749-2.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25749-2.c?ref=84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
      "patch": "@@ -6,7 +6,13 @@ extern intptr_t size;\n int\n main ()\n {\n-  if (size == 137)\n+  if (size == 293 /* size of this file */)\n     printf (\"PASS\\n\");\n+#ifdef __GLIBC_PREREQ\n+# if !__GLIBC_PREREQ (2, 28)\n+  else\n+    printf (\"PASS (incorrect result due to glibc bug)\\n\");\n+# endif\n+#endif\n   return 0;\n }"
    },
    {
      "sha": "a949437cea301b944df559009e5ba0dc21c2b19b",
      "filename": "ld/testsuite/lib/ld-lib.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 8,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/lib/ld-lib.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/84df1f9dcb8ef24cc38db4cc0939e99752c4e42b/ld/testsuite/lib/ld-lib.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/lib/ld-lib.exp?ref=84df1f9dcb8ef24cc38db4cc0939e99752c4e42b",
      "patch": "@@ -773,14 +773,9 @@ proc run_ld_link_exec_tests { ldtests args } {\n \t\tverbose \"$exec_output\" 1\n \t\tset failed 1\n \t    } else {\n-\t\tsend_log \"diff $binfile.out $srcdir/$subdir/$expfile\\n\"\n-\t\tverbose \"diff $binfile.out $srcdir/$subdir/$expfile\"\n-\t\tcatch \"exec diff $binfile.out $srcdir/$subdir/$expfile\" exec_output\n-\t\tset exec_output [prune_warnings $exec_output]\n-\n-\t\tif ![string match \"\" $exec_output] then {\n-\t\t    send_log \"$exec_output\\n\"\n-\t\t    verbose \"$exec_output\" 1\n+\t\tsend_log [file_contents $binfile.out]\n+\t\tverbose [file_contents $binfile.out] 2\n+\t\tif [regexp_diff \"$binfile.out\" \"$srcdir/$subdir/$expfile\"] {\n \t\t    set failed 1\n \t\t}\n \t    }"
    }
  ]
}