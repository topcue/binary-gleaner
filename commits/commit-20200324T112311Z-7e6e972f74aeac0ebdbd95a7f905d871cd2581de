{
  "sha": "7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6N2U2ZTk3MmY3NGFlYWMwZWJkYmQ5NWE3ZjkwNWQ4NzFjZDI1ODFkZQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-03-24T11:23:11Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-03-24T11:23:11Z"
    },
    "message": "bfd: Display symbol version for nm -D\n\nExtend _bfd_elf_get_symbol_version_string for nm -D to display symbol\nversion.  _bfd_elf_get_symbol_version_name is added to avoid updating\nall XXX_get_symbol_version_string functions.\n\nbfd/\n\n\tPR binutils/25708\n\t* elf-bfd.h (_bfd_elf_get_symbol_version_name): New.\n\t* elf.c (_bfd_elf_get_symbol_version_name): New function.  Based\n\ton the previous _bfd_elf_get_symbol_version_string.\n\t(_bfd_elf_get_symbol_version_string): Use it.\n\nbinutils/\n\n\tPR binutils/25708\n\t* nm.c (SYM_NAME): Removed.\n\t(print_symname): Add a pointer to struct extended_symbol_info\n\targument.  Call _bfd_elf_get_symbol_version_name to get symbol\n\tversion.\n\t(print_symdef_entry): Pass NULL to print_symname.\n\t(print_symbol_info_bsd): Update call to print_symname.\n\t(print_symbol_info_sysv): Likewise.\n\t(print_symbol_info_posix): Likewise.\n\nld/\n\n\tPR binutils/25708\n\t* testsuite/ld-elf/pr25708.d: New file.",
    "tree": {
      "sha": "acbfcc916da7663766a6eb079c70ccdf8fa1f0d1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/acbfcc916da7663766a6eb079c70ccdf8fa1f0d1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a64fafb54577a87919a600474a3e4abe3510341a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a64fafb54577a87919a600474a3e4abe3510341a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a64fafb54577a87919a600474a3e4abe3510341a"
    }
  ],
  "stats": {
    "total": 89,
    "additions": 77,
    "deletions": 12
  },
  "files": [
    {
      "sha": "7cc34c1bb9b13a481ced670300eddf854dfa9474",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -1,3 +1,11 @@\n+2020-03-24  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR binutils/25708\n+\t* elf-bfd.h (_bfd_elf_get_symbol_version_name): New.\n+\t* elf.c (_bfd_elf_get_symbol_version_name): New function.  Based\n+\ton the previous _bfd_elf_get_symbol_version_string.\n+\t(_bfd_elf_get_symbol_version_string): Use it.\n+\n 2020-03-24  Alan Modra  <amodra@gmail.com>\n \n \t* archive.c (_bfd_generic_read_ar_hdr_mag): Sanity check extended"
    },
    {
      "sha": "c546b583b87cf6a3639afa4566969b26268bdd9e",
      "filename": "bfd/elf-bfd.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/bfd/elf-bfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/bfd/elf-bfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf-bfd.h?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -2078,6 +2078,8 @@ extern bfd_boolean _bfd_elf_print_private_bfd_data\n   (bfd *, void *);\n const char * _bfd_elf_get_symbol_version_string\n   (bfd *, asymbol *, bfd_boolean *);\n+const char * _bfd_elf_get_symbol_version_name\n+  (bfd *, asymbol *, bfd_boolean, bfd_boolean *);\n extern void bfd_elf_print_symbol\n   (bfd *, void *, asymbol *, bfd_print_symbol_type);\n "
    },
    {
      "sha": "1004809e454f179a94382d4ca17a656f497d55da",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 21,
      "deletions": 6,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -1883,11 +1883,13 @@ _bfd_elf_print_private_bfd_data (bfd *abfd, void *farg)\n   return FALSE;\n }\n \n-/* Get version string.  */\n+/* Get version name.  If BASE_P is TRUE, return \"Base\" for VER_FLG_BASE\n+   and return symbol version for symbol version itself.   */\n \n const char *\n-_bfd_elf_get_symbol_version_string (bfd *abfd, asymbol *symbol,\n-\t\t\t\t    bfd_boolean *hidden)\n+_bfd_elf_get_symbol_version_name (bfd *abfd, asymbol *symbol,\n+\t\t\t\t  bfd_boolean base_p,\n+\t\t\t\t  bfd_boolean *hidden)\n {\n   const char *version_string = NULL;\n   if (elf_dynversym (abfd) != 0\n@@ -1904,10 +1906,14 @@ _bfd_elf_get_symbol_version_string (bfd *abfd, asymbol *symbol,\n \t       && (vernum > elf_tdata (abfd)->cverdefs\n \t\t   || (elf_tdata (abfd)->verdef[0].vd_flags\n \t\t       == VER_FLG_BASE)))\n-\tversion_string = \"Base\";\n+\tversion_string = base_p ? \"Base\" : \"\";\n       else if (vernum <= elf_tdata (abfd)->cverdefs)\n-\tversion_string =\n-\t  elf_tdata (abfd)->verdef[vernum - 1].vd_nodename;\n+\t{\n+\t  const char *nodename\n+\t    = elf_tdata (abfd)->verdef[vernum - 1].vd_nodename;\n+\t  version_string = ((base_p || strcmp (symbol->name, nodename))\n+\t\t\t    ? nodename : \"\");\n+\t}\n       else\n \t{\n \t  Elf_Internal_Verneed *t;\n@@ -1933,6 +1939,15 @@ _bfd_elf_get_symbol_version_string (bfd *abfd, asymbol *symbol,\n   return version_string;\n }\n \n+/* Get version string.  */\n+\n+const char *\n+_bfd_elf_get_symbol_version_string (bfd *abfd, asymbol *symbol,\n+\t\t\t\t    bfd_boolean *hidden)\n+{\n+  return _bfd_elf_get_symbol_version_name (abfd, symbol, TRUE, hidden);\n+}\n+\n /* Display ELF-specific fields of a symbol.  */\n \n void"
    },
    {
      "sha": "2565f36db26cdcc89a7078628819a13eb4bdee85",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -1,3 +1,15 @@\n+2020-03-24  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR binutils/25708\n+\t* nm.c (SYM_NAME): Removed.\n+\t(print_symname): Add a pointer to struct extended_symbol_info\n+\targument.  Call _bfd_elf_get_symbol_version_name to get symbol\n+\tversion.\n+\t(print_symdef_entry): Pass NULL to print_symname.\n+\t(print_symbol_info_bsd): Update call to print_symname.\n+\t(print_symbol_info_sysv): Likewise.\n+\t(print_symbol_info_posix): Likewise.\n+\n 2020-03-24  Alan Modra  <amodra@gmail.com>\n \n \t* readelf.c (process_mips_specific): Free iconf on error path."
    },
    {
      "sha": "0e475f8006345a1b5ddf54680ef726c3c26e6d17",
      "filename": "binutils/nm.c",
      "status": "modified",
      "additions": 20,
      "deletions": 6,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/binutils/nm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/binutils/nm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/nm.c?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -67,7 +67,6 @@ struct extended_symbol_info\n   coff_symbol_type *coffinfo;\n   /* FIXME: We should add more fields for Type, Line, Section.  */\n };\n-#define SYM_NAME(sym)        (sym->sinfo->name)\n #define SYM_VALUE(sym)       (sym->sinfo->value)\n #define SYM_TYPE(sym)        (sym->sinfo->type)\n #define SYM_STAB_NAME(sym)   (sym->sinfo->stab_name)\n@@ -394,8 +393,11 @@ get_coff_symbol_type (const struct internal_syment *sym)\n    demangling it if requested.  */\n \n static void\n-print_symname (const char *form, const char *name, bfd *abfd)\n+print_symname (const char *form, struct extended_symbol_info *info,\n+\t       const char *name, bfd *abfd)\n {\n+  if (name == NULL)\n+    name = info->sinfo->name;\n   if (do_demangle && *name)\n     {\n       char *res = bfd_demangle (abfd, name, demangle_flags);\n@@ -409,6 +411,18 @@ print_symname (const char *form, const char *name, bfd *abfd)\n     }\n \n   printf (form, name);\n+  if (info != NULL && info->elfinfo)\n+    {\n+      const char *version_string;\n+      bfd_boolean hidden;\n+\n+      version_string\n+\t= _bfd_elf_get_symbol_version_name (abfd,\n+\t\t\t\t\t    &info->elfinfo->symbol,\n+\t\t\t\t\t    FALSE, &hidden);\n+      if (version_string && version_string[0])\n+\tprintf (\"%s%s\", hidden ? \"@\" : \"@@\", version_string);\n+    }\n }\n \n static void\n@@ -433,7 +447,7 @@ print_symdef_entry (bfd *abfd)\n \tbfd_fatal (\"bfd_get_elt_at_index\");\n       if (thesym->name != (char *) NULL)\n \t{\n-\t  print_symname (\"%s\", thesym->name, abfd);\n+\t  print_symname (\"%s\", NULL, thesym->name, abfd);\n \t  printf (\" in %s\\n\", bfd_get_filename (elt));\n \t}\n     }\n@@ -1606,13 +1620,13 @@ print_symbol_info_bsd (struct extended_symbol_info *info, bfd *abfd)\n       printf (desc_format, SYM_STAB_DESC (info));\n       printf (\" %5s\", SYM_STAB_NAME (info));\n     }\n-  print_symname (\" %s\", SYM_NAME (info), abfd);\n+  print_symname (\" %s\", info, NULL, abfd);\n }\n \n static void\n print_symbol_info_sysv (struct extended_symbol_info *info, bfd *abfd)\n {\n-  print_symname (\"%-20s|\", SYM_NAME (info), abfd);\n+  print_symname (\"%-20s|\", info, NULL, abfd);\n \n   if (bfd_is_undefined_symclass (SYM_TYPE (info)))\n     {\n@@ -1667,7 +1681,7 @@ print_symbol_info_sysv (struct extended_symbol_info *info, bfd *abfd)\n static void\n print_symbol_info_posix (struct extended_symbol_info *info, bfd *abfd)\n {\n-  print_symname (\"%s \", SYM_NAME (info), abfd);\n+  print_symname (\"%s \", info, NULL, abfd);\n   printf (\"%c \", SYM_TYPE (info));\n \n   if (bfd_is_undefined_symclass (SYM_TYPE (info)))"
    },
    {
      "sha": "ac7dca4625a88a6ea2741fc29f06cf7ddd5732b0",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -1,3 +1,8 @@\n+2020-03-24  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR binutils/25708\n+\t* testsuite/ld-elf/pr25708.d: New file.\n+\n 2020-03-23  Alan Modra  <amodra@gmail.com>\n \n \t* Makefile.am (ALL_EMULATION_SOURCES): Reinstate ei386aout.c."
    },
    {
      "sha": "e487d227b3a44e38b71943993d88b9b5fb83f349",
      "filename": "ld/testsuite/ld-elf/pr25708.d",
      "status": "added",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/ld/testsuite/ld-elf/pr25708.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e6e972f74aeac0ebdbd95a7f905d871cd2581de/ld/testsuite/ld-elf/pr25708.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25708.d?ref=7e6e972f74aeac0ebdbd95a7f905d871cd2581de",
      "patch": "@@ -0,0 +1,9 @@\n+#source: pr13195.s\n+#ld: -shared -version-script pr13195.t\n+#nm: -D\n+#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n+\n+#..\n+0+ A VERS_2.0\n+[0-9a-f]+ T foo@@VERS_2.0\n+#pass"
    }
  ]
}