{
  "sha": "5ceee3dba3422bc8de49768c0c2d8f2608672fe7",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWNlZWUzZGJhMzQyMmJjOGRlNDk3NjhjMGMyZDhmMjYwODY3MmZlNw==",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2020-06-02T20:48:12Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2020-07-22T16:57:43Z"
    },
    "message": "libctf, hash: improve insertion of existing keys into dynhashes\n\nRight now, if you insert a key/value pair into a dynhash, the old slot's\nkey is freed and the new one always assigned.  This seemed sane to me\nwhen I wrote it, but I got it wrong time and time again.  It's much\nless confusing to free the key passed in: if a key-freeing function\nwas passed, you are asserting that the dynhash owns the key in any\ncase, so if you pass in a key it is always buggy to assume it sticks\naround.  Freeing the old key means that you can't even safely look up a\nkey from out of a dynhash and hold on to it, because some other matching\nkey might force it to be freed at any time.\n\nIn the new model, you can always get a key out of a dynhash with\nctf_dynhash_lookup_kv and hang on to it until the kv-pair is actually\ndeleted from the dynhash.  In the old model the pointer to the key might\nbe freed at any time if a matching key was inserted.\n\nlibctf/\n\t* ctf-hash.c (ctf_hashtab_insert): Free the key passed in if\n\tthere is a key-freeing function and the key already exists.",
    "tree": {
      "sha": "c01783365add08aecbc1da2e122fd5dedf2aacd6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c01783365add08aecbc1da2e122fd5dedf2aacd6"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5ceee3dba3422bc8de49768c0c2d8f2608672fe7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5ceee3dba3422bc8de49768c0c2d8f2608672fe7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5ceee3dba3422bc8de49768c0c2d8f2608672fe7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5ceee3dba3422bc8de49768c0c2d8f2608672fe7/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "809f6eb3321edb91fcc96b1f8353dbfe2f762fa7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/809f6eb3321edb91fcc96b1f8353dbfe2f762fa7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/809f6eb3321edb91fcc96b1f8353dbfe2f762fa7"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 7,
    "deletions": 2
  },
  "files": [
    {
      "sha": "9e8129a610ee71e6bafba2ccc2ad64340125be18",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ceee3dba3422bc8de49768c0c2d8f2608672fe7/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ceee3dba3422bc8de49768c0c2d8f2608672fe7/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=5ceee3dba3422bc8de49768c0c2d8f2608672fe7",
      "patch": "@@ -1,3 +1,8 @@\n+2020-07-22  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* ctf-hash.c (ctf_hashtab_insert): Free the key passed in if\n+\tthere is a key-freeing function and the key already exists.\n+\n 2020-07-22  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* ctf-inlines.h: New file."
    },
    {
      "sha": "1c37d7515b43839b9d15238da8427f807d48e49f",
      "filename": "libctf/ctf-hash.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ceee3dba3422bc8de49768c0c2d8f2608672fe7/libctf/ctf-hash.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ceee3dba3422bc8de49768c0c2d8f2608672fe7/libctf/ctf-hash.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ctf-hash.c?ref=5ceee3dba3422bc8de49768c0c2d8f2608672fe7",
      "patch": "@@ -171,15 +171,15 @@ ctf_hashtab_insert (struct htab *htab, void *key, void *value,\n       *slot = malloc (sizeof (ctf_helem_t));\n       if (!*slot)\n \treturn NULL;\n+      (*slot)->key = key;\n     }\n   else\n     {\n       if (key_free)\n-\t  key_free ((*slot)->key);\n+\t  key_free (key);\n       if (value_free)\n \t  value_free ((*slot)->value);\n     }\n-  (*slot)->key = key;\n   (*slot)->value = value;\n   return *slot;\n }"
    }
  ]
}