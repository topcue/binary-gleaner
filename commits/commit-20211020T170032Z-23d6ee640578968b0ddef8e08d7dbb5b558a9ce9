{
  "sha": "23d6ee640578968b0ddef8e08d7dbb5b558a9ce9",
  "node_id": "C_kwDOANOeidoAKDIzZDZlZTY0MDU3ODk2OGIwZGRlZjhlMDhkN2RiYjViNTU4YTljZTk",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-10-02T22:58:49Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-10-20T17:00:32Z"
    },
    "message": "Use unique_xmalloc_ptr in bp_location\n\nThis changes struct bp_location to use a unique_xmalloc_ptr, removing\na bit of manual memory management.",
    "tree": {
      "sha": "311ff756d63d5ec56408f96a4f707f2f538857cf",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/311ff756d63d5ec56408f96a4f707f2f538857cf"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a4c50be3d68b4f857fee29a45f799755a6862c22",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a4c50be3d68b4f857fee29a45f799755a6862c22",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a4c50be3d68b4f857fee29a45f799755a6862c22"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 6,
    "deletions": 10
  },
  "files": [
    {
      "sha": "5c3a6c6e4aacea973fc6e061897ee51d88f2a863",
      "filename": "gdb/breakpoint.c",
      "status": "modified",
      "additions": 4,
      "deletions": 8,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9/gdb/breakpoint.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9/gdb/breakpoint.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/breakpoint.c?ref=23d6ee640578968b0ddef8e08d7dbb5b558a9ce9",
      "patch": "@@ -7192,7 +7192,7 @@ set_breakpoint_location_function (struct bp_location *loc)\n \tfind_pc_partial_function (loc->address, &function_name, NULL, NULL);\n \n       if (function_name)\n-\tloc->function_name = xstrdup (function_name);\n+\tloc->function_name = make_unique_xstrdup (function_name);\n     }\n }\n \n@@ -12234,11 +12234,6 @@ say_where (struct breakpoint *b)\n     }\n }\n \n-bp_location::~bp_location ()\n-{\n-  xfree (function_name);\n-}\n-\n /* Destructor for the breakpoint base class.  */\n \n breakpoint::~breakpoint ()\n@@ -13323,7 +13318,7 @@ ambiguous_names_p (struct bp_location *loc)\n   for (l = loc; l != NULL; l = l->next)\n     {\n       const char **slot;\n-      const char *name = l->function_name;\n+      const char *name = l->function_name.get ();\n \n       /* Allow for some names to be NULL, ignore them.  */\n       if (name == NULL)\n@@ -13642,7 +13637,8 @@ update_breakpoint_locations (struct breakpoint *b,\n \t      {\n \t\tfor (bp_location *l : b->locations ())\n \t\t  if (l->function_name\n-\t\t      && strcmp (e->function_name, l->function_name) == 0)\n+\t\t      && strcmp (e->function_name.get (),\n+\t\t\t\t l->function_name.get ()) == 0)\n \t\t    {\n \t\t      l->enabled = e->enabled;\n \t\t      l->disabled_by_cond = e->disabled_by_cond;"
    },
    {
      "sha": "304e2c1fca4fa0de940bad251a8cf6493db37975",
      "filename": "gdb/breakpoint.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9/gdb/breakpoint.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/23d6ee640578968b0ddef8e08d7dbb5b558a9ce9/gdb/breakpoint.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/breakpoint.h?ref=23d6ee640578968b0ddef8e08d7dbb5b558a9ce9",
      "patch": "@@ -328,7 +328,7 @@ class bp_location : public refcounted_object\n   /* Construct a bp_location with type TYPE.  */\n   bp_location (breakpoint *owner, bp_loc_type type);\n \n-  virtual ~bp_location ();\n+  virtual ~bp_location () = default;\n \n   /* Chain pointer to the next breakpoint location for\n      the same parent breakpoint.  */\n@@ -467,7 +467,7 @@ class bp_location : public refcounted_object\n      with it.  */\n   bound_probe probe {};\n \n-  char *function_name = NULL;\n+  gdb::unique_xmalloc_ptr<char> function_name;\n \n   /* Details of the placed breakpoint, when inserted.  */\n   bp_target_info target_info {};"
    }
  ]
}