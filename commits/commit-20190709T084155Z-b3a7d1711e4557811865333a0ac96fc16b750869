{
  "sha": "b3a7d1711e4557811865333a0ac96fc16b750869",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjNhN2QxNzExZTQ1NTc4MTE4NjUzMzNhMGFjOTZmYzE2Yjc1MDg2OQ==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-04T20:02:43Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-09T08:41:55Z"
    },
    "message": "gdb/riscv: Don't use default bfd to define required features\n\nWhen we initialise a gdbarch object we perform a check to try and\ndetect if the user is doing something silly; trying to run an RV64\nbinary on an RV32 target.  To perform this check we compare the xlen\nfrom the target description with the xlen specified in the headers on\nthe ELF being debugged.\n\nIf there is no ELF being debugged then we (currently) try to use the\nbfd_arch_info from the gdbarch_info object, which will have been set\nto the default architecture if no bfd is currently being debugged.\nFor RISC-V the default architecture is RV64.\n\nWhat this means is that if a user tries to connect to an RV32 target\nwithout specifying the BFD to debug then GDB will assume RV64.  The\nsanity check mentioned above will failed (xlen difference) and GDB\nwill throw an error.  The error causes GDB to disconnect from the\nremote target.\n\nAfter this commit GDB no longer relies on the default bfd\narchitecture.  If the user tries to connect without specifying the bfd\nthen GDB will simply make use of the xlen extracted from the target\ndescription in order to find or create a suitable gdbarch object.\n\ngdb/ChangeLog:\n\n\t* riscv-tdep.c (riscv_features_from_gdbarch_info): Don't modify\n\trequired features based on default bfd type when no specific bfd\n\tis present.",
    "tree": {
      "sha": "316090eef101d1750d3b790d8935d1800d07a1a4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/316090eef101d1750d3b790d8935d1800d07a1a4"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b3a7d1711e4557811865333a0ac96fc16b750869",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3a7d1711e4557811865333a0ac96fc16b750869",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b3a7d1711e4557811865333a0ac96fc16b750869",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b3a7d1711e4557811865333a0ac96fc16b750869/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d69cd47e7e9884f7b3a319936f70b8d93347e9e0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d69cd47e7e9884f7b3a319936f70b8d93347e9e0",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d69cd47e7e9884f7b3a319936f70b8d93347e9e0"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 6,
    "deletions": 12
  },
  "files": [
    {
      "sha": "854eeb5b0e53eb6539b80ddd29baff244134a035",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3a7d1711e4557811865333a0ac96fc16b750869/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3a7d1711e4557811865333a0ac96fc16b750869/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=b3a7d1711e4557811865333a0ac96fc16b750869",
      "patch": "@@ -1,3 +1,9 @@\n+2019-07-09  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* riscv-tdep.c (riscv_features_from_gdbarch_info): Don't modify\n+\trequired features based on default bfd type when no specific bfd\n+\tis present.\n+\n 2019-07-08  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n \n \t* NEWS: Mention that GDB printf and eval commands can now print"
    },
    {
      "sha": "828beea7e2bc3187a630e2d81900e3f1f544773a",
      "filename": "gdb/riscv-tdep.c",
      "status": "modified",
      "additions": 0,
      "deletions": 12,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b3a7d1711e4557811865333a0ac96fc16b750869/gdb/riscv-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b3a7d1711e4557811865333a0ac96fc16b750869/gdb/riscv-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/riscv-tdep.c?ref=b3a7d1711e4557811865333a0ac96fc16b750869",
      "patch": "@@ -2917,18 +2917,6 @@ riscv_features_from_gdbarch_info (const struct gdbarch_info info)\n       else if (e_flags & EF_RISCV_FLOAT_ABI_SINGLE)\n \tfeatures.flen = 4;\n     }\n-  else\n-    {\n-      const struct bfd_arch_info *binfo = info.bfd_arch_info;\n-\n-      if (binfo->bits_per_word == 32)\n-\tfeatures.xlen = 4;\n-      else if (binfo->bits_per_word == 64)\n-\tfeatures.xlen = 8;\n-      else\n-\tinternal_error (__FILE__, __LINE__, _(\"unknown bits_per_word %d\"),\n-\t\t\tbinfo->bits_per_word);\n-    }\n \n   return features;\n }"
    }
  ]
}