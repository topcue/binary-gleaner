{
  "sha": "e0d6d274068b02d952852b18adb3feaca1d2bb8a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTBkNmQyNzQwNjhiMDJkOTUyODUyYjE4YWRiM2ZlYWNhMWQyYmI4YQ==",
  "commit": {
    "author": {
      "name": "Kevin Buettner",
      "email": "kevinb@redhat.com",
      "date": "2021-03-19T18:07:11Z"
    },
    "committer": {
      "name": "Kevin Buettner",
      "email": "kevinb@redhat.com",
      "date": "2021-03-19T20:36:33Z"
    },
    "message": "Fix potential hang during gdbserver testing\n\nWe're currently seeing testing of native-extended-gdbserver hang while\ntesting the x86_64 architecture on both Fedora 34 and Fedora Rawhide.\nThe test responsible for the hang is gdb.threads/fork-plus-threads.exp.\n\nWhile there is clearly a problem/bug with this test on F34 and\nRawhide, it's also the case that testing should not hang.  This commit\nprevents the hang by waiting with the \"-nowait\" flag in\nclose_gdbserver.\n\nThe -nowait flag is also used in the kill_wait_spawned_process proc in\ngdb/testsuite/lib/gdb.exp, so there is precedent for doing this.\n\nThere are also 15 other uses of \"wait -i\" scattered throughout the\ntest suite.  While it's tempting to change these to also use the\n-nowait flag, I think it might be safer to defer doing so until we\nactually see a problem.\n\nI've tested this patch on Fedora 32, 33, 34, and Rawhide.  Results are\ncomparable on Fedora 32 and 33.  On Fedora 34 and Rawhide, with this\ncommit in place, testing completes when the target_board is\nnative-extended-gdbserver.  On those OSes, when not using this commit,\ntesting usually hangs due to a problem with\ngdb.threads/fork-plus-threads.exp.  I've also tested on all of the\nmentioned OSes with target_board=native-gdbserver; for that testing,\nI achieved comparable results over a number of runs.  (Unfortunately\nresults are rarely identical due to racy tests.)\n\ngdb/testsuite/ChangeLog:\n\n\t* lib/gdbserver-support.exp (gdbserver_exit): Use the\n\t\"-nowait\" flag when waiting for gdbserver to exit.",
    "tree": {
      "sha": "e876301d4ac47684a08638b134ce6af3fa370e88",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e876301d4ac47684a08638b134ce6af3fa370e88"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e0d6d274068b02d952852b18adb3feaca1d2bb8a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e0d6d274068b02d952852b18adb3feaca1d2bb8a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e0d6d274068b02d952852b18adb3feaca1d2bb8a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e0d6d274068b02d952852b18adb3feaca1d2bb8a/comments",
  "author": {
    "login": "KevinBuettner",
    "id": 65747518,
    "node_id": "MDQ6VXNlcjY1NzQ3NTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/65747518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KevinBuettner",
    "html_url": "https://github.com/KevinBuettner",
    "followers_url": "https://api.github.com/users/KevinBuettner/followers",
    "following_url": "https://api.github.com/users/KevinBuettner/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinBuettner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KevinBuettner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinBuettner/subscriptions",
    "organizations_url": "https://api.github.com/users/KevinBuettner/orgs",
    "repos_url": "https://api.github.com/users/KevinBuettner/repos",
    "events_url": "https://api.github.com/users/KevinBuettner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KevinBuettner/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "KevinBuettner",
    "id": 65747518,
    "node_id": "MDQ6VXNlcjY1NzQ3NTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/65747518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KevinBuettner",
    "html_url": "https://github.com/KevinBuettner",
    "followers_url": "https://api.github.com/users/KevinBuettner/followers",
    "following_url": "https://api.github.com/users/KevinBuettner/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinBuettner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KevinBuettner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinBuettner/subscriptions",
    "organizations_url": "https://api.github.com/users/KevinBuettner/orgs",
    "repos_url": "https://api.github.com/users/KevinBuettner/repos",
    "events_url": "https://api.github.com/users/KevinBuettner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KevinBuettner/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "219f56b4842f4e72540082af96e47efa0f0f0a82",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/219f56b4842f4e72540082af96e47efa0f0f0a82",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/219f56b4842f4e72540082af96e47efa0f0f0a82"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 11,
    "deletions": 1
  },
  "files": [
    {
      "sha": "d5ff0026aa7af15cd8924f1f8ffac59a4904ee6f",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0d6d274068b02d952852b18adb3feaca1d2bb8a/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0d6d274068b02d952852b18adb3feaca1d2bb8a/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=e0d6d274068b02d952852b18adb3feaca1d2bb8a",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-19  Kevin Buettner  <kevinb@redhat.com>\n+\n+\t* lib/gdbserver-support.exp (gdbserver_exit): Use the\n+\t\"-nowait\" flag when waiting for gdbserver to exit.\n+\n 2021-03-19  Sourabh Singh Tomar  <SourabhSingh.Tomar@amd.com>\n \n \t* gdb.base/info-macros.exp: Append -fdebug-macro to"
    },
    {
      "sha": "08866349e2cb9b9c0075d8ed087fd2fab3f8a651",
      "filename": "gdb/testsuite/lib/gdbserver-support.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e0d6d274068b02d952852b18adb3feaca1d2bb8a/gdb/testsuite/lib/gdbserver-support.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e0d6d274068b02d952852b18adb3feaca1d2bb8a/gdb/testsuite/lib/gdbserver-support.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdbserver-support.exp?ref=e0d6d274068b02d952852b18adb3feaca1d2bb8a",
      "patch": "@@ -421,7 +421,12 @@ proc close_gdbserver {} {\n     verbose \"Quitting GDBserver\"\n \n     catch \"close -i $server_spawn_id\"\n-    catch \"wait -i $server_spawn_id\"\n+\n+    # If gdbserver misbehaves, and ignores the close, waiting for it\n+    # without the -nowait flag will cause testing to hang.  Passing\n+    # -nowait makes expect tell Tcl to wait for the process in the\n+    # background.\n+    catch \"wait -nowait -i $server_spawn_id\"\n     unset server_spawn_id\n }\n "
    }
  ]
}