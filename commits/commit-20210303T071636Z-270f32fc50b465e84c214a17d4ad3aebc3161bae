{
  "sha": "270f32fc50b465e84c214a17d4ad3aebc3161bae",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjcwZjMyZmM1MGI0NjVlODRjMjE0YTE3ZDRhZDNhZWJjMzE2MWJhZQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-03T06:55:28Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-03T07:16:36Z"
    },
    "message": "ld-gc tests on underscore targets\n\nAdjust tests to reference __start and __stop syms with an extra\nleading underscore when appropriate, and run tests on more targets.\n\n\t* testsuite/ld-gc/gc.exp: Define UNDERSCORE in ASFLAGS.\n\tMove tests with ELF section directives to is_elf_format block.\n\t* testsuite/ld-gc/abi-note.d: Run on more targets.\n\t* testsuite/ld-gc/pr19167.d: Likewise and adjust xfails.\n\t* testsuite/ld-gc/start.d: Likewise.\n\t* testsuite/ld-gc/start2.d: Likewise.\n\t* testsuite/ld-gc/stop.d: Likewise.\n\t* testsuite/ld-gc/pr19167a.s: Add support for underscore targets.\n\t* testsuite/ld-gc/start.s: Likewise.\n\t* testsuite/ld-gc/start2.s: Likewise.",
    "tree": {
      "sha": "d8f6a240063357e746463638b44f507836a7bf47",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d8f6a240063357e746463638b44f507836a7bf47"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/270f32fc50b465e84c214a17d4ad3aebc3161bae",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/270f32fc50b465e84c214a17d4ad3aebc3161bae",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/270f32fc50b465e84c214a17d4ad3aebc3161bae",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/270f32fc50b465e84c214a17d4ad3aebc3161bae/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "dc83f2d20e964f9a7fd9a97ba9d3950b908752a1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dc83f2d20e964f9a7fd9a97ba9d3950b908752a1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/dc83f2d20e964f9a7fd9a97ba9d3950b908752a1"
    }
  ],
  "stats": {
    "total": 66,
    "additions": 48,
    "deletions": 18
  },
  "files": [
    {
      "sha": "bf1d226b80954751e90a745f3655ed83bd43494e",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,3 +1,16 @@\n+2021-03-03  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-gc/gc.exp: Define UNDERSCORE in ASFLAGS.\n+\tMove tests with ELF section directives to is_elf_format block.\n+\t* testsuite/ld-gc/abi-note.d: Run on more targets.\n+\t* testsuite/ld-gc/pr19167.d: Likewise and adjust xfails.\n+\t* testsuite/ld-gc/start.d: Likewise.\n+\t* testsuite/ld-gc/start2.d: Likewise.\n+\t* testsuite/ld-gc/stop.d: Likewise.\n+\t* testsuite/ld-gc/pr19167a.s: Add support for underscore targets.\n+\t* testsuite/ld-gc/start.s: Likewise.\n+\t* testsuite/ld-gc/start2.s: Likewise.\n+\n 2021-03-02  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* ldelfgen.c (ldelf_ctf_strtab_iter_cb): Skip zero-refcount strings."
    },
    {
      "sha": "1f78ceaa3515c9175daaf92fef5dc78db22619e6",
      "filename": "ld/testsuite/ld-gc/abi-note.d",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/abi-note.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/abi-note.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/abi-note.d?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,7 +1,6 @@\n #name: --gc-sections with note section\n #ld: --gc-sections -e _start\n #readelf: -S --wide\n-#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n \n #...\n .* .note.ABI-tag[ \t]+NOTE.*"
    },
    {
      "sha": "ba528d000bff3e20d690abf41d1368331e93ea8a",
      "filename": "ld/testsuite/ld-gc/gc.exp",
      "status": "modified",
      "additions": 13,
      "deletions": 5,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/gc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/gc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/gc.exp?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -86,15 +86,21 @@ test_gc \"Check --gc-section/-q\" \"gcrexe\" $ld \"--gc-sections -q -e main\"\n test_gc \"Check --gc-section/-r/-e\" \"gcrel\" $ld \"-r --gc-sections -e main\"\n test_gc \"Check --gc-section/-r/-u\" \"gcrel\" $ld \"-r --gc-sections -u used_func\"\n \n+set old_asflags $ASFLAGS\n+if [is_underscore_target] {\n+    set ASFLAGS \"$ASFLAGS --defsym UNDERSCORE=1\"\n+}\n+\n run_dump_test \"noent\"\n-run_dump_test \"abi-note\"\n-run_dump_test \"start\"\n-run_dump_test \"start2\"\n-run_dump_test \"stop\"\n-run_dump_test \"pr19167\"\n+\n if { [is_elf_format] } then {\n+    run_dump_test \"abi-note\"\n     run_dump_test \"all-debug-sections\"\n+    run_dump_test \"pr19167\"\n     run_dump_test \"pr20882\"\n+    run_dump_test \"stop\"\n+    run_dump_test \"start\"\n+    run_dump_test \"start2\"\n }\n \n if { [is_elf_format] && [check_shared_lib_support] } then {\n@@ -175,3 +181,5 @@ if { [is_elf_format] && [check_shared_lib_support] \\\n if { [is_elf_format] } then {\n     run_dump_test \"skip-map-discarded\"\n }\n+\n+set ASFLAGS $old_asflags"
    },
    {
      "sha": "f652dd018f4778e52f62bd846836d1830c214ae0",
      "filename": "ld/testsuite/ld-gc/pr19167.d",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/pr19167.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/pr19167.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/pr19167.d?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -2,8 +2,7 @@\n #source: pr19167b.s\n #ld: --gc-sections -e _start\n #objdump: -s -j _foo\n-#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n-#xfail: frv-*-* metag-*-*\n+#xfail: bfin-*-*linux* frv-*-*linux* lm32-*-*linux*\n \n #...\n Contents of section _foo:"
    },
    {
      "sha": "73a0a27680914926195e5a45d740b9b7fa5b2ed1",
      "filename": "ld/testsuite/ld-gc/pr19167a.s",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/pr19167a.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/pr19167a.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/pr19167a.s?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,6 +1,10 @@\n .globl _start\n _start:\n+  .ifdef UNDERSCORE\n+\t.dc.a\t___start__foo\n+  .else\n \t.dc.a\t__start__foo\n+  .endif\n \t.section\t_foo,\"aw\",%progbits\n foo:\n \t.ascii \"This is \""
    },
    {
      "sha": "0998ecfcc68b8dac2f72956863fb42336a3d5052",
      "filename": "ld/testsuite/ld-gc/start.d",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/start.d?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,9 +1,8 @@\n #name: --gc-sections with __start_\n #ld: --gc-sections -e _start\n #nm: -n\n-#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n-#xfail: frv-*-* metag-*-*\n+#xfail: bfin-*-*linux* frv-*-*linux* lm32-*-*linux*\n \n #...\n-[0-9a-f]+ D +__start__foo\n+[0-9a-f]+ D +_?__start__foo\n #..."
    },
    {
      "sha": "505122d520448050c13aa04f26812125b2b4ad0f",
      "filename": "ld/testsuite/ld-gc/start.s",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/start.s?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,6 +1,10 @@\n-.globl _start\n+\t.globl _start\n _start:\n+ .ifdef UNDERSCORE\n+\t.dc.a\t___start__foo\n+ .else\n \t.dc.a\t__start__foo\n+ .endif\n \t.section\t_foo,\"aw\",%progbits\n foo:\n \t.long\t1"
    },
    {
      "sha": "b893ba2372952ec0190c81ceb783bfdb0f3ff5b6",
      "filename": "ld/testsuite/ld-gc/start2.d",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/start2.d?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,10 +1,10 @@\n #name: --gc-sections with -z start-stop-gc\n #ld: --gc-sections -e _start -z start-stop-gc\n #nm: -n\n-#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n-#xfail: bfin-*-*linux* frv-*-*\n+#notarget: [uses_genelf]\n+#xfail: bfin-*-*linux* frv-*-*linux*\n \n #failif\n #...\n-[0-9a-f]+ D +__start__foo\n+[0-9a-f]+ D +_?__start__foo\n #..."
    },
    {
      "sha": "920feb26936776831f0ecfe6a5bb8e9d085f0e96",
      "filename": "ld/testsuite/ld-gc/start2.s",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/start2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/start2.s?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,7 +1,12 @@\n-.globl _start\n+\t.globl _start\n _start:\n+ .ifdef UNDERSCORE\n+\t.weak\t___start__foo\n+\t.dc.a\t___start__foo\n+ .else\n \t.weak\t__start__foo\n \t.dc.a\t__start__foo\n+ .endif\n \t.section\t_foo,\"aw\",%progbits\n foo:\n \t.long\t1"
    },
    {
      "sha": "140d1d2f27e685626d08e5f76144889ca01ed916",
      "filename": "ld/testsuite/ld-gc/stop.d",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/stop.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/270f32fc50b465e84c214a17d4ad3aebc3161bae/ld/testsuite/ld-gc/stop.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-gc/stop.d?ref=270f32fc50b465e84c214a17d4ad3aebc3161bae",
      "patch": "@@ -1,9 +1,8 @@\n #name: --gc-sections removing __stop_\n #ld: --gc-sections -e _start\n #nm: -n\n-#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n \n #failif\n #...\n-[0-9a-f]+ D +__stop__foo\n+[0-9a-f]+ D +_?__stop__foo\n #..."
    }
  ]
}