{
  "sha": "0613c3306cc709f950731d87accbfac02b17a787",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDYxM2MzMzA2Y2M3MDlmOTUwNzMxZDg3YWNjYmZhYzAyYjE3YTc4Nw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-08-04T09:02:28Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-08-04T13:58:44Z"
    },
    "message": "PR28162, segment fault in mips_elf_assign_gp\n\nFor the testcase in the PR, _bfd_mips_elf32_gprel16_reloc is passed a\nNULL output_bfd.  As expected for reloc special functions if called by\nobjdump or when final linking.  The function attempts to find the\noutput by\n  output_bfd = symbol->section->output_section->owner;\nThat makes some sense, since when handling a gp-relative reloc we need\nthe relevant gp to which the symbol is relative.  Possibly the gp\nvalue can be one for a shared library?  But that doesn't seem useful\nor supported by the various abi docs and won't work as written.\nSymbols defined in shared libraries have section->output_section\nNULL, and what's more the code in mips_elf_assign_gp isn't set up to\nlook at shared library symbols.\n\nAlso, if the symbol is a SHN_ABS one the owner of *ABS* section is\nNULL, which will result in the testcase segfault.  The only gp to\nwhich an absolute symbol can be relative is the linker output bfd when\nlinking, or the input bfd when not.  This patch arranges to do that\nfor all gp-relative reloc symbols.\n\n\t* elf32-mips.c (_bfd_mips_elf32_gprel16_reloc): Don't use the\n\tsection symbol to find the output bfd, use input_section.\n\t(mips_elf_gprel32_reloc, mips16_gprel_reloc): Likewise.\n\t* elf64-mips.c (mips_elf64_gprel16_reloc): Likewise.\n\t(mips_elf64_literal_reloc, mips_elf64_gprel32_reloc): Likewise.\n\t(mips16_gprel_reloc): Likewise.",
    "tree": {
      "sha": "18fb3618bb235f205236ebdd01e3b13233250927",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/18fb3618bb235f205236ebdd01e3b13233250927"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0613c3306cc709f950731d87accbfac02b17a787",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0613c3306cc709f950731d87accbfac02b17a787",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0613c3306cc709f950731d87accbfac02b17a787",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0613c3306cc709f950731d87accbfac02b17a787/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5b3ef0a5952eaf912da343505eff9d0a29334751",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5b3ef0a5952eaf912da343505eff9d0a29334751",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5b3ef0a5952eaf912da343505eff9d0a29334751"
    }
  ],
  "stats": {
    "total": 14,
    "additions": 7,
    "deletions": 7
  },
  "files": [
    {
      "sha": "f8467de478b050201992fc359443cdf6ed1dc1a9",
      "filename": "bfd/elf32-mips.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0613c3306cc709f950731d87accbfac02b17a787/bfd/elf32-mips.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0613c3306cc709f950731d87accbfac02b17a787/bfd/elf32-mips.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-mips.c?ref=0613c3306cc709f950731d87accbfac02b17a787",
      "patch": "@@ -1783,7 +1783,7 @@ _bfd_mips_elf32_gprel16_reloc (bfd *abfd, arelent *reloc_entry,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf_final_gp (output_bfd, symbol, relocatable, error_message,\n@@ -1830,7 +1830,7 @@ mips_elf_gprel32_reloc (bfd *abfd, arelent *reloc_entry, asymbol *symbol,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf_final_gp (output_bfd, symbol, relocatable,\n@@ -1949,7 +1949,7 @@ mips16_gprel_reloc (bfd *abfd, arelent *reloc_entry, asymbol *symbol,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf_final_gp (output_bfd, symbol, relocatable, error_message,"
    },
    {
      "sha": "b94adf129534597964410e5b2f2b90df993acfb6",
      "filename": "bfd/elf64-mips.c",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0613c3306cc709f950731d87accbfac02b17a787/bfd/elf64-mips.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0613c3306cc709f950731d87accbfac02b17a787/bfd/elf64-mips.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-mips.c?ref=0613c3306cc709f950731d87accbfac02b17a787",
      "patch": "@@ -3483,7 +3483,7 @@ mips_elf64_gprel16_reloc (bfd *abfd, arelent *reloc_entry, asymbol *symbol,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf64_final_gp (output_bfd, symbol, relocatable, error_message,\n@@ -3523,7 +3523,7 @@ mips_elf64_literal_reloc (bfd *abfd, arelent *reloc_entry, asymbol *symbol,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf64_final_gp (output_bfd, symbol, relocatable, error_message,\n@@ -3565,7 +3565,7 @@ mips_elf64_gprel32_reloc (bfd *abfd, arelent *reloc_entry, asymbol *symbol,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf64_final_gp (output_bfd, symbol, relocatable,\n@@ -3654,7 +3654,7 @@ mips16_gprel_reloc (bfd *abfd, arelent *reloc_entry, asymbol *symbol,\n   else\n     {\n       relocatable = false;\n-      output_bfd = symbol->section->output_section->owner;\n+      output_bfd = input_section->output_section->owner;\n     }\n \n   ret = mips_elf64_final_gp (output_bfd, symbol, relocatable, error_message,"
    }
  ]
}