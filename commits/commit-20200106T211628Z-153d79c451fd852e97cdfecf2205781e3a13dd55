{
  "sha": "153d79c451fd852e97cdfecf2205781e3a13dd55",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTUzZDc5YzQ1MWZkODUyZTk3Y2RmZWNmMjIwNTc4MWUzYTEzZGQ1NQ==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-12-26T20:56:01Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-01-06T21:16:28Z"
    },
    "message": "gdb: Fix backtrace with disassemble-next-line on\n\nIn this commit:\n\n  commit ec8e2b6d3051f0b4b2a8eee9917898e95046c62f\n  Date:   Fri Jun 14 23:43:00 2019 +0100\n\n      gdb: Don't allow annotations to influence what else GDB prints\n\nA change was accidentally made that moved a call to do_gdb_disassembly\nout of an if block guarded by 'if (source_print && sal.symtab)'.  The\nresult was that if a user has 'set disassemble-next-line on' then the\nbacktrace would now include some disassembly of a few instructions in\neach frame.\n\nThis change was not intentional, but was not spotted by any tests.\n\nThis commit restores the old behaviour and adds a test to ensure this\ndoesn't break again in the future.\n\ngdb/ChangeLog:\n\n\t* stack.c (print_frame_info): Move disassemble_next_line code\n\tinside source_print block.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.base/backtrace.c: New file.\n\t* gdb.base/backtrace.exp: New file.\n\nChange-Id: I47c52a202fa74be138382646b695827940178689",
    "tree": {
      "sha": "fbc51135a3b0f8851b917905085247e88cc30d11",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fbc51135a3b0f8851b917905085247e88cc30d11"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/153d79c451fd852e97cdfecf2205781e3a13dd55",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/153d79c451fd852e97cdfecf2205781e3a13dd55",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/153d79c451fd852e97cdfecf2205781e3a13dd55",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/153d79c451fd852e97cdfecf2205781e3a13dd55/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "66182876b46d40163e81504f7fa4f206268cb83c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/66182876b46d40163e81504f7fa4f206268cb83c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/66182876b46d40163e81504f7fa4f206268cb83c"
    }
  ],
  "stats": {
    "total": 108,
    "additions": 103,
    "deletions": 5
  },
  "files": [
    {
      "sha": "3f37153af3f1e654fed653fad7bd7ad812824d32",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=153d79c451fd852e97cdfecf2205781e3a13dd55",
      "patch": "@@ -1,3 +1,8 @@\n+2020-01-06  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* stack.c (print_frame_info): Move disassemble_next_line code\n+\tinside source_print block.\n+\n 2020-01-06  Eli Zaretskii  <eliz@gnu.org>\n \n \t* gdbsupport/gdb_wait.c: Include <signal.h> instead of"
    },
    {
      "sha": "92784c93396807929265dc2b8fffa920966f24e1",
      "filename": "gdb/stack.c",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/stack.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/stack.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/stack.c?ref=153d79c451fd852e97cdfecf2205781e3a13dd55",
      "patch": "@@ -1153,12 +1153,12 @@ print_frame_info (const frame_print_options &fp_opts,\n \n \t  print_source_lines (sal.symtab, sal.line, sal.line + 1, 0);\n \t}\n-    }\n \n-  /* If disassemble-next-line is set to on and there is line debug\n-     messages, output assembly codes for next line.  */\n-  if (disassemble_next_line == AUTO_BOOLEAN_TRUE)\n-    do_gdb_disassembly (get_frame_arch (frame), -1, sal.pc, sal.end);\n+      /* If disassemble-next-line is set to on and there is line debug\n+\t messages, output assembly codes for next line.  */\n+      if (disassemble_next_line == AUTO_BOOLEAN_TRUE)\n+\tdo_gdb_disassembly (get_frame_arch (frame), -1, sal.pc, sal.end);\n+    }\n \n   if (set_current_sal)\n     {"
    },
    {
      "sha": "3f243641b8b02df6327ee6ef4d56c3526718a037",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=153d79c451fd852e97cdfecf2205781e3a13dd55",
      "patch": "@@ -1,3 +1,8 @@\n+2020-01-06  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.base/backtrace.c: New file.\n+\t* gdb.base/backtrace.exp: New file.\n+\n 2020-01-05  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.tui/list.exp: Test 'focus next' after 'list main'."
    },
    {
      "sha": "bae8b1a89001e0824fc0b0b41e12175c2ad7c798",
      "filename": "gdb/testsuite/gdb.base/backtrace.c",
      "status": "added",
      "additions": 40,
      "deletions": 0,
      "changes": 40,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/testsuite/gdb.base/backtrace.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/testsuite/gdb.base/backtrace.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/backtrace.c?ref=153d79c451fd852e97cdfecf2205781e3a13dd55",
      "patch": "@@ -0,0 +1,40 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2019-2020 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+int __attribute__((noinline,noclone))\n+baz ()\n+{\n+  return 0;\t/* Break here.  */\n+}\n+\n+int __attribute__((noinline,noclone))\n+bar ()\n+{\n+  return baz ();\n+}\n+\n+int __attribute__((noinline,noclone))\n+foo ()\n+{\n+  return bar ();\n+}\n+\n+int\n+main ()\n+{\n+  return foo ();\n+}"
    },
    {
      "sha": "17e3b61fa3fb4682ec0d013c1d72bb98e2d0a74f",
      "filename": "gdb/testsuite/gdb.base/backtrace.exp",
      "status": "added",
      "additions": 48,
      "deletions": 0,
      "changes": 48,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/testsuite/gdb.base/backtrace.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/153d79c451fd852e97cdfecf2205781e3a13dd55/gdb/testsuite/gdb.base/backtrace.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/backtrace.exp?ref=153d79c451fd852e97cdfecf2205781e3a13dd55",
      "patch": "@@ -0,0 +1,48 @@\n+# Copyright 2019-2020 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+# A place for miscellaneous tests related to backtrace.\n+\n+standard_testfile\n+\n+if { [prepare_for_testing \"failed to prepare\" $testfile $srcfile] } {\n+    return -1\n+}\n+\n+if ![runto_main] then {\n+    fail \"can't run to main\"\n+    return 0\n+}\n+\n+# Run to the breakpoint at return.\n+gdb_breakpoint [gdb_get_line_number \"Break here.\"]\n+gdb_continue_to_breakpoint \"Break here.\"\n+\n+# Backtrace with the default options.\n+gdb_test \"bt\" \\\n+    [multi_line \\\n+\t \"#0\\[ \\t\\]*baz \\\\(\\\\) at \\[^\\r\\n\\]+\" \\\n+\t \"#1\\[ \\t\\]*$hex in bar \\\\(\\\\) at \\[^\\r\\n\\]+\" \\\n+\t \"#2\\[ \\t\\]*$hex in foo \\\\(\\\\) at \\[^\\r\\n\\]+\" \\\n+\t \"#3\\[ \\t\\]*$hex in main \\\\(\\\\) at \\[^\\r\\n\\]+\" ]\n+\n+# Backtrace with 'set disassemble-next-line on'.  This shouldn't make\n+# any difference to the backtrace.\n+gdb_test \"with disassemble-next-line on -- bt\" \\\n+    [multi_line \\\n+\t \"#0\\[ \\t\\]*baz \\\\(\\\\) at \\[^\\r\\n\\]+\" \\\n+\t \"#1\\[ \\t\\]*$hex in bar \\\\(\\\\) at \\[^\\r\\n\\]+\" \\\n+\t \"#2\\[ \\t\\]*$hex in foo \\\\(\\\\) at \\[^\\r\\n\\]+\" \\\n+\t \"#3\\[ \\t\\]*$hex in main \\\\(\\\\) at \\[^\\r\\n\\]+\" ]"
    }
  ]
}