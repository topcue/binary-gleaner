{
  "sha": "5f440116e87a4613b888ab3f42c014468bd625d9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWY0NDAxMTZlODdhNDYxM2I4ODhhYjNmNDJjMDE0NDY4YmQ2MjVkOQ==",
  "commit": {
    "author": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-01-29T08:05:20Z"
    },
    "committer": {
      "name": "Tankut Baris Aktemur",
      "email": "tankut.baris.aktemur@intel.com",
      "date": "2020-01-29T08:10:56Z"
    },
    "message": "testsuite, cp: add expected failures to pass-by-ref tests for certain compilers\n\nThere exist expected failures in the pass-by-ref.exp and\npass-by-ref-2.exp tests based on the GCC and Clang version.\n\n* GCC version <= 6 and Clang do not emit DW_AT_deleted and\n  DW_AT_defaulted.\n\n* Clang version >= 7 emits DW_AT_calling_convention, which helps the\n  debugger make the right calling convention decision in some cases\n  despite lacking the 'defaulted' and 'deleted' attributes.\n\nMark the related tests as XFAIL based on the compiler version.\n\nTested on X86_64 using GCC 5.5.0, 6.5.0, 7.4.0, 8.3.0, 9.2.1;\nand Clang 5.0.1, 6.0.0, 7.0.0, 8.0.0, 9.0.1, 10.0.0.\n\ngdb/testsuite/ChangeLog:\n2020-01-29  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n\n\t* gdb.cp/pass-by-ref-2.exp: Mark some tests as XFAIL based on the\n\tGCC/Clang version.\n\t* gdb.cp/pass-by-ref.exp: Ditto.\n\nChange-Id: I1d8440aa438049f7c4da7f4f76f201c48550f1e4",
    "tree": {
      "sha": "05d141ca3ef1739738ca5e484f242ff4e2bab1f3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/05d141ca3ef1739738ca5e484f242ff4e2bab1f3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5f440116e87a4613b888ab3f42c014468bd625d9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5f440116e87a4613b888ab3f42c014468bd625d9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5f440116e87a4613b888ab3f42c014468bd625d9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5f440116e87a4613b888ab3f42c014468bd625d9/comments",
  "author": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "barisaktemur",
    "id": 55686642,
    "node_id": "MDQ6VXNlcjU1Njg2NjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/55686642?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/barisaktemur",
    "html_url": "https://github.com/barisaktemur",
    "followers_url": "https://api.github.com/users/barisaktemur/followers",
    "following_url": "https://api.github.com/users/barisaktemur/following{/other_user}",
    "gists_url": "https://api.github.com/users/barisaktemur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/barisaktemur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/barisaktemur/subscriptions",
    "organizations_url": "https://api.github.com/users/barisaktemur/orgs",
    "repos_url": "https://api.github.com/users/barisaktemur/repos",
    "events_url": "https://api.github.com/users/barisaktemur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/barisaktemur/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ee2a6fc60413a2f5bc6641fd6d06f460c9deab3f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ee2a6fc60413a2f5bc6641fd6d06f460c9deab3f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ee2a6fc60413a2f5bc6641fd6d06f460c9deab3f"
    }
  ],
  "stats": {
    "total": 38,
    "additions": 38,
    "deletions": 0
  },
  "files": [
    {
      "sha": "dc938a2e738d3869873d6271240f5a69efa0397a",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f440116e87a4613b888ab3f42c014468bd625d9/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f440116e87a4613b888ab3f42c014468bd625d9/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=5f440116e87a4613b888ab3f42c014468bd625d9",
      "patch": "@@ -1,3 +1,9 @@\n+2020-01-29  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n+\n+\t* gdb.cp/pass-by-ref-2.exp: Mark some tests as XFAIL based on the\n+\tGCC/Clang version.\n+\t* gdb.cp/pass-by-ref.exp: Ditto.\n+\n 2020-01-29  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.threads/watchpoint-fork-child.c: Guard prints with #if DEBUG."
    },
    {
      "sha": "913f9af3ee76bd4a2ac91421d37b3526749693c3",
      "filename": "gdb/testsuite/gdb.cp/pass-by-ref-2.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f440116e87a4613b888ab3f42c014468bd625d9/gdb/testsuite/gdb.cp/pass-by-ref-2.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f440116e87a4613b888ab3f42c014468bd625d9/gdb/testsuite/gdb.cp/pass-by-ref-2.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.cp/pass-by-ref-2.exp?ref=5f440116e87a4613b888ab3f42c014468bd625d9",
      "patch": "@@ -42,6 +42,10 @@ if {![runto_main]} {\n     return -1\n }\n \n+# GCC version <= 6 and Clang do not emit DW_AT_defaulted and DW_AT_deleted.\n+set is_gcc_6_or_older [test_compiler_info {gcc-[0-6]-*}]\n+set is_clang [test_compiler_info {clang-*}]\n+\n set bp_location [gdb_get_line_number \"stop here\"]\n gdb_breakpoint $bp_location\n gdb_continue_to_breakpoint \"end of main\" \".*return .*;\"\n@@ -65,6 +69,7 @@ set sig \"\\\"Inlined\\:\\:Inlined\\\\(.*Inlined const\\&\\\\)\\\"\"\n gdb_test \"print cbvInlined (inlined)\" \\\n     \"expression cannot be evaluated .* \\\\(maybe inlined\\\\?\\\\)\"\n \n+if {$is_gcc_6_or_older || $is_clang} {setup_xfail \"*-*-*\"}\n gdb_test \"print cbvDtorDel (*dtorDel)\" \\\n     \".* cannot be evaluated .* 'DtorDel' is not destructible\" \\\n     \"type not destructible\"\n@@ -94,6 +99,7 @@ gdb_test \"print cbvTwoMCtor (twoMctor)\" \\\n     \".* cannot be evaluated .* 'TwoMCtor' is not copy constructible\" \\\n     \"copy ctor is implicitly deleted\"\n \n+if {$is_gcc_6_or_older || $is_clang} {setup_xfail \"*-*-*\"}\n gdb_test \"print cbvTwoMCtorAndCCtor (twoMctorAndCctor)\" \"12\" \\\n     \"call cbvTwoMCtorAndCCtor\"\n gdb_test \"print twoMctorAndCctor.x\" \"2\" \\"
    },
    {
      "sha": "06a36129e8330725c9a72bc0a68c472e6af98f5b",
      "filename": "gdb/testsuite/gdb.cp/pass-by-ref.exp",
      "status": "modified",
      "additions": 26,
      "deletions": 0,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5f440116e87a4613b888ab3f42c014468bd625d9/gdb/testsuite/gdb.cp/pass-by-ref.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5f440116e87a4613b888ab3f42c014468bd625d9/gdb/testsuite/gdb.cp/pass-by-ref.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.cp/pass-by-ref.exp?ref=5f440116e87a4613b888ab3f42c014468bd625d9",
      "patch": "@@ -369,6 +369,12 @@ proc test_for_class { prefix states cbvfun data_field length} {\n     global ADDED\n     global TRACE\n \n+    # GCC version <= 6 and Clang do not emit DW_AT_defaulted and DW_AT_deleted.\n+    set is_gcc_6_or_older [test_compiler_info {gcc-[0-6]-*}]\n+    set is_clang [test_compiler_info {clang-*}]\n+    # But Clang version >= 7 emits DW_AT_calling_convention for types.\n+    set is_clang_6_or_older [test_compiler_info {clang-[0-6]-*}]\n+\n     with_test_prefix $name {\n \tif {[is_copy_constructible $states]} {\n \t    set expected [expr {$ORIGINAL + $ADDED}]\n@@ -378,6 +384,19 @@ proc test_for_class { prefix states cbvfun data_field length} {\n \t    if {$dtor == \"explicit\"} {\n \t\tgdb_test \"print tracer = 0\" \" = 0\" \"reset the tracer\"\n \t    }\n+\n+\t    if {$cctor == \"defaultedIn\" || $dtor == \"defaultedIn\"} {\n+\t\tif {$is_gcc_6_or_older || $is_clang_6_or_older} {\n+\t\t    setup_xfail \"*-*-*\"\n+\t\t} elseif {$is_clang} {\n+\t\t    # If this is a pass-by-value case, Clang >= 7's\n+\t\t    # DW_AT_calling_convention leads to the right decision.\n+\t\t    # Otherwise, it is expected to fail.\n+\t\t    if {\"defaultedOut\" in $states || \"explicit\" in $states} {\n+\t\t\tsetup_xfail \"*-*-*\"\n+\t\t    }\n+\t\t}\n+\t    }\n \t    gdb_test \"print ${cbvfun}<$name> (${name}_var)\" \" = $expected\" \\\n \t\t\"call '$cbvfun'\"\n \t    gdb_test \"print ${name}_var.${data_field}\\[0\\]\" \" = $ORIGINAL\" \\\n@@ -389,10 +408,17 @@ proc test_for_class { prefix states cbvfun data_field length} {\n \t\t    \"cbv argument should not change (item $last_index)\"\n \t    }\n \t    if {$dtor == \"explicit\"} {\n+\t\tif {$cctor == \"defaultedIn\"\n+\t\t    && ($is_gcc_6_or_older || $is_clang)} {\n+\t\t    setup_xfail \"*-*-*\"\n+\t\t}\n \t\tgdb_test \"print tracer\" \" = $TRACE\" \\\n \t\t    \"destructor should be called\"\n \t    }\n \t} else {\n+\t    if {$cctor == \"deleted\" && ($is_gcc_6_or_older || $is_clang)} {\n+\t\tsetup_xfail \"*-*-*\"\n+\t    }\n \t    gdb_test \"print ${cbvfun}<$name> (${name}_var)\" \\\n \t\t\".* cannot be evaluated .* '${name}' is not copy constructible\" \\\n \t\t\"calling '$cbvfun' should be refused\""
    }
  ]
}