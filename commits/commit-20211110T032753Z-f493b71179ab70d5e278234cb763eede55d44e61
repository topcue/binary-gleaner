{
  "sha": "f493b71179ab70d5e278234cb763eede55d44e61",
  "node_id": "C_kwDOANOeidoAKGY0OTNiNzExNzlhYjcwZDVlMjc4MjM0Y2I3NjNlZWRlNTVkNDRlNjE",
  "commit": {
    "author": {
      "name": "Kevin Buettner",
      "email": "kevinb@redhat.com",
      "date": "2021-10-02T00:14:00Z"
    },
    "committer": {
      "name": "Kevin Buettner",
      "email": "kevinb@redhat.com",
      "date": "2021-11-10T03:27:53Z"
    },
    "message": "Test case for Bug 28308\n\nThe purpose of this test is described in the comments in\ndprintf-execution-x-script.exp.\n\nBug: https://sourceware.org/bugzilla/show_bug.cgi?id=28308\n\nThe name of this new test was based on that of an existing test,\nbp-cmds-execution-x-script.exp.  I started off by copying that test,\nadding to it, and then rewriting almost all of it.  It's different\nenough that I decided that listing the copyright year as 2021\nwas sufficient.",
    "tree": {
      "sha": "9e621ac5f1caa575e70c9fe8201042e786923562",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9e621ac5f1caa575e70c9fe8201042e786923562"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f493b71179ab70d5e278234cb763eede55d44e61",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f493b71179ab70d5e278234cb763eede55d44e61",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f493b71179ab70d5e278234cb763eede55d44e61",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f493b71179ab70d5e278234cb763eede55d44e61/comments",
  "author": {
    "login": "KevinBuettner",
    "id": 65747518,
    "node_id": "MDQ6VXNlcjY1NzQ3NTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/65747518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KevinBuettner",
    "html_url": "https://github.com/KevinBuettner",
    "followers_url": "https://api.github.com/users/KevinBuettner/followers",
    "following_url": "https://api.github.com/users/KevinBuettner/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinBuettner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KevinBuettner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinBuettner/subscriptions",
    "organizations_url": "https://api.github.com/users/KevinBuettner/orgs",
    "repos_url": "https://api.github.com/users/KevinBuettner/repos",
    "events_url": "https://api.github.com/users/KevinBuettner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KevinBuettner/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "KevinBuettner",
    "id": 65747518,
    "node_id": "MDQ6VXNlcjY1NzQ3NTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/65747518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KevinBuettner",
    "html_url": "https://github.com/KevinBuettner",
    "followers_url": "https://api.github.com/users/KevinBuettner/followers",
    "following_url": "https://api.github.com/users/KevinBuettner/following{/other_user}",
    "gists_url": "https://api.github.com/users/KevinBuettner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KevinBuettner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KevinBuettner/subscriptions",
    "organizations_url": "https://api.github.com/users/KevinBuettner/orgs",
    "repos_url": "https://api.github.com/users/KevinBuettner/repos",
    "events_url": "https://api.github.com/users/KevinBuettner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KevinBuettner/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9c95aea186b18310340915045189a4e39b8393ea",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9c95aea186b18310340915045189a4e39b8393ea",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9c95aea186b18310340915045189a4e39b8393ea"
    }
  ],
  "stats": {
    "total": 159,
    "additions": 159,
    "deletions": 0
  },
  "files": [
    {
      "sha": "339541337b34e8dabe75d500a3160729fce479b3",
      "filename": "gdb/testsuite/gdb.base/dprintf-execution-x-script.c",
      "status": "added",
      "additions": 53,
      "deletions": 0,
      "changes": 53,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f493b71179ab70d5e278234cb763eede55d44e61/gdb/testsuite/gdb.base/dprintf-execution-x-script.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f493b71179ab70d5e278234cb763eede55d44e61/gdb/testsuite/gdb.base/dprintf-execution-x-script.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/dprintf-execution-x-script.c?ref=f493b71179ab70d5e278234cb763eede55d44e61",
      "patch": "@@ -0,0 +1,53 @@\n+/* This testcase is part of GDB, the GNU debugger.\n+\n+   Copyright 2021 Free Software Foundation, Inc.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+#include <stdlib.h>\n+#include <stdio.h>\n+\n+volatile int vi = 0;\n+\n+void\n+inc_vi ()\n+{\n+  vi++;\n+}\n+\n+void\n+print_vi ()\n+{\n+  printf (\"vi=%d\\n\", vi);\n+}\n+\n+void\n+increment ()\n+{\n+  inc_vi ();\n+}\n+\n+int\n+main (int argc, char **argv)\n+{\n+  print_vi ();\n+  increment ();\n+  print_vi ();\n+  increment ();\n+  print_vi ();\n+  increment ();\n+  print_vi ();\n+\n+  exit (0);\n+}"
    },
    {
      "sha": "9133af752be8bf328245d1d220e8e129aadc7b02",
      "filename": "gdb/testsuite/gdb.base/dprintf-execution-x-script.exp",
      "status": "added",
      "additions": 85,
      "deletions": 0,
      "changes": 85,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f493b71179ab70d5e278234cb763eede55d44e61/gdb/testsuite/gdb.base/dprintf-execution-x-script.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f493b71179ab70d5e278234cb763eede55d44e61/gdb/testsuite/gdb.base/dprintf-execution-x-script.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/dprintf-execution-x-script.exp?ref=f493b71179ab70d5e278234cb763eede55d44e61",
      "patch": "@@ -0,0 +1,85 @@\n+# Copyright 2021 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+# Test that commands in a GDB script file run via GDB's -x flag work\n+# as expected.  Specifically, the script creates a dprintf breakpoint\n+# as well as a normal breakpoint that has \"continue\" in its command\n+# list, and then does \"run\".  Correct output from GDB is checked as\n+# part of this test.\n+\n+# Bail out if the target can't use the 'run' command.\n+if ![target_can_use_run_cmd] {\n+    return 0\n+}\n+\n+standard_testfile\n+\n+if {[build_executable \"failed to prepare\" $testfile $srcfile debug]} {\n+    return -1\n+}\n+\n+# This is the name of the GDB script to load.\n+set x_file ${srcdir}/${subdir}/$testfile.gdb\n+\n+# Create context in which the global, GDBFLAGS, will be restored at\n+# the end of the block.  All commands run within the block are\n+# actually run in the outer context.  (This is why 'res' is available\n+# outside of the save_vars block.)\n+save_vars { GDBFLAGS } {\n+    # Set flags with which to start GDB.\n+    append GDBFLAGS \" -ex \\\"set height unlimited\\\"\"\n+    append GDBFLAGS \" -x \\\"$x_file\\\"\"\n+    append GDBFLAGS \" --args \\\"$binfile\\\"\"\n+\n+    # Start GDB with above flags.\n+    set res [gdb_spawn]\n+}\n+\n+set test \"load and run script with -x\"\n+if { $res != 0} {\n+    fail $test\n+    return -1\n+}\n+\n+# The script loaded via -x contains a run command; while running, GDB\n+# is expected to print three messages from dprintf breakpoints along\n+# with three interspersed messages from an ordinary breakpoint (which\n+# was set up with a continue command).  Set up pattern D to match\n+# output from hitting the dprintf breakpoint and B for the ordinary\n+# breakpoint.  Then set PAT to contain the entire pattern of expected\n+# output from the interspersed dprintf and ordinary breakpoints along\n+# with some (additional) expected output from the dprintf breakpoints,\n+# i.e. 0, 1, and 2.\n+set d \"dprintf in increment.., vi=\"\n+set b \"Breakpoint ., inc_vi\"\n+set pat \"${d}0.*?$b.*?${d}1.*?$b.*?${d}2.*?$b.*?\"\n+\n+proc do_test {cmd test} {\n+    gdb_test $cmd \"$::pat$::inferior_exited_re normally.*\" $test\n+}\n+\n+# Check output from running script with -x\n+do_test \"\" $test\n+\n+# Restart GDB and 'source' the script; this will (still) run the program\n+# due to the 'run' command in the script.\n+clean_restart $binfile\n+do_test \"source $x_file\" \"load and run script using source command\"\n+\n+# This should leave us at the gdb prompt; Run program again using\n+# already established breakpoints, i.e. those loaded from the\n+# script.  Prior to fixing PR 28308, this was the only test that\n+# would pass.\n+do_test \"run\" \"run again\""
    },
    {
      "sha": "83e7f21da42dd6afceef5c6dde5dce173bdeb2c7",
      "filename": "gdb/testsuite/gdb.base/dprintf-execution-x-script.gdb",
      "status": "added",
      "additions": 21,
      "deletions": 0,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f493b71179ab70d5e278234cb763eede55d44e61/gdb/testsuite/gdb.base/dprintf-execution-x-script.gdb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f493b71179ab70d5e278234cb763eede55d44e61/gdb/testsuite/gdb.base/dprintf-execution-x-script.gdb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/dprintf-execution-x-script.gdb?ref=f493b71179ab70d5e278234cb763eede55d44e61",
      "patch": "@@ -0,0 +1,21 @@\n+# Copyright 2021 Free Software Foundation, Inc.\n+\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+dprintf increment, \"dprintf in increment(), vi=%d\\n\", vi\n+break inc_vi\n+commands\n+  continue\n+end\n+run"
    }
  ]
}