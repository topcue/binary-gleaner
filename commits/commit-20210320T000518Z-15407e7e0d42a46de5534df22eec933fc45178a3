{
  "sha": "15407e7e0d42a46de5534df22eec933fc45178a3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTU0MDdlN2UwZDQyYTQ2ZGU1NTM0ZGYyMmVlYzkzM2ZjNDUxNzhhMw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-19T23:52:37Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-20T00:05:18Z"
    },
    "message": "DWARF LTO debug sections vs. .stabstr\n\nThe exception for debug sections in clearing SEC_EXCLUDE when\nrelocatable was really for one specific debug section, so let's make\nit do just that.\n\nbfd/\n\tPR 27590\n\t* elf.c (_bfd_elf_make_section_from_shdr): Remove SHF_EXCLUDE\n\ttest for .gnu.debuglto*.\nld/\n\tPR 27590\n\t* ldlang.c (lang_gc_sections): Clear SEC_EXCLUDE when relocatable\n\tfor all sections except .stabstr.",
    "tree": {
      "sha": "82ce351900575c29f868e779a046e98d803ac73c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/82ce351900575c29f868e779a046e98d803ac73c"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/15407e7e0d42a46de5534df22eec933fc45178a3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/15407e7e0d42a46de5534df22eec933fc45178a3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/15407e7e0d42a46de5534df22eec933fc45178a3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/15407e7e0d42a46de5534df22eec933fc45178a3/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6536577167960d0d98ee5d0ccbb3ba70c2db2f9a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6536577167960d0d98ee5d0ccbb3ba70c2db2f9a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6536577167960d0d98ee5d0ccbb3ba70c2db2f9a"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 17,
    "deletions": 7
  },
  "files": [
    {
      "sha": "90ec96bacbf60b6908cf0b2c43e2ffa28417a0bd",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/15407e7e0d42a46de5534df22eec933fc45178a3/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/15407e7e0d42a46de5534df22eec933fc45178a3/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=15407e7e0d42a46de5534df22eec933fc45178a3",
      "patch": "@@ -1,7 +1,13 @@\n+2021-03-20  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27590\n+\t* elf.c (_bfd_elf_make_section_from_shdr): Remove SHF_EXCLUDE\n+\ttest for .gnu.debuglto*.\n+\n 2021-03-18  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/27590\n-\t* elf.c (_bfd_elf_make_section_from_shdr): Treate\n+\t* elf.c (_bfd_elf_make_section_from_shdr): Treat\n \t.gnu.debuglto_.debug_ section as debugging section unless it is\n \tmarked with SHF_EXCLUDE.\n \t* elflink.c (elf_create_symbuf): Revert commit 994b2513281."
    },
    {
      "sha": "381951da12cc6ee865a2396e7fe9a61b4989eda1",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 1,
      "deletions": 4,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/15407e7e0d42a46de5534df22eec933fc45178a3/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/15407e7e0d42a46de5534df22eec933fc45178a3/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=15407e7e0d42a46de5534df22eec933fc45178a3",
      "patch": "@@ -1085,10 +1085,7 @@ _bfd_elf_make_section_from_shdr (bfd *abfd,\n       if (name [0] == '.')\n \t{\n \t  if (strncmp (name, \".debug\", 6) == 0\n-\t      /* NB: Treate .gnu.debuglto_.debug_ section as debugging\n-\t\t section unless it is marked with SHF_EXCLUDE.  */\n-\t      || ((flags & SEC_EXCLUDE) == 0\n-\t\t  && strncmp (name, \".gnu.debuglto_.debug_\", 21) == 0)\n+\t      || strncmp (name, \".gnu.debuglto_.debug_\", 21) == 0\n \t      || strncmp (name, \".gnu.linkonce.wi.\", 17) == 0\n \t      || strncmp (name, \".zdebug\", 7) == 0)\n \t    flags |= SEC_DEBUGGING | SEC_ELF_OCTETS;"
    },
    {
      "sha": "0be65fc38866d82f91169373ac4e364bf6e44935",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/15407e7e0d42a46de5534df22eec933fc45178a3/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/15407e7e0d42a46de5534df22eec933fc45178a3/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=15407e7e0d42a46de5534df22eec933fc45178a3",
      "patch": "@@ -1,3 +1,9 @@\n+2021-03-20  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27590\n+\t* ldlang.c (lang_gc_sections): Clear SEC_EXCLUDE when relocatable\n+\tfor all sections except .stabstr.\n+\n 2021-03-19  Alan Modra  <amodra@gmail.com>\n \n \tPR 27590"
    },
    {
      "sha": "df8a5d17acacb7bdc31a1c8f27973f1e2e1d87d2",
      "filename": "ld/ldlang.c",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/15407e7e0d42a46de5534df22eec933fc45178a3/ld/ldlang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/15407e7e0d42a46de5534df22eec933fc45178a3/ld/ldlang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.c?ref=15407e7e0d42a46de5534df22eec933fc45178a3",
      "patch": "@@ -7565,7 +7565,7 @@ lang_gc_sections (void)\n   lang_gc_sections_1 (statement_list.head);\n \n   /* SEC_EXCLUDE is ignored when doing a relocatable link, except in\n-     the special case of debug info.  (See bfd/stabs.c)\n+     the special case of .stabstr debug info.  (See bfd/stabs.c)\n      Twiddle the flag here, to simplify later linker code.  */\n   if (bfd_link_relocatable (&link_info))\n     {\n@@ -7577,7 +7577,8 @@ lang_gc_sections (void)\n \t    continue;\n #endif\n \t  for (sec = f->the_bfd->sections; sec != NULL; sec = sec->next)\n-\t    if ((sec->flags & SEC_DEBUGGING) == 0)\n+\t    if ((sec->flags & SEC_DEBUGGING) == 0\n+\t\t|| strcmp (sec->name, \".stabstr\") != 0)\n \t      sec->flags &= ~SEC_EXCLUDE;\n \t}\n     }"
    }
  ]
}