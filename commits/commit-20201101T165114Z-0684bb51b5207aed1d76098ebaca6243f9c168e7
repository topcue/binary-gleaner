{
  "sha": "0684bb51b5207aed1d76098ebaca6243f9c168e7",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDY4NGJiNTFiNTIwN2FlZDFkNzYwOThlYmFjYTYyNDNmOWMxNjhlNw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-11-01T16:51:13Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-11-01T16:51:14Z"
    },
    "message": "Remove partial symbol statistics\n\nThe \"n_psyms\" statistic in the per-objfile stats is not really needed,\nbut its use requires passing the objfile to add_psymbol.  This patch\nremoves the field in favor of counting the psyms when needed.\n\nNote that this is not exactly equivalent -- in the old approach, a\npsymbol can in theory be created and then the psymtab discarded, which\nwould increment the counter.  This does not seem very important to me.\n\nI rewrote the code to count partial symbols; though TBH I think that\nthis information is not really very useful.\n\ngdb/ChangeLog\n2020-11-01  Tom Tromey  <tom@tromey.com>\n\n\t* symmisc.c (count_psyms): New function.\n\t(print_objfile_statistics): Use it.\n\t* psymtab.c (append_psymbol_to_list): Remove.\n\t(partial_symtab::add_psymbol): Inline append_psymbol_to_list.\n\t* objfiles.h (struct objstats) <n_psyms>: Remove.",
    "tree": {
      "sha": "84024f5fc2d6abce09f3b97de805617f342804bc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/84024f5fc2d6abce09f3b97de805617f342804bc"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0684bb51b5207aed1d76098ebaca6243f9c168e7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0684bb51b5207aed1d76098ebaca6243f9c168e7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0684bb51b5207aed1d76098ebaca6243f9c168e7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0684bb51b5207aed1d76098ebaca6243f9c168e7/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "089002bba03cf3f546dd63f98e763254ae04d7c1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/089002bba03cf3f546dd63f98e763254ae04d7c1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/089002bba03cf3f546dd63f98e763254ae04d7c1"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 28,
    "deletions": 17
  },
  "files": [
    {
      "sha": "f34932d16b84578b494430b7bc9a41cfd5558597",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=0684bb51b5207aed1d76098ebaca6243f9c168e7",
      "patch": "@@ -1,3 +1,11 @@\n+2020-11-01  Tom Tromey  <tom@tromey.com>\n+\n+\t* symmisc.c (count_psyms): New function.\n+\t(print_objfile_statistics): Use it.\n+\t* psymtab.c (append_psymbol_to_list): Remove.\n+\t(partial_symtab::add_psymbol): Inline append_psymbol_to_list.\n+\t* objfiles.h (struct objstats) <n_psyms>: Remove.\n+\n 2020-11-01  Tom Tromey  <tom@tromey.com>\n \n \t* dbxread.c (dbx_end_psymtab): Update."
    },
    {
      "sha": "bf3d7fcf25399f8ba2ef10d160834d850df9246a",
      "filename": "gdb/objfiles.h",
      "status": "modified",
      "additions": 0,
      "deletions": 3,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/objfiles.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/objfiles.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.h?ref=0684bb51b5207aed1d76098ebaca6243f9c168e7",
      "patch": "@@ -194,9 +194,6 @@ struct obj_section\n \n struct objstats\n {\n-  /* Number of partial symbols read.  */\n-  int n_psyms = 0;\n-\n   /* Number of full symbols read.  */\n   int n_syms = 0;\n "
    },
    {
      "sha": "dc802a60f3cc2b02687d50efca3122e1e42e8856",
      "filename": "gdb/psymtab.c",
      "status": "modified",
      "additions": 1,
      "deletions": 12,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/psymtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/psymtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psymtab.c?ref=0684bb51b5207aed1d76098ebaca6243f9c168e7",
      "patch": "@@ -1523,17 +1523,6 @@ add_psymbol_to_bcache (const partial_symbol &psymbol, struct objfile *objfile,\n \t  (&psymbol, sizeof (struct partial_symbol), added));\n }\n \n-/* Helper function, adds partial symbol to the given partial symbol list.  */\n-\n-static void\n-append_psymbol_to_list (std::vector<partial_symbol *> &list,\n-\t\t\tstruct partial_symbol *psym,\n-\t\t\tstruct objfile *objfile)\n-{\n-  list.push_back (psym);\n-  OBJSTAT (objfile, n_psyms++);\n-}\n-\n /* See psympriv.h.  */\n \n void\n@@ -1555,7 +1544,7 @@ partial_symtab::add_psymbol (const partial_symbol &psymbol,\n     = (where == psymbol_placement::STATIC\n        ? static_psymbols\n        : global_psymbols);\n-  append_psymbol_to_list (list, psym, objfile);\n+  list.push_back (psym);\n }\n \n /* See psympriv.h.  */"
    },
    {
      "sha": "8d748b9ebf7b77476666ae41cebca59eee6bce12",
      "filename": "gdb/symmisc.c",
      "status": "modified",
      "additions": 19,
      "deletions": 2,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/symmisc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0684bb51b5207aed1d76098ebaca6243f9c168e7/gdb/symmisc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symmisc.c?ref=0684bb51b5207aed1d76098ebaca6243f9c168e7",
      "patch": "@@ -39,6 +39,7 @@\n #include \"readline/tilde.h\"\n \n #include \"psymtab.h\"\n+#include \"psympriv.h\"\n \n /* Unfortunately for debugging, stderr is usually a macro.  This is painful\n    when calling functions that take FILE *'s from the debugger.\n@@ -73,6 +74,20 @@ print_symbol_bcache_statistics (void)\n       }\n }\n \n+/* Count the number of partial symbols in OBJFILE.  */\n+\n+static int\n+count_psyms (struct objfile *objfile)\n+{\n+  int count = 0;\n+  for (partial_symtab *pst : objfile->psymtabs ())\n+    {\n+      count += pst->global_psymbols.size ();\n+      count += pst->static_psymbols.size ();\n+    }\n+  return count;\n+}\n+\n void\n print_objfile_statistics (void)\n {\n@@ -89,9 +104,11 @@ print_objfile_statistics (void)\n \tif (objfile->per_bfd->n_minsyms > 0)\n \t  printf_filtered (_(\"  Number of \\\"minimal\\\" symbols read: %d\\n\"),\n \t\t\t   objfile->per_bfd->n_minsyms);\n-\tif (OBJSTAT (objfile, n_psyms) > 0)\n+\n+\tint n_psyms = count_psyms (objfile);\n+\tif (n_psyms > 0)\n \t  printf_filtered (_(\"  Number of \\\"partial\\\" symbols read: %d\\n\"),\n-\t\t\t   OBJSTAT (objfile, n_psyms));\n+\t\t\t   n_psyms);\n \tif (OBJSTAT (objfile, n_syms) > 0)\n \t  printf_filtered (_(\"  Number of \\\"full\\\" symbols read: %d\\n\"),\n \t\t\t   OBJSTAT (objfile, n_syms));"
    }
  ]
}