{
  "sha": "4111f652f955028e8219fad2d60af1fd22aa29ee",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDExMWY2NTJmOTU1MDI4ZTgyMTlmYWQyZDYwYWYxZmQyMmFhMjllZQ==",
  "commit": {
    "author": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2020-05-19T17:36:24Z"
    },
    "committer": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2020-05-19T17:36:51Z"
    },
    "message": "Eliminate target_fileio_open_warn_if_slow\n\nThis basically makes target_fileio_open_1 extern, renamed to\ntarget_fileio_open, and eliminates the current\ntarget_fileio_open_warn_if_slow and target_fileio_open.\n\nA following parameter will want to change gdb_bfd_iovec_fileio_open,\nthe only caller of target_fileio_open_warn_if_slow, to pass down\n\"warn_if_slow\" true/false from the caller, instead of hardcoding\n\"warn_if_slow\" true.\n\ngdb/ChangeLog:\n2020-05-19  Pedro Alves  <palves@redhat.com>\n\n\t* gdb_bfd.c (gdb_bfd_iovec_fileio_open): Adjust.\n\t* target.c (target_fileio_open_1): Rename to target_fileio_open\n\tand make extern.  Use bool.\n\t(target_fileio_open, target_fileio_open_warn_if_slow): Delete.\n\t(target_fileio_read_alloc_1): Adjust.\n\t* target.h (target_fileio_open): Add 'warn_if_slow' parameter.\n\t(target_fileio_open_warn_if_slow): Delete declaration.",
    "tree": {
      "sha": "d50f5be0ada132550b4096402f2afbf560f17430",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d50f5be0ada132550b4096402f2afbf560f17430"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4111f652f955028e8219fad2d60af1fd22aa29ee",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4111f652f955028e8219fad2d60af1fd22aa29ee",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4111f652f955028e8219fad2d60af1fd22aa29ee",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4111f652f955028e8219fad2d60af1fd22aa29ee/comments",
  "author": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ad80db5b9f7c95105c78d3ab439678184d1b7177",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ad80db5b9f7c95105c78d3ab439678184d1b7177",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ad80db5b9f7c95105c78d3ab439678184d1b7177"
    }
  ],
  "stats": {
    "total": 72,
    "additions": 26,
    "deletions": 46
  },
  "files": [
    {
      "sha": "643b4eba61b26732ab1fcf43d068869b5a030561",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=4111f652f955028e8219fad2d60af1fd22aa29ee",
      "patch": "@@ -1,3 +1,13 @@\n+2020-05-19  Pedro Alves  <palves@redhat.com>\n+\n+\t* gdb_bfd.c (gdb_bfd_iovec_fileio_open): Adjust.\n+\t* target.c (target_fileio_open_1): Rename to target_fileio_open\n+\tand make extern.  Use bool.\n+\t(target_fileio_open, target_fileio_open_warn_if_slow): Delete.\n+\t(target_fileio_read_alloc_1): Adjust.\n+\t* target.h (target_fileio_open): Add 'warn_if_slow' parameter.\n+\t(target_fileio_open_warn_if_slow): Delete declaration.\n+\n 2020-05-19  Pedro Alves  <palves@redhat.com>\n \n \t* gdb_bfd.h: (gdb_bfd_open): Default to 'fd' parameter to -1."
    },
    {
      "sha": "61872a0bf3d5d03f7ea16e1c86207f8705b0b11f",
      "filename": "gdb/gdb_bfd.c",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/gdb_bfd.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/gdb_bfd.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdb_bfd.c?ref=4111f652f955028e8219fad2d60af1fd22aa29ee",
      "patch": "@@ -284,11 +284,10 @@ gdb_bfd_iovec_fileio_open (struct bfd *abfd, void *inferior)\n \n   gdb_assert (is_target_filename (filename));\n \n-  fd = target_fileio_open_warn_if_slow ((struct inferior *) inferior,\n-\t\t\t\t\tfilename\n-\t\t\t\t\t+ strlen (TARGET_SYSROOT_PREFIX),\n-\t\t\t\t\tFILEIO_O_RDONLY, 0,\n-\t\t\t\t\t&target_errno);\n+  fd = target_fileio_open ((struct inferior *) inferior,\n+\t\t\t   filename + strlen (TARGET_SYSROOT_PREFIX),\n+\t\t\t   FILEIO_O_RDONLY, 0, true,\n+\t\t\t   &target_errno);\n   if (fd == -1)\n     {\n       errno = fileio_errno_to_host (target_errno);"
    },
    {
      "sha": "82c405a849172a08e678b6efdc2278028933d0e8",
      "filename": "gdb/target.c",
      "status": "modified",
      "additions": 5,
      "deletions": 28,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/target.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/target.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target.c?ref=4111f652f955028e8219fad2d60af1fd22aa29ee",
      "patch": "@@ -2775,13 +2775,11 @@ target_ops::fileio_readlink (struct inferior *inf, const char *filename,\n   return {};\n }\n \n-/* Helper for target_fileio_open and\n-   target_fileio_open_warn_if_slow.  */\n+/* See target.h.  */\n \n-static int\n-target_fileio_open_1 (struct inferior *inf, const char *filename,\n-\t\t      int flags, int mode, int warn_if_slow,\n-\t\t      int *target_errno)\n+int\n+target_fileio_open (struct inferior *inf, const char *filename,\n+\t\t    int flags, int mode, bool warn_if_slow, int *target_errno)\n {\n   for (target_ops *t = default_fileio_target (); t != NULL; t = t->beneath ())\n     {\n@@ -2813,27 +2811,6 @@ target_fileio_open_1 (struct inferior *inf, const char *filename,\n \n /* See target.h.  */\n \n-int\n-target_fileio_open (struct inferior *inf, const char *filename,\n-\t\t    int flags, int mode, int *target_errno)\n-{\n-  return target_fileio_open_1 (inf, filename, flags, mode, 0,\n-\t\t\t       target_errno);\n-}\n-\n-/* See target.h.  */\n-\n-int\n-target_fileio_open_warn_if_slow (struct inferior *inf,\n-\t\t\t\t const char *filename,\n-\t\t\t\t int flags, int mode, int *target_errno)\n-{\n-  return target_fileio_open_1 (inf, filename, flags, mode, 1,\n-\t\t\t       target_errno);\n-}\n-\n-/* See target.h.  */\n-\n int\n target_fileio_pwrite (int fd, const gdb_byte *write_buf, int len,\n \t\t      ULONGEST offset, int *target_errno)\n@@ -3036,7 +3013,7 @@ target_fileio_read_alloc_1 (struct inferior *inf, const char *filename,\n   int target_errno;\n \n   scoped_target_fd fd (target_fileio_open (inf, filename, FILEIO_O_RDONLY,\n-\t\t\t\t\t   0700, &target_errno));\n+\t\t\t\t\t   0700, false, &target_errno));\n   if (fd.get () == -1)\n     return -1;\n "
    },
    {
      "sha": "37bfb29882a4c53f2c6932f6c067bbbb1e1672d2",
      "filename": "gdb/target.h",
      "status": "modified",
      "additions": 7,
      "deletions": 13,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/target.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4111f652f955028e8219fad2d60af1fd22aa29ee/gdb/target.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target.h?ref=4111f652f955028e8219fad2d60af1fd22aa29ee",
      "patch": "@@ -2135,21 +2135,15 @@ extern int target_search_memory (CORE_ADDR start_addr,\n   current_top_target ()->filesystem_is_local ()\n \n /* Open FILENAME on the target, in the filesystem as seen by INF,\n-   using FLAGS and MODE.  If INF is NULL, use the filesystem seen\n-   by the debugger (GDB or, for remote targets, the remote stub).\n-   Return a target file descriptor, or -1 if an error occurs (and\n-   set *TARGET_ERRNO).  */\n+   using FLAGS and MODE.  If INF is NULL, use the filesystem seen by\n+   the debugger (GDB or, for remote targets, the remote stub).  Return\n+   a target file descriptor, or -1 if an error occurs (and set\n+   *TARGET_ERRNO).  If WARN_IF_SLOW is true, print a warning message\n+   if the file is being accessed over a link that may be slow.  */\n extern int target_fileio_open (struct inferior *inf,\n \t\t\t       const char *filename, int flags,\n-\t\t\t       int mode, int *target_errno);\n-\n-/* Like target_fileio_open, but print a warning message if the\n-   file is being accessed over a link that may be slow.  */\n-extern int target_fileio_open_warn_if_slow (struct inferior *inf,\n-\t\t\t\t\t    const char *filename,\n-\t\t\t\t\t    int flags,\n-\t\t\t\t\t    int mode,\n-\t\t\t\t\t    int *target_errno);\n+\t\t\t       int mode, bool warn_if_slow,\n+\t\t\t       int *target_errno);\n \n /* Write up to LEN bytes from WRITE_BUF to FD on the target.\n    Return the number of bytes written, or -1 if an error occurs"
    }
  ]
}