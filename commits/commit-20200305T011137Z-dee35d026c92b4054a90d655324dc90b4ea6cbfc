{
  "sha": "dee35d026c92b4054a90d655324dc90b4ea6cbfc",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGVlMzVkMDI2YzkyYjQwNTRhOTBkNjU1MzI0ZGM5MGI0ZWE2Y2JmYw==",
  "commit": {
    "author": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2020-03-04T05:08:05Z"
    },
    "committer": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2020-03-05T01:11:37Z"
    },
    "message": "RISC-V: Support assembler modifier %got_pcrel_hi.\n\n\tgas/\n\t* config/tc-riscv.c: Support the modifier %got_pcrel_hi.\n\t* doc/c-riscv.texi: Add documentation.\n\t* testsuite/gas/riscv/no-relax-reloc.d: Add test case for the new\n\tmodifier %got_pcrel_hi.\n\t* testsuite/gas/riscv/no-relax-reloc.s: Likewise.\n\t* testsuite/gas/riscv/relax-reloc.d: Likewise.\n\t* testsuite/gas/riscv/relax-reloc.s: Likewise.",
    "tree": {
      "sha": "a5f9654e612006b23bc8922a0fd903282e21ec32",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a5f9654e612006b23bc8922a0fd903282e21ec32"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/dee35d026c92b4054a90d655324dc90b4ea6cbfc",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dee35d026c92b4054a90d655324dc90b4ea6cbfc",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/dee35d026c92b4054a90d655324dc90b4ea6cbfc",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dee35d026c92b4054a90d655324dc90b4ea6cbfc/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "de48783e2fbb57e39b9931b1eceef28a1ad1eeaf",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/de48783e2fbb57e39b9931b1eceef28a1ad1eeaf",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/de48783e2fbb57e39b9931b1eceef28a1ad1eeaf"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 45,
    "deletions": 7
  },
  "files": [
    {
      "sha": "859f01fae7915fdf1bc21f4d504ec5ccd088f06d",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -1,5 +1,14 @@\n 2020-03-04  Nelson Chu  <nelson.chu@sifive.com>\n \n+\t* config/tc-riscv.c (percent_op_utype): Support the modifier\n+\t%got_pcrel_hi.\n+\t* doc/c-riscv.texi: Add documentation.\n+\t* testsuite/gas/riscv/no-relax-reloc.d: Add test case for the new\n+\tmodifier %got_pcrel_hi.\n+\t* testsuite/gas/riscv/no-relax-reloc.s: Likewise.\n+\t* testsuite/gas/riscv/relax-reloc.d: Likewise.\n+\t* testsuite/gas/riscv/relax-reloc.s: Likewise.\n+\n \t* doc/c-riscv.texi (relocation modifiers): Add documentation.\n \t(RISC-V-Formats): Update the section name from \"Instruction Formats\"\n \tto \"RISC-V Instruction Formats\"."
    },
    {
      "sha": "168561e7b562e2a285dc2d812bf7b71a515628d2",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -1308,6 +1308,7 @@ static const struct percent_op_match percent_op_utype[] =\n {\n   {\"%tprel_hi\", BFD_RELOC_RISCV_TPREL_HI20},\n   {\"%pcrel_hi\", BFD_RELOC_RISCV_PCREL_HI20},\n+  {\"%got_pcrel_hi\", BFD_RELOC_RISCV_GOT_HI20},\n   {\"%tls_ie_pcrel_hi\", BFD_RELOC_RISCV_TLS_GOT_HI20},\n   {\"%tls_gd_pcrel_hi\", BFD_RELOC_RISCV_TLS_GD_HI20},\n   {\"%hi\", BFD_RELOC_RISCV_HI20},"
    },
    {
      "sha": "488cf56051fa5f73629503cb33a4866a098f1d48",
      "filename": "gas/doc/c-riscv.texi",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/doc/c-riscv.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/doc/c-riscv.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/doc/c-riscv.texi?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -257,6 +257,23 @@ Or you can use the pseudo lla/lw/sw/... instruction to do this.\n \tlla  a0, @var{symbol}\n @end smallexample\n \n+@item %got_pcrel_hi(@var{symbol})\n+The high 20 bits of relative address between pc and the GOT entry of\n+@var{symbol}.  This is usually used with the %pcrel_lo modifier to access\n+the GOT entry.\n+\n+@smallexample\n+@var{label}:\n+\tauipc      a0, %got_pcrel_hi(@var{symbol}) // R_RISCV_GOT_HI20\n+\taddi       a0, a0, %pcrel_lo(@var{label})  // R_RISCV_PCREL_LO12_I\n+\n+@var{label}:\n+\tauipc      a0, %got_pcrel_hi(@var{symbol}) // R_RISCV_GOT_HI20\n+\tload/store a0, %pcrel_lo(@var{label})(a0)  // R_RISCV_PCREL_LO12_I/S\n+@end smallexample\n+\n+Also, the pseudo la instruction with PIC has similar behavior.\n+\n @item %tprel_add(@var{symbol})\n This is used purely to associate the R_RISCV_TPREL_ADD relocation for\n TLS relaxation.  This one is only valid as the fourth operand to the normally"
    },
    {
      "sha": "c2ca1aa6e7213dcc6b82816398db1d5f87c23783",
      "filename": "gas/testsuite/gas/riscv/no-relax-reloc.d",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/no-relax-reloc.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/no-relax-reloc.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/no-relax-reloc.d?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -9,4 +9,6 @@ RELOCATION RECORDS FOR .*\n 0+4 R_RISCV_LO12_I.*\n 0+8 R_RISCV_PCREL_HI20.*\n 0+c R_RISCV_PCREL_LO12_I.*\n-0+10 R_RISCV_CALL.*\n+0+10 R_RISCV_GOT_HI20.*\n+0+14 R_RISCV_PCREL_LO12_I.*\n+0+18 R_RISCV_CALL.*"
    },
    {
      "sha": "2aab995769c018f056a3934a2e87f36d9304a333",
      "filename": "gas/testsuite/gas/riscv/no-relax-reloc.s",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/no-relax-reloc.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/no-relax-reloc.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/no-relax-reloc.s?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -2,7 +2,10 @@ target:\n \tlui\ta5,%hi(target)\n \tlw\ta5,%lo(target)(a5)\n \n-        .LA0: auipc     a5,%pcrel_hi(bar)\n-        lw      a0,%pcrel_lo(.LA0)(a5)\n+\t.LA0: auipc     a5,%pcrel_hi(symbol1)\n+\tlw      a0,%pcrel_lo(.LA0)(a5)\n+\n+\t.LA1: auipc     a5,%got_pcrel_hi(symbol2)\n+\tlw      a0,%pcrel_lo(.LA1)(a5)\n \n \tcall target"
    },
    {
      "sha": "623218ec5d15271d002e1186c9b6a26df8d1f49e",
      "filename": "gas/testsuite/gas/riscv/relax-reloc.d",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/relax-reloc.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/relax-reloc.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/relax-reloc.d?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -13,5 +13,8 @@ RELOCATION RECORDS FOR .*\n 0+8 R_RISCV_RELAX.*\n 0+c R_RISCV_PCREL_LO12_I.*\n 0+c R_RISCV_RELAX.*\n-0+10 R_RISCV_CALL.*\n-0+10 R_RISCV_RELAX.*\n+0+10 R_RISCV_GOT_HI20.*\n+0+14 R_RISCV_PCREL_LO12_I.*\n+0+14 R_RISCV_RELAX.*\n+0+18 R_RISCV_CALL.*\n+0+18 R_RISCV_RELAX.*"
    },
    {
      "sha": "2aab995769c018f056a3934a2e87f36d9304a333",
      "filename": "gas/testsuite/gas/riscv/relax-reloc.s",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/relax-reloc.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dee35d026c92b4054a90d655324dc90b4ea6cbfc/gas/testsuite/gas/riscv/relax-reloc.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/relax-reloc.s?ref=dee35d026c92b4054a90d655324dc90b4ea6cbfc",
      "patch": "@@ -2,7 +2,10 @@ target:\n \tlui\ta5,%hi(target)\n \tlw\ta5,%lo(target)(a5)\n \n-        .LA0: auipc     a5,%pcrel_hi(bar)\n-        lw      a0,%pcrel_lo(.LA0)(a5)\n+\t.LA0: auipc     a5,%pcrel_hi(symbol1)\n+\tlw      a0,%pcrel_lo(.LA0)(a5)\n+\n+\t.LA1: auipc     a5,%got_pcrel_hi(symbol2)\n+\tlw      a0,%pcrel_lo(.LA1)(a5)\n \n \tcall target"
    }
  ]
}