{
  "sha": "6173d6a696349bd934166b4694c24f4eda7362c0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjE3M2Q2YTY5NjM0OWJkOTM0MTY2YjQ2OTRjMjRmNGVkYTczNjJjMA==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-05-06T03:27:48Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-05-06T03:27:48Z"
    },
    "message": "[gdb/testsuite] Compile compile-ifunc.c with -Wno-attribute-alias\n\nConsider the following test-case:\n...\n$ cat 1.c\ntypedef int (*final_t) (int arg);\nint final (int arg)\n  { return arg + 1; }\nfinal_t gnu_ifunc (void)\n  { return final; }\nint gnu_ifunc_alias (int) __attribute__ ((ifunc (\"gnu_ifunc\")));\nint main (void)\n  { return gnu_ifunc_alias (10); }\n...\nwith result:\n...\n$ gcc 1.c\n$ ./a.out; echo $?\n11\n...\n\nThe test-case uses the ifunc attribute, but there's another solution using\n%gnu_indirect_function.  Consider 2.c and 3.c:\n...\n$ cat 2.c\ntypedef int (*final_t) (int arg);\nint final (int arg)\n  { return arg + 1; }\nasm (\".type gnu_ifunc, %gnu_indirect_function\");\nfinal_t gnu_ifunc (void)\n  { return final; }\n$ cat 3.c\nextern int gnu_ifunc (int);\nint main (void)\n  { return gnu_ifunc (10); }\n...\n\nHowever, it can be inconvenient to have seperate files for the incompatible\ndecls of gnu_ifunc, so we can use this in a single file like this:\n...\n$ cat 4.c\ntypedef int (*final_t) (int arg);\nint final (int arg)\n  { return arg + 1; }\nasm (\".type gnu_ifunc, %gnu_indirect_function\");\nfinal_t gnu_ifunc (void)\n  { return final; }\nextern int gnu_ifunc_alias (int arg) __attribute__ ((alias (\"gnu_ifunc\")));\nint main (void)\n  { return gnu_ifunc_alias (10); }\n...\n\nThis alias trick works ok at -O0, but not at -O2:\n...\n$ gcc 4.c\n$ ./a.out; echo $?\n11\n$ gcc 4.c\n$ ./a.out; echo $?\n176\n...\nand produces a warning with gcc-8 and later:\n...\n$ gcc-8 4.c\n4.c:7:12: warning: 'gnu_ifunc_alias' alias between functions of incompatible \\\n  types 'int(int)' and 'int (*(void))(int)' [-Wattribute-alias]\n extern int gnu_ifunc_alias (int arg) __attribute__ ((alias (\"gnu_ifunc\")));\n            ^~~~~~~~~~~~~~~\n4.c:5:9: note: aliased declaration here\n final_t gnu_ifunc (void)\n         ^~~~~~~~~\n...\nThe warning is correct, but the mismatch is intentional.\n\nThe last variant (%gnu_indirect_function + alias) is used in\ngdb.compile/compile-ifunc.c, so we run into the warning with recent gcc.\n\nFix the warning by compiling with -Wno-attribute-alias.\n\nTested the test-case on x86_64-linux with gcc-10, and observed I no longer see\nthe warning:\n...\nRunning src/gdb/testsuite/gdb.compile/compile-ifunc.exp ...\n\n                === gdb Summary ===\n\nnr of untested testcases         1\n...\n\ngdb/testsuite/ChangeLog:\n\n2020-05-06  Tom de Vries  <tdevries@suse.de>\n\n\t* gdb.compile/compile-ifunc.exp: Use -Wno-attribute-alias.",
    "tree": {
      "sha": "be0a1432221f4db1c52631cd842cf5a9ef137220",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/be0a1432221f4db1c52631cd842cf5a9ef137220"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6173d6a696349bd934166b4694c24f4eda7362c0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6173d6a696349bd934166b4694c24f4eda7362c0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6173d6a696349bd934166b4694c24f4eda7362c0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6173d6a696349bd934166b4694c24f4eda7362c0/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4167d44ce29deff5b9826a289b593c92aa14dad3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4167d44ce29deff5b9826a289b593c92aa14dad3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4167d44ce29deff5b9826a289b593c92aa14dad3"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 14,
    "deletions": 2
  },
  "files": [
    {
      "sha": "7b88b3a469c482ee8ce1578cd31635871eae10c8",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6173d6a696349bd934166b4694c24f4eda7362c0/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6173d6a696349bd934166b4694c24f4eda7362c0/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=6173d6a696349bd934166b4694c24f4eda7362c0",
      "patch": "@@ -1,3 +1,7 @@\n+2020-05-06  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gdb.compile/compile-ifunc.exp: Use -Wno-attribute-alias.\n+\n 2020-05-04  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.base/async.exp: Check whether instruction addresses are a"
    },
    {
      "sha": "9239c5adf1ef0abd86cb82b496ec063790d7917d",
      "filename": "gdb/testsuite/gdb.compile/compile-ifunc.exp",
      "status": "modified",
      "additions": 10,
      "deletions": 2,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6173d6a696349bd934166b4694c24f4eda7362c0/gdb/testsuite/gdb.compile/compile-ifunc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6173d6a696349bd934166b4694c24f4eda7362c0/gdb/testsuite/gdb.compile/compile-ifunc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.compile/compile-ifunc.exp?ref=6173d6a696349bd934166b4694c24f4eda7362c0",
      "patch": "@@ -19,9 +19,16 @@ if {[skip_ifunc_tests]} {\n \n standard_testfile\n \n+get_compiler_info\n+set flags \"\"\n+if [test_compiler_info gcc*] {\n+    set flags additional_flags=-Wno-attribute-alias\n+}\n+\n with_test_prefix \"nodebug\" {\n \n-    if { [prepare_for_testing \"failed to prepare\" \"$testfile-nodebug\" $srcfile {}] } {\n+    if { [prepare_for_testing \"failed to prepare\" \"$testfile-nodebug\" \\\n+\t      $srcfile $flags] } {\n \treturn -1\n     }\n \n@@ -51,7 +58,8 @@ with_test_prefix \"nodebug\" {\n \n with_test_prefix \"debug\" {\n \n-    if { [prepare_for_testing \"failed to prepare\" \"$testfile-debug\" $srcfile] } {\n+    if { [prepare_for_testing \"failed to prepare\" \"$testfile-debug\" \\\n+\t      $srcfile \"debug $flags\"] } {\n \treturn -1\n     }\n "
    }
  ]
}