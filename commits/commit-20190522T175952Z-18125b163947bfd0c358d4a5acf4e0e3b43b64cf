{
  "sha": "18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTgxMjViMTYzOTQ3YmZkMGMzNThkNGE1YWNmNGUwZTNiNDNiNjRjZg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-05-14T14:04:22Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-05-22T17:59:52Z"
    },
    "message": "Add \"style\" proc to the test suite\n\nThis adds a \"style\" helper proc to the test suite, and updates\nexisting style tests to use it.  Thanks to Sergio for the idea.\n\nTested on x86-64 Fedora 29.\n\ngdb/testsuite/ChangeLog\n2019-05-22  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.base/info-shared.exp (check_info_shared): Use \"style\".\n\t* gdb.base/style.exp: Use \"style\".\n\t* lib/gdb-utils.exp (style): New proc.",
    "tree": {
      "sha": "38476e9c4b49f58f798ad1b176f4b2cc72e20778",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/38476e9c4b49f58f798ad1b176f4b2cc72e20778"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "af1a8d038798bef11471e28d999ad1687312a6a7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/af1a8d038798bef11471e28d999ad1687312a6a7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/af1a8d038798bef11471e28d999ad1687312a6a7"
    }
  ],
  "stats": {
    "total": 43,
    "additions": 35,
    "deletions": 8
  },
  "files": [
    {
      "sha": "2950a41b4cbdba7d27d9f9f5a2b406db075a9b15",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
      "patch": "@@ -1,3 +1,9 @@\n+2019-05-22  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.base/info-shared.exp (check_info_shared): Use \"style\".\n+\t* gdb.base/style.exp: Use \"style\".\n+\t* lib/gdb-utils.exp (style): New proc.\n+\n 2019-05-22  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.base/align.exp: Require c++11."
    },
    {
      "sha": "c21f3c36f503135b6ab20c3ab3d15a0dde6d80b3",
      "filename": "gdb/testsuite/gdb.base/info-shared.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/gdb.base/info-shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/gdb.base/info-shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/info-shared.exp?ref=18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
      "patch": "@@ -161,8 +161,10 @@ with_test_prefix styled {\n \n \t# Simple test for \"info sharedlibrary\" styling.  Look for styled\n \t# addresses and file name.\n-\tset addr \"\\033\\\\\\[34m${hex}\\033\\\\\\[m\"\n-\tset sofile \"\\033\\\\\\[32m\\[^\\033\\]+\\033\\\\\\[m\"\n+\tset addr [style $hex address]\n+\t# Use a non-greedy match here to avoid accidentally picking up\n+\t# other escape sequences.\n+\tset sofile [style \".*?\" file]\n \tgdb_test_no_output \"set style enabled on\"\n \tgdb_test \"info sharedlibrary\" \\\n \t    \"$addr\\[ \\t\\]+$addr.*$sofile\\r\\n.*\""
    },
    {
      "sha": "15de05cdafb68b5cccb27c69f6a7963a1e797bd0",
      "filename": "gdb/testsuite/gdb.base/style.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/gdb.base/style.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/gdb.base/style.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/style.exp?ref=18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
      "patch": "@@ -41,10 +41,10 @@ save_vars { env(TERM) } {\n \n     gdb_test_no_output \"set style enabled on\"\n \n-    set main_expr \"\\033\\\\\\[33mmain\\033\\\\\\[m\"\n-    set base_file_expr \"\\033\\\\\\[32m.*style\\\\.c\\033\\\\\\[m\"\n+    set main_expr [style main function]\n+    set base_file_expr [style \".*style\\\\.c\" file]\n     set file_expr \"$base_file_expr:\\[0-9\\]\"\n-    set arg_expr \"\\033\\\\\\[36marg.\\033\\\\\\[m\"\n+    set arg_expr [style \"arg.\" variable]\n \n     gdb_test \"frame\" \\\n \t\"$main_expr.*$arg_expr.*$arg_expr.*$file_expr.*\"\n@@ -58,7 +58,7 @@ save_vars { env(TERM) } {\n \n     gdb_test \"break main\" \"file $base_file_expr.*\"\n \n-    gdb_test \"print &main\" \" = .* \\033\\\\\\[34m$hex\\033\\\\\\[m <$main_expr>\"\n+    gdb_test \"print &main\" \" = .* [style $hex address] <$main_expr>\"\n \n     # Regression test for a bug where line-wrapping would occur at the\n     # wrong spot with styling.  There were different bugs at different\n@@ -86,11 +86,12 @@ save_vars { env(TERM) } {\n     gdb_exit\n     gdb_spawn\n \n-    gdb_test \"\" \"\\033\\\\\\[35;1mGNU gdb.*\\033\\\\\\[m.*\" \\\n+    set vers [style \"GNU gdb.*\" \"35;1\"]\n+    gdb_test \"\" \"${vers}.*\" \\\n \t\"version is styled\"\n \n     set quoted [string_to_regexp $binfile]\n     gdb_test \"file $binfile\" \\\n-\t\"Reading symbols from \\033\\\\\\[32m${quoted}\\033\\\\\\[m...\" \\\n+\t\"Reading symbols from [style $quoted file]...\" \\\n \t\"filename is styled when loading symbol file\"\n }"
    },
    {
      "sha": "a6567884426ac358e535a8130518f0fc845e70de",
      "filename": "gdb/testsuite/lib/gdb-utils.exp",
      "status": "modified",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/lib/gdb-utils.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/18125b163947bfd0c358d4a5acf4e0e3b43b64cf/gdb/testsuite/lib/gdb-utils.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb-utils.exp?ref=18125b163947bfd0c358d4a5acf4e0e3b43b64cf",
      "patch": "@@ -37,3 +37,21 @@ proc string_to_regexp {str} {\n     regsub -all {[]*+.|(){}^$\\[\\\\]} $str {\\\\&} result\n     return $result\n }\n+\n+# Wrap STR in an ANSI terminal escape sequences -- one to set the\n+# style to STYLE, and one to reset the style to the default.  The\n+# return value is suitable for use as a regular expression.\n+\n+# STYLE can either be the payload part of an ANSI terminal sequence,\n+# or a shorthand for one of the gdb standard styles: \"file\",\n+# \"function\", \"variable\", or \"address\".\n+\n+proc style {str style} {\n+    switch -exact -- $style {\n+\tfile { set style 32 }\n+\tfunction { set style 33 }\n+\tvariable { set style 36 }\n+\taddress { set style 34 }\n+    }\n+    return \"\\033\\\\\\[${style}m${str}\\033\\\\\\[m\"\n+}"
    }
  ]
}