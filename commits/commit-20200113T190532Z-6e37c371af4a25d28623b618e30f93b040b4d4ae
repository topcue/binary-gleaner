{
  "sha": "6e37c371af4a25d28623b618e30f93b040b4d4ae",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmUzN2MzNzFhZjRhMjVkMjg2MjNiNjE4ZTMwZjkzYjA0MGI0ZDRhZQ==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-01-13T19:05:32Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-01-13T19:05:32Z"
    },
    "message": "gdbserver: set IP_AGENT_EXPORT_FUNC to static when not building IPA, add declarations\n\nFixing the -Wmissing-declarations errors in gdbserver's tracepoint.c is\na bit tricky, because some functions are compiled for both gdbserver, in\nwhich case they should be static, since they are only used in that file,\nand for libinproctrace.so, in which case they should be externally\nvisible, since they need to be looked up.  In the case where they are\nexternally visible, -Wmissing-declarations requires that a declaration\nexists (that's the point of the warning).\n\nI've reused the IP_AGENT_EXPORT_FUNC macro to mark the functions as\nstatic when compiled for gdbserver.  Some seemingly unnecessary\ndeclarations are added for when compiling libinproctrace.so (thanks to\nTom for the suggestion).\n\ngdb/gdbserver/ChangeLog:\n\n\t* tracepoint.h (IP_AGENT_EXPORT_FUNC) [!IN_PROCESS_AGENT]:\n\tDefine to static.\n\t* tracepoint.c (stop_tracing, flush_trace_buffer,\n\tabout_to_request_buffer_space, get_trace_state_variable_value,\n\tset_trace_state_variable_value, gdb_collect): Add declaration.\n\nChange-Id: If9c66151bd00c3b9c5caa27a7c21c5a3a952de2a",
    "tree": {
      "sha": "13b5d5b60eadbbeeb69fb9b7c5dbda6791a2d80d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/13b5d5b60eadbbeeb69fb9b7c5dbda6791a2d80d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6e37c371af4a25d28623b618e30f93b040b4d4ae",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6e37c371af4a25d28623b618e30f93b040b4d4ae",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6e37c371af4a25d28623b618e30f93b040b4d4ae",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6e37c371af4a25d28623b618e30f93b040b4d4ae/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "df4a0200dc896abe32bef4172ca047465caaedfe",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/df4a0200dc896abe32bef4172ca047465caaedfe",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/df4a0200dc896abe32bef4172ca047465caaedfe"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 29,
    "deletions": 1
  },
  "files": [
    {
      "sha": "233bc621369e62538d10fdb6a0f92f201c42236b",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6e37c371af4a25d28623b618e30f93b040b4d4ae/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6e37c371af4a25d28623b618e30f93b040b4d4ae/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=6e37c371af4a25d28623b618e30f93b040b4d4ae",
      "patch": "@@ -1,3 +1,11 @@\n+2020-01-13  Simon Marchi  <simon.marchi@efficios.com>\n+\n+\t* tracepoint.h (IP_AGENT_EXPORT_FUNC) [!IN_PROCESS_AGENT]:\n+\tDefine to static.\n+\t* tracepoint.c (stop_tracing, flush_trace_buffer,\n+\tabout_to_request_buffer_space, get_trace_state_variable_value,\n+\tset_trace_state_variable_value, gdb_collect): Add declaration.\n+\n 2020-01-13  Simon Marchi  <simon.marchi@efficios.com>\n \n \t* linux-x86-low.c (x86_linux_regs_info, amd64_emit_eq_goto,"
    },
    {
      "sha": "bbca48b2efd36c2bd3f9b427b6f293eec94398f2",
      "filename": "gdb/gdbserver/tracepoint.c",
      "status": "modified",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6e37c371af4a25d28623b618e30f93b040b4d4ae/gdb/gdbserver/tracepoint.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6e37c371af4a25d28623b618e30f93b040b4d4ae/gdb/gdbserver/tracepoint.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/tracepoint.c?ref=6e37c371af4a25d28623b618e30f93b040b4d4ae",
      "patch": "@@ -370,13 +370,19 @@ read_inferior_memory (CORE_ADDR memaddr, unsigned char *myaddr, int len)\n #  define UNKNOWN_SIDE_EFFECTS() do {} while (0)\n #endif\n \n+/* This is needed for -Wmissing-declarations.  */\n+IP_AGENT_EXPORT_FUNC void stop_tracing (void);\n+\n IP_AGENT_EXPORT_FUNC void\n stop_tracing (void)\n {\n   /* GDBserver places breakpoint here.  */\n   UNKNOWN_SIDE_EFFECTS();\n }\n \n+/* This is needed for -Wmissing-declarations.  */\n+IP_AGENT_EXPORT_FUNC void flush_trace_buffer (void);\n+\n IP_AGENT_EXPORT_FUNC void\n flush_trace_buffer (void)\n {\n@@ -1496,6 +1502,9 @@ init_trace_buffer (LONGEST bufsize)\n \n #ifdef IN_PROCESS_AGENT\n \n+/* This is needed for -Wmissing-declarations.  */\n+IP_AGENT_EXPORT_FUNC void about_to_request_buffer_space (void);\n+\n IP_AGENT_EXPORT_FUNC void\n about_to_request_buffer_space (void)\n {\n@@ -2091,6 +2100,9 @@ create_trace_state_variable (int num, int gdb)\n   return tsv;\n }\n \n+/* This is needed for -Wmissing-declarations.  */\n+IP_AGENT_EXPORT_FUNC LONGEST get_trace_state_variable_value (int num);\n+\n IP_AGENT_EXPORT_FUNC LONGEST\n get_trace_state_variable_value (int num)\n {\n@@ -2117,6 +2129,10 @@ get_trace_state_variable_value (int num)\n   return tsv->value;\n }\n \n+/* This is needed for -Wmissing-declarations.  */\n+IP_AGENT_EXPORT_FUNC void set_trace_state_variable_value (int num,\n+\t\t\t\t\t\t\t  LONGEST val);\n+\n IP_AGENT_EXPORT_FUNC void\n set_trace_state_variable_value (int num, LONGEST val)\n {\n@@ -5786,6 +5802,10 @@ EXTERN_C_PUSH\n IP_AGENT_EXPORT_VAR collecting_t *collecting;\n EXTERN_C_POP\n \n+/* This is needed for -Wmissing-declarations.  */\n+IP_AGENT_EXPORT_FUNC void gdb_collect (struct tracepoint *tpoint,\n+\t\t\t\t       unsigned char *regs);\n+\n /* This routine, called from the jump pad (in asm) is designed to be\n    called from the jump pads of fast tracepoints, thus it is on the\n    critical path.  */"
    },
    {
      "sha": "030b2a9234459d86e070a51d562aa9b6c73c3f4e",
      "filename": "gdb/gdbserver/tracepoint.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6e37c371af4a25d28623b618e30f93b040b4d4ae/gdb/gdbserver/tracepoint.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6e37c371af4a25d28623b618e30f93b040b4d4ae/gdb/gdbserver/tracepoint.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/tracepoint.h?ref=6e37c371af4a25d28623b618e30f93b040b4d4ae",
      "patch": "@@ -62,7 +62,7 @@ void initialize_tracepoint (void);\n # define IP_AGENT_EXPORT_VAR EXPORTED_SYMBOL ATTR_USED\n # define IP_AGENT_EXPORT_VAR_DECL EXTERN_C EXPORTED_SYMBOL\n #else\n-# define IP_AGENT_EXPORT_FUNC\n+# define IP_AGENT_EXPORT_FUNC static\n # define IP_AGENT_EXPORT_VAR\n # define IP_AGENT_EXPORT_VAR_DECL extern\n #endif"
    }
  ]
}