{
  "sha": "629c2962801801338b35c68554d30aa4455e6c0c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjI5YzI5NjI4MDE4MDEzMzhiMzVjNjg1NTRkMzBhYTQ0NTVlNmMwYw==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-02-11T15:46:23Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-02-11T15:46:23Z"
    },
    "message": "gdbsupport: use AM_GDB_WARNINGS\n\nSince gdbsupport has been given its own build system, it is no longer\ncompiled with the warning flags specified in gdb/warning.m4.\n\nThis patch makes it use AM_GDB_WARNINGS.\n\ngdbsupport/ChangeLog:\n\n\t* acinclude.m4: Include ../gdb/warning.m4.\n\t* configure.ac: Use AM_GDB_WARNINGS.\n\t* Makefile.am: Set AM_CFLAGS to WARN_CFLAGS and WERROR_CFLAGS.\n\t* Makefile.in: Re-generate.\n\t* configure: Re-generate.",
    "tree": {
      "sha": "e6f257819b81397fdef34ddcaa9e1594b7e5b6c9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e6f257819b81397fdef34ddcaa9e1594b7e5b6c9"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/629c2962801801338b35c68554d30aa4455e6c0c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/629c2962801801338b35c68554d30aa4455e6c0c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/629c2962801801338b35c68554d30aa4455e6c0c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/629c2962801801338b35c68554d30aa4455e6c0c/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "da5bd37ebc6d9816be970d8a668a6a04508774c8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/da5bd37ebc6d9816be970d8a668a6a04508774c8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/da5bd37ebc6d9816be970d8a668a6a04508774c8"
    }
  ],
  "stats": {
    "total": 216,
    "additions": 215,
    "deletions": 1
  },
  "files": [
    {
      "sha": "4a820acf527ed2ec4d907cb9e705ca617ea22e9b",
      "filename": "gdbsupport/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/ChangeLog?ref=629c2962801801338b35c68554d30aa4455e6c0c",
      "patch": "@@ -1,3 +1,11 @@\n+2020-02-11  Simon Marchi  <simon.marchi@efficios.com>\n+\n+\t* acinclude.m4: Include ../gdb/warning.m4.\n+\t* configure.ac: Use AM_GDB_WARNINGS.\n+\t* Makefile.am: Set AM_CFLAGS to WARN_CFLAGS and WERROR_CFLAGS.\n+\t* Makefile.in: Re-generate.\n+\t* configure: Re-generate.\n+\n 2020-02-10  Tom de Vries  <tdevries@suse.de>\n \n \t* environ.c (gdb_environ::set): Cast concat NULL sentinel to char *."
    },
    {
      "sha": "cd7b0adf6b4c00628f6d6aa9eaf0aa26f8214ef0",
      "filename": "gdbsupport/Makefile.am",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/Makefile.am",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/Makefile.am",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/Makefile.am?ref=629c2962801801338b35c68554d30aa4455e6c0c",
      "patch": "@@ -29,6 +29,8 @@ override CXX += $(CXX_DIALECT)\n override CC := $(CXX)\n override CFLAGS := $(CXXFLAGS)\n \n+AM_CFLAGS = $(WARN_CFLAGS) $(WERROR_CFLAGS)\n+\n noinst_LIBRARIES = libgdbsupport.a\n \n if SELFTEST"
    },
    {
      "sha": "91164175bc0462f314e295e7e5711ebf29cbf008",
      "filename": "gdbsupport/Makefile.in",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/Makefile.in?ref=629c2962801801338b35c68554d30aa4455e6c0c",
      "patch": "@@ -124,7 +124,8 @@ am__aclocal_m4_deps = $(top_srcdir)/../config/codeset.m4 \\\n \t$(top_srcdir)/../gdb/ax_cxx_compile_stdcxx.m4 \\\n \t$(top_srcdir)/../gdb/libiberty.m4 \\\n \t$(top_srcdir)/../gdb/selftest.m4 \\\n-\t$(top_srcdir)/../gdb/ptrace.m4 $(top_srcdir)/configure.ac\n+\t$(top_srcdir)/../gdb/ptrace.m4 $(top_srcdir)/../gdb/warning.m4 \\\n+\t$(top_srcdir)/configure.ac\n am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \\\n \t$(ACLOCAL_M4)\n DIST_COMMON = $(srcdir)/Makefile.am $(top_srcdir)/configure \\\n@@ -287,6 +288,8 @@ SHELL = @SHELL@\n STRIP = @STRIP@\n USE_NLS = @USE_NLS@\n VERSION = @VERSION@\n+WARN_CFLAGS = @WARN_CFLAGS@\n+WERROR_CFLAGS = @WERROR_CFLAGS@\n XGETTEXT = @XGETTEXT@\n abs_builddir = @abs_builddir@\n abs_srcdir = @abs_srcdir@\n@@ -350,6 +353,7 @@ AM_CPPFLAGS = -I$(srcdir)/../include -I$(srcdir)/../gdb \\\n     -I../gnulib/import -I$(srcdir)/../gnulib/import \\\n     -I.. -I$(srcdir)/.. $(INCINTL) -I../bfd -I$(srcdir)/../bfd\n \n+AM_CFLAGS = $(WARN_CFLAGS) $(WERROR_CFLAGS)\n noinst_LIBRARIES = libgdbsupport.a\n @SELFTEST_TRUE@selftest = selftest.c\n libgdbsupport_a_SOURCES = \\"
    },
    {
      "sha": "3598b201b94b882c1da0ef4edfc22d6a1cc1a527",
      "filename": "gdbsupport/acinclude.m4",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/acinclude.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/acinclude.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/acinclude.m4?ref=629c2962801801338b35c68554d30aa4455e6c0c",
      "patch": "@@ -5,3 +5,6 @@ m4_include([../gdb/ax_cxx_compile_stdcxx.m4])\n m4_include([../gdb/libiberty.m4])\n m4_include([../gdb/selftest.m4])\n m4_include([../gdb/ptrace.m4])\n+\n+dnl This gets AM_GDB_WARNINGS.\n+m4_include(../gdb/warning.m4)"
    },
    {
      "sha": "197749b5d0ca38358c96e2fb7b96911e1ec17974",
      "filename": "gdbsupport/configure",
      "status": "modified",
      "additions": 194,
      "deletions": 0,
      "changes": 194,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/configure?ref=629c2962801801338b35c68554d30aa4455e6c0c",
      "patch": "@@ -624,6 +624,8 @@ ac_subst_vars='am__EXEEXT_FALSE\n am__EXEEXT_TRUE\n LTLIBOBJS\n LIBOBJS\n+WERROR_CFLAGS\n+WARN_CFLAGS\n SELFTEST_FALSE\n SELFTEST_TRUE\n LTLIBIPT\n@@ -769,6 +771,9 @@ with_gnu_ld\n enable_rpath\n with_libipt_prefix\n enable_unit_tests\n+enable_werror\n+enable_build_warnings\n+enable_gdb_build_warnings\n '\n       ac_precious_vars='build_alias\n host_alias\n@@ -1415,6 +1420,11 @@ Optional Features:\n   --disable-rpath         do not hardcode runtime library paths\n   --enable-unit-tests     Enable the inclusion of unit tests when compiling\n                           GDB\n+  --enable-werror         treat compile warnings as errors\n+  --enable-build-warnings enable build-time compiler warnings if gcc is used\n+  --enable-gdb-build-warnings\n+                          enable GDB specific build-time compiler warnings if\n+                          gcc is used\n \n Optional Packages:\n   --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]\n@@ -10806,6 +10816,190 @@ _ACEOF\n fi\n \n \n+# Detect support warning flags.\n+\n+# Check whether --enable-werror was given.\n+if test \"${enable_werror+set}\" = set; then :\n+  enableval=$enable_werror; case \"${enableval}\" in\n+     yes | y) ERROR_ON_WARNING=\"yes\" ;;\n+     no | n)  ERROR_ON_WARNING=\"no\" ;;\n+     *) as_fn_error $? \"bad value ${enableval} for --enable-werror\" \"$LINENO\" 5 ;;\n+   esac\n+fi\n+\n+\n+# Enable -Werror by default when using gcc.  Turn it off for releases.\n+if test \"${GCC}\" = yes -a -z \"${ERROR_ON_WARNING}\" && $development; then\n+    ERROR_ON_WARNING=yes\n+fi\n+\n+WERROR_CFLAGS=\"\"\n+if test \"${ERROR_ON_WARNING}\" = yes ; then\n+    WERROR_CFLAGS=\"-Werror\"\n+fi\n+\n+# The options we'll try to enable.\n+build_warnings=\"-Wall -Wpointer-arith \\\n+-Wno-unused -Wunused-value -Wunused-variable -Wunused-function \\\n+-Wno-switch -Wno-char-subscripts \\\n+-Wempty-body -Wunused-but-set-parameter -Wunused-but-set-variable \\\n+-Wno-sign-compare -Wno-error=maybe-uninitialized \\\n+-Wno-mismatched-tags \\\n+-Wno-error=deprecated-register \\\n+-Wsuggest-override \\\n+-Wimplicit-fallthrough=3 \\\n+-Wduplicated-cond \\\n+-Wshadow=local \\\n+-Wdeprecated-copy \\\n+-Wdeprecated-copy-dtor \\\n+-Wredundant-move \\\n+-Wmissing-declarations\"\n+\n+case \"${host}\" in\n+  *-*-mingw32*)\n+    # Enable -Wno-format by default when using gcc on mingw since many\n+    # GCC versions complain about %I64.\n+    build_warnings=\"$build_warnings -Wno-format\" ;;\n+  *-*-solaris*)\n+    # Solaris 11.4 <python2.7/ceval.h> uses #pragma no_inline that GCC\n+    # doesn't understand.\n+    build_warnings=\"$build_warnings -Wno-unknown-pragmas\"\n+    # Solaris 11 <unistd.h> marks vfork deprecated.\n+    build_warnings=\"$build_warnings -Wno-deprecated-declarations\" ;;\n+  *)\n+    # Note that gcc requires -Wformat for -Wformat-nonliteral to work,\n+    # but there's a special case for this below.\n+    build_warnings=\"$build_warnings -Wformat-nonliteral\" ;;\n+esac\n+\n+# Check whether --enable-build-warnings was given.\n+if test \"${enable_build_warnings+set}\" = set; then :\n+  enableval=$enable_build_warnings; case \"${enableval}\" in\n+  yes)\t;;\n+  no)\tbuild_warnings=\"-w\";;\n+  ,*)   t=`echo \"${enableval}\" | sed -e \"s/,/ /g\"`\n+        build_warnings=\"${build_warnings} ${t}\";;\n+  *,)   t=`echo \"${enableval}\" | sed -e \"s/,/ /g\"`\n+        build_warnings=\"${t} ${build_warnings}\";;\n+  *)    build_warnings=`echo \"${enableval}\" | sed -e \"s/,/ /g\"`;;\n+esac\n+if test x\"$silent\" != x\"yes\" && test x\"$build_warnings\" != x\"\"; then\n+  echo \"Setting compiler warning flags = $build_warnings\" 6>&1\n+fi\n+fi\n+# Check whether --enable-gdb-build-warnings was given.\n+if test \"${enable_gdb_build_warnings+set}\" = set; then :\n+  enableval=$enable_gdb_build_warnings; case \"${enableval}\" in\n+  yes)\t;;\n+  no)\tbuild_warnings=\"-w\";;\n+  ,*)   t=`echo \"${enableval}\" | sed -e \"s/,/ /g\"`\n+        build_warnings=\"${build_warnings} ${t}\";;\n+  *,)   t=`echo \"${enableval}\" | sed -e \"s/,/ /g\"`\n+        build_warnings=\"${t} ${build_warnings}\";;\n+  *)    build_warnings=`echo \"${enableval}\" | sed -e \"s/,/ /g\"`;;\n+esac\n+if test x\"$silent\" != x\"yes\" && test x\"$build_warnings\" != x\"\"; then\n+  echo \"Setting GDB specific compiler warning flags = $build_warnings\" 6>&1\n+fi\n+fi\n+\n+# The set of warnings supported by a C++ compiler is not the same as\n+# of the C compiler.\n+ac_ext=cpp\n+ac_cpp='$CXXCPP $CPPFLAGS'\n+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu\n+\n+\n+WARN_CFLAGS=\"\"\n+if test \"x${build_warnings}\" != x -a \"x$GCC\" = xyes\n+then\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: checking compiler warning flags\" >&5\n+$as_echo_n \"checking compiler warning flags... \" >&6; }\n+    # Separate out the -Werror flag as some files just cannot be\n+    # compiled with it enabled.\n+    for w in ${build_warnings}; do\n+\t# GCC does not complain about -Wno-unknown-warning.  Invert\n+\t# and test -Wunknown-warning instead.\n+\tcase $w in\n+\t-Wno-*)\n+\t\twtest=`echo $w | sed 's/-Wno-/-W/g'` ;;\n+        -Wformat-nonliteral)\n+\t\t# gcc requires -Wformat before -Wformat-nonliteral\n+\t\t# will work, so stick them together.\n+\t\tw=\"-Wformat $w\"\n+\t\twtest=\"$w\"\n+\t\t;;\n+\t*)\n+\t\twtest=$w ;;\n+\tesac\n+\n+\tcase $w in\n+\t-Werr*) WERROR_CFLAGS=-Werror ;;\n+\t*)\n+\t    # Check whether GCC accepts it.\n+\t    saved_CFLAGS=\"$CFLAGS\"\n+\t    CFLAGS=\"$CFLAGS -Werror $wtest\"\n+\t    saved_CXXFLAGS=\"$CXXFLAGS\"\n+\t    CXXFLAGS=\"$CXXFLAGS -Werror $wtest\"\n+\t    if test \"x$w\" = \"x-Wunused-variable\"; then\n+\t      # Check for https://gcc.gnu.org/bugzilla/show_bug.cgi?id=38958,\n+\t      # fixed in GCC 4.9.  This test is derived from the gdb\n+\t      # source code that triggered this bug in GCC.\n+\t      cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+struct scoped_restore_base {};\n+                 struct scoped_restore_tmpl : public scoped_restore_base {\n+\t\t   ~scoped_restore_tmpl() {}\n+\t\t };\n+int\n+main ()\n+{\n+const scoped_restore_base &b = scoped_restore_tmpl();\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_cxx_try_compile \"$LINENO\"; then :\n+  WARN_CFLAGS=\"${WARN_CFLAGS} $w\"\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t    else\n+\t      cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n+/* end confdefs.h.  */\n+\n+int\n+main ()\n+{\n+\n+  ;\n+  return 0;\n+}\n+_ACEOF\n+if ac_fn_cxx_try_compile \"$LINENO\"; then :\n+  WARN_CFLAGS=\"${WARN_CFLAGS} $w\"\n+fi\n+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext\n+\t    fi\n+\t    CFLAGS=\"$saved_CFLAGS\"\n+\t    CXXFLAGS=\"$saved_CXXFLAGS\"\n+\tesac\n+    done\n+    { $as_echo \"$as_me:${as_lineno-$LINENO}: result: ${WARN_CFLAGS} ${WERROR_CFLAGS}\" >&5\n+$as_echo \"${WARN_CFLAGS} ${WERROR_CFLAGS}\" >&6; }\n+fi\n+\n+\n+\n+ac_ext=c\n+ac_cpp='$CPP $CPPFLAGS'\n+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'\n+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'\n+ac_compiler_gnu=$ac_cv_c_compiler_gnu\n+\n+\n+\n TARGET_WORD_SIZE=`sed -n 's,#define BFD_ARCH_SIZE \\(.*\\)$,\\1,p' ../bfd/bfd-in3.h`\n \n cat >>confdefs.h <<_ACEOF"
    },
    {
      "sha": "401e16f821da462b81d39f9a949b0b419165780b",
      "filename": "gdbsupport/configure.ac",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/629c2962801801338b35c68554d30aa4455e6c0c/gdbsupport/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/configure.ac?ref=629c2962801801338b35c68554d30aa4455e6c0c",
      "patch": "@@ -48,6 +48,9 @@ AM_CONDITIONAL(SELFTEST, $enable_unittests)\n # Check the return and argument types of ptrace.\n GDB_AC_PTRACE\n \n+# Detect support warning flags.\n+AM_GDB_WARNINGS\n+\n TARGET_WORD_SIZE=`sed -n 's,#define BFD_ARCH_SIZE \\(.*\\)$,\\1,p' ../bfd/bfd-in3.h`\n AC_DEFINE_UNQUOTED(TARGET_WORD_SIZE, $TARGET_WORD_SIZE,\n    [Define to the word size for the target.])"
    }
  ]
}