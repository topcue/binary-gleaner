{
  "sha": "10c19fadfd45da5262d2f8b9624be71c274ff15d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTBjMTlmYWRmZDQ1ZGE1MjYyZDJmOGI5NjI0YmU3MWMyNzRmZjE1ZA==",
  "commit": {
    "author": {
      "name": "Shahab Vahedi",
      "email": "shahab@synopsys.com",
      "date": "2020-11-12T11:50:33Z"
    },
    "committer": {
      "name": "Shahab Vahedi",
      "email": "shahab@synopsys.com",
      "date": "2020-11-12T16:00:55Z"
    },
    "message": "arc: Write correct \"eret\" value during register collection\n\nIn collect_register() function of arc-linux-tdep.c, the \"eret\"\n(exception return) register value was not being reported correctly.\nThis patch fixes that.\n\nBackground:\nWhen asked for the \"pc\" value, we have to update the \"eret\" register\nwith GDB's STOP_PC.  The \"eret\" instructs the kernel code where to\njump back when an instruction has stopped due to a breakpoint.  This\nis how collect_register() was doing so:\n\n--------------8<--------------\n  if (regnum == gdbarch_pc_regnum (gdbarch))\n    regnum = ARC_ERET_REGNUM;\n  regcache->raw_collect (regnum, buf + arc_linux_core_reg_offsets[regnum]);\n-------------->8--------------\n\nRoot cause:\nAlthough this is using the correct offset (ERET register's), it is also\nchanging the REGNUM itself.  Therefore, raw_collect (regnum, ...) is\nnot reading from \"pc\" anymore.\n\nv2:\n- Fix a copy/paste issue as rightfully addressed by Tom [1].\n\n[1]\nhttps://sourceware.org/pipermail/gdb-patches/2020-November/173208.html\n\ngdb/ChangeLog:\n\n\t* arc-linux-tdep.c (collect_register): Populate \"eret\" by\n\t\"pc\" value from the regcache when asked for \"pc\" value.",
    "tree": {
      "sha": "c6b9afc856514699d48d084fa1febb0426d729f9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c6b9afc856514699d48d084fa1febb0426d729f9"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/10c19fadfd45da5262d2f8b9624be71c274ff15d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/10c19fadfd45da5262d2f8b9624be71c274ff15d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/10c19fadfd45da5262d2f8b9624be71c274ff15d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/10c19fadfd45da5262d2f8b9624be71c274ff15d/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "1f2624a35413c31c317e5da8ce7401b59ecfbfa5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1f2624a35413c31c317e5da8ce7401b59ecfbfa5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1f2624a35413c31c317e5da8ce7401b59ecfbfa5"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 12,
    "deletions": 3
  },
  "files": [
    {
      "sha": "4d1f5241e8cf3a06088942856f89e9e2360b60e2",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/10c19fadfd45da5262d2f8b9624be71c274ff15d/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/10c19fadfd45da5262d2f8b9624be71c274ff15d/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=10c19fadfd45da5262d2f8b9624be71c274ff15d",
      "patch": "@@ -1,3 +1,8 @@\n+2020-11-12  Shahab Vahedi  <shahab@synopsys.com>\n+\n+\t* arc-linux-tdep.c (collect_register): Populate \"eret\" by\n+\t\"pc\" value from the regcache when asked for \"pc\" value.\n+\n 2020-11-12  Tom Tromey  <tom@tromey.com>\n \n \tPR rust/26799:"
    },
    {
      "sha": "6e74bae80567236f59fbe054d9f4e1844a0bbc1c",
      "filename": "gdb/arc-linux-tdep.c",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/10c19fadfd45da5262d2f8b9624be71c274ff15d/gdb/arc-linux-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/10c19fadfd45da5262d2f8b9624be71c274ff15d/gdb/arc-linux-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arc-linux-tdep.c?ref=10c19fadfd45da5262d2f8b9624be71c274ff15d",
      "patch": "@@ -319,8 +319,10 @@ static void\n collect_register (const struct regcache *regcache, struct gdbarch *gdbarch,\n \t\t  int regnum, gdb_byte *buf)\n {\n+  int offset;\n+\n   /* Skip non-existing registers.  */\n-  if ((arc_linux_core_reg_offsets[regnum] == ARC_OFFSET_NO_REGISTER))\n+  if (arc_linux_core_reg_offsets[regnum] == ARC_OFFSET_NO_REGISTER)\n     return;\n \n   /* The address where the execution has stopped is in pseudo-register\n@@ -332,8 +334,10 @@ collect_register (const struct regcache *regcache, struct gdbarch *gdbarch,\n      the program will continue at the address after the current instruction.\n      */\n   if (regnum == gdbarch_pc_regnum (gdbarch))\n-    regnum = ARC_ERET_REGNUM;\n-  regcache->raw_collect (regnum, buf + arc_linux_core_reg_offsets[regnum]);\n+    offset = arc_linux_core_reg_offsets[ARC_ERET_REGNUM];\n+  else\n+    offset = arc_linux_core_reg_offsets[regnum];\n+  regcache->raw_collect (regnum, buf + offset);\n }\n \n void"
    }
  ]
}