{
  "sha": "30ce8e47fad9b057b6d7af9e1d43061126d34d20",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzBjZThlNDdmYWQ5YjA1N2I2ZDdhZjllMWQ0MzA2MTEyNmQzNGQyMA==",
  "commit": {
    "author": {
      "name": "Max Filippov",
      "email": "jcmvbkbc@gmail.com",
      "date": "2020-04-20T02:04:41Z"
    },
    "committer": {
      "name": "Max Filippov",
      "email": "jcmvbkbc@gmail.com",
      "date": "2020-04-23T01:46:45Z"
    },
    "message": "xtensa: fix PR ld/25861\n\nIntroduce new relaxations XTENSA_PDIFF{8,16,32} for positive differences\n(subtracted symbol precedes diminished symbol) and XTENSA_NDIFF{8,16,32}\nfor negative differences (subtracted symbol follows diminished symbol).\nDon't generate XTENSA_DIFF relocations in the assembler, generate\nXTENSA_PDIFF or XTENSA_NDIFF based on relative symbol position.\n\nHandle XTENSA_DIFF in BFD for compatibility with old object files.\nHandle XTENSA_PDIFF and XTENSA_NDIFF in BFD, treating difference value\nas unsigned.\n\n2020-04-22  Max Filippov  <jcmvbkbc@gmail.com>\nbfd/\n\t* bfd-in2.h: Regenerated.\n\t* elf32-xtensa.c (elf_howto_table): New entries for\n\tR_XTENSA_PDIFF{8,16,32} and R_XTENSA_NDIFF{8,16,32}.\n\t(elf_xtensa_reloc_type_lookup, elf_xtensa_do_reloc)\n\t(relax_section): Add cases for R_XTENSA_PDIFF{8,16,32} and\n\tR_XTENSA_NDIFF{8,16,32}.\n\t* libbfd.h (bfd_reloc_code_real_names): Add names for\n\tBFD_RELOC_XTENSA_PDIFF{8,16,32} and\n\tBFD_RELOC_XTENSA_NDIFF{8,16,32}.\n\t* reloc.c: Add documentation for BFD_RELOC_XTENSA_PDIFF{8,16,32}\n\tand BFD_RELOC_XTENSA_NDIFF{8,16,32}.\n\nbinutils/\n\t* readelf.c (is_none_reloc): Recognize\n\tBFD_RELOC_XTENSA_PDIFF{8,16,32} and\n\tBFD_RELOC_XTENSA_NDIFF{8,16,32}.\n\ngas/\n\t* config/tc-xtensa.c (md_apply_fix): Replace\n\tBFD_RELOC_XTENSA_DIFF{8,16,32} generation with\n\tBFD_RELOC_XTENSA_PDIFF{8,16,32} and\n\tBFD_RELOC_XTENSA_NDIFF{8,16,32} generation.\n\t* testsuite/gas/xtensa/loc.d: Replace BFD_RELOC_XTENSA_DIFF16\n\twith BFD_RELOC_XTENSA_PDIFF16 in the expected output.\n\ninclude/\n\t* elf/xtensa.h (elf_xtensa_reloc_type): New entries for\n\tR_XTENSA_PDIFF{8,16,32} and R_XTENSA_NDIFF{8,16,32}.\n\nld/\n\t* testsuite/ld-xtensa/relax-loc.d: New test definition.\n\t* testsuite/ld-xtensa/relax-loc.s: New test source.\n\t* testsuite/ld-xtensa/xtensa.exp (relax-loc): New test.",
    "tree": {
      "sha": "f1c9ab86407f5a80c78bdf436f2178d2aacc96dd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f1c9ab86407f5a80c78bdf436f2178d2aacc96dd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/30ce8e47fad9b057b6d7af9e1d43061126d34d20",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/30ce8e47fad9b057b6d7af9e1d43061126d34d20",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/30ce8e47fad9b057b6d7af9e1d43061126d34d20",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/30ce8e47fad9b057b6d7af9e1d43061126d34d20/comments",
  "author": {
    "login": "jcmvbkbc",
    "id": 166731,
    "node_id": "MDQ6VXNlcjE2NjczMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jcmvbkbc",
    "html_url": "https://github.com/jcmvbkbc",
    "followers_url": "https://api.github.com/users/jcmvbkbc/followers",
    "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}",
    "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions",
    "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs",
    "repos_url": "https://api.github.com/users/jcmvbkbc/repos",
    "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jcmvbkbc",
    "id": 166731,
    "node_id": "MDQ6VXNlcjE2NjczMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jcmvbkbc",
    "html_url": "https://github.com/jcmvbkbc",
    "followers_url": "https://api.github.com/users/jcmvbkbc/followers",
    "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}",
    "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions",
    "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs",
    "repos_url": "https://api.github.com/users/jcmvbkbc/repos",
    "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e44f65e3c5c9473d0dd98efa8c142d361b1273d7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e44f65e3c5c9473d0dd98efa8c142d361b1273d7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e44f65e3c5c9473d0dd98efa8c142d361b1273d7"
    }
  ],
  "stats": {
    "total": 235,
    "additions": 228,
    "deletions": 7
  },
  "files": [
    {
      "sha": "adba80c83847b7d9802fc09d9a96fe0eb9467ef3",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -1,3 +1,18 @@\n+2020-04-22  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\tPR ld/25861\n+\t* bfd-in2.h: Regenerated.\n+\t* elf32-xtensa.c (elf_howto_table): New entries for\n+\tR_XTENSA_PDIFF{8,16,32} and R_XTENSA_NDIFF{8,16,32}.\n+\t(elf_xtensa_reloc_type_lookup, elf_xtensa_do_reloc)\n+\t(relax_section): Add cases for R_XTENSA_PDIFF{8,16,32} and\n+\tR_XTENSA_NDIFF{8,16,32}.\n+\t* libbfd.h (bfd_reloc_code_real_names): Add names for\n+\tBFD_RELOC_XTENSA_PDIFF{8,16,32} and\n+\tBFD_RELOC_XTENSA_NDIFF{8,16,32}.\n+\t* reloc.c: Add documentation for BFD_RELOC_XTENSA_PDIFF{8,16,32}\n+\tand BFD_RELOC_XTENSA_NDIFF{8,16,32}.\n+\n 2020-04-21  Tamar Christina  <tamar.christina@arm.com>\n \n \tPR binutils/24753"
    },
    {
      "sha": "ec23fd49870862c9d2a7c3457884d2119a19ec32",
      "filename": "bfd/bfd-in2.h",
      "status": "modified",
      "additions": 19,
      "deletions": 1,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/bfd-in2.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/bfd-in2.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/bfd-in2.h?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -5224,7 +5224,9 @@ to one of its own internal functions or data structures.  */\n PLT entries.  Otherwise, this is just a generic 32-bit relocation.  */\n   BFD_RELOC_XTENSA_PLT,\n \n-/* Xtensa relocations to mark the difference of two local symbols.\n+/* Xtensa relocations for backward compatibility.  These have been replaced\n+by BFD_RELOC_XTENSA_PDIFF and BFD_RELOC_XTENSA_NDIFF.\n+Xtensa relocations to mark the difference of two local symbols.\n These are only needed to support linker relaxation and can be ignored\n when not relaxing.  The field is set to the value of the difference\n assuming no relaxation.  The relocation encodes the position of the\n@@ -5298,6 +5300,22 @@ BFD_RELOC_XTENSA_ASM_EXPAND.  */\n   BFD_RELOC_XTENSA_TLS_ARG,\n   BFD_RELOC_XTENSA_TLS_CALL,\n \n+/* Xtensa relocations to mark the difference of two local symbols.\n+These are only needed to support linker relaxation and can be ignored\n+when not relaxing.  The field is set to the value of the difference\n+assuming no relaxation.  The relocation encodes the position of the\n+subtracted symbol so the linker can determine whether to adjust the field\n+value.  PDIFF relocations are used for positive differences, NDIFF\n+relocations are used for negative differences.  The difference value\n+is treated as unsigned with these relocation types, giving full\n+8/16 value ranges.  */\n+  BFD_RELOC_XTENSA_PDIFF8,\n+  BFD_RELOC_XTENSA_PDIFF16,\n+  BFD_RELOC_XTENSA_PDIFF32,\n+  BFD_RELOC_XTENSA_NDIFF8,\n+  BFD_RELOC_XTENSA_NDIFF16,\n+  BFD_RELOC_XTENSA_NDIFF32,\n+\n /* 8 bit signed offset in (ix+d) or (iy+d).  */\n   BFD_RELOC_Z80_DISP8,\n "
    },
    {
      "sha": "fded42d52a9a4bd04b56e98a23454b37e17a92d8",
      "filename": "bfd/elf32-xtensa.c",
      "status": "modified",
      "additions": 88,
      "deletions": 1,
      "changes": 89,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/elf32-xtensa.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/elf32-xtensa.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-xtensa.c?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -325,6 +325,20 @@ static reloc_howto_type elf_howto_table[] =\n   HOWTO (R_XTENSA_TLS_CALL, 0, 0, 0, FALSE, 0, complain_overflow_dont,\n \t bfd_elf_xtensa_reloc, \"R_XTENSA_TLS_CALL\",\n \t FALSE, 0, 0, FALSE),\n+\n+  HOWTO (R_XTENSA_PDIFF8, 0, 0, 8, FALSE, 0, complain_overflow_bitfield,\n+\t bfd_elf_xtensa_reloc, \"R_XTENSA_PDIFF8\", FALSE, 0, 0xff, FALSE),\n+  HOWTO (R_XTENSA_PDIFF16, 0, 1, 16, FALSE, 0, complain_overflow_bitfield,\n+\t bfd_elf_xtensa_reloc, \"R_XTENSA_PDIFF16\", FALSE, 0, 0xffff, FALSE),\n+  HOWTO (R_XTENSA_PDIFF32, 0, 2, 32, FALSE, 0, complain_overflow_bitfield,\n+\t bfd_elf_xtensa_reloc, \"R_XTENSA_PDIFF32\", FALSE, 0, 0xffffffff, FALSE),\n+\n+  HOWTO (R_XTENSA_NDIFF8, 0, 0, 8, FALSE, 0, complain_overflow_bitfield,\n+\t bfd_elf_xtensa_reloc, \"R_XTENSA_NDIFF8\", FALSE, 0, 0xff, FALSE),\n+  HOWTO (R_XTENSA_NDIFF16, 0, 1, 16, FALSE, 0, complain_overflow_bitfield,\n+\t bfd_elf_xtensa_reloc, \"R_XTENSA_NDIFF16\", FALSE, 0, 0xffff, FALSE),\n+  HOWTO (R_XTENSA_NDIFF32, 0, 2, 32, FALSE, 0, complain_overflow_bitfield,\n+\t bfd_elf_xtensa_reloc, \"R_XTENSA_NDIFF32\", FALSE, 0, 0xffffffff, FALSE),\n };\n \n #if DEBUG_GEN_RELOC\n@@ -364,6 +378,30 @@ elf_xtensa_reloc_type_lookup (bfd *abfd ATTRIBUTE_UNUSED,\n       TRACE (\"BFD_RELOC_XTENSA_DIFF32\");\n       return &elf_howto_table[(unsigned) R_XTENSA_DIFF32 ];\n \n+    case BFD_RELOC_XTENSA_PDIFF8:\n+      TRACE (\"BFD_RELOC_XTENSA_PDIFF8\");\n+      return &elf_howto_table[(unsigned) R_XTENSA_PDIFF8 ];\n+\n+    case BFD_RELOC_XTENSA_PDIFF16:\n+      TRACE (\"BFD_RELOC_XTENSA_PDIFF16\");\n+      return &elf_howto_table[(unsigned) R_XTENSA_PDIFF16 ];\n+\n+    case BFD_RELOC_XTENSA_PDIFF32:\n+      TRACE (\"BFD_RELOC_XTENSA_PDIFF32\");\n+      return &elf_howto_table[(unsigned) R_XTENSA_PDIFF32 ];\n+\n+    case BFD_RELOC_XTENSA_NDIFF8:\n+      TRACE (\"BFD_RELOC_XTENSA_NDIFF8\");\n+      return &elf_howto_table[(unsigned) R_XTENSA_NDIFF8 ];\n+\n+    case BFD_RELOC_XTENSA_NDIFF16:\n+      TRACE (\"BFD_RELOC_XTENSA_NDIFF16\");\n+      return &elf_howto_table[(unsigned) R_XTENSA_NDIFF16 ];\n+\n+    case BFD_RELOC_XTENSA_NDIFF32:\n+      TRACE (\"BFD_RELOC_XTENSA_NDIFF32\");\n+      return &elf_howto_table[(unsigned) R_XTENSA_NDIFF32 ];\n+\n     case BFD_RELOC_XTENSA_RTLD:\n       TRACE (\"BFD_RELOC_XTENSA_RTLD\");\n       return &elf_howto_table[(unsigned) R_XTENSA_RTLD ];\n@@ -1851,6 +1889,12 @@ elf_xtensa_do_reloc (reloc_howto_type *howto,\n     case R_XTENSA_DIFF8:\n     case R_XTENSA_DIFF16:\n     case R_XTENSA_DIFF32:\n+    case R_XTENSA_PDIFF8:\n+    case R_XTENSA_PDIFF16:\n+    case R_XTENSA_PDIFF32:\n+    case R_XTENSA_NDIFF8:\n+    case R_XTENSA_NDIFF16:\n+    case R_XTENSA_NDIFF32:\n     case R_XTENSA_TLS_FUNC:\n     case R_XTENSA_TLS_ARG:\n     case R_XTENSA_TLS_CALL:\n@@ -9604,7 +9648,13 @@ relax_section (bfd *abfd, asection *sec, struct bfd_link_info *link_info)\n \n \t      if (r_type == R_XTENSA_DIFF8\n \t\t  || r_type == R_XTENSA_DIFF16\n-\t\t  || r_type == R_XTENSA_DIFF32)\n+\t\t  || r_type == R_XTENSA_DIFF32\n+\t\t  || r_type == R_XTENSA_PDIFF8\n+\t\t  || r_type == R_XTENSA_PDIFF16\n+\t\t  || r_type == R_XTENSA_PDIFF32\n+\t\t  || r_type == R_XTENSA_NDIFF8\n+\t\t  || r_type == R_XTENSA_NDIFF16\n+\t\t  || r_type == R_XTENSA_NDIFF32)\n \t\t{\n \t\t  bfd_signed_vma diff_value = 0;\n \t\t  bfd_vma new_end_offset, diff_mask = 0;\n@@ -9631,8 +9681,27 @@ relax_section (bfd *abfd, asection *sec, struct bfd_link_info *link_info)\n \t\t      diff_value =\n \t\t\tbfd_get_signed_32 (abfd, &contents[old_source_offset]);\n \t\t      break;\n+\t\t    case R_XTENSA_PDIFF8:\n+\t\t    case R_XTENSA_NDIFF8:\n+\t\t      diff_value =\n+\t\t\tbfd_get_8 (abfd, &contents[old_source_offset]);\n+\t\t      break;\n+\t\t    case R_XTENSA_PDIFF16:\n+\t\t    case R_XTENSA_NDIFF16:\n+\t\t      diff_value =\n+\t\t\tbfd_get_16 (abfd, &contents[old_source_offset]);\n+\t\t      break;\n+\t\t    case R_XTENSA_PDIFF32:\n+\t\t    case R_XTENSA_NDIFF32:\n+\t\t      diff_value =\n+\t\t\tbfd_get_32 (abfd, &contents[old_source_offset]);\n+\t\t      break;\n \t\t    }\n \n+\t\t  if (r_type >= R_XTENSA_NDIFF8\n+\t\t      && r_type <= R_XTENSA_NDIFF32)\n+\t\t    diff_value = -diff_value;\n+\n \t\t  new_end_offset = offset_with_removed_text_map\n \t\t    (&target_relax_info->action_list,\n \t\t     r_rel.target_offset + diff_value);\n@@ -9655,6 +9724,24 @@ relax_section (bfd *abfd, asection *sec, struct bfd_link_info *link_info)\n \t\t      bfd_put_signed_32 (abfd, diff_value,\n \t\t\t\t  &contents[old_source_offset]);\n \t\t      break;\n+\t\t    case R_XTENSA_PDIFF8:\n+\t\t    case R_XTENSA_NDIFF8:\n+\t\t      diff_mask = 0xff;\n+\t\t      bfd_put_8 (abfd, diff_value,\n+\t\t\t\t &contents[old_source_offset]);\n+\t\t      break;\n+\t\t    case R_XTENSA_PDIFF16:\n+\t\t    case R_XTENSA_NDIFF16:\n+\t\t      diff_mask = 0xffff;\n+\t\t      bfd_put_16 (abfd, diff_value,\n+\t\t\t\t  &contents[old_source_offset]);\n+\t\t      break;\n+\t\t    case R_XTENSA_PDIFF32:\n+\t\t    case R_XTENSA_NDIFF32:\n+\t\t      diff_mask = 0xffffffff;\n+\t\t      bfd_put_32 (abfd, diff_value,\n+\t\t\t\t  &contents[old_source_offset]);\n+\t\t      break;\n \t\t    }\n \n \t\t  /* Check for overflow. Sign bits must be all zeroes or all ones */"
    },
    {
      "sha": "6aeaf187e2b7604544d5f1bae6d4934d5d005310",
      "filename": "bfd/libbfd.h",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/libbfd.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/libbfd.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/libbfd.h?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -2919,6 +2919,12 @@ static const char *const bfd_reloc_code_real_names[] = { \"@@uninitialized@@\",\n   \"BFD_RELOC_XTENSA_TLS_FUNC\",\n   \"BFD_RELOC_XTENSA_TLS_ARG\",\n   \"BFD_RELOC_XTENSA_TLS_CALL\",\n+  \"BFD_RELOC_XTENSA_PDIFF8\",\n+  \"BFD_RELOC_XTENSA_PDIFF16\",\n+  \"BFD_RELOC_XTENSA_PDIFF32\",\n+  \"BFD_RELOC_XTENSA_NDIFF8\",\n+  \"BFD_RELOC_XTENSA_NDIFF16\",\n+  \"BFD_RELOC_XTENSA_NDIFF32\",\n   \"BFD_RELOC_Z80_DISP8\",\n   \"BFD_RELOC_Z80_BYTE0\",\n   \"BFD_RELOC_Z80_BYTE1\","
    },
    {
      "sha": "f5df8e2ab3eb4ff618fe5a92a3af60820d249869",
      "filename": "bfd/reloc.c",
      "status": "modified",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/reloc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/bfd/reloc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/reloc.c?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -6556,6 +6556,8 @@ ENUMX\n ENUMX\n   BFD_RELOC_XTENSA_DIFF32\n ENUMDOC\n+  Xtensa relocations for backward compatibility.  These have been replaced\n+  by BFD_RELOC_XTENSA_PDIFF and BFD_RELOC_XTENSA_NDIFF.\n   Xtensa relocations to mark the difference of two local symbols.\n   These are only needed to support linker relaxation and can be ignored\n   when not relaxing.  The field is set to the value of the difference\n@@ -6668,6 +6670,28 @@ ENUMX\n   BFD_RELOC_XTENSA_TLS_CALL\n ENUMDOC\n   Xtensa TLS relocations.\n+ENUM\n+  BFD_RELOC_XTENSA_PDIFF8\n+ENUMX\n+  BFD_RELOC_XTENSA_PDIFF16\n+ENUMX\n+  BFD_RELOC_XTENSA_PDIFF32\n+ENUMX\n+  BFD_RELOC_XTENSA_NDIFF8\n+ENUMX\n+  BFD_RELOC_XTENSA_NDIFF16\n+ENUMX\n+  BFD_RELOC_XTENSA_NDIFF32\n+ENUMDOC\n+  Xtensa relocations to mark the difference of two local symbols.\n+  These are only needed to support linker relaxation and can be ignored\n+  when not relaxing.  The field is set to the value of the difference\n+  assuming no relaxation.  The relocation encodes the position of the\n+  subtracted symbol so the linker can determine whether to adjust the field\n+  value.  PDIFF relocations are used for positive differences, NDIFF\n+  relocations are used for negative differences.  The difference value\n+  is treated as unsigned with these relocation types, giving full\n+  8/16 value ranges.\n \n ENUM\n   BFD_RELOC_Z80_DISP8"
    },
    {
      "sha": "07626115c5307e75a2998ac8da91ba08474c8141",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -1,3 +1,10 @@\n+2020-04-22  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\tPR ld/25861\n+\t* readelf.c (is_none_reloc): Recognize\n+\tBFD_RELOC_XTENSA_PDIFF{8,16,32} and\n+\tBFD_RELOC_XTENSA_NDIFF{8,16,32}.\n+\n 2020-04-22  Nick Clifton  <nickc@redhat.com>\n \n \t* MAINTAINERS: Remove Chris Faylor as the ix86 PE maintainer."
    },
    {
      "sha": "4f80bd94b9301753cb729cfe1055d46082d03930",
      "filename": "binutils/readelf.c",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/binutils/readelf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/binutils/readelf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/readelf.c?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -13348,7 +13348,13 @@ is_none_reloc (Filedata * filedata, unsigned int reloc_type)\n       return (reloc_type == 0      /* R_XTENSA_NONE.  */\n \t      || reloc_type == 17  /* R_XTENSA_DIFF8.  */\n \t      || reloc_type == 18  /* R_XTENSA_DIFF16.  */\n-\t      || reloc_type == 19  /* R_XTENSA_DIFF32.  */);\n+\t      || reloc_type == 19  /* R_XTENSA_DIFF32.  */\n+\t      || reloc_type == 57  /* R_XTENSA_PDIFF8.  */\n+\t      || reloc_type == 58  /* R_XTENSA_PDIFF16.  */\n+\t      || reloc_type == 59  /* R_XTENSA_PDIFF32.  */\n+\t      || reloc_type == 60  /* R_XTENSA_NDIFF8.  */\n+\t      || reloc_type == 61  /* R_XTENSA_NDIFF16.  */\n+\t      || reloc_type == 62  /* R_XTENSA_NDIFF32.  */);\n     }\n   return FALSE;\n }"
    },
    {
      "sha": "f31504b864d9bad4166e76dff19990429d842c9f",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -1,3 +1,13 @@\n+2020-04-22  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\tPR ld/25861\n+\t* config/tc-xtensa.c (md_apply_fix): Replace\n+\tBFD_RELOC_XTENSA_DIFF{8,16,32} generation with\n+\tBFD_RELOC_XTENSA_PDIFF{8,16,32} and\n+\tBFD_RELOC_XTENSA_NDIFF{8,16,32} generation.\n+\t* testsuite/gas/xtensa/loc.d: Replace BFD_RELOC_XTENSA_DIFF16\n+\twith BFD_RELOC_XTENSA_PDIFF16 in the expected output.\n+\n 2020-04-22  Alan Modra  <amodra@gmail.com>\n \n \t* config/obj-elf.c (elf_frob_symbol): Unconditionally remove"
    },
    {
      "sha": "ee75c13548ff1ba0f04b3e74b81188fc52338ec7",
      "filename": "gas/config/tc-xtensa.c",
      "status": "modified",
      "additions": 9,
      "deletions": 3,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/gas/config/tc-xtensa.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/gas/config/tc-xtensa.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-xtensa.c?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -5974,18 +5974,24 @@ md_apply_fix (fixS *fixP, valueT *valP, segT seg)\n     case BFD_RELOC_8:\n       if (fixP->fx_subsy)\n \t{\n+\t  bfd_boolean neg = S_GET_VALUE (fixP->fx_addsy) + fixP->fx_offset\n+\t    < S_GET_VALUE (fixP->fx_subsy);\n+\n \t  switch (fixP->fx_r_type)\n \t    {\n \t    case BFD_RELOC_8:\n-\t      fixP->fx_r_type = BFD_RELOC_XTENSA_DIFF8;\n+\t      fixP->fx_r_type = neg\n+\t\t? BFD_RELOC_XTENSA_NDIFF8 : BFD_RELOC_XTENSA_PDIFF8;\n \t      fixP->fx_signed = 0;\n \t      break;\n \t    case BFD_RELOC_16:\n-\t      fixP->fx_r_type = BFD_RELOC_XTENSA_DIFF16;\n+\t      fixP->fx_r_type = neg\n+\t\t? BFD_RELOC_XTENSA_NDIFF16 : BFD_RELOC_XTENSA_PDIFF16;\n \t      fixP->fx_signed = 0;\n \t      break;\n \t    case BFD_RELOC_32:\n-\t      fixP->fx_r_type = BFD_RELOC_XTENSA_DIFF32;\n+\t      fixP->fx_r_type = neg\n+\t\t? BFD_RELOC_XTENSA_NDIFF32 : BFD_RELOC_XTENSA_PDIFF32;\n \t      fixP->fx_signed = 0;\n \t      break;\n \t    default:"
    },
    {
      "sha": "8fb3425999d5fa921ddd9ea497d3e8491c6583a8",
      "filename": "gas/testsuite/gas/xtensa/loc.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/gas/testsuite/gas/xtensa/loc.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/gas/testsuite/gas/xtensa/loc.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/xtensa/loc.d?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -6,5 +6,5 @@\n \n RELOCATION RECORDS FOR \\[\\.debug_line\\]:\n #...\n-.*R_XTENSA_DIFF16.*\\.text\\+0x00009c42\n+.*R_XTENSA_PDIFF16.*\\.text\\+0x00009c42\n #..."
    },
    {
      "sha": "bf379cc2b6423425ccf6930af7666d43fc3d72f1",
      "filename": "include/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/include/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/include/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/ChangeLog?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -1,3 +1,9 @@\n+2020-04-22  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\tPR ld/25861\n+\t* elf/xtensa.h (elf_xtensa_reloc_type): New entries for\n+\tR_XTENSA_PDIFF{8,16,32} and R_XTENSA_NDIFF{8,16,32}.\n+\n 2020-04-21  Alan Modra  <amodra@gmail.com>\n \n \t* elf/sh.h (STO_SH5_ISA32, SHF_SH5_ISA32, SHF_SH5_ISA32_MIXED),"
    },
    {
      "sha": "bd5c80d13777c5c4bd67b714c61dd4314a3a9dde",
      "filename": "include/elf/xtensa.h",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/include/elf/xtensa.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/include/elf/xtensa.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/include/elf/xtensa.h?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -87,6 +87,12 @@ START_RELOC_NUMBERS (elf_xtensa_reloc_type)\n      RELOC_NUMBER (R_XTENSA_TLS_FUNC, 54)\n      RELOC_NUMBER (R_XTENSA_TLS_ARG, 55)\n      RELOC_NUMBER (R_XTENSA_TLS_CALL, 56)\n+     RELOC_NUMBER (R_XTENSA_PDIFF8, 57)\n+     RELOC_NUMBER (R_XTENSA_PDIFF16, 58)\n+     RELOC_NUMBER (R_XTENSA_PDIFF32, 59)\n+     RELOC_NUMBER (R_XTENSA_NDIFF8, 60)\n+     RELOC_NUMBER (R_XTENSA_NDIFF16, 61)\n+     RELOC_NUMBER (R_XTENSA_NDIFF32, 62)\n END_RELOC_NUMBERS (R_XTENSA_max)\n \n /* Processor-specific flags for the ELF header e_flags field.  */"
    },
    {
      "sha": "77551f0f4e1379c0f0bccb0466fdcd92679b01d9",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -1,3 +1,10 @@\n+2020-04-22  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\tPR ld/25861\n+\t* testsuite/ld-xtensa/relax-loc.d: New test definition.\n+\t* testsuite/ld-xtensa/relax-loc.s: New test source.\n+\t* testsuite/ld-xtensa/xtensa.exp (relax-loc): New test.\n+\n 2020-04-22  Fangrui Song <maskray@google.com>\n \n \tPR ld/25806"
    },
    {
      "sha": "3c8d673732ffe14298e6b167d6d690f80903bebe",
      "filename": "ld/testsuite/ld-xtensa/relax-loc.d",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/testsuite/ld-xtensa/relax-loc.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/testsuite/ld-xtensa/relax-loc.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-xtensa/relax-loc.d?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -0,0 +1,7 @@\n+#as: --text-section-literals\n+#ld:\n+#objdump: --dwarf=decodedline\n+#...\n+relax-loc.s[ \t]+1[ \t]+0x400054[ \t]+.*\n+relax-loc.s[ \t]+2[ \t]+0x40005c[ \t]+.*\n+#..."
    },
    {
      "sha": "d768470e287aadf2088d7093d25aa6b72df53a75",
      "filename": "ld/testsuite/ld-xtensa/relax-loc.s",
      "status": "added",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/testsuite/ld-xtensa/relax-loc.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/testsuite/ld-xtensa/relax-loc.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-xtensa/relax-loc.s?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -0,0 +1,15 @@\n+\t.file\t1 \"relax-loc.s\"\n+\t.globl\t_start\n+\t.globl\t_ResetVector\n+\t.text\n+_ResetVector:\n+_start:\n+\t.loc\t1 1\n+\tj\t1f\n+\t.literal_position\n+1:\n+\t.loc\t1 2\n+\n+\t.rep\t10000\n+\tmovi\ta2, 0x12345678\n+\t.endr"
    },
    {
      "sha": "de39887936ad62855e843a6437d20f0e1d5b61d5",
      "filename": "ld/testsuite/ld-xtensa/xtensa.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/testsuite/ld-xtensa/xtensa.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30ce8e47fad9b057b6d7af9e1d43061126d34d20/ld/testsuite/ld-xtensa/xtensa.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-xtensa/xtensa.exp?ref=30ce8e47fad9b057b6d7af9e1d43061126d34d20",
      "patch": "@@ -27,6 +27,7 @@ run_dump_test \"call_overflow\"\n run_dump_test \"coalesce\"\n run_dump_test \"diff_overflow\"\n run_dump_test \"lcall\"\n+run_dump_test \"relax-loc\"\n \n run_dump_test \"relax-static-pie\"\n run_dump_test \"relax-static-local-pie\""
    }
  ]
}