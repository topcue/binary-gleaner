{
  "sha": "6179e5f1d8d54e10a128e4de9c96ecda79e788bf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjE3OWU1ZjFkOGQ1NGUxMGExMjhlNGRlOWM5NmVjZGE3OWU3ODhiZg==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-06-10T11:38:03Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-06-10T11:38:03Z"
    },
    "message": "[gdb/testsuite] Fix timeout in gdb.mi/user-selected-context-sync.exp with gcc-11\n\nWhen running test-case gdb.mi/user-selected-context-sync.exp with gcc-11, we\nget:\n...\ncontinue^M\nContinuing.^M\nFAIL: gdb.mi/user-selected-context-sync.exp: mode=all-stop: test_setup: \\\n  inferior 1: continue to breakpoint: continue thread 1.2 to infinite \\\n  loop breakpoint (timeout)\n...\n\nThis is a regression since commit aa33ea68330 \"testsuite, mi: avoid a clang\nbug in 'user-selected-context-sync.exp'\", which fixes a similar hang when\nusing clang.\n\nThe source before the commit contains:\n...\n  while (1);\n...\nand after the commit:\n...\n  int spin = 1;\n  while (spin);\n...\n\n[ FWIW, I've filed a PR gcc/101011 - Inconsistent debug info for \"while (1);\"\nto mention that gcc-11 has different behaviour for these two loops. ]\n\nThe problem is that:\n- the test-case expects the behaviour that a breakpoint set\n  on the while line will trigger on every iteration, and\n- that is not guaranteed by either version of the loop.\n\nFix this by using a while loop with a dummy body:\n...\n  volatile int dummy = 0;\n  while (1)\n    dummy = !dummy;\n...\nand setting the breakpoint in the body.\n\nTested on x86_64-linux with clang 10.0.1, gcc-4.8, gcc 7.5.0 and gcc 11.1.1.\n\ngdb/testsuite/ChangeLog:\n\n2021-06-10  Tom de Vries  <tdevries@suse.de>\n\n\t* gdb.mi/user-selected-context-sync.c (child_sub_function, main):\n\tRewrite while (1) using dummy loop body.",
    "tree": {
      "sha": "de1ffd7b5264044a21c0a2a7b5c3097052514251",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/de1ffd7b5264044a21c0a2a7b5c3097052514251"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6179e5f1d8d54e10a128e4de9c96ecda79e788bf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6179e5f1d8d54e10a128e4de9c96ecda79e788bf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6179e5f1d8d54e10a128e4de9c96ecda79e788bf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6179e5f1d8d54e10a128e4de9c96ecda79e788bf/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1db66fb653995e45fa55d44bddf25bdf55efb46a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1db66fb653995e45fa55d44bddf25bdf55efb46a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1db66fb653995e45fa55d44bddf25bdf55efb46a"
    }
  ],
  "stats": {
    "total": 21,
    "additions": 13,
    "deletions": 8
  },
  "files": [
    {
      "sha": "37376643d3289cd980b6b7cccb8b3ce8b82a6422",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6179e5f1d8d54e10a128e4de9c96ecda79e788bf/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6179e5f1d8d54e10a128e4de9c96ecda79e788bf/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=6179e5f1d8d54e10a128e4de9c96ecda79e788bf",
      "patch": "@@ -1,3 +1,8 @@\n+2021-06-10  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gdb.mi/user-selected-context-sync.c (child_sub_function, main):\n+\tRewrite while (1) using dummy loop body.\n+\n 2021-06-10  Bhuvanendra Kumar N  <Bhuvanendra.KumarN@amd.com>\n \n \t* gdb.base/foll-exec.c: convert the multi-line function call into"
    },
    {
      "sha": "ebb55f87e2c25b7ebb140e597dad4e8c7553709e",
      "filename": "gdb/testsuite/gdb.mi/user-selected-context-sync.c",
      "status": "modified",
      "additions": 8,
      "deletions": 8,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6179e5f1d8d54e10a128e4de9c96ecda79e788bf/gdb/testsuite/gdb.mi/user-selected-context-sync.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6179e5f1d8d54e10a128e4de9c96ecda79e788bf/gdb/testsuite/gdb.mi/user-selected-context-sync.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/user-selected-context-sync.c?ref=6179e5f1d8d54e10a128e4de9c96ecda79e788bf",
      "patch": "@@ -27,10 +27,10 @@ static pthread_barrier_t barrier;\n static void\n child_sub_function (void)\n {\n-  /* Deliberately spin on a variable instead of plain 'while (1)' to\n-     avoid the Clang bug https://bugs.llvm.org/show_bug.cgi?id=49614.  */\n-  int spin = 1;\n-  while (spin); /* thread loop line */\n+  volatile int dummy = 0;\n+  while (1)\n+    /* Dummy loop body to allow setting breakpoint.  */\n+    dummy = !dummy; /* thread loop line */\n }\n \n static void *\n@@ -60,10 +60,10 @@ main (void)\n \n   pthread_barrier_wait (&barrier);\n \n-  /* Deliberately spin on a variable instead of plain 'while (1)' to\n-     avoid the Clang bug https://bugs.llvm.org/show_bug.cgi?id=49614.  */\n-  int spin = 1;\n-  while (spin); /* main break line */\n+  volatile int dummy = 0;\n+  while (1)\n+    /* Dummy loop body to allow setting breakpoint.  */\n+    dummy = !dummy; /* main break line */\n \n   return 0;\n }"
    }
  ]
}