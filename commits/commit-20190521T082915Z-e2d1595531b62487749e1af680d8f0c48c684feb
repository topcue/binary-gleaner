{
  "sha": "e2d1595531b62487749e1af680d8f0c48c684feb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTJkMTU5NTUzMWI2MjQ4Nzc0OWUxYWY2ODBkOGYwYzQ4YzY4NGZlYg==",
  "commit": {
    "author": {
      "name": "John Darrington",
      "email": "john@darrington.wattle.id.au",
      "date": "2019-05-21T08:11:40Z"
    },
    "committer": {
      "name": "John Darrington",
      "email": "john@darrington.wattle.id.au",
      "date": "2019-05-21T08:29:15Z"
    },
    "message": "GAS: Replace macro LITERAL_PREFIXDOLLAR_HEX with a runtime value.\n\nIn an upcoming commit, I need to be able to set the prefix used\nto introduce hexadecimal literal constants using a command line\nflag.   This is not currently possible, because the switch which\ndetermines this (LITERAL_PREFIXDOLLAR_HEX) is a macro set at\nbuild time.\n\nThis change substitutes it for a variable to be set at start up.\n\ngas/ChangeLog:\n    * expr.c (literal_prefix_dollar_hex): New variable.\n    (operand)[case '$']: Use the new variable instead of the old macro.\n    Also, move this instance of \"case '$'\" next to the other one, and\n    enable it only in the complementary proprocessor case.\n    * expr.h (literal_prefix_dollar_hex): Declare it.\n    * config/tc-epiphany.c (md_begin): Assign literal_prefix_dollar_hex.\n    * config/tc-ip2k.c:      ditto\n    * config/tc-mt.c:        ditto\n    * config/tc-epiphany.h (LITERAL_PREFIXDOLLAR_HEX): Remove macro definition.\n    * config/tc-ip2k.h:      ditto\n    * config/tc-mt.h:        ditto",
    "tree": {
      "sha": "1fa82c246269596f8b761e726779c788a9451289",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1fa82c246269596f8b761e726779c788a9451289"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e2d1595531b62487749e1af680d8f0c48c684feb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2d1595531b62487749e1af680d8f0c48c684feb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e2d1595531b62487749e1af680d8f0c48c684feb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2d1595531b62487749e1af680d8f0c48c684feb/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "7622049e0bef81fab900860400838bc977449892",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7622049e0bef81fab900860400838bc977449892",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7622049e0bef81fab900860400838bc977449892"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 39,
    "deletions": 13
  },
  "files": [
    {
      "sha": "fbfa00b2db27f0da3a3f189758dc2527660c6326",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -1,3 +1,17 @@\n+2019-05-21  John Darrington <john@darrington.wattle.id.au>\n+\n+\t* expr.c (literal_prefix_dollar_hex): New variable.\n+\t(operand)[case '$']: Use the new variable instead of the old macro.\n+\tAlso, move this instance of \"case '$'\" next to the other one, and\n+\tenable it only in the complementary proprocessor case.\n+\t* expr.h (literal_prefix_dollar_hex): Declare it.\n+\t* config/tc-epiphany.c (md_begin): Assign literal_prefix_dollar_hex.\n+\t* config/tc-ip2k.c:      ditto\n+\t* config/tc-mt.c:        ditto\n+\t* config/tc-epiphany.h (LITERAL_PREFIXDOLLAR_HEX): Remove macro definition.\n+\t* config/tc-ip2k.h:      ditto\n+\t* config/tc-mt.h:        ditto\n+\n 2019-05-20  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n \n \tPR 14798"
    },
    {
      "sha": "3117918668fb043abcd48d76fca636aa2b567117",
      "filename": "gas/config/tc-epiphany.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-epiphany.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-epiphany.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-epiphany.c?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -145,6 +145,8 @@ md_begin (void)\n \n   /* Set the machine type.  */\n   bfd_default_set_arch_mach (stdoutput, bfd_arch_epiphany, bfd_mach_epiphany32);\n+\n+  literal_prefix_dollar_hex = TRUE;\n }\n \n valueT"
    },
    {
      "sha": "695b970ca2efafffb77ef82c08f75b45e8b017ed",
      "filename": "gas/config/tc-epiphany.h",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-epiphany.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-epiphany.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-epiphany.h?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -37,7 +37,6 @@\n /* We don't need to handle .word strangely.  */\n #define WORKING_DOT_WORD\n \n-#define LITERAL_PREFIXDOLLAR_HEX\n #define LITERAL_PREFIXPERCENT_BIN\n #define DOUBLESLASH_LINE_COMMENTS\n "
    },
    {
      "sha": "0fcc0003d1915fc6a9caa015764aad74063062cc",
      "filename": "gas/config/tc-ip2k.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-ip2k.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-ip2k.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-ip2k.c?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -160,6 +160,8 @@ md_begin (void)\n \n   /* Set the machine type.  */\n   bfd_default_set_arch_mach (stdoutput, bfd_arch_ip2k, ip2k_mach);\n+\n+  literal_prefix_dollar_hex = TRUE;\n }\n \n "
    },
    {
      "sha": "ae9510d9e1099b1b527982fe7ca8b548ccedde9b",
      "filename": "gas/config/tc-ip2k.h",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-ip2k.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-ip2k.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-ip2k.h?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -38,7 +38,6 @@\n /* We don't need to handle .word strangely.  */\n #define WORKING_DOT_WORD\n \n-#define LITERAL_PREFIXDOLLAR_HEX\n #define LITERAL_PREFIXPERCENT_BIN\n #define DOUBLESLASH_LINE_COMMENTS\n "
    },
    {
      "sha": "bd518547e31ed681d3646aa96ea81ccab596daa2",
      "filename": "gas/config/tc-mt.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-mt.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-mt.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-mt.c?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -178,6 +178,8 @@ md_begin (void)\n \n   /* Set the machine type.  */\n   bfd_default_set_arch_mach (stdoutput, bfd_arch_mt, mt_mach);\n+\n+  literal_prefix_dollar_hex = TRUE;\n }\n \n void"
    },
    {
      "sha": "8a96d2c84f2b3490a3d29dcc866305652756f911",
      "filename": "gas/config/tc-mt.h",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-mt.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/config/tc-mt.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-mt.h?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -41,7 +41,6 @@\n /* All mt instructions are multiples of 32 bits.  */\n #define DWARF2_LINE_MIN_INSN_LENGTH 4\n \n-#define LITERAL_PREFIXDOLLAR_HEX\n #define LITERAL_PREFIXPERCENT_BIN\n \n #define md_apply_fix mt_apply_fix"
    },
    {
      "sha": "16c89343a71b23ad3befd1d9ccb5c74765b286b7",
      "filename": "gas/expr.c",
      "status": "modified",
      "additions": 17,
      "deletions": 10,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/expr.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/expr.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/expr.c?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -35,6 +35,8 @@\n #define CHAR_BIT 8\n #endif\n \n+bfd_boolean literal_prefix_dollar_hex = FALSE;\n+\n static void floating_constant (expressionS * expressionP);\n static valueT generic_bignum_to_int32 (void);\n #ifdef BFD64\n@@ -778,15 +780,6 @@ operand (expressionS *expressionP, enum expr_mode mode)\n \t\t\texpressionP);\n       break;\n \n-#ifdef LITERAL_PREFIXDOLLAR_HEX\n-    case '$':\n-      /* $L is the start of a local label, not a hex constant.  */\n-      if (* input_line_pointer == 'L')\n-      goto isname;\n-      integer_constant (16, expressionP);\n-      break;\n-#endif\n-\n #ifdef LITERAL_PREFIXPERCENT_BIN\n     case '%':\n       integer_constant (2, expressionP);\n@@ -1114,7 +1107,21 @@ operand (expressionS *expressionP, enum expr_mode mode)\n       }\n       break;\n \n-#if defined (DOLLAR_DOT) || defined (TC_M68K)\n+#if !defined (DOLLAR_DOT) && !defined (TC_M68K)\n+    case '$':\n+      if (literal_prefix_dollar_hex)\n+\t{\n+\t  /* $L is the start of a local label, not a hex constant.  */\n+\t  if (* input_line_pointer == 'L')\n+\t\tgoto isname;\n+\t  integer_constant (16, expressionP);\n+\t}\n+      else\n+\t{\n+\t  goto isname;\n+\t}\n+      break;\n+#else\n     case '$':\n       /* '$' is the program counter when in MRI mode, or when\n \t DOLLAR_DOT is defined.  */"
    },
    {
      "sha": "c7d0681dbc61b5c69993314febf4251ea5d8a5de",
      "filename": "gas/expr.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2d1595531b62487749e1af680d8f0c48c684feb/gas/expr.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2d1595531b62487749e1af680d8f0c48c684feb/gas/expr.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/expr.h?ref=e2d1595531b62487749e1af680d8f0c48c684feb",
      "patch": "@@ -187,3 +187,5 @@ extern symbolS *expr_build_uconstant (offsetT);\n extern symbolS *expr_build_dot (void);\n \n int resolve_expression (expressionS *);\n+\n+extern bfd_boolean literal_prefix_dollar_hex;"
    }
  ]
}