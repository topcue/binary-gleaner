{
  "sha": "770c015139f038bd7b7abb5c6d84eb39d36d3080",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzcwYzAxNTEzOWYwMzhiZDdiN2FiYjVjNmQ4NGViMzlkMzZkMzA4MA==",
  "commit": {
    "author": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-08-05T23:38:46Z"
    },
    "committer": {
      "name": "Faraz Shahbazker",
      "email": "fshahbazker@wavecomp.com",
      "date": "2019-08-19T20:43:50Z"
    },
    "message": "MIPS/gas: Retain ISA mode bit for labels with .insn annotation\n\ngas/\n\t* config/tc-mips.c (mips_move_labels): Retain ISA mode bit\n\twhen moving labels in text segments.\n\t(mips_align): Indicate text mode when aligning labels in\n\ttext segments.\n\t* gas/testsuite/gas/mips/insn-isa-mode.d: New test.\n\t* gas/testsuite/gas/mips/insn-isa-mode.s: New test source.\n\t* gas/testsuite/gas/mips/mips.exp: Run the new test.",
    "tree": {
      "sha": "29807efdc505a9762d32ffb02fba43a1c3aa80a7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/29807efdc505a9762d32ffb02fba43a1c3aa80a7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/770c015139f038bd7b7abb5c6d84eb39d36d3080",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/770c015139f038bd7b7abb5c6d84eb39d36d3080",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/770c015139f038bd7b7abb5c6d84eb39d36d3080",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/770c015139f038bd7b7abb5c6d84eb39d36d3080/comments",
  "author": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "farazs-github",
    "id": 57776434,
    "node_id": "MDQ6VXNlcjU3Nzc2NDM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/57776434?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazs-github",
    "html_url": "https://github.com/farazs-github",
    "followers_url": "https://api.github.com/users/farazs-github/followers",
    "following_url": "https://api.github.com/users/farazs-github/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazs-github/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazs-github/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazs-github/subscriptions",
    "organizations_url": "https://api.github.com/users/farazs-github/orgs",
    "repos_url": "https://api.github.com/users/farazs-github/repos",
    "events_url": "https://api.github.com/users/farazs-github/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazs-github/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7ce8f214f1af1dd593ad42665da416ac46033f97",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7ce8f214f1af1dd593ad42665da416ac46033f97",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7ce8f214f1af1dd593ad42665da416ac46033f97"
    }
  ],
  "stats": {
    "total": 48,
    "additions": 45,
    "deletions": 3
  },
  "files": [
    {
      "sha": "cb81de46c0b10ec3434eb59081ce4e50c4f35f01",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=770c015139f038bd7b7abb5c6d84eb39d36d3080",
      "patch": "@@ -1,3 +1,13 @@\n+2019-08-19  Faraz Shahbazker  <fshahbazker@wavecomp.com>\n+\n+\t* config/tc-mips.c (mips_move_labels): Retain ISA mode bit\n+\twhen moving labels in text segments.\n+\t(mips_align): Indicate text mode when aligning labels in\n+\ttext segments.\n+\t* gas/testsuite/gas/mips/insn-isa-mode.d: New test.\n+\t* gas/testsuite/gas/mips/insn-isa-mode.s: New test source.\n+\t* gas/testsuite/gas/mips/mips.exp: Run the new test.\n+\n 2019-08-19  Barnaby Wilks  <Barnaby.Wilks@arm.com>\n \n \t* config/tc-arm.c (md_atof): Add precision check.  Formatting."
    },
    {
      "sha": "38a1b8c7a55cff43c283bfbd73c3c70059f3360b",
      "filename": "gas/config/tc-mips.c",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/config/tc-mips.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/config/tc-mips.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-mips.c?ref=770c015139f038bd7b7abb5c6d84eb39d36d3080",
      "patch": "@@ -4441,9 +4441,10 @@ mips_move_labels (struct insn_label_list *labels, bfd_boolean text_p)\n       gas_assert (S_GET_SEGMENT (l->label) == now_seg);\n       symbol_set_frag (l->label, frag_now);\n       val = (valueT) frag_now_fix ();\n-      /* MIPS16/microMIPS text labels are stored as odd.  */\n+      /* MIPS16/microMIPS text labels are stored as odd.\n+\t We just carry the ISA mode bit forward.  */\n       if (text_p && HAVE_CODE_COMPRESSION)\n-\t++val;\n+\tval |= (S_GET_VALUE (l->label) & 0x1);\n       S_SET_VALUE (l->label, val);\n     }\n }\n@@ -16218,7 +16219,7 @@ mips_align (int to, int *fill, struct insn_label_list *labels)\n   else\n     frag_align (to, fill ? *fill : 0, 0);\n   record_alignment (now_seg, to);\n-  mips_move_labels (labels, FALSE);\n+  mips_move_labels (labels, subseg_text_p (now_seg));\n }\n \n /* Align to a given power of two.  .align 0 turns off the automatic"
    },
    {
      "sha": "9d2c61b96c1bc86eea44199e57078e37bdb3f2e0",
      "filename": "gas/testsuite/gas/mips/insn-isa-mode.d",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/testsuite/gas/mips/insn-isa-mode.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/testsuite/gas/mips/insn-isa-mode.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/mips/insn-isa-mode.d?ref=770c015139f038bd7b7abb5c6d84eb39d36d3080",
      "patch": "@@ -0,0 +1,16 @@\n+#objdump: -dr --show-raw-insn\n+#name: microMIPS ISA mode for .insn label references\n+#as: -32\n+\n+.*: +file format .*mips.*\n+\n+Disassembly of section \\.text:\n+00000000 <test1>:\n+   0:\t3c030000 \tlui\tv1,0x0\n+\t\t\t0: R_MIPS_HI16\t\\.text\n+   4:\t2463000b \taddiu\tv1,v1,11\n+\t\t\t4: R_MIPS_LO16\t\\.text\n+00000008 <test2>:\n+   8:\t0c00      \tnop\n+   a:\t0c00      \tnop\n+\t\\.\\.\\."
    },
    {
      "sha": "ecc520f35931d98ee16b553cc0a23ab4adfba2af",
      "filename": "gas/testsuite/gas/mips/insn-isa-mode.s",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/testsuite/gas/mips/insn-isa-mode.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/testsuite/gas/mips/insn-isa-mode.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/mips/insn-isa-mode.s?ref=770c015139f038bd7b7abb5c6d84eb39d36d3080",
      "patch": "@@ -0,0 +1,14 @@\n+\t.text\n+\t.set nomicromips\n+\t.globl test1\n+\t.type\ttest1, @function\n+test1:\n+\tla $3,test2+2\n+\t.set micromips\n+test2:\n+\t.insn\n+\t.half 0x0c00\n+\t.half 0x0c00\n+# Force some (non-delay-slot) zero bytes, to make 'objdump' print ...\n+\t.align\t4, 0\n+\t.space\t16"
    },
    {
      "sha": "2084ee08292112138ce1918a21c3c65a8dac69c7",
      "filename": "gas/testsuite/gas/mips/mips.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/testsuite/gas/mips/mips.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/770c015139f038bd7b7abb5c6d84eb39d36d3080/gas/testsuite/gas/mips/mips.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/mips/mips.exp?ref=770c015139f038bd7b7abb5c6d84eb39d36d3080",
      "patch": "@@ -2093,4 +2093,5 @@ if { [istarget mips*-*-vxworks*] } {\n     } else {\n \trun_dump_test \"pr14798\"\n     }\n+    run_dump_test \"insn-isa-mode\"\n }"
    }
  ]
}