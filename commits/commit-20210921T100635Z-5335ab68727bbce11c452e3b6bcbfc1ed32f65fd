{
  "sha": "5335ab68727bbce11c452e3b6bcbfc1ed32f65fd",
  "node_id": "C_kwDOANOeidoAKDUzMzVhYjY4NzI3YmJjZTExYzQ1MmUzYjZiY2JmYzFlZDMyZjY1ZmQ",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-21T10:06:35Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-21T10:06:35Z"
    },
    "message": "[gdb/testsuite] Handle supports_memtag in gdb.base/gdb-caching-proc.exp\n\nIn test-case gdb.base/gdb-caching-proc.exp, we run all procs declared with\ngdb_caching_proc.  Some of these require a gdb instance, some not.\n\nWe could just do a clean_restart every time, but that would amount to 44 gdb\nrestarts.  We try to minimize this by doing this only for the few procs that\nneed it, and hardcoding those in the test-case.\n\nFor those procs, we do a clean_restart, execute the proc, and then do a\ngdb_exit, to make sure the gdb instance doesn't linger such that we detect\nprocs that need a gdb instance but are not listed in the test-case.\n\nHowever, that doesn't work in the case of gnat_runtime_has_debug_info.  This\nproc doesn't require a gdb instance because it starts its own.  But it doesn't\nclean up the gdb instance, and since it's not listed, the test-case\ndoesn't clean up the gdb instance eiter.  Consequently, the proc\nsupports_memtag (which should be listed, but isn't) uses the gdb instance\nstarted by gnat_runtime_has_debug_info rather than throwing an error.  Well,\nunless gnat_runtime_has_debug_info fails before starting a gdb instance, in\nwhich case we do run into the error.\n\nFix this by:\n- doing gdb_exit unconditionally\n- fixing the resulting error by adding supports_memtag in the test-case to\n  the \"needing gdb instance\" list\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "8fc8644662e4cdbaeff469f77e1582151699ae4b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8fc8644662e4cdbaeff469f77e1582151699ae4b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5335ab68727bbce11c452e3b6bcbfc1ed32f65fd",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5335ab68727bbce11c452e3b6bcbfc1ed32f65fd",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5335ab68727bbce11c452e3b6bcbfc1ed32f65fd",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5335ab68727bbce11c452e3b6bcbfc1ed32f65fd/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "be24dba6f149d78720fbad2b7133f3865f7b12e5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/be24dba6f149d78720fbad2b7133f3865f7b12e5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/be24dba6f149d78720fbad2b7133f3865f7b12e5"
    }
  ],
  "stats": {
    "total": 5,
    "additions": 2,
    "deletions": 3
  },
  "files": [
    {
      "sha": "a3f08f5db32fa7747b52742388a5cb59f3aefa0a",
      "filename": "gdb/testsuite/gdb.base/gdb-caching-proc.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5335ab68727bbce11c452e3b6bcbfc1ed32f65fd/gdb/testsuite/gdb.base/gdb-caching-proc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5335ab68727bbce11c452e3b6bcbfc1ed32f65fd/gdb/testsuite/gdb.base/gdb-caching-proc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/gdb-caching-proc.exp?ref=5335ab68727bbce11c452e3b6bcbfc1ed32f65fd",
      "patch": "@@ -85,6 +85,7 @@ proc test_file { file } {\n \t    switch $procname {\n \t\t\"is_address_zero_readable\" { set setup_gdb 1 }\n \t\t\"target_is_gdbserver\" { set setup_gdb 1 }\n+\t\t\"supports_memtag\" { set setup_gdb 1 }\n \t\tdefault {set setup_gdb 0 }\n \t    }\n \n@@ -94,9 +95,7 @@ proc test_file { file } {\n \n \t    test_proc $procname\n \n-\t    if { $setup_gdb } {\n-\t\tgdb_exit\n-\t    }\n+\t    gdb_exit\n \t}\n     }\n }"
    }
  ]
}