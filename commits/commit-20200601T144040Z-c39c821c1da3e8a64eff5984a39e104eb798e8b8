{
  "sha": "c39c821c1da3e8a64eff5984a39e104eb798e8b8",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzM5YzgyMWMxZGEzZThhNjRlZmY1OTg0YTM5ZTEwNGViNzk4ZThiOA==",
  "commit": {
    "author": {
      "name": "Alex Coplan",
      "email": "alex.coplan@arm.com",
      "date": "2020-05-29T15:04:50Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-06-01T14:40:40Z"
    },
    "message": "gas: Fix checking for backwards .org with negative offset\n\nThis patch fixes internal errors in (at least) arm and aarch64 GAS\nwhen assembling code that attempts a negative .org.  The bug appears\nto be a regression introduced in binutils-2.29 by commit 9875b36538d.\n\n\t* write.c (relax_segment): Fix handling of negative offset when\n\trelaxing an rs_org frag.\n\t* testsuite/gas/aarch64/org-neg.d: New test.\n\t* testsuite/gas/aarch64/org-neg.l: Error output for test.\n\t* testsuite/gas/aarch64/org-neg.s: Input for test.\n\t* testsuite/gas/arm/org-neg.d: New test.\n\t* testsuite/gas/arm/org-neg.l: Error output for test.\n\t* testsuite/gas/arm/org-neg.s: Input for test.",
    "tree": {
      "sha": "e624f399a22271c5a1ff6d681387468e31f31c16",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e624f399a22271c5a1ff6d681387468e31f31c16"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c39c821c1da3e8a64eff5984a39e104eb798e8b8",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c39c821c1da3e8a64eff5984a39e104eb798e8b8",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c39c821c1da3e8a64eff5984a39e104eb798e8b8",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c39c821c1da3e8a64eff5984a39e104eb798e8b8/comments",
  "author": {
    "login": "acoplan-arm",
    "id": 86676934,
    "node_id": "MDQ6VXNlcjg2Njc2OTM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/86676934?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/acoplan-arm",
    "html_url": "https://github.com/acoplan-arm",
    "followers_url": "https://api.github.com/users/acoplan-arm/followers",
    "following_url": "https://api.github.com/users/acoplan-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/acoplan-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/acoplan-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/acoplan-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/acoplan-arm/orgs",
    "repos_url": "https://api.github.com/users/acoplan-arm/repos",
    "events_url": "https://api.github.com/users/acoplan-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/acoplan-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2fdb65f247379befd548a33ea185172968b9ebb9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2fdb65f247379befd548a33ea185172968b9ebb9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2fdb65f247379befd548a33ea185172968b9ebb9"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 27,
    "deletions": 2
  },
  "files": [
    {
      "sha": "b105aa0ab6015cd73ce1e486100f63bafa60a229",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -1,3 +1,14 @@\n+2020-06-01  Alex Coplan  <alex.coplan@arm.com>\n+\n+\t* write.c (relax_segment): Fix handling of negative offset when\n+\trelaxing an rs_org frag.\n+\t* testsuite/gas/aarch64/org-neg.d: New test.\n+\t* testsuite/gas/aarch64/org-neg.l: Error output for test.\n+\t* testsuite/gas/aarch64/org-neg.s: Input for test.\n+\t* testsuite/gas/arm/org-neg.d: New test.\n+\t* testsuite/gas/arm/org-neg.l: Error output for test.\n+\t* testsuite/gas/arm/org-neg.s: Input for test.\n+\n 2020-05-28  Stephen Casner  <casner@acm.org>\n \n \tFix unexpected failures in gas testsuite for pdp11-aout target."
    },
    {
      "sha": "83e6af6afb084adda8df1d9c7725259b03bdd101",
      "filename": "gas/testsuite/gas/aarch64/org-neg.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/aarch64/org-neg.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/aarch64/org-neg.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/org-neg.d?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -0,0 +1,3 @@\n+#name: negative org should not cause internal error\n+#source: org-neg.s\n+#error_output: org-neg.l"
    },
    {
      "sha": "f8414adc19f3402d4b852903d4fb81adaa3b5222",
      "filename": "gas/testsuite/gas/aarch64/org-neg.l",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/aarch64/org-neg.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/aarch64/org-neg.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/org-neg.l?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -0,0 +1,2 @@\n+[^:]*: Assembler messages:\n+.*: Error: attempt to move .org backwards"
    },
    {
      "sha": "403e70d5e01b7433875f6b05a5db0b2082db1b68",
      "filename": "gas/testsuite/gas/aarch64/org-neg.s",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/aarch64/org-neg.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/aarch64/org-neg.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/org-neg.s?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -0,0 +1,2 @@\n+.=-1\n+ret"
    },
    {
      "sha": "83e6af6afb084adda8df1d9c7725259b03bdd101",
      "filename": "gas/testsuite/gas/arm/org-neg.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/arm/org-neg.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/arm/org-neg.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/org-neg.d?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -0,0 +1,3 @@\n+#name: negative org should not cause internal error\n+#source: org-neg.s\n+#error_output: org-neg.l"
    },
    {
      "sha": "f8414adc19f3402d4b852903d4fb81adaa3b5222",
      "filename": "gas/testsuite/gas/arm/org-neg.l",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/arm/org-neg.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/arm/org-neg.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/org-neg.l?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -0,0 +1,2 @@\n+[^:]*: Assembler messages:\n+.*: Error: attempt to move .org backwards"
    },
    {
      "sha": "f60486e2c83a315841cc1ac8bd35288bc242e922",
      "filename": "gas/testsuite/gas/arm/org-neg.s",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/arm/org-neg.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/testsuite/gas/arm/org-neg.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/arm/org-neg.s?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -0,0 +1,2 @@\n+.=-1\n+nop"
    },
    {
      "sha": "9a50185b157b3a11998a1df2eda747f9d5f72fe8",
      "filename": "gas/write.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/write.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c39c821c1da3e8a64eff5984a39e104eb798e8b8/gas/write.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/write.c?ref=c39c821c1da3e8a64eff5984a39e104eb798e8b8",
      "patch": "@@ -2940,7 +2940,7 @@ relax_segment (struct frag *segment_frag_root, segT segment, int pass)\n \n \t      case rs_org:\n \t\t{\n-\t\t  addressT target = offset;\n+\t\t  offsetT target = offset;\n \t\t  addressT after;\n \n \t\t  if (symbolP)\n@@ -2960,7 +2960,7 @@ relax_segment (struct frag *segment_frag_root, segT segment, int pass)\n \t\t  /* Growth may be negative, but variable part of frag\n \t\t     cannot have fewer than 0 chars.  That is, we can't\n \t\t     .org backwards.  */\n-\t\t  if (address + fragP->fr_fix > target)\n+\t\t  if ((offsetT) (address + fragP->fr_fix) > target)\n \t\t    {\n \t\t      growth = 0;\n "
    }
  ]
}