{
  "sha": "12adf8053ba0b241d3973b46109842a1cbfa60de",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTJhZGY4MDUzYmEwYjI0MWQzOTczYjQ2MTA5ODQyYTFjYmZhNjBkZQ==",
  "commit": {
    "author": {
      "name": "David Faust",
      "email": "david.faust@oracle.com",
      "date": "2020-05-28T18:53:29Z"
    },
    "committer": {
      "name": "Jose E. Marchesi",
      "email": "jose.marchesi@oracle.com",
      "date": "2020-05-28T19:54:46Z"
    },
    "message": "bfd: fix handling of R_BPF_INSN_{32,64} relocations.\n\n2020-05-28  David Faust  <david.faust@oracle.com>\n\n\t* elf64-bpf.c (bpf_elf_relocate_section): Fix handling of\n\tR_BPF_INSN_{32,64} relocations.",
    "tree": {
      "sha": "4d32cb434c7326a1bec0db1286b9634895321167",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4d32cb434c7326a1bec0db1286b9634895321167"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/12adf8053ba0b241d3973b46109842a1cbfa60de",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/12adf8053ba0b241d3973b46109842a1cbfa60de",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/12adf8053ba0b241d3973b46109842a1cbfa60de",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/12adf8053ba0b241d3973b46109842a1cbfa60de/comments",
  "author": {
    "login": "dafaust",
    "id": 4460334,
    "node_id": "MDQ6VXNlcjQ0NjAzMzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4460334?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dafaust",
    "html_url": "https://github.com/dafaust",
    "followers_url": "https://api.github.com/users/dafaust/followers",
    "following_url": "https://api.github.com/users/dafaust/following{/other_user}",
    "gists_url": "https://api.github.com/users/dafaust/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dafaust/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dafaust/subscriptions",
    "organizations_url": "https://api.github.com/users/dafaust/orgs",
    "repos_url": "https://api.github.com/users/dafaust/repos",
    "events_url": "https://api.github.com/users/dafaust/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dafaust/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jemarch",
    "id": 7061875,
    "node_id": "MDQ6VXNlcjcwNjE4NzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7061875?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jemarch",
    "html_url": "https://github.com/jemarch",
    "followers_url": "https://api.github.com/users/jemarch/followers",
    "following_url": "https://api.github.com/users/jemarch/following{/other_user}",
    "gists_url": "https://api.github.com/users/jemarch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jemarch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jemarch/subscriptions",
    "organizations_url": "https://api.github.com/users/jemarch/orgs",
    "repos_url": "https://api.github.com/users/jemarch/repos",
    "events_url": "https://api.github.com/users/jemarch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jemarch/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "78c1c35437a013c63acbff6926ff8d254e283d69",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/78c1c35437a013c63acbff6926ff8d254e283d69",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/78c1c35437a013c63acbff6926ff8d254e283d69"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 31,
    "deletions": 1
  },
  "files": [
    {
      "sha": "05452c5d46717d254d59c177eb5bb3dcc26fa4ac",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/12adf8053ba0b241d3973b46109842a1cbfa60de/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/12adf8053ba0b241d3973b46109842a1cbfa60de/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=12adf8053ba0b241d3973b46109842a1cbfa60de",
      "patch": "@@ -1,3 +1,8 @@\n+2020-05-28  David Faust  <david.faust@oracle.com>\n+\n+\t* elf64-bpf.c (bpf_elf_relocate_section): Fix handling of\n+\tR_BPF_INSN_{32,64} relocations.\n+\n 2020-05-28  Stephen Casner  <casner@acm.org>\n \n \t* pdp11.c: Implement BRD_RELOC_32 to relocate the low 16 bits of"
    },
    {
      "sha": "641caa1f058e07a99c3cdb94086fb3586b417d88",
      "filename": "bfd/elf64-bpf.c",
      "status": "modified",
      "additions": 26,
      "deletions": 1,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/12adf8053ba0b241d3973b46109842a1cbfa60de/bfd/elf64-bpf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/12adf8053ba0b241d3973b46109842a1cbfa60de/bfd/elf64-bpf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-bpf.c?ref=12adf8053ba0b241d3973b46109842a1cbfa60de",
      "patch": "@@ -64,7 +64,7 @@ static reloc_howto_type bpf_elf_howto_table [] =\n \t MINUS_ONE,\t\t/* dst_mask */\n \t TRUE),\t\t\t/* pcrel_offset */\n \n-  /* 32-immediate in LDDW instruction.  */\n+  /* 32-immediate in many instructions. Note: handled manually.  */\n   HOWTO (R_BPF_INSN_32,\t\t/* type */\n \t 0,\t\t\t/* rightshift */\n \t 2,\t\t\t/* size (0 = byte, 1 = short, 2 = long) */\n@@ -460,6 +460,31 @@ bpf_elf_relocate_section (bfd *output_bfd ATTRIBUTE_UNUSED,\n             r = bfd_reloc_ok;\n             break;\n           }\n+        case R_BPF_INSN_32:\n+          {\n+            /*  Write relocated value */\n+            bfd_put (howto->bitsize, input_bfd, relocation,\n+                     contents + rel->r_offset + 4);\n+\n+            r = bfd_reloc_ok;\n+            break;\n+          }\n+        case R_BPF_INSN_64:\n+          {\n+            /*\n+                LDDW instructions are 128 bits long, with a 64-bit immediate.\n+                The lower 32 bits of the immediate are in the same position\n+                as the imm32 field of other instructions.\n+                The upper 32 bits of the immediate are stored at the end of\n+                the instruction.\n+             */\n+            bfd_put (32, input_bfd, (relocation & 0xFFFFFFFF),\n+                     contents + rel->r_offset + 4);\n+            bfd_put (32, input_bfd, (relocation >> 32),\n+                     contents + rel->r_offset + 12);\n+            r = bfd_reloc_ok;\n+            break;\n+          }\n         default:\n           r = _bfd_final_link_relocate (howto, input_bfd, input_section,\n                                         contents, rel->r_offset, relocation,"
    }
  ]
}