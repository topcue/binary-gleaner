{
  "sha": "22cc388e2b940608d4d759dc61c0335cfc621de1",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjJjYzM4OGUyYjk0MDYwOGQ0ZDc1OWRjNjFjMDMzNWNmYzYyMWRlMQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-10-19T13:45:05Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-10-19T19:45:24Z"
    },
    "message": "Don't erase TUI source window when switching focus\n\nPR tui/26719 points out that switching the focus can erase the TUI\nsource window.  This is a regression introduced by the patch to switch\nthe source window to using a pad.\n\nThis patch fixes the bug by arranging to call prefresh whenever the\nwindow is refreshed.\n\n2020-10-19  Tom Tromey  <tromey@adacore.com>\n\n\tPR tui/26719\n\t* tui/tui-winsource.h (struct tui_source_window_base)\n\t<refresh_window>: Rename from refresh_pad.\n\t* tui/tui-winsource.c (tui_source_window_base::refresh_window):\n\tRename from refresh_pad.\n\t(tui_source_window_base::show_source_content)\n\t(tui_source_window_base::do_scroll_horizontal): Update.\n\ngdb/testsuite/ChangeLog\n2020-10-19  Tom Tromey  <tromey@adacore.com>\n\n\tPR tui/26719\n\t* gdb.tui/list.exp: Check source window contents after focus\n\tchange.",
    "tree": {
      "sha": "359e6288d162b0178a049f6158964b115bef62a8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/359e6288d162b0178a049f6158964b115bef62a8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/22cc388e2b940608d4d759dc61c0335cfc621de1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/22cc388e2b940608d4d759dc61c0335cfc621de1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/22cc388e2b940608d4d759dc61c0335cfc621de1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/22cc388e2b940608d4d759dc61c0335cfc621de1/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3c6eb4d439a31ec39d8c04f3b99d8a9f0bd607d2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3c6eb4d439a31ec39d8c04f3b99d8a9f0bd607d2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/3c6eb4d439a31ec39d8c04f3b99d8a9f0bd607d2"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 24,
    "deletions": 7
  },
  "files": [
    {
      "sha": "4dc1e42c3b6ddcf8d5d960e5f035b9668dcabe79",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=22cc388e2b940608d4d759dc61c0335cfc621de1",
      "patch": "@@ -1,3 +1,13 @@\n+2020-10-19  Tom Tromey  <tromey@adacore.com>\n+\n+\tPR tui/26719\n+\t* tui/tui-winsource.h (struct tui_source_window_base)\n+\t<refresh_window>: Rename from refresh_pad.\n+\t* tui/tui-winsource.c (tui_source_window_base::refresh_window):\n+\tRename from refresh_pad.\n+\t(tui_source_window_base::show_source_content)\n+\t(tui_source_window_base::do_scroll_horizontal): Update.\n+\n 2020-10-19  Tankut Baris Aktemur  <tankut.baris.aktemur@intel.com>\n \n \t* thread.c (_initialize_thread): Fine-tune the help text of"
    },
    {
      "sha": "0a22f67864de75ec74b013059c55c08a41d28305",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=22cc388e2b940608d4d759dc61c0335cfc621de1",
      "patch": "@@ -1,3 +1,9 @@\n+2020-10-19  Tom Tromey  <tromey@adacore.com>\n+\n+\tPR tui/26719\n+\t* gdb.tui/list.exp: Check source window contents after focus\n+\tchange.\n+\n 2020-10-17  Tom de Vries  <tdevries@suse.de>\n \n \tPR symtab/26317"
    },
    {
      "sha": "8c7585b295a309588ab131e9706bc7c08a36bb87",
      "filename": "gdb/testsuite/gdb.tui/list.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/testsuite/gdb.tui/list.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/testsuite/gdb.tui/list.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.tui/list.exp?ref=22cc388e2b940608d4d759dc61c0335cfc621de1",
      "patch": "@@ -40,3 +40,5 @@ Term::check_contents \"list -q main\" \"21 *return 0\"\n # to ensure that GDB has a valid idea of what is currently focused.\n Term::command \"focus next\"\n Term::check_contents \"focus next\" \"Focus set to cmd window\"\n+# PR tui/26719 - switching focus would clear the source window.\n+Term::check_contents \"source is still visible\" \"21 *return 0\""
    },
    {
      "sha": "957d9310f7a8717ffa0bc3ddf00ae4a28a6d9247",
      "filename": "gdb/tui/tui-winsource.c",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/tui/tui-winsource.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/tui/tui-winsource.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-winsource.c?ref=22cc388e2b940608d4d759dc61c0335cfc621de1",
      "patch": "@@ -250,8 +250,10 @@ tui_source_window_base::show_source_line (int lineno)\n /* See tui-winsource.h.  */\n \n void\n-tui_source_window_base::refresh_pad ()\n+tui_source_window_base::refresh_window ()\n {\n+  tui_win_info::refresh_window ();\n+\n   int pad_width = std::max (m_max_length, width);\n   int left_margin = 1 + TUI_EXECINFO_SIZE + extra_margin ();\n   int view_width = width - left_margin - 1;\n@@ -278,8 +280,6 @@ tui_source_window_base::show_source_content ()\n   for (int lineno = 0; lineno < m_content.size (); lineno++)\n     show_source_line (lineno);\n \n-  refresh_pad ();\n-\n   refresh_window ();\n }\n \n@@ -377,7 +377,7 @@ tui_source_window_base::do_scroll_horizontal (int num_to_scroll)\n       if (offset < 0)\n \toffset = 0;\n       m_horizontal_offset = offset;\n-      refresh_pad ();\n+      refresh_window ();\n     }\n }\n "
    },
    {
      "sha": "6dcf0efe4b9524dec1e096c1302a0d5583da93d0",
      "filename": "gdb/tui/tui-winsource.h",
      "status": "modified",
      "additions": 2,
      "deletions": 3,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/tui/tui-winsource.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/22cc388e2b940608d4d759dc61c0335cfc621de1/gdb/tui/tui-winsource.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-winsource.h?ref=22cc388e2b940608d4d759dc61c0335cfc621de1",
      "patch": "@@ -171,6 +171,8 @@ struct tui_source_window_base : public tui_win_info\n   /* Erase the source content.  */\n   virtual void erase_source_content () = 0;\n \n+  void refresh_window () override;\n+\n   /* Return the start address and gdbarch.  */\n   virtual void display_start_addr (struct gdbarch **gdbarch_p,\n \t\t\t\t   CORE_ADDR *addr_p) = 0;\n@@ -179,9 +181,6 @@ struct tui_source_window_base : public tui_win_info\n \n   void show_source_content ();\n \n-  /* Re-display the pad in the window.  */\n-  void refresh_pad ();\n-\n   /* Called when the user \"set style enabled\" setting is changed.  */\n   void style_changed ();\n "
    }
  ]
}