{
  "sha": "aa3b653351504e262fb455af5efb6eea6d981597",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YWEzYjY1MzM1MTUwNGUyNjJmYjQ1NWFmNWVmYjZlZWE2ZDk4MTU5Nw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-06-06T17:20:51Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-07-30T18:34:51Z"
    },
    "message": "Allow nested function displays\n\nIn Ada, it's possible to have nested functions.  However,\nblock.c:contained_in does not recognize this.  Normally, this is no\nproblem, but if gdb is stopped inside a nested function, then you can\nend up in the unexpected situation that \"print\" of an expression will\nwork, whereas \"display\" of the same expression will not -- because\ncontained_in returns 0.\n\nThis patch simply removes the BLOCK_FUNCTION check from contained_in.\nThe rationale here is that in languages without nested functions, this\nwill not cause any issues.\n\ngdb/ChangeLog\n2019-07-30  Tom Tromey  <tromey@adacore.com>\n\n\t* block.c (contained_in): Remove BLOCK_FUNCTION check.\n\ngdb/testsuite/ChangeLog\n2019-07-30  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.ada/display_nested.exp: New file.\n\t* gdb.ada/display_nested/foo.adb: New file.\n\t* gdb.ada/display_nested/pack.adb: New file.\n\t* gdb.ada/display_nested/pack.ads: New file.",
    "tree": {
      "sha": "938ce24709ea2bd8f16c6da92dc819637d8ae613",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/938ce24709ea2bd8f16c6da92dc819637d8ae613"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/aa3b653351504e262fb455af5efb6eea6d981597",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa3b653351504e262fb455af5efb6eea6d981597",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/aa3b653351504e262fb455af5efb6eea6d981597",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa3b653351504e262fb455af5efb6eea6d981597/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a1530dc7319595b5980e8501092782724c946351",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a1530dc7319595b5980e8501092782724c946351",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a1530dc7319595b5980e8501092782724c946351"
    }
  ],
  "stats": {
    "total": 117,
    "additions": 113,
    "deletions": 4
  },
  "files": [
    {
      "sha": "44ab7226fada7c5335d581cfe005988b5bd23243",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -1,3 +1,7 @@\n+2019-07-30  Tom Tromey  <tromey@adacore.com>\n+\n+\t* block.c (contained_in): Remove BLOCK_FUNCTION check.\n+\n 2019-07-30  Kevin Buettner  <kevinb@redhat.com>\n \n \t* printcmd.c (print_address_symbolic): Print negative offsets."
    },
    {
      "sha": "5c6faa850457efecf76c13a3ed2bb8f2f8edc5d2",
      "filename": "gdb/block.c",
      "status": "modified",
      "additions": 0,
      "deletions": 4,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/block.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/block.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/block.c?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -79,10 +79,6 @@ contained_in (const struct block *a, const struct block *b)\n     {\n       if (a == b)\n \treturn 1;\n-      /* If A is a function block, then A cannot be contained in B,\n-         except if A was inlined.  */\n-      if (BLOCK_FUNCTION (a) != NULL && !block_inlined_p (a))\n-        return 0;\n       a = BLOCK_SUPERBLOCK (a);\n     }\n   while (a != NULL);"
    },
    {
      "sha": "d88157cb0da2565ab90b40b028d228fa490bd12b",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -1,3 +1,10 @@\n+2019-07-30  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.ada/display_nested.exp: New file.\n+\t* gdb.ada/display_nested/foo.adb: New file.\n+\t* gdb.ada/display_nested/pack.adb: New file.\n+\t* gdb.ada/display_nested/pack.ads: New file.\n+\n 2019-07-30  Christian Biesinger  <cbiesinger@google.com>\n \n \t* gdb.python/py-symbol.c: Add a static variable and one in an anonymous"
    },
    {
      "sha": "9a66264881ebcc690e8bff06edc193638be25fe3",
      "filename": "gdb/testsuite/gdb.ada/display_nested.exp",
      "status": "added",
      "additions": 29,
      "deletions": 0,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/display_nested.exp?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -0,0 +1,29 @@\n+# Copyright 2019 Free Software Foundation, Inc.\n+#\n+# This program is free software; you can redistribute it and/or modify\n+# it under the terms of the GNU General Public License as published by\n+# the Free Software Foundation; either version 3 of the License, or\n+# (at your option) any later version.\n+#\n+# This program is distributed in the hope that it will be useful,\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+# GNU General Public License for more details.\n+#\n+# You should have received a copy of the GNU General Public License\n+# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+load_lib \"ada.exp\"\n+\n+standard_ada_testfile foo\n+\n+if {[gdb_compile_ada \"${srcfile}\" \"${binfile}\" executable debug] != \"\"} {\n+    return -1\n+}\n+\n+clean_restart ${testfile}\n+\n+set bp_location [gdb_get_line_number \"BREAK\" ${testdir}/foo.adb]\n+runto \"foo.adb:$bp_location\"\n+\n+gdb_test \"display s(I..I+5)\" [string_to_regexp \"1: s(I..I+5) = \\\"test s\\\"\"]"
    },
    {
      "sha": "543e993ea48d2b8d9aa85efb41c2ab33546fe78c",
      "filename": "gdb/testsuite/gdb.ada/display_nested/foo.adb",
      "status": "added",
      "additions": 30,
      "deletions": 0,
      "changes": 30,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested/foo.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested/foo.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/display_nested/foo.adb?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -0,0 +1,30 @@\n+--  Copyright 2019 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+with Pack; use Pack;\n+\n+procedure Foo is\n+   S : String := \"test string\";\n+   I : Natural := S'First;\n+begin\n+  declare\n+    procedure Nested is\n+    begin\n+       Do_Nothing (S);\t\t--  BREAK\n+    end Nested;\n+  begin\n+    Nested;\n+  end;\n+end Foo;"
    },
    {
      "sha": "fa2d6073117c8be03518cd333f6ddb11ef45cb0a",
      "filename": "gdb/testsuite/gdb.ada/display_nested/pack.adb",
      "status": "added",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested/pack.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested/pack.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/display_nested/pack.adb?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -0,0 +1,23 @@\n+--  Copyright 2019 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+package body Pack is\n+\n+   procedure Do_Nothing (S : String) is\n+   begin\n+      null;\n+   end Do_Nothing;\n+\n+end Pack;"
    },
    {
      "sha": "133d070b96a2b4991e70755f340e1c24cce473b1",
      "filename": "gdb/testsuite/gdb.ada/display_nested/pack.ads",
      "status": "added",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested/pack.ads",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa3b653351504e262fb455af5efb6eea6d981597/gdb/testsuite/gdb.ada/display_nested/pack.ads",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/display_nested/pack.ads?ref=aa3b653351504e262fb455af5efb6eea6d981597",
      "patch": "@@ -0,0 +1,20 @@\n+--  Copyright 2019 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+package Pack is\n+\n+   procedure Do_Nothing (S : String);\n+\n+end Pack;"
    }
  ]
}