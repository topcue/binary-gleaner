{
  "sha": "9918bff7cf2a566aaa2036d2242a61c140652dc7",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTkxOGJmZjdjZjJhNTY2YWFhMjAzNmQyMjQyYTYxYzE0MDY1MmRjNw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-02-02T04:35:14Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-02-02T09:39:42Z"
    },
    "message": "PR27311, ld.bfd (symbol from plugin): undefined reference\n\nA default versioned symbol definition in a shared library is\noverridden by an unversioned definition in a regular object file, and\nthus should not be reason to make an as-needed library needed.\n\nbfd/\n\tPR 27311\n\t* elflink.c (_bfd_elf_add_default_symbol): Add override parameter.\n\tUse when handling default versioned symbol.  Rename existing\n\toverride variable to nondef_override and use for non-default\n\tversioned symbol.\n\t(elf_link_add_object_symbols): Adjust call to suit.  Don't\n\tpull in as-needed libraries when override is set.\nld/\n\t* testsuite/ld-plugin/pr27311.d,\n\t* testsuite/ld-plugin/pr27311.ver,\n\t* testsuite/ld-plugin/pr27311a.c,\n\t* testsuite/ld-plugin/pr27311b.c,\n\t* testsuite/ld-plugin/pr27311c.c: New testcase.\n\t* testsuite/ld-plugin/lto.exp: Run it.  Correct PR14918 and\n\tPR12982 entries.",
    "tree": {
      "sha": "b2498f984c21d1aa2ef837e1dab0e281fd392a43",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b2498f984c21d1aa2ef837e1dab0e281fd392a43"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9918bff7cf2a566aaa2036d2242a61c140652dc7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9918bff7cf2a566aaa2036d2242a61c140652dc7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9918bff7cf2a566aaa2036d2242a61c140652dc7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9918bff7cf2a566aaa2036d2242a61c140652dc7/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2bd3e4b8d2580839a457e221d4e1e09105248215",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2bd3e4b8d2580839a457e221d4e1e09105248215",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2bd3e4b8d2580839a457e221d4e1e09105248215"
    }
  ],
  "stats": {
    "total": 73,
    "additions": 60,
    "deletions": 13
  },
  "files": [
    {
      "sha": "d65c56d009bf33133518129ac345e48d50285dea",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -1,3 +1,13 @@\n+2021-02-02  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27311\n+\t* elflink.c (_bfd_elf_add_default_symbol): Add override parameter.\n+\tUse when handling default versioned symbol.  Rename existing\n+\toverride variable to nondef_override and use for non-default\n+\tversioned symbol.\n+\t(elf_link_add_object_symbols): Adjust call to suit.  Don't\n+\tpull in as-needed libraries when override is set.\n+\n 2021-02-01  Emery Hemingway  <ehmry@posteo.net>\n \n \t* config.bfd: Add *-*-genode* as a target for AArch64 and x86."
    },
    {
      "sha": "7ac38cac6913c87742a1141216dc9378b5976212",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 10,
      "deletions": 7,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -1850,7 +1850,8 @@ _bfd_elf_add_default_symbol (bfd *abfd,\n \t\t\t     asection *sec,\n \t\t\t     bfd_vma value,\n \t\t\t     bfd **poldbfd,\n-\t\t\t     bfd_boolean *dynsym)\n+\t\t\t     bfd_boolean *dynsym,\n+\t\t\t     bfd **override)\n {\n   bfd_boolean type_change_ok;\n   bfd_boolean size_change_ok;\n@@ -1861,7 +1862,7 @@ _bfd_elf_add_default_symbol (bfd *abfd,\n   const struct elf_backend_data *bed;\n   bfd_boolean collect;\n   bfd_boolean dynamic;\n-  bfd *override;\n+  bfd *nondef_override;\n   char *p;\n   size_t len, shortlen;\n   asection *tmp_sec;\n@@ -1921,7 +1922,7 @@ _bfd_elf_add_default_symbol (bfd *abfd,\n   matched = TRUE;\n   tmp_sec = sec;\n   if (!_bfd_elf_merge_symbol (abfd, info, shortname, sym, &tmp_sec, &value,\n-\t\t\t      &hi, poldbfd, NULL, NULL, &skip, &override,\n+\t\t\t      &hi, poldbfd, NULL, NULL, &skip, override,\n \t\t\t      &type_change_ok, &size_change_ok, &matched))\n     return FALSE;\n \n@@ -1953,7 +1954,7 @@ _bfd_elf_add_default_symbol (bfd *abfd,\n \tgoto nondefault;\n     }\n \n-  if (! override)\n+  if (!*override)\n     {\n       /* Add the default symbol if not performing a relocatable link.  */\n       if (! bfd_link_relocatable (info))\n@@ -2080,7 +2081,7 @@ _bfd_elf_add_default_symbol (bfd *abfd,\n   size_change_ok = FALSE;\n   tmp_sec = sec;\n   if (!_bfd_elf_merge_symbol (abfd, info, shortname, sym, &tmp_sec, &value,\n-\t\t\t      &hi, poldbfd, NULL, NULL, &skip, &override,\n+\t\t\t      &hi, poldbfd, NULL, NULL, &skip, &nondef_override,\n \t\t\t      &type_change_ok, &size_change_ok, &matched))\n     return FALSE;\n \n@@ -2104,7 +2105,7 @@ _bfd_elf_add_default_symbol (bfd *abfd,\n       else\n \treturn TRUE;\n     }\n-  else if (override)\n+  else if (nondef_override)\n     {\n       /* Here SHORTNAME is a versioned name, so we don't expect to see\n \t the type of override we do in the case above unless it is\n@@ -5089,7 +5090,8 @@ elf_link_add_object_symbols (bfd *abfd, struct bfd_link_info *info)\n \t      && !(hi != h\n \t\t   && hi->versioned == versioned_hidden))\n \t    if (!_bfd_elf_add_default_symbol (abfd, info, h, name, isym,\n-\t\t\t\t\t      sec, value, &old_bfd, &dynsym))\n+\t\t\t\t\t      sec, value, &old_bfd, &dynsym,\n+\t\t\t\t\t      &override))\n \t      goto error_free_vers;\n \n \t  /* Check the alignment when a common symbol is involved. This\n@@ -5272,6 +5274,7 @@ elf_link_add_object_symbols (bfd *abfd, struct bfd_link_info *info)\n \t      }\n \n \t  if (!add_needed\n+\t      && !override\n \t      && matched\n \t      && definition\n \t      && ((dynsym"
    },
    {
      "sha": "450137a1bda896c4ad92c21f00872e54692432a9",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -1,3 +1,13 @@\n+2021-02-02  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-plugin/pr27311.d,\n+\t* testsuite/ld-plugin/pr27311.ver,\n+\t* testsuite/ld-plugin/pr27311a.c,\n+\t* testsuite/ld-plugin/pr27311b.c,\n+\t* testsuite/ld-plugin/pr27311c.c: New testcase.\n+\t* testsuite/ld-plugin/lto.exp: Run it.  Correct PR14918 and\n+\tPR12982 entries.\n+\n 2021-02-01  Emery Hemingway  <ehmry@posteo.net>\n \n \t* configure.tgt: Add *-*-genode* as a target for AArch64 and x86."
    },
    {
      "sha": "324adcd00ceb4aa08aa8eb7c3861e174080f1db7",
      "filename": "ld/testsuite/ld-plugin/lto.exp",
      "status": "modified",
      "additions": 16,
      "deletions": 6,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/lto.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/lto.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-plugin/lto.exp?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -415,6 +415,18 @@ set lto_link_elf_tests [list \\\n   [list {pr26806.so} \\\n    {-shared} {-fpic -O2 -flto} \\\n    {pr26806.c} {{nm {-D} pr26806.d}} {pr26806.so}] \\\n+  [list {pr27311a.so} \\\n+   {-shared -Wl,--version-script=pr27311.ver} {-fPIC} \\\n+   {pr27311a.c} {} {pr27311a.so}] \\\n+  [list {pr27311b.so} \\\n+   {-shared -Wl,--no-as-needed tmpdir/pr27311a.so} {-fPIC} \\\n+   {pr27311b.c} {} {pr27311b.so}] \\\n+  [list {pr27311c.o} \\\n+   {} {-flto} \\\n+   {pr27311c.c} {} {} {c}] \\\n+  [list {pr27311} \\\n+   {tmpdir/pr27311c.o -Wl,--no-as-needed,--rpath-link=. tmpdir/pr27311b.so} {} \\\n+   {dummy.c} {{readelf {--dyn-syms --wide} pr27311.d}} {pr27311}] \\\n ]\n \n # PR 14918 checks that libgcc is not spuriously included in a shared link of\n@@ -423,23 +435,21 @@ set lto_link_elf_tests [list \\\n # __aeabi_unwind_cpp_pr0@@GCC_3.5 which is provided by libgcc_s.so.1, so the\n # test fails.  Hence this code to skip the test.\n if { ! [istarget \"arm*-*-*\"] } {\n-    lappend lto_link_elf_tests [list \\\n+    lappend lto_link_elf_tests \\\n   [list \"PR ld/14918\" \\\n    \"-flto\" \"-flto\" \\\n-   {pr14918.c} {{\"readelf\" {-d --wide} \"pr14918.d\"}} \"pr14918.exe\" \"c\"] \\\n-  ]\n+   {pr14918.c} {{\"readelf\" {-d --wide} \"pr14918.d\"}} \"pr14918.exe\" \"c\"]\n }\n \n # PR 12982 checks that an executable stack is not created by default\n # when using the LTO plugin.  The HPPA target however requires an\n # executable stack for syscall restarts and signal returns, so we\n # skip this test for that target.\n if { ! [istarget \"hppa*-*-*\"] } {\n-    lappend lto_link_elf_tests [list \\\n+    lappend lto_link_elf_tests \\\n   [list \"PR ld/12982\" \\\n    \"-O2 -flto -fuse-linker-plugin\" \"-O2 -flto\" \\\n-   {pr12982.c} {{\"readelf\" {-l --wide} \"pr12982.d\"}} \"pr12982.exe\"] \\\n-  ]\n+   {pr12982.c} {{\"readelf\" {-l --wide} \"pr12982.d\"}} \"pr12982.exe\"]\n }\n \n # Check final symbols in executables."
    },
    {
      "sha": "debf41cdc7f4c62ffa57b7a5be1330f3aa5c065e",
      "filename": "ld/testsuite/ld-plugin/pr27311.d",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-plugin/pr27311.d?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -0,0 +1,4 @@\n+#failif\n+#...\n+.* _*inlib1.*\n+#..."
    },
    {
      "sha": "324daf0c5b6598996e47109777588ec6997d8f66",
      "filename": "ld/testsuite/ld-plugin/pr27311.ver",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311.ver",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311.ver",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-plugin/pr27311.ver?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -0,0 +1,3 @@\n+LIBFOO {\n+  *;\n+};"
    },
    {
      "sha": "314984781db23d0d8941ea1a0d60d3bbc875283b",
      "filename": "ld/testsuite/ld-plugin/pr27311a.c",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311a.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311a.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-plugin/pr27311a.c?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -0,0 +1 @@\n+void inlib1(void) {}"
    },
    {
      "sha": "ed9c8a7048ea812dfe7de5166f8d897f6cc1e253",
      "filename": "ld/testsuite/ld-plugin/pr27311b.c",
      "status": "added",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311b.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311b.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-plugin/pr27311b.c?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -0,0 +1 @@\n+void inlib2(void) {}"
    },
    {
      "sha": "6712499130ee470af8782b76d2b76a1347c4cec0",
      "filename": "ld/testsuite/ld-plugin/pr27311c.c",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311c.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9918bff7cf2a566aaa2036d2242a61c140652dc7/ld/testsuite/ld-plugin/pr27311c.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-plugin/pr27311c.c?ref=9918bff7cf2a566aaa2036d2242a61c140652dc7",
      "patch": "@@ -0,0 +1,5 @@\n+void inlib1(void) {}\n+int main()\n+{\n+  return 0;\n+}"
    }
  ]
}