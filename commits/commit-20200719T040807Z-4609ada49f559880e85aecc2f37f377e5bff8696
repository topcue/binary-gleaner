{
  "sha": "4609ada49f559880e85aecc2f37f377e5bff8696",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDYwOWFkYTQ5ZjU1OTg4MGU4NWFlY2MyZjM3ZjM3N2U1YmZmODY5Ng==",
  "commit": {
    "author": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@bitrange.com",
      "date": "2020-07-19T04:08:07Z"
    },
    "committer": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@bitrange.com",
      "date": "2020-07-19T04:08:07Z"
    },
    "message": "ld: optionally emit _etext last, before .data\n\nSo, here's my suggestion for making _init .. __etext cover .text +\n.rodata (including things like the read-only exception tables) for\nelf64mmix.  A quick web search gives that __etext (and friends) isn't\nwell defined, so each target can interpret the \"end of text segment\"\nto their own liking.  It seems likely this change is also a better fit\nthan the default for other ports, at least those with .rodata after\n.text in the same segment.\n\nThe presence of a separate rodata-segment is optional (and not true\nfor elf64mmix).  This is reflected in the name as SEPARATE_TEXT /\nSEPARATE_CODE isn't considered, to keep it simple; each target has to\nmake sure their settings of variables make sense.\n\nld:\n\t* scripttempl/elf.sc (ETEXT_LAST_IN_RODATA_SEGMENT): New variable.\n\t* emulparams/elf64mmix.sh (ETEXT_LAST_IN_RODATA_SEGMENT): Define.\n\t* testsuite/ld-mmix/sec-1.d: Adjust.",
    "tree": {
      "sha": "ba1f1bf3860b622dc0388ec9264be13775c31c32",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ba1f1bf3860b622dc0388ec9264be13775c31c32"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4609ada49f559880e85aecc2f37f377e5bff8696",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4609ada49f559880e85aecc2f37f377e5bff8696",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4609ada49f559880e85aecc2f37f377e5bff8696",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4609ada49f559880e85aecc2f37f377e5bff8696/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "e10a07b32dc1faed25b5bbcbbc47d68e2ff537b9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e10a07b32dc1faed25b5bbcbbc47d68e2ff537b9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e10a07b32dc1faed25b5bbcbbc47d68e2ff537b9"
    }
  ],
  "stats": {
    "total": 25,
    "additions": 21,
    "deletions": 4
  },
  "files": [
    {
      "sha": "37a94aa88068dbb356d3dce403ee06100a3df13e",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4609ada49f559880e85aecc2f37f377e5bff8696/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4609ada49f559880e85aecc2f37f377e5bff8696/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=4609ada49f559880e85aecc2f37f377e5bff8696",
      "patch": "@@ -1,3 +1,9 @@\n+2020-07-19  Hans-Peter Nilsson  <hp@bitrange.com>\n+\n+\t* scripttempl/elf.sc (ETEXT_LAST_IN_RODATA_SEGMENT): New variable.\n+\t* emulparams/elf64mmix.sh (ETEXT_LAST_IN_RODATA_SEGMENT): Define.\n+\t* testsuite/ld-mmix/sec-1.d: Adjust.\n+\n 2020-07-19  Alan Modra  <amodra@gmail.com>\n \n \t* emultempl/ppc64elf.em (power10-stubs): Accept optional \"auto\" arg."
    },
    {
      "sha": "75e24be2e2a4ad56bf7da7bccb150becd597fff6",
      "filename": "ld/emulparams/elf64mmix.sh",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4609ada49f559880e85aecc2f37f377e5bff8696/ld/emulparams/elf64mmix.sh",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4609ada49f559880e85aecc2f37f377e5bff8696/ld/emulparams/elf64mmix.sh",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/emulparams/elf64mmix.sh?ref=4609ada49f559880e85aecc2f37f377e5bff8696",
      "patch": "@@ -44,6 +44,10 @@ ${RELOCATING+\n  PROVIDE (Main = DEFINED (Main) ? Main : (DEFINED (_start) ? _start : _start.));\n }\"\n \n+# We need a symbol at the end of the read-only data, which is\n+# colocated with the code.  We make __etext fit.\n+ETEXT_LAST_IN_RODATA_SEGMENT=\" \"\n+\n OTHER_SECTIONS='\n  .MMIX.reg_contents :\n  {"
    },
    {
      "sha": "eb74743e5c31a5f70af25d8fe211e0ccd651c98f",
      "filename": "ld/scripttempl/elf.sc",
      "status": "modified",
      "additions": 10,
      "deletions": 3,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4609ada49f559880e85aecc2f37f377e5bff8696/ld/scripttempl/elf.sc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4609ada49f559880e85aecc2f37f377e5bff8696/ld/scripttempl/elf.sc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/scripttempl/elf.sc?ref=4609ada49f559880e85aecc2f37f377e5bff8696",
      "patch": "@@ -62,6 +62,9 @@\n #\tOTHER_SYMBOLS - symbols to place right at the end of the script.\n #\tETEXT_NAME - name of a symbol for the end of the text section,\n #\t\tnormally etext.\n+#\tETEXT_LAST_IN_RODATA_SEGMENT - emit ETEXT_NAME after all sections in\n+#\t\tthe read-only data segment (which may or may not be equal to\n+#\t\tthe code segment), instead of after just the code parts.\n #\tSEPARATE_CODE - if set, .text and similar sections containing\n #\t\tactual machine instructions must be in wholly disjoint\n #\t\tpages from any other data, including headers\n@@ -526,9 +529,9 @@ cat <<EOF\n     KEEP (*(SORT_NONE(.fini)))\n     ${RELOCATING+${FINI_END}}\n   } ${FILL}\n-  ${RELOCATING+PROVIDE (__${ETEXT_NAME} = .);}\n-  ${RELOCATING+PROVIDE (_${ETEXT_NAME} = .);}\n-  ${RELOCATING+PROVIDE (${ETEXT_NAME} = .);}\n+  ${RELOCATING+${ETEXT_LAST_IN_RODATA_SEGMENT-PROVIDE (__${ETEXT_NAME} = .);}}\n+  ${RELOCATING+${ETEXT_LAST_IN_RODATA_SEGMENT-PROVIDE (_${ETEXT_NAME} = .);}}\n+  ${RELOCATING+${ETEXT_LAST_IN_RODATA_SEGMENT-PROVIDE (${ETEXT_NAME} = .);}}\n   ${RELOCATING+${TEXT_SEGMENT_ALIGN}}\n EOF\n \n@@ -574,6 +577,10 @@ cat <<EOF\n   .exception_ranges ${RELOCATING-0} : ONLY_IF_RO { *(.exception_ranges${RELOCATING+*}) }\n   ${TEXT_PLT+${PLT_NEXT_DATA+${PLT} ${OTHER_PLT_SECTIONS}}}\n \n+  ${RELOCATING+${ETEXT_LAST_IN_RODATA_SEGMENT+PROVIDE (__${ETEXT_NAME} = .);}}\n+  ${RELOCATING+${ETEXT_LAST_IN_RODATA_SEGMENT+PROVIDE (_${ETEXT_NAME} = .);}}\n+  ${RELOCATING+${ETEXT_LAST_IN_RODATA_SEGMENT+PROVIDE (${ETEXT_NAME} = .);}}\n+\n   ${RELOCATING+/* Adjust the address for the data segment.  We want to adjust up to\n      the same address within the page on the next page up.  */}\n   ${CREATE_SHLIB-${CREATE_PIE-${RELOCATING+. = ${DATA_ADDR-${DATA_SEGMENT_ALIGN}};}}}"
    },
    {
      "sha": "6f82c8e91142e7ce0e7e67c9f159141b5a99ebae",
      "filename": "ld/testsuite/ld-mmix/sec-1.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4609ada49f559880e85aecc2f37f377e5bff8696/ld/testsuite/ld-mmix/sec-1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4609ada49f559880e85aecc2f37f377e5bff8696/ld/testsuite/ld-mmix/sec-1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mmix/sec-1.d?ref=4609ada49f559880e85aecc2f37f377e5bff8696",
      "patch": "@@ -24,7 +24,7 @@ Idx Name          Size      VMA               LMA               File off  Algn\n \n SYMBOL TABLE:\n #...\n-0+1d g +\\*ABS\\* _etext\n+0+30 g +\\*ABS\\* _etext\n #...\n 2000000000000013 g +\\*ABS\\* __bss_start\n 2000000000000013 g +\\*ABS\\* _edata"
    }
  ]
}