{
  "sha": "b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjBhOGMyZmY5YzFiNWY3ZDJlMWVmMWUwZDY1ZGNmZjBlOWYwODljYw==",
  "commit": {
    "author": {
      "name": "Mark Wielaard",
      "email": "mark@klomp.org",
      "date": "2021-03-06T00:49:27Z"
    },
    "committer": {
      "name": "Mark Wielaard",
      "email": "mark@klomp.org",
      "date": "2021-03-06T01:51:04Z"
    },
    "message": "Make valgrind tests more robust by adding --wait=1 to vgdb invocation\n\nOn my setup some valgrind tests failed somewhat reliably because\nthe target remote | vgdb command couldn't find the vgdb-pipe files\nbecause valgrind startup hadn't finished yet.\n\nI tried to fix this by replacing the \"Memcheck, a memory error detector\"\nmatch to \"TO DEBUG THIS PROCESS USING GDB: start GDB like this\" which is\nright before valgrind creates the vgdb-pipe files. But even that didn't\nguarantee that the vgdb-pipe files were there (maybe valgrind should\nprint that text after it has created them?). But also not all tests\nuse --vgdb-error=0, so the text isn't always printed.\n\nTo make the tests reliable I added --wait=1 to the vgdb invocation.\nThat tells vgdb to try to find the vgdb-pipe files, and if they aren't\nthere yet, to wait 1 second and try again.\n\ngdb/testsuite/ChangeLog:\n\n\t* lib/valgrind.exp (vgdb_start): Add --wait=1 to vgdbcmd.",
    "tree": {
      "sha": "e2ef9d2435d9927ba5b8143f12d45270c415a587",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e2ef9d2435d9927ba5b8143f12d45270c415a587"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "dd99cf0c580ac7b989a991283fa9f3eab07aec99",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dd99cf0c580ac7b989a991283fa9f3eab07aec99",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/dd99cf0c580ac7b989a991283fa9f3eab07aec99"
    }
  ],
  "stats": {
    "total": 6,
    "additions": 5,
    "deletions": 1
  },
  "files": [
    {
      "sha": "b7c2e7222ab28452867898a7fc233dc20d55b799",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc",
      "patch": "@@ -1,3 +1,7 @@\n+2021-03-05  Mark Wielaard  <mark@klomp.org>\n+\n+\t* lib/valgrind.exp (vgdb_start): Add --wait=1 to vgdbcmd.\n+\n 2021-03-06  Weimin Pan  <weimin.pan@oracle.com>\n \n \t* gdb.base/ctf-ptype.exp: Add function tests and fix typos."
    },
    {
      "sha": "c214491f7b89cae5b9cbe3d44d026129f790b166",
      "filename": "gdb/testsuite/lib/valgrind.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc/gdb/testsuite/lib/valgrind.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc/gdb/testsuite/lib/valgrind.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/valgrind.exp?ref=b0a8c2ff9c1b5f7d2e1ef1e0d65dcff0e9f089cc",
      "patch": "@@ -87,7 +87,7 @@ proc vgdb_start { {active_at_startup 1} } {\n     # gdbserver and connect to it.\n     gdb_test \"disconnect\" \".*\"\n \n-    set vgdbcmd \"target remote | vgdb --pid=$vgdbpid\"\n+    set vgdbcmd \"target remote | vgdb --wait=1 --pid=$vgdbpid\"\n     if { $active_at_startup } {\n \tgdb_test \"$vgdbcmd\" \" in \\\\.?_start .*\" \"target remote for vgdb\"\n     } else {"
    }
  ]
}