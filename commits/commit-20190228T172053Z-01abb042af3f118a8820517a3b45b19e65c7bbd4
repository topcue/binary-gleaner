{
  "sha": "01abb042af3f118a8820517a3b45b19e65c7bbd4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDFhYmIwNDJhZjNmMTE4YTg4MjA1MTdhM2I0NWIxOWU2NWM3YmJkNA==",
  "commit": {
    "author": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-02-28T17:19:46Z"
    },
    "committer": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-02-28T17:20:53Z"
    },
    "message": "Testsuite: Catch gdbserver socket listen errors\n\nWhen launching gdbserver, the testsuite checks for binding failure but\ndoes not check for failure to listen to socket error (which can happen\ndue to another gdbserver binding to the socket at the same time).\n\nWhen this error occurs, the test will ignore the error and connect GDB\nto the failed port.  This may succeed and GDB will now be connected to\nthe gdbserver from another test.  This eventually causes both tests to\nfail.\n\nWhen running the tests suite with native-gdbserver across many cores,\nthis issue may happen once or twice, each causing random failures for\ntwo .exp testscripts.\n\nExample gdb.log output for the failure:\n\nThe testsuite sucessfully notices a failure to connect to port 2348.\nIt launches again with port 2349, which also fails.  The testsuite\nignores this error and uses gdb to connect to the port - which succeeds.\n\nspawn /work/build/gdb/testsuite/../gdbserver/gdbserver --once localhost:2348 /work/build/gdb/testsuite/outputs/gdb.ada/arrayidx/p^M\nCan't bind address: Address already in use.^M\nExiting^M\nPort 2348 is already in use.\nspawn /work/build/gdb/testsuite/../gdbserver/gdbserver --once localhost:2349 /work/build/gdb/testsuite/outputs/gdb.ada/arrayidx/p^M\nCan't listen on socket: Address already in use.^M\nExiting^M\ntarget remote localhost:2349^M\nRemote debugging using localhost:2349^M\nReading /lib/ld-linux-aarch64.so.1 from remote target...^M\nwarning: File transfers from remote targets can be slow. Use \"set sysroot\" to access files locally instead.^M\nReading /lib/ld-linux-aarch64.so.1 from remote target...^M\nReading symbols from target:/lib/ld-linux-aarch64.so.1...^M\nReading /lib/ld-2.23.so from remote target...^M\nReading /lib/.debug/ld-2.23.so from remote target...^M\nReading /work/build/install/lib/debug//lib/ld-2.23.so from remote target...^M\nReading /work/build/install/lib/debug/lib//ld-2.23.so from remote target...^M\nReading target:/work/build/install/lib/debug/lib//ld-2.23.so from remote target...^M\n(No debugging symbols found in target:/lib/ld-linux-aarch64.so.1)^M\n0x0000ffffbf6d2cc0 in ?? () from target:/lib/ld-linux-aarch64.so.1^M\n(gdb) continue^M\nContinuing.^M\nReading /lib/aarch64-linux-gnu/libc.so.6 from remote target...^M\nReading /lib/aarch64-linux-gnu/libc-2.23.so from remote target...^M\nReading /lib/aarch64-linux-gnu/.debug/libc-2.23.so from remote target...^M\nReading /work/build/install/lib/debug//lib/aarch64-linux-gnu/libc-2.23.so from remote target...^M\nReading /work/build/install/lib/debug/lib/aarch64-linux-gnu//libc-2.23.so from remote target...^M\nReading target:/work/build/install/lib/debug/lib/aarch64-linux-gnu//libc-2.23.so from remote target...^M\n[Inferior 1 (process 35351) exited normally]^M\n(gdb) FAIL: gdb.ada/arrayidx.exp: can't run to main\n\nMeanwhile, at the same time, in another test, gdbserver successfully\nconnects to port 2349.  GDB then tries to connect to the port, but it\ntimes out because the GDB in the test above has already connected to it.\n\nspawn /work/build/gdb/testsuite/../gdbserver/gdbserver --once localhost:2348 /work/build/gdb/testsuite/outputs/gdb.ada/rdv_wait/foo^M\nCan't bind address: Address already in use.^M\nExiting^M\nPort 2348 is already in use.\nspawn /work/build/gdb/testsuite/../gdbserver/gdbserver --once localhost:2349 /work/build/gdb/testsuite/outputs/gdb.ada/rdv_wait/foo^M\nProcess /work/build/gdb/testsuite/outputs/gdb.ada/rdv_wait/foo created; pid = 65162^M\nListening on port 2349^M\nRemote debugging from host 127.0.0.1, port 45154^M\ntarget remote localhost:2349^M\nlocalhost:2349: Connection timed out.^M\n(gdb) ^CQuit^M\n(gdb) task 2^M\nCannot inspect Ada tasks when program is not running^M\n\ngdb/testsuite/ChangeLog:\n\n\t* lib/gdbserver-support.exp (gdbserver_start): Check for listen\n\tfailure.",
    "tree": {
      "sha": "7ba3af92e5f2eab493c4ce9e4ab5622c715ff822",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7ba3af92e5f2eab493c4ce9e4ab5622c715ff822"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/01abb042af3f118a8820517a3b45b19e65c7bbd4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/01abb042af3f118a8820517a3b45b19e65c7bbd4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/01abb042af3f118a8820517a3b45b19e65c7bbd4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/01abb042af3f118a8820517a3b45b19e65c7bbd4/comments",
  "author": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "92137da015d301fec4b7878467d053d379a2f489",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/92137da015d301fec4b7878467d053d379a2f489",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/92137da015d301fec4b7878467d053d379a2f489"
    }
  ],
  "stats": {
    "total": 7,
    "additions": 6,
    "deletions": 1
  },
  "files": [
    {
      "sha": "73d16f4d8eb06717cb3bf96e4d5cb9f1df40a43a",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/01abb042af3f118a8820517a3b45b19e65c7bbd4/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/01abb042af3f118a8820517a3b45b19e65c7bbd4/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=01abb042af3f118a8820517a3b45b19e65c7bbd4",
      "patch": "@@ -1,3 +1,8 @@\n+2019-02-28  Alan Hayward  <alan.hayward@arm.com>\n+\n+        * lib/gdbserver-support.exp (gdbserver_start): Check for listen\n+        failure.\n+\n 2019-02-28  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \tPR gdb/8527"
    },
    {
      "sha": "dbd885aa2213ef1ebdb22b542219c24414eba97f",
      "filename": "gdb/testsuite/lib/gdbserver-support.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/01abb042af3f118a8820517a3b45b19e65c7bbd4/gdb/testsuite/lib/gdbserver-support.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/01abb042af3f118a8820517a3b45b19e65c7bbd4/gdb/testsuite/lib/gdbserver-support.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdbserver-support.exp?ref=01abb042af3f118a8820517a3b45b19e65c7bbd4",
      "patch": "@@ -317,7 +317,7 @@ proc gdbserver_start { options arguments } {\n \t    -timeout 120\n \t    -notransfer\n \t    -re \"Listening on\" { }\n-\t    -re \"Can't bind address: Address already in use\\\\.\\r\\n\" {\n+\t    -re \"Can't (bind address|listen on socket): Address already in use\\\\.\\r\\n\" {\n \t\tverbose -log \"Port $portnum is already in use.\"\n \t\tif ![target_info exists gdb,socketport] {\n \t\t    # Bump the port number to avoid the conflict."
    }
  ]
}