{
  "sha": "53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTNkZmY5MmNiNTZmYjIxZGM4MWMxODNhYTM1YTVhM2FlOGMwNmUzMg==",
  "commit": {
    "author": {
      "name": "Samuel Thibault",
      "email": "samuel.thibault@ens-lyon.org",
      "date": "2020-05-30T18:43:25Z"
    },
    "committer": {
      "name": "Samuel Thibault",
      "email": "samuel.thibault@ens-lyon.org",
      "date": "2020-05-30T18:43:25Z"
    },
    "message": "hurd: add gnu_target pointer to fix thread API calls\n\nFixes\n\n../../gdb/gnu-nat.c:1110:28: error: cannot convert \u2018ptid_t\u2019 to \u2018process_stratum_target*\u2019\n 1110 |        thread_change_ptid (inferior_ptid, ptid);\n\nand others related to 5b6d1e4fa (\"Multi-target support\")\n\ngdb/ChangeLog:\n\n\t* gnu-nat.h (gnu_target): New variable declaration.\n\t* i386-gnu-nat.c (_initialize_i386gnu_nat): Initialize\n\tgnu_target.\n\t* gnu-nat.c (gnu_target): New variable.\n\t(inf_validate_procs): Pass gnu_target to thread_change_ptid,\n\tadd_thread_silent, and add_thread calls.\n\t(gnu_nat_target::create_inferior): Pass gnu_target to\n\tadd_thread_silent, thread_change_ptid call.\n\t(gnu_nat_target::detach): Pass gnu_target to detach_inferior\n\tcall.",
    "tree": {
      "sha": "97e776df28463ce5e3db6cfe942244a9b972894b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/97e776df28463ce5e3db6cfe942244a9b972894b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/comments",
  "author": {
    "login": "sthibaul",
    "id": 5405051,
    "node_id": "MDQ6VXNlcjU0MDUwNTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5405051?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sthibaul",
    "html_url": "https://github.com/sthibaul",
    "followers_url": "https://api.github.com/users/sthibaul/followers",
    "following_url": "https://api.github.com/users/sthibaul/following{/other_user}",
    "gists_url": "https://api.github.com/users/sthibaul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sthibaul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sthibaul/subscriptions",
    "organizations_url": "https://api.github.com/users/sthibaul/orgs",
    "repos_url": "https://api.github.com/users/sthibaul/repos",
    "events_url": "https://api.github.com/users/sthibaul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sthibaul/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "sthibaul",
    "id": 5405051,
    "node_id": "MDQ6VXNlcjU0MDUwNTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5405051?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sthibaul",
    "html_url": "https://github.com/sthibaul",
    "followers_url": "https://api.github.com/users/sthibaul/followers",
    "following_url": "https://api.github.com/users/sthibaul/following{/other_user}",
    "gists_url": "https://api.github.com/users/sthibaul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sthibaul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sthibaul/subscriptions",
    "organizations_url": "https://api.github.com/users/sthibaul/orgs",
    "repos_url": "https://api.github.com/users/sthibaul/repos",
    "events_url": "https://api.github.com/users/sthibaul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sthibaul/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5a8b86270bbce5f9316ef7bdaa1a20b4832335ca",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5a8b86270bbce5f9316ef7bdaa1a20b4832335ca",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5a8b86270bbce5f9316ef7bdaa1a20b4832335ca"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 26,
    "deletions": 6
  },
  "files": [
    {
      "sha": "67faed176e1d05a2bfa915fde265403defed28f1",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
      "patch": "@@ -1,3 +1,16 @@\n+2020-05-30  Samuel Thibault  <samuel.thibault@ens-lyon.org>\n+\n+\t* gnu-nat.h (gnu_target): New variable declaration.\n+\t* i386-gnu-nat.c (_initialize_i386gnu_nat): Initialize\n+\tgnu_target.\n+\t* gnu-nat.c (gnu_target): New variable.\n+\t(inf_validate_procs): Pass gnu_target to thread_change_ptid,\n+\tadd_thread_silent, and add_thread calls.\n+\t(gnu_nat_target::create_inferior): Pass gnu_target to\n+\tadd_thread_silent, thread_change_ptid call.\n+\t(gnu_nat_target::detach): Pass gnu_target to detach_inferior\n+\tcall.\n+\n 2020-05-30  Samuel Thibault  <samuel.thibault@ens-lyon.org>\n \n \t* gnu-nat.c (gnu_xfer_auxv): Remove unused `res' variable."
    },
    {
      "sha": "78e9ab7f717b13576b1de55b9ffae879daa6fd91",
      "filename": "gdb/gnu-nat.c",
      "status": "modified",
      "additions": 8,
      "deletions": 6,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/gnu-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/gnu-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gnu-nat.c?ref=53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
      "patch": "@@ -85,6 +85,8 @@ extern \"C\"\n #include \"msg_U.h\"\n }\n \n+struct gnu_nat_target *gnu_target;\n+\n static process_t proc_server = MACH_PORT_NULL;\n \n /* If we've sent a proc_wait_request to the proc server, the pid of the\n@@ -1107,12 +1109,12 @@ inf_validate_procs (struct inf *inf)\n \t    if (inferior_ptid == ptid_t (inf->pid))\n \t      /* This is the first time we're hearing about thread\n \t\t ids, after a fork-child.  */\n-\t      thread_change_ptid (inferior_ptid, ptid);\n+\t      thread_change_ptid (gnu_target, inferior_ptid, ptid);\n \t    else if (inf->pending_execs != 0)\n \t      /* This is a shell thread.  */\n-\t      add_thread_silent (ptid);\n+\t      add_thread_silent (gnu_target, ptid);\n \t    else\n-\t      add_thread (ptid);\n+\t      add_thread (gnu_target, ptid);\n \t  }\n       }\n \n@@ -2150,7 +2152,7 @@ gnu_nat_target::create_inferior (const char *exec_file,\n   /* We have something that executes now.  We'll be running through\n      the shell at this point (if startup-with-shell is true), but the\n      pid shouldn't change.  */\n-  add_thread_silent (ptid_t (pid));\n+  add_thread_silent (gnu_target, ptid_t (pid));\n \n   /* Attach to the now stopped child, which is actually a shell...  */\n   inf_debug (inf, \"attaching to child: %d\", pid);\n@@ -2168,7 +2170,7 @@ gnu_nat_target::create_inferior (const char *exec_file,\n   inf_resume (inf);\n \n   /* We now have thread info.  */\n-  thread_change_ptid (inferior_ptid,\n+  thread_change_ptid (gnu_target, inferior_ptid,\n \t\t      ptid_t (inf->pid, inf_pick_first_thread (), 0));\n \n   gdb_startup_inferior (pid, START_INFERIOR_TRAPS_EXPECTED);\n@@ -2274,7 +2276,7 @@ gnu_nat_target::detach (inferior *inf, int from_tty)\n   inf_detach (gnu_current_inf);\n \n   inferior_ptid = null_ptid;\n-  detach_inferior (find_inferior_pid (pid));\n+  detach_inferior (find_inferior_pid (gnu_target, pid));\n \n   maybe_unpush_target ();\n }"
    },
    {
      "sha": "7c36778394b2b1b668364e130b247b197b9c8d8e",
      "filename": "gdb/gnu-nat.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/gnu-nat.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/gnu-nat.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gnu-nat.h?ref=53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
      "patch": "@@ -150,4 +150,7 @@ struct gnu_nat_target : public inf_child_target\n   void stop (ptid_t) override;\n };\n \n+/* The final/concrete instance.  */\n+extern gnu_nat_target *gnu_target;\n+\n #endif /* GNU_NAT_H */"
    },
    {
      "sha": "6382ca8acb22f87978a5d73a674d81b2b63e2d35",
      "filename": "gdb/i386-gnu-nat.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/i386-gnu-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/53dff92cb56fb21dc81c183aa35a5a3ae8c06e32/gdb/i386-gnu-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/i386-gnu-nat.c?ref=53dff92cb56fb21dc81c183aa35a5a3ae8c06e32",
      "patch": "@@ -439,6 +439,8 @@ _initialize_i386gnu_nat ()\n   x86_set_debug_register_length (4);\n #endif /* i386_DEBUG_STATE */\n \n+  gnu_target = &the_i386_gnu_nat_target;\n+\n   /* Register the target.  */\n   add_inf_child_target (&the_i386_gnu_nat_target);\n }"
    }
  ]
}