{
  "sha": "b65b566cdcb577edb57616c5b49a2f245b56325c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjY1YjU2NmNkY2I1NzdlZGI1NzYxNmM1YjQ5YTJmMjQ1YjU2MzI1Yw==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-06-23T13:34:15Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-06-25T17:15:16Z"
    },
    "message": "Fix alias command not detecting non matching prefix & sometimes asserting.\n\nalias_command does not detect that the prefixes of the alias command and the\naliased command are not matching: it is comparing the alias prefix\nwith itself, instead of comparing it with the aliased command prefix.\n\nThis causes either the alias command to silently do nothing,\nor to have GDB asserting:\n    (gdb) alias assigne imprime limite-elements = set print elements\n    ../../binutils-gdb/gdb/cli/cli-cmds.c:1552: internal-error: void alias_command(const char*, int): Assertion `c_command != NULL && c_command != (struct cmd_list_element *) -1' failed.\n    A problem internal to GDB has been detected,\n\nFix the logic, and update gdb.base/alias.exp to test these cases.\n\ngdb/ChangeLog\n2019-06-25  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* cli/cli-cmds.c (alias_command): Compare the alias prefix\n\twith the command prefix.\n\ngdb/testsuite/ChangeLog\n2019-06-25  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* gdb.base/alias.exp: Test non matching/non existing prefixes.",
    "tree": {
      "sha": "860272ce3962c954a3c78fca764c1537fe3327bf",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/860272ce3962c954a3c78fca764c1537fe3327bf"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b65b566cdcb577edb57616c5b49a2f245b56325c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b65b566cdcb577edb57616c5b49a2f245b56325c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b65b566cdcb577edb57616c5b49a2f245b56325c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b65b566cdcb577edb57616c5b49a2f245b56325c/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "9b444f9533c38016e4f2de0198c889b13a62d2bc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9b444f9533c38016e4f2de0198c889b13a62d2bc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9b444f9533c38016e4f2de0198c889b13a62d2bc"
    }
  ],
  "stats": {
    "total": 68,
    "additions": 64,
    "deletions": 4
  },
  "files": [
    {
      "sha": "64656d6fc3034f47d59a616fbd39f217672e088f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=b65b566cdcb577edb57616c5b49a2f245b56325c",
      "patch": "@@ -1,3 +1,8 @@\n+2019-06-25  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* cli/cli-cmds.c (alias_command): Compare the alias prefix\n+\twith the command prefix.\n+\n 2019-06-25  Tom Tromey  <tom@tromey.com>\n \n \t* tui/tui-wingeneral.c (tui_delete_win): Remove \"return\"."
    },
    {
      "sha": "5124ab3f1b2f3ebadae52e4f7b1040ed1ba52498",
      "filename": "gdb/cli/cli-cmds.c",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/cli/cli-cmds.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/cli/cli-cmds.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-cmds.c?ref=b65b566cdcb577edb57616c5b49a2f245b56325c",
      "patch": "@@ -1518,8 +1518,8 @@ alias_command (const char *args, int from_tty)\n      Example: alias spe = set print elements\n \n      Otherwise ALIAS and COMMAND must have the same number of words,\n-     and every word except the last must match; and the last word of\n-     ALIAS is made an alias of the last word of COMMAND.\n+     and every word except the last must identify the same prefix command;\n+     and the last word of ALIAS is made an alias of the last word of COMMAND.\n      Example: alias set print elms = set pr elem\n      Note that unambiguous abbreviations are allowed.  */\n \n@@ -1538,10 +1538,11 @@ alias_command (const char *args, int from_tty)\n \terror (_(\"Mismatched command length between ALIAS and COMMAND.\"));\n \n       /* Create copies of ALIAS and COMMAND without the last word,\n-\t and use that to verify the leading elements match.  */\n+\t and use that to verify the leading elements give the same\n+\t prefix command.  */\n       std::string alias_prefix_string (argv_to_string (alias_argv,\n \t\t\t\t\t\t       alias_argc - 1));\n-      std::string command_prefix_string (argv_to_string (alias_argv,\n+      std::string command_prefix_string (argv_to_string (command_argv.get (),\n \t\t\t\t\t\t\t command_argc - 1));\n       alias_prefix = alias_prefix_string.c_str ();\n       command_prefix = command_prefix_string.c_str ();"
    },
    {
      "sha": "8410a090d71a7dedb031dfac8da0ec83cd030dc6",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=b65b566cdcb577edb57616c5b49a2f245b56325c",
      "patch": "@@ -1,3 +1,7 @@\n+2019-06-23  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* gdb.base/alias.exp: Test non matching/non existing prefixes.\n+\n 2019-06-25  Tom de Vries  <tdevries@suse.de>\n \n \tPR testsuite/24727"
    },
    {
      "sha": "20722e5dea0c6883ad15d0556412a46e1d10858f",
      "filename": "gdb/testsuite/gdb.base/alias.exp",
      "status": "modified",
      "additions": 50,
      "deletions": 0,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/testsuite/gdb.base/alias.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b65b566cdcb577edb57616c5b49a2f245b56325c/gdb/testsuite/gdb.base/alias.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/alias.exp?ref=b65b566cdcb577edb57616c5b49a2f245b56325c",
      "patch": "@@ -66,3 +66,53 @@ gdb_test_no_output \"alias set pr elms = set p elem\"\n gdb_test_no_output \"set pr elms 51\"\n gdb_test \"show print elements\" \"Limit .* is 51\\[.\\]\" \"verify set pr elms\"\n gdb_test \"help set print\" \"set print elms .*\"\n+\n+# Verify alias command detects a non existing prefix.\n+gdb_test \"alias assigne imprime limite-elements = set print elements\" \\\n+    \"ALIAS and COMMAND prefixes do not match\\.\" \\\n+    \"assigne imprime prefix not defined\"\n+\n+gdb_test \"alias set imprime limite-elements = set print elements\" \\\n+    \"ALIAS and COMMAND prefixes do not match\\.\" \\\n+    \"set imprime prefix not defined\"\n+\n+# Verify alias command detects a non matching prefix.\n+gdb_test \"alias set ada limite-elements = set print elements\" \\\n+    \"ALIAS and COMMAND prefixes do not match\\.\" \\\n+    \"mismatched prefix\"\n+\n+# Verify alias command detects a non matching prefix due to length.\n+gdb_test \"alias set imprime-limite-elements = set print elements\" \\\n+    \"Mismatched command length between ALIAS and COMMAND\\.\" \\\n+    \"mismatched length\"\n+\n+\n+# Gradually define the prefixes and the limite-elements command.\n+gdb_test_no_output \"alias assigne = set\" \"alias assigne\"\n+gdb_test_no_output \"alias assigne imprime = set print\" \"alias assigne imprime\"\n+gdb_test_no_output \"alias assigne imprime limite-elements = set print elements\" \\\n+    \"alias assigne imprime limite-elements\"\n+\n+# Define an alias using the command prefix with a command using an alias prefix.\n+gdb_test_no_output \"alias set print max-elements = assigne imprime elements\" \\\n+    \"alias set print max-elements using assigne imprime\"\n+\n+\n+# Tests the resulting prefixes and commands.\n+gdb_test_no_output \"assigne print elements 52\"\n+gdb_test \"show print elements\" \"Limit .* is 52\\[.\\]\" \"verify 52\"\n+\n+gdb_test_no_output \"assigne imprime elements 53\"\n+gdb_test \"show print elements\" \"Limit .* is 53\\[.\\]\" \"verify 53\"\n+\n+gdb_test_no_output \"assigne imprime limite-elements 54\"\n+gdb_test \"show print elements\" \"Limit .* is 54\\[.\\]\" \"verify 54\"\n+\n+gdb_test_no_output \"set imprime elements 55\"\n+gdb_test \"show print elements\" \"Limit .* is 55\\[.\\]\" \"verify 55\"\n+\n+gdb_test_no_output \"set print limite-elements 56\"\n+gdb_test \"show print elements\" \"Limit .* is 56\\[.\\]\" \"verify 56\"\n+\n+gdb_test_no_output \"set print max-elements 57\"\n+gdb_test \"show print elements\" \"Limit .* is 57\\[.\\]\" \"verify 57\""
    }
  ]
}