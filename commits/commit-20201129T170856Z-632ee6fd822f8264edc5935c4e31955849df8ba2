{
  "sha": "632ee6fd822f8264edc5935c4e31955849df8ba2",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjMyZWU2ZmQ4MjJmODI2NGVkYzU5MzVjNGUzMTk1NTg0OWRmOGJhMg==",
  "commit": {
    "author": {
      "name": "Borislav Petkov",
      "email": "bp@suse.de",
      "date": "2020-11-28T13:20:06Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-11-29T17:08:56Z"
    },
    "message": "x86: Do not dump DS/CS segment overrides for branch hints\n\nThe previous change\n\n  \"x86: Ignore CS/DS/ES/SS segment-override prefixes in 64-bit mode\"\n\nto ignore segment override prefixes in 64-bit mode lead to dumping\nbranch hints as excessive prefixes:\n\n  ffffffff8109d5a0 <vmx_get_rflags>:\n  ...\n  ffffffff8109d601:       3e 77 0a                ds ja,pt ffffffff8109d60e <vmx_get_rflags+0x6e>\n  \t\t\t\t\t\t^^^^^\n\nIn this particular case, those prefixes are not excessive but are used\nto provide branch hints - taken/not-taken - to the CPU.\n\nAssign active_seg_prefix in that particular case to consume them.\n\ngas/\n\n2002-11-29  Borislav Petkov  <bp@suse.de>\n\n        * testsuite/gas/i386/branch.d: Add new branch insns test.\n        * testsuite/gas/i386/branch.s: Likewise.\n        * testsuite/gas/i386/i386.exp: Insert the new branch test.\n        * testsuite/gas/i386/x86-64-branch.d: Test for branch hints insns.\n        * testsuite/gas/i386/x86-64-branch.s: Likewise.\n        * testsuite/gas/i386/ilp32/x86-64-branch.d: Likewise.\n\nopcodes/\n\n2020-11-28 Borislav Petkov  <bp@suse.de>\n\n        * i386-dis.c (print_insn): Set active_seg_prefix for branch hint insns\n        to not dump branch hint prefixes 0x2E and 0x3E as unused prefixes.",
    "tree": {
      "sha": "cb5f6b5f3ea89bbab67eaf48ecb4b965832e5f8a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/cb5f6b5f3ea89bbab67eaf48ecb4b965832e5f8a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/632ee6fd822f8264edc5935c4e31955849df8ba2",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/632ee6fd822f8264edc5935c4e31955849df8ba2",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/632ee6fd822f8264edc5935c4e31955849df8ba2",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/632ee6fd822f8264edc5935c4e31955849df8ba2/comments",
  "author": null,
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "568cbddc710f6cb6be752f390a1521cd5556ad9b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/568cbddc710f6cb6be752f390a1521cd5556ad9b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/568cbddc710f6cb6be752f390a1521cd5556ad9b"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 50,
    "deletions": 2
  },
  "files": [
    {
      "sha": "8d07dc9bbb9a224bd9d024b0c6a4de964ecc0d68",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -1,3 +1,12 @@\n+2002-11-29  Borislav Petkov  <bp@suse.de>\n+\n+\t* testsuite/gas/i386/branch.d: Add new branch insns test.\n+\t* testsuite/gas/i386/branch.s: Likewise.\n+\t* testsuite/gas/i386/i386.exp: Insert the new branch test.\n+\t* testsuite/gas/i386/x86-64-branch.d: Test for branch hints insns.\n+\t* testsuite/gas/i386/x86-64-branch.s: Likewise.\n+\t* testsuite/gas/i386/ilp32/x86-64-branch.d: Likewise.\n+\n 2020-11-27  Jozef Lawrynowicz  <jozef.l@mittosystems.com>\n \n \t* testsuite/gas/elf/elf.exp: Run new tests."
    },
    {
      "sha": "6d25b950830f884eee2a3267459ef60860ff87ac",
      "filename": "gas/testsuite/gas/i386/branch.d",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/branch.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/branch.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/branch.d?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -0,0 +1,12 @@\n+#as: -J\n+#objdump: -dw\n+#name: i386 branch\n+\n+.*: +file format .*\n+\n+Disassembly of section .text:\n+\n+0+ <.text>:\n+[ \t]*[a-f0-9]+:\t3e 74 03[ \t]+je,pt  +0x[0-9a-f]+\n+[ \t]*[a-f0-9]+:\t2e 74 00[ \t]+je,pn  +0x[0-9a-f]+\n+#pass"
    },
    {
      "sha": "968a1818970f2d4ea521b1d99a5a4bab25048e75",
      "filename": "gas/testsuite/gas/i386/branch.s",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/branch.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/branch.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/branch.s?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -0,0 +1,4 @@\n+.text\n+\tjz,pt .Llabel\n+\tjz,pn .Llabel\n+.Llabel:"
    },
    {
      "sha": "432cf0192d49a414789685c2ea6d3820f6ecc142",
      "filename": "gas/testsuite/gas/i386/i386.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/i386.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/i386.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/i386.exp?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -565,6 +565,7 @@ if [gas_32_check] then {\n     run_dump_test \"lfence-ret-c\"\n     run_dump_test \"lfence-ret-d\"\n     run_dump_test \"lfence-byte\"\n+    run_dump_test \"branch\"\n \n     # These tests require support for 8 and 16 bit relocs,\n     # so we only run them for ELF and COFF targets."
    },
    {
      "sha": "d5f2358546fcf1073ab9323373f676c04c4a0803",
      "filename": "gas/testsuite/gas/i386/ilp32/x86-64-branch.d",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/ilp32/x86-64-branch.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/ilp32/x86-64-branch.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/ilp32/x86-64-branch.d?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -25,6 +25,8 @@ Disassembly of section .text:\n [ \t]*[a-f0-9]+:\t66 0f 82 00 00 00 00 \tdata16 jb 0x37\t33: R_X86_64_PLT32\tfoo-0x4\n [ \t]*[a-f0-9]+:\t66 c3                \tdata16 ret *\n [ \t]*[a-f0-9]+:\t66 c2 08 00          \tdata16 ret \\$0x8\n+[ \t]*[a-f0-9]+:\t3e 74 03[ \t]+je,pt  +0x[0-9a-f]+\n+[ \t]*[a-f0-9]+:\t2e 74 00[ \t]+je,pn  +0x[0-9a-f]+\n [ \t]*[a-f0-9]+:\tff d0                \tcall   \\*%rax\n [ \t]*[a-f0-9]+:\tff d0                \tcall   \\*%rax\n [ \t]*[a-f0-9]+:\t66 ff d0             \tdata16 call \\*%rax"
    },
    {
      "sha": "b963f9f051e47ff472ccc2cec36a78b2de8061a0",
      "filename": "gas/testsuite/gas/i386/x86-64-branch.d",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/x86-64-branch.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/x86-64-branch.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-branch.d?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -24,6 +24,8 @@ Disassembly of section .text:\n [ \t]*[a-f0-9]+:\t66 0f 82 00 00 00 00 \tdata16 jb (0x37|37 <.text\\+0x37>)\n [ \t]*[a-f0-9]+:\t66 c3                \tdata16 ret *\n [ \t]*[a-f0-9]+:\t66 c2 08 00          \tdata16 ret \\$0x8\n+[ \t]*[a-f0-9]+:\t3e 74 03[ \t]+je,pt  +0x[0-9a-f]+\n+[ \t]*[a-f0-9]+:\t2e 74 00[ \t]+je,pn  +0x[0-9a-f]+\n [ \t]*[a-f0-9]+:\tff d0                \tcall   \\*%rax\n [ \t]*[a-f0-9]+:\tff d0                \tcall   \\*%rax\n [ \t]*[a-f0-9]+:\t66 ff d0             \tdata16 call \\*%rax"
    },
    {
      "sha": "496e1bb089fb7c3d5f00995f0ac4216b28b1de99",
      "filename": "gas/testsuite/gas/i386/x86-64-branch.s",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/x86-64-branch.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/gas/testsuite/gas/i386/x86-64-branch.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-branch.s?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -22,6 +22,10 @@\n \tretw\n \tretw\t$8\n \n+\tjz,pt .Llabel\n+\tjz,pn .Llabel\n+.Llabel:\n+\n \t.intel_syntax noprefix\n \tcall\trax\n \tcallq\trax"
    },
    {
      "sha": "02fd2f5b583701d46ed6f4bb0df1882b980ae400",
      "filename": "opcodes/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/opcodes/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/opcodes/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/ChangeLog?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -1,3 +1,8 @@\n+2020-11-28 Borislav Petkov  <bp@suse.de>\n+\n+\t* i386-dis.c (print_insn): Set active_seg_prefix for branch hint insns\n+\tto not dump branch hint prefixes 0x2E and 0x3E as unused prefixes.\n+\n 2020-11-16  Przemyslaw Wirkus  <przemyslaw.wirkus@arm.com>\n \n \t* aarch64-tbl.h (FLAGM): Handle for FLAGM feature."
    },
    {
      "sha": "a1e47c57251f7d85e7ba723cefcd84f56a68e275",
      "filename": "opcodes/i386-dis.c",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/632ee6fd822f8264edc5935c4e31955849df8ba2/opcodes/i386-dis.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/632ee6fd822f8264edc5935c4e31955849df8ba2/opcodes/i386-dis.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/i386-dis.c?ref=632ee6fd822f8264edc5935c4e31955849df8ba2",
      "patch": "@@ -10910,10 +10910,19 @@ putop (const char *in_template, int sizeflag)\n \t      used_prefixes |= prefixes & (PREFIX_CS | PREFIX_DS);\n \t      *obufp++ = ',';\n \t      *obufp++ = 'p';\n+\n+\t      /* Set active_seg_prefix even if not set in 64-bit mode\n+\t\t because here it is a valid branch hint. */\n \t      if (prefixes & PREFIX_DS)\n-\t\t*obufp++ = 't';\n+\t\t{\n+\t\t  active_seg_prefix = PREFIX_DS;\n+\t\t  *obufp++ = 't';\n+\t\t}\n \t      else\n-\t\t*obufp++ = 'n';\n+\t\t{\n+\t\t  active_seg_prefix = PREFIX_CS;\n+\t\t  *obufp++ = 'n';\n+\t\t}\n \t    }\n \t  break;\n \tcase 'K':"
    }
  ]
}