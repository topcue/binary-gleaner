{
  "sha": "b80e421f9136117389be9d96210b35b3d562d725",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjgwZTQyMWY5MTM2MTE3Mzg5YmU5ZDk2MjEwYjM1YjNkNTYyZDcyNQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-02T10:55:20Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-02T11:19:56Z"
    },
    "message": "PR27451, -z start_stop_gc for powerpc64\n\nPowerPC64 has its own gc_mark_dynamic_ref.\n\nbfd/\n\tPR 27451\n\t* elf64-ppc.c (ppc64_elf_gc_mark_dynamic_ref): Ignore synthesized\n\tlinker defined start/stop symbols when start_stop_gc.\nld/\n\t* testsuite/ld-powerpc/startstop.d,\n\t* testsuite/ld-powerpc/startstop.r,\n\t* testsuite/ld-powerpc/startstop.s: New test.\n\t* testsuite/ld-powerpc/powerpc.exp: Run it.",
    "tree": {
      "sha": "218091e1eab9d0be37a1b4bf1d7488c037a9412e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/218091e1eab9d0be37a1b4bf1d7488c037a9412e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b80e421f9136117389be9d96210b35b3d562d725",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b80e421f9136117389be9d96210b35b3d562d725",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b80e421f9136117389be9d96210b35b3d562d725",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b80e421f9136117389be9d96210b35b3d562d725/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f5b9c288a3057f0f04e74f00fdb0e79d171d54a8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f5b9c288a3057f0f04e74f00fdb0e79d171d54a8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f5b9c288a3057f0f04e74f00fdb0e79d171d54a8"
    }
  ],
  "stats": {
    "total": 47,
    "additions": 47,
    "deletions": 0
  },
  "files": [
    {
      "sha": "c4c4fa2647aaf692e0b0706a31130a99a0fedb45",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -1,3 +1,9 @@\n+2021-03-02  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27451\n+\t* elf64-ppc.c (ppc64_elf_gc_mark_dynamic_ref): Ignore synthesized\n+\tlinker defined start/stop symbols when start_stop_gc.\n+\n 2021-03-02  Alan Modra  <amodra@gmail.com>\n \n \t* elf64-ppc.c (ppc64_elf_relocate_section): Don't optimise got"
    },
    {
      "sha": "ab0e0d33aac8ea1bf404fbb14fb69b094f1fbfdf",
      "filename": "bfd/elf64-ppc.c",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/bfd/elf64-ppc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/bfd/elf64-ppc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-ppc.c?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -5749,6 +5749,9 @@ ppc64_elf_gc_mark_dynamic_ref (struct elf_link_hash_entry *h, void *inf)\n \n   if ((eh->elf.root.type == bfd_link_hash_defined\n        || eh->elf.root.type == bfd_link_hash_defweak)\n+      && (!eh->elf.start_stop\n+\t  || eh->elf.root.ldscript_def\n+\t  || !info->start_stop_gc)\n       && ((eh->elf.ref_dynamic && !eh->elf.forced_local)\n \t  || ((eh->elf.def_regular || ELF_COMMON_DEF_P (&eh->elf))\n \t      && ELF_ST_VISIBILITY (eh->elf.other) != STV_INTERNAL"
    },
    {
      "sha": "d12e537791a8b6144c7983af9f487a05df13122d",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -1,3 +1,10 @@\n+2021-03-02  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-powerpc/startstop.d,\n+\t* testsuite/ld-powerpc/startstop.r,\n+\t* testsuite/ld-powerpc/startstop.s: New test.\n+\t* testsuite/ld-powerpc/powerpc.exp: Run it.\n+\n 2021-03-02  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-powerpc/weak1.d,"
    },
    {
      "sha": "2ac02b1c02bf4dbfee3efcfd48fe94b132910abe",
      "filename": "ld/testsuite/ld-powerpc/powerpc.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/powerpc.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/powerpc.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/powerpc.exp?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -350,6 +350,9 @@ set ppc64elftests {\n     {\"weak1.so\" \"-shared -melf64ppc --hash-style=both\" \"\"\n \t\"-a64 -mpower10\" {weak1.s}\n \t{{objdump -d weak1so.d} {readelf {-srW} weak1so.r}} \"weak1.so\"}\n+    {\"startstop\" \"-shared -melf64ppc --hash-style=sysv --gc-sections -z start-stop-gc\" \"\"\n+\t\"-a64 -mpower10\" {startstop.s}\n+\t{{objdump -d startstop.d} {readelf {-rW} startstop.r}} \"startstop.so\"}\n }\n \n set ppceabitests {"
    },
    {
      "sha": "2bf4c73cbfe3b1e74f6e8b5b55b75ff64c43d8ec",
      "filename": "ld/testsuite/ld-powerpc/startstop.d",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/startstop.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/startstop.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/startstop.d?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -0,0 +1,10 @@\n+\n+.*:     file format .*\n+\n+Disassembly of section \\.text:\n+\n+0+140 <_start>:\n+ 140:\t(04 10 00 01|01 00 10 04) \tpld     r3,66000\n+ 144:\t(e4 60 01 d0|d0 01 60 e4) \n+ 148:\t(04 10 00 01|01 00 10 04) \tpld     r4,65984\n+ 14c:\t(e4 80 01 c0|c0 01 80 e4) "
    },
    {
      "sha": "9a583fbfad45afda4a65f8e467343266db3343d1",
      "filename": "ld/testsuite/ld-powerpc/startstop.r",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/startstop.r",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/startstop.r",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/startstop.r?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -0,0 +1,2 @@\n+\n+There are no relocations in this file."
    },
    {
      "sha": "8e88a7215781f9a1b3eabd801d9c05bfb7c66eda",
      "filename": "ld/testsuite/ld-powerpc/startstop.s",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/startstop.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b80e421f9136117389be9d96210b35b3d562d725/ld/testsuite/ld-powerpc/startstop.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-powerpc/startstop.s?ref=b80e421f9136117389be9d96210b35b3d562d725",
      "patch": "@@ -0,0 +1,16 @@\n+ .weak __start_xx\n+ .weak __stop_xx\n+\n+ .global _start\n+_start:\n+  pld 3,__start_xx@got@pcrel\n+  pld 4,__stop_xx@got@pcrel\n+\n+ .section xx,\"a\",unique,0\n+ .byte 0\n+\n+ .section xx,\"a\",unique,1\n+ .byte 1\n+\n+ .section xx,\"a\",unique,2\n+ .byte 2"
    }
  ]
}