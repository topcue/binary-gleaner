{
  "sha": "926ac872e924e6618441f76917d58088d92dd11d",
  "node_id": "C_kwDOANOeidoAKDkyNmFjODcyZTkyNGU2NjE4NDQxZjc2OTE3ZDU4MDg4ZDkyZGQxMWQ",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "aburgess@redhat.com",
      "date": "2021-12-29T11:53:49Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "aburgess@redhat.com",
      "date": "2022-01-04T10:28:19Z"
    },
    "message": "gdb: don't pass nullptr to sigwait\n\nI tried building GDB on GNU/Hurd, and ran into this warning:\n\n  gdbsupport/scoped_ignore_signal.h:78:16: error: null argument where non-null required (argument 2) [-Werror=nonnull]\n\nThis is because in this commit:\n\n  commit 99624310dd82542c389c89c2e55d8cae36bb74e1\n  Date:   Sun Jun 27 15:13:14 2021 -0400\n\n      gdb: fall back on sigpending + sigwait if sigtimedwait is not available\n\nA call to sigwait was introduced that passes nullptr as the second\nargument, this call is only reached if sigtimedwait is not supported.\n\nThe original patch was written for macOS, I assume on that target\npassing nullptr as the second argument is fine.\n\nOn my GNU/Linux box, the man-page for sigwait doesn't mention that\nnullptr is allowed for the second argument, so my assumption would be\nthat nullptr is not OK, and, if I change the '#ifdef\nHAVE_SIGTIMEDWAIT' introduced by the above patch to '#if 0', and\nrebuild on GNU/Linux, I see the same warning that I see on GNU/Hurd.\n\nI propose that we stop passing nullptr as the second argument to\nsigwait, and instead pass a valid int pointer.  The value returned in\nthe int can then be used in an assert.\n\nFor testing, I (locally) made the change to the #ifdef I mentioned\nabove, compiled GDB, and ran the usual tests, this meant I was using\nsigwait instead on sigtimedwait on GNU/Linux, I saw no regressions.",
    "tree": {
      "sha": "01d85e83aeaa509f7455d3577dc0591f57f8481d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/01d85e83aeaa509f7455d3577dc0591f57f8481d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/926ac872e924e6618441f76917d58088d92dd11d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/926ac872e924e6618441f76917d58088d92dd11d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/926ac872e924e6618441f76917d58088d92dd11d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/926ac872e924e6618441f76917d58088d92dd11d/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "e2c0cef94da679745201317a0da0228f0f50158b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2c0cef94da679745201317a0da0228f0f50158b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e2c0cef94da679745201317a0da0228f0f50158b"
    }
  ],
  "stats": {
    "total": 7,
    "additions": 6,
    "deletions": 1
  },
  "files": [
    {
      "sha": "cb46812224c1e09e2d83fcce52601f1e75ab6445",
      "filename": "gdbsupport/scoped_ignore_signal.h",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/926ac872e924e6618441f76917d58088d92dd11d/gdbsupport/scoped_ignore_signal.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/926ac872e924e6618441f76917d58088d92dd11d/gdbsupport/scoped_ignore_signal.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbsupport/scoped_ignore_signal.h?ref=926ac872e924e6618441f76917d58088d92dd11d",
      "patch": "@@ -75,7 +75,12 @@ class scoped_ignore_signal\n \n \t    sigpending (&pending);\n \t    if (sigismember (&pending, Sig))\n-\t      sigwait (&set, nullptr);\n+\t      {\n+\t\tint sig_found;\n+\n+\t\tsigwait (&set, &sig_found);\n+\t\tgdb_assert (sig_found == Sig);\n+\t      }\n #endif\n \t  }\n "
    }
  ]
}