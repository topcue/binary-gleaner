{
  "sha": "553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTUzZGQ3NmM3ZTQ5ZTNlNmFmYjUyOGZmODY1NTg5ZGE4ZjZmM2UxYw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-07-22T12:11:15Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-07-24T08:05:59Z"
    },
    "message": "Re: ld script expression parsing\n\nCommit 40726f16a8d7 broke references to sections within ADDR(), and\noverlays with weird section names.\n\n\t* ldgram.y (paren_script_name): New rule.\n\t(exp): Use it for ALIGNOF, SIZEOF, ADDR, and LOADADDR.  Similarly\n\tensure script mode parsing for section name in SEGMENT_START.\n\t(overlay_section): Delete unnecessary ldlex_script call.  Backup\n\ton a lookahead NAME parsed in expression mode.\n\t* testsuite/ld-elf/overlay.s: Add more sections.\n\t* testsuite/ld-elf/overlay.t: Test '-' in section names.",
    "tree": {
      "sha": "1e437ebfcf9298b4e5d26a5116d83c0221859873",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1e437ebfcf9298b4e5d26a5116d83c0221859873"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "77db4723ddda2a5eb20876e8a818f77ffa7dafc8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/77db4723ddda2a5eb20876e8a818f77ffa7dafc8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/77db4723ddda2a5eb20876e8a818f77ffa7dafc8"
    }
  ],
  "stats": {
    "total": 48,
    "additions": 32,
    "deletions": 16
  },
  "files": [
    {
      "sha": "2f9de59321a01383efe7e8680f66d71e2a12e31d",
      "filename": "ld/ldgram.y",
      "status": "modified",
      "additions": 23,
      "deletions": 15,
      "changes": 38,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/ld/ldgram.y",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/ld/ldgram.y",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldgram.y?ref=553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
      "patch": "@@ -96,8 +96,7 @@ static int error_index;\n %type <wildcard_list> section_name_list\n %type <flag_info_list> sect_flag_list\n %type <flag_info> sect_flags\n-%type <name> memspec_opt casesymlist\n-%type <name> memspec_at_opt\n+%type <name> memspec_opt memspec_at_opt paren_script_name casesymlist\n %type <cname> wildcard_name\n %type <wildcard> section_name_spec filename_spec wildcard_maybe_exclude\n %token <bigint> INT\n@@ -906,6 +905,10 @@ nocrossref_list:\n \t\t}\n \t;\n \n+paren_script_name:\n+\t\t{ ldlex_script (); } '(' NAME  { ldlex_popstate (); } ')'\n+\t\t\t{ $$ = $3; }\n+\n mustbe_exp:\t\t { ldlex_expression (); }\n \t\texp\n \t\t\t { ldlex_popstate (); $$=$2;}\n@@ -970,14 +973,14 @@ exp\t:\n \t|\tSIZEOF_HEADERS\n \t\t\t{ $$ = exp_nameop (SIZEOF_HEADERS,0); }\n \n-\t|\tALIGNOF '(' NAME ')'\n-\t\t\t{ $$ = exp_nameop (ALIGNOF,$3); }\n-\t|\tSIZEOF '(' NAME ')'\n-\t\t\t{ $$ = exp_nameop (SIZEOF,$3); }\n-\t|\tADDR '(' NAME ')'\n-\t\t\t{ $$ = exp_nameop (ADDR,$3); }\n-\t|\tLOADADDR '(' NAME ')'\n-\t\t\t{ $$ = exp_nameop (LOADADDR,$3); }\n+\t|\tALIGNOF paren_script_name\n+\t\t\t{ $$ = exp_nameop (ALIGNOF, $2); }\n+\t|\tSIZEOF\tparen_script_name\n+\t\t\t{ $$ = exp_nameop (SIZEOF, $2); }\n+\t|\tADDR\tparen_script_name\n+\t\t\t{ $$ = exp_nameop (ADDR, $2); }\n+\t|\tLOADADDR paren_script_name\n+\t\t\t{ $$ = exp_nameop (LOADADDR, $2); }\n \t|\tCONSTANT '(' NAME ')'\n \t\t\t{ $$ = exp_nameop (CONSTANT,$3); }\n \t|\tABSOLUTE '(' exp ')'\n@@ -992,15 +995,16 @@ exp\t:\n \t\t\t{ $$ = exp_binop (DATA_SEGMENT_RELRO_END, $5, $3); }\n \t|\tDATA_SEGMENT_END '(' exp ')'\n \t\t\t{ $$ = exp_unop (DATA_SEGMENT_END, $3); }\n-\t|\tSEGMENT_START '(' NAME ',' exp ')'\n+\t|\tSEGMENT_START { ldlex_script (); } '(' NAME\n+\t\t\t{ ldlex_popstate (); } ',' exp ')'\n \t\t\t{ /* The operands to the expression node are\n \t\t\t     placed in the opposite order from the way\n \t\t\t     in which they appear in the script as\n \t\t\t     that allows us to reuse more code in\n \t\t\t     fold_binary.  */\n \t\t\t  $$ = exp_binop (SEGMENT_START,\n-\t\t\t\t\t  $5,\n-\t\t\t\t\t  exp_nameop (NAME, $3)); }\n+\t\t\t\t\t  $7,\n+\t\t\t\t\t  exp_nameop (NAME, $4)); }\n \t|\tBLOCK '(' exp ')'\n \t\t\t{ $$ = exp_unop (ALIGN_K,$3); }\n \t|\tNAME\n@@ -1186,13 +1190,17 @@ overlay_section:\n \t|\toverlay_section\n \t\tNAME\n \t\t\t{\n-\t\t\t  ldlex_script ();\n \t\t\t  lang_enter_overlay_section ($2);\n \t\t\t}\n \t\t'{' statement_list_opt '}'\n-\t\t\t{ ldlex_popstate (); ldlex_expression (); }\n+\t\t\t{ ldlex_expression (); }\n \t\tphdr_opt fill_opt\n \t\t\t{\n+\t\t\t  if (yychar == NAME)\n+\t\t\t    {\n+\t\t\t      yyclearin;\n+\t\t\t      ldlex_backup ();\n+\t\t\t    }\n \t\t\t  ldlex_popstate ();\n \t\t\t  lang_leave_overlay_section ($9, $8);\n \t\t\t}"
    },
    {
      "sha": "20d8f4154dc59d9664e74abe70f18967f1c6ca8c",
      "filename": "ld/testsuite/ld-elf/overlay.s",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/ld/testsuite/ld-elf/overlay.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/ld/testsuite/ld-elf/overlay.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/overlay.s?ref=553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
      "patch": "@@ -2,5 +2,9 @@\n \t.space 0x10\n \t.section .text2,\"ax\",%progbits\n \t.space 0x20\n+\t.section .silly-name1,\"ax\",%progbits\n+\t.space 0x10\n+\t.section .silly-name2,\"ax\",%progbits\n+\t.space 0x20\n \t.text\n \t.space 0x30"
    },
    {
      "sha": "2c50a6b1a482c9319a22a9a5645454f5e1cb30c9",
      "filename": "ld/testsuite/ld-elf/overlay.t",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/ld/testsuite/ld-elf/overlay.t",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/553dd76c7e49e3e6afb528ff865589da8f6f3e1c/ld/testsuite/ld-elf/overlay.t",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/overlay.t?ref=553dd76c7e49e3e6afb528ff865589da8f6f3e1c",
      "patch": "@@ -6,6 +6,10 @@ SECTIONS\n   {\n     .text1 {*(.text1)}\n     .text2 {*(.text2)}\n-  } \n+    .silly-name1 { *(.silly-name1) }\n+    .silly-name2 { *(.silly-name2) }\n+  }\n   /DISCARD/ : { *(.*) }\n+  ASSERT(ADDR(.text1)==ADDR(.text2), \"overlay error\")\n+  ASSERT(ADDR(.silly-name1)==ADDR(.silly-name2), \"silly overlay error\")\n }"
    }
  ]
}