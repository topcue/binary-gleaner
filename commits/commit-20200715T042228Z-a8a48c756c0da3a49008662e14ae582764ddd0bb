{
  "sha": "a8a48c756c0da3a49008662e14ae582764ddd0bb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YThhNDhjNzU2YzBkYTNhNDkwMDg2NjJlMTRhZTU4Mjc2NGRkZDBiYg==",
  "commit": {
    "author": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@bitrange.com",
      "date": "2020-07-15T04:22:28Z"
    },
    "committer": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@bitrange.com",
      "date": "2020-07-15T04:22:28Z"
    },
    "message": "mmix bfd: fix bfd_assert for R_MMIX_PUSHJ_STUBBABLE against undef'd symbol\n\nSpotted when inspecting gcc testsuite logs, but this already is\ncovered by the ld-mmix testsuite, it's just that the assert is ignored\nsince the regexp match is for a substring and not anchored.\n\nWith the anchors added but not the bugfix, the ld.log shows that the\nasserts cause a non-match as intended:\n\nExecuting on host: sh -c {./ld-new   -LX/src/ld/testsuite/ld-mmix  -m elf64mmix -o tmpdir/dump tmpdir/undef-2.o tmpdir/start.o  2>&1}  /dev/null dump.tmp (timeout = 300)\n./ld-new: BFD (GNU Binutils) 2.34.50.20200629 assertion fail X/src/bfd/elf64-mmix.c:2845\n./ld-new: BFD (GNU Binutils) 2.34.50.20200629 assertion fail X/src/bfd/elf64-mmix.c:2845\n./ld-new: BFD (GNU Binutils) 2.34.50.20200629 assertion fail X/src/bfd/elf64-mmix.c:2845\n./ld-new: tmpdir/undef-2.o:(.text+0x0): undefined reference to `undefd'\nfailed with: <./ld-new: BFD (GNU Binutils) 2.34.50.20200629 assertion fail X/src/bfd/elf64-mmix.c:2845\n./ld-new: BFD (GNU Binutils) 2.34.50.20200629 assertion fail X/src/bfd/elf64-mmix.c:2845\n./ld-new: BFD (GNU Binutils) 2.34.50.20200629 assertion fail X/src/bfd/elf64-mmix.c:2845\n./ld-new: tmpdir/undef-2.o:(.text+0x0): undefined reference to `undefd'>, expected: <\\A[^\\n\\r]*undefined reference to `undefd'\\Z>\nFAIL: ld-mmix/undef-2\n\nGone with the fix of course, leaving just the intended \"undefined\nreference\" like.\n\nI'm not going to add anchors manually for all the \"error:\" strings in\nthe test-suite, not even in the mmix parts.  Sorry, but I'll just do\nit for *these* specific undefined-reference tests.\n\nJust a thought: maybe the run_dump_test \"error:\" string should\n*automatically* get anchor marks prepended and appended for a single\nline match as in the patch, \"\\A[^\\n\\r]*\" prepended and \\Z appended\nunless either anchor mark or \\r or \\n is present in the regexp?\n\nCommitted.\n\nbfd:\n\t* elf64-mmix.c (mmix_elf_relax_section): Improve accounting for\n\tR_MMIX_PUSHJ_STUBBABLE relocs against undefined symbols.\n\nld/testsuite:\n\t* testsuite/ld-mmix/undef-1.d, testsuite/ld-mmix/undef-1m.d,\n\ttestsuite/ld-mmix/undef-2.d, testsuite/ld-mmix/undef-2m.d: Add\n\tstart- and end-anchors to error-string to match just a\n\tsingle-line error-message.",
    "tree": {
      "sha": "a2f68559fd454332a0692c914aaaaeee917e6d17",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a2f68559fd454332a0692c914aaaaeee917e6d17"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a8a48c756c0da3a49008662e14ae582764ddd0bb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a8a48c756c0da3a49008662e14ae582764ddd0bb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a8a48c756c0da3a49008662e14ae582764ddd0bb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a8a48c756c0da3a49008662e14ae582764ddd0bb/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "054a0959265eb89210626b6f2d84b93b82ef7ae9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/054a0959265eb89210626b6f2d84b93b82ef7ae9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/054a0959265eb89210626b6f2d84b93b82ef7ae9"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 24,
    "deletions": 5
  },
  "files": [
    {
      "sha": "321e2e060bda982d9dbf96653bc8641535e1ea9e",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -1,3 +1,8 @@\n+2020-07-15  Hans-Peter Nilsson  <hp@bitrange.com>\n+\n+\t* elf64-mmix.c (mmix_elf_relax_section): Improve accounting for\n+\tR_MMIX_PUSHJ_STUBBABLE relocs against undefined symbols.\n+\n 2020-07-15  Markus B\u00f6ck  <markus.boeck02@gmail.com>\n \t    Alan Modra  <amodra@gmail.com>\n "
    },
    {
      "sha": "2fc491c5ffa268d133a10a1235d6b0978f5534e6",
      "filename": "bfd/elf64-mmix.c",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/bfd/elf64-mmix.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/bfd/elf64-mmix.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-mmix.c?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -2538,6 +2538,7 @@ mmix_elf_relax_section (bfd *abfd,\n      spot a missing actual initialization.  */\n   size_t bpono = (size_t) -1;\n   size_t pjsno = 0;\n+  size_t pjsno_undefs = 0;\n   Elf_Internal_Sym *isymbuf = NULL;\n   bfd_size_type size = sec->rawsize ? sec->rawsize : sec->size;\n \n@@ -2703,6 +2704,11 @@ mmix_elf_relax_section (bfd *abfd,\n \t\t  gregdata->n_remaining_bpo_relocs_this_relaxation_round--;\n \t\t  bpono++;\n \t\t}\n+\n+\t      /* Similarly, keep accounting consistent for PUSHJ\n+\t\t referring to an undefined symbol.  */\n+\t      if (ELF64_R_TYPE (irel->r_info) == R_MMIX_PUSHJ_STUBBABLE)\n+\t\tpjsno_undefs++;\n \t      continue;\n \t    }\n \t}\n@@ -2842,7 +2848,8 @@ mmix_elf_relax_section (bfd *abfd,\n \t}\n     }\n \n-  BFD_ASSERT(pjsno == mmix_elf_section_data (sec)->pjs.n_pushj_relocs);\n+  BFD_ASSERT(pjsno + pjsno_undefs\n+\t     == mmix_elf_section_data (sec)->pjs.n_pushj_relocs);\n \n   if (elf_section_data (sec)->relocs != internal_relocs)\n     free (internal_relocs);"
    },
    {
      "sha": "b667566a889020ad2177b2f78c66eced2ba7fffa",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -1,3 +1,10 @@\n+2020-07-15  Hans-Peter Nilsson  <hp@bitrange.com>\n+\n+\t* testsuite/ld-mmix/undef-1.d, testsuite/ld-mmix/undef-1m.d,\n+\ttestsuite/ld-mmix/undef-2.d, testsuite/ld-mmix/undef-2m.d: Add\n+\tstart- and end-anchors to error-string to match just a\n+\tsingle-line error-message.\n+\n 2020-07-13  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-scripts/default-script1.d: Don't skip, xfail"
    },
    {
      "sha": "ad8d757683ea73ff93bec3d2807083a0d7376303",
      "filename": "ld/testsuite/ld-mmix/undef-1.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mmix/undef-1.d?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -1,4 +1,4 @@\n #source: undef-1.s\n #source: start.s\n #ld: -m elf64mmix\n-#error: undefined reference to `regvar'\n+#error: \\A[^\\n\\r]*undefined reference to `regvar'\\Z"
    },
    {
      "sha": "e747e5026cc59cfb7f23b659eaa01e1acce670bc",
      "filename": "ld/testsuite/ld-mmix/undef-1m.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-1m.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-1m.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mmix/undef-1m.d?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -1,4 +1,4 @@\n #source: undef-1.s\n #source: start.s\n #ld: -m mmo\n-#error: undefined reference to `regvar'\n+#error: \\A[^\\n\\r]*undefined reference to `regvar'\\Z"
    },
    {
      "sha": "2dc2b4e4d5717d650e81df0464a4392e22554d17",
      "filename": "ld/testsuite/ld-mmix/undef-2.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mmix/undef-2.d?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -2,4 +2,4 @@\n #source: start.s\n #as: -x\n #ld: -m elf64mmix\n-#error: undefined reference to `undefd'\n+#error: \\A[^\\n\\r]*undefined reference to `undefd'\\Z"
    },
    {
      "sha": "7eb3c673c621ca4d049d0713830c0bb304afa859",
      "filename": "ld/testsuite/ld-mmix/undef-2m.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-2m.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8a48c756c0da3a49008662e14ae582764ddd0bb/ld/testsuite/ld-mmix/undef-2m.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-mmix/undef-2m.d?ref=a8a48c756c0da3a49008662e14ae582764ddd0bb",
      "patch": "@@ -2,4 +2,4 @@\n #source: start.s\n #as: -x\n #ld: -m mmo\n-#error: undefined reference to `undefd'\n+#error: \\A[^\\n\\r]*undefined reference to `undefd'\\Z"
    }
  ]
}