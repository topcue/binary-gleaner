{
  "sha": "8ea7241cf3f46e9164c5ef75611bb2442350c934",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGVhNzI0MWNmM2Y0NmU5MTY0YzVlZjc1NjExYmIyNDQyMzUwYzkzNA==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2016-01-22T03:40:43Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-05-17T05:00:08Z"
    },
    "message": "sim: mips: invert sim_state storage",
    "tree": {
      "sha": "d9e044e331ce54a803288d5e9ee8773cb82e49d0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d9e044e331ce54a803288d5e9ee8773cb82e49d0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8ea7241cf3f46e9164c5ef75611bb2442350c934",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8ea7241cf3f46e9164c5ef75611bb2442350c934",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8ea7241cf3f46e9164c5ef75611bb2442350c934",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8ea7241cf3f46e9164c5ef75611bb2442350c934/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "937af0fde5cf532c7f3958662525c45d46edd047",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/937af0fde5cf532c7f3958662525c45d46edd047",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/937af0fde5cf532c7f3958662525c45d46edd047"
    }
  ],
  "stats": {
    "total": 54,
    "additions": 27,
    "deletions": 27
  },
  "files": [
    {
      "sha": "ca8a1fb68b19960f3813d6624d5df46d90c8c808",
      "filename": "sim/mips/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/mips/ChangeLog?ref=8ea7241cf3f46e9164c5ef75611bb2442350c934",
      "patch": "@@ -1,3 +1,15 @@\n+2021-05-17  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* interp.c (sim_open): Switch to sim_state_alloc_extra.\n+\t* micromips.igen: Change SD to mips_sim_state.\n+\t* micromipsrun.c (sim_engine_run): Likewise.\n+\t* sim-main.h (SIM_HAVE_COMMON_SIM_STATE): Define.\n+\t(watch_options_install): Delete.\n+\t(struct swatch): Delete.\n+\t(struct sim_state): Delete.\n+\t(struct mips_sim_state): New struct.\n+\t(MIPS_SIM_STATE): Define.\n+\n 2021-05-16  Mike Frysinger  <vapier@gentoo.org>\n \n \t* interp.c: Replace config.h include with defs.h."
    },
    {
      "sha": "2839715959c051fef8be729be35bd499cb709539",
      "filename": "sim/mips/interp.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/interp.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/interp.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/mips/interp.c?ref=8ea7241cf3f46e9164c5ef75611bb2442350c934",
      "patch": "@@ -343,7 +343,8 @@ sim_open (SIM_OPEN_KIND kind, host_callback *cb,\n \t  struct bfd *abfd, char * const *argv)\n {\n   int i;\n-  SIM_DESC sd = sim_state_alloc (kind, cb);\n+  SIM_DESC sd = sim_state_alloc_extra (kind, cb,\n+\t\t\t\t       sizeof (struct mips_sim_state));\n   sim_cpu *cpu;\n \n   SIM_ASSERT (STATE_MAGIC (sd) == SIM_MAGIC_NUMBER);"
    },
    {
      "sha": "08c5bb7a2dc9756015b0c866e84efbd95b90d372",
      "filename": "sim/mips/micromips.igen",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/micromips.igen",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/micromips.igen",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/mips/micromips.igen?ref=8ea7241cf3f46e9164c5ef75611bb2442350c934",
      "patch": "@@ -58,7 +58,8 @@\n *micromips32:\n *micromips64:\n {\n-  SD->isa_mode = target & 0x1;\n+  struct mips_sim_state *state = MIPS_SIM_STATE (SD);\n+  state->isa_mode = target & 0x1;\n   return (target & (-(1 << 1)));\n }\n \n@@ -1076,10 +1077,11 @@\n *micromips32:\n *micromips64:\n {\n+  struct mips_sim_state *state = MIPS_SIM_STATE (SD);\n   address_word region = (NIA & MASK (63, 26));\n   NIA = do_micromips_jal (SD_, (region | (IMM_SHIFT_2BIT)) | ISA_MODE_MIPS32,\n \t\t\t  NIA, MICROMIPS_DELAYSLOT_SIZE_32);\n-  SD->isa_mode = ISA_MODE_MIPS32;\n+  state->isa_mode = ISA_MODE_MIPS32;\n }\n \n 000000,00000,5.RS,0000111100,111100:POOL32A:32::JR"
    },
    {
      "sha": "f76a3822630e37567b55202fc40553ed1f1deb0a",
      "filename": "sim/mips/micromipsrun.c",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/micromipsrun.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/micromipsrun.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/mips/micromipsrun.c?ref=8ea7241cf3f46e9164c5ef75611bb2442350c934",
      "patch": "@@ -80,10 +80,11 @@ void\n sim_engine_run (SIM_DESC sd, int next_cpu_nr, int nr_cpus,\n \t\tint signal)\n {\n+  struct mips_sim_state *state = MIPS_SIM_STATE (sd);\n   micromips_m32_instruction_word instruction_0;\n   sim_cpu *cpu = STATE_CPU (sd, next_cpu_nr);\n   micromips32_instruction_address cia = CPU_PC_GET (cpu);\n-  sd->isa_mode = ISA_MODE_MIPS32;\n+  state->isa_mode = ISA_MODE_MIPS32;\n \n   while (1)\n     {\n@@ -95,17 +96,17 @@ sim_engine_run (SIM_DESC sd, int next_cpu_nr, int nr_cpus,\n \t from the elf header.\n \t 2. Setting the correct isa mode after a MIPS32 jump or branch\n \t instruction.  */\n-      if ((sd->isa_mode == ISA_MODE_MIPS32)\n+      if ((state->isa_mode == ISA_MODE_MIPS32)\n \t  && ((cia & 0x1) == ISA_MODE_MICROMIPS))\n \t{\n-\t  sd->isa_mode = ISA_MODE_MICROMIPS;\n+\t  state->isa_mode = ISA_MODE_MICROMIPS;\n \t  cia = cia & ~0x1;\n \t}\n \n #if defined (ENGINE_ISSUE_PREFIX_HOOK)\n       ENGINE_ISSUE_PREFIX_HOOK ();\n #endif\n-      switch (sd->isa_mode)\n+      switch (state->isa_mode)\n \t{\n \tcase ISA_MODE_MICROMIPS:\n \t  nia ="
    },
    {
      "sha": "3c7ba271619efe7b2d6f4f9870027fcf244f9aa3",
      "filename": "sim/mips/sim-main.h",
      "status": "modified",
      "additions": 4,
      "deletions": 20,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/sim-main.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ea7241cf3f46e9164c5ef75611bb2442350c934/sim/mips/sim-main.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/mips/sim-main.h?ref=8ea7241cf3f46e9164c5ef75611bb2442350c934",
      "patch": "@@ -20,6 +20,8 @@ along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n #ifndef SIM_MAIN_H\n #define SIM_MAIN_H\n \n+#define SIM_HAVE_COMMON_SIM_STATE\n+\n /* MIPS uses an unusual format for floating point quiet NaNs.  */\n #define SIM_QUIET_NAN_NEGATED\n \n@@ -475,30 +477,12 @@ struct _sim_cpu {\n extern void mips_sim_close (SIM_DESC sd, int quitting);\n #define SIM_CLOSE_HOOK(...) mips_sim_close (__VA_ARGS__)\n \n-/* MIPS specific simulator watch config */\n-\n-void watch_options_install (SIM_DESC sd);\n-\n-struct swatch {\n-  sim_event *pc;\n-  sim_event *clock;\n-  sim_event *cycles;\n-};\n-\n-\n /* FIXME: At present much of the simulator is still static */\n-struct sim_state {\n-\n-  struct swatch watch;\n-\n-  sim_cpu *cpu[MAX_NR_PROCESSORS];\n-\n+struct mips_sim_state {\n   /* microMIPS ISA mode.  */\n   int isa_mode;\n-\n-  sim_state_base base;\n };\n-\n+#define MIPS_SIM_STATE(sd) ((struct mips_sim_state *) STATE_ARCH_DATA (sd))\n \n \n /* Status information: */"
    }
  ]
}