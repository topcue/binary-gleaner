{
  "sha": "80fd2826411c1033ec403658c5f3187bf9c1740a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ODBmZDI4MjY0MTFjMTAzM2VjNDAzNjU4YzVmMzE4N2JmOWMxNzQwYQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-10-01T12:52:44Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-10-02T19:43:41Z"
    },
    "message": "Fix type of startup_with_shell in gdbserver\n\nstartup_with_shell was changed to be of \"bool\" type, but I noticed\nthat the definition in gdbserver disagreed.  This disagreement caused\nsome regressions on a big-endian machine.\n\nThis patch removes the redundant declaration and definition of\nstartup_with_shell and ensures that such clashes will be diagnosed.\n\nThis moves the declaration to common-inferior.h, and introduces a new\ncommon-inferior.c, as suggested by Pedro.\n\ngdb/ChangeLog\n2019-10-02  Tom Tromey  <tromey@adacore.com>\n\n\t* Makefile.in (COMMON_SFILES): Add common-inferior.c.\n\t* gdbsupport/common-inferior.c: New file.\n\t* infcmd.c (startup_with_shell): Don't define.\n\t* nat/fork-inferior.h (startup_with_shell): Don't declare.\n\t* gdbsupport/common-inferior.h (startup_with_shell): Declare.\n\t* inferior.h (startup_with_shell): Don't declare.\n\ngdb/gdbserver/ChangeLog\n2019-10-02  Tom Tromey  <tromey@adacore.com>\n\n\t* Makefile.in (SFILES): Add common-inferior.c.\n\t(OBS): Add common-inferior.o.\n\t* server.c (startup_with_shell): Don't define.",
    "tree": {
      "sha": "7f5b7411ebaee9dbd719e0f6e0f2c0667c8f1dd6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7f5b7411ebaee9dbd719e0f6e0f2c0667c8f1dd6"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/80fd2826411c1033ec403658c5f3187bf9c1740a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/80fd2826411c1033ec403658c5f3187bf9c1740a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/80fd2826411c1033ec403658c5f3187bf9c1740a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/80fd2826411c1033ec403658c5f3187bf9c1740a/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "700545387df82388b054947dc74cc0bb5cbd2a60",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/700545387df82388b054947dc74cc0bb5cbd2a60",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/700545387df82388b054947dc74cc0bb5cbd2a60"
    }
  ],
  "stats": {
    "total": 113,
    "additions": 64,
    "deletions": 49
  },
  "files": [
    {
      "sha": "13a1e46ca251c722190011513d705fcba15829bd",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -1,3 +1,12 @@\n+2019-10-02  Tom Tromey  <tromey@adacore.com>\n+\n+\t* Makefile.in (COMMON_SFILES): Add common-inferior.c.\n+\t* gdbsupport/common-inferior.c: New file.\n+\t* infcmd.c (startup_with_shell): Don't define.\n+\t* nat/fork-inferior.h (startup_with_shell): Don't declare.\n+\t* gdbsupport/common-inferior.h (startup_with_shell): Declare.\n+\t* inferior.h (startup_with_shell): Don't declare.\n+\n 2019-10-02  Christian Biesinger  <cbiesinger@google.com>\n \n \t* gdbsupport/gdb_assert.h: Include errors.h."
    },
    {
      "sha": "81bed9085ac32e833256df6921957466ced053fe",
      "filename": "gdb/Makefile.in",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/Makefile.in?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -953,6 +953,7 @@ COMMON_SFILES = \\\n \tgdbsupport/cleanups.c \\\n \tgdbsupport/common-debug.c \\\n \tgdbsupport/common-exceptions.c \\\n+\tgdbsupport/common-inferior.c \\\n \tgdbsupport/common-regcache.c \\\n \tgdbsupport/common-utils.c \\\n \tgdbsupport/errors.c \\"
    },
    {
      "sha": "0108d6d152fc92ed5c1873f8c111a5485a3b7794",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -1,3 +1,9 @@\n+2019-10-02  Tom Tromey  <tromey@adacore.com>\n+\n+\t* Makefile.in (SFILES): Add common-inferior.c.\n+\t(OBS): Add common-inferior.o.\n+\t* server.c (startup_with_shell): Don't define.\n+\n 2019-10-02  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* linux-low.c (linux_low_read_btrace): Update for change to"
    },
    {
      "sha": "d79424b5ac32ac9bf7932dc7c152afa0a1063a68",
      "filename": "gdb/gdbserver/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbserver/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbserver/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/Makefile.in?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -203,6 +203,7 @@ SFILES = \\\n \t$(srcdir)/gdbsupport/cleanups.c \\\n \t$(srcdir)/gdbsupport/common-debug.c \\\n \t$(srcdir)/gdbsupport/common-exceptions.c \\\n+\t$(srcdir)/gdbsupport/common-inferior.c \\\n \t$(srcdir)/gdbsupport/common-regcache.c \\\n \t$(srcdir)/gdbsupport/common-utils.c \\\n \t$(srcdir)/gdbsupport/errors.c \\\n@@ -248,6 +249,7 @@ OBS = \\\n \tgdbsupport/cleanups.o \\\n \tgdbsupport/common-debug.o \\\n \tgdbsupport/common-exceptions.o \\\n+\tgdbsupport/common-inferior.o \\\n \tgdbsupport/job-control.o \\\n \tgdbsupport/common-regcache.o \\\n \tgdbsupport/common-utils.o \\"
    },
    {
      "sha": "8ee551828dcee51909cef5e13ae3a35f552d31b6",
      "filename": "gdb/gdbserver/server.c",
      "status": "modified",
      "additions": 0,
      "deletions": 6,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbserver/server.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbserver/server.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/server.c?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -67,12 +67,6 @@ char *current_directory;\n \n static gdb_environ our_environ;\n \n-/* Start the inferior using a shell.  */\n-\n-/* We always try to start the inferior using a shell.  */\n-\n-int startup_with_shell = 1;\n-\n int server_waiting;\n \n static int extended_protocol;"
    },
    {
      "sha": "3a7c873f1e67f40a617e34123e9e1a12cde3dd7d",
      "filename": "gdb/gdbsupport/common-inferior.c",
      "status": "added",
      "additions": 26,
      "deletions": 0,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbsupport/common-inferior.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbsupport/common-inferior.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbsupport/common-inferior.c?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -0,0 +1,26 @@\n+/* Functions to deal with the inferior being executed on GDB or\n+   GDBserver.\n+\n+   Copyright (C) 2019 Free Software Foundation, Inc.\n+\n+   This file is part of GDB.\n+\n+   This program is free software; you can redistribute it and/or modify\n+   it under the terms of the GNU General Public License as published by\n+   the Free Software Foundation; either version 3 of the License, or\n+   (at your option) any later version.\n+\n+   This program is distributed in the hope that it will be useful,\n+   but WITHOUT ANY WARRANTY; without even the implied warranty of\n+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+   GNU General Public License for more details.\n+\n+   You should have received a copy of the GNU General Public License\n+   along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n+\n+#include \"gdbsupport/common-defs.h\"\n+#include \"gdbsupport/common-inferior.h\"\n+\n+/* See common-inferior.h.  */\n+\n+bool startup_with_shell = true;"
    },
    {
      "sha": "77d4ad93d3569197b621fa9533039947cc10b8c7",
      "filename": "gdb/gdbsupport/common-inferior.h",
      "status": "modified",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbsupport/common-inferior.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/gdbsupport/common-inferior.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbsupport/common-inferior.h?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -38,4 +38,24 @@ extern const char *get_inferior_cwd ();\n    the directory.  */\n extern void set_inferior_cwd (const char *cwd);\n \n+/* Whether to start up the debuggee under a shell.\n+\n+   If startup-with-shell is set, GDB's \"run\" will attempt to start up\n+   the debuggee under a shell.  This also happens when using GDBserver\n+   under extended remote mode.\n+\n+   This is in order for argument-expansion to occur.  E.g.,\n+\n+   (gdb) run *\n+\n+   The \"*\" gets expanded by the shell into a list of files.\n+\n+   While this is a nice feature, it may be handy to bypass the shell\n+   in some cases.  To disable this feature, do \"set startup-with-shell\n+   false\".\n+\n+   The catch-exec traps expected during start-up will be one more if\n+   the target is started up with a shell.  */\n+extern bool startup_with_shell;\n+\n #endif /* COMMON_COMMON_INFERIOR_H */"
    },
    {
      "sha": "71057748fd12df0dc4948e659c42ca7f3d0134da",
      "filename": "gdb/infcmd.c",
      "status": "modified",
      "additions": 0,
      "deletions": 4,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/infcmd.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/infcmd.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/infcmd.c?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -104,10 +104,6 @@ enum stop_stack_kind stop_stack_dummy;\n \n int stopped_by_random_signal;\n \n-/* See inferior.h.  */\n-\n-bool startup_with_shell = true;\n-\n \f\n /* Accessor routines.  */\n "
    },
    {
      "sha": "43f0417e62961b12bd4a3208a0a578c27f1ede90",
      "filename": "gdb/inferior.h",
      "status": "modified",
      "additions": 0,
      "deletions": 19,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/inferior.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/inferior.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/inferior.h?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -227,25 +227,6 @@ extern struct value *get_return_value (struct value *function,\n extern void prepare_execution_command (struct target_ops *target,\n \t\t\t\t       int background);\n \n-/* Whether to start up the debuggee under a shell.\n-\n-   If startup-with-shell is set, GDB's \"run\" will attempt to start up\n-   the debuggee under a shell.\n-\n-   This is in order for argument-expansion to occur.  E.g.,\n-\n-   (gdb) run *\n-\n-   The \"*\" gets expanded by the shell into a list of files.\n-\n-   While this is a nice feature, it may be handy to bypass the shell\n-   in some cases.  To disable this feature, do \"set startup-with-shell\n-   false\".\n-\n-   The catch-exec traps expected during start-up will be one more if\n-   the target is started up with a shell.  */\n-extern bool startup_with_shell;\n-\n /* Nonzero if stopped due to completion of a stack dummy routine.  */\n \n extern enum stop_stack_kind stop_stack_dummy;"
    },
    {
      "sha": "0a76ff82d31d05e8461f919fc342f80c6baf5929",
      "filename": "gdb/nat/fork-inferior.h",
      "status": "modified",
      "additions": 0,
      "deletions": 20,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/nat/fork-inferior.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/80fd2826411c1033ec403658c5f3187bf9c1740a/gdb/nat/fork-inferior.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/fork-inferior.h?ref=80fd2826411c1033ec403658c5f3187bf9c1740a",
      "patch": "@@ -54,26 +54,6 @@ extern ptid_t startup_inferior (pid_t pid, int ntraps,\n \t\t\t\tstruct target_waitstatus *mystatus,\n \t\t\t\tptid_t *myptid);\n \n-/* Whether to start up the debuggee under a shell.\n-\n-   If startup-with-shell is set, GDB's \"run\" will attempt to start up\n-   the debuggee under a shell.  This also happens when using GDBserver\n-   under extended remote mode.\n-\n-   This is in order for argument-expansion to occur.  E.g.,\n-\n-   (gdb) run *\n-\n-   The \"*\" gets expanded by the shell into a list of files.\n-\n-   While this is a nice feature, it may be handy to bypass the shell\n-   in some cases.  To disable this feature, do \"set startup-with-shell\n-   false\".\n-\n-   The catch-exec traps expected during start-up will be one more if\n-   the target is started up with a shell.  */\n-extern bool startup_with_shell;\n-\n /* Perform any necessary tasks before a fork/vfork takes place.  ARGS\n    is a string containing all the arguments received by the inferior.\n    This function is mainly used by fork_inferior.  */"
    }
  ]
}