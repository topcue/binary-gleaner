{
  "sha": "f437dadd89944254165d076f55f29f7290c00aed",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjQzN2RhZGQ4OTk0NDI1NDE2NWQwNzZmNTVmMjlmNzI5MGMwMGFlZA==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-07-28T02:14:16Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-07-28T03:39:20Z"
    },
    "message": "More just-syms changes\n\n\t* ldlang.c (lang_check): Don't complain about relocs or merge\n\tattributes from --just-symbols input.\n\t* testsuite/ld-misc/just-symbols.exp: Just dump .data section.\n\tDon't run test on a number of targets.",
    "tree": {
      "sha": "f67be6dbca9843685e20604420bad60abf78f4e0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f67be6dbca9843685e20604420bad60abf78f4e0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f437dadd89944254165d076f55f29f7290c00aed",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f437dadd89944254165d076f55f29f7290c00aed",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f437dadd89944254165d076f55f29f7290c00aed",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f437dadd89944254165d076f55f29f7290c00aed/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c38166b376b03dc967b2715a09db0b5667fa9e49",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c38166b376b03dc967b2715a09db0b5667fa9e49",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c38166b376b03dc967b2715a09db0b5667fa9e49"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 22,
    "deletions": 7
  },
  "files": [
    {
      "sha": "9cee3ca275bbda8659fcd8379937f830b78cb1b4",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f437dadd89944254165d076f55f29f7290c00aed/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f437dadd89944254165d076f55f29f7290c00aed/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=f437dadd89944254165d076f55f29f7290c00aed",
      "patch": "@@ -1,3 +1,10 @@\n+2020-07-28  Alan Modra  <amodra@gmail.com>\n+\n+\t* ldlang.c (lang_check): Don't complain about relocs or merge\n+\tattributes from --just-symbols input.\n+\t* testsuite/ld-misc/just-symbols.exp: Just dump .data section.\n+\tDon't run test on a number of targets.\n+\n 2020-07-28  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-misc/just-symbols-1.dd: Revert last change."
    },
    {
      "sha": "1dd17ffff2234cb54b896b91c902938e63cb46c2",
      "filename": "ld/ldlang.c",
      "status": "modified",
      "additions": 6,
      "deletions": 4,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f437dadd89944254165d076f55f29f7290c00aed/ld/ldlang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f437dadd89944254165d076f55f29f7290c00aed/ld/ldlang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.c?ref=f437dadd89944254165d076f55f29f7290c00aed",
      "patch": "@@ -7001,8 +7001,9 @@ lang_check (void)\n \t input format may not have equivalent representations in\n \t the output format (and besides BFD does not translate\n \t relocs for other link purposes than a final link).  */\n-      if ((bfd_link_relocatable (&link_info)\n-\t   || link_info.emitrelocations)\n+      if (!file->flags.just_syms\n+\t  && (bfd_link_relocatable (&link_info)\n+\t      || link_info.emitrelocations)\n \t  && (compatible == NULL\n \t      || (bfd_get_flavour (input_bfd)\n \t\t  != bfd_get_flavour (link_info.output_bfd)))\n@@ -7026,8 +7027,9 @@ lang_check (void)\n \n       /* If the input bfd has no contents, it shouldn't set the\n \t private data of the output bfd.  */\n-      else if ((input_bfd->flags & DYNAMIC) != 0\n-\t       || bfd_count_sections (input_bfd) != 0)\n+      else if (!file->flags.just_syms\n+\t       && ((input_bfd->flags & DYNAMIC) != 0\n+\t\t   || bfd_count_sections (input_bfd) != 0))\n \t{\n \t  bfd_error_handler_type pfn = NULL;\n "
    },
    {
      "sha": "e3c012f0f6eda04e7d574ec10f0a12490947af49",
      "filename": "ld/testsuite/ld-misc/just-symbols.exp",
      "status": "modified",
      "additions": 9,
      "deletions": 3,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f437dadd89944254165d076f55f29f7290c00aed/ld/testsuite/ld-misc/just-symbols.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f437dadd89944254165d076f55f29f7290c00aed/ld/testsuite/ld-misc/just-symbols.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-misc/just-symbols.exp?ref=f437dadd89944254165d076f55f29f7290c00aed",
      "patch": "@@ -20,7 +20,13 @@\n #\n \n # SH/PE targets complain about zero VMA.\n-if { [istarget sh-*-pe] } {\n+# i386-msdos doesn't have .data\n+# tic30-coff has a weird 32-bit reloc that divides sym value by four\n+# alpha-dec-vms wants a bunch of libs to link\n+if { [istarget sh-*-pe]\n+     || [istarget *-*-msdos]\n+     || [istarget *c30-*-*]\n+     || [istarget alpha-*-vms] } {\n     return\n }\n \n@@ -49,13 +55,13 @@ run_ld_link_tests [list \\\n      \"$LDFLAGS -e 0 -T just-symbols.ld --just-symbols=tmpdir/just-symbols-0.o\" \"\" \\\n      \"\" \\\n      {just-symbols-1.s} \\\n-     {{objdump -s just-symbols-1.dd}} \\\n+     {{objdump {-s -j .data} just-symbols-1.dd}} \\\n      \"just-symbols-1obj\"] \\\n     [list \"Executable with --just-symbols test\" \\\n      \"$LDFLAGS -e 0 -T just-symbols.ld --just-symbols=tmpdir/just-symbols-0\" \"\" \\\n      \"\" \\\n      {just-symbols-1.s} \\\n-     {{objdump -s just-symbols-1.dd}} \\\n+     {{objdump {-s -j .data} just-symbols-1.dd}} \\\n      \"just-symbols-1exe\"] \\\n ]\n "
    }
  ]
}