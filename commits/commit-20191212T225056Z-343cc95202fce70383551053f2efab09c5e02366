{
  "sha": "343cc95202fce70383551053f2efab09c5e02366",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzQzY2M5NTIwMmZjZTcwMzgzNTUxMDUzZjJlZmFiMDljNWUwMjM2Ng==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-11-02T03:02:38Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-12-12T22:50:56Z"
    },
    "message": "Move free_all_objfiles to program_space\n\nThis changes free_all_objfiles to be a method on program_space, in\nline with the other changes to treat program_space as a container for\nobjfiles.\n\ngdb/ChangeLog\n2019-12-12  Tom Tromey  <tom@tromey.com>\n\n\t* symfile.c (symbol_file_clear): Update.\n\t* progspace.h (struct program_space) <free_all_objfiles>: Declare\n\tmethod.\n\t* progspace.c (program_space::free_all_objfiles): New method.\n\t* objfiles.h (free_all_objfiles): Don't declare.\n\t* objfiles.c (free_all_objfiles): Move to program_space.\n\nChange-Id: I908b549d2981b6005f7ca181fc0e6d24fc8b7b6f",
    "tree": {
      "sha": "9a6a6c1e979d520891a60e59e76e451c0645218a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9a6a6c1e979d520891a60e59e76e451c0645218a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/343cc95202fce70383551053f2efab09c5e02366",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/343cc95202fce70383551053f2efab09c5e02366",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/343cc95202fce70383551053f2efab09c5e02366",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/343cc95202fce70383551053f2efab09c5e02366/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d0801dd8f22a3e739c6a7d126d45829df981794d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d0801dd8f22a3e739c6a7d126d45829df981794d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d0801dd8f22a3e739c6a7d126d45829df981794d"
    }
  ],
  "stats": {
    "total": 49,
    "additions": 31,
    "deletions": 18
  },
  "files": [
    {
      "sha": "9c1322d2a0da10e6907bcea8146a427702de0733",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/343cc95202fce70383551053f2efab09c5e02366/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/343cc95202fce70383551053f2efab09c5e02366/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=343cc95202fce70383551053f2efab09c5e02366",
      "patch": "@@ -1,3 +1,12 @@\n+2019-12-12  Tom Tromey  <tom@tromey.com>\n+\n+\t* symfile.c (symbol_file_clear): Update.\n+\t* progspace.h (struct program_space) <free_all_objfiles>: Declare\n+\tmethod.\n+\t* progspace.c (program_space::free_all_objfiles): New method.\n+\t* objfiles.h (free_all_objfiles): Don't declare.\n+\t* objfiles.c (free_all_objfiles): Move to program_space.\n+\n 2019-12-12  Tom Tromey  <tom@tromey.com>\n \n \t* progspace.c (program_space::add_objfile)"
    },
    {
      "sha": "56854cc5c63bdf92de7263faad8f492970119134",
      "filename": "gdb/objfiles.c",
      "status": "modified",
      "additions": 0,
      "deletions": 15,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/343cc95202fce70383551053f2efab09c5e02366/gdb/objfiles.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/343cc95202fce70383551053f2efab09c5e02366/gdb/objfiles.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.c?ref=343cc95202fce70383551053f2efab09c5e02366",
      "patch": "@@ -618,21 +618,6 @@ objfile::~objfile ()\n   get_objfile_pspace_data (pspace)->section_map_dirty = 1;\n }\n \n-/* Free all the object files at once and clean up their users.  */\n-\n-void\n-free_all_objfiles (void)\n-{\n-  struct so_list *so;\n-\n-  /* Any objfile reference would become stale.  */\n-  for (so = master_so_list (); so; so = so->next)\n-    gdb_assert (so->objfile == NULL);\n-\n-  for (objfile *objfile : current_program_space->objfiles_safe ())\n-    objfile->unlink ();\n-  clear_symtab_users (0);\n-}\n \f\n /* A helper function for objfile_relocate1 that relocates a single\n    symbol.  */"
    },
    {
      "sha": "34240558da3d8823fd6206c356f0b8652a2b0cc3",
      "filename": "gdb/objfiles.h",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/343cc95202fce70383551053f2efab09c5e02366/gdb/objfiles.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/343cc95202fce70383551053f2efab09c5e02366/gdb/objfiles.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.h?ref=343cc95202fce70383551053f2efab09c5e02366",
      "patch": "@@ -662,8 +662,6 @@ extern void build_objfile_section_table (struct objfile *);\n \n extern void free_objfile_separate_debug (struct objfile *);\n \n-extern void free_all_objfiles (void);\n-\n extern void objfile_relocate (struct objfile *, const struct section_offsets *);\n extern void objfile_rebase (struct objfile *, CORE_ADDR);\n "
    },
    {
      "sha": "3cb0d4c61e3966eb571e18b92fdb7a0fa0c8906a",
      "filename": "gdb/progspace.c",
      "status": "modified",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/343cc95202fce70383551053f2efab09c5e02366/gdb/progspace.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/343cc95202fce70383551053f2efab09c5e02366/gdb/progspace.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/progspace.c?ref=343cc95202fce70383551053f2efab09c5e02366",
      "patch": "@@ -23,6 +23,7 @@\n #include \"arch-utils.h\"\n #include \"gdbcore.h\"\n #include \"solib.h\"\n+#include \"solist.h\"\n #include \"gdbthread.h\"\n #include \"inferior.h\"\n #include <algorithm>\n@@ -156,6 +157,23 @@ program_space::~program_space ()\n \n /* See progspace.h.  */\n \n+void\n+program_space::free_all_objfiles ()\n+{\n+  struct so_list *so;\n+\n+  /* Any objfile reference would become stale.  */\n+  for (so = master_so_list (); so; so = so->next)\n+    gdb_assert (so->objfile == NULL);\n+\n+  while (!objfiles_list.empty ())\n+    objfiles_list.front ()->unlink ();\n+\n+  clear_symtab_users (0);\n+}\n+\n+/* See progspace.h.  */\n+\n void\n program_space::add_objfile (struct objfile *objfile, struct objfile *before)\n {"
    },
    {
      "sha": "6945e38eb921f41353a7699b386d2aaddb317a95",
      "filename": "gdb/progspace.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/343cc95202fce70383551053f2efab09c5e02366/gdb/progspace.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/343cc95202fce70383551053f2efab09c5e02366/gdb/progspace.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/progspace.h?ref=343cc95202fce70383551053f2efab09c5e02366",
      "patch": "@@ -179,6 +179,9 @@ struct program_space\n     return objfiles_list.size () > 1;\n   }\n \n+  /* Free all the objfiles associated with this program space.  */\n+  void free_all_objfiles ();\n+\n \n   /* Pointer to next in linked list.  */\n   struct program_space *next = NULL;"
    },
    {
      "sha": "8852e2893a4f5657cdb5ea034020da2fbb564c7c",
      "filename": "gdb/symfile.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/343cc95202fce70383551053f2efab09c5e02366/gdb/symfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/343cc95202fce70383551053f2efab09c5e02366/gdb/symfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile.c?ref=343cc95202fce70383551053f2efab09c5e02366",
      "patch": "@@ -1251,7 +1251,7 @@ symbol_file_clear (int from_tty)\n      objfiles get stale by free_all_objfiles.  */\n   no_shared_libraries (NULL, from_tty);\n \n-  free_all_objfiles ();\n+  current_program_space->free_all_objfiles ();\n \n   gdb_assert (symfile_objfile == NULL);\n   if (from_tty)"
    }
  ]
}