{
  "sha": "c9923e71ff57ce6e824833560aae59057c6f5783",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Yzk5MjNlNzFmZjU3Y2U2ZTgyNDgzMzU2MGFhZTU5MDU3YzZmNTc4Mw==",
  "commit": {
    "author": {
      "name": "Pedro Alves",
      "email": "pedro@palves.net",
      "date": "2021-06-14T20:29:32Z"
    },
    "committer": {
      "name": "Pedro Alves",
      "email": "pedro@palves.net",
      "date": "2021-06-14T20:29:32Z"
    },
    "message": "Fix silent gdb.base/annota1.exp test coverage regression\n\nThis commit fixes a test coverage regression caused by:\n\n commit b001de2320446ec803b4ee5e0b9710b025b84469\n Author:     Andrew Burgess <andrew.burgess@embecosm.com>\n AuthorDate: Mon Nov 26 17:56:39 2018 +0000\n Commit:     Andrew Burgess <andrew.burgess@embecosm.com>\n CommitDate: Wed Dec 12 17:33:52 2018 +0000\n\n     gdb: Update test pattern to deal with native-extended-gdbserver\n\nWhile looking at a regression caused by a local patch I was working\non, I noticed this:\n\n \u001a\u001apre-prompt\n (gdb)\n \u001a\u001aprompt\n PASS: gdb.base/annota1.exp: breakpoint info\n PASS: gdb.base/annota1.exp: run until main breakpoint\n run\n\n \u001a\u001apost-prompt\n Starting program: /home/pedro/gdb/mygit/build/gdb/testsuite/outputs/gdb.base/annota1/annota1\n next\n\nNote how above, we get the \"run until main breakpoint\" pass even\nbefore \"run\" shows up in the log!  The issue is that the test isn't\nreally testing anything, it always passes regardless of the gdb\noutput.\n\nThere are a few problems here, fixed by this commit:\n\n - using {} to build the list for [join], when the strings we're\n   joining include variable names that must be expanded.  Such list\n   need to be built with [list] instead.\n\n - [join] joins strings with a space character by default.  We need to\n   pass the empty string as second parameter so that it just concats\n   the strings.\n\n - doing too much in a \"-re\" (calling procedures), which doesn't work\n   correctly.  I've seen this before and never digged deeper into why.\n   Probably something to do with how gdb_test_multiple is implemented.\n   Regardless, easy and clear enough to build the pattern first into a\n   variable.\n\ngdb/testsuite/ChangeLog:\nyyyy-mm-dd  Pedro Alves  <pedro@palves.net>\n\n\t* gdb.base/annota1.exp: Build list using [list] instead of {}.\n\tTell [join] to join with no character.  Build expected pattern in\n\tseparate variable instead of in the -re expression directly.\n\nChange-Id: Ib3c89290f0e9ae4a0a43422853fcd4a7a7e12b18",
    "tree": {
      "sha": "d3c3a209e1f4c7b335ed38df3203c636db330b75",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d3c3a209e1f4c7b335ed38df3203c636db330b75"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c9923e71ff57ce6e824833560aae59057c6f5783",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c9923e71ff57ce6e824833560aae59057c6f5783",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c9923e71ff57ce6e824833560aae59057c6f5783",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c9923e71ff57ce6e824833560aae59057c6f5783/comments",
  "author": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "739025e89c44899fd8f41440727748c6467fa7a4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/739025e89c44899fd8f41440727748c6467fa7a4",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/739025e89c44899fd8f41440727748c6467fa7a4"
    }
  ],
  "stats": {
    "total": 15,
    "additions": 12,
    "deletions": 3
  },
  "files": [
    {
      "sha": "224dc46f0f5f69d18e346a19014cccecdb9a0b48",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c9923e71ff57ce6e824833560aae59057c6f5783/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c9923e71ff57ce6e824833560aae59057c6f5783/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=c9923e71ff57ce6e824833560aae59057c6f5783",
      "patch": "@@ -1,3 +1,9 @@\n+2021-06-14  Pedro Alves  <pedro@palves.net>\n+\n+\t* gdb.base/annota1.exp: Build list using [list] instead of {}.\n+\tTell [join] to join with no character.  Build expected pattern in\n+\tseparate variable instead of in the -re expression directly.\n+\n 2021-06-11  Kevin Buettner  <kevinb@redhat.com>\n \n \t* gdb.mi/mi-sym-info.exp (114-symbol-info-function test): Increase"
    },
    {
      "sha": "3689f49fa1b0b20a56c743097e60d742c51c0259",
      "filename": "gdb/testsuite/gdb.base/annota1.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c9923e71ff57ce6e824833560aae59057c6f5783/gdb/testsuite/gdb.base/annota1.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c9923e71ff57ce6e824833560aae59057c6f5783/gdb/testsuite/gdb.base/annota1.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/annota1.exp?ref=c9923e71ff57ce6e824833560aae59057c6f5783",
      "patch": "@@ -126,8 +126,8 @@ gdb_test_multiple \"info break\" \"breakpoint info\" {\n #\n #exp_internal 1\n set binexp [string_to_regexp $binfile]\n-gdb_test_multiple \"run\" \"run until main breakpoint\" {\n-    -re [join { \"\\r\\n\\032\\032post-prompt\\r\\nStarting program: $binexp \" \\\n+\n+set run_re [join [list \"\\r\\n\\032\\032post-prompt\\r\\nStarting program: $binexp \" \\\n \t\t    \"\\(\\(\\r\\nReading \\[^\\r\\n\\]+\\)|\\(\\r\\nwarning: File transfers from remote targets can be slow\\[^\\r\\n\\]+\\)\\)*\" \\\n \t\t    \"\\(\\r\\nwarning: Skipping \\[^\\r\\n\\]+ .gdb_index section in \\[^\\r\\n\\]+\\r\\nDo \\\"set use-deprecated-index-sections on\\\" before the file is read\\r\\nto use the section anyway\\\\.\\)?\" \\\n \t\t    \"\\(\\(\\r\\n\\r\\n\\032\\032frames-invalid\\)|\\(\\r\\n\\r\\n\\032\\032breakpoints-invalid\\)\\)*\\r\\n\\r\\n\" \\\n@@ -146,7 +146,10 @@ gdb_test_multiple \"run\" \"run until main breakpoint\" {\n \t\t    \"\\032\\032frame-source-end\\r\\n\\r\\n\\r\\n\" \\\n \t\t    \"\\032\\032source.*$srcfile:$main_line:.*:beg:$hex\\r\\n\\r\\n\" \\\n \t\t    \"\\032\\032frame-end\\r\\n\\r\\n\" \\\n-\t\t    \"\\032\\032stopped.*$gdb_prompt$\" } ] {\n+\t\t    \"\\032\\032stopped.*$gdb_prompt$\" ] \"\" ]\n+\n+gdb_test_multiple \"run\" \"run until main breakpoint\" {\n+    -re $run_re {\n \tpass $gdb_test_name\n     }\n }"
    }
  ]
}