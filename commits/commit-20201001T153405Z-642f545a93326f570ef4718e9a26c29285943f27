{
  "sha": "642f545a93326f570ef4718e9a26c29285943f27",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjQyZjU0NWE5MzMyNmY1NzBlZjQ3MThlOWEyNmMyOTI4NTk0M2YyNw==",
  "commit": {
    "author": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-10-01T15:34:05Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2020-10-01T15:34:05Z"
    },
    "message": "Add new directive to GAS: .attach_to_group.\n\n\t* config/obj-elf (elf_pseudo_table): Add attach_to_group.\n        (obj_elf_attach_to_group): New function.\n        * doc/as.texi: Document the new directive.\n\t* NEWS: Mention the new feature.\n        * testsuite/gas/elf/attach-1.s: New test.\n        * testsuite/gas/elf/attach-1.d: New test driver.\n        * testsuite/gas/elf/attach-2.s: New test.\n        * testsuite/gas/elf/attach-2.d: New test driver.\n        * testsuite/gas/elf/attach-err.s: New test.\n        * testsuite/gas/elf/attach-err.d: New test driver.\n        * testsuite/gas/elf/attach-err.err: New test error output.\n        * testsuite/gas/elf/elf.exp: Run the new tests.",
    "tree": {
      "sha": "fef880554b171346c1ddb02e7d3be2788c06de97",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fef880554b171346c1ddb02e7d3be2788c06de97"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/642f545a93326f570ef4718e9a26c29285943f27",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/642f545a93326f570ef4718e9a26c29285943f27",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/642f545a93326f570ef4718e9a26c29285943f27",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/642f545a93326f570ef4718e9a26c29285943f27/comments",
  "author": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1f22ee1f72385731cc6511de3b6f1b51c163ecb9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1f22ee1f72385731cc6511de3b6f1b51c163ecb9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1f22ee1f72385731cc6511de3b6f1b51c163ecb9"
    }
  ],
  "stats": {
    "total": 109,
    "additions": 108,
    "deletions": 1
  },
  "files": [
    {
      "sha": "6662b1c6adebfb9e52ac65d1c18e3476e5d680ac",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -1,3 +1,18 @@\n+2020-10-01  Nick Clifton  <nickc@redhat.com>\n+\n+\t* config/obj-elf (elf_pseudo_table): Add attach_to_group.\n+        (obj_elf_attach_to_group): New function.\n+        * doc/as.texi: Document the new directive.\n+\t* NEWS: Mention the new feature.\n+        * testsuite/gas/elf/attach-1.s: New test.\n+        * testsuite/gas/elf/attach-1.d: New test driver.\n+        * testsuite/gas/elf/attach-2.s: New test.\n+        * testsuite/gas/elf/attach-2.d: New test driver.\n+        * testsuite/gas/elf/attach-err.s: New test.\n+        * testsuite/gas/elf/attach-err.d: New test driver.\n+        * testsuite/gas/elf/attach-err.err: New test error output.\n+        * testsuite/gas/elf/elf.exp: Run the new tests.\n+\n 2020-09-16  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gas/26685"
    },
    {
      "sha": "45de821495e3d2dbddb7ba2d30a19586bf45153a",
      "filename": "gas/config/obj-elf.c",
      "status": "modified",
      "additions": 24,
      "deletions": 0,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/config/obj-elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/config/obj-elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/obj-elf.c?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -78,9 +78,11 @@ static void obj_elf_gnu_attribute (int);\n static void obj_elf_tls_common (int);\n static void obj_elf_lcomm (int);\n static void obj_elf_struct (int);\n+static void obj_elf_attach_to_group (int);\n \n static const pseudo_typeS elf_pseudo_table[] =\n {\n+  {\"attach_to_group\", obj_elf_attach_to_group, 0},\n   {\"comm\", obj_elf_common, 0},\n   {\"common\", obj_elf_common, 1},\n   {\"ident\", obj_elf_ident, 0},\n@@ -1040,6 +1042,28 @@ obj_elf_section_name (void)\n   return name;\n }\n \n+static void\n+obj_elf_attach_to_group (int dummy ATTRIBUTE_UNUSED)\n+{\n+  const char * gname = obj_elf_section_name ();\n+\n+  if (gname == NULL)\n+    {\n+      as_warn (_(\"group name not parseable\"));\n+      return;\n+    }\n+\n+  if (elf_group_name (now_seg))\n+    {\n+      as_warn (_(\"section %s already has a group (%s)\"),\n+\t       bfd_section_name (now_seg), elf_group_name (now_seg));\n+      return;\n+    }\n+\n+  elf_group_name (now_seg) = xstrdup (gname);\n+  elf_section_flags (now_seg) |= SHF_GROUP;\n+}\n+\n void\n obj_elf_section (int push)\n {"
    },
    {
      "sha": "c0baa945360b99b8f2211cb430da2c0c559340bb",
      "filename": "gas/doc/as.texi",
      "status": "modified",
      "additions": 11,
      "deletions": 1,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/doc/as.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/doc/as.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/doc/as.texi?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -4362,6 +4362,7 @@ Some machine configurations provide additional directives.\n * Altmacro::                    @code{.altmacro}\n * Ascii::                       @code{.ascii \"@var{string}\"}@dots{}\n * Asciz::                       @code{.asciz \"@var{string}\"}@dots{}\n+* Attach_to_group::             @code{.attach_to_group @var{name}}\n * Balign::                      @code{.balign [@var{abs-expr}[, @var{abs-expr}]]}\n * Bundle directives::           @code{.bundle_align_mode @var{abs-expr}}, etc\n * Byte::                        @code{.byte @var{expressions}}\n@@ -4663,6 +4664,13 @@ trailing zero byte) into consecutive addresses.\n @code{.asciz} is just like @code{.ascii}, but each string is followed by\n a zero byte.  The ``z'' in @samp{.asciz} stands for ``zero''.\n \n+@node Attach_to_group\n+@section @code{.attach_to_group @var{name}}\n+Attaches the current section to the named group.  This is like declaring\n+the section with the @code{G} attribute, but can be done after the section\n+has been created.  Note if the group section  does not exist at the point that\n+this directive is used then it will be created.\n+\n @node Balign\n @section @code{.balign[wl] [@var{abs-expr}[, @var{abs-expr}[, @var{abs-expr}]]]}\n \n@@ -6663,7 +6671,9 @@ a few exceptions to this rule however.  Processor and application specific\n flags can be added to an already defined section.  The @code{.interp},\n @code{.strtab} and @code{.symtab} sections can have the allocate flag\n (@code{a}) set after they are initially defined, and the @code{.note-GNU-stack}\n-section may have the executable (@code{x}) flag added.\n+section may have the executable (@code{x}) flag added.  Also note that the\n+@code{.attach_to_group} directive can be used to add a section to a group even\n+if the section was not originally declared to be part of that group.\n \n The optional @var{type} argument may contain one of the following constants:\n "
    },
    {
      "sha": "053783ea1a082e4605a44effa80b0c13cf57eb66",
      "filename": "gas/testsuite/gas/elf/attach-1.d",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-1.d?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,11 @@\n+#readelf: --section-groups\n+#name: Attaching a section to a group\n+#source: attach-1.s\n+\n+#...\n+group section \\[    1\\] `\\.group' \\[foo\\.group\\] contains . sections:\n+   \\[Index\\]    Name\n+   \\[    .\\]   .*\n+   \\[    .\\]   foo\n+#pass\n+"
    },
    {
      "sha": "aa69fffdaa0bf1d5eb5958f3f7a87d41b70dea00",
      "filename": "gas/testsuite/gas/elf/attach-1.s",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-1.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-1.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-1.s?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,11 @@\n+\t.text\n+\t.nop\n+\t\n+\t.section foo, \"G\", %progbits , foo.group\n+\t.word 0\n+\n+\t.text\n+\t/* This is the intended use of the .attach_to_group directive.\n+\t   It attaches a previously defined section (.text) to a\n+\t   previously defined group (foo.group).  */\n+\t.attach_to_group foo.group"
    },
    {
      "sha": "4aa5211635718c0e95f3d12dc48d1cb2253c5e24",
      "filename": "gas/testsuite/gas/elf/attach-2.d",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-2.d?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,11 @@\n+#readelf: --section-groups\n+#name: Attaching a section to a non-existant group\n+#source: attach-2.s\n+\n+#...\n+group section \\[    1\\] `\\.group' \\[foo\\.group\\] contains 2 sections:\n+   \\[Index\\]    Name\n+   \\[    .\\]   bar\n+   \\[    .\\]   foo\n+#pass\n+"
    },
    {
      "sha": "4a5663f387292e538eecfd480dabec6a52929b25",
      "filename": "gas/testsuite/gas/elf/attach-2.s",
      "status": "added",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-2.s?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,9 @@\n+\t.section bar\n+\t.nop\n+\t.attach_to_group foo.group\n+\t\n+\t.section foo, \"G\", %note , foo.group\n+\t.word 0\n+\n+\t.section bar\n+\t.nop"
    },
    {
      "sha": "3028d725e5b53be12f6c2a3e872a99ad7bc0e350",
      "filename": "gas/testsuite/gas/elf/attach-err.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-err.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-err.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-err.d?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,3 @@\n+#name: Errors generated by .attach_to_group\n+#source: attach-err.s\n+#error_output: attach-err.err"
    },
    {
      "sha": "73854671989924527421ae88da52a0a08c393be7",
      "filename": "gas/testsuite/gas/elf/attach-err.err",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-err.err",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-err.err",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-err.err?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,4 @@\n+.*: Assembler messages:\n+.*:4: Warning: section .* already has a group \\(does\\.not\\.exist\\)\n+.*:5: Error: missing name\n+.*:5: Warning: group name not parseable"
    },
    {
      "sha": "40597e99d0722237d230a61cfb807de4a7b8ce64",
      "filename": "gas/testsuite/gas/elf/attach-err.s",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-err.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/attach-err.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/attach-err.s?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -0,0 +1,5 @@\n+\n+\t/* Test the error messages that should be generated.  */\n+\t.attach_to_group does.not.exist  /* This is OK, the group does not have to exist.  */\n+\t.attach_to_group foo.group  /* Already attached.  */\n+\t.attach_to_group  /* Missing group name.  */"
    },
    {
      "sha": "5ce9691b389c7d3e8b8502c0cade696d6ad66e7a",
      "filename": "gas/testsuite/gas/elf/elf.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/642f545a93326f570ef4718e9a26c29285943f27/gas/testsuite/gas/elf/elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/elf.exp?ref=642f545a93326f570ef4718e9a26c29285943f27",
      "patch": "@@ -139,6 +139,10 @@ if { [is_elf_format] } then {\n     run_dump_test \"group1b\"\n     run_dump_test \"group2\"\n     run_dump_test \"group3\"\n+\n+    run_dump_test \"attach-1\"\n+    run_dump_test \"attach-err\"\n+    \n     switch -glob $target_triplet {\n \thppa64*-*-hpux* { }\n \triscv*-*-* { }"
    }
  ]
}