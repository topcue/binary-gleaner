{
  "sha": "c294730c54f15ea69b18025025c0f191e5876301",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzI5NDczMGM1NGYxNWVhNjliMTgwMjUwMjVjMGYxOTFlNTg3NjMwMQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-06-26T19:16:18Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-07-10T18:43:38Z"
    },
    "message": "Change solib-dsbt.c to use type-safe registry\n\nThis changes solib-dsbt.c to use the type-safe registry.\n\n2019-07-10  Tom Tromey  <tromey@adacore.com>\n\n\t* solib-dsbt.c (struct dsbt_info): Add initializers.\n\t(solib_dsbt_pspace_data): Change type.\n\t(dsbt_pspace_data_cleanup): Remove.\n\t(get_dsbt_info, _initialize_dsbt_solib): Update.",
    "tree": {
      "sha": "0bff3c6e162202f05e6f33477ad6218c0e9eedea",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0bff3c6e162202f05e6f33477ad6218c0e9eedea"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c294730c54f15ea69b18025025c0f191e5876301",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c294730c54f15ea69b18025025c0f191e5876301",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c294730c54f15ea69b18025025c0f191e5876301",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c294730c54f15ea69b18025025c0f191e5876301/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9d52077d65206b1e0df62f05b577b5ceede1228a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d52077d65206b1e0df62f05b577b5ceede1228a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9d52077d65206b1e0df62f05b577b5ceede1228a"
    }
  ],
  "stats": {
    "total": 47,
    "additions": 19,
    "deletions": 28
  },
  "files": [
    {
      "sha": "1a957506d619749a9e782d3940c98b65f9dd28ab",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c294730c54f15ea69b18025025c0f191e5876301/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c294730c54f15ea69b18025025c0f191e5876301/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=c294730c54f15ea69b18025025c0f191e5876301",
      "patch": "@@ -1,3 +1,10 @@\n+2019-07-10  Tom Tromey  <tromey@adacore.com>\n+\n+\t* solib-dsbt.c (struct dsbt_info): Add initializers.\n+\t(solib_dsbt_pspace_data): Change type.\n+\t(dsbt_pspace_data_cleanup): Remove.\n+\t(get_dsbt_info, _initialize_dsbt_solib): Update.\n+\n 2019-07-10  Tom Tromey  <tromey@adacore.com>\n \n \t* spu-tdep.c (spu_overlay_data): Change type."
    },
    {
      "sha": "59b195f491eb06f9d514bd7b53f83ec2f36c9f1a",
      "filename": "gdb/solib-dsbt.c",
      "status": "modified",
      "additions": 12,
      "deletions": 28,
      "changes": 40,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c294730c54f15ea69b18025025c0f191e5876301/gdb/solib-dsbt.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c294730c54f15ea69b18025025c0f191e5876301/gdb/solib-dsbt.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/solib-dsbt.c?ref=c294730c54f15ea69b18025025c0f191e5876301",
      "patch": "@@ -142,35 +142,29 @@ struct dsbt_info\n      of loaded shared objects.  ``main_executable_lm_info'' provides\n      a way to get at this information so that it doesn't need to be\n      frequently recomputed.  Initialized by dsbt_relocate_main_executable.  */\n-  struct lm_info_dsbt *main_executable_lm_info;\n+  struct lm_info_dsbt *main_executable_lm_info = nullptr;\n \n   /* Load maps for the main executable and the interpreter.  These are obtained\n      from ptrace.  They are the starting point for getting into the program,\n      and are required to find the solib list with the individual load maps for\n      each module.  */\n-  struct int_elf32_dsbt_loadmap *exec_loadmap;\n-  struct int_elf32_dsbt_loadmap *interp_loadmap;\n+  struct int_elf32_dsbt_loadmap *exec_loadmap = nullptr;\n+  struct int_elf32_dsbt_loadmap *interp_loadmap = nullptr;\n \n   /* Cached value for lm_base, below.  */\n-  CORE_ADDR lm_base_cache;\n+  CORE_ADDR lm_base_cache = 0;\n \n   /* Link map address for main module.  */\n-  CORE_ADDR main_lm_addr;\n+  CORE_ADDR main_lm_addr = 0;\n \n-  CORE_ADDR interp_text_sect_low;\n-  CORE_ADDR interp_text_sect_high;\n-  CORE_ADDR interp_plt_sect_low;\n-  CORE_ADDR interp_plt_sect_high;\n+  CORE_ADDR interp_text_sect_low = 0;\n+  CORE_ADDR interp_text_sect_high = 0;\n+  CORE_ADDR interp_plt_sect_low = 0;\n+  CORE_ADDR interp_plt_sect_high = 0;\n };\n \n /* Per-program-space data key.  */\n-static const struct program_space_data *solib_dsbt_pspace_data;\n-\n-static void\n-dsbt_pspace_data_cleanup (struct program_space *pspace, void *arg)\n-{\n-  xfree (arg);\n-}\n+static program_space_key<dsbt_info> solib_dsbt_pspace_data;\n \n /* Get the current dsbt data.  If none is found yet, add it now.  This\n    function always returns a valid object.  */\n@@ -180,18 +174,11 @@ get_dsbt_info (void)\n {\n   struct dsbt_info *info;\n \n-  info = (struct dsbt_info *) program_space_data (current_program_space,\n-\t\t\t\t\t\t  solib_dsbt_pspace_data);\n+  info = solib_dsbt_pspace_data.get (current_program_space);\n   if (info != NULL)\n     return info;\n \n-  info = XCNEW (struct dsbt_info);\n-  set_program_space_data (current_program_space, solib_dsbt_pspace_data, info);\n-\n-  info->lm_base_cache = 0;\n-  info->main_lm_addr = 0;\n-\n-  return info;\n+  return solib_dsbt_pspace_data.emplace (current_program_space);\n }\n \n \n@@ -1043,9 +1030,6 @@ struct target_so_ops dsbt_so_ops;\n void\n _initialize_dsbt_solib (void)\n {\n-  solib_dsbt_pspace_data\n-    = register_program_space_data_with_cleanup (NULL, dsbt_pspace_data_cleanup);\n-\n   dsbt_so_ops.relocate_section_addresses = dsbt_relocate_section_addresses;\n   dsbt_so_ops.free_so = dsbt_free_so;\n   dsbt_so_ops.clear_solib = dsbt_clear_solib;"
    }
  ]
}