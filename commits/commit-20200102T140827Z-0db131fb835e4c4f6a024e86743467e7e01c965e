{
  "sha": "0db131fb835e4c4f6a024e86743467e7e01c965e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MGRiMTMxZmI4MzVlNGM0ZjZhMDI0ZTg2NzQzNDY3ZTdlMDFjOTY1ZQ==",
  "commit": {
    "author": {
      "name": "Tamar Christina",
      "email": "tamar.christina@arm.com",
      "date": "2020-01-02T14:06:01Z"
    },
    "committer": {
      "name": "Tamar Christina",
      "email": "tamar.christina@arm.com",
      "date": "2020-01-02T14:08:27Z"
    },
    "message": "AArch64: Set the correct ELF class for AArch64 stubs (PR/25210)\n\nThis fixes PR 25210 by specifying the the correct ELF class for AArch64 stubs.\nAfter doing this the stub section starts behaving like a normal object file\nloaded from disk.  That is SEC_LINKER_CREATED causes us to have to write the\nsection manually.\n\nThis flag was added as a fix for PR 24753.  I believe that\nfix to still be correct as linker created sections don't have a size on disk\nand it fixes the Arm bootstrap regression. But in this case specifying the\ncorrect section class also makes the stub section not be considered by\ncompress.c.\n\nSo I'm partially revert this change so that we don't have to manage the section\nmanually as implied by SEC_LINKER_CREATED.\n\nbfd/ChangeLog:\n\n\tPR 25210\n\tPR 24753\n\t* elfnn-aarch64.c (_bfd_aarch64_create_stub_section): Set ELF class.\n\nld/ChangeLog:\n\n\tPR 25210\n\tPR 24753\n\t* emultempl/aarch64elf.em (elf${ELFSIZE}_aarch64_add_stub_section):\n\tRemove SEC_LINKER_CREATED.\n\t* testsuite/ld-aarch64/aarch64-elf.exp: Add erratum835769-843419.\n\t* testsuite/ld-aarch64/erratum835769-843419.d: New test.",
    "tree": {
      "sha": "46301a70ff4b14310b46dd329b1d8679be65fae1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/46301a70ff4b14310b46dd329b1d8679be65fae1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0db131fb835e4c4f6a024e86743467e7e01c965e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0db131fb835e4c4f6a024e86743467e7e01c965e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0db131fb835e4c4f6a024e86743467e7e01c965e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0db131fb835e4c4f6a024e86743467e7e01c965e/comments",
  "author": {
    "login": "TamarChristinaArm",
    "id": 48126768,
    "node_id": "MDQ6VXNlcjQ4MTI2NzY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TamarChristinaArm",
    "html_url": "https://github.com/TamarChristinaArm",
    "followers_url": "https://api.github.com/users/TamarChristinaArm/followers",
    "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}",
    "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions",
    "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs",
    "repos_url": "https://api.github.com/users/TamarChristinaArm/repos",
    "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "TamarChristinaArm",
    "id": 48126768,
    "node_id": "MDQ6VXNlcjQ4MTI2NzY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/48126768?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TamarChristinaArm",
    "html_url": "https://github.com/TamarChristinaArm",
    "followers_url": "https://api.github.com/users/TamarChristinaArm/followers",
    "following_url": "https://api.github.com/users/TamarChristinaArm/following{/other_user}",
    "gists_url": "https://api.github.com/users/TamarChristinaArm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TamarChristinaArm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TamarChristinaArm/subscriptions",
    "organizations_url": "https://api.github.com/users/TamarChristinaArm/orgs",
    "repos_url": "https://api.github.com/users/TamarChristinaArm/repos",
    "events_url": "https://api.github.com/users/TamarChristinaArm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TamarChristinaArm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a65b5de624a20f37f0fed484d6208d014f10a6f8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a65b5de624a20f37f0fed484d6208d014f10a6f8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a65b5de624a20f37f0fed484d6208d014f10a6f8"
    }
  ],
  "stats": {
    "total": 76,
    "additions": 75,
    "deletions": 1
  },
  "files": [
    {
      "sha": "144c77888803fa9b3efe647c65fb65ee731dbacb",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0db131fb835e4c4f6a024e86743467e7e01c965e/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0db131fb835e4c4f6a024e86743467e7e01c965e/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=0db131fb835e4c4f6a024e86743467e7e01c965e",
      "patch": "@@ -1,3 +1,9 @@\n+2020-01-02  Tamar Christina  <tamar.christina@arm.com>\n+\n+\tPR 25210\n+\tPR 24753\n+\t* elfnn-aarch64.c (_bfd_aarch64_create_stub_section): Set ELF class.\n+\n 2020-01-01  Alan Modra  <amodra@gmail.com>\n \n \tUpdate year range in copyright notice of all files."
    },
    {
      "sha": "756ffeb6bdad04ce7fc466e7f3c23c462c6a806a",
      "filename": "bfd/elfnn-aarch64.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0db131fb835e4c4f6a024e86743467e7e01c965e/bfd/elfnn-aarch64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0db131fb835e4c4f6a024e86743467e7e01c965e/bfd/elfnn-aarch64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfnn-aarch64.c?ref=0db131fb835e4c4f6a024e86743467e7e01c965e",
      "patch": "@@ -3177,6 +3177,10 @@ _bfd_aarch64_create_stub_section (asection *section,\n   if (s_name == NULL)\n     return NULL;\n \n+  /* PR 25210.  Set the right class on the stub_bfd.  */\n+  elf_elfheader (htab->stub_bfd)->e_ident[EI_CLASS] = ELFCLASSNN;\n+  BFD_ASSERT (ELFCLASSNN == get_elf_backend_data (htab->stub_bfd)->s->elfclass);\n+\n   memcpy (s_name, section->name, namelen);\n   memcpy (s_name + namelen, STUB_SUFFIX, sizeof (STUB_SUFFIX));\n   return (*htab->add_stub_section) (s_name, section);"
    },
    {
      "sha": "356a48a0a36cf196e2fb6054e6fe18088b6840b7",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=0db131fb835e4c4f6a024e86743467e7e01c965e",
      "patch": "@@ -1,3 +1,12 @@\n+2020-01-02  Tamar Christina  <tamar.christina@arm.com>\n+\n+\tPR 25210\n+\tPR 24753\n+\t* emultempl/aarch64elf.em (elf${ELFSIZE}_aarch64_add_stub_section):\n+\tRemove SEC_LINKER_CREATED.\n+\t* testsuite/ld-aarch64/aarch64-elf.exp: Add erratum835769-843419.\n+\t* testsuite/ld-aarch64/erratum835769-843419.d: New test.\n+\n 2020-01-01  Alan Modra  <amodra@gmail.com>\n \n \tUpdate year range in copyright notice of all files."
    },
    {
      "sha": "d0519b3d7b24542aa7500c1bc706415e48bd4f40",
      "filename": "ld/emultempl/aarch64elf.em",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/emultempl/aarch64elf.em",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/emultempl/aarch64elf.em",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/emultempl/aarch64elf.em?ref=0db131fb835e4c4f6a024e86743467e7e01c965e",
      "patch": "@@ -170,7 +170,7 @@ elf${ELFSIZE}_aarch64_add_stub_section (const char *stub_sec_name,\n   lang_output_section_statement_type *os;\n   struct hook_stub_info info;\n \n-  flags = (SEC_ALLOC | SEC_LOAD | SEC_READONLY | SEC_CODE | SEC_LINKER_CREATED\n+  flags = (SEC_ALLOC | SEC_LOAD | SEC_READONLY | SEC_CODE\n \t   | SEC_HAS_CONTENTS | SEC_RELOC | SEC_IN_MEMORY | SEC_KEEP);\n   stub_sec = bfd_make_section_anyway_with_flags (stub_file->the_bfd,\n \t\t\t\t\t\t stub_sec_name, flags);"
    },
    {
      "sha": "fefc751b0fe2da935b88bf3d7827e628449c5443",
      "filename": "ld/testsuite/ld-aarch64/aarch64-elf.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/testsuite/ld-aarch64/aarch64-elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/testsuite/ld-aarch64/aarch64-elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-aarch64/aarch64-elf.exp?ref=0db131fb835e4c4f6a024e86743467e7e01c965e",
      "patch": "@@ -96,6 +96,7 @@ run_dump_test \"erratum843419-far-adr\"\n run_dump_test \"erratum843419-far-full\"\n run_dump_test \"erratum843419-full\"\n run_dump_test \"erratum843419-no-args\"\n+run_dump_test \"erratum835769-843419\"\n \n # Relocation Tests\n run_dump_test_lp64 \"weak-undefined\""
    },
    {
      "sha": "728765f61d0a1381d54e7d6a700437e79d4f8d26",
      "filename": "ld/testsuite/ld-aarch64/erratum835769-843419.d",
      "status": "added",
      "additions": 54,
      "deletions": 0,
      "changes": 54,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/testsuite/ld-aarch64/erratum835769-843419.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0db131fb835e4c4f6a024e86743467e7e01c965e/ld/testsuite/ld-aarch64/erratum835769-843419.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-aarch64/erratum835769-843419.d?ref=0db131fb835e4c4f6a024e86743467e7e01c965e",
      "patch": "@@ -0,0 +1,54 @@\n+#source: erratum835769.s\n+#as:\n+#ld: --fix-cortex-a53-835769 --fix-cortex-a53-843419=full -e0x400000\n+#objdump: -dr\n+#...\n+Disassembly of section .text:\n+#...\n+[0-9a-f]+ <a1ldr>:\n+[ \\t0-9a-f]+:[ \\t]+b8408c87[ \\t]+ldr[ \\t]+w7, \\[x4, #8\\]\\!\n+[ \\t0-9a-f]+:[ \\t]+1b017c06[ \\t]+mul[ \\t]+w6, w0, w1\n+[ \\t0-9a-f]+:[ \\t]+f9400084[ \\t]+ldr[ \\t]+x4, \\[x4\\]\n+[ \\t0-9a-f]+:[ \\t0-9a-z]+[ \\t]+b[ \\t]+[0-9a-f]+ <__erratum_835769_veneer_0>\n+[ \\t0-9a-f]+:[ \\t]+aa0503e0[ \\t]+mov[ \\t]+x0, x5\n+[ \\t0-9a-f]+:[ \\t]+d65f03c0[ \\t]+ret\n+\n+[0-9a-f]+ <a5ldr>:\n+[ \\t0-9a-f]+:[ \\t]+b8408c87[ \\t]+ldr[ \\t]+w7, \\[x4, #8\\]!\n+[ \\t0-9a-f]+:[ \\t]+1b017c06[ \\t]+mul[ \\t]+w6, w0, w1\n+[ \\t0-9a-f]+:[ \\t]+f9400084[ \\t]+ldr[ \\t]+x4, \\[x4\\]\n+[ \\t0-9a-f]+:[ \\t0-9a-z]+[ \\t]+b[ \\t]+[0-9a-f]+ <__erratum_835769_veneer_1>\n+[ \\t0-9a-f]+:[ \\t]+aa0503e0[ \\t]+mov[ \\t]+x0, x5\n+[ \\t0-9a-f]+:[ \\t]+d65f03c0[ \\t]+ret\n+\n+[0-9a-f]+ <a6ldr>:\n+[ \\t0-9a-f]+:[ \\t]+b8408c87[ \\t]+ldr[ \\t]+w7, \\[x4, #8\\]!\n+[ \\t0-9a-f]+:[ \\t]+1b017c06[ \\t]+mul[ \\t]+w6, w0, w1\n+[ \\t0-9a-f]+:[ \\t]+f9400084[ \\t]+ldr[ \\t]+x4, \\[x4\\]\n+[ \\t0-9a-f]+:[ \\t]+9b031885[ \\t]+madd[ \\t]+x5, x4, x3, x6\n+[ \\t0-9a-f]+:[ \\t]+aa0503e0[ \\t]+mov[ \\t]+x0, x5\n+[ \\t0-9a-f]+:[ \\t]+d65f03c0[ \\t]+ret\n+\n+[0-9a-f]+ <a7str>:\n+[ \\t0-9a-f]+:[ \\t]+b8408c87[ \\t]+ldr[ \\t]+w7, \\[x4, #8\\]!\n+[ \\t0-9a-f]+:[ \\t]+1b017c06[ \\t]+mul[ \\t]+w6, w0, w1\n+[ \\t0-9a-f]+:[ \\t]+f9000084[ \\t]+str[ \\t]+x4, \\[x4\\]\n+[ \\t0-9a-f]+:[ \\t0-9a-z]+[ \\t]+b[ \\t]+[0-9a-f]+ <__erratum_835769_veneer_2>\n+[ \\t0-9a-f]+:[ \\t]+aa0503e0[ \\t]+mov[ \\t]+x0, x5\n+[ \\t0-9a-f]+:[ \\t]+d65f03c0[ \\t]+ret\n+\n+[ \\t0-9a-f]+:[ \\t]+d503201f[ \\t]+nop\n+[ \\t0-9a-f]+:[ \\t]+14000400[ \\t]+b[ \\t]+[0-9a-f]+ <__erratum_835769_veneer_0\\+0xfe8>\n+[ \\t0-9a-f]+:[ \\t]+d503201f[ \\t]+nop\n+[0-9a-f]+ <__erratum_835769_veneer_2>:\n+[ \\t0-9a-f]+:[ \\t]+9b031885[ \\t]+madd[ \\t]+x5, x4, x3, x6\n+[ \\t0-9a-f]+:[ \\t0-9a-z]+[ \\t]+b[ \\t]+[0-9a-f]+ <a7str\\+0x[0-9a-f]+>\n+\n+[0-9a-f]+ <__erratum_835769_veneer_1>:\n+[ \\t0-9a-f]+:[ \\t]+9ba31845[ \\t]+umaddl[ \\t]+x5, w2, w3, x6\n+[ \\t0-9a-f]+:[ \\t0-9a-z]+[ \\t]+b[ \\t]+[0-9a-f]+ <a5ldr\\+0x[0-9a-f]+>\n+\n+[0-9a-f]+ <__erratum_835769_veneer_0>:\n+[ \\t0-9a-f]+:[ \\t]+9b031845[ \\t]+madd[ \\t]+x5, x2, x3, x6\n+[ \\t0-9a-f]+:[ \\t0-9a-z]+[ \\t]+b[ \\t]+[0-9a-f]+ <a1ldr\\+0x[0-9a-f]+>\n+#pass"
    }
  ]
}