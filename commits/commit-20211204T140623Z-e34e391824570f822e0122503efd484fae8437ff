{
  "sha": "e34e391824570f822e0122503efd484fae8437ff",
  "node_id": "C_kwDOANOeidoAKGUzNGUzOTE4MjQ1NzBmODIyZTAxMjI1MDNlZmQ0ODRmYWU4NDM3ZmY",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-11-01T04:30:25Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-12-04T14:06:23Z"
    },
    "message": "gdb: don't show deprecated aliases\n\nI don't think it's very useful to show deprecated aliases to the\nuser.  It encourages the user to use them, when the goal is the\nopposite.\n\nFor example, before:\n\n    (gdb) help set index-cache enabled\n    set index-cache enabled, set index-cache off, set index-cache on\n      alias set index-cache off = set index-cache enabled off\n      alias set index-cache on = set index-cache enabled on\n    Enable the index cache.\n    When on, enable the use of the index cache.\n\n    (gdb) help set index-cache on\n    Warning: 'set index-cache on', an alias for the command 'set index-cache enabled', is deprecated.\n    Use 'set index-cache enabled on'.\n\n    set index-cache enabled, set index-cache off, set index-cache on\n      alias set index-cache off = set index-cache enabled off\n      alias set index-cache on = set index-cache enabled on\n    Enable the index cache.\n    When on, enable the use of the index cache.\n\nAfter:\n\n    (gdb) help set index-cache enabled\n    Enable the index cache.\n    When on, enable the use of the index cache.\n    (gdb) help set index-cache on\n    Warning: 'set index-cache on', an alias for the command 'set index-cache enabled', is deprecated.\n    Use 'set index-cache enabled on'.\n\n    Enable the index cache.\n    When on, enable the use of the index cache.\n\nChange-Id: I989b618a5ad96ba975367e9d16db95523cd57a4c",
    "tree": {
      "sha": "99e79843d4d7012c96b9102e8f68b0dde9d663ce",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/99e79843d4d7012c96b9102e8f68b0dde9d663ce"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e34e391824570f822e0122503efd484fae8437ff",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e34e391824570f822e0122503efd484fae8437ff",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e34e391824570f822e0122503efd484fae8437ff",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e34e391824570f822e0122503efd484fae8437ff/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a3e9c2f9da9ab84bb5f0d1e6dc7e99e6114ade39",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a3e9c2f9da9ab84bb5f0d1e6dc7e99e6114ade39",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a3e9c2f9da9ab84bb5f0d1e6dc7e99e6114ade39"
    }
  ],
  "stats": {
    "total": 51,
    "additions": 48,
    "deletions": 3
  },
  "files": [
    {
      "sha": "9b965ea9989194b5e1ca19e6040eb90e9a8dcb3c",
      "filename": "gdb/cli/cli-decode.c",
      "status": "modified",
      "additions": 26,
      "deletions": 3,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e34e391824570f822e0122503efd484fae8437ff/gdb/cli/cli-decode.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e34e391824570f822e0122503efd484fae8437ff/gdb/cli/cli-decode.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-decode.c?ref=e34e391824570f822e0122503efd484fae8437ff",
      "patch": "@@ -1345,7 +1345,7 @@ fput_aliases_definition_styled (const cmd_list_element &cmd,\n \t\t\t\tstruct ui_file *stream)\n {\n   for (const cmd_list_element &alias : cmd.aliases)\n-    if (!alias.default_args.empty ())\n+    if (!alias.cmd_deprecated && !alias.default_args.empty ())\n       fput_alias_definition_styled (alias, stream);\n }\n \n@@ -1361,17 +1361,40 @@ fput_command_names_styled (const cmd_list_element &c,\n \t\t\t   bool always_fput_c_name, const char *postfix,\n \t\t\t   struct ui_file *stream)\n {\n-  if (always_fput_c_name || !c.aliases.empty ())\n+  /* First, check if we are going to print something.  That is, either if\n+     ALWAYS_FPUT_C_NAME is true or if there exists at least one non-deprecated\n+     alias.  */\n+\n+  auto print_alias = [] (const cmd_list_element &alias)\n+    {\n+      return !alias.cmd_deprecated;\n+    };\n+\n+  bool print_something = always_fput_c_name;\n+  if (!print_something)\n+    for (const cmd_list_element &alias : c.aliases)\n+      {\n+\tif (!print_alias (alias))\n+\t  continue;\n+\n+\tprint_something = true;\n+\tbreak;\n+      }\n+\n+  if (print_something)\n     fput_command_name_styled (c, stream);\n \n   for (const cmd_list_element &alias : c.aliases)\n     {\n+      if (!print_alias (alias))\n+\tcontinue;\n+\n       fputs_filtered (\", \", stream);\n       wrap_here (\"   \");\n       fput_command_name_styled (alias, stream);\n     }\n \n-  if (always_fput_c_name || !c.aliases.empty ())\n+  if (print_something)\n     fputs_filtered (postfix, stream);\n }\n "
    },
    {
      "sha": "1dca419f0fb7c311be86f4730383beb1df4a8ae3",
      "filename": "gdb/testsuite/gdb.base/commands.exp",
      "status": "modified",
      "additions": 22,
      "deletions": 0,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e34e391824570f822e0122503efd484fae8437ff/gdb/testsuite/gdb.base/commands.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e34e391824570f822e0122503efd484fae8437ff/gdb/testsuite/gdb.base/commands.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/commands.exp?ref=e34e391824570f822e0122503efd484fae8437ff",
      "patch": "@@ -709,6 +709,27 @@ maintenance deprecate set qqq_aaa\"\n     file delete $file1\n }\n \n+# Test that the help for a command does not show deprecated aliases.\n+\n+proc_with_prefix deprecated_command_alias_help_test {} {\n+    gdb_test_multiline \"define real_command\" \\\n+\t\"define real_command\" \"End with a line saying just \\\"end\\\"..\" \\\n+\t\"print 1\" \"\" \\\n+\t\"end\" \"\"\n+\n+    gdb_test_no_output \"alias alias_command = real_command\"\n+    gdb_test_no_output \"alias alias_with_args_command = real_command 123\"\n+\n+    gdb_test \"help real_command\" \\\n+\t\"real_command, alias_with_args_command, alias_command\\r\\n  alias alias_with_args_command = real_command 123\\r\\nUser-defined.\" \\\n+\t\"help real_command, before\"\n+    gdb_test_no_output \"maintenance deprecate alias_command\"\n+    gdb_test_no_output \"maintenance deprecate alias_with_args_command\"\n+    gdb_test \"help real_command\" \\\n+\t\"User-defined.\" \\\n+\t\"help real_command, after\"\n+}\n+\n proc_with_prefix bp_deleted_in_command_test {} {\n     global gdb_prompt\n \n@@ -1203,6 +1224,7 @@ user_defined_command_manyargs_test\n watchpoint_command_test\n test_command_prompt_position\n deprecated_command_test\n+deprecated_command_alias_help_test\n bp_deleted_in_command_test\n temporary_breakpoint_commands\n stray_arg0_test"
    }
  ]
}