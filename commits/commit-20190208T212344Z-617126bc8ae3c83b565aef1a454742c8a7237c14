{
  "sha": "617126bc8ae3c83b565aef1a454742c8a7237c14",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjE3MTI2YmM4YWUzYzgzYjU2NWFlZjFhNDU0NzQyYzhhNzIzN2MxNA==",
  "commit": {
    "author": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-02-05T01:31:10Z"
    },
    "committer": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-02-08T21:23:44Z"
    },
    "message": "RISC-V: Add FP register core file support.\n\nThis adds fp reg support similar to the existing general reg support.\n\nThis fixes one gdb testsuite failure\nFAIL: gdb.base/gcore.exp: corefile restored system registers\nwhich fails without the patch because fcsr was missing.  Otherwise, no\nregressions with riscv64-linux native testsuite run.\n\n\tgdb/\n\t* riscv-linux-tdep.c (riscv_linux_fregmap): New.\n\t(riscv_linux_fregset): New.\n\t(riscv_linux_iterate_over_regset_sections): Call cb for .reg2 section.",
    "tree": {
      "sha": "312286bc904dffaa269a15679258c6d588e9b075",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/312286bc904dffaa269a15679258c6d588e9b075"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/617126bc8ae3c83b565aef1a454742c8a7237c14",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/617126bc8ae3c83b565aef1a454742c8a7237c14",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/617126bc8ae3c83b565aef1a454742c8a7237c14",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/617126bc8ae3c83b565aef1a454742c8a7237c14/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "21820ebe588d89fa874cbd87c117eb9d551d870f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/21820ebe588d89fa874cbd87c117eb9d551d870f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/21820ebe588d89fa874cbd87c117eb9d551d870f"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 27,
    "deletions": 2
  },
  "files": [
    {
      "sha": "de727739f2ac16d6f24e540976256fc1b79c5d83",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/617126bc8ae3c83b565aef1a454742c8a7237c14/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/617126bc8ae3c83b565aef1a454742c8a7237c14/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=617126bc8ae3c83b565aef1a454742c8a7237c14",
      "patch": "@@ -1,3 +1,9 @@\n+2019-02-08  Jim Wilson  <jimw@sifive.com>\n+\n+\t* riscv-linux-tdep.c (riscv_linux_fregmap): New.\n+\t(riscv_linux_fregset): New.\n+\t(riscv_linux_iterate_over_regset_sections): Call cb for .reg2 section.\n+\n 2019-02-07  Tom Tromey  <tom@tromey.com>\n \n \t* thread.c (thread_cancel_execution_command): Update."
    },
    {
      "sha": "91061c5b3e90b0cac5e4c15ad440e1cebf4e3bf8",
      "filename": "gdb/riscv-linux-tdep.c",
      "status": "modified",
      "additions": 21,
      "deletions": 2,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/617126bc8ae3c83b565aef1a454742c8a7237c14/gdb/riscv-linux-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/617126bc8ae3c83b565aef1a454742c8a7237c14/gdb/riscv-linux-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/riscv-linux-tdep.c?ref=617126bc8ae3c83b565aef1a454742c8a7237c14",
      "patch": "@@ -37,13 +37,30 @@ static const struct regcache_map_entry riscv_linux_gregmap[] =\n   { 0 }\n };\n \n+/* Define the FP register mapping.  The kernel puts the 32 FP regs first, and\n+   then FCSR.  */\n+\n+static const struct regcache_map_entry riscv_linux_fregmap[] =\n+{\n+  { 32, RISCV_FIRST_FP_REGNUM, 0 },\n+  { 1, RISCV_CSR_FCSR_REGNUM, 0 },\n+  { 0 }\n+};\n+\n /* Define the general register regset.  */\n \n static const struct regset riscv_linux_gregset =\n {\n   riscv_linux_gregmap, regcache_supply_regset, regcache_collect_regset\n };\n \n+/* Define the FP register regset.  */\n+\n+static const struct regset riscv_linux_fregset =\n+{\n+  riscv_linux_fregmap, regcache_supply_regset, regcache_collect_regset\n+};\n+\n /* Define hook for core file support.  */\n \n static void\n@@ -54,8 +71,10 @@ riscv_linux_iterate_over_regset_sections (struct gdbarch *gdbarch,\n {\n   cb (\".reg\", (32 * riscv_isa_xlen (gdbarch)), (32 * riscv_isa_xlen (gdbarch)),\n       &riscv_linux_gregset, NULL, cb_data);\n-\n-  /* TODO: Add FP register support.  */\n+  /* The kernel is adding 8 bytes for FCSR.  */\n+  cb (\".reg2\", (32 * riscv_isa_flen (gdbarch)) + 8,\n+      (32 * riscv_isa_flen (gdbarch)) + 8,\n+      &riscv_linux_fregset, NULL, cb_data);\n }\n \n /* Signal trampoline support.  */"
    }
  ]
}