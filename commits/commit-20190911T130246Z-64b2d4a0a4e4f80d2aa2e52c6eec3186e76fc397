{
  "sha": "64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjRiMmQ0YTBhNGU0ZjgwZDJhYTJlNTJjNmVlYzMxODZlNzZmYzM5Nw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-09-08T17:38:24Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-09-11T13:02:46Z"
    },
    "message": "Introduce bfd_set_filename\n\nThis introduces a new bfd_set_filename function, which is then used in\nvarious spots in gdb.  This allows for the removal of some casts.\n\nbfd/ChangeLog\n2019-09-11  Tom Tromey  <tom@tromey.com>\n\n\t* opncls.c (bfd_set_filename): New function.\n\t* bfd-in2.h: Regenerate.\n\ngdb/ChangeLog\n2019-09-11  Tom Tromey  <tom@tromey.com>\n\n\t* symfile-mem.c (symbol_file_add_from_memory): Use\n\tbfd_set_filename.\n\t* solib-darwin.c (darwin_bfd_open): Use bfd_set_filename.\n\t* solib-aix.c (solib_aix_bfd_open): Use bfd_set_filename.",
    "tree": {
      "sha": "33767370cb253d485e62fb6d421d227a80f4eccd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/33767370cb253d485e62fb6d421d227a80f4eccd"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1ff5d5c46342727ad6728732e122f963fbb2268b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1ff5d5c46342727ad6728732e122f963fbb2268b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1ff5d5c46342727ad6728732e122f963fbb2268b"
    }
  ],
  "stats": {
    "total": 51,
    "additions": 41,
    "deletions": 10
  },
  "files": [
    {
      "sha": "ea0f06041b0e26f2e6fcd8e654d543f4340568e9",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -1,3 +1,8 @@\n+2019-09-11  Tom Tromey  <tom@tromey.com>\n+\n+\t* opncls.c (bfd_set_filename): New function.\n+\t* bfd-in2.h: Regenerate.\n+\n 2019-09-11  Alan Modra  <amodra@gmail.com>\n \n \t* targets.c (struct bfd_target): Add _bfd_group_name."
    },
    {
      "sha": "13445a1de71bd6cc44e13fece30c072fb8967ea9",
      "filename": "bfd/bfd-in2.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/bfd/bfd-in2.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/bfd/bfd-in2.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/bfd-in2.h?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -1193,6 +1193,8 @@ bfd_boolean bfd_fill_in_gnu_debuglink_section\n \n char *bfd_follow_build_id_debuglink (bfd *abfd, const char *dir);\n \n+void bfd_set_filename (bfd *abfd, char *filename);\n+\n /* Extracted from libbfd.c.  */\n \n /* Byte swapping macros for user section data.  */"
    },
    {
      "sha": "d14dfe932066dbb964f9e14fb8d505ec298fc29b",
      "filename": "bfd/opncls.c",
      "status": "modified",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/bfd/opncls.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/bfd/opncls.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/opncls.c?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -2089,3 +2089,23 @@ bfd_follow_build_id_debuglink (bfd *abfd, const char *dir)\n \t\t\t\t   get_build_id_name,\n \t\t\t\t   check_build_id_file, &build_id);\n }\n+\n+/*\n+FUNCTION\n+\tbfd_set_filename\n+\n+SYNOPSIS\n+\tvoid bfd_set_filename (bfd *abfd, char *filename);\n+\n+DESCRIPTION\n+\tSet the filename of @var{abfd}.  The old filename, if any, is freed.\n+\t@var{filename} must be allocated using @code{xmalloc}.  After\n+\tthis call, it is owned @var{abfd}.\n+*/\n+\n+void\n+bfd_set_filename (bfd *abfd, char *filename)\n+{\n+  free ((char *) abfd->filename);\n+  abfd->filename = filename;\n+}"
    },
    {
      "sha": "e4b18fa1dece32f27dc9250c132c9825c30f67b6",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -1,3 +1,10 @@\n+2019-09-11  Tom Tromey  <tom@tromey.com>\n+\n+\t* symfile-mem.c (symbol_file_add_from_memory): Use\n+\tbfd_set_filename.\n+\t* solib-darwin.c (darwin_bfd_open): Use bfd_set_filename.\n+\t* solib-aix.c (solib_aix_bfd_open): Use bfd_set_filename.\n+\n 2019-09-10  Tom Tromey  <tromey@adacore.com>\n \n \t* dwarf-index-write.c (write_psymbols): Extend error message."
    },
    {
      "sha": "0c8a18267c95103cec28afa6fc4d9b7ffad208d9",
      "filename": "gdb/solib-aix.c",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/solib-aix.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/solib-aix.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/solib-aix.c?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -643,10 +643,10 @@ solib_aix_bfd_open (const char *pathname)\n      along with appended parenthesized member name in order to allow commands\n      listing all shared libraries to display.  Otherwise, we would only be\n      displaying the name of the archive member object.  */\n-  xfree ((char *) bfd_get_filename (object_bfd.get ()));\n-  object_bfd->filename = xstrprintf (\"%s%s\",\n-\t\t\t\t     bfd_get_filename (archive_bfd.get ()),\n-\t\t\t\t     sep);\n+  bfd_set_filename (object_bfd.get (),\n+\t\t    xstrprintf (\"%s%s\",\n+\t\t\t\tbfd_get_filename (archive_bfd.get ()),\n+\t\t\t\tsep));\n \n   return object_bfd;\n }"
    },
    {
      "sha": "778c6d9f6173dd6f45fc25e32f1d222a71b5f07f",
      "filename": "gdb/solib-darwin.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/solib-darwin.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/solib-darwin.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/solib-darwin.c?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -670,8 +670,7 @@ darwin_bfd_open (const char *pathname)\n   /* The current filename for fat-binary BFDs is a name generated\n      by BFD, usually a string containing the name of the architecture.\n      Reset its value to the actual filename.  */\n-  xfree ((char *) bfd_get_filename (res.get ()));\n-  res->filename = xstrdup (pathname);\n+  bfd_set_filename (res.get (), xstrdup (pathname));\n \n   return res;\n }"
    },
    {
      "sha": "05542c13915cbe1fb269353a79b5737c418e5983",
      "filename": "gdb/symfile-mem.c",
      "status": "modified",
      "additions": 2,
      "deletions": 4,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/symfile-mem.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397/gdb/symfile-mem.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile-mem.c?ref=64b2d4a0a4e4f80d2aa2e52c6eec3186e76fc397",
      "patch": "@@ -101,11 +101,9 @@ symbol_file_add_from_memory (struct bfd *templ, CORE_ADDR addr,\n   /* Manage the new reference for the duration of this function.  */\n   gdb_bfd_ref_ptr nbfd_holder = gdb_bfd_ref_ptr::new_reference (nbfd);\n \n-  xfree ((char *) bfd_get_filename (nbfd));\n   if (name == NULL)\n-    nbfd->filename = xstrdup (\"shared object read from target memory\");\n-  else\n-    nbfd->filename = name;\n+    name = xstrdup (\"shared object read from target memory\");\n+  bfd_set_filename (nbfd, name);\n \n   if (!bfd_check_format (nbfd, bfd_object))\n     error (_(\"Got object file from memory but can't read symbols: %s.\"),"
    }
  ]
}