{
  "sha": "955b06fa576df1a6954263043ea3f3a5b9ad5940",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTU1YjA2ZmE1NzZkZjFhNjk1NDI2MzA0M2VhM2YzYTViOWFkNTk0MA==",
  "commit": {
    "author": {
      "name": "Sergio Durigan Junior",
      "email": "sergiodj@redhat.com",
      "date": "2019-05-29T14:36:57Z"
    },
    "committer": {
      "name": "Sergio Durigan Junior",
      "email": "sergiodj@redhat.com",
      "date": "2019-05-29T20:14:50Z"
    },
    "message": "Don't crash is dwarf_decode_macro_bytes's 'body' is NULL, even when '!is_define'\n\nRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1715008\n\nOn commit 7bede82892a06e6c26989803e70f53697392dcf9 (\"Don't crash if\ndwarf_decode_macro_bytes's 'body' is NULL\"), I was too strict when\nchecking if 'body' is NULL: the check only comprised the case when\n'is_define' is true.  However, the corruption of .debug_macro by\nrpmbuild's \"debugedit\" also affects the case when 'is_define' is\nfalse, i.e., when the macro is being undefined.\n\nThis commit improves the check and covers both cases now.  This has\nbeen tested on Fedora 30 with a problematic debuginfo, and I don't see\na segfault anymore.\n\nOK to push?\n\ngdb/ChangeLog:\n2019-05-29  Sergio Durigan Junior  <sergiodj@redhat.com>\n\n\tRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1708192\n\tRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1715008\n\t* dwarf2read.c (dwarf_decode_macro_bytes): Move check to see if\n\t'body' is NULL to the outter 'if', protecting the '!is_define'\n\tsituation as well.",
    "tree": {
      "sha": "699963af53c6e152b5f3582c76fce0e53c25749b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/699963af53c6e152b5f3582c76fce0e53c25749b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/955b06fa576df1a6954263043ea3f3a5b9ad5940",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/955b06fa576df1a6954263043ea3f3a5b9ad5940",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/955b06fa576df1a6954263043ea3f3a5b9ad5940",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/955b06fa576df1a6954263043ea3f3a5b9ad5940/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "f49055a52f04f75b6560f304eb975128dd82ad68",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f49055a52f04f75b6560f304eb975128dd82ad68",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f49055a52f04f75b6560f304eb975128dd82ad68"
    }
  ],
  "stats": {
    "total": 39,
    "additions": 22,
    "deletions": 17
  },
  "files": [
    {
      "sha": "2ab3615be6e52ba83579b4383c543932bac89bab",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/955b06fa576df1a6954263043ea3f3a5b9ad5940/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/955b06fa576df1a6954263043ea3f3a5b9ad5940/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=955b06fa576df1a6954263043ea3f3a5b9ad5940",
      "patch": "@@ -1,3 +1,11 @@\n+2019-05-29  Sergio Durigan Junior  <sergiodj@redhat.com>\n+\n+\tRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1708192\n+\tRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1715008\n+\t* dwarf2read.c (dwarf_decode_macro_bytes): Move check to see if\n+\t'body' is NULL to the outter 'if', protecting the '!is_define'\n+\tsituation as well.\n+\n 2019-05-29  Tom Tromey  <tromey@adacore.com>\n \n \t* dwarf2read.c (partial_die_parent_scope): Call dwarf_tag_name."
    },
    {
      "sha": "e1d6bb2d580848d8f9bb3ef9f9b2f50cb2996982",
      "filename": "gdb/dwarf2read.c",
      "status": "modified",
      "additions": 14,
      "deletions": 17,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/955b06fa576df1a6954263043ea3f3a5b9ad5940/gdb/dwarf2read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/955b06fa576df1a6954263043ea3f3a5b9ad5940/gdb/dwarf2read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.c?ref=955b06fa576df1a6954263043ea3f3a5b9ad5940",
      "patch": "@@ -24648,25 +24648,22 @@ dwarf_decode_macro_bytes (struct dwarf2_cu *cu,\n \t\t\t is_define ? _(\"definition\") : _(\"undefinition\"),\n \t\t\t line == 0 ? _(\"zero\") : _(\"non-zero\"), line, body);\n \n-\t    if (is_define)\n+\t    if (body == NULL)\n \t      {\n-\t\tif (body != NULL)\n-\t\t  parse_macro_definition (current_file, line, body);\n-\t\telse\n-\t\t  {\n-\t\t    /* Fedora's rpm-build's \"debugedit\" binary\n-\t\t       corrupted .debug_macro sections.\n-\n-\t\t       For more info, see\n-\t\t       https://bugzilla.redhat.com/show_bug.cgi?id=1708786 */\n-\t\t    complaint (_(\"debug info gives %s invalid macro definition \"\n-\t\t\t\t \"without body (corrupted?) at line %d\"\n-\t\t\t\t \"on file %s\"),\n-\t\t\t       at_commandline ? _(\"command-line\")\n-\t\t\t       : _(\"in-file\"),\n-\t\t\t       line, current_file->filename);\n-\t\t  }\n+\t\t/* Fedora's rpm-build's \"debugedit\" binary\n+\t\t   corrupted .debug_macro sections.\n+\n+\t\t   For more info, see\n+\t\t   https://bugzilla.redhat.com/show_bug.cgi?id=1708786 */\n+\t\tcomplaint (_(\"debug info gives %s invalid macro %s \"\n+\t\t\t     \"without body (corrupted?) at line %d \"\n+\t\t\t     \"on file %s\"),\n+\t\t\t   at_commandline ? _(\"command-line\") : _(\"in-file\"),\n+\t\t\t   is_define ? _(\"definition\") : _(\"undefinition\"),\n+\t\t\t   line, current_file->filename);\n \t      }\n+\t    else if (is_define)\n+\t      parse_macro_definition (current_file, line, body);\n \t    else\n \t      {\n \t\tgdb_assert (macinfo_type == DW_MACRO_undef"
    }
  ]
}