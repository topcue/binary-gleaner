{
  "sha": "f166ae0188dcb89c5ae925034260a708a254ab2f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjE2NmFlMDE4OGRjYjg5YzVhZTkyNTAzNDI2MGE3MDhhMjU0YWIyZg==",
  "commit": {
    "author": {
      "name": "Szabolcs Nagy",
      "email": "szabolcs.nagy@arm.com",
      "date": "2019-04-25T14:06:53Z"
    },
    "committer": {
      "name": "Szabolcs Nagy",
      "email": "szabolcs.nagy@arm.com",
      "date": "2019-05-24T14:07:42Z"
    },
    "message": "aarch64: handle .variant_pcs directive in gas\n\nIn ELF objects the specified symbol is marked with STO_AARCH64_VARIANT_PCS.\n\ngas/ChangeLog:\n\n\t* config/tc-aarch64.c (s_variant_pcs): New function.\n\t* doc/c-aarch64.texi: Document .variant_pcs.\n\t* testsuite/gas/aarch64/symbol-variant_pcs-1.d: New test.\n\t* testsuite/gas/aarch64/symbol-variant_pcs-1.s: New test.\n\t* testsuite/gas/aarch64/symbol-variant_pcs-2.d: New test.\n\t* testsuite/gas/aarch64/symbol-variant_pcs-2.s: New test.",
    "tree": {
      "sha": "8826f08fe24117fe6cd3d747c50b69c8d890e263",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8826f08fe24117fe6cd3d747c50b69c8d890e263"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f166ae0188dcb89c5ae925034260a708a254ab2f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f166ae0188dcb89c5ae925034260a708a254ab2f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f166ae0188dcb89c5ae925034260a708a254ab2f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f166ae0188dcb89c5ae925034260a708a254ab2f/comments",
  "author": {
    "login": "nsz-arm",
    "id": 30925343,
    "node_id": "MDQ6VXNlcjMwOTI1MzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nsz-arm",
    "html_url": "https://github.com/nsz-arm",
    "followers_url": "https://api.github.com/users/nsz-arm/followers",
    "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/nsz-arm/orgs",
    "repos_url": "https://api.github.com/users/nsz-arm/repos",
    "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nsz-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nsz-arm",
    "id": 30925343,
    "node_id": "MDQ6VXNlcjMwOTI1MzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nsz-arm",
    "html_url": "https://github.com/nsz-arm",
    "followers_url": "https://api.github.com/users/nsz-arm/followers",
    "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/nsz-arm/orgs",
    "repos_url": "https://api.github.com/users/nsz-arm/repos",
    "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nsz-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2301ed1c9af1316b4bad3747d2b03f7d44940f87",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2301ed1c9af1316b4bad3747d2b03f7d44940f87",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2301ed1c9af1316b4bad3747d2b03f7d44940f87"
    }
  ],
  "stats": {
    "total": 69,
    "additions": 69,
    "deletions": 0
  },
  "files": [
    {
      "sha": "ed69e9a8126762aaf3247af39da4062ce5dfe2ce",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -1,3 +1,12 @@\n+2019-05-24  Szabolcs Nagy  <szabolcs.nagy@arm.com>\n+\n+\t* config/tc-aarch64.c (s_variant_pcs): New function.\n+\t* doc/c-aarch64.texi: Document .variant_pcs.\n+\t* testsuite/gas/aarch64/symbol-variant_pcs-1.d: New test.\n+\t* testsuite/gas/aarch64/symbol-variant_pcs-1.s: New test.\n+\t* testsuite/gas/aarch64/symbol-variant_pcs-2.d: New test.\n+\t* testsuite/gas/aarch64/symbol-variant_pcs-2.s: New test.\n+\n 2019-05-24  Alan Modra  <amodra@gmail.com>\n \n \t* po/POTFILES.in: Regenerate."
    },
    {
      "sha": "3bccfa24ba7412214a176e0ef47c1d3bb12ce9b7",
      "filename": "gas/config/tc-aarch64.c",
      "status": "modified",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/config/tc-aarch64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/config/tc-aarch64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-aarch64.c?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -1936,6 +1936,28 @@ s_aarch64_elf_cons (int nbytes)\n   demand_empty_rest_of_line ();\n }\n \n+/* Mark symbol that it follows a variant PCS convention.  */\n+\n+static void\n+s_variant_pcs (int ignored ATTRIBUTE_UNUSED)\n+{\n+  char *name;\n+  char c;\n+  symbolS *sym;\n+  asymbol *bfdsym;\n+  elf_symbol_type *elfsym;\n+\n+  c = get_symbol_name (&name);\n+  if (!*name)\n+    as_bad (_(\"Missing symbol name in directive\"));\n+  sym = symbol_find_or_make (name);\n+  restore_line_pointer (c);\n+  demand_empty_rest_of_line ();\n+  bfdsym = symbol_get_bfdsym (sym);\n+  elfsym = elf_symbol_from (bfd_asymbol_bfd (bfdsym), bfdsym);\n+  gas_assert (elfsym);\n+  elfsym->internal_elf_sym.st_other |= STO_AARCH64_VARIANT_PCS;\n+}\n #endif /* OBJ_ELF */\n \n /* Output a 32-bit word, but mark as an instruction.  */\n@@ -2082,6 +2104,7 @@ const pseudo_typeS md_pseudo_table[] = {\n   {\"long\", s_aarch64_elf_cons, 4},\n   {\"xword\", s_aarch64_elf_cons, 8},\n   {\"dword\", s_aarch64_elf_cons, 8},\n+  {\"variant_pcs\", s_variant_pcs, 0},\n #endif\n   {0, 0, 0}\n };"
    },
    {
      "sha": "e6630610010744b75fb2b6a3a2cb008d08c9c97a",
      "filename": "gas/doc/c-aarch64.texi",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/doc/c-aarch64.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/doc/c-aarch64.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/doc/c-aarch64.texi?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -439,6 +439,12 @@ should only be done if it is really necessary.\n \n @c VVVVVVVVVVVVVVVVVVVVVVVVVV\n \n+@cindex @code{.variant_pcs} directive, AArch64\n+@item .variant_pcs @var{symbol}\n+This directive marks @var{symbol} referencing a function that may\n+follow a variant procedure call standard with different register\n+usage convention from the base procedure call standard.\n+\n @c WWWWWWWWWWWWWWWWWWWWWWWWWW\n @c XXXXXXXXXXXXXXXXXXXXXXXXXX\n "
    },
    {
      "sha": "6257ce16872049cb8e63c4ee41e5324fa3bec439",
      "filename": "gas/testsuite/gas/aarch64/symbol-variant_pcs-1.d",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/symbol-variant_pcs-1.d?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -0,0 +1,10 @@\n+#objdump: -t\n+\n+.*:     file format .*\n+\n+SYMBOL TABLE:\n+0+ l    d  \\.text\t0+ \\.text\n+0+ l    d  \\.data\t0+ \\.data\n+0+ l    d  \\.bss\t0+ \\.bss\n+0+ l       \\.text\t0+ func\n+0+         \\*UND\\*\t0+ 0x80 foobar"
    },
    {
      "sha": "aecb9bde57fb2c4b2d558503107ab9811d27e105",
      "filename": "gas/testsuite/gas/aarch64/symbol-variant_pcs-1.s",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-1.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-1.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/symbol-variant_pcs-1.s?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -0,0 +1,8 @@\n+.text\n+.variant_pcs foobar\n+func:\n+\tbl\tfoobar\n+\tb\tfoobar\n+\n+.data\n+.xword\tfoobar"
    },
    {
      "sha": "d9b60ac8e7f5eb26bac8a551e1bb6827873ee753",
      "filename": "gas/testsuite/gas/aarch64/symbol-variant_pcs-2.d",
      "status": "added",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/symbol-variant_pcs-2.d?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -0,0 +1,9 @@\n+#objdump: -t\n+\n+.*:     file format .*\n+\n+SYMBOL TABLE:\n+0+ l    d  \\.text\t0+ \\.text\n+0+ l    d  \\.data\t0+ \\.data\n+0+ l    d  \\.bss\t0+ \\.bss\n+0+ l       \\.text\t0+ 0x80 foo"
    },
    {
      "sha": "820733b30659ed3ccc583e111fb882c7262776bb",
      "filename": "gas/testsuite/gas/aarch64/symbol-variant_pcs-2.s",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f166ae0188dcb89c5ae925034260a708a254ab2f/gas/testsuite/gas/aarch64/symbol-variant_pcs-2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/symbol-variant_pcs-2.s?ref=f166ae0188dcb89c5ae925034260a708a254ab2f",
      "patch": "@@ -0,0 +1,4 @@\n+.text\n+.variant_pcs foo\n+foo:\n+\tret"
    }
  ]
}