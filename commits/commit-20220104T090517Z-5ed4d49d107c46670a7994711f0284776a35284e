{
  "sha": "5ed4d49d107c46670a7994711f0284776a35284e",
  "node_id": "C_kwDOANOeidoAKDVlZDRkNDlkMTA3YzQ2NjcwYTc5OTQ3MTFmMDI4NDc3NmEzNTI4NGU",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2022-01-04T09:05:17Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2022-01-04T09:05:17Z"
    },
    "message": "gas: rework handling of backslashes in quoted symbol names\n\nStrange effects can result from the present handling, e.g.:\n\n.if 1\n\"backslash\\\\\":\n.endif\n\nyields first (correctly) \"missing closing `\"'\" but then also \"invalid\ncharacter '\\' in mnemonic\" and further \"end of file inside conditional\".\nSymbols names ending in \\ are in principle not expressable with that\nscheme.\n\nInstead of recording whether a backslash was seen, inspect the\nsubsequent character right away. Only accept \\\\ (meaning a single\nbackslash in the resulting symbol name) and \\\" (meaning an embedded\ndouble quote in the resulting symbol name) for now, warning about any\nother combination.\n\nWhile perhaps not necessary immediately, also permit concatenated\nstrings to form a symbol name. This may become useful if going forward\nwe would want to support \\<octal> or \\x<hex> sequences, where closing\nand re-opening quotes can be useful to delimit such sequences.\n\nThe ELF \"Multibyte symbol names\" test gets switched away from using\n.set, as that would now also mean excluding nios2 and pru. By using\n.equiv instead, even the existing #notarget can be dropped. (For h8300\nthe .section directive additionally needs attributes specified, to avoid\na target specific warning.)",
    "tree": {
      "sha": "d883166be8b96d7aa83f6c1f7dfc0d1ebfbc6c53",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d883166be8b96d7aa83f6c1f7dfc0d1ebfbc6c53"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5ed4d49d107c46670a7994711f0284776a35284e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5ed4d49d107c46670a7994711f0284776a35284e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5ed4d49d107c46670a7994711f0284776a35284e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5ed4d49d107c46670a7994711f0284776a35284e/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "79541a6d9220e800ebc5278594105982d6e1d80c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/79541a6d9220e800ebc5278594105982d6e1d80c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/79541a6d9220e800ebc5278594105982d6e1d80c"
    }
  ],
  "stats": {
    "total": 84,
    "additions": 69,
    "deletions": 15
  },
  "files": [
    {
      "sha": "1e97a83f27b6b37269abc7f8676155a747fa9236",
      "filename": "gas/expr.c",
      "status": "modified",
      "additions": 42,
      "deletions": 8,
      "changes": 50,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ed4d49d107c46670a7994711f0284776a35284e/gas/expr.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ed4d49d107c46670a7994711f0284776a35284e/gas/expr.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/expr.c?ref=5ed4d49d107c46670a7994711f0284776a35284e",
      "patch": "@@ -2400,18 +2400,52 @@ get_symbol_name (char ** ilp_return)\n     }\n   else if (c == '\"')\n     {\n-      bool backslash_seen;\n+      char *dst = input_line_pointer;\n \n       * ilp_return = input_line_pointer;\n-      do\n+      for (;;)\n \t{\n-\t  backslash_seen = c == '\\\\';\n-\t  c = * input_line_pointer ++;\n-\t}\n-      while (c != 0 && (c != '\"' || backslash_seen));\n+\t  c = *input_line_pointer++;\n+\n+\t  if (c == 0)\n+\t    {\n+\t      as_warn (_(\"missing closing '\\\"'\"));\n+\t      break;\n+\t    }\n \n-      if (c == 0)\n-\tas_warn (_(\"missing closing '\\\"'\"));\n+\t  if (c == '\"')\n+\t    {\n+\t      char *ilp_save = input_line_pointer;\n+\n+\t      SKIP_WHITESPACE ();\n+\t      if (*input_line_pointer == '\"')\n+\t\t{\n+\t\t  ++input_line_pointer;\n+\t\t  continue;\n+\t\t}\n+\t      input_line_pointer = ilp_save;\n+\t      break;\n+\t    }\n+\n+\t  if (c == '\\\\')\n+\t    switch (*input_line_pointer)\n+\t      {\n+\t      case '\"':\n+\t      case '\\\\':\n+\t\tc = *input_line_pointer++;\n+\t\tbreak;\n+\n+\t      default:\n+\t\tif (c != 0)\n+\t\t  as_warn (_(\"'\\\\%c' in quoted symbol name; \"\n+\t\t\t     \"behavior may change in the future\"),\n+\t\t\t   *input_line_pointer);\n+\t\tbreak;\n+\t      }\n+\n+\t  *dst++ = c;\n+\t}\n+      *dst = 0;\n     }\n   *--input_line_pointer = 0;\n   return c;"
    },
    {
      "sha": "5f0d3f8c469357a191e162712373b819ce09ae8e",
      "filename": "gas/testsuite/gas/all/quoted-sym-names.d",
      "status": "modified",
      "additions": 9,
      "deletions": 2,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/all/quoted-sym-names.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/all/quoted-sym-names.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/quoted-sym-names.d?ref=5ed4d49d107c46670a7994711f0284776a35284e",
      "patch": "@@ -1,6 +1,13 @@\n-#nm: --extern-only\n+#nm: --extern-only --numeric-sort\n #name: quoted symbol names\n+# No quoted strings handling (TC_STRING_ESCAPES set to 0):\n+#notarget: powerpc*-*-aix* powerpc*-*-beos* powerpc-*-macos* rs6000-*-*\n+# Explicitly no escapes in quoted strings:\n+#notarget: z80-*-*\n \n #...\n 0+00 T test-a\n-\n+0+01 T back\\\\slash\n+0+02 T back\"slash\n+0+03 T backslash\\\\\n+0+04 T backslash\""
    },
    {
      "sha": "677f5dd3ce45814d5eb329a118ebc5b182df5240",
      "filename": "gas/testsuite/gas/all/quoted-sym-names.s",
      "status": "modified",
      "additions": 16,
      "deletions": 1,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/all/quoted-sym-names.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/all/quoted-sym-names.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/quoted-sym-names.s?ref=5ed4d49d107c46670a7994711f0284776a35284e",
      "patch": "@@ -1,4 +1,19 @@\n \t.text\n \t.globl\t\"test-a\"\n \"test-a\":\n-\t.word 0\n+\t.byte 0\n+\t.globl\t\"back\\\\slash\"\n+\"back\\\\slash\":\n+\t.byte 0\n+\t.globl\t\"back\\\"slash\"\n+\"back\\\"slash\":\n+\t.byte 0\n+\t.globl\t\"backslash\\\\\"\n+\"backslash\\\\\":\n+\t.byte 0\n+\t.globl\t\"backslash\\\"\"\n+\"backslash\\\"\":\n+\t.byte 0\n+/*\t.globl\t\"back\"\"slash\" */\n+\"back\"\"slash\":\n+\t.byte 0"
    },
    {
      "sha": "f1f40c10c4b7da4a3d870f714083123e1768fd68",
      "filename": "gas/testsuite/gas/elf/syms.d",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/elf/syms.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/elf/syms.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/syms.d?ref=5ed4d49d107c46670a7994711f0284776a35284e",
      "patch": "@@ -1,7 +1,5 @@\n #readelf: -S -s -p .strtab\n #name: Multibyte symbol names\n-# The following targets use an unusual .set syntax...\n-#notarget: alpha*-*-* h8300-*-*\n \n #...\n Section Headers:"
    },
    {
      "sha": "0fd960d9734ed41171f8ed71e6ee13f7fce713c1",
      "filename": "gas/testsuite/gas/elf/syms.s",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/elf/syms.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5ed4d49d107c46670a7994711f0284776a35284e/gas/testsuite/gas/elf/syms.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/syms.s?ref=5ed4d49d107c46670a7994711f0284776a35284e",
      "patch": "@@ -1,5 +1,5 @@\n-\t.section \"sec\\xa5\\xc2tion\"\n+\t.section \"sec\\xa5\\xc2tion\", \"a\"\n \t\n-\t.set \"sy\\xa5\\xc2mbol\", .\n+\t.equiv \"sy\\xa5\\xc2mbol\", .\n \n \t.string8 \"str\\xa5\\xc2ing\""
    }
  ]
}