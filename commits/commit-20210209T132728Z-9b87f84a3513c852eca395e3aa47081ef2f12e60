{
  "sha": "9b87f84a3513c852eca395e3aa47081ef2f12e60",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OWI4N2Y4NGEzNTEzYzg1MmVjYTM5NWUzYWE0NzA4MWVmMmYxMmU2MA==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-02-09T13:27:28Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-02-09T13:27:28Z"
    },
    "message": "[binutils] Handle DW_UT_skeleton/split_compile in process_debug_info\n\nWith this exec:\n...\n$ gcc -gsplit-dwarf hello.c -gdwarf-5\n...\nwe run into:\n...\n$ readelf -w a.out > READELF\nreadelf: Warning: CU at offset c7 contains corrupt or unsupported unit type: 4.\nreadelf: Warning: CU at offset c7 contains corrupt or unsupported unit type: 4.\n...\n\nFix this by handling DW_UT_skeleton and DW_UT_split_compile in\nprocess_debug_info.\n\nNote that this just adds the parsing of DWO_id, but not yet any printing of\nit.\n\nTested on x86_64-linux.\n\nbinutils/ChangeLog:\n\n2021-02-09  Tom de Vries  <tdevries@suse.de>\n\n\tPR binutils/27386\n\t* dwarf.c (process_debug_info): Handling DW_UT_skeleton and\n\tDW_UT_split_compile.",
    "tree": {
      "sha": "9b9a922e6b0b01cd8bfb7cfba84109ef4edcac3a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9b9a922e6b0b01cd8bfb7cfba84109ef4edcac3a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9b87f84a3513c852eca395e3aa47081ef2f12e60",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9b87f84a3513c852eca395e3aa47081ef2f12e60",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9b87f84a3513c852eca395e3aa47081ef2f12e60",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9b87f84a3513c852eca395e3aa47081ef2f12e60/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a57d17732eba20c7ebeaabd023e2f0816fb095f6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a57d17732eba20c7ebeaabd023e2f0816fb095f6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a57d17732eba20c7ebeaabd023e2f0816fb095f6"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 23,
    "deletions": 1
  },
  "files": [
    {
      "sha": "0f07cd42eaf7093bdb92a4081a638badcd2871c2",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9b87f84a3513c852eca395e3aa47081ef2f12e60/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9b87f84a3513c852eca395e3aa47081ef2f12e60/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=9b87f84a3513c852eca395e3aa47081ef2f12e60",
      "patch": "@@ -1,3 +1,9 @@\n+2021-02-09  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR binutils/27386\n+\t* dwarf.c (process_debug_info): Handling DW_UT_skeleton and\n+\tDW_UT_split_compile.\n+\n 2021-02-09  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/lib/binutils-common.exp (supports_gnu_osabi): Remove"
    },
    {
      "sha": "6797dd158d64f56e1c5f9073da8f981f46454408",
      "filename": "binutils/dwarf.c",
      "status": "modified",
      "additions": 17,
      "deletions": 1,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9b87f84a3513c852eca395e3aa47081ef2f12e60/binutils/dwarf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9b87f84a3513c852eca395e3aa47081ef2f12e60/binutils/dwarf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dwarf.c?ref=9b87f84a3513c852eca395e3aa47081ef2f12e60",
      "patch": "@@ -3581,6 +3581,13 @@ process_debug_info (struct dwarf_section *           section,\n \n       SAFE_BYTE_GET_AND_INC (compunit.cu_abbrev_offset, hdrptr, offset_size, end);\n \n+      if (compunit.cu_unit_type == DW_UT_split_compile\n+\t  || compunit.cu_unit_type == DW_UT_skeleton)\n+\t{\n+\t  uint64_t dwo_id;\n+\t  SAFE_BYTE_GET_AND_INC (dwo_id, hdrptr, 8, end);\n+\t}\n+\n       if (this_set == NULL)\n \t{\n \t  abbrev_base = 0;\n@@ -3684,6 +3691,13 @@ process_debug_info (struct dwarf_section *           section,\n       if (compunit.cu_version < 5)\n \tSAFE_BYTE_GET_AND_INC (compunit.cu_pointer_size, hdrptr, 1, end);\n \n+      if (compunit.cu_unit_type == DW_UT_split_compile\n+\t  || compunit.cu_unit_type == DW_UT_skeleton)\n+\t{\n+\t  uint64_t dwo_id;\n+\t  SAFE_BYTE_GET_AND_INC (dwo_id, hdrptr, 8, end);\n+\t}\n+\n       /* PR 17512: file: 001-108546-0.001:0.1.  */\n       if (compunit.cu_pointer_size < 2 || compunit.cu_pointer_size > 8)\n \t{\n@@ -3800,7 +3814,9 @@ process_debug_info (struct dwarf_section *           section,\n \n       if (compunit.cu_unit_type != DW_UT_compile\n \t  && compunit.cu_unit_type != DW_UT_partial\n-\t  && compunit.cu_unit_type != DW_UT_type)\n+\t  && compunit.cu_unit_type != DW_UT_type\n+\t  && compunit.cu_unit_type != DW_UT_split_compile\n+\t  && compunit.cu_unit_type != DW_UT_skeleton)\n \t{\n \t  warn (_(\"CU at offset %s contains corrupt or \"\n \t\t  \"unsupported unit type: %d.\\n\"),"
    }
  ]
}