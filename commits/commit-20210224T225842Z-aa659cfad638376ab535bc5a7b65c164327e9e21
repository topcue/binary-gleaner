{
  "sha": "aa659cfad638376ab535bc5a7b65c164327e9e21",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YWE2NTljZmFkNjM4Mzc2YWI1MzViYzVhN2I2NWMxNjQzMjdlOWUyMQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-02-24T22:58:42Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-02-24T22:58:42Z"
    },
    "message": "[gdb/symtab] Handle DW_AT_decl_file with form DW_FORM_implicit_const\n\nWith test-case gdb.cp/temargs.exp on target board \\\nunix/gdb:debug_flags=-gdwarf-5 I run into:\n...\n(gdb) info addr I^M\nERROR: GDB process no longer exists\nGDB process exited with wait status 32286 exp19 0 0 CHILDKILLED SIGABRT SIGABRT\nUNRESOLVED: gdb.cp/temargs.exp: test address of I in templ_m\n...\n\nThis is a regression since commit 529908cbd0a \"Remove DW_UNSND\".\n\nThe problem is that this DW_AT_decl_file:\n...\n <1><221>: Abbrev Number: 4 (DW_TAG_structure_type)\n    <222>   DW_AT_name        : Base<double, 23, (& a_global), &S::f>\n    <226>   DW_AT_byte_size   : 1\n    <226>   DW_AT_decl_file   : 1\n    <226>   DW_AT_decl_line   : 30\n    <227>   DW_AT_sibling     : <0x299>\n...\nis not read by this code in new_symbol:\n....\n      attr = dwarf2_attr (die,\n                          inlined_func ? DW_AT_call_file : DW_AT_decl_file,\n                          cu);\n      if (attr != nullptr && attr->form_is_unsigned ())\n...\nbecause DW_AT_decl_file has form DW_FORM_implicit_const:\n...\n   4      DW_TAG_structure_type    [has children]\n    DW_AT_name         DW_FORM_strp\n    DW_AT_byte_size    DW_FORM_implicit_const: 1\n    DW_AT_decl_file    DW_FORM_implicit_const: 1\n    DW_AT_decl_line    DW_FORM_data1\n    DW_AT_sibling      DW_FORM_ref4\n    DW_AT value: 0     DW_FORM value: 0\n...\nwhich is a signed LEB128, so attr->form_is_unsigned () returns false.\n\nFix this by introducing new functions is_nonnegative and as_nonnegative, and\nuse these instead of form_is_unsigned and as_unsigned.\n\nTested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2021-02-24  Tom de Vries  <tdevries@suse.de>\n\n\tPR symtab/27336\n\t* dwarf2/attribute.c (attribute::form_is_signed): New function\n\tfactored out of ...\n\t* dwarf2/attribute.h (attribute::as_signed): ... here.\n\t(attribute::is_nonnegative, attribute::as_nonnegative): New function.\n\t(attribute::form_is_signed): Declare.\n\t* dwarf2/read.c (new_symbol): Use is_nonnegative and as_nonnegative\n\tfor DW_AT_decl_file.",
    "tree": {
      "sha": "5b0b06a659dfcaa6c02c9cf12003687abb7b4915",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5b0b06a659dfcaa6c02c9cf12003687abb7b4915"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/aa659cfad638376ab535bc5a7b65c164327e9e21",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa659cfad638376ab535bc5a7b65c164327e9e21",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/aa659cfad638376ab535bc5a7b65c164327e9e21",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa659cfad638376ab535bc5a7b65c164327e9e21/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "268c77c1b0cc5d82c894af6e3e4f040c1bd4644e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/268c77c1b0cc5d82c894af6e3e4f040c1bd4644e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/268c77c1b0cc5d82c894af6e3e4f040c1bd4644e"
    }
  ],
  "stats": {
    "total": 50,
    "additions": 47,
    "deletions": 3
  },
  "files": [
    {
      "sha": "2ca7d3c6a05380193a3412d72b6639fd5676caec",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=aa659cfad638376ab535bc5a7b65c164327e9e21",
      "patch": "@@ -1,3 +1,14 @@\n+2021-02-24  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR symtab/27336\n+\t* dwarf2/attribute.c (attribute::form_is_signed): New function\n+\tfactored out of ...\n+\t* dwarf2/attribute.h (attribute::as_signed): ... here.\n+\t(attribute::is_nonnegative, attribute::as_nonnegative): New function.\n+\t(attribute::form_is_signed): Declare.\n+\t* dwarf2/read.c (new_symbol): Use is_nonnegative and as_nonnegative\n+\tfor DW_AT_decl_file.\n+\n 2021-02-24  Kevin Buettner  <kevinb@redhat.com>\n \n \t* nat/aarch64-linux-hw-point.c: Add comment regarding include"
    },
    {
      "sha": "6b8d5419178f313402e558e463b5df8bb2aad840",
      "filename": "gdb/dwarf2/attribute.c",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/dwarf2/attribute.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/dwarf2/attribute.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/attribute.c?ref=aa659cfad638376ab535bc5a7b65c164327e9e21",
      "patch": "@@ -189,6 +189,14 @@ attribute::form_is_unsigned () const\n \n /* See attribute.h.  */\n \n+bool\n+attribute::form_is_signed () const\n+{\n+  return form == DW_FORM_sdata || form == DW_FORM_implicit_const;\n+}\n+\n+/* See attribute.h.  */\n+\n bool\n attribute::form_requires_reprocessing () const\n {"
    },
    {
      "sha": "0af74704598b03961ea0c23f2ce71b362e5d5b46",
      "filename": "gdb/dwarf2/attribute.h",
      "status": "modified",
      "additions": 26,
      "deletions": 1,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/dwarf2/attribute.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/dwarf2/attribute.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/attribute.h?ref=aa659cfad638376ab535bc5a7b65c164327e9e21",
      "patch": "@@ -70,7 +70,7 @@ struct attribute\n      form.  */\n   LONGEST as_signed () const\n   {\n-    gdb_assert (form == DW_FORM_sdata || form == DW_FORM_implicit_const);\n+    gdb_assert (form_is_signed ());\n     return u.snd;\n   }\n \n@@ -92,6 +92,28 @@ struct attribute\n     return u.unsnd;\n   }\n \n+  /* Return true if the value is nonnegative.  Requires that that\n+     reprocessing not be needed.  */\n+  bool is_nonnegative () const\n+  {\n+    if (form_is_unsigned ())\n+      return true;\n+    if (form_is_signed ())\n+      return as_signed () >= 0;\n+    return false;\n+  }\n+\n+  /* Return the nonnegative value.  Requires that that reprocessing not be\n+     needed.  */\n+  ULONGEST as_nonnegative () const\n+  {\n+    if (form_is_unsigned ())\n+      return as_unsigned ();\n+    if (form_is_signed ())\n+      return (ULONGEST)as_signed ();\n+    gdb_assert (false);\n+  }\n+\n   /* Return non-zero if ATTR's value is a section offset --- classes\n      lineptr, loclistptr, macptr or rangelistptr --- or zero, otherwise.\n      You may use the as_unsigned method to retrieve such offsets.\n@@ -147,6 +169,9 @@ struct attribute\n   /* Check if the attribute's form is an unsigned integer form.  */\n   bool form_is_unsigned () const;\n \n+  /* Check if the attribute's form is a signed integer form.  */\n+  bool form_is_signed () const;\n+\n   /* Check if the attribute's form is a form that requires\n      \"reprocessing\".  */\n   bool form_requires_reprocessing () const;"
    },
    {
      "sha": "df7dd16291f6c858d3c0130c4565e3d0bd71d949",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/aa659cfad638376ab535bc5a7b65c164327e9e21/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=aa659cfad638376ab535bc5a7b65c164327e9e21",
      "patch": "@@ -22225,10 +22225,10 @@ new_symbol (struct die_info *die, struct type *type, struct dwarf2_cu *cu,\n       attr = dwarf2_attr (die,\n \t\t\t  inlined_func ? DW_AT_call_file : DW_AT_decl_file,\n \t\t\t  cu);\n-      if (attr != nullptr && attr->form_is_unsigned ())\n+      if (attr != nullptr && attr->is_nonnegative ())\n \t{\n \t  file_name_index file_index\n-\t    = (file_name_index) attr->as_unsigned ();\n+\t    = (file_name_index) attr->as_nonnegative ();\n \t  struct file_entry *fe;\n \n \t  if (cu->line_header != NULL)"
    }
  ]
}