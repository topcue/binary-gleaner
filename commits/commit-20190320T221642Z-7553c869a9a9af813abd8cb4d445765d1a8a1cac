{
  "sha": "7553c869a9a9af813abd8cb4d445765d1a8a1cac",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzU1M2M4NjlhOWE5YWY4MTNhYmQ4Y2I0ZDQ0NTc2NWQxYThhMWNhYw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-03-19T22:50:55Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-03-20T22:16:42Z"
    },
    "message": "Teach a few targets to resolve BFD_RELOC_8\n\nand tidy \"forward\" test.  I've removed some checks in d30v\nmd_apply_fix that have no business being there.  Any symbol problems\nwill be caught later in tc_gen_reloc, and overflow checking is done in\ngas/write.c.\n\n\t* config/tc-d10v.c (md_apply_fix): Apply BFD_RELOC_8.\n\t* config/tc-pdp11.c (md_apply_fix): Likewise.\n\t* config/tc-d30v.c (md_apply_fix): Don't emit errors for BFD_RELOC_8,\n\tBFD_RELOC_16, and BFD_RELOC_64.\n\t* testsuite/gas/all/gas.exp: Move target exclusions for forward\n\ttest, but not cr16, to..\n\t* testsuite/gas/all/forward.d: ..here, with explanation.  Remove\n\td10v, d30v, and pdp11 xfails.",
    "tree": {
      "sha": "302625829d122ca82dd3df74efb3ebf8b7f1cd48",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/302625829d122ca82dd3df74efb3ebf8b7f1cd48"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7553c869a9a9af813abd8cb4d445765d1a8a1cac",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7553c869a9a9af813abd8cb4d445765d1a8a1cac",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7553c869a9a9af813abd8cb4d445765d1a8a1cac",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7553c869a9a9af813abd8cb4d445765d1a8a1cac/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "3b6c19668236e6fd60c6299e7d016396d645fa61",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3b6c19668236e6fd60c6299e7d016396d645fa61",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/3b6c19668236e6fd60c6299e7d016396d645fa61"
    }
  ],
  "stats": {
    "total": 84,
    "additions": 38,
    "deletions": 46
  },
  "files": [
    {
      "sha": "46a54f78ddd2f913c6f453e2be9e980f106bacb1",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=7553c869a9a9af813abd8cb4d445765d1a8a1cac",
      "patch": "@@ -1,3 +1,14 @@\n+2019-03-21  Alan Modra  <amodra@gmail.com>\n+\n+\t* config/tc-d10v.c (md_apply_fix): Apply BFD_RELOC_8.\n+\t* config/tc-pdp11.c (md_apply_fix): Likewise.\n+\t* config/tc-d30v.c (md_apply_fix): Don't emit errors for BFD_RELOC_8,\n+\tBFD_RELOC_16, and BFD_RELOC_64.\n+\t* testsuite/gas/all/gas.exp: Move target exclusions for forward\n+\ttest, but not cr16, to..\n+\t* testsuite/gas/all/forward.d: ..here, with explanation.  Remove\n+\td10v, d30v, and pdp11 xfails.\n+\n 2019-03-19  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* config/tc-i386.c (optimize_encoding): Don't check AVX for"
    },
    {
      "sha": "9f6c82e1f94de8b04b035a0e1e2403d3d8f1cbcf",
      "filename": "gas/config/tc-d10v.c",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/config/tc-d10v.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/config/tc-d10v.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-d10v.c?ref=7553c869a9a9af813abd8cb4d445765d1a8a1cac",
      "patch": "@@ -1580,6 +1580,9 @@ md_apply_fix (fixS *fixP, valueT *valP, segT seg ATTRIBUTE_UNUSED)\n     case BFD_RELOC_16:\n       bfd_putb16 ((bfd_vma) value, (unsigned char *) where);\n       break;\n+    case BFD_RELOC_8:\n+      *where = value;\n+      break;\n \n     case BFD_RELOC_VTABLE_INHERIT:\n     case BFD_RELOC_VTABLE_ENTRY:"
    },
    {
      "sha": "086215e306e32c92efe9f928e131f98fe157146e",
      "filename": "gas/config/tc-d30v.c",
      "status": "modified",
      "additions": 7,
      "deletions": 27,
      "changes": 34,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/config/tc-d30v.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/config/tc-d30v.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-d30v.c?ref=7553c869a9a9af813abd8cb4d445765d1a8a1cac",
      "patch": "@@ -1918,37 +1918,17 @@ md_apply_fix (fixS *fixP, valueT *valP, segT seg ATTRIBUTE_UNUSED)\n \n   switch (fixP->fx_r_type)\n     {\n-    case BFD_RELOC_8:  /* Check for a bad .byte directive.  */\n-      if (fixP->fx_addsy != NULL)\n-\tas_bad (_(\"line %d: unable to place address of symbol '%s' into a byte\"),\n-\t\tfixP->fx_line, S_GET_NAME (fixP->fx_addsy));\n-      else if (((unsigned)value) > 0xff)\n-\tas_bad (_(\"line %d: unable to place value %lx into a byte\"),\n-\t\tfixP->fx_line, value);\n-      else\n-\t*(unsigned char *) where = value;\n+    case BFD_RELOC_8:\n+      *(unsigned char *) where = value;\n       break;\n \n-    case BFD_RELOC_16:  /* Check for a bad .short directive.  */\n-      if (fixP->fx_addsy != NULL)\n-\tas_bad (_(\"line %d: unable to place address of symbol '%s' into a short\"),\n-\t\tfixP->fx_line, S_GET_NAME (fixP->fx_addsy));\n-      else if (((unsigned)value) > 0xffff)\n-\tas_bad (_(\"line %d: unable to place value %lx into a short\"),\n-\t\tfixP->fx_line, value);\n-      else\n-\tbfd_putb16 ((bfd_vma) value, (unsigned char *) where);\n+    case BFD_RELOC_16:\n+      bfd_putb16 ((bfd_vma) value, (unsigned char *) where);\n       break;\n \n-    case BFD_RELOC_64:  /* Check for a bad .quad directive.  */\n-      if (fixP->fx_addsy != NULL)\n-\tas_bad (_(\"line %d: unable to place address of symbol '%s' into a quad\"),\n-\t\tfixP->fx_line, S_GET_NAME (fixP->fx_addsy));\n-      else\n-\t{\n-\t  bfd_putb32 ((bfd_vma) value, (unsigned char *) where);\n-\t  bfd_putb32 (0, ((unsigned char *) where) + 4);\n-\t}\n+    case BFD_RELOC_64:\n+      bfd_putb32 ((bfd_vma) value, (unsigned char *) where);\n+      bfd_putb32 (0, ((unsigned char *) where) + 4);\n       break;\n \n     case BFD_RELOC_D30V_6:"
    },
    {
      "sha": "1be07eaf5938ea2b3c6be0336923f1973bee0784",
      "filename": "gas/config/tc-pdp11.c",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/config/tc-pdp11.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/config/tc-pdp11.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-pdp11.c?ref=7553c869a9a9af813abd8cb4d445765d1a8a1cac",
      "patch": "@@ -248,6 +248,10 @@ md_apply_fix (fixS *fixP,\n \n   switch (fixP->fx_r_type)\n     {\n+    case BFD_RELOC_8:\n+      mask = 0xff;\n+      shift = 0;\n+      break;\n     case BFD_RELOC_16:\n     case BFD_RELOC_16_PCREL:\n       mask = 0xffff;"
    },
    {
      "sha": "d921ec517bed9c6c5e14068838fbcba2582c88e7",
      "filename": "gas/testsuite/gas/all/forward.d",
      "status": "modified",
      "additions": 12,
      "deletions": 2,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/testsuite/gas/all/forward.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/testsuite/gas/all/forward.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/forward.d?ref=7553c869a9a9af813abd8cb4d445765d1a8a1cac",
      "patch": "@@ -1,7 +1,17 @@\n #objdump: -s -j .data\n #name: forward references\n-# Some targets don't manage to resolve BFD_RELOC_8 for constants.\n-#xfail: *c30-*-* *c4x-*-* d10v-*-* d30v-*-* pdp11-*-*\n+# tic30 and tic4x have 4 octets per byte, tic54x has 2 octets per byte\n+#notarget: *c30-*-* *c4x-*-* *c54x-*-*\n+# hppa uses non-standard .equ syntax\n+#notarget: hppa*-*-*\n+# linkrelax targets should really resolve the relocs in this test but some\n+# choose to emit them even though the relocs are in .data, leading to\n+# \"redefined symbol cannot be used on reloc\".\n+#xfail: am33*-*-* crx*-*-* h8300*-*-* mn10200*-*-* mn10300*-*-*\n+# mep and microblaze use complex relocs and don't resolve the relocs.\n+# one of the relocs references minus_one, which is a bug, but no one\n+# seems bothered enough to fix this.\n+#xfail: mep-*-* microblaze-*-*\n \n .*: .*\n "
    },
    {
      "sha": "9ea95c62a9e703d77e126725f5587d2bdeadf5c8",
      "filename": "gas/testsuite/gas/all/gas.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 17,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/testsuite/gas/all/gas.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7553c869a9a9af813abd8cb4d445765d1a8a1cac/gas/testsuite/gas/all/gas.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/gas.exp?ref=7553c869a9a9af813abd8cb4d445765d1a8a1cac",
      "patch": "@@ -99,23 +99,7 @@ if { ![istarget \"bfin-*-*\"] } then {\n gas_test_error \"assign-bad.s\" \"\" \"== assignment for symbol already set\"\n \n run_dump_test simple-forward\n-\n-# .equ works differently on some targets.\n-# linkrelax-ing prevents most forward references from working.\n-case $target_triplet in {\n-    { am3*-*-* } { }\n-    { *c54x*-*-* } { }\n-    { cr16*-*-* } { }\n-    { crx*-*-* } { }\n-    { h8300*-*-* } { }\n-    { hppa*-*-* } { }\n-    { mep-*-* } { }\n-    { microblaze-*-* } { }\n-    { mn10\\[23\\]00*-*-* } { }\n-    default {\n-\trun_dump_test forward\n-    }\n-}\n+run_dump_test forward\n \n # aout relocs are often weird, so is mep. don't bother testing\n # som doesn't use a .text section"
    }
  ]
}