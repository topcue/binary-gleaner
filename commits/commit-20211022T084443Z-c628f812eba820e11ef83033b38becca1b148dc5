{
  "sha": "c628f812eba820e11ef83033b38becca1b148dc5",
  "node_id": "C_kwDOANOeidoAKGM2MjhmODEyZWJhODIwZTExZWY4MzAzM2IzOGJlY2NhMWIxNDhkYzU",
  "commit": {
    "author": {
      "name": "Lewis Revill",
      "email": "lewis.revill@embecosm.com",
      "date": "2021-10-22T03:32:46Z"
    },
    "committer": {
      "name": "Nelson Chu",
      "email": "nelson.chu@sifive.com",
      "date": "2021-10-22T08:44:43Z"
    },
    "message": "RISC-V: Added ld testcase for pcgp relaxation.\n\nConsider the the pcgp-relax-02 testcase,\n\n        .text\n        .globl _start\n_start:\n.L1:    auipc   a0, %pcrel_hi(data_a)\n.L2:    auipc   a1, %pcrel_hi(data_b)\n        addi    a0, a0, %pcrel_lo(.L1)\n        addi    a1, a1, %pcrel_lo(.L2)\n\n        .data\n        .word 0x0\n        .globl data_a\ndata_a:\n        .word 0x1\n\n        .section .rodata\n        .globl data_b\ndata_b:\n        .word 0x2\n\nIf the first auipc is deleted, but we are still building the pcgp\ntable (connect the high and low pcrel relocations), then there is\nan aliasing issue that we need some way to disambiguate which of\nthe two symbols we are targeting.  Therefore, Palmer thought of a\nway to use R_RISCV_DELETE to split this into two phases, so we\ncould resolve the addresses before creating the ambiguities.\n\nThis patch just add the ld testcase for the above case, in case we\nhave changed something but break this.\n\nld/\n\t* testsuite/ld-riscv-elf/ld-riscv-elf.exp: Renamed pcgp-relax\n\tto pcgp-relax-01, and added pcgp-relax-02.\n\t* testsuite/ld-riscv-elf/pcgp-relax-01.d: Renmaed from pcgp-relax.\n\t* testsuite/ld-riscv-elf/pcgp-relax-01.s: Likewise.\n\t* testsuite/ld-riscv-elf/pcgp-relax-02.d: New testcase.\n\t* testsuite/ld-riscv-elf/pcgp-relax-02.s: Likewise.",
    "tree": {
      "sha": "12eda3d5fda0a27c206bf9afda4010c2282f72aa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/12eda3d5fda0a27c206bf9afda4010c2282f72aa"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c628f812eba820e11ef83033b38becca1b148dc5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c628f812eba820e11ef83033b38becca1b148dc5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c628f812eba820e11ef83033b38becca1b148dc5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c628f812eba820e11ef83033b38becca1b148dc5/comments",
  "author": {
    "login": "lewis-revill",
    "id": 40796884,
    "node_id": "MDQ6VXNlcjQwNzk2ODg0",
    "avatar_url": "https://avatars.githubusercontent.com/u/40796884?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lewis-revill",
    "html_url": "https://github.com/lewis-revill",
    "followers_url": "https://api.github.com/users/lewis-revill/followers",
    "following_url": "https://api.github.com/users/lewis-revill/following{/other_user}",
    "gists_url": "https://api.github.com/users/lewis-revill/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lewis-revill/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lewis-revill/subscriptions",
    "organizations_url": "https://api.github.com/users/lewis-revill/orgs",
    "repos_url": "https://api.github.com/users/lewis-revill/repos",
    "events_url": "https://api.github.com/users/lewis-revill/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lewis-revill/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": null,
  "parents": [
    {
      "sha": "9abcdc10b21ed9f98e218ead7ac9d91612f9ed0f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9abcdc10b21ed9f98e218ead7ac9d91612f9ed0f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9abcdc10b21ed9f98e218ead7ac9d91612f9ed0f"
    }
  ],
  "stats": {
    "total": 38,
    "additions": 36,
    "deletions": 2
  },
  "files": [
    {
      "sha": "78a71345bf288fc0c1be64168f4c1b12f496d51e",
      "filename": "ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/ld-riscv-elf.exp?ref=c628f812eba820e11ef83033b38becca1b148dc5",
      "patch": "@@ -121,7 +121,8 @@ proc run_relax_twice_test {} {\n if [istarget \"riscv*-*-*\"] {\n     run_dump_test \"align-small-region\"\n     run_dump_test \"call-relax\"\n-    run_dump_test \"pcgp-relax\"\n+    run_dump_test \"pcgp-relax-01\"\n+    run_dump_test \"pcgp-relax-02\"\n     run_dump_test \"c-lui\"\n     run_dump_test \"c-lui-2\"\n     run_dump_test \"disas-jalr\""
    },
    {
      "sha": "f9425678559f7eacdfb222b9de198470d6894090",
      "filename": "ld/testsuite/ld-riscv-elf/pcgp-relax-01.d",
      "status": "renamed",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-01.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-01.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/pcgp-relax-01.d?ref=c628f812eba820e11ef83033b38becca1b148dc5",
      "patch": "@@ -1,4 +1,4 @@\n-#source: pcgp-relax.s\n+#source: pcgp-relax-01.s\n #ld: --relax\n #objdump: -d -Mno-aliases\n ",
      "previous_filename": "ld/testsuite/ld-riscv-elf/pcgp-relax.d"
    },
    {
      "sha": "fab6a5bf140b01726d07f8169fa75761b21082eb",
      "filename": "ld/testsuite/ld-riscv-elf/pcgp-relax-01.s",
      "status": "renamed",
      "additions": 0,
      "deletions": 0,
      "changes": 0,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-01.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-01.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/pcgp-relax-01.s?ref=c628f812eba820e11ef83033b38becca1b148dc5",
      "previous_filename": "ld/testsuite/ld-riscv-elf/pcgp-relax.s"
    },
    {
      "sha": "c6c73c5426565ff64feecf2bd914cb78b700a07b",
      "filename": "ld/testsuite/ld-riscv-elf/pcgp-relax-02.d",
      "status": "added",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-02.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-02.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/pcgp-relax-02.d?ref=c628f812eba820e11ef83033b38becca1b148dc5",
      "patch": "@@ -0,0 +1,15 @@\n+#source: pcgp-relax-02.s\n+#as:\n+#ld: --relax\n+#objdump: -d\n+\n+.*:[ \t]+file format .*\n+\n+\n+Disassembly of section .text:\n+\n+[0-9a-f]+ <_start>:\n+.*:[ \t]+[0-9a-f]+[ \t]+auipc[ \t]+a1.*\n+.*:[ \t]+[0-9a-f]+[ \t]+addi[ \t]+a0,gp.*<data_a>\n+.*:[ \t]+[0-9a-f]+[ \t]+addi[ \t]+a1,a1.*<data_b>\n+#pass"
    },
    {
      "sha": "ca4aa1fa9d2edf26c51c695686736a03d5a83702",
      "filename": "ld/testsuite/ld-riscv-elf/pcgp-relax-02.s",
      "status": "added",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-02.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c628f812eba820e11ef83033b38becca1b148dc5/ld/testsuite/ld-riscv-elf/pcgp-relax-02.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-riscv-elf/pcgp-relax-02.s?ref=c628f812eba820e11ef83033b38becca1b148dc5",
      "patch": "@@ -0,0 +1,18 @@\n+\t.text\n+\t.globl _start\n+_start:\n+.L1:\tauipc\ta0, %pcrel_hi(data_a)\n+.L2:\tauipc\ta1, %pcrel_hi(data_b)\n+\taddi\ta0, a0, %pcrel_lo(.L1)\n+\taddi\ta1, a1, %pcrel_lo(.L2)\n+\n+\t.data\n+\t.word 0x0\n+\t.globl data_a\n+data_a:\n+\t.word 0x1\n+\n+\t.section .rodata\n+\t.globl data_b\n+data_b:\n+\t.word 0x2"
    }
  ]
}