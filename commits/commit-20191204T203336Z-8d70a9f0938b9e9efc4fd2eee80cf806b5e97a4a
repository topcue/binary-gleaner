{
  "sha": "8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGQ3MGE5ZjA5MzhiOWU5ZWZjNGZkMmVlZTgwY2Y4MDZiNWU5N2E0YQ==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-11-27T21:51:35Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-12-04T20:33:36Z"
    },
    "message": "gdb/testsuite: Use -J option when compiling Fortran tests\n\nWhen compiling Fortran tests (e.g. gdb.fortran/info-modules.exp), the\nFotran compile produces .mod files.  These files contain details of\ncompiled modules that are then consumed by the compiler when compiling\nother files that USE a module.\n\nCurrently the compiler writes the .mod files into its current\ndirectory, so for us this turns out to be 'build/gdb/testsuite/'.\nThis means that .mod files can be shared between tests, which seems\nagainst the spirit of the GDB testsuite; source files should be\ncompiled fresh for each test.\n\nThis commit adds the -J option to the compiler flags whenever we\ncompile a Fortran file, this option tells the compiler where to write,\nand look for, .mod files.\n\nAfter this commit there was one Fortran test that needed fixing, with\nthat fix in place all of the Fortran tests pass again, but now the\n.mod files are now produced in the per-test output directories.\n\ngdb/testsuite/ChangeLog:\n\n\t* lib/gdb.exp (gdb_compile): Add -J compiler option when building\n\tFortran tests.\n\t* gdb.mi/mi-fortran-modules.exp: Compile source files in correct\n\torder.\n\nChange-Id: I99444cf22d80e320093d3f3ed9abb8825f378e0b",
    "tree": {
      "sha": "584e907b844f8dceaab4c3be0c2a6fbe84cb6cb8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/584e907b844f8dceaab4c3be0c2a6fbe84cb6cb8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "36c8fb93c9d4135ce3c1561f5f3886b1b0bf31f6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/36c8fb93c9d4135ce3c1561f5f3886b1b0bf31f6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/36c8fb93c9d4135ce3c1561f5f3886b1b0bf31f6"
    }
  ],
  "stats": {
    "total": 19,
    "additions": 18,
    "deletions": 1
  },
  "files": [
    {
      "sha": "173e82d59644f63b642fcd4c062e1b8431df292f",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
      "patch": "@@ -1,3 +1,10 @@\n+2019-12-04  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* lib/gdb.exp (gdb_compile): Add -J compiler option when building\n+\tFortran tests.\n+\t* gdb.mi/mi-fortran-modules.exp: Compile source files in correct\n+\torder.\n+\n 2019-12-04  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.fortran/type-kinds.exp (test_cast_1_to_type_kind): Handle"
    },
    {
      "sha": "df48324784b2f2886697a9f808a2daf968c33cd8",
      "filename": "gdb/testsuite/gdb.mi/mi-fortran-modules.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/gdb/testsuite/gdb.mi/mi-fortran-modules.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/gdb/testsuite/gdb.mi/mi-fortran-modules.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-fortran-modules.exp?ref=8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
      "patch": "@@ -22,7 +22,7 @@ set MIFLAGS \"-i=mi\"\n standard_testfile \"mi-fortran-modules.f90\" \"mi-fortran-modules-2.f90\"\n \n if {[prepare_for_testing \"failed to prepare\" ${testfile} \\\n-\t [list $srcfile $srcfile2] {debug f90}]} {\n+\t [list $srcfile2 $srcfile] {debug f90}]} {\n     return -1\n }\n "
    },
    {
      "sha": "aa774462d25f51d2186eb98227350d18ca5544ed",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=8d70a9f0938b9e9efc4fd2eee80cf806b5e97a4a",
      "patch": "@@ -3719,6 +3719,16 @@ proc gdb_compile {source dest type options} {\n     } else {\n \tset new_options [universal_compile_options]\n     }\n+\n+    # Place (and look for) Fortran `.mod` files in the output\n+    # directory for this specific test.\n+    if {[lsearch -exact $options f77] != -1 \\\n+\t    || [lsearch -exact $options f90] != -1 } {\n+\t# Fortran compile.\n+\tset mod_path [standard_output_file \"\"]\n+\tlappend new_options \"additional_flags=-J${mod_path}\"\n+    }\n+\n     set shlib_found 0\n     set shlib_load 0\n     set getting_compiler_info 0"
    }
  ]
}