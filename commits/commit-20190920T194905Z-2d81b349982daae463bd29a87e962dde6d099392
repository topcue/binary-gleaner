{
  "sha": "2d81b349982daae463bd29a87e962dde6d099392",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmQ4MWIzNDk5ODJkYWFlNDYzYmQyOWE4N2U5NjJkZGU2ZDA5OTM5Mg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-07-23T21:37:18Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-09-20T19:49:05Z"
    },
    "message": "Move \"fullname\" to tui_source_window\n\nThe \"fullname\" field in tui_source_window_base is only used by one\nsubclass.  This patch moves the field to that subclass, and changes it\nto be a unique_xmalloc_ptr.\n\ngdb/ChangeLog\n2019-09-20  Tom Tromey  <tom@tromey.com>\n\n\t* tui/tui-winsource.h (struct tui_source_window_base)\n\t<~tui_source_window_base>: Don't declare.\n\t<fullname>: Remove.\n\t* tui/tui-winsource.c (~tui_source_window_base): Remove.\n\t* tui/tui-source.h (struct tui_source_window) <fullname>: New\n\tmember.\n\t* tui/tui-source.c (tui_source_window::set_contents): Update.\n\t(tui_source_window::location_matches_p)\n\t(tui_source_window::maybe_update): Update.",
    "tree": {
      "sha": "4efcd03ec8aadf449b0efe2a1e5ad52def3021ad",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4efcd03ec8aadf449b0efe2a1e5ad52def3021ad"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2d81b349982daae463bd29a87e962dde6d099392",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2d81b349982daae463bd29a87e962dde6d099392",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2d81b349982daae463bd29a87e962dde6d099392",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2d81b349982daae463bd29a87e962dde6d099392/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f14bec587fd0b695bbb8dcfe92169b4dae76245d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f14bec587fd0b695bbb8dcfe92169b4dae76245d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f14bec587fd0b695bbb8dcfe92169b4dae76245d"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 19,
    "deletions": 13
  },
  "files": [
    {
      "sha": "9f7accd2f6a32adcec65227fdb3d9e618ffc341c",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2d81b349982daae463bd29a87e962dde6d099392/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2d81b349982daae463bd29a87e962dde6d099392/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=2d81b349982daae463bd29a87e962dde6d099392",
      "patch": "@@ -1,3 +1,15 @@\n+2019-09-20  Tom Tromey  <tom@tromey.com>\n+\n+\t* tui/tui-winsource.h (struct tui_source_window_base)\n+\t<~tui_source_window_base>: Don't declare.\n+\t<fullname>: Remove.\n+\t* tui/tui-winsource.c (~tui_source_window_base): Remove.\n+\t* tui/tui-source.h (struct tui_source_window) <fullname>: New\n+\tmember.\n+\t* tui/tui-source.c (tui_source_window::set_contents): Update.\n+\t(tui_source_window::location_matches_p)\n+\t(tui_source_window::maybe_update): Update.\n+\n 2019-09-20  Tom Tromey  <tom@tromey.com>\n \n \t* tui/tui-winsource.h (~tui_source_element): Remove."
    },
    {
      "sha": "f70e053bdb52d33eeb1bbf3c4225f08bfe406403",
      "filename": "gdb/tui/tui-source.c",
      "status": "modified",
      "additions": 3,
      "deletions": 4,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-source.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-source.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-source.c?ref=2d81b349982daae463bd29a87e962dde6d099392",
      "patch": "@@ -155,8 +155,7 @@ tui_source_window::set_contents (struct gdbarch *arch,\n \n \t  title = s_filename;\n \n-\t  xfree (fullname);\n-\t  fullname = xstrdup (symtab_to_fullname (s));\n+\t  fullname = make_unique_xstrdup (symtab_to_fullname (s));\n \n \t  cur_line = 0;\n \t  gdbarch = get_objfile_arch (SYMTAB_OBJFILE (s));\n@@ -276,7 +275,7 @@ tui_source_window::location_matches_p (struct bp_location *loc, int line_no)\n   return (content[line_no].line_or_addr.loa == LOA_LINE\n \t  && content[line_no].line_or_addr.u.line_no == loc->line_number\n \t  && loc->symtab != NULL\n-\t  && filename_cmp (fullname,\n+\t  && filename_cmp (fullname.get (),\n \t\t\t   symtab_to_fullname (loc->symtab)) == 0);\n }\n \n@@ -308,7 +307,7 @@ tui_source_window::maybe_update (struct frame_info *fi, symtab_and_line sal,\n     start_line = 1;\n \n   bool source_already_displayed = (sal.symtab != 0\n-\t\t\t\t   && showing_source_p (fullname));\n+\t\t\t\t   && showing_source_p (fullname.get ()));\n \n   struct tui_line_or_address l;\n "
    },
    {
      "sha": "30728e4214e4794ec7002e77c5a26c0b6ce69281",
      "filename": "gdb/tui/tui-source.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-source.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-source.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-source.h?ref=2d81b349982daae463bd29a87e962dde6d099392",
      "patch": "@@ -76,6 +76,9 @@ struct tui_source_window : public tui_source_window_base\n      in the current source window.  */\n   bool line_is_displayed (int line) const;\n \n+  /* It is the resolved form as returned by symtab_to_fullname.  */\n+  gdb::unique_xmalloc_ptr<char> fullname;\n+\n   /* A token used to register and unregister an observer.  */\n   gdb::observers::token m_observable;\n };"
    },
    {
      "sha": "8b507ed91264fcf7fd8ce567ebc168320bc0cfd9",
      "filename": "gdb/tui/tui-winsource.c",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-winsource.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-winsource.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-winsource.c?ref=2d81b349982daae463bd29a87e962dde6d099392",
      "patch": "@@ -261,11 +261,6 @@ tui_source_window_base::tui_source_window_base (enum tui_win_type type)\n }\n \n \n-tui_source_window_base::~tui_source_window_base ()\n-{\n-  xfree (fullname);\n-}  \n-\n /* See tui-data.h.  */\n \n void"
    },
    {
      "sha": "eca0bde4bb8c13c5c78c74202879fe8f84e0bffc",
      "filename": "gdb/tui/tui-winsource.h",
      "status": "modified",
      "additions": 1,
      "deletions": 4,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-winsource.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2d81b349982daae463bd29a87e962dde6d099392/gdb/tui/tui-winsource.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-winsource.h?ref=2d81b349982daae463bd29a87e962dde6d099392",
      "patch": "@@ -78,7 +78,7 @@ struct tui_source_window_base : public tui_win_info\n {\n protected:\n   explicit tui_source_window_base (enum tui_win_type type);\n-  ~tui_source_window_base () override;\n+\n   DISABLE_COPY_AND_ASSIGN (tui_source_window_base);\n \n   void do_scroll_horizontal (int num_to_scroll) override;\n@@ -137,9 +137,6 @@ struct tui_source_window_base : public tui_win_info\n   int horizontal_offset = 0;\n   struct tui_line_or_address start_line_or_addr;\n \n-  /* It is the resolved form as returned by symtab_to_fullname.  */\n-  char *fullname = nullptr;\n-\n   /* Architecture associated with code at this location.  */\n   struct gdbarch *gdbarch = nullptr;\n "
    }
  ]
}