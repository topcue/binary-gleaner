{
  "sha": "dfcb27e41d37b8bff178697f5f33ec288387fb01",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZGZjYjI3ZTQxZDM3YjhiZmYxNzg2OTdmNWYzM2VjMjg4Mzg3ZmIwMQ==",
  "commit": {
    "author": {
      "name": "Iain Buclaw",
      "email": "ibuclaw@gdcproject.org",
      "date": "2020-02-05T11:45:13Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-02-07T21:06:03Z"
    },
    "message": "Make fputs_unfiltered use fputs_maybe_filtered\n\nThis patch redefines fputs_unfiltered in utils.c, with new behavior to\nforward parameters to fputs_maybe_filtered.  This makes\nfputs_unfiltered identical to fputs_filtered, except filtering is\ndisabled.\n\nSome callers of fputs_unfiltered have been updated to use ui_file_puts\nwhere they were using other ui_file_* functions anyway for IO.\n\nThis fixes the problem I saw with \\032\\032post-prompt annotation being\nflushed to stdout in the wrong order.\n\n2020-02-05  Iain Buclaw  <ibuclaw@gdcproject.org>\n\n\tPR gdb/25190:\n        * gdb/remote-sim.c (gdb_os_write_stderr): Update.\n        * gdb/remote.c (remote_console_output): Update.\n        * gdb/ui-file.c (fputs_unfiltered): Rename to...\n        (ui_file_puts): ...this.\n        * gdb/ui-file.h (ui_file_puts): Add declaration.\n        * gdb/utils.c (emit_style_escape): Update.\n        (flush_wrap_buffer): Update.\n        (fputs_maybe_filtered): Update.\n        (fputs_unfiltered): Add function.\n\nChange-Id: I17ed5078f71208344f2f8ab634a6518b1af6e213",
    "tree": {
      "sha": "6148568d725dc2bb4e606cb3ec2540185cf6b125",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6148568d725dc2bb4e606cb3ec2540185cf6b125"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/dfcb27e41d37b8bff178697f5f33ec288387fb01",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dfcb27e41d37b8bff178697f5f33ec288387fb01",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/dfcb27e41d37b8bff178697f5f33ec288387fb01",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/dfcb27e41d37b8bff178697f5f33ec288387fb01/comments",
  "author": {
    "login": "ibuclaw",
    "id": 397929,
    "node_id": "MDQ6VXNlcjM5NzkyOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/397929?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ibuclaw",
    "html_url": "https://github.com/ibuclaw",
    "followers_url": "https://api.github.com/users/ibuclaw/followers",
    "following_url": "https://api.github.com/users/ibuclaw/following{/other_user}",
    "gists_url": "https://api.github.com/users/ibuclaw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ibuclaw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ibuclaw/subscriptions",
    "organizations_url": "https://api.github.com/users/ibuclaw/orgs",
    "repos_url": "https://api.github.com/users/ibuclaw/repos",
    "events_url": "https://api.github.com/users/ibuclaw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ibuclaw/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "faa17681ccf5b45a14424c184d867a390d9e8086",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/faa17681ccf5b45a14424c184d867a390d9e8086",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/faa17681ccf5b45a14424c184d867a390d9e8086"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 28,
    "deletions": 7
  },
  "files": [
    {
      "sha": "5448f83c415b874adb2613bcff2acc4371508493",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=dfcb27e41d37b8bff178697f5f33ec288387fb01",
      "patch": "@@ -1,3 +1,16 @@\n+2020-02-05  Iain Buclaw  <ibuclaw@gdcproject.org>\n+\n+\tPR gdb/25190:\n+        * gdb/remote-sim.c (gdb_os_write_stderr): Update.\n+        * gdb/remote.c (remote_console_output): Update.\n+        * gdb/ui-file.c (fputs_unfiltered): Rename to...\n+        (ui_file_puts): ...this.\n+        * gdb/ui-file.h (ui_file_puts): Add declaration.\n+        * gdb/utils.c (emit_style_escape): Update.\n+        (flush_wrap_buffer): Update.\n+        (fputs_maybe_filtered): Update.\n+        (fputs_unfiltered): Add function.\n+\n 2020-02-05  Iain Buclaw  <ibuclaw@gdcproject.org>\n \n         * gdb/event-loop.c (gdb_wait_for_event): Update."
    },
    {
      "sha": "b4fa69c84fc1d799dd21625231a6293d2c2d4dd2",
      "filename": "gdb/remote-sim.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/remote-sim.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/remote-sim.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote-sim.c?ref=dfcb27e41d37b8bff178697f5f33ec288387fb01",
      "patch": "@@ -375,7 +375,7 @@ gdb_os_write_stderr (host_callback *p, const char *buf, int len)\n     {\n       b[0] = buf[i];\n       b[1] = 0;\n-      fputs_unfiltered (b, gdb_stdtargerr);\n+      ui_file_puts (gdb_stdtargerr, b);\n     }\n   return len;\n }"
    },
    {
      "sha": "34a8a08f5624b4bc822df2d758352a5373e73b34",
      "filename": "gdb/remote.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/remote.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/remote.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote.c?ref=dfcb27e41d37b8bff178697f5f33ec288387fb01",
      "patch": "@@ -6845,7 +6845,7 @@ remote_console_output (const char *msg)\n \n       tb[0] = c;\n       tb[1] = 0;\n-      fputs_unfiltered (tb, gdb_stdtarg);\n+      ui_file_puts (gdb_stdtarg, tb);\n     }\n   ui_file_flush (gdb_stdtarg);\n }"
    },
    {
      "sha": "e42d203f1f0f7110133c13f89f34ad4df0f49615",
      "filename": "gdb/ui-file.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/ui-file.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/ui-file.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ui-file.c?ref=dfcb27e41d37b8bff178697f5f33ec288387fb01",
      "patch": "@@ -150,7 +150,7 @@ ui_file_read (struct ui_file *file, char *buf, long length_buf)\n }\n \n void\n-fputs_unfiltered (const char *buf, struct ui_file *file)\n+ui_file_puts (struct ui_file *file, const char *buf)\n {\n   file->puts (buf);\n }"
    },
    {
      "sha": "67685bdfa158b3bdddfda4db0e82920e052d7eae",
      "filename": "gdb/ui-file.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/ui-file.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/ui-file.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ui-file.h?ref=dfcb27e41d37b8bff178697f5f33ec288387fb01",
      "patch": "@@ -112,6 +112,8 @@ extern void ui_file_write_async_safe (struct ui_file *file, const char *buf,\n \n extern long ui_file_read (struct ui_file *file, char *buf, long length_buf);\n \n+extern void ui_file_puts (struct ui_file *file, const char *buf);\n+\n extern int gdb_console_fputs (const char *, FILE *);\n \n /* A std::string-based ui_file.  Can be used as a scratch buffer for"
    },
    {
      "sha": "d51008aa694ffd064c9c9ff43e17f5aa0f5207bf",
      "filename": "gdb/utils.c",
      "status": "modified",
      "additions": 10,
      "deletions": 4,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/utils.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/dfcb27e41d37b8bff178697f5f33ec288387fb01/gdb/utils.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/utils.c?ref=dfcb27e41d37b8bff178697f5f33ec288387fb01",
      "patch": "@@ -1405,7 +1405,7 @@ emit_style_escape (const ui_file_style &style,\n   if (stream == nullptr)\n     wrap_buffer.append (style.to_ansi ());\n   else\n-    fputs_unfiltered (style.to_ansi ().c_str (), stream);\n+    ui_file_puts (stream, style.to_ansi ().c_str ());\n }\n \n /* Set the current output style.  This will affect future uses of the\n@@ -1539,7 +1539,7 @@ flush_wrap_buffer (struct ui_file *stream)\n {\n   if (stream == gdb_stdout && !wrap_buffer.empty ())\n     {\n-      fputs_unfiltered (wrap_buffer.c_str (), stream);\n+      ui_file_puts (stream, wrap_buffer.c_str ());\n       wrap_buffer.clear ();\n     }\n }\n@@ -1697,7 +1697,7 @@ fputs_maybe_filtered (const char *linebuffer, struct ui_file *stream,\n       || top_level_interpreter ()->interp_ui_out ()->is_mi_like_p ())\n     {\n       flush_wrap_buffer (stream);\n-      fputs_unfiltered (linebuffer, stream);\n+      ui_file_puts (stream, linebuffer);\n       return;\n     }\n \n@@ -1797,7 +1797,7 @@ fputs_maybe_filtered (const char *linebuffer, struct ui_file *stream,\n \t      /* Now output indentation and wrapped string.  */\n \t      if (wrap_column)\n \t\t{\n-\t\t  fputs_unfiltered (wrap_indent, stream);\n+\t\t  ui_file_puts (stream, wrap_indent);\n \t\t  if (stream->can_emit_style_escape ())\n \t\t    emit_style_escape (save_style, stream);\n \t\t  /* FIXME, this strlen is what prevents wrap_indent from\n@@ -1835,6 +1835,12 @@ fputs_filtered (const char *linebuffer, struct ui_file *stream)\n   fputs_maybe_filtered (linebuffer, stream, 1);\n }\n \n+void\n+fputs_unfiltered (const char *linebuffer, struct ui_file *stream)\n+{\n+  fputs_maybe_filtered (linebuffer, stream, 0);\n+}\n+\n /* See utils.h.  */\n \n void"
    }
  ]
}