{
  "sha": "5fb4027fae1839cabbea75112c31bd89d46d2af0",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NWZiNDAyN2ZhZTE4MzljYWJiZWE3NTExMmMzMWJkODlkNDZkMmFmMA==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-10-22T15:23:25Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-10-22T15:23:25Z"
    },
    "message": "[gdb/symtab] Make find_block_in_blockvector more robust\n\nWhile working on PR25858 I noticed that the following trigger patch:\n...\n@@ -2918,6 +2918,7 @@ find_pc_sect_compunit_symtab\n          const struct blockvector *bv;\n\n          bv = COMPUNIT_BLOCKVECTOR (cust);\n+         (volatile int)blockvector_contains_pc (bv, pc);\n          b = BLOCKVECTOR_BLOCK (bv, GLOBAL_BLOCK);\n\n          if (BLOCK_START (b) <= pc\n...\ntriggers this assert, which checks that the returned block indeed\ncontains pc:\n...\n@@ -170,7 +170,10 @@ find_block_in_blockvector\n\n     {\n       b = BLOCKVECTOR_BLOCK (bl, bot);\n       if (BLOCK_END (b) > pc)\n-       return b;\n+       {\n+         gdb_assert (BLOCK_START (b) <= pc);\n+         return b;\n+       }\n       bot--;\n     }\n\n...\nwhen running test-case gdb.ada/bp_c_mixed_case.exp.\n\nIt's possible that the trigger patch breaks an undocumented invariant:  I've\ntried a build and test run without the trigger patch and did not manage to\ntrigger the assert.\n\nFor robustness-sake, fix the assert by bailing out if 'BLOCK_START (b) <= pc'\ndoesn't hold.\n\nTested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2020-10-22  Tom de Vries  <tdevries@suse.de>\n\n\t* block.c (find_block_in_blockvector): Make sure the returned block\n\tcontains pc.",
    "tree": {
      "sha": "574eaa3daf329dec86822491ef390c4b739233a0",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/574eaa3daf329dec86822491ef390c4b739233a0"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5fb4027fae1839cabbea75112c31bd89d46d2af0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5fb4027fae1839cabbea75112c31bd89d46d2af0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5fb4027fae1839cabbea75112c31bd89d46d2af0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5fb4027fae1839cabbea75112c31bd89d46d2af0/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4a636814934b4403baeffbf29af44ed3a3cb2962",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4a636814934b4403baeffbf29af44ed3a3cb2962",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4a636814934b4403baeffbf29af44ed3a3cb2962"
    }
  ],
  "stats": {
    "total": 7,
    "additions": 7,
    "deletions": 0
  },
  "files": [
    {
      "sha": "76c5e9e8af3cf856acfe99cf294947b3248245cf",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5fb4027fae1839cabbea75112c31bd89d46d2af0/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5fb4027fae1839cabbea75112c31bd89d46d2af0/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5fb4027fae1839cabbea75112c31bd89d46d2af0",
      "patch": "@@ -1,3 +1,8 @@\n+2020-10-22  Tom de Vries  <tdevries@suse.de>\n+\n+\t* block.c (find_block_in_blockvector): Make sure the returned block\n+\tcontains pc.\n+\n 2020-10-22  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \tPR gdb/26693"
    },
    {
      "sha": "070d3f77697778ab49e29cf0aba580b57bac2822",
      "filename": "gdb/block.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5fb4027fae1839cabbea75112c31bd89d46d2af0/gdb/block.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5fb4027fae1839cabbea75112c31bd89d46d2af0/gdb/block.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/block.c?ref=5fb4027fae1839cabbea75112c31bd89d46d2af0",
      "patch": "@@ -166,6 +166,8 @@ find_block_in_blockvector (const struct blockvector *bl, CORE_ADDR pc)\n   while (bot >= STATIC_BLOCK)\n     {\n       b = BLOCKVECTOR_BLOCK (bl, bot);\n+      if (!(BLOCK_START (b) <= pc))\n+\treturn NULL;\n       if (BLOCK_END (b) > pc)\n \treturn b;\n       bot--;"
    }
  ]
}