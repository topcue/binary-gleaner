{
  "sha": "09a7e912932db766d5e6badfcba61c55f185503a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDlhN2U5MTI5MzJkYjc2NmQ1ZTZiYWRmY2JhNjFjNTVmMTg1NTAzYQ==",
  "commit": {
    "author": {
      "name": "Claudiu Zissulescu",
      "email": "claziss@synopsys.com",
      "date": "2021-09-14T09:10:54Z"
    },
    "committer": {
      "name": "Claudiu Zissulescu",
      "email": "claziss@synopsys.com",
      "date": "2021-09-14T09:10:54Z"
    },
    "message": "arc: Fix potential invalid pointer access when fixing got symbols.\n\nWhen statically linking, it can arrive to an undefined weak symbol of\nwhich its value cannot be determined. However, we are having pieces of\ncode which doesn't take this situation into account, leading to access\na structure which may not be initialized. Fix this situation and add a\ntest.\n\nbfd/\nxxxx-xx-xx  Cupertino Miranda  <cmiranda@synopsys.com>\n            Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* arc-got.h (arc_static_sym_data): New structure.\n\t(get_static_sym_data): New function.\n\t(relocate_fix_got_relocs_for_got_info): Move the computation fo\n\tsymbol value and section to above introduced function, and use\n\tthis new function.\n\nld/testsuite/\nxxxx-xx-xx  Claudiu Zissulescu  <claziss@synopsys.com>\n\n\t* ld-arc/got-weak.d: New file.\n\t* ld-arc/got-weak.s: Likewise.\n\nSigned-off-by: Claudiu Zissulescu <claziss@synopsys.com>\n\nfix",
    "tree": {
      "sha": "9e0d738f0382a4cedf8423afe9bef0315070ce75",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/9e0d738f0382a4cedf8423afe9bef0315070ce75"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/09a7e912932db766d5e6badfcba61c55f185503a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/09a7e912932db766d5e6badfcba61c55f185503a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/09a7e912932db766d5e6badfcba61c55f185503a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/09a7e912932db766d5e6badfcba61c55f185503a/comments",
  "author": {
    "login": "claziss",
    "id": 2761368,
    "node_id": "MDQ6VXNlcjI3NjEzNjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/claziss",
    "html_url": "https://github.com/claziss",
    "followers_url": "https://api.github.com/users/claziss/followers",
    "following_url": "https://api.github.com/users/claziss/following{/other_user}",
    "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/claziss/subscriptions",
    "organizations_url": "https://api.github.com/users/claziss/orgs",
    "repos_url": "https://api.github.com/users/claziss/repos",
    "events_url": "https://api.github.com/users/claziss/events{/privacy}",
    "received_events_url": "https://api.github.com/users/claziss/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "claziss",
    "id": 2761368,
    "node_id": "MDQ6VXNlcjI3NjEzNjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2761368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/claziss",
    "html_url": "https://github.com/claziss",
    "followers_url": "https://api.github.com/users/claziss/followers",
    "following_url": "https://api.github.com/users/claziss/following{/other_user}",
    "gists_url": "https://api.github.com/users/claziss/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/claziss/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/claziss/subscriptions",
    "organizations_url": "https://api.github.com/users/claziss/orgs",
    "repos_url": "https://api.github.com/users/claziss/repos",
    "events_url": "https://api.github.com/users/claziss/events{/privacy}",
    "received_events_url": "https://api.github.com/users/claziss/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f050cfdd82625e6214c4a77ae3b4b364dede1b52",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f050cfdd82625e6214c4a77ae3b4b364dede1b52",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f050cfdd82625e6214c4a77ae3b4b364dede1b52"
    }
  ],
  "stats": {
    "total": 127,
    "additions": 90,
    "deletions": 37
  },
  "files": [
    {
      "sha": "a69b50c6199217146075e46de2d35c75ee86b042",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/09a7e912932db766d5e6badfcba61c55f185503a/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/09a7e912932db766d5e6badfcba61c55f185503a/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=09a7e912932db766d5e6badfcba61c55f185503a",
      "patch": "@@ -1,3 +1,12 @@\n+2021-09-014  Cupertino Miranda  <cmiranda@synopsys.com>\n+           Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* arc-got.h (arc_static_sym_data): New structure.\n+\t(get_static_sym_data): New function.\n+\t(relocate_fix_got_relocs_for_got_info): Move the computation fo\n+\tsymbol value and section to above introduced function, and use\n+\tthis new function.\n+\n 2021-09-07  Luis Machado  <luis.machado@linaro.org>\n \n \tRevert: [AArch64] MTE corefile support"
    },
    {
      "sha": "c45d981b50474060d20f872aa29fb67bb49faed4",
      "filename": "bfd/arc-got.h",
      "status": "modified",
      "additions": 57,
      "deletions": 37,
      "changes": 94,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/09a7e912932db766d5e6badfcba61c55f185503a/bfd/arc-got.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/09a7e912932db766d5e6badfcba61c55f185503a/bfd/arc-got.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/arc-got.h?ref=09a7e912932db766d5e6badfcba61c55f185503a",
      "patch": "@@ -262,6 +262,48 @@ arc_fill_got_info_for_reloc (enum tls_type_e type,\n   return true;\n }\n \n+struct arc_static_sym_data {\n+  bfd_vma sym_value;\n+  const char *symbol_name;\n+};\n+\n+static struct arc_static_sym_data\n+get_static_sym_data (unsigned long  r_symndx,\n+\t\t     Elf_Internal_Sym  *local_syms,\n+\t\t     asection **local_sections,\n+\t\t     struct elf_link_hash_entry *h,\n+\t\t     struct arc_relocation_data *reloc_data)\n+{\n+  static const char local_name[] = \"(local)\";\n+  struct arc_static_sym_data ret = { 0, NULL };\n+\n+  if (h != NULL)\n+    {\n+      BFD_ASSERT (h->root.type != bfd_link_hash_undefweak\n+\t\t  && h->root.type != bfd_link_hash_undefined);\n+      /* TODO: This should not be here.  */\n+      reloc_data->sym_value = h->root.u.def.value;\n+      reloc_data->sym_section = h->root.u.def.section;\n+\n+      ret.sym_value = h->root.u.def.value\n+\t+ h->root.u.def.section->output_section->vma\n+\t+ h->root.u.def.section->output_offset;\n+\n+      ret.symbol_name = h->root.root.string;\n+    }\n+  else\n+  {\n+    Elf_Internal_Sym *sym = local_syms + r_symndx;\n+    asection *sec = local_sections[r_symndx];\n+\n+    ret.sym_value = sym->st_value\n+      + sec->output_section->vma\n+      + sec->output_offset;\n+\n+    ret.symbol_name = local_name;\n+  }\n+  return ret;\n+}\n \n static bfd_vma\n relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n@@ -290,38 +332,7 @@ relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n \t      && SYMBOL_REFERENCES_LOCAL (info, h))))\n     {\n       const char ATTRIBUTE_UNUSED *symbol_name;\n-      static const char local_name[] = \"(local)\";\n-      asection *tls_sec = NULL;\n-      bfd_vma sym_value = 0;\n-\n-      if (h != NULL)\n-\t{\n-\t  /* TODO: This should not be here.  */\n-\t  reloc_data->sym_value = h->root.u.def.value;\n-\t  reloc_data->sym_section = h->root.u.def.section;\n-\n-\t  sym_value = h->root.u.def.value\n-\t    + h->root.u.def.section->output_section->vma\n-\t    + h->root.u.def.section->output_offset;\n-\n-\t  tls_sec = elf_hash_table (info)->tls_sec;\n-\n-\t  symbol_name = h->root.root.string;\n-\t}\n-      else\n-\t{\n-\t  Elf_Internal_Sym *sym = local_syms + r_symndx;\n-\t  asection *sec = local_sections[r_symndx];\n-\n-\t  sym_value = sym->st_value\n-\t    + sec->output_section->vma\n-\t    + sec->output_offset;\n-\n-\t  tls_sec = elf_hash_table (info)->tls_sec;\n-\n-\t  symbol_name = local_name;\n-\t}\n-\n+      asection *tls_sec = elf_hash_table (info)->tls_sec;\n \n       if (entry && !entry->processed)\n \t{\n@@ -335,8 +346,12 @@ relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n \t\tif (h == NULL || h->forced_local\n \t\t   || !elf_hash_table (info)->dynamic_sections_created)\n \t\t  {\n+\t\t    struct arc_static_sym_data tmp =\n+\t\t      get_static_sym_data (r_symndx, local_syms, local_sections,\n+\t\t\t\t\t   h, reloc_data);\n+\n \t\t    bfd_put_32 (output_bfd,\n-\t\t\t    sym_value - sec_vma\n+\t\t\t    tmp.sym_value - sec_vma\n \t\t\t    + (elf_hash_table (info)->dynamic_sections_created\n \t\t\t       ? 0\n \t\t\t       : (align_power (0,\n@@ -355,7 +370,7 @@ relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n \t\t\t     + entry->offset\n \t\t\t     + (entry->existing_entries == TLS_GOT_MOD_AND_OFF\n \t\t\t\t? 4 : 0)),\n-\t\t\t  symbol_name);\n+\t\t\t  tmp.symbol_name);\n \t\t  }\n \t      }\n \t      break;\n@@ -366,8 +381,12 @@ relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n \t\tbfd_vma ATTRIBUTE_UNUSED sec_vma\n \t\t  = tls_sec->output_section->vma;\n \n+\t\tstruct arc_static_sym_data tmp =\n+\t\t  get_static_sym_data (r_symndx, local_syms, local_sections,\n+\t\t\t\t       h, reloc_data);\n+\n \t\tbfd_put_32 (output_bfd,\n-\t\t\t    sym_value - sec_vma\n+\t\t\t    tmp.sym_value - sec_vma\n \t\t\t    + (elf_hash_table (info)->dynamic_sections_created\n \t\t\t       ? 0\n \t\t\t       : (align_power (TCB_SIZE,\n@@ -386,7 +405,7 @@ relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n \t\t\t      + entry->offset\n \t\t\t      + (entry->existing_entries == TLS_GOT_MOD_AND_OFF\n \t\t\t\t ? 4 : 0)),\n-\t\t\t   symbol_name);\n+\t\t\t   tmp.symbol_name);\n \t      }\n \t      break;\n \n@@ -415,7 +434,8 @@ relocate_fix_got_relocs_for_got_info (struct got_entry **\t   list_p,\n \t\t\t       \"@ %#08lx for sym %s in got offset %#lx\\n\",\n \t\t\t       (long) (reloc_data->sym_value + sec_vma),\n \t\t\t       (long) (htab->sgot->output_section->vma\n-\t\t\t\t       + htab->sgot->output_offset + entry->offset),\n+\t\t\t\t       + htab->sgot->output_offset\n+\t\t\t\t       + entry->offset),\n \t\t\t       symbol_name,\n \t\t\t       (long) entry->offset);\n \t\t  }"
    },
    {
      "sha": "ebcd4cd9e932d35b7fe1f3f0a499ad08aef8da29",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/09a7e912932db766d5e6badfcba61c55f185503a/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/09a7e912932db766d5e6badfcba61c55f185503a/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=09a7e912932db766d5e6badfcba61c55f185503a",
      "patch": "@@ -1,3 +1,8 @@\n+2021-09-14  Claudiu Zissulescu  <claziss@synopsys.com>\n+\n+\t* ld-arc/got-weak.d: New file.\n+\t* ld-arc/got-weak.s: Likewise.\n+\n 2021-07-26  Roland McGrath  <mcgrathr@google.com>\n \n \t* testsuite/ld-x86-64/x86-64.exp (Build textrel-1): Use --warn-textrel."
    },
    {
      "sha": "cf15069b5188a44b5c6a819716582f503bfd047e",
      "filename": "ld/testsuite/ld-arc/got-weak.d",
      "status": "added",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/09a7e912932db766d5e6badfcba61c55f185503a/ld/testsuite/ld-arc/got-weak.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/09a7e912932db766d5e6badfcba61c55f185503a/ld/testsuite/ld-arc/got-weak.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-arc/got-weak.d?ref=09a7e912932db766d5e6badfcba61c55f185503a",
      "patch": "@@ -0,0 +1,12 @@\n+#source: got-weak.s\n+#as:\n+#ld: -Bstatic\n+#objdump: -d\n+\n+[^:]*:     file format elf32-.*arc\n+\n+\n+Disassembly of section \\.text:\n+\n+00000100 <.*>:\n+ 100:\t2730 7f80 0000 2014 \tld\tr0,\\[pcl,0x2014\\].*"
    },
    {
      "sha": "8ea18be378024b5801ffc7a4176ea75ab9a04e0b",
      "filename": "ld/testsuite/ld-arc/got-weak.s",
      "status": "added",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/09a7e912932db766d5e6badfcba61c55f185503a/ld/testsuite/ld-arc/got-weak.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/09a7e912932db766d5e6badfcba61c55f185503a/ld/testsuite/ld-arc/got-weak.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-arc/got-weak.s?ref=09a7e912932db766d5e6badfcba61c55f185503a",
      "patch": "@@ -0,0 +1,7 @@\n+\t.cpu archs\n+\n+\t.weak symb\n+\t.global __start\n+\t.text\n+__start:\n+\tld\tr0,[pcl,@symb@gotpc]"
    }
  ]
}