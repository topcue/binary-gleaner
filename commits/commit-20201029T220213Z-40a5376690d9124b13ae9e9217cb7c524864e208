{
  "sha": "40a5376690d9124b13ae9e9217cb7c524864e208",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDBhNTM3NjY5MGQ5MTI0YjEzYWU5ZTkyMTdjYjdjNTI0ODY0ZTIwOA==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-10-29T22:02:13Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-10-29T22:02:13Z"
    },
    "message": "gdb: remove parameter of gdbarch_displaced_step_hw_singlestep\n\nI noticed that the closure parameter of\ngdbarch_displaced_step_hw_singlestep is never used by any\nimplementation of the method, so this patch removes it.\n\ngdb/ChangeLog:\n\n\t* gdbarch.sh (displaced_step_hw_singlestep): Remove closure\n\tparameter.\n\t* aarch64-tdep.c (aarch64_displaced_step_hw_singlestep):\n\tLikewise.\n\t* aarch64-tdep.h (aarch64_displaced_step_hw_singlestep):\n\tLikewise.\n\t* arch-utils.c (default_displaced_step_hw_singlestep):\n\tLikewise.\n\t* arch-utils.h (default_displaced_step_hw_singlestep):\n\tLikewise.\n\t* rs6000-tdep.c (ppc_displaced_step_hw_singlestep):\n\tLikewise.\n\t* s390-tdep.c (s390_displaced_step_hw_singlestep):\n\tLikewise.\n\t* gdbarch.c: Re-generate.\n\t* gdbarch.h: Re-generate.\n\t* infrun.c (resume_1): Adjust.\n\nChange-Id: I7354f0b22afc2692ebff0cd700a462db8f389fc1",
    "tree": {
      "sha": "fb0c1ae4a85a7d1114a6b4846e25aaa2d0d507a4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fb0c1ae4a85a7d1114a6b4846e25aaa2d0d507a4"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/40a5376690d9124b13ae9e9217cb7c524864e208",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/40a5376690d9124b13ae9e9217cb7c524864e208",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/40a5376690d9124b13ae9e9217cb7c524864e208",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/40a5376690d9124b13ae9e9217cb7c524864e208/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8407f91bd388952721efa7f12c75bf94324dc506",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8407f91bd388952721efa7f12c75bf94324dc506",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8407f91bd388952721efa7f12c75bf94324dc506"
    }
  ],
  "stats": {
    "total": 55,
    "additions": 32,
    "deletions": 23
  },
  "files": [
    {
      "sha": "7dfea4e9058542b4981337a02d10a3e98dba7a0a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 20,
      "deletions": 0,
      "changes": 20,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -1,3 +1,23 @@\n+2020-10-29  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* gdbarch.sh (displaced_step_hw_singlestep): Remove closure\n+\tparameter.\n+\t* aarch64-tdep.c (aarch64_displaced_step_hw_singlestep):\n+\tLikewise.\n+\t* aarch64-tdep.h (aarch64_displaced_step_hw_singlestep):\n+\tLikewise.\n+\t* arch-utils.c (default_displaced_step_hw_singlestep):\n+\tLikewise.\n+\t* arch-utils.h (default_displaced_step_hw_singlestep):\n+\tLikewise.\n+\t* rs6000-tdep.c (ppc_displaced_step_hw_singlestep):\n+\tLikewise.\n+\t* s390-tdep.c (s390_displaced_step_hw_singlestep):\n+\tLikewise.\n+\t* gdbarch.c: Re-generate.\n+\t* gdbarch.h: Re-generate.\n+\t* infrun.c (resume_1): Adjust.\n+\n 2020-10-29  Tom Tromey  <tom@tromey.com>\n \n \t* progspace.c (program_space::~program_space): Don't call"
    },
    {
      "sha": "639fe59038740323f3c58eacb04a6b2ed5e1574a",
      "filename": "gdb/aarch64-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/aarch64-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/aarch64-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/aarch64-tdep.c?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -3270,8 +3270,7 @@ aarch64_displaced_step_fixup (struct gdbarch *gdbarch,\n /* Implement the \"displaced_step_hw_singlestep\" gdbarch method.  */\n \n bool\n-aarch64_displaced_step_hw_singlestep (struct gdbarch *gdbarch,\n-\t\t\t\t      struct displaced_step_closure *closure)\n+aarch64_displaced_step_hw_singlestep (struct gdbarch *gdbarch)\n {\n   return true;\n }"
    },
    {
      "sha": "bd7a6c602e0b15f900a63932e8c7d95def3517fd",
      "filename": "gdb/aarch64-tdep.h",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/aarch64-tdep.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/aarch64-tdep.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/aarch64-tdep.h?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -117,7 +117,6 @@ void aarch64_displaced_step_fixup (struct gdbarch *gdbarch,\n \t\t\t\t   CORE_ADDR from, CORE_ADDR to,\n \t\t\t\t   struct regcache *regs);\n \n-bool aarch64_displaced_step_hw_singlestep (struct gdbarch *gdbarch,\n-\t\t\t\t\t   displaced_step_closure *closure);\n+bool aarch64_displaced_step_hw_singlestep (struct gdbarch *gdbarch);\n \n #endif /* aarch64-tdep.h */"
    },
    {
      "sha": "8d5fa3fc976d14043cf4bf982f50aa59c5c8d1da",
      "filename": "gdb/arch-utils.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/arch-utils.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/arch-utils.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arch-utils.c?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -39,8 +39,7 @@\n #include \"dis-asm.h\"\n \n bool\n-default_displaced_step_hw_singlestep (struct gdbarch *gdbarch,\n-\t\t\t\t      struct displaced_step_closure *closure)\n+default_displaced_step_hw_singlestep (struct gdbarch *gdbarch)\n {\n   return !gdbarch_software_single_step_p (gdbarch);\n }"
    },
    {
      "sha": "7eea838ac3de5a7143ae2bd7a718445764661e2a",
      "filename": "gdb/arch-utils.h",
      "status": "modified",
      "additions": 1,
      "deletions": 3,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/arch-utils.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/arch-utils.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/arch-utils.h?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -75,9 +75,7 @@ struct bp_manipulation_endian\n   BREAK_INSN_LITTLE, BREAK_INSN_BIG>\n \n /* Default implementation of gdbarch_displaced_hw_singlestep.  */\n-extern bool\n-  default_displaced_step_hw_singlestep (struct gdbarch *,\n-\t\t\t\t\tstruct displaced_step_closure *);\n+extern bool default_displaced_step_hw_singlestep (struct gdbarch *);\n \n /* Possible value for gdbarch_displaced_step_location:\n    Place displaced instructions at the program's entry point,"
    },
    {
      "sha": "45dae111f18967407c423fb24139a91f4d2f0372",
      "filename": "gdb/gdbarch.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/gdbarch.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/gdbarch.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch.c?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -3987,13 +3987,13 @@ set_gdbarch_displaced_step_copy_insn (struct gdbarch *gdbarch,\n }\n \n bool\n-gdbarch_displaced_step_hw_singlestep (struct gdbarch *gdbarch, struct displaced_step_closure *closure)\n+gdbarch_displaced_step_hw_singlestep (struct gdbarch *gdbarch)\n {\n   gdb_assert (gdbarch != NULL);\n   gdb_assert (gdbarch->displaced_step_hw_singlestep != NULL);\n   if (gdbarch_debug >= 2)\n     fprintf_unfiltered (gdb_stdlog, \"gdbarch_displaced_step_hw_singlestep called\\n\");\n-  return gdbarch->displaced_step_hw_singlestep (gdbarch, closure);\n+  return gdbarch->displaced_step_hw_singlestep (gdbarch);\n }\n \n void"
    },
    {
      "sha": "8b1507b4ea8cc0689b5fd77860310bbe24136edc",
      "filename": "gdb/gdbarch.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/gdbarch.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/gdbarch.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch.h?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -1044,8 +1044,8 @@ extern void set_gdbarch_displaced_step_copy_insn (struct gdbarch *gdbarch, gdbar\n    The default implementation returns false on all targets that\n    provide a gdbarch_software_single_step routine, and true otherwise. */\n \n-typedef bool (gdbarch_displaced_step_hw_singlestep_ftype) (struct gdbarch *gdbarch, struct displaced_step_closure *closure);\n-extern bool gdbarch_displaced_step_hw_singlestep (struct gdbarch *gdbarch, struct displaced_step_closure *closure);\n+typedef bool (gdbarch_displaced_step_hw_singlestep_ftype) (struct gdbarch *gdbarch);\n+extern bool gdbarch_displaced_step_hw_singlestep (struct gdbarch *gdbarch);\n extern void set_gdbarch_displaced_step_hw_singlestep (struct gdbarch *gdbarch, gdbarch_displaced_step_hw_singlestep_ftype *displaced_step_hw_singlestep);\n \n /* Fix up the state resulting from successfully single-stepping a"
    },
    {
      "sha": "bff29c536c9d37dab1111f564b1d0c193212e394",
      "filename": "gdb/gdbarch.sh",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/gdbarch.sh",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/gdbarch.sh",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch.sh?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -794,7 +794,7 @@ M;displaced_step_closure_up;displaced_step_copy_insn;CORE_ADDR from, CORE_ADDR t\n #\n # The default implementation returns false on all targets that\n # provide a gdbarch_software_single_step routine, and true otherwise.\n-m;bool;displaced_step_hw_singlestep;struct displaced_step_closure *closure;closure;;default_displaced_step_hw_singlestep;;0\n+m;bool;displaced_step_hw_singlestep;void;;;default_displaced_step_hw_singlestep;;0\n \n # Fix up the state resulting from successfully single-stepping a\n # displaced instruction, to give the result we would have gotten from"
    },
    {
      "sha": "e8c8fc0a95b44b9c164bbb7d5b2c6a1778aaaf39",
      "filename": "gdb/infrun.c",
      "status": "modified",
      "additions": 1,
      "deletions": 5,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/infrun.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/infrun.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/infrun.c?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -2459,15 +2459,11 @@ resume_1 (enum gdb_signal sig)\n \t}\n       else if (prepared > 0)\n \t{\n-\t  struct displaced_step_inferior_state *displaced;\n-\n \t  /* Update pc to reflect the new address from which we will\n \t     execute instructions due to displaced stepping.  */\n \t  pc = regcache_read_pc (get_thread_regcache (tp));\n \n-\t  displaced = get_displaced_stepping_state (tp->inf);\n-\t  step = gdbarch_displaced_step_hw_singlestep\n-\t    (gdbarch, displaced->step_closure.get ());\n+\t  step = gdbarch_displaced_step_hw_singlestep (gdbarch);\n \t}\n     }\n "
    },
    {
      "sha": "264d4e03e7fc205a141f83b77f4a88d194e1a548",
      "filename": "gdb/rs6000-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/rs6000-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/rs6000-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/rs6000-tdep.c?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -995,8 +995,7 @@ ppc_displaced_step_fixup (struct gdbarch *gdbarch,\n /* Always use hardware single-stepping to execute the\n    displaced instruction.  */\n static bool\n-ppc_displaced_step_hw_singlestep (struct gdbarch *gdbarch,\n-\t\t\t\t  struct displaced_step_closure *closure)\n+ppc_displaced_step_hw_singlestep (struct gdbarch *gdbarch)\n {\n   return true;\n }"
    },
    {
      "sha": "d3b96ebb494573975c170662a7bac2513590cf2c",
      "filename": "gdb/s390-tdep.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/s390-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/40a5376690d9124b13ae9e9217cb7c524864e208/gdb/s390-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/s390-tdep.c?ref=40a5376690d9124b13ae9e9217cb7c524864e208",
      "patch": "@@ -587,8 +587,7 @@ s390_displaced_step_fixup (struct gdbarch *gdbarch,\n /* Implement displaced_step_hw_singlestep gdbarch method.  */\n \n static bool\n-s390_displaced_step_hw_singlestep (struct gdbarch *gdbarch,\n-\t\t\t\t   struct displaced_step_closure *closure)\n+s390_displaced_step_hw_singlestep (struct gdbarch *gdbarch)\n {\n   return true;\n }"
    }
  ]
}