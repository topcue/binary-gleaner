{
  "sha": "8d34471f70a84e6db89be40116d1ed0f6af941c0",
  "node_id": "C_kwDOANOeidoAKDhkMzQ0NzFmNzBhODRlNmRiODliZTQwMTE2ZDFlZDBmNmFmOTQxYzA",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "aburgess@redhat.com",
      "date": "2021-11-22T12:30:36Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "aburgess@redhat.com",
      "date": "2021-12-18T10:19:55Z"
    },
    "message": "gdb: add assert in remote_target::wait relating to async being off\n\nWhile working on another patch I ended up in a situation where I had\nasync mode disabled (with 'maint set target-async off'), but the async\nevent token got marked anyway.\n\nIn this situation GDB was continually calling into\nremote_target::wait, however, the async token would never become\nunmarked as the unmarking is guarded by target_is_async_p.\n\nWe could just unconditionally unmark the token, but that would feel\nlike just ignoring a bug, so, instead, lets assert that if\n!target_is_async_p, then the async token should not be marked.\n\nThis assertion would have caught my earlier mistake.\n\nThere should be no user visible changes with this commit.",
    "tree": {
      "sha": "a056df775b6d84e5513a8d3b03a4ed1f68347342",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a056df775b6d84e5513a8d3b03a4ed1f68347342"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8d34471f70a84e6db89be40116d1ed0f6af941c0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8d34471f70a84e6db89be40116d1ed0f6af941c0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8d34471f70a84e6db89be40116d1ed0f6af941c0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8d34471f70a84e6db89be40116d1ed0f6af941c0/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "4f626cad041b96f78bae75a2d24d1573f382e12b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4f626cad041b96f78bae75a2d24d1573f382e12b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4f626cad041b96f78bae75a2d24d1573f382e12b"
    }
  ],
  "stats": {
    "total": 6,
    "additions": 5,
    "deletions": 1
  },
  "files": [
    {
      "sha": "1bb6138a7c794d68e41af46a1e9c6c0c88f57cfa",
      "filename": "gdb/remote.c",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8d34471f70a84e6db89be40116d1ed0f6af941c0/gdb/remote.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8d34471f70a84e6db89be40116d1ed0f6af941c0/gdb/remote.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/remote.c?ref=8d34471f70a84e6db89be40116d1ed0f6af941c0",
      "patch": "@@ -8348,9 +8348,13 @@ remote_target::wait (ptid_t ptid, struct target_waitstatus *status,\n   remote_state *rs = get_remote_state ();\n \n   /* Start by clearing the flag that asks for our wait method to be called,\n-     we'll mark it again at the end if needed.  */\n+     we'll mark it again at the end if needed.  If the target is not in\n+     async mode then the async token should not be marked.  */\n   if (target_is_async_p ())\n     clear_async_event_handler (rs->remote_async_inferior_event_token);\n+  else\n+    gdb_assert (!async_event_handler_marked\n+\t\t(rs->remote_async_inferior_event_token));\n \n   ptid_t event_ptid;\n "
    }
  ]
}