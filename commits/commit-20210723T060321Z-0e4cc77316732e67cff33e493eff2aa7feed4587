{
  "sha": "0e4cc77316732e67cff33e493eff2aa7feed4587",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MGU0Y2M3NzMxNjczMmU2N2NmZjMzZTQ5M2VmZjJhYTdmZWVkNDU4Nw==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-07-23T06:03:21Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-07-23T06:03:21Z"
    },
    "message": "x86: express unduly set rounding control bits in disassembly\n\nWhile EVEX.L'L are indeed ignored when EVEX.b stands for just SAE,\nEVEX.b itself is not ignored when an insn permits neither rounding\ncontrol nor SAE.\n\nWhile changing this aspect of EVEX.b handling, also alter unduly set\nembedded broadcast: Don't call BadOp(), screwing up subsequent\ndisassembly, but emit \"{bad}\" instead.",
    "tree": {
      "sha": "e1e3a9830a91012c0b7a49a4ed6610793e34bcb3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e1e3a9830a91012c0b7a49a4ed6610793e34bcb3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0e4cc77316732e67cff33e493eff2aa7feed4587",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0e4cc77316732e67cff33e493eff2aa7feed4587",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0e4cc77316732e67cff33e493eff2aa7feed4587",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0e4cc77316732e67cff33e493eff2aa7feed4587/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9234efeee5f47807f0e08769983ac439d5ffefde",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9234efeee5f47807f0e08769983ac439d5ffefde",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9234efeee5f47807f0e08769983ac439d5ffefde"
    }
  ],
  "stats": {
    "total": 144,
    "additions": 81,
    "deletions": 63
  },
  "files": [
    {
      "sha": "07ffe60e1771ec8cbb27d740ccaf91b92f6df3c2",
      "filename": "gas/testsuite/gas/i386/avx512f-nondef.d",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/avx512f-nondef.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/avx512f-nondef.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/avx512f-nondef.d?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -10,12 +10,11 @@ Disassembly of section .text:\n 0+ <.text>:\n [ \t]*[a-f0-9]+:\t62 f3 d5 1f 0b f4 7b \tvrndscalesd \\$0x7b,\\{sae\\},%xmm4,%xmm5,%xmm6\\{%k7\\}\n [ \t]*[a-f0-9]+:\t62 f3 d5 5f 0b f4 7b \tvrndscalesd \\$0x7b,\\{sae\\},%xmm4,%xmm5,%xmm6\\{%k7\\}\n-[ \t]*[a-f0-9]+:\t62 f2 55 1f 3b f4    \tvpminud %zmm4,%zmm5,%zmm6\\{%k7\\}\n-[ \t]*[a-f0-9]+:\t62 c2 55 1f 3b f4    \tvpminud %zmm4,%zmm5,%zmm6\\{%k7\\}\n+[ \t]*[a-f0-9]+:\t62 f2 55 4f 3b f4    \tvpminud %zmm4,%zmm5,%zmm6\\{%k7\\}\n+[ \t]*[a-f0-9]+:\t62 c2 55 4f 3b f4    \tvpminud %zmm4,%zmm5,%zmm6\\{%k7\\}\n+[ \t]*[a-f0-9]+:\t62 f2 55 1f 3b f4    \tvpminud \\{rn-bad\\},%zmm4,%zmm5,%zmm6\\{%k7\\}\n [ \t]*[a-f0-9]+:\t62 f2 7e 48 31 72 7f \tvpmovdb %zmm6,0x7f0\\(%edx\\)\n-[ \t]*[a-f0-9]+:\t62                   \tvpmovdb %zmm6,\\(bad\\)\n-[ \t]*[a-f0-9]+:\tf2 7e 58             \tbnd jle (0x7d|7d <.text\\+0x7d>)\n-[ \t]*[a-f0-9]+:\t31 72 7f             \txor    %esi,0x7f\\(%edx\\)\n+[ \t]*[a-f0-9]+:\t62 f2 7e 58 31 72 7f \tvpmovdb %zmm6,0x7f0\\(%edx\\)\\{bad\\}\n [ \t]*[a-f0-9]+:\t62 f1 7c 88 58       \t\\(bad\\)\n [ \t]*[a-f0-9]+:\tc3                   \tret *\n [ \t]*[a-f0-9]+:\t62 f2 7d 4f 92 01    \tvgatherdps \\(bad\\),%zmm0\\{%k7\\}"
    },
    {
      "sha": "96d0466624841e5f3e21fdbe51c113673b83855d",
      "filename": "gas/testsuite/gas/i386/avx512f-nondef.s",
      "status": "modified",
      "additions": 7,
      "deletions": 5,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/avx512f-nondef.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/avx512f-nondef.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/avx512f-nondef.s?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -5,13 +5,15 @@\n .byte 0x62, 0xf3, 0xd5, 0x1f, 0x0b, 0xf4, 0x7b\n # vrndscalesd\t{sae}, $123, %xmm4, %xmm5, %xmm6{%k7}\t # with not-null RC\n .byte 0x62, 0xf3, 0xd5, 0x5f, 0x0b, 0xf4, 0x7b\n-# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t # with 111 REX\n+# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t# with 11 EVEX.{B,R'}\n+.byte 0x62, 0xf2, 0x55, 0x4f, 0x3b, 0xf4\n+# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t# with not-11 EVEX.{B,R'}\n+.byte 0x62, 0xc2, 0x55, 0x4f, 0x3b, 0xf4\n+# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t# with set EVEX.b bit\n .byte 0x62, 0xf2, 0x55, 0x1f, 0x3b, 0xf4\n-# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t # with not-111 REX\n-.byte 0x62, 0xc2, 0x55, 0x1f, 0x3b, 0xf4\n-# vpmovdb\t%zmm6, 2032(%rdx) # with unset EVEX.B bit\n+# vpmovdb\t%zmm6, 2032(%rdx)\t\t# with unset EVEX.b bit\n .byte 0x62, 0xf2, 0x7e, 0x48, 0x31, 0x72, 0x7f\n-# vpmovdb\t%zmm6, 2032(%rdx) # with set EVEX.B bit - we should get (bad) operand\n+# vpmovdb\t%zmm6, 2032(%rdx)\t\t# with set EVEX.b bit - we should get (bad) operand\n .byte 0x62, 0xf2, 0x7e, 0x58, 0x31, 0x72, 0x7f\n # vaddps xmm0, xmm0, xmm3 # with EVEX.z set\n .byte 0x62, 0xf1, 0x7c, 0x88, 0x58, 0xc3"
    },
    {
      "sha": "4afcc6db7280e446d90c903760ebad4dd4849e47",
      "filename": "gas/testsuite/gas/i386/evex.d",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/evex.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/evex.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/evex.d?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -8,14 +8,14 @@ Disassembly of section .text:\n \n 0+ <_start>:\n  +[a-f0-9]+:\t62 f1 d6 38 2a f0    \tvcvtsi2ssl %eax,\\{rd-sae\\},%xmm5,%xmm6\n- +[a-f0-9]+:\t62 f1 57 38 2a f0    \tvcvtsi2sdl %eax,\\(bad\\),%xmm5,%xmm6\n- +[a-f0-9]+:\t62 f1 d7 38 2a f0    \tvcvtsi2sdl %eax,\\(bad\\),%xmm5,%xmm6\n+ +[a-f0-9]+:\t62 f1 57 38 2a f0    \tvcvtsi2sdl %eax,\\{rd-bad\\},%xmm5,%xmm6\n+ +[a-f0-9]+:\t62 f1 d7 38 2a f0    \tvcvtsi2sdl %eax,\\{rd-bad\\},%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d6 08 7b f0    \tvcvtusi2ssl %eax,%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 57 08 7b f0    \tvcvtusi2sdl %eax,%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d7 08 7b f0    \tvcvtusi2sdl %eax,%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d6 38 7b f0    \tvcvtusi2ssl %eax,\\{rd-sae\\},%xmm5,%xmm6\n- +[a-f0-9]+:\t62 f1 57 38 7b f0    \tvcvtusi2sdl %eax,\\(bad\\),%xmm5,%xmm6\n- +[a-f0-9]+:\t62 f1 d7 38 7b f0    \tvcvtusi2sdl %eax,\\(bad\\),%xmm5,%xmm6\n+ +[a-f0-9]+:\t62 f1 57 38 7b f0    \tvcvtusi2sdl %eax,\\{rd-bad\\},%xmm5,%xmm6\n+ +[a-f0-9]+:\t62 f1 d7 38 7b f0    \tvcvtusi2sdl %eax,\\{rd-bad\\},%xmm5,%xmm6\n  +[a-f0-9]+:\t62 e1 7e 08 2d c0    \tvcvtss2si %xmm0,%eax\n  +[a-f0-9]+:\t62 e1 7c 08 c2 c0 00 \tvcmpeqps %xmm0,%xmm0,%k0\n #pass"
    },
    {
      "sha": "e8ddfd58870a0ce08a6861384a9359b44594cad2",
      "filename": "gas/testsuite/gas/i386/x86-64-avx512f-nondef.d",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/x86-64-avx512f-nondef.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/x86-64-avx512f-nondef.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-avx512f-nondef.d?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -10,10 +10,9 @@ Disassembly of section .text:\n 0+ <.text>:\n [ \t]*[a-f0-9]+:\t62 f3 d5 1f 0b f4 7b \tvrndscalesd \\$0x7b,\\{sae\\},%xmm4,%xmm5,%xmm6\\{%k7\\}\n [ \t]*[a-f0-9]+:\t62 f3 d5 5f 0b f4 7b \tvrndscalesd \\$0x7b,\\{sae\\},%xmm4,%xmm5,%xmm6\\{%k7\\}\n-[ \t]*[a-f0-9]+:\t62 f2 55 1f 3b f4    \tvpminud %zmm4,%zmm5,%zmm6\\{%k7\\}\n-[ \t]*[a-f0-9]+:\t62 c2 55 1f 3b f4    \tvpminud %zmm12,%zmm5,%zmm22\\{%k7\\}\n+[ \t]*[a-f0-9]+:\t62 f2 55 4f 3b f4    \tvpminud %zmm4,%zmm5,%zmm6\\{%k7\\}\n+[ \t]*[a-f0-9]+:\t62 c2 55 4f 3b f4    \tvpminud %zmm12,%zmm5,%zmm22\\{%k7\\}\n+[ \t]*[a-f0-9]+:\t62 f2 55 1f 3b f4    \tvpminud \\{rn-bad\\},%zmm4,%zmm5,%zmm6\\{%k7\\}\n [ \t]*[a-f0-9]+:\t62 f2 7e 48 31 72 7f \tvpmovdb %zmm6,0x7f0\\(%rdx\\)\n-[ \t]*[a-f0-9]+:\t62                   \tvpmovdb %zmm6,\\(bad\\)\n-[ \t]*[a-f0-9]+:\tf2 7e 58             \tbnd jle (0x7d|7d <.text\\+0x7d>)\n-[ \t]*[a-f0-9]+:\t31 72 7f             \txor    %esi,0x7f\\(%rdx\\)\n+[ \t]*[a-f0-9]+:\t62 f2 7e 58 31 72 7f \tvpmovdb %zmm6,0x7f0\\(%rdx\\)\\{bad\\}\n #pass"
    },
    {
      "sha": "952f2db76b37f81859a2dcd563bd7359ce97702e",
      "filename": "gas/testsuite/gas/i386/x86-64-avx512f-nondef.s",
      "status": "modified",
      "additions": 7,
      "deletions": 5,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/x86-64-avx512f-nondef.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/x86-64-avx512f-nondef.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-avx512f-nondef.s?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -5,11 +5,13 @@\n .byte 0x62, 0xf3, 0xd5, 0x1f, 0x0b, 0xf4, 0x7b\n # vrndscalesd\t{sae}, $123, %xmm4, %xmm5, %xmm6{%k7}\t # with not-null RC\n .byte 0x62, 0xf3, 0xd5, 0x5f, 0x0b, 0xf4, 0x7b\n-# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t # with 111 REX\n+# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t# with 11 EVEX.{B,R'}\n+.byte 0x62, 0xf2, 0x55, 0x4f, 0x3b, 0xf4\n+# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t# with not-11 EVEX.{B,R'}\n+.byte 0x62, 0xc2, 0x55, 0x4f, 0x3b, 0xf4\n+# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t# with set EVEX.b bit\n .byte 0x62, 0xf2, 0x55, 0x1f, 0x3b, 0xf4\n-# vpminud\t%zmm4, %zmm5, %zmm6{%k7}\t # with not-111 REX\n-.byte 0x62, 0xc2, 0x55, 0x1f, 0x3b, 0xf4\n-# vpmovdb\t%zmm6, 2032(%rdx) # with unset EVEX.B bit\n+# vpmovdb\t%zmm6, 2032(%rdx)\t\t# with unset EVEX.b bit\n .byte 0x62, 0xf2, 0x7e, 0x48, 0x31, 0x72, 0x7f\n-# vpmovdb\t%zmm6, 2032(%rdx) # with set EVEX.B bit - we should get (bad) operand\n+# vpmovdb\t%zmm6, 2032(%rdx)\t\t# with set EVEX.b bit - we should get (bad) operand\n .byte 0x62, 0xf2, 0x7e, 0x58, 0x31, 0x72, 0x7f"
    },
    {
      "sha": "041747db892809d9a24e0b3d476682410bfa8eab",
      "filename": "gas/testsuite/gas/i386/x86-64-evex.d",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/x86-64-evex.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/gas/testsuite/gas/i386/x86-64-evex.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/x86-64-evex.d?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -9,13 +9,13 @@ Disassembly of section .text:\n \n 0+ <_start>:\n  +[a-f0-9]+:\t62 f1 d6 38 2a f0    \tvcvtsi2ss %rax,\\{rd-sae\\},%xmm5,%xmm6\n- +[a-f0-9]+:\t62 f1 57 38 2a f0    \tvcvtsi2sd %eax,\\(bad\\),%xmm5,%xmm6\n+ +[a-f0-9]+:\t62 f1 57 38 2a f0    \tvcvtsi2sd %eax,\\{rd-bad\\},%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d7 38 2a f0    \tvcvtsi2sd %rax,\\{rd-sae\\},%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d6 08 7b f0    \tvcvtusi2ss %rax,%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 57 08 7b f0    \tvcvtusi2sd %eax,%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d7 08 7b f0    \tvcvtusi2sd %rax,%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d6 38 7b f0    \tvcvtusi2ss %rax,\\{rd-sae\\},%xmm5,%xmm6\n- +[a-f0-9]+:\t62 f1 57 38 7b f0    \tvcvtusi2sd %eax,\\(bad\\),%xmm5,%xmm6\n+ +[a-f0-9]+:\t62 f1 57 38 7b f0    \tvcvtusi2sd %eax,\\{rd-bad\\},%xmm5,%xmm6\n  +[a-f0-9]+:\t62 f1 d7 38 7b f0    \tvcvtusi2sd %rax,\\{rd-sae\\},%xmm5,%xmm6\n  +[a-f0-9]+:\t62 e1 7e 08 2d c0    \tvcvtss2si %xmm0,\\(bad\\)\n  +[a-f0-9]+:\t62 e1 7c 08 c2 c0 00 \tvcmpeqps %xmm0,%xmm0,\\(bad\\)"
    },
    {
      "sha": "b25a9f324c05c0e68ef78dfcf06561f7eb60df66",
      "filename": "opcodes/i386-dis.c",
      "status": "modified",
      "additions": 53,
      "deletions": 37,
      "changes": 90,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0e4cc77316732e67cff33e493eff2aa7feed4587/opcodes/i386-dis.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0e4cc77316732e67cff33e493eff2aa7feed4587/opcodes/i386-dis.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/i386-dis.c?ref=0e4cc77316732e67cff33e493eff2aa7feed4587",
      "patch": "@@ -159,6 +159,11 @@ static int rex_used;\n    current instruction.  */\n static int used_prefixes;\n \n+/* Flags for EVEX bits which we somehow handled when printing the\n+   current instruction.  */\n+#define EVEX_b_used 1\n+static int evex_used;\n+\n /* Flags stored in PREFIXES.  */\n #define PREFIX_REPZ 1\n #define PREFIX_REPNZ 2\n@@ -2524,12 +2529,12 @@ static const char *att_names_mask[] = {\n   \"%k0\", \"%k1\", \"%k2\", \"%k3\", \"%k4\", \"%k5\", \"%k6\", \"%k7\"\n };\n \n-static const char *names_rounding[] =\n+static const char *const names_rounding[] =\n {\n-  \"{rn-sae}\",\n-  \"{rd-sae}\",\n-  \"{ru-sae}\",\n-  \"{rz-sae}\"\n+  \"{rn-\",\n+  \"{rd-\",\n+  \"{ru-\",\n+  \"{rz-\"\n };\n \n static const struct dis386 reg_table[][8] = {\n@@ -8578,6 +8583,7 @@ ckprefix (void)\n   prefixes = 0;\n   used_prefixes = 0;\n   rex_used = 0;\n+  evex_used = 0;\n   last_lock_prefix = -1;\n   last_repz_prefix = -1;\n   last_repnz_prefix = -1;\n@@ -9661,6 +9667,21 @@ print_insn (bfd_vma pc, disassemble_info *info)\n \t\t    oappend (\"/(bad)\");\n \t\t}\n \t    }\n+\n+\t  /* Check whether rounding control was enabled for an insn not\n+\t     supporting it.  */\n+\t  if (modrm.mod == 3 && vex.b && !(evex_used & EVEX_b_used))\n+\t    {\n+\t      for (i = 0; i < MAX_OPERANDS; ++i)\n+\t\t{\n+\t\t  obufp = op_out[i];\n+\t\t  if (*obufp)\n+\t\t    continue;\n+\t\t  oappend (names_rounding[vex.ll]);\n+\t\t  oappend (\"bad}\");\n+\t\t  break;\n+\t\t}\n+\t    }\n \t}\n     }\n \n@@ -11316,14 +11337,6 @@ OP_E_memory (int bytemode, int sizeflag)\n \n   if (vex.evex)\n     {\n-      /* In EVEX, if operand doesn't allow broadcast, vex.b should be 0.  */\n-      if (vex.b\n-\t  && bytemode != x_mode\n-\t  && bytemode != evex_half_bcst_xmmq_mode)\n-\t{\n-\t  BadOp ();\n-\t  return;\n-\t}\n       switch (bytemode)\n \t{\n \tcase dw_mode:\n@@ -11764,10 +11777,9 @@ OP_E_memory (int bytemode, int sizeflag)\n \t  oappend (scratchbuf);\n \t}\n     }\n-  if (vex.b\n-      && (bytemode == x_mode\n-\t  || bytemode == evex_half_bcst_xmmq_mode))\n+  if (vex.b)\n     {\n+      evex_used |= EVEX_b_used;\n       if (vex.w\n \t  || bytemode == evex_half_bcst_xmmq_mode)\n \t{\n@@ -11786,7 +11798,7 @@ OP_E_memory (int bytemode, int sizeflag)\n \t      abort ();\n \t    }\n \t}\n-      else\n+      else if (bytemode == x_mode)\n \t{\n \t  switch (vex.length)\n \t    {\n@@ -11803,6 +11815,9 @@ OP_E_memory (int bytemode, int sizeflag)\n \t      abort ();\n \t    }\n \t}\n+      else\n+\t/* If operand doesn't allow broadcast, vex.b should be 0.  */\n+\toappend (\"{bad}\");\n     }\n }\n \n@@ -13495,24 +13510,25 @@ MOVSXD_Fixup (int bytemode, int sizeflag)\n static void\n OP_Rounding (int bytemode, int sizeflag ATTRIBUTE_UNUSED)\n {\n-  if (modrm.mod == 3 && vex.b)\n-    switch (bytemode)\n-      {\n-      case evex_rounding_64_mode:\n-\tif (address_mode != mode_64bit || !vex.w)\n-\t  {\n-\t    oappend (\"(bad)\");\n-\t    break;\n-\t  }\n-\t/* Fall through.  */\n-      case evex_rounding_mode:\n-\toappend (names_rounding[vex.ll]);\n-\tbreak;\n-      case evex_sae_mode:\n-\toappend (\"{sae}\");\n-\tbreak;\n-      default:\n-\tabort ();\n-\tbreak;\n-      }\n+  if (modrm.mod != 3 || !vex.b)\n+    return;\n+\n+  switch (bytemode)\n+    {\n+    case evex_rounding_64_mode:\n+      if (address_mode != mode_64bit || !vex.w)\n+        return;\n+      /* Fall through.  */\n+    case evex_rounding_mode:\n+      evex_used |= EVEX_b_used;\n+      oappend (names_rounding[vex.ll]);\n+      break;\n+    case evex_sae_mode:\n+      evex_used |= EVEX_b_used;\n+      oappend (\"{\");\n+      break;\n+    default:\n+      abort ();\n+    }\n+  oappend (\"sae}\");\n }"
    }
  ]
}