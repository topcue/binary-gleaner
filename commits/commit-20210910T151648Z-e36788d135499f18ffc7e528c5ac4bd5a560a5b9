{
  "sha": "e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTM2Nzg4ZDEzNTQ5OWYxOGZmYzdlNTI4YzVhYzRiZDVhNTYwYTViOQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-10T15:16:48Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-09-10T15:16:48Z"
    },
    "message": "[gdb/testsuite] Fix handling of nr_args < 3 in mi_gdb_test\n\nThe documentation of mi_gdb_test states that the command, pattern and message\narguments are mandatory:\n...\n # mi_gdb_test COMMAND PATTERN MESSAGE [IPATTERN] -- send a command to gdb;\n #   test the result.\n...\n\nHowever, this is not checked, and when mi_gdb_test is called with less than 3\narguments, it passes or fails silently.\n\nFix this by using the following semantics:\n- if there are 1 or 2 arguments, use the command as the message.\n- if there is 1 argument, use \".*\" as the pattern.\n- if there are no or too much arguments, error out.\n\nFix a PATH issue in gdb.mi/mi-logging.exp, introduced by using the command as\nmessage.  Fix a few other trivial-looking FAILs.\n\nThere are 11 less trivial-looking FAILs left in gdb.mi in test-cases:\n- mi-nsmoribund.exp\n- mi-breakpoint-changed.exp\n- mi-break.exp.\n\nTested on x86_64-linux.",
    "tree": {
      "sha": "169b249750d7b821f4a77e0b165f8cd9ae636437",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/169b249750d7b821f4a77e0b165f8cd9ae636437"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ca4987847046f288573278237673ded42a2dead8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ca4987847046f288573278237673ded42a2dead8",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ca4987847046f288573278237673ded42a2dead8"
    }
  ],
  "stats": {
    "total": 55,
    "additions": 43,
    "deletions": 12
  },
  "files": [
    {
      "sha": "86916c42c16aedc3f426a255d5be00050b20f0bd",
      "filename": "gdb/testsuite/gdb.mi/mi-break.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-break.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-break.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-break.exp?ref=e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
      "patch": "@@ -341,7 +341,7 @@ proc_with_prefix test_explicit_breakpoints {} {\n \n     # First check mixed explicit/parsed linespecs.\n     mi_gdb_test \"-break-insert --function main $srcfile:$line_callee3_head\" \\\n-\t\".*Garbage following explicit linespec\"\n+\t\".*Garbage following explicit location.*\"\n \n     # Insert some breakpoints and list them\n     # Also, disable some so they do not interfere with other tests"
    },
    {
      "sha": "35b95969d9d7473021b4e1c628dd172fd7f275a5",
      "filename": "gdb/testsuite/gdb.mi/mi-logging.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-logging.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-logging.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-logging.exp?ref=e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
      "patch": "@@ -32,7 +32,8 @@ if {[mi_runto_main] < 0} {\n \n set milogfile [standard_output_file \"milog.txt\"]\n \n-mi_gdb_test \"-gdb-set logging file $milogfile\" \".*\"\n+mi_gdb_test \"-gdb-set logging file $milogfile\" \"\\\\^done\" \\\n+    \"-gdb-set logging file\"\n \n mi_gdb_test \"-gdb-set logging overwrite on\" \".*\"\n "
    },
    {
      "sha": "4f2c04f8e30b5c3df6239dd159ded30c3c299036",
      "filename": "gdb/testsuite/gdb.mi/mi-memory-changed.exp",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-memory-changed.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-memory-changed.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-memory-changed.exp?ref=e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
      "patch": "@@ -75,7 +75,8 @@ gdb_expect {\n     }\n }\n \n-mi_gdb_test \"set var *(unsigned int *) ${main_addr} = ${main_insn}\" \\\n-    \".*=memory-changed,thread-group=\\\"i${decimal}\\\".addr=\\\"${main_addr}\\\",len=\\\"0x4\\\",type=\\\"code\\\".*\\\\^done\"\n+regsub ^0x0* $main_addr \"\" main_addr\n+mi_gdb_test \"set var *(unsigned int *) 0x${main_addr} = ${main_insn}\" \\\n+    \".*=memory-changed,thread-group=\\\"i${decimal}\\\".addr=\\\"0x0*${main_addr}\\\",len=\\\"0x4\\\",type=\\\"code\\\".*\\\\^done\"\n mi_gdb_exit\n return 0"
    },
    {
      "sha": "58de9591da84ec53ff9e70961a8ccf7901baff15",
      "filename": "gdb/testsuite/gdb.mi/mi-nsmoribund.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-nsmoribund.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.mi/mi-nsmoribund.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/mi-nsmoribund.exp?ref=e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
      "patch": "@@ -115,7 +115,12 @@ mi_check_thread_states \\\n # gdb_test_multiple (or an MI equivalent)\n \n mi_gdb_test \"102-break-delete\" \"102\\\\^done.*\"\n-mi_gdb_test \"print done = 1\" { = 1\"}\n+set re [list \\\n+\t    [string_list_to_regexp ~ {\"} $] \\\n+\t    $decimal \\\n+\t    [string_list_to_regexp \" = 1\" \\\\ n {\"} \\r\\n ^ done]]\n+set re [join $re \"\"]\n+mi_gdb_test \"print done = 1\" $re\n mi_gdb_test \"103-exec-continue --all\" \"\\[^\\n\\]*\\r\\n$running_re\"\n \n gdb_expect {"
    },
    {
      "sha": "c585540d6d7c6cc00f4ced01a287835443f213ea",
      "filename": "gdb/testsuite/gdb.python/py-mi.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.python/py-mi.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/gdb.python/py-mi.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.python/py-mi.exp?ref=e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
      "patch": "@@ -44,7 +44,9 @@ mi_runto_main\n \n set remote_python_file [gdb_remote_download host ${srcdir}/${subdir}/${pyfile}]\n \n-mi_gdb_test \"source ${remote_python_file}\" \"load python file\"\n+set cmd \"source ${remote_python_file}\"\n+set re [string_list_to_regexp & {\"} $cmd \\\\ n {\"} \\r\\n ^ done]\n+mi_gdb_test $cmd $re \"load python file\"\n \n mi_continue_to_line [gdb_get_line_number {MI breakpoint here} ${srcfile}] \\\n   \"step to breakpoint\"\n@@ -74,7 +76,7 @@ with_test_prefix \"varobj nscont\" {\n     mi_delete_varobj nscont \"delete varobj\"\n }\n \n-mi_gdb_test \"-enable-pretty-printing\" \"\"\n+mi_gdb_test \"-enable-pretty-printing\" \"\\\\^done\"\n \n mi_create_varobj_checked string string_1 \\\n     \"struct string_repr\" \\\n@@ -283,7 +285,9 @@ with_test_prefix \"varobj nscont\" {\n \t\"choose default visualizer\"\n }\n \n-mi_gdb_test \"python exception_flag = True\" \"\"\n+set cmd \"python exception_flag = True\"\n+set re [string_list_to_regexp & {\"} $cmd \\\\ n {\"} \\r\\n ^ done]\n+mi_gdb_test $cmd $re\n \n mi_create_dynamic_varobj nstype2 nstype2 1 \\\n   \"create nstype2 varobj\""
    },
    {
      "sha": "f6ee352b67eb4da64e7f2ad909cfde87fe742bbb",
      "filename": "gdb/testsuite/lib/mi-support.exp",
      "status": "modified",
      "additions": 24,
      "deletions": 4,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/lib/mi-support.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e36788d135499f18ffc7e528c5ac4bd5a560a5b9/gdb/testsuite/lib/mi-support.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/mi-support.exp?ref=e36788d135499f18ffc7e528c5ac4bd5a560a5b9",
      "patch": "@@ -691,16 +691,18 @@ proc mi_readnow { args } {\n     return $readnow_p\n }\n \n-# mi_gdb_test COMMAND PATTERN MESSAGE [IPATTERN] -- send a command to gdb; \n+# mi_gdb_test COMMAND [PATTERN [MESSAGE [IPATTERN]]] -- send a command to gdb;\n #   test the result.\n #\n # COMMAND is the command to execute, send to GDB with send_gdb.  If\n #   this is the null string no command is sent.\n # PATTERN is the pattern to match for a PASS, and must NOT include\n #   the \\r\\n sequence immediately before the gdb prompt.\n+#   If not specified, .* is used.\n # MESSAGE is the message to be printed.  (If this is the empty string,\n #   then sometimes we don't call pass or fail at all; I don't\n #   understand this at all.)\n+#   If not specified, COMMAND is used.\n # IPATTERN is the pattern to match for the inferior's output.  This parameter\n #   is optional.  If present, it will produce a PASS if the match is\n #   successful, and a FAIL if unsuccessful.\n@@ -717,9 +719,23 @@ proc mi_gdb_test { args } {\n     global inferior_exited_re async\n     upvar timeout timeout\n \n-    set command [lindex $args 0]\n-    set pattern [lindex $args 1]\n-    set message [lindex $args 2]\n+    if { [llength $args] >= 1 } then {\n+\tset command [lindex $args 0]\n+    } else {\n+\terror \"Not enough arguments in mi_gdb_test\"\n+    }\n+\n+    if { [llength $args] >= 2 } then {\n+\tset pattern [lindex $args 1]\n+    } else {\n+\tset pattern \".*\"\n+    }\n+\n+    if { [llength $args] >= 3 } then {\n+\tset message [lindex $args 2]\n+    } else {\n+\tset message $command\n+    }\n \n     if [llength $args]==4 {\n \tset ipattern [lindex $args 3]\n@@ -732,6 +748,10 @@ proc mi_gdb_test { args } {\n \tset question_string \"^FOOBAR$\"\n     }\n \n+    if { [llength $args] >= 6 } {\n+\terror \"Too many arguments in mi_gdb_test\"\n+    }\n+\n     if $verbose>2 then {\n \tsend_user \"Sending \\\"$command\\\" to gdb\\n\"\n \tsend_user \"Looking to match \\\"$pattern\\\"\\n\""
    }
  ]
}