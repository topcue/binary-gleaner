{
  "sha": "9223170f68f85787b9cd85e76d3bac3eaa69cafb",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTIyMzE3MGY2OGY4NTc4N2I5Y2Q4NWU3NmQzYmFjM2VhYTY5Y2FmYg==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2019-10-14T04:37:30Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2019-10-14T16:12:24Z"
    },
    "message": "gdb.mi/list-thread-groups-available.exp: read entries one by one instead of increasing timeout\n\nCommit 580f1034 (\"Increase timeout in\ngdb.mi/list-thread-groups-available.exp\") changed\ngdb.mi/list-thread-groups-available.exp to significantly increase the\ntimeout, which was necessary for when running with make check-read1.\n\nPedro suggested a better alternative, which is to use gdb_test_multiple\nand consume one entry at a time.  This patch does that.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.mi/list-thread-groups-available.exp: Read entries one by\n\tone instead of increasing timeout.\n\nChange-Id: I51b689458503240f24e401f054e6583d9172ebdf",
    "tree": {
      "sha": "701269c506c632fb511b9e136ef4e81688e1f757",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/701269c506c632fb511b9e136ef4e81688e1f757"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9223170f68f85787b9cd85e76d3bac3eaa69cafb",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9223170f68f85787b9cd85e76d3bac3eaa69cafb",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9223170f68f85787b9cd85e76d3bac3eaa69cafb",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9223170f68f85787b9cd85e76d3bac3eaa69cafb/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6acc1a0b9d3dd16741474891eddbf77415cd70b1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6acc1a0b9d3dd16741474891eddbf77415cd70b1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6acc1a0b9d3dd16741474891eddbf77415cd70b1"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 23,
    "deletions": 9
  },
  "files": [
    {
      "sha": "ce6e0f221a99424d933e5236cdbd82d547b5d0ba",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9223170f68f85787b9cd85e76d3bac3eaa69cafb/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9223170f68f85787b9cd85e76d3bac3eaa69cafb/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=9223170f68f85787b9cd85e76d3bac3eaa69cafb",
      "patch": "@@ -1,3 +1,8 @@\n+2019-10-14  Simon Marchi <simon.marchi@polymtl.ca>\n+\n+\t* gdb.mi/list-thread-groups-available.exp: Read entries one by\n+\tone instead of increasing timeout.\n+\n 2019-10-13  Tom de Vries  <tdevries@suse.de>\n \n \tPR record/25038"
    },
    {
      "sha": "3a7517ff484b1a3cee838cbce523a7d13361bffd",
      "filename": "gdb/testsuite/gdb.mi/list-thread-groups-available.exp",
      "status": "modified",
      "additions": 18,
      "deletions": 9,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9223170f68f85787b9cd85e76d3bac3eaa69cafb/gdb/testsuite/gdb.mi/list-thread-groups-available.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9223170f68f85787b9cd85e76d3bac3eaa69cafb/gdb/testsuite/gdb.mi/list-thread-groups-available.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.mi/list-thread-groups-available.exp?ref=9223170f68f85787b9cd85e76d3bac3eaa69cafb",
      "patch": "@@ -54,15 +54,24 @@ set cores_re \"cores=\\\\\\[(\\\"$decimal\\\"(,\\\"$decimal\\\")*)?\\\\\\]\"\n # List all available processes.\n set process_entry_re \"{${id_re},${type_re}(,$description_re)?(,$user_re)?(,$cores_re)?}\"\n \n-# Increase the timeout: when running with `make check-read1`, this can take\n-# a bit of time, as there is a lot of output generated, hence a lot of read\n-# syscalls.\n-with_read1_timeout_factor 10 {\n-    mi_gdb_test \\\n-\t\"-list-thread-groups --available\" \\\n-\t\"\\\\^done,groups=\\\\\\[${process_entry_re}(,$process_entry_re)*\\\\\\]\" \\\n-\t\"list available thread groups\"\n-}\n+# The list can be long, so read entries one by one to avoid hitting the\n+# timeout (especially when running with check-read1).\n+gdb_test_multiple \"-list-thread-groups --available\" \"list available thread groups\" {\n+    -re \"\\\\^done,groups=\\\\\\[\" {\n+\t# The beginning of the response.\n+\texp_continue\n+    }\n+\n+    -re \"${process_entry_re},\" {\n+\t# All entries except the last one.\n+\texp_continue\n+    }\n+\n+    -re \"${process_entry_re}\\\\\\]\\r\\n${mi_gdb_prompt}\" {\n+\t# The last entry.\n+\tpass $gdb_test_name\n+    }\n+} $mi_gdb_prompt\n \n # List specific processes, make sure there are two entries.\n set spawn_id_1 [remote_spawn target $binfile]"
    }
  ]
}