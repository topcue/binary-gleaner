{
  "sha": "7c80aab93666727965c2d5d6e17b1338d88293e0",
  "node_id": "C_kwDOANOeidoAKDdjODBhYWI5MzY2NjcyNzk2NWMyZDVkNmUxN2IxMzM4ZDg4MjkzZTA",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-11-18T15:54:34Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-11-18T15:58:52Z"
    },
    "message": "elf/x86: Issue an error on discarded output .plt section\n\nIssue an error, instead of crash, on discarded output .plt section.\n\nbfd/\n\n\tPR ld/28597\n\t* elf32-i386.c (elf_i386_finish_dynamic_sections): Issue an error\n\ton discarded output .plt section.\n\t* elf64-x86-64.c (elf_x86_64_finish_dynamic_sections): Likewise.\n\nld/\n\n\tPR ld/28597\n\t* testsuite/ld-elf/pr28597.d: New file.\n\t* testsuite/ld-elf/pr28597.s: Likewise.\n\t* testsuite/ld-elf/pr28597.t: Likewise.",
    "tree": {
      "sha": "afa7fa215c740c62255a2b2580804d466d8055b7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/afa7fa215c740c62255a2b2580804d466d8055b7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7c80aab93666727965c2d5d6e17b1338d88293e0",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7c80aab93666727965c2d5d6e17b1338d88293e0",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7c80aab93666727965c2d5d6e17b1338d88293e0",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7c80aab93666727965c2d5d6e17b1338d88293e0/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a0cfd0ca0ea26f157957c42b359b750c6f53d4bf",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a0cfd0ca0ea26f157957c42b359b750c6f53d4bf",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a0cfd0ca0ea26f157957c42b359b750c6f53d4bf"
    }
  ],
  "stats": {
    "total": 37,
    "additions": 37,
    "deletions": 0
  },
  "files": [
    {
      "sha": "0d7f29097e4bd271c8ab16dad4c66e5fe62051e1",
      "filename": "bfd/elf32-i386.c",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7c80aab93666727965c2d5d6e17b1338d88293e0/bfd/elf32-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7c80aab93666727965c2d5d6e17b1338d88293e0/bfd/elf32-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-i386.c?ref=7c80aab93666727965c2d5d6e17b1338d88293e0",
      "patch": "@@ -4017,6 +4017,14 @@ elf_i386_finish_dynamic_sections (bfd *output_bfd,\n \n   if (htab->elf.splt && htab->elf.splt->size > 0)\n     {\n+      if (bfd_is_abs_section (htab->elf.splt->output_section))\n+\t{\n+\t  info->callbacks->einfo\n+\t    (_(\"%F%P: discarded output section: `%pA'\\n\"),\n+\t     htab->elf.splt);\n+\t  return false;\n+\t}\n+\n       /* UnixWare sets the entsize of .plt to 4, although that doesn't\n \t really seem like the right value.  */\n       elf_section_data (htab->elf.splt->output_section)"
    },
    {
      "sha": "25e2bb156e8105e234e199238ab38eb540255638",
      "filename": "bfd/elf64-x86-64.c",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7c80aab93666727965c2d5d6e17b1338d88293e0/bfd/elf64-x86-64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7c80aab93666727965c2d5d6e17b1338d88293e0/bfd/elf64-x86-64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-x86-64.c?ref=7c80aab93666727965c2d5d6e17b1338d88293e0",
      "patch": "@@ -4677,6 +4677,14 @@ elf_x86_64_finish_dynamic_sections (bfd *output_bfd,\n \n   if (htab->elf.splt && htab->elf.splt->size > 0)\n     {\n+      if (bfd_is_abs_section (htab->elf.splt->output_section))\n+\t{\n+\t  info->callbacks->einfo\n+\t    (_(\"%F%P: discarded output section: `%pA'\\n\"),\n+\t     htab->elf.splt);\n+\t  return false;\n+\t}\n+\n       elf_section_data (htab->elf.splt->output_section)\n \t->this_hdr.sh_entsize = htab->plt.plt_entry_size;\n "
    },
    {
      "sha": "886182c120de1368e0dcd8a1839064f32094f037",
      "filename": "ld/testsuite/ld-elf/pr28597.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7c80aab93666727965c2d5d6e17b1338d88293e0/ld/testsuite/ld-elf/pr28597.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7c80aab93666727965c2d5d6e17b1338d88293e0/ld/testsuite/ld-elf/pr28597.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28597.d?ref=7c80aab93666727965c2d5d6e17b1338d88293e0",
      "patch": "@@ -0,0 +1,3 @@\n+#ld: -shared -T pr28597.t\n+#error: .*: discarded output section: `.plt'\n+#target: i?86-*-* x86_64-*-*"
    },
    {
      "sha": "620a6351cae635febe5fea01effa9b82205eb10b",
      "filename": "ld/testsuite/ld-elf/pr28597.s",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7c80aab93666727965c2d5d6e17b1338d88293e0/ld/testsuite/ld-elf/pr28597.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7c80aab93666727965c2d5d6e17b1338d88293e0/ld/testsuite/ld-elf/pr28597.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28597.s?ref=7c80aab93666727965c2d5d6e17b1338d88293e0",
      "patch": "@@ -0,0 +1,4 @@\n+\t.text\n+\t.globl\tfoo\n+foo:\n+\tjmp\tbar@PLT"
    },
    {
      "sha": "1f47a4558c759d8d12fdf3dd5dd21c55916d42c5",
      "filename": "ld/testsuite/ld-elf/pr28597.t",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7c80aab93666727965c2d5d6e17b1338d88293e0/ld/testsuite/ld-elf/pr28597.t",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7c80aab93666727965c2d5d6e17b1338d88293e0/ld/testsuite/ld-elf/pr28597.t",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28597.t?ref=7c80aab93666727965c2d5d6e17b1338d88293e0",
      "patch": "@@ -0,0 +1,14 @@\n+SECTIONS\n+{\n+  .text           :\n+  {\n+    *(.text .text.*)\n+  }\n+  /DISCARD/ : { *(.dynsym) }\n+  /DISCARD/ : { *(.dynstr*) }\n+  /DISCARD/ : { *(.dynamic*) }\n+  /DISCARD/ : { *(.plt*) }\n+  /DISCARD/ : { *(.interp*) }\n+  /DISCARD/ : { *(.gnu*) }\n+  /DISCARD/ : { *(.note.gnu.property) }\n+}"
    }
  ]
}