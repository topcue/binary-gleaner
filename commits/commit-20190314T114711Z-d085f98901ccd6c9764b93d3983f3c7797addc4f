{
  "sha": "d085f98901ccd6c9764b93d3983f3c7797addc4f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZDA4NWY5ODkwMWNjZDZjOTc2NGI5M2QzOTgzZjNjNzc5N2FkZGM0Zg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-03-08T20:54:07Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-03-14T11:47:11Z"
    },
    "message": "Add the \"set style source\" command\n\nThis adds \"set style source\" (and \"show style source\") commands.  This\ngives the user control over whether source code is highlighted.\n\ngdb/ChangeLog\n2019-03-14  Tom Tromey  <tromey@adacore.com>\n\n\t* NEWS: Add item for \"style sources\" commands.\n\t* source-cache.c (source_cache::get_source_lines): Check\n\tsource_styling.\n\t* cli/cli-style.c (source_styling): New global.\n\t(_initialize_cli_style): Add \"style sources\" commands.\n\t(show_style_sources): New function.\n\t* cli/cli-style.h (source_styling): Declare.\n\ngdb/doc/ChangeLog\n2019-03-14  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.texinfo (Output Styling): Document \"set style source\" and\n\t\"show style source\".\n\ngdb/testsuite/ChangeLog\n2019-03-14  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.base/style.exp: Add \"set style sources\" test.",
    "tree": {
      "sha": "bdd1be3d6e40f4b72782ae0db0da3fc80dfe93c2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/bdd1be3d6e40f4b72782ae0db0da3fc80dfe93c2"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/d085f98901ccd6c9764b93d3983f3c7797addc4f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d085f98901ccd6c9764b93d3983f3c7797addc4f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/d085f98901ccd6c9764b93d3983f3c7797addc4f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d085f98901ccd6c9764b93d3983f3c7797addc4f/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6f11e6824e15bd40fe1e7b245a22865c6ef8c7bd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6f11e6824e15bd40fe1e7b245a22865c6ef8c7bd",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6f11e6824e15bd40fe1e7b245a22865c6ef8c7bd"
    }
  ],
  "stats": {
    "total": 75,
    "additions": 74,
    "deletions": 1
  },
  "files": [
    {
      "sha": "787949c5d93fa07db176554f28f2c5c96dc37316",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -1,3 +1,13 @@\n+2019-03-14  Tom Tromey  <tromey@adacore.com>\n+\n+\t* NEWS: Add item for \"style sources\" commands.\n+\t* source-cache.c (source_cache::get_source_lines): Check\n+\tsource_styling.\n+\t* cli/cli-style.c (source_styling): New global.\n+\t(_initialize_cli_style): Add \"style sources\" commands.\n+\t(show_style_sources): New function.\n+\t* cli/cli-style.h (source_styling): Declare.\n+\n 2019-03-14  Pedro Alves  <palves@redhat.com>\n \t    Tom Tromey  <tromey@adacore.com>\n "
    },
    {
      "sha": "c45b3134064a9ff8347c89f44f90bdb43639e8ef",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -140,6 +140,12 @@ show style enabled\n   Enable or disable terminal styling.  Styling is enabled by default\n   on most hosts, but disabled by default when in batch mode.\n \n+set style sources [on|off]\n+show style sources\n+  Enable or disable source code styling.  Source code styling is\n+  enabled by default, but only takes effect if styling in general is\n+  enabled, and if GDB was linked with GNU Source Highlight.\n+\n set style filename foreground COLOR\n set style filename background COLOR\n set style filename intensity VALUE"
    },
    {
      "sha": "f6f6c7be5d923517f4bc9d039801794088af9823",
      "filename": "gdb/cli/cli-style.c",
      "status": "modified",
      "additions": 29,
      "deletions": 0,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/cli/cli-style.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/cli/cli-style.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-style.c?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -31,6 +31,11 @@ int cli_styling = 0;\n int cli_styling = 1;\n #endif\n \n+/* True if source styling is enabled.  Note that this is only\n+   consulted when cli_styling is true.  */\n+\n+int source_styling = 1;\n+\n /* Name of colors; must correspond to ui_file_style::basic_color.  */\n static const char * const cli_colors[] = {\n   \"none\",\n@@ -230,6 +235,16 @@ show_style_enabled (struct ui_file *file, int from_tty,\n     fprintf_filtered (file, _(\"CLI output styling is disabled.\\n\"));\n }\n \n+static void\n+show_style_sources (struct ui_file *file, int from_tty,\n+\t\t    struct cmd_list_element *c, const char *value)\n+{\n+  if (source_styling)\n+    fprintf_filtered (file, _(\"Source code styling is enabled.\\n\"));\n+  else\n+    fprintf_filtered (file, _(\"Source code styling is disabled.\\n\"));\n+}\n+\n void\n _initialize_cli_style ()\n {\n@@ -249,6 +264,20 @@ If enabled, output to the terminal is styled.\"),\n \t\t\t   set_style_enabled, show_style_enabled,\n \t\t\t   &style_set_list, &style_show_list);\n \n+  add_setshow_boolean_cmd (\"sources\", no_class, &source_styling, _(\"\\\n+Set whether source code styling is enabled.\"), _(\"\\\n+Show whether source code styling is enabled.\"), _(\"\\\n+If enabled, source code is styled.\\n\"\n+#ifdef HAVE_SOURCE_HIGHLIGHT\n+\"Note that source styling only works if styling in general is enabled,\\n\\\n+see \\\"show style enabled\\\".\"\n+#else\n+\"Source highlighting is disabled in this installation of gdb, because\\n\\\n+it was not linked against GNU Source Highlight.\"\n+#endif\n+\t\t\t   ), set_style_enabled, show_style_sources,\n+\t\t\t   &style_set_list, &style_show_list);\n+\n #define STYLE_ADD_SETSHOW_COMMANDS(STYLE, NAME, PREFIX_DOC)\t  \\\n   STYLE.add_setshow_commands (NAME, no_class, PREFIX_DOC,\t\t\\\n \t\t\t      &style_set_list,\t\t\t\t\\"
    },
    {
      "sha": "c0520f9e23f336977bd61599458fae6a5954ead0",
      "filename": "gdb/cli/cli-style.h",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/cli/cli-style.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/cli/cli-style.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-style.h?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -93,6 +93,9 @@ extern cli_style_option variable_name_style;\n /* The address style.  */\n extern cli_style_option address_style;\n \n+/* True if source styling is enabled.  */\n+extern int source_styling;\n+\n /* True if styling is enabled.  */\n extern int cli_styling;\n "
    },
    {
      "sha": "1b7dabffa2215d9d5f2f65c8135d1751a04d56d4",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -1,3 +1,8 @@\n+2019-03-14  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.texinfo (Output Styling): Document \"set style source\" and\n+\t\"show style source\".\n+\n 2019-03-13  Simon Marchi  <simon.marchi@ericsson.com>\n \n \t* gdb.texinfo (Mode Options): Mention mi3."
    },
    {
      "sha": "431752b4110b0982cb563dded060a6fb5d7cec8f",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -24525,6 +24525,16 @@ most hosts defaulting to @samp{on}.\n \n @item show style enabled\n Show the current state of styling.\n+\n+@item set style sources @samp{on|off}\n+Enable or disable source code styling.  This affects whether source\n+code, such as the output of the @code{list} command, is styled.  Note\n+that source styling only works if styling in general is enabled, and\n+if @value{GDBN} was linked with the GNU Source Highlight library.  The\n+default is @samp{on}.\n+\n+@item show style sources\n+Show the current state of source code styling.\n @end table\n \n Subcommands of @code{set style} control specific forms of styling."
    },
    {
      "sha": "3b15b3f28895dcd86632ee59fa66fd0fd4efd8a5",
      "filename": "gdb/source-cache.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/source-cache.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/source-cache.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source-cache.c?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -180,7 +180,7 @@ source_cache::get_source_lines (struct symtab *s, int first_line,\n     return false;\n \n #ifdef HAVE_SOURCE_HIGHLIGHT\n-  if (can_emit_style_escape (gdb_stdout))\n+  if (source_styling && can_emit_style_escape (gdb_stdout))\n     {\n       const char *fullname = symtab_to_fullname (s);\n "
    },
    {
      "sha": "523013bf9b2844ad467cce08897fea7fae4f2dcc",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -1,3 +1,7 @@\n+2019-03-14  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.base/style.exp: Add \"set style sources\" test.\n+\n 2019-03-13  Simon Marchi  <simon.marchi@ericsson.com>\n \n \t* mi-breakpoint-location-ena-dis.exp: Rename to ..."
    },
    {
      "sha": "369c1f59a88b32127232e9f7223d5034113489ab",
      "filename": "gdb/testsuite/gdb.base/style.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/testsuite/gdb.base/style.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/d085f98901ccd6c9764b93d3983f3c7797addc4f/gdb/testsuite/gdb.base/style.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/style.exp?ref=d085f98901ccd6c9764b93d3983f3c7797addc4f",
      "patch": "@@ -50,6 +50,12 @@ save_vars { env(TERM) } {\n \t\"$main_expr.*$arg_expr.*$arg_expr.*$file_expr.*\"\n     gdb_test \"info breakpoints\" \"$main_expr at $file_expr.*\"\n \n+    gdb_test_no_output \"set style sources off\"\n+    gdb_test \"frame\" \\\n+\t\"\\r\\n\\[^\\033\\]*break here.*\" \\\n+\t\"frame without styling\"\n+    gdb_test_no_output \"set style sources on\"\n+\n     gdb_test \"break main\" \"file $base_file_expr.*\"\n \n     gdb_test \"print &main\" \" = .* \\033\\\\\\[34m$hex\\033\\\\\\[m <$main_expr>\""
    }
  ]
}