{
  "sha": "b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjMyNjMyYzQ5OTY4Y2QwM2U5NTJmOWI2M2IzMmQ5ZTlmMWRkYWY1Mw==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-05-28T11:21:04Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-05-28T11:21:16Z"
    },
    "message": "ld: Add --enable-textrel-check=[no|yes|warning|error]\n\nAdd a configure option, --enable-textrel-check=[no|yes|warning|error],\nto decide what ELF linker should do by default with DT_TEXTREL in an\nexecutable or shared library.\n\n\tPR ld/20824\n\t* NEWS: Mention --enable-textrel-check=[no|yes|warning|error].\n\t* configure.ac: Add --enable-textrel-check=[no|yes|warning|error].\n\t(DEFAULT_LD_TEXTREL_CHECK): New AC_DEFINE_UNQUOTED.\n\t(DEFAULT_LD_TEXTREL_CHECK_WARNING): Likewise.\n\t* ldmain.c (main): Initialize link_info.textrel_check to\n\tDEFAULT_LD_TEXTREL_CHECK.\n\t* lexsup.c (ld_options): Check DEFAULT_LD_TEXTREL_CHECK_WARNING.\n\t* config.in: Regenerated.\n\t* configure: Likewise.",
    "tree": {
      "sha": "49233e497456cbd09e444e4f4aad77f009c681a7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/49233e497456cbd09e444e4f4aad77f009c681a7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "151f5de4a6548cd83a79b4705f1e901776ddacc5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/151f5de4a6548cd83a79b4705f1e901776ddacc5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/151f5de4a6548cd83a79b4705f1e901776ddacc5"
    }
  ],
  "stats": {
    "total": 101,
    "additions": 98,
    "deletions": 3
  },
  "files": [
    {
      "sha": "aac749cadaad116bab6a504852728fb4b2c4f621",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -1,3 +1,16 @@\n+2020-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/20824\n+\t* NEWS: Mention --enable-textrel-check=[no|yes|warning|error].\n+\t* configure.ac: Add --enable-textrel-check=[no|yes|warning|error].\n+\t(DEFAULT_LD_TEXTREL_CHECK): New AC_DEFINE_UNQUOTED.\n+\t(DEFAULT_LD_TEXTREL_CHECK_WARNING): Likewise.\n+\t* ldmain.c (main): Initialize link_info.textrel_check to\n+\tDEFAULT_LD_TEXTREL_CHECK.\n+\t* lexsup.c (ld_options): Check DEFAULT_LD_TEXTREL_CHECK_WARNING.\n+\t* config.in: Regenerated.\n+\t* configure: Likewise.\n+\n 2020-05-28  Nick Clifton  <nickc@redhat.com>\n \n \t* lexsup.c (parse_args): Generate an error if a name is not"
    },
    {
      "sha": "62b74b1ac9f44ab701ea624ecc7cb954c3465b98",
      "filename": "ld/NEWS",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/NEWS?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -1,5 +1,9 @@\n -*- text -*-\n \n+* Add a configure option, --enable-textrel-check=[no|yes|warning|error],\n+  to decide what ELF linker should do by default with DT_TEXTREL in an\n+  executable or shared library.\n+\n * The -Map=<filename> command line option has been extended so that if\n   <filename> is a directory then <filename>/<output-filename>.map will be\n   created."
    },
    {
      "sha": "8cadcba60f1ccd213e4c8e48cd8eefa25b8c5e74",
      "filename": "ld/config.in",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/config.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/config.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/config.in?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -16,6 +16,12 @@\n /* Define if you want compressed debug sections by default. */\n #undef DEFAULT_FLAG_COMPRESS_DEBUG\n \n+/* The default method for DT_TEXTREL check in ELF linker. */\n+#undef DEFAULT_LD_TEXTREL_CHECK\n+\n+/* Define to 1 if DT_TEXTREL check is warning in ELF linker by default. */\n+#undef DEFAULT_LD_TEXTREL_CHECK_WARNING\n+\n /* Define to 1 if you want to enable -z relro in ELF linker by default. */\n #undef DEFAULT_LD_Z_RELRO\n "
    },
    {
      "sha": "e70e7c304b13c9e20fcf758c8e0a1aa9b87dd91b",
      "filename": "ld/configure",
      "status": "modified",
      "additions": 39,
      "deletions": 2,
      "changes": 41,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/configure?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -831,6 +831,7 @@ enable_got\n enable_compressed_debug_sections\n enable_new_dtags\n enable_relro\n+enable_textrel_check\n enable_separate_code\n enable_default_hash_style\n enable_werror\n@@ -1498,6 +1499,8 @@ Optional Features:\n                           compress debug sections by default]\n   --enable-new-dtags      set DT_RUNPATH instead of DT_RPATH by default]\n   --enable-relro          enable -z relro in ELF linker by default\n+  --enable-textrel-check=[yes|no|warning|error]\n+                          enable DT_TEXTREL check in ELF linker\n   --enable-separate-code  enable -z separate-code in ELF linker by default\n   --enable-default-hash-style={sysv,gnu,both}\n                           use this default hash style\n@@ -12032,7 +12035,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12035 \"configure\"\n+#line 12038 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -12138,7 +12141,7 @@ else\n   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2\n   lt_status=$lt_dlunknown\n   cat > conftest.$ac_ext <<_LT_EOF\n-#line 12141 \"configure\"\n+#line 12144 \"configure\"\n #include \"confdefs.h\"\n \n #if HAVE_DLFCN_H\n@@ -15876,6 +15879,16 @@ if test \"${enable_relro+set}\" = set; then :\n esac\n fi\n \n+# Decide if DT_TEXTREL check should be enabled in ELF linker.\n+ac_default_ld_textrel_check=unset\n+# Check whether --enable-textrel-check was given.\n+if test \"${enable_textrel_check+set}\" = set; then :\n+  enableval=$enable_textrel_check; case \"${enableval}\" in\n+  yes|no|warning|error) ac_default_ld_textrel_check=${enableval} ;;\n+esac\n+fi\n+\n+\n # Decide if -z separate-code should be enabled in ELF linker by default.\n ac_default_ld_z_separate_code=unset\n # Check whether --enable-separate-code was given.\n@@ -17618,6 +17631,30 @@ cat >>confdefs.h <<_ACEOF\n _ACEOF\n \n \n+ac_default_ld_textrel_check_warning=0\n+case \"${ac_default_ld_textrel_check}\" in\n+  unset|no)\n+    ac_default_ld_textrel_check=textrel_check_none\n+    ;;\n+  yes|warning)\n+    ac_default_ld_textrel_check=textrel_check_warning\n+    ac_default_ld_textrel_check_warning=1\n+    ;;\n+  error)\n+    ac_default_ld_textrel_check=textrel_check_error\n+    ;;\n+esac\n+\n+cat >>confdefs.h <<_ACEOF\n+#define DEFAULT_LD_TEXTREL_CHECK $ac_default_ld_textrel_check\n+_ACEOF\n+\n+\n+cat >>confdefs.h <<_ACEOF\n+#define DEFAULT_LD_TEXTREL_CHECK_WARNING $ac_default_ld_textrel_check_warning\n+_ACEOF\n+\n+\n if test \"${ac_default_ld_z_separate_code}\" = unset; then\n   ac_default_ld_z_separate_code=0\n fi"
    },
    {
      "sha": "99957df3763bd3e1587fe71070553873dce30b42",
      "filename": "ld/configure.ac",
      "status": "modified",
      "additions": 29,
      "deletions": 0,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/configure.ac?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -176,6 +176,15 @@ AC_ARG_ENABLE(relro,\n   no)  ac_default_ld_z_relro=0 ;;\n esac])dnl\n \n+# Decide if DT_TEXTREL check should be enabled in ELF linker.\n+ac_default_ld_textrel_check=unset\n+AC_ARG_ENABLE([textrel-check],\n+\t      AC_HELP_STRING([--enable-textrel-check=@<:@yes|no|warning|error@:>@],\n+\t\t\t     [enable DT_TEXTREL check in ELF linker]),\n+[case \"${enableval}\" in\n+  yes|no|warning|error) ac_default_ld_textrel_check=${enableval} ;;\n+esac])\n+\n # Decide if -z separate-code should be enabled in ELF linker by default.\n ac_default_ld_z_separate_code=unset\n AC_ARG_ENABLE(separate-code,\n@@ -447,6 +456,26 @@ AC_DEFINE_UNQUOTED(DEFAULT_LD_Z_RELRO,\n   $ac_default_ld_z_relro,\n   [Define to 1 if you want to enable -z relro in ELF linker by default.])\n \n+ac_default_ld_textrel_check_warning=0\n+case \"${ac_default_ld_textrel_check}\" in\n+  unset|no)\n+    ac_default_ld_textrel_check=textrel_check_none\n+    ;;\n+  yes|warning)\n+    ac_default_ld_textrel_check=textrel_check_warning\n+    ac_default_ld_textrel_check_warning=1\n+    ;;\n+  error)\n+    ac_default_ld_textrel_check=textrel_check_error\n+    ;;\n+esac\n+AC_DEFINE_UNQUOTED(DEFAULT_LD_TEXTREL_CHECK,\n+  $ac_default_ld_textrel_check,\n+  [The default method for DT_TEXTREL check in ELF linker.])\n+AC_DEFINE_UNQUOTED(DEFAULT_LD_TEXTREL_CHECK_WARNING,\n+  $ac_default_ld_textrel_check_warning,\n+  [Define to 1 if DT_TEXTREL check is warning in ELF linker by default.])\n+\n if test \"${ac_default_ld_z_separate_code}\" = unset; then\n   ac_default_ld_z_separate_code=0\n fi"
    },
    {
      "sha": "e2c559ea3e03fc7d8250ba2327f70d293c788455",
      "filename": "ld/ldmain.c",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/ldmain.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/ldmain.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldmain.c?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -286,6 +286,7 @@ main (int argc, char **argv)\n   link_info.combreloc = TRUE;\n   link_info.strip_discarded = TRUE;\n   link_info.prohibit_multiple_definition_absolute = FALSE;\n+  link_info.textrel_check = DEFAULT_LD_TEXTREL_CHECK;\n   link_info.emit_hash = DEFAULT_EMIT_SYSV_HASH;\n   link_info.emit_gnu_hash = DEFAULT_EMIT_GNU_HASH;\n   link_info.callbacks = &link_callbacks;"
    },
    {
      "sha": "412e2e60267119192073359c87ec904371130011",
      "filename": "ld/lexsup.c",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/lexsup.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b32632c49968cd03e952f9b63b32d9e9f1ddaf53/ld/lexsup.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/lexsup.c?ref=b32632c49968cd03e952f9b63b32d9e9f1ddaf53",
      "patch": "@@ -517,7 +517,12 @@ static const struct ld_option ld_options[] =\n     '\\0', NULL, N_(\"Warn if start of section changes due to alignment\"),\n     TWO_DASHES },\n   { {\"warn-textrel\", no_argument, NULL, OPTION_WARN_TEXTREL},\n-    '\\0', NULL, N_(\"Warn if outpout has DT_TEXTREL\"),\n+    '\\0', NULL,\n+#if DEFAULT_LD_TEXTREL_CHECK_WARNING\n+    N_(\"Warn if outpout has DT_TEXTREL (default)\"),\n+#else\n+    N_(\"Warn if outpout has DT_TEXTREL\"),\n+#endif\n     TWO_DASHES },\n   { {\"warn-shared-textrel\", no_argument, NULL, OPTION_WARN_TEXTREL},\n     '\\0', NULL, NULL, NO_HELP },"
    }
  ]
}