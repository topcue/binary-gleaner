{
  "sha": "7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzM2MWY5MDhkYTlmYmVjZWIwYjY1YWM4OWIzZGNlY2M0ZDhjNTdjMg==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-09-16T11:27:32Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-09-16T11:27:32Z"
    },
    "message": "[gdb/testsuite] Catch condition evaluation errors in gdb_assert\n\nWhen running test-case gdb.base/watchpoint-stops-at-right-insn.exp, we may run\ninto a tcl error, which can be reproduced reliably using this trigger patch:\n...\n+       set hw_watch_pc \"\"\n        gdb_assert {$sw_watch_pc == $hw_watch_pc} \\\n\t  \"hw watchpoint stops at right instruction\"\n...\nsuch that we have:\n...\nERROR: tcl error sourcing watchpoint-stops-at-right-insn.exp.\nERROR: missing operand at _@_\nin expression \"0x4004b7 == _@_\"\n    (parsing expression \"0x4004b7 == \")\n    invoked from within\n\"expr $sw_watch_pc == $hw_watch_pc\"\n    (\"uplevel\" body line 1)\n    invoked from within\n\"uplevel 1 expr $condition\"\n    (procedure \"gdb_assert\" line 6)\n    invoked from within\n\"gdb_assert {$sw_watch_pc == $hw_watch_pc} \\\n  \"hw watchpoint stops at right instruction\"\"\n...\n\nA similar problem was fixed in commit 5f0e2eb79e \"GDB/testsuite: Fix a\ncatastrophic step-over-no-symbols.exp failure\", by making the assert condition\nmore robust:\n...\n-    gdb_assert {$before_addr != $after_addr} \"advanced\"\n+    gdb_assert {{[string is integer -strict $before_addr] \\\n+                && [string is integer -strict $after_addr] \\\n+                && $before_addr != $after_addr}} \"advanced\"\n...\n\nFix this instead in gdb_assert, by catching errors while evaluating the assert\ncondition.\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2020-09-16  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/26624\n\t* lib/gdb.exp (gdb_assert): Catch errors in condition evaluation.",
    "tree": {
      "sha": "c100194cb0621884f1e9842a8e6e7b088897c5ec",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c100194cb0621884f1e9842a8e6e7b088897c5ec"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0e25e7672778082e2934c378403ad8b57249d80f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0e25e7672778082e2934c378403ad8b57249d80f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0e25e7672778082e2934c378403ad8b57249d80f"
    }
  ],
  "stats": {
    "total": 9,
    "additions": 7,
    "deletions": 2
  },
  "files": [
    {
      "sha": "481d18a32177e14e7f8b0decf4c40143192ad5d2",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2",
      "patch": "@@ -1,3 +1,8 @@\n+2020-09-16  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/26624\n+\t* lib/gdb.exp (gdb_assert): Catch errors in condition evaluation.\n+\n 2020-09-16  Tom de Vries  <tdevries@suse.de>\n \n \tPR testsuite/26618"
    },
    {
      "sha": "59439f8e37975acffb006e07e738ab73ec2183e1",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=7361f908da9fbeceb0b65ac89b3dcecc4d8c57c2",
      "patch": "@@ -1689,8 +1689,8 @@ proc gdb_assert { condition {message \"\"} } {\n \tset message $condition\n     }\n \n-    set res [uplevel 1 expr $condition]\n-    if {!$res} {\n+    set code [catch {uplevel 1 expr $condition} res]\n+    if {$code != 0 || !$res} {\n \tfail $message\n     } else {\n \tpass $message"
    }
  ]
}