{
  "sha": "5923a04c0c489054d275e3b0441626ce1ae7344a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTkyM2EwNGMwYzQ4OTA1NGQyNzVlM2IwNDQxNjI2Y2UxYWU3MzQ0YQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2018-05-10T22:23:53Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-01-10T14:08:13Z"
    },
    "message": "Allocate the address map on the psymtab obstack\n\nAfter this patch, the psymtab address map will now be allocated on the\npsymtab obstack rather than the objfile obstack.  This also changes\nthe psymtab storage object to make the obstack private; this will be\nused later.\n\ngdb/ChangeLog\n2019-01-10  Tom Tromey  <tom@tromey.com>\n\n\t* psymtab.h (psymtab_storage::obstack): New method.\n\t<m_obstack>: Rename from obstack; now private.\n\t* psymtab.c (psymtab_storage): Update.\n\t* dwarf2read.c (create_addrmap_from_index)\n\t(create_addrmap_from_aranges, dwarf2_build_psymtabs_hard):\n\tUpdate.",
    "tree": {
      "sha": "b295769dbfebc8aa112b435e6075067764ad54d3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b295769dbfebc8aa112b435e6075067764ad54d3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5923a04c0c489054d275e3b0441626ce1ae7344a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5923a04c0c489054d275e3b0441626ce1ae7344a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5923a04c0c489054d275e3b0441626ce1ae7344a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5923a04c0c489054d275e3b0441626ce1ae7344a/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6d6a12bf87bc6dd89b2533b5d0490fdcc00df9ad",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6d6a12bf87bc6dd89b2533b5d0490fdcc00df9ad",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6d6a12bf87bc6dd89b2533b5d0490fdcc00df9ad"
    }
  ],
  "stats": {
    "total": 36,
    "additions": 27,
    "deletions": 9
  },
  "files": [
    {
      "sha": "81f07f774d96acea8af2499e50c0f0c022756213",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=5923a04c0c489054d275e3b0441626ce1ae7344a",
      "patch": "@@ -1,3 +1,12 @@\n+2019-01-10  Tom Tromey  <tom@tromey.com>\n+\n+\t* psymtab.h (psymtab_storage::obstack): New method.\n+\t<m_obstack>: Rename from obstack; now private.\n+\t* psymtab.c (psymtab_storage): Update.\n+\t* dwarf2read.c (create_addrmap_from_index)\n+\t(create_addrmap_from_aranges, dwarf2_build_psymtabs_hard):\n+\tUpdate.\n+\n 2019-01-10  Tom Tromey  <tom@tromey.com>\n \n \t* symfile.c (reread_symbols): Call objfile->reset_psymtabs."
    },
    {
      "sha": "97ca3414b02aeaf5a1034a3b09484229d75ccc97",
      "filename": "gdb/dwarf2read.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/dwarf2read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/dwarf2read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.c?ref=5923a04c0c489054d275e3b0441626ce1ae7344a",
      "patch": "@@ -3191,7 +3191,7 @@ create_addrmap_from_index (struct dwarf2_per_objfile *dwarf2_per_objfile,\n     }\n \n   objfile->partial_symtabs->psymtabs_addrmap\n-    = addrmap_create_fixed (mutable_map, &objfile->objfile_obstack);\n+    = addrmap_create_fixed (mutable_map, objfile->partial_symtabs->obstack ());\n }\n \n /* Read the address map data from DWARF-5 .debug_aranges, and use it to\n@@ -3352,7 +3352,7 @@ create_addrmap_from_aranges (struct dwarf2_per_objfile *dwarf2_per_objfile,\n     }\n \n   objfile->partial_symtabs->psymtabs_addrmap\n-    = addrmap_create_fixed (mutable_map, &objfile->objfile_obstack);\n+    = addrmap_create_fixed (mutable_map, objfile->partial_symtabs->obstack ());\n }\n \n /* Find a slot in the mapped index INDEX for the object named NAME.\n@@ -8491,7 +8491,7 @@ dwarf2_build_psymtabs_hard (struct dwarf2_per_objfile *dwarf2_per_objfile)\n \n   objfile->partial_symtabs->psymtabs_addrmap\n     = addrmap_create_fixed (objfile->partial_symtabs->psymtabs_addrmap,\n-\t\t\t    &objfile->objfile_obstack);\n+\t\t\t    objfile->partial_symtabs->obstack ());\n   /* At this point we want to keep the address map.  */\n   save_psymtabs_addrmap.release ();\n "
    },
    {
      "sha": "e18544126777dee31802578573649f69ddcd946e",
      "filename": "gdb/psymtab.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/psymtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/psymtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psymtab.c?ref=5923a04c0c489054d275e3b0441626ce1ae7344a",
      "patch": "@@ -68,8 +68,8 @@ static struct compunit_symtab *psymtab_to_symtab (struct objfile *objfile,\n \f\n \n psymtab_storage::psymtab_storage (struct objfile *objfile)\n-  : obstack (&objfile->objfile_obstack),\n-    psymbol_cache (psymbol_bcache_init ())\n+  : psymbol_cache (psymbol_bcache_init ()),\n+    m_obstack (&objfile->objfile_obstack)\n {\n }\n "
    },
    {
      "sha": "d0e596980d12d12548f9c755175c973199705c1e",
      "filename": "gdb/psymtab.h",
      "status": "modified",
      "additions": 13,
      "deletions": 4,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/psymtab.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5923a04c0c489054d275e3b0441626ce1ae7344a/gdb/psymtab.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psymtab.h?ref=5923a04c0c489054d275e3b0441626ce1ae7344a",
      "patch": "@@ -55,6 +55,13 @@ class psymtab_storage\n \n   void discard_psymtab (struct partial_symtab *pst);\n \n+  /* Return the obstack that is used for storage by this object.  */\n+\n+  struct obstack *obstack ()\n+  {\n+    return m_obstack;\n+  }\n+\n \n   /* Each objfile points to a linked list of partial symtabs derived from\n      this file, one partial symtab structure for each compilation unit\n@@ -73,10 +80,6 @@ class psymtab_storage\n \n   struct partial_symtab *free_psymtabs = nullptr;\n \n-  /* The obstack where allocations are made.  */\n-\n-  struct obstack *obstack;\n-\n   /* A byte cache where we can stash arbitrary \"chunks\" of bytes that\n      will not change.  */\n \n@@ -87,6 +90,12 @@ class psymtab_storage\n \n   std::vector<partial_symbol *> global_psymbols;\n   std::vector<partial_symbol *> static_psymbols;\n+\n+private:\n+\n+  /* The obstack where allocations are made.  */\n+\n+  struct obstack *m_obstack;\n };\n \n "
    }
  ]
}