{
  "sha": "0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDgwN2FiN2I4OGZhNWZmYjEzOGJhMWVlMjJiMzNkMjZlMjM5ZGUyZg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-06-24T03:25:46Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-07-17T18:18:53Z"
    },
    "message": "Remove deleted breakpoint from TUI display\n\nPR tui/24722 points out that deleting a breakpoint does not cause the\n\"b\" to be removed from the breakpoint display.  The issue here was\nthat the breakpoint still exists at the moment the breakpoint-deleted\nobserver is notified.  This fixes the problem by specially handling\nthe case where a breakpoint is being removed.\n\ngdb/ChangeLog\n2019-07-17  Tom Tromey  <tom@tromey.com>\n\n\tPR tui/24722:\n\t* tui/tui-winsource.h (tui_update_all_breakpoint_info)\n\t(tui_update_breakpoint_info): Add \"being_deleted\" parameter.\n\t* tui/tui-winsource.c (tui_update_source_window_as_is): Update.\n\t(tui_update_all_breakpoint_info): Add \"being_deleted\" parameter.\n\t(tui_update_breakpoint_info): Likewise.\n\t* tui/tui-hooks.c (tui_event_create_breakpoint)\n\t(tui_event_delete_breakpoint, tui_event_modify_breakpoint):\n\tUpdate.",
    "tree": {
      "sha": "6402a1b4ade428cb8779fe777d1678ef0a8c30a7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6402a1b4ade428cb8779fe777d1678ef0a8c30a7"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9ad7fdef7c72b2aca0398ce8e63b89e560873807",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9ad7fdef7c72b2aca0398ce8e63b89e560873807",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9ad7fdef7c72b2aca0398ce8e63b89e560873807"
    }
  ],
  "stats": {
    "total": 66,
    "additions": 44,
    "deletions": 22
  },
  "files": [
    {
      "sha": "6635cbfb1a2f8bc6bd8c8da96f4a3ef2545852de",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
      "patch": "@@ -1,3 +1,15 @@\n+2019-07-17  Tom Tromey  <tom@tromey.com>\n+\n+\tPR tui/24722:\n+\t* tui/tui-winsource.h (tui_update_all_breakpoint_info)\n+\t(tui_update_breakpoint_info): Add \"being_deleted\" parameter.\n+\t* tui/tui-winsource.c (tui_update_source_window_as_is): Update.\n+\t(tui_update_all_breakpoint_info): Add \"being_deleted\" parameter.\n+\t(tui_update_breakpoint_info): Likewise.\n+\t* tui/tui-hooks.c (tui_event_create_breakpoint)\n+\t(tui_event_delete_breakpoint, tui_event_modify_breakpoint):\n+\tUpdate.\n+\n 2019-07-17  Tom Tromey  <tom@tromey.com>\n \n \t* tui/tui-stack.c (tui_show_frame_info): Consolidate \"if\"s."
    },
    {
      "sha": "710105307499e59dc274abfb6153535da0051984",
      "filename": "gdb/tui/tui-hooks.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/tui/tui-hooks.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/tui/tui-hooks.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-hooks.c?ref=0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
      "patch": "@@ -91,21 +91,21 @@ tui_register_changed (struct frame_info *frame, int regno)\n static void\n tui_event_create_breakpoint (struct breakpoint *b)\n {\n-  tui_update_all_breakpoint_info ();\n+  tui_update_all_breakpoint_info (nullptr);\n }\n \n /* Breakpoint deletion hook.\n    Refresh the screen to update the breakpoint marks.  */\n static void\n tui_event_delete_breakpoint (struct breakpoint *b)\n {\n-  tui_update_all_breakpoint_info ();\n+  tui_update_all_breakpoint_info (b);\n }\n \n static void\n tui_event_modify_breakpoint (struct breakpoint *b)\n {\n-  tui_update_all_breakpoint_info ();\n+  tui_update_all_breakpoint_info (nullptr);\n }\n \n /* Refresh TUI's frame and register information.  This is a hook intended to be"
    },
    {
      "sha": "22cd54ee9b8ade2a682f4d98e835f29db3b87070",
      "filename": "gdb/tui/tui-winsource.c",
      "status": "modified",
      "additions": 16,
      "deletions": 13,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/tui/tui-winsource.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/tui/tui-winsource.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-winsource.c?ref=0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
      "patch": "@@ -106,7 +106,7 @@ tui_update_source_window_as_is (struct tui_source_window_base *win_info,\n     }\n   else\n     {\n-      tui_update_breakpoint_info (win_info, 0);\n+      tui_update_breakpoint_info (win_info, nullptr, false);\n       tui_show_source_content (win_info);\n       tui_update_exec_info (win_info);\n       if (win_info->type == SRC_WIN)\n@@ -382,34 +382,34 @@ tui_source_window_base::set_is_exec_point_at (struct tui_line_or_address l)\n     refill ();\n }\n \n-/* Update the execution windows to show the active breakpoints.\n-   This is called whenever a breakpoint is inserted, removed or\n-   has its state changed.  */\n+/* See tui-winsource.h.  */\n+\n void\n-tui_update_all_breakpoint_info ()\n+tui_update_all_breakpoint_info (struct breakpoint *being_deleted)\n {\n   for (tui_source_window_base *win : tui_source_windows ())\n     {\n-      if (tui_update_breakpoint_info (win, FALSE))\n+      if (tui_update_breakpoint_info (win, being_deleted, false))\n         {\n           tui_update_exec_info (win);\n         }\n     }\n }\n \n \n-/* Scan the source window and the breakpoints to update the has_break\n+/* Scan the source window and the breakpoints to update the break_mode\n    information for each line.\n \n-   Returns 1 if something changed and the execution window must be\n+   Returns true if something changed and the execution window must be\n    refreshed.  */\n \n-int\n-tui_update_breakpoint_info (struct tui_source_window_base *win, \n-\t\t\t    int current_only)\n+bool\n+tui_update_breakpoint_info (struct tui_source_window_base *win,\n+\t\t\t    struct breakpoint *being_deleted,\n+\t\t\t    bool current_only)\n {\n   int i;\n-  int need_refresh = 0;\n+  bool need_refresh = false;\n   tui_source_window_base *src = (tui_source_window_base *) win;\n \n   for (i = 0; i < win->content.size (); i++)\n@@ -435,6 +435,9 @@ tui_update_breakpoint_info (struct tui_source_window_base *win,\n \t  gdb_assert (line->line_or_addr.loa == LOA_LINE\n \t\t      || line->line_or_addr.loa == LOA_ADDRESS);\n \n+\t  if (bp == being_deleted)\n+\t    continue;\n+\n \t  for (loc = bp->loc; loc != NULL; loc = loc->next)\n \t    {\n \t      if ((win == TUI_SRC_WIN\n@@ -491,7 +494,7 @@ tui_set_exec_info_content (struct tui_source_window_base *win_info)\n       tui_exec_info_content *content\n \t= win_info->execution_info->maybe_allocate_content (win_info->height);\n \n-      tui_update_breakpoint_info (win_info, 1);\n+      tui_update_breakpoint_info (win_info, nullptr, true);\n       for (int i = 0; i < win_info->content.size (); i++)\n \t{\n \t  tui_exec_info_content &element = content[i];"
    },
    {
      "sha": "c1087f4490a972244ab91252b480e8b6f15bbb66",
      "filename": "gdb/tui/tui-winsource.h",
      "status": "modified",
      "additions": 13,
      "deletions": 6,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/tui/tui-winsource.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0807ab7b88fa5ffb138ba1ee22b33d26e239de2f/gdb/tui/tui-winsource.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-winsource.h?ref=0807ab7b88fa5ffb138ba1ee22b33d26e239de2f",
      "patch": "@@ -28,14 +28,21 @@ struct tui_win_info;\n \n /* Update the execution windows to show the active breakpoints.  This\n    is called whenever a breakpoint is inserted, removed or has its\n-   state changed.  */\n-extern void tui_update_all_breakpoint_info (void);\n+   state changed.  Normally BEING_DELETED is nullptr; if not nullptr,\n+   it indicates a breakpoint that is in the process of being deleted,\n+   and which should therefore be ignored by the update.  This is done\n+   because the relevant observer is notified before the breakpoint is\n+   removed from the list of breakpoints.  */\n+extern void tui_update_all_breakpoint_info (struct breakpoint *being_deleted);\n \n /* Scan the source window and the breakpoints to update the break_mode\n-   information for each line.  Returns 1 if something changed and the\n-   execution window must be refreshed.  */\n-extern int tui_update_breakpoint_info (struct tui_source_window_base *win,\n-\t\t\t\t       int current_only);\n+   information for each line.  Returns true if something changed and\n+   the execution window must be refreshed.  See\n+   tui_update_all_breakpoint_info for a description of\n+   BEING_DELETED.  */\n+extern bool tui_update_breakpoint_info (struct tui_source_window_base *win,\n+\t\t\t\t\tstruct breakpoint *being_deleted,\n+\t\t\t\t\tbool current_only);\n \n /* Function to display the \"main\" routine.  */\n extern void tui_display_main (void);"
    }
  ]
}