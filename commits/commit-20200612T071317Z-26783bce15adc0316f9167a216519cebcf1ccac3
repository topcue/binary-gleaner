{
  "sha": "26783bce15adc0316f9167a216519cebcf1ccac3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjY3ODNiY2UxNWFkYzAzMTZmOTE2N2EyMTY1MTljZWJjZjFjY2FjMw==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-06-12T07:13:17Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2020-06-12T07:13:17Z"
    },
    "message": "[gdb/testsuite] Don't abort testrun for invalid command in test-case\n\nSay we add a call to foobar at the end of a test-case, and run the\ntest-suite.  We'll run into a dejagnu error:\n...\nERROR: (DejaGnu) proc \"foobar\" does not exist.\n...\nand the test-suite run is aborted.\n\nIt's reasonable that the test-case is aborted, but it's not reasonable that\nthe testsuite run is aborted.\n\nProblems in one test-case should not leak into other test-cases, and they\ngenerally don't.  The exception is the \"invalid command name\" problem due to\nan override of ::unknown in dejagnu's framework.exp.\n\nFix this by reverting dejagnu's ::unknown override for the duration of each\ntest-case, using the gdb_init/gdb_finish hooks.\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2020-06-12  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/26110\n\t* lib/gdb.exp (gdb_init): Revert dejagnu's override of ::unknown.\n\t(gdb_finish): Reinstall dejagnu's override of ::unknown.",
    "tree": {
      "sha": "65cf0274d276e64edf61bc0e87005dca3e9d0ad1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/65cf0274d276e64edf61bc0e87005dca3e9d0ad1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/26783bce15adc0316f9167a216519cebcf1ccac3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/26783bce15adc0316f9167a216519cebcf1ccac3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/26783bce15adc0316f9167a216519cebcf1ccac3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/26783bce15adc0316f9167a216519cebcf1ccac3/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "453c733fcf74893b5907f935283976c11cd46ad5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/453c733fcf74893b5907f935283976c11cd46ad5",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/453c733fcf74893b5907f935283976c11cd46ad5"
    }
  ],
  "stats": {
    "total": 24,
    "additions": 23,
    "deletions": 1
  },
  "files": [
    {
      "sha": "ff834b7e3a0028cd4cb8c113c3b27f15dbdc8ad7",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/26783bce15adc0316f9167a216519cebcf1ccac3/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/26783bce15adc0316f9167a216519cebcf1ccac3/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=26783bce15adc0316f9167a216519cebcf1ccac3",
      "patch": "@@ -1,3 +1,9 @@\n+2020-06-12  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/26110\n+\t* lib/gdb.exp (gdb_init): Revert dejagnu's override of ::unknown.\n+\t(gdb_finish): Reinstall dejagnu's override of ::unknown.\n+\n 2020-06-11  Tom Tromey  <tom@tromey.com>\n \n \tPR gdb/18318:"
    },
    {
      "sha": "64e667c20e04846cdd94e921dd7e3bc60fe93ce2",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 17,
      "deletions": 1,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/26783bce15adc0316f9167a216519cebcf1ccac3/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/26783bce15adc0316f9167a216519cebcf1ccac3/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=26783bce15adc0316f9167a216519cebcf1ccac3",
      "patch": "@@ -5193,14 +5193,30 @@ proc gdb_init { test_file_name } {\n     global gdb_instances\n     set gdb_instances 0\n \n-    return [default_gdb_init $test_file_name]\n+    set res [default_gdb_init $test_file_name]\n+\n+    # Dejagnu overrides proc unknown.  The dejagnu version may trigger in a\n+    # test-case but abort the entire test run.  To fix this, we install a\n+    # local version here, which reverts dejagnu's override, and restore\n+    # dejagnu's version in gdb_finish.\n+    rename ::unknown ::dejagnu_unknown\n+    proc unknown { args } {\n+\t# Dejagnu saves the original version in ::tcl_unknown, use it.\n+\treturn [uplevel 1 ::tcl_unknown $args]\n+    }\n+\n+    return $res\n }\n \n proc gdb_finish { } {\n     global gdbserver_reconnect_p\n     global gdb_prompt\n     global cleanfiles\n \n+    # Restore dejagnu's version of proc unknown.\n+    rename ::unknown \"\"\n+    rename ::dejagnu_unknown ::unknown\n+\n     # Exit first, so that the files are no longer in use.\n     gdb_exit\n "
    }
  ]
}