{
  "sha": "2487ef07c28b961c6e2b8c51161f88f93b181d07",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjQ4N2VmMDdjMjhiOTYxYzZlMmI4YzUxMTYxZjg4ZjkzYjE4MWQwNw==",
  "commit": {
    "author": {
      "name": "Max Filippov",
      "email": "jcmvbkbc@gmail.com",
      "date": "2019-03-29T00:03:57Z"
    },
    "committer": {
      "name": "Max Filippov",
      "email": "jcmvbkbc@gmail.com",
      "date": "2019-03-29T17:02:10Z"
    },
    "message": "bfd: xtensa: fix shrink_dynamic_reloc_sections for export-dynamic\n\nshrink_dynamic_reloc_sections must remove PLT entry that was created for\nan undefined weak symbol in the presence of --export-dynamic option when\nrelaxation coalesces literals pointing to that symbol. This fixes the\nfollowing assertion:\n\n  ld: BFD (GNU Binutils) 2.31.1 internal error, aborting at\n  elf32-xtensa.c:3292 in elf_xtensa_finish_dynamic_sections\n\n2019-03-29  Max Filippov  <jcmvbkbc@gmail.com>\nbfd/\n\t* elf32-xtensa.c (shrink_dynamic_reloc_sections): Add\n\tinfo->export_dynamic to the conditional.\n\nld/\n\t* testsuite/ld-xtensa/relax-undef-weak-pie-export-dynamic.d: New\n\ttest definition.\n\t* testsuite/ld-xtensa/xtensa.exp\n\t(relax-undef-weak-pie-export-dynamic): Add new test.",
    "tree": {
      "sha": "b1e5e978b0105e99f0cc2d3d5a15dad4ed1bef42",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b1e5e978b0105e99f0cc2d3d5a15dad4ed1bef42"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2487ef07c28b961c6e2b8c51161f88f93b181d07",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2487ef07c28b961c6e2b8c51161f88f93b181d07",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2487ef07c28b961c6e2b8c51161f88f93b181d07",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2487ef07c28b961c6e2b8c51161f88f93b181d07/comments",
  "author": {
    "login": "jcmvbkbc",
    "id": 166731,
    "node_id": "MDQ6VXNlcjE2NjczMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jcmvbkbc",
    "html_url": "https://github.com/jcmvbkbc",
    "followers_url": "https://api.github.com/users/jcmvbkbc/followers",
    "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}",
    "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions",
    "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs",
    "repos_url": "https://api.github.com/users/jcmvbkbc/repos",
    "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jcmvbkbc",
    "id": 166731,
    "node_id": "MDQ6VXNlcjE2NjczMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/166731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jcmvbkbc",
    "html_url": "https://github.com/jcmvbkbc",
    "followers_url": "https://api.github.com/users/jcmvbkbc/followers",
    "following_url": "https://api.github.com/users/jcmvbkbc/following{/other_user}",
    "gists_url": "https://api.github.com/users/jcmvbkbc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jcmvbkbc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jcmvbkbc/subscriptions",
    "organizations_url": "https://api.github.com/users/jcmvbkbc/orgs",
    "repos_url": "https://api.github.com/users/jcmvbkbc/repos",
    "events_url": "https://api.github.com/users/jcmvbkbc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jcmvbkbc/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5f33607b284323ac71fb5b6864ce2fa671379dfc",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5f33607b284323ac71fb5b6864ce2fa671379dfc",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5f33607b284323ac71fb5b6864ce2fa671379dfc"
    }
  ],
  "stats": {
    "total": 30,
    "additions": 29,
    "deletions": 1
  },
  "files": [
    {
      "sha": "6662b708c16c4c2a71aec2a5f1c38b238eace950",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2487ef07c28b961c6e2b8c51161f88f93b181d07/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2487ef07c28b961c6e2b8c51161f88f93b181d07/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=2487ef07c28b961c6e2b8c51161f88f93b181d07",
      "patch": "@@ -1,3 +1,8 @@\n+2019-03-29  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* elf32-xtensa.c (shrink_dynamic_reloc_sections): Add\n+\tinfo->export_dynamic to the conditional.\n+\n 2019-03-28  Alan Modra  <amodra@gmail.com>\n \n \tPR 24392"
    },
    {
      "sha": "37ea200eea74f5c3b8bcd4d11b0eed99e0ffed97",
      "filename": "bfd/elf32-xtensa.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2487ef07c28b961c6e2b8c51161f88f93b181d07/bfd/elf32-xtensa.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2487ef07c28b961c6e2b8c51161f88f93b181d07/bfd/elf32-xtensa.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-xtensa.c?ref=2487ef07c28b961c6e2b8c51161f88f93b181d07",
      "patch": "@@ -10083,7 +10083,8 @@ shrink_dynamic_reloc_sections (struct bfd_link_info *info,\n       && (input_section->flags & SEC_ALLOC) != 0\n       && (dynamic_symbol || bfd_link_pic (info))\n       && (!h || h->root.type != bfd_link_hash_undefweak\n-\t  || (dynamic_symbol && bfd_link_dll (info))))\n+\t  || (dynamic_symbol\n+\t      && (bfd_link_dll (info) || info->export_dynamic))))\n     {\n       asection *srel;\n       bfd_boolean is_plt = FALSE;"
    },
    {
      "sha": "b987a13edb745782d1e643c25ef47766bcc43f78",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2487ef07c28b961c6e2b8c51161f88f93b181d07/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2487ef07c28b961c6e2b8c51161f88f93b181d07/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=2487ef07c28b961c6e2b8c51161f88f93b181d07",
      "patch": "@@ -1,3 +1,10 @@\n+2019-03-29  Max Filippov  <jcmvbkbc@gmail.com>\n+\n+\t* testsuite/ld-xtensa/relax-undef-weak-pie-export-dynamic.d: New\n+\ttest definition.\n+\t* testsuite/ld-xtensa/xtensa.exp\n+\t(relax-undef-weak-pie-export-dynamic): Add new test.\n+\n 2019-03-26  Martin Liska  <mliska@suse.cz>\n \n \t* plugin.c (get_symbols): Add lto_kind_str, lto_resolution_str,"
    },
    {
      "sha": "e2ff601bf3c1dd472263093ddfdfa3bcf5456bcc",
      "filename": "ld/testsuite/ld-xtensa/relax-undef-weak-pie-export-dynamic.d",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2487ef07c28b961c6e2b8c51161f88f93b181d07/ld/testsuite/ld-xtensa/relax-undef-weak-pie-export-dynamic.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2487ef07c28b961c6e2b8c51161f88f93b181d07/ld/testsuite/ld-xtensa/relax-undef-weak-pie-export-dynamic.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-xtensa/relax-undef-weak-pie-export-dynamic.d?ref=2487ef07c28b961c6e2b8c51161f88f93b181d07",
      "patch": "@@ -0,0 +1,14 @@\n+#source: relax-undef-weak.s\n+#ld: -pie --export-dynamic\n+#readelf: -r\n+#...\n+Relocation section '\\.rela\\.dyn' .* 3 .*\n+#...\n+.*R_XTENSA_RTLD.*\n+.*R_XTENSA_RTLD.*\n+.*R_XTENSA_GLOB_DAT.*fd.*\n+#...\n+Relocation section '\\.rela\\.plt' .* 1 .*\n+#...\n+.*R_XTENSA_JMP_SLOT.*fd.*\n+#..."
    },
    {
      "sha": "d800c647a32d08438587acce380fed16ae7c2b1d",
      "filename": "ld/testsuite/ld-xtensa/xtensa.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2487ef07c28b961c6e2b8c51161f88f93b181d07/ld/testsuite/ld-xtensa/xtensa.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2487ef07c28b961c6e2b8c51161f88f93b181d07/ld/testsuite/ld-xtensa/xtensa.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-xtensa/xtensa.exp?ref=2487ef07c28b961c6e2b8c51161f88f93b181d07",
      "patch": "@@ -34,6 +34,7 @@ run_dump_test \"relax-static-shared\"\n run_dump_test \"relax-static-local-shared\"\n \n run_dump_test \"relax-undef-weak-pie\"\n+run_dump_test \"relax-undef-weak-pie-export-dynamic\"\n run_dump_test \"relax-undef-weak-local-pie\"\n run_dump_test \"relax-undef-weak-shared\"\n run_dump_test \"relax-undef-weak-local-shared\""
    }
  ]
}