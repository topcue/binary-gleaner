{
  "sha": "cab3f4da68672647cde72bc0c06ec08977819817",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2FiM2Y0ZGE2ODY3MjY0N2NkZTcyYmMwYzA2ZWMwODk3NzgxOTgxNw==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-12-30T11:30:57Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-12-31T08:37:02Z"
    },
    "message": "PR27128, nm -P portable output format regression\n\nbinutils/\n\tPR 27128\n\t* nm.c (print_symname): Append version string to symbol name\n\tbefore printing the lot under control of \"form\".  Append version\n\tto demangled names too.\nld/\n\tPR 27128\n\t* testsuite/ld-elf/pr27128.s: New file.\n\t* testsuite/ld-elf/pr27128.t: Likewise.\n\t* testsuite/ld-elf/pr27128a.d: Likewise.\n\t* testsuite/ld-elf/pr27128b.d: Likewise.\n\t* testsuite/ld-elf/pr27128c.d: Likewise.\n\t* testsuite/ld-elf/pr27128d.d: Likewise.\n\t* testsuite/ld-elf/pr27128e.d: Likewise.",
    "tree": {
      "sha": "868487907ff13abe6b131e712cae5e5eb3d5d146",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/868487907ff13abe6b131e712cae5e5eb3d5d146"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/cab3f4da68672647cde72bc0c06ec08977819817",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cab3f4da68672647cde72bc0c06ec08977819817",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/cab3f4da68672647cde72bc0c06ec08977819817",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cab3f4da68672647cde72bc0c06ec08977819817/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4ff509e75bf3488c302bea86b0db3dcdcad30818",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4ff509e75bf3488c302bea86b0db3dcdcad30818",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4ff509e75bf3488c302bea86b0db3dcdcad30818"
    }
  ],
  "stats": {
    "total": 146,
    "additions": 133,
    "deletions": 13
  },
  "files": [
    {
      "sha": "7bd55845686a7834931149d1f2a826bdf0a98e91",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -1,3 +1,10 @@\n+2020-12-31  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27128\n+\t* nm.c (print_symname): Append version string to symbol name\n+\tbefore printing the lot under control of \"form\".  Append version\n+\tto demangled names too.\n+\n 2020-12-29  H.J. Lu  <hongjiu.lu@intel.com>\n \n \t* elfedit (usage): Pass osabi to reconcat."
    },
    {
      "sha": "e77828eeff6b70f29af892adfa98346949aef9eb",
      "filename": "binutils/nm.c",
      "status": "modified",
      "additions": 15,
      "deletions": 13,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/binutils/nm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/binutils/nm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/nm.c?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -407,21 +407,17 @@ static void\n print_symname (const char *form, struct extended_symbol_info *info,\n \t       const char *name, bfd *abfd)\n {\n+  char *alloc = NULL;\n+\n   if (name == NULL)\n     name = info->sinfo->name;\n   if (do_demangle && *name)\n     {\n-      char *res = bfd_demangle (abfd, name, demangle_flags);\n-\n-      if (res != NULL)\n-\t{\n-\t  printf (form, res);\n-\t  free (res);\n-\t  return;\n-\t}\n+      alloc = bfd_demangle (abfd, name, demangle_flags);\n+      if (alloc != NULL)\n+\tname = alloc;\n     }\n \n-  printf (form, name);\n   if (info != NULL && info->elfinfo)\n     {\n       const char *version_string;\n@@ -431,11 +427,17 @@ print_symname (const char *form, struct extended_symbol_info *info,\n \t= bfd_get_symbol_version_string (abfd, &info->elfinfo->symbol,\n \t\t\t\t\t FALSE, &hidden);\n       if (version_string && version_string[0])\n-\tprintf (\"%s%s\",\n-\t       (hidden || bfd_is_und_section (info->elfinfo->symbol.section)\n-\t\t? \"@\" : \"@@\"),\n-\t       version_string);\n+\t{\n+\t  const char *at = \"@@\";\n+\t  if (hidden || bfd_is_und_section (info->elfinfo->symbol.section))\n+\t    at = \"@\";\n+\t  alloc = reconcat (alloc, name, at, version_string, NULL);\n+\t  if (alloc != NULL)\n+\t    name = alloc;\n+\t}\n     }\n+  printf (form, name);\n+  free (alloc);\n }\n \n static void"
    },
    {
      "sha": "03b4b224b7be052564df6b38493d37d9e9a43a40",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -1,3 +1,15 @@\n+2020-12-31  H.J. Lu  <hongjiu.lu@intel.com>\n+\t    Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27128\n+\t* testsuite/ld-elf/pr27128.s: New file.\n+\t* testsuite/ld-elf/pr27128.t: Likewise.\n+\t* testsuite/ld-elf/pr27128a.d: Likewise.\n+\t* testsuite/ld-elf/pr27128b.d: Likewise.\n+\t* testsuite/ld-elf/pr27128c.d: Likewise.\n+\t* testsuite/ld-elf/pr27128d.d: Likewise.\n+\t* testsuite/ld-elf/pr27128e.d: Likewise.\n+\n 2020-12-24  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-elf/retain7a.d: Don't run on hppa-linux."
    },
    {
      "sha": "7af5be183b60b0709230eff5e86ad9170141e2fd",
      "filename": "ld/testsuite/ld-elf/pr27128.s",
      "status": "added",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128.s?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,13 @@\n+\t.text\n+\t.globl\tfoo\n+\t.type\tfoo,%function\n+foo:\n+\t.space 16\n+\t.size foo, .-foo\n+\t.symver foo,foo@@VERS_2.0,remove\n+\t.globl\t_Zrm1XS_\n+\t.type\t_Zrm1XS_,%function\n+_Zrm1XS_:\n+\t.space 16\n+\t.size _Zrm1XS_, .-_Zrm1XS_\n+\t.symver _Zrm1XS_,_Zrm1XS_@@VERS_2.0,remove"
    },
    {
      "sha": "27669a505b6b800361c861dde7cab944b3c84fee",
      "filename": "ld/testsuite/ld-elf/pr27128.t",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128.t",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128.t",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128.t?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,6 @@\n+VERS_2.0 {\n+global:\n+  foo; _Zrm1XS_;\n+local:\n+  *;\n+};"
    },
    {
      "sha": "9ce8eaa5467f54c6060802a6869257e7595c4307",
      "filename": "ld/testsuite/ld-elf/pr27128a.d",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128a.d?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,16 @@\n+#source: pr27128.s\n+#ld: -shared -version-script pr27128.t\n+#nm: -n -P\n+#target: [check_shared_lib_support]\n+#notarget: [is_underscore_target]\n+# _Zrm1XS_ doesn't have an extra underscore.\n+#xfail: hppa64-*-* tic6x-*-*\n+# hppa64 uses dot-symbols, tic6x DYN lacks dynamic sections for this testcase\n+\n+#...\n+VERS_2\\.0 A 0+ \n+#...\n+foo@@VERS_2\\.0 T [0-9a-f]+ 10\n+#...\n+_Zrm1XS_@@VERS_2\\.0 T [0-9a-f]+ 10\n+#pass"
    },
    {
      "sha": "934f8330d761754b2fe14f6554e08ed9dd154ab0",
      "filename": "ld/testsuite/ld-elf/pr27128b.d",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128b.d?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,16 @@\n+#source: pr27128.s\n+#ld: -shared -version-script pr27128.t\n+#nm: -n -D --format=posix\n+#target: [check_shared_lib_support]\n+#notarget: [is_underscore_target]\n+# _Zrm1XS_ doesn't have an extra underscore.\n+#xfail: hppa64-*-* tic6x-*-*\n+# hppa64 uses dot-symbols, tic6x DYN lacks dynamic sections for this testcase\n+\n+#...\n+VERS_2\\.0 A 0+ \n+#...\n+foo@@VERS_2\\.0 T [0-9a-f]+ 10\n+#...\n+_Zrm1XS_@@VERS_2\\.0 T [0-9a-f]+ 10\n+#pass"
    },
    {
      "sha": "f80c57b64cdca1f67f2bcf9d45f4ff983bf22ef2",
      "filename": "ld/testsuite/ld-elf/pr27128c.d",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128c.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128c.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128c.d?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,16 @@\n+#source: pr27128.s\n+#ld: -shared -version-script pr27128.t\n+#nm: -n --format=sysv\n+#target: [check_shared_lib_support]\n+#notarget: [is_underscore_target]\n+# _Zrm1XS_ doesn't have an extra underscore.\n+#xfail: hppa64-*-* tic6x-*-*\n+# hppa64 uses dot-symbols, tic6x DYN lacks dynamic sections for this testcase\n+\n+#...\n+VERS_2\\.0 +\\|0+\\| +A +\\| +OBJECT\\| +\\| +\\|\\*ABS\\*\n+#...\n+foo@@VERS_2\\.0 +\\|[0-9a-f]+\\| +T +\\| +FUNC\\|0+10\\| +\\|\\.text\n+#...\n+_Zrm1XS_@@VERS_2\\.0 +\\|[0-9a-f]+\\| +T +\\| +FUNC\\|0+10\\| +\\|\\.text\n+#pass"
    },
    {
      "sha": "ba628d22de3ac2827df960a866bb1a2b18bbc9ec",
      "filename": "ld/testsuite/ld-elf/pr27128d.d",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128d.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128d.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128d.d?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,16 @@\n+#source: pr27128.s\n+#ld: -shared -version-script pr27128.t\n+#nm: -n -D --format=sysv\n+#target: [check_shared_lib_support]\n+#notarget: [is_underscore_target]\n+# _Zrm1XS_ doesn't have an extra underscore.\n+#xfail: hppa64-*-* tic6x-*-*\n+# hppa64 uses dot-symbols, tic6x DYN lacks dynamic sections for this testcase\n+\n+#...\n+VERS_2\\.0 +\\|0+\\| +A +\\| +OBJECT\\| +\\| +\\|\\*ABS\\*\n+#...\n+foo@@VERS_2\\.0 +\\|[0-9a-f]+\\| +T +\\| +FUNC\\|0+10\\| +\\|\\.text\n+#...\n+_Zrm1XS_@@VERS_2\\.0 +\\|[0-9a-f]+\\| +T +\\| +FUNC\\|0+10\\| +\\|\\.text\n+#pass"
    },
    {
      "sha": "b8b1657fe712334de343a852831d218f9c22c7af",
      "filename": "ld/testsuite/ld-elf/pr27128e.d",
      "status": "added",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128e.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cab3f4da68672647cde72bc0c06ec08977819817/ld/testsuite/ld-elf/pr27128e.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128e.d?ref=cab3f4da68672647cde72bc0c06ec08977819817",
      "patch": "@@ -0,0 +1,16 @@\n+#source: pr27128.s\n+#ld: -shared -version-script pr27128.t\n+#nm: -n --demangle -D --format=posix\n+#target: [check_shared_lib_support]\n+#notarget: [is_underscore_target]\n+# _Zrm1XS_ doesn't have an extra underscore.\n+#xfail: hppa64-*-* tic6x-*-*\n+# hppa64 uses dot-symbols, tic6x DYN lacks dynamic sections for this testcase\n+\n+#...\n+VERS_2\\.0 A 0+ \n+#...\n+foo@@VERS_2\\.0 T [0-9a-f]+ 10\n+#...\n+operator%\\(X, X\\)@@VERS_2\\.0 T [0-9a-f]+ 10\n+#pass"
    }
  ]
}