{
  "sha": "8ffcdf1823d186c94eb3a1781e366a155646140a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGZmY2RmMTgyM2QxODZjOTRlYjNhMTc4MWUzNjZhMTU1NjQ2MTQwYQ==",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2019-11-05T17:57:55Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2020-06-26T14:56:39Z"
    },
    "message": "libctf: create: forwards are always in the namespace of their referent\n\nThe C namespace a forward is located in is always the same as the\nnamespace of the corresponding complete type: 'struct foo' is in the\nstruct namespace and does not collide with, say, 'union foo'.\n\nlibctf allowed for this in many places, but inconsistently: in\nparticular, forward *addition* never allowed for this, and was interning\nforwards in the default namespace, which is always wrong, since you can\nonly forward structs, unions and enums, all of which are in their own\nnamespaces in C.\n\nForward removal needs corresponding adjustment to remove the names form\nthe right namespace, as does ctf_rollback.\n\nlibctf/\n\t* ctf-create.c (ctf_add_forward): Intern in the right namespace.\n\t(ctf_dtd_delete): Remove correspondingly.\n\t(ctf_rollback): Likewise.",
    "tree": {
      "sha": "b848d89e552b17c12a6fef2824a24d372cd5e821",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b848d89e552b17c12a6fef2824a24d372cd5e821"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8ffcdf1823d186c94eb3a1781e366a155646140a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8ffcdf1823d186c94eb3a1781e366a155646140a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8ffcdf1823d186c94eb3a1781e366a155646140a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8ffcdf1823d186c94eb3a1781e366a155646140a/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d04a47ac53b7e3ae572021711c91f2f3d333417b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d04a47ac53b7e3ae572021711c91f2f3d333417b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d04a47ac53b7e3ae572021711c91f2f3d333417b"
    }
  ],
  "stats": {
    "total": 16,
    "additions": 14,
    "deletions": 2
  },
  "files": [
    {
      "sha": "3ab0a6c0376dd49df8343a585997410ca3fa9d8f",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ffcdf1823d186c94eb3a1781e366a155646140a/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ffcdf1823d186c94eb3a1781e366a155646140a/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=8ffcdf1823d186c94eb3a1781e366a155646140a",
      "patch": "@@ -1,3 +1,9 @@\n+2020-06-26  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* ctf-create.c (ctf_add_forward): Intern in the right namespace.\n+\t(ctf_dtd_delete): Remove correspondingly.\n+\t(ctf_rollback): Likewise.\n+\n 2020-06-26  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* ctf-create.c (ctf_add_type_internal): Hand back existing types"
    },
    {
      "sha": "a01250bc4d4198d666a25b495ad4498e10254c5a",
      "filename": "libctf/ctf-create.c",
      "status": "modified",
      "additions": 8,
      "deletions": 2,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8ffcdf1823d186c94eb3a1781e366a155646140a/libctf/ctf-create.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8ffcdf1823d186c94eb3a1781e366a155646140a/libctf/ctf-create.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ctf-create.c?ref=8ffcdf1823d186c94eb3a1781e366a155646140a",
      "patch": "@@ -622,6 +622,7 @@ ctf_dtd_delete (ctf_file_t *fp, ctf_dtdef_t *dtd)\n {\n   ctf_dmdef_t *dmd, *nmd;\n   int kind = LCTF_INFO_KIND (fp, dtd->dtd_data.ctt_info);\n+  int name_kind = kind;\n   const char *name;\n \n   ctf_dynhash_remove (fp->ctf_dthash, (void *) dtd->dtd_type);\n@@ -643,13 +644,16 @@ ctf_dtd_delete (ctf_file_t *fp, ctf_dtdef_t *dtd)\n     case CTF_K_FUNCTION:\n       free (dtd->dtd_u.dtu_argv);\n       break;\n+    case CTF_K_FORWARD:\n+      name_kind = dtd->dtd_data.ctt_type;\n+      break;\n     }\n \n   if (dtd->dtd_data.ctt_name\n       && (name = ctf_strraw (fp, dtd->dtd_data.ctt_name)) != NULL\n       && LCTF_INFO_ISROOT (fp, dtd->dtd_data.ctt_info))\n     {\n-      ctf_dynhash_remove (ctf_name_table (fp, kind)->ctn_writable,\n+      ctf_dynhash_remove (ctf_name_table (fp, name_kind)->ctn_writable,\n \t\t\t  name);\n       ctf_str_remove_ref (fp, name, &dtd->dtd_data.ctt_name);\n     }\n@@ -761,6 +765,8 @@ ctf_rollback (ctf_file_t *fp, ctf_snapshot_id_t id)\n \tcontinue;\n \n       kind = LCTF_INFO_KIND (fp, dtd->dtd_data.ctt_info);\n+      if (kind == CTF_K_FORWARD)\n+\tkind = dtd->dtd_data.ctt_type;\n \n       if (dtd->dtd_data.ctt_name\n \t  && (name = ctf_strraw (fp, dtd->dtd_data.ctt_name)) != NULL\n@@ -1232,7 +1238,7 @@ ctf_add_forward (ctf_file_t *fp, uint32_t flag, const char *name,\n   if (type)\n     return type;\n \n-  if ((type = ctf_add_generic (fp, flag, name, CTF_K_FORWARD, &dtd)) == CTF_ERR)\n+  if ((type = ctf_add_generic (fp, flag, name, kind, &dtd)) == CTF_ERR)\n     return CTF_ERR;\t\t/* errno is set for us.  */\n \n   dtd->dtd_data.ctt_info = CTF_TYPE_INFO (CTF_K_FORWARD, flag, 0);"
    }
  ]
}