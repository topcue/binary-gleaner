{
  "sha": "c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzgzZDhkMzJjOWIzMzc5YTM5YzQzNGZjYWE5ZjMwNGI2ZTQ0MzJjYQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-11-21T16:05:10Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-11-22T22:11:57Z"
    },
    "message": "Avoid crash in print_ada_task_info\n\nIn MI mode, print_ada_task_info can crash in find_thread_ptid when\ntrying to print an Ada task that is no longer alive.  This patch\navoids the problem by checking for this case.\n\nBecause this is Ada-specific, and because Joel approved it internally,\nI am checking it in.\n\ngdb/ChangeLog\n2019-11-22  Tom Tromey  <tromey@adacore.com>\n\n\t* ada-tasks.c (ada_task_is_alive): Make parameter const.\n\t(print_ada_task_info): Don't try to fetch thread id if task is not\n\talive.\n\ngdb/gdbserver/ChangeLog\n2019-11-22  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.ada/tasks.exp: Add -ada-task-info regression test.\n\t* gdb.ada/tasks/foo.adb: Add another stopping location.\n\nChange-Id: If25eae6507eebb7537eb8adbcbaa1fc1eec88f5c",
    "tree": {
      "sha": "742c0a8d8eb8628814acb573f5ee605a8c8b216e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/742c0a8d8eb8628814acb573f5ee605a8c8b216e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "987012b89bce7f6385ed88585547f852a8005a3f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/987012b89bce7f6385ed88585547f852a8005a3f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/987012b89bce7f6385ed88585547f852a8005a3f"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 29,
    "deletions": 6
  },
  "files": [
    {
      "sha": "cd26997619c650d0f045bc2d84da15abe302ccc9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
      "patch": "@@ -1,3 +1,9 @@\n+2019-11-22  Tom Tromey  <tromey@adacore.com>\n+\n+\t* ada-tasks.c (ada_task_is_alive): Make parameter const.\n+\t(print_ada_task_info): Don't try to fetch thread id if task is not\n+\talive.\n+\n 2019-11-22  Christian Biesinger  <cbiesinger@google.com>\n \n \t* ada-exp.y: Update."
    },
    {
      "sha": "67aa0c798890aae65c5bbada9635f157ac040681",
      "filename": "gdb/ada-tasks.c",
      "status": "modified",
      "additions": 8,
      "deletions": 5,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/ada-tasks.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/ada-tasks.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ada-tasks.c?ref=c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
      "patch": "@@ -347,7 +347,7 @@ valid_task_id (int task_num)\n    task state.  */\n \n static int\n-ada_task_is_alive (struct ada_task_info *task_info)\n+ada_task_is_alive (const struct ada_task_info *task_info)\n {\n   return (task_info->state != Terminated);\n }\n@@ -1127,14 +1127,17 @@ print_ada_task_info (struct ui_out *uiout,\n       /* Print the associated Thread ID.  */\n       if (uiout->is_mi_like_p ())\n         {\n-\t  thread_info *thread = find_thread_ptid (task_info->ptid);\n+\t  thread_info *thread = (ada_task_is_alive (task_info)\n+\t\t\t\t ? find_thread_ptid (task_info->ptid)\n+\t\t\t\t : nullptr);\n \n \t  if (thread != NULL)\n \t    uiout->field_signed (\"thread-id\", thread->global_num);\n \t  else\n-\t    /* This should never happen unless there is a bug somewhere,\n-\t       but be resilient when that happens.  */\n-\t    uiout->field_skip (\"thread-id\");\n+\t    {\n+\t      /* This can happen if the thread is no longer alive.  */\n+\t      uiout->field_skip (\"thread-id\");\n+\t    }\n \t}\n \n       /* Print the ID of the parent task.  */"
    },
    {
      "sha": "02414385b796bf4c6bb7db619ef15d2e90addbda",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
      "patch": "@@ -1,3 +1,8 @@\n+2019-11-22  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.ada/tasks.exp: Add -ada-task-info regression test.\n+\t* gdb.ada/tasks/foo.adb: Add another stopping location.\n+\n 2019-11-20  Luis Machado  <luis.machado@linaro.org>\n \n \t* linux-aarch64-low.c (is_sve_tdesc): Check against target feature"
    },
    {
      "sha": "021e902f7b00cc7f34dd44bf8c54a9cf867ae14e",
      "filename": "gdb/testsuite/gdb.ada/tasks.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/testsuite/gdb.ada/tasks.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/testsuite/gdb.ada/tasks.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/tasks.exp?ref=c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
      "patch": "@@ -82,4 +82,10 @@ gdb_test \"info tasks\" \\\n # Now, resume the execution and make sure that GDB does not stop when\n # task 4 hits the breakpoint. Continuing thus results in our program\n # running to completion.\n-gdb_continue_to_end \"\" continue 1\n+set bp_location [gdb_get_line_number \"STOP_HERE_2\" ${testdir}/foo.adb]\n+gdb_breakpoint foo.adb:$bp_location\n+gdb_continue_to_breakpoint second \".*foo.adb:$bp_location.*null; -- STOP_HERE_2\"\n+\n+# A regression test for a crash caused by trying to find the thread\n+# for a terminated task.\n+gdb_test \"interpreter-exec mi \\\"-ada-task-info\\\"\" \".*\""
    },
    {
      "sha": "9fc43b07c94c99cadd8dd0ef458bace1fdcc79ae",
      "filename": "gdb/testsuite/gdb.ada/tasks/foo.adb",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/testsuite/gdb.ada/tasks/foo.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c83d8d32c9b3379a39c434fcaa9f304b6e4432ca/gdb/testsuite/gdb.ada/tasks/foo.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/tasks/foo.adb?ref=c83d8d32c9b3379a39c434fcaa9f304b6e4432ca",
      "patch": "@@ -65,4 +65,7 @@ begin\n    for J in Task_List'Range loop\n       Task_List (J).Finalize;\n    end loop;\n+\n+   null; -- STOP_HERE_2\n+\n end Foo;"
    }
  ]
}