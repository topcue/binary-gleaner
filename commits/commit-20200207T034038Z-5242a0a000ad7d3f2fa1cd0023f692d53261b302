{
  "sha": "5242a0a000ad7d3f2fa1cd0023f692d53261b302",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NTI0MmEwYTAwMGFkN2QzZjJmYTFjZDAwMjNmNjkyZDUzMjYxYjMwMg==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-02-07T03:37:54Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-02-07T03:40:38Z"
    },
    "message": "ld: Issue an error for GC on __patchable_function_entries section\n\n__patchable_function_entries section is generated by a compiler with\n-fpatchable-function-entry=XX.  The assembly code looks like this:\n\n---\n\t.text\n\t.globl\t_start\n\t.type\t_start, %function\n_start:\n\t.section __patchable_function_entries,\"aw\",%progbits\n\t.dc.a\t.LPFE1\n\t.text\n.LPFE1:\n\t.byte 0\n---\n\nBut --gc-sections will silently remove __patchable_function_entries\nsection and generate corrupt result.  This patch disallows garbage\ncollection on __patchable_function_entries section without linked-to\nsection.\n\nbfd/\n\n\tPR ld/25490\n\t* elflink.c (_bfd_elf_gc_mark_extra_sections): Issue an error\n\tfor garbage collection on __patchable_function_entries section\n\twithout linked-to section.\n\nld/\n\n\tPR ld/25490\n\t* testsuite/ld-elf/pr25490-1.d: New file.\n\t* testsuite/ld-elf/pr25490-1.s: Likewise.",
    "tree": {
      "sha": "d63d80ceaf397af290aadb5619a6a20299984ded",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d63d80ceaf397af290aadb5619a6a20299984ded"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/5242a0a000ad7d3f2fa1cd0023f692d53261b302",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5242a0a000ad7d3f2fa1cd0023f692d53261b302",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/5242a0a000ad7d3f2fa1cd0023f692d53261b302",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5242a0a000ad7d3f2fa1cd0023f692d53261b302/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b7d072167715829eed0622616f6ae0182900de3e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b7d072167715829eed0622616f6ae0182900de3e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b7d072167715829eed0622616f6ae0182900de3e"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 32,
    "deletions": 0
  },
  "files": [
    {
      "sha": "e1a84123254cd1afeb6bb5f4eb01053dc48553ff",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5242a0a000ad7d3f2fa1cd0023f692d53261b302/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5242a0a000ad7d3f2fa1cd0023f692d53261b302/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=5242a0a000ad7d3f2fa1cd0023f692d53261b302",
      "patch": "@@ -1,3 +1,10 @@\n+2020-02-06  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/25490\n+\t* elflink.c (_bfd_elf_gc_mark_extra_sections): Issue an error\n+\tfor garbage collection on __patchable_function_entries section\n+\twithout linked-to section.\n+\n 2020-02-06  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gas/25381"
    },
    {
      "sha": "3add9f18bd7e940f6e4874e875e09b2b6f50a17d",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5242a0a000ad7d3f2fa1cd0023f692d53261b302/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5242a0a000ad7d3f2fa1cd0023f692d53261b302/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=5242a0a000ad7d3f2fa1cd0023f692d53261b302",
      "patch": "@@ -13365,6 +13365,13 @@ _bfd_elf_gc_mark_extra_sections (struct bfd_link_info *info,\n \t      && (isec->flags & SEC_DEBUGGING)\n \t      && CONST_STRNEQ (isec->name, \".debug_line.\"))\n \t    debug_frag_seen = TRUE;\n+\t  else if (strcmp (bfd_section_name (isec),\n+\t\t\t   \"__patchable_function_entries\") == 0\n+\t\t   && elf_linked_to_section (isec) == NULL)\n+\t      info->callbacks->einfo (_(\"%F%P: %pB(%pA): error: \"\n+\t\t\t\t\t\"need linked-to section \"\n+\t\t\t\t\t\"for --gc-sections\\n\"),\n+\t\t\t\t      isec->owner, isec);\n \t}\n \n       /* If no non-note alloc section in this file will be kept, then"
    },
    {
      "sha": "3ad571f169179811e97e5136a40093ed5cbaa98d",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5242a0a000ad7d3f2fa1cd0023f692d53261b302/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5242a0a000ad7d3f2fa1cd0023f692d53261b302/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=5242a0a000ad7d3f2fa1cd0023f692d53261b302",
      "patch": "@@ -1,3 +1,9 @@\n+2020-02-06  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/25490\n+\t* testsuite/ld-elf/pr25490-1.d: New file.\n+\t* testsuite/ld-elf/pr25490-1.s: Likewise.\n+\n 2020-02-06  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/24526"
    },
    {
      "sha": "3f582645899ef405a5051a50a317a0b2029daac5",
      "filename": "ld/testsuite/ld-elf/pr25490-1.d",
      "status": "added",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5242a0a000ad7d3f2fa1cd0023f692d53261b302/ld/testsuite/ld-elf/pr25490-1.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5242a0a000ad7d3f2fa1cd0023f692d53261b302/ld/testsuite/ld-elf/pr25490-1.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25490-1.d?ref=5242a0a000ad7d3f2fa1cd0023f692d53261b302",
      "patch": "@@ -0,0 +1,3 @@\n+#ld: --gc-sections -e _start\n+#target: [check_gc_sections_available]\n+#error: .*\\(__patchable_function_entries\\): error: need linked-to section for --gc-sections"
    },
    {
      "sha": "51ba1ea80146556e6c51df6f1fb7b0db55fe56e8",
      "filename": "ld/testsuite/ld-elf/pr25490-1.s",
      "status": "added",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/5242a0a000ad7d3f2fa1cd0023f692d53261b302/ld/testsuite/ld-elf/pr25490-1.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/5242a0a000ad7d3f2fa1cd0023f692d53261b302/ld/testsuite/ld-elf/pr25490-1.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25490-1.s?ref=5242a0a000ad7d3f2fa1cd0023f692d53261b302",
      "patch": "@@ -0,0 +1,9 @@\n+\t.text\n+\t.globl\t_start\n+\t.type\t_start, %function\n+_start:\n+\t.section\t__patchable_function_entries,\"aw\",%progbits\n+\t.dc.a\t.LPFE1\n+\t.text\n+.LPFE1:\n+\t.byte 0"
    }
  ]
}