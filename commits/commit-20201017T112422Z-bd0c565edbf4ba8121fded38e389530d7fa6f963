{
  "sha": "bd0c565edbf4ba8121fded38e389530d7fa6f963",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmQwYzU2NWVkYmY0YmE4MTIxZmRlZDM4ZTM4OTUzMGQ3ZmE2Zjk2Mw==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-10-17T11:24:22Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-10-17T11:24:22Z"
    },
    "message": "gas: Always use as_where for preprocessed assembly codes\n\nAlways clear the slot 1 if it was assigned to the input file before the\nfirst .file <NUMBER> directive has been seen.  Always use as_where to\ngenerate the correct debug infor for preprocessed assembly codes.\n\n\tPR gas/25878\n\tPR gas/26740\n\t* dwarf2dbg.c (allocate_filename_to_slot): Don't reuse the slot 1\n\there.\n\t(dwarf2_where): Restore as_where.\n\t(dwarf2_directive_filename): Clear the slot 1 if it was assigned\n\tto the input file.\n\t* testsuite/gas/i386/dwarf5-line-2.d: New file.\n\t* testsuite/gas/i386/dwarf5-line-2.s: Likewise.\n\t* testsuite/gas/i386/dwarf5-line-3.d: Likewise.\n\t* testsuite/gas/i386/dwarf5-line-3.s: Likewise.\n\t* testsuite/gas/i386/i386.exp: Run dwarf5-line-2 and\n\tdwarf5-line-3.",
    "tree": {
      "sha": "a56cf044039f44e5acb214d21c0eea27d6de8e32",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a56cf044039f44e5acb214d21c0eea27d6de8e32"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bd0c565edbf4ba8121fded38e389530d7fa6f963",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bd0c565edbf4ba8121fded38e389530d7fa6f963",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bd0c565edbf4ba8121fded38e389530d7fa6f963",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bd0c565edbf4ba8121fded38e389530d7fa6f963/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "43f8eb75479f1f2d91ef57b0baac90c10a6b3a3d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/43f8eb75479f1f2d91ef57b0baac90c10a6b3a3d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/43f8eb75479f1f2d91ef57b0baac90c10a6b3a3d"
    }
  ],
  "stats": {
    "total": 174,
    "additions": 155,
    "deletions": 19
  },
  "files": [
    {
      "sha": "bcc538ee2f12ed2719276f6bb08f37fe384228df",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -1,3 +1,19 @@\n+2020-10-17  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR gas/25878\n+\tPR gas/26740\n+\t* dwarf2dbg.c (allocate_filename_to_slot): Don't reuse the slot 1\n+\there.\n+\t(dwarf2_where): Restore as_where.\n+\t(dwarf2_directive_filename): Clear the slot 1 if it was assigned\n+\tto the input file.\n+\t* testsuite/gas/i386/dwarf5-line-2.d: New file.\n+\t* testsuite/gas/i386/dwarf5-line-2.s: Likewise.\n+\t* testsuite/gas/i386/dwarf5-line-3.d: Likewise.\n+\t* testsuite/gas/i386/dwarf5-line-3.s: Likewise.\n+\t* testsuite/gas/i386/i386.exp: Run dwarf5-line-2 and\n+\tdwarf5-line-3.\n+\n 2020-10-16  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gas/25878"
    },
    {
      "sha": "75ef7c43e3986b5e42a81513e6714d1853c9a009",
      "filename": "gas/dwarf2dbg.c",
      "status": "modified",
      "additions": 24,
      "deletions": 19,
      "changes": 43,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/dwarf2dbg.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/dwarf2dbg.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/dwarf2dbg.c?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -790,24 +790,15 @@ allocate_filename_to_slot (const char *  dirname,\n \t}\n \n     fail:\n-      /* Reuse NUM if it is 1 and was assigned to the input file before\n-\t the first .file <NUMBER> directive was seen.  */\n-      file = as_where_physical (&i);\n-      file = get_basename (file);\n-      if (num == 1 && filename_cmp (file, files[num].filename) == 0)\n-\tfiles[num].filename = NULL;\n-      else\n-\t{\n-\t  as_bad (_(\"file table slot %u is already occupied by a different file (%s%s%s vs %s%s%s)\"),\n-\t\t  num,\n-\t\t  dir == NULL ? \"\" : dir,\n-\t\t  dir == NULL ? \"\" : \"/\",\n-\t\t  files[num].filename,\n-\t\t  dirname == NULL ? \"\" : dirname,\n-\t\t  dirname == NULL ? \"\" : \"/\",\n-\t\t  filename);\n-\t  return FALSE;\n-\t}\n+      as_bad (_(\"file table slot %u is already occupied by a different file (%s%s%s vs %s%s%s)\"),\n+\t      num,\n+\t      dir == NULL ? \"\" : dir,\n+\t      dir == NULL ? \"\" : \"/\",\n+\t      files[num].filename,\n+\t      dirname == NULL ? \"\" : dirname,\n+\t      dirname == NULL ? \"\" : \"/\",\n+\t      filename);\n+      return FALSE;\n     }\n \n   if (dirname == NULL)\n@@ -894,7 +885,7 @@ dwarf2_where (struct dwarf2_line_info *line)\n       const char *filename;\n \n       memset (line, 0, sizeof (*line));\n-      filename = as_where_physical (&line->line);\n+      filename = as_where (&line->line);\n       line->filenum = allocate_filenum (filename);\n       /* FIXME: We should check the return value from allocate_filenum.  */\n       line->column = 0;\n@@ -1088,6 +1079,20 @@ dwarf2_directive_filename (void)\n       return NULL;\n     }\n \n+  if (files_in_use == 2)\n+    {\n+      /* Clear the slot 1 if it was assigned to the input file before\n+\t the first .file <NUMBER> directive was seen.  */\n+      unsigned int lineno;\n+      const char *file = as_where (&lineno);\n+      file = get_basename (file);\n+      if (filename_cmp (file, files[1].filename) == 0)\n+\t{\n+\t  files[1].filename = NULL;\n+\t  files_in_use = 0;\n+\t}\n+    }\n+\n   if (! allocate_filename_to_slot (dirname, filename, (unsigned int) num,\n \t\t\t\t   with_md5))\n     return NULL;"
    },
    {
      "sha": "302a2d8fcc4380234e289e315cd46421533c8b51",
      "filename": "gas/testsuite/gas/i386/dwarf5-line-2.d",
      "status": "added",
      "additions": 49,
      "deletions": 0,
      "changes": 49,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-2.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-2.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/dwarf5-line-2.d?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -0,0 +1,49 @@\n+#as: -gdwarf-5\n+#readelf: -wl\n+#name: DWARF5 .debug_line 2\n+\n+Raw dump of debug contents of section \\.z?debug_line:\n+\n+  Offset:                      0x0\n+  Length:                      .*\n+  DWARF Version:               5\n+  Address size \\(bytes\\):        .*\n+  Segment selector \\(bytes\\):    0\n+  Prologue Length:             .*\n+  Minimum Instruction Length:  1\n+  Maximum Ops per Instruction: 1\n+  Initial value of 'is_stmt':  1\n+  Line Base:                   -5\n+  Line Range:                  14\n+  Opcode Base:                 13\n+\n+ Opcodes:\n+  Opcode 1 has 0 args\n+  Opcode 2 has 1 arg\n+  Opcode 3 has 1 arg\n+  Opcode 4 has 1 arg\n+  Opcode 5 has 1 arg\n+  Opcode 6 has 0 args\n+  Opcode 7 has 0 args\n+  Opcode 8 has 0 args\n+  Opcode 9 has 1 arg\n+  Opcode 10 has 0 args\n+  Opcode 11 has 0 args\n+  Opcode 12 has 1 arg\n+\n+ The Directory Table \\(offset 0x.*, lines 2, columns 1\\):\n+  Entry\tName\n+  0\t\\(indirect line string, offset: 0x.*\\): .*/gas/testsuite/gas/i386\n+  1\t\\(indirect line string, offset: 0x.*\\): .*/gas/testsuite/gas/i386\n+\n+ The File Name Table \\(offset 0x.*, lines 1, columns 3\\):\n+  Entry\tDir\tMD5\t\t\t\tName\n+  0\t0 0xbbd69fc03ce253b2dbaab2522dd519ae\t\\(indirect line string, offset: 0x.*\\): core.c\n+\n+ Line Number Statements:\n+  \\[0x.*\\]  Extended opcode 2: set Address to 0x0\n+  \\[0x.*\\]  Special opcode 8: advance Address by 0 to 0x0 and Line by 3 to 4\n+  \\[0x.*\\]  Advance PC by 1 to 0x1\n+  \\[0x.*\\]  Extended opcode 1: End of Sequence\n+\n+"
    },
    {
      "sha": "4af7d7061c9bdd54d0e994f1750cb00c6721a5f5",
      "filename": "gas/testsuite/gas/i386/dwarf5-line-2.s",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-2.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-2.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/dwarf5-line-2.s?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -0,0 +1,5 @@\n+\t.text\n+\t.global kretprobe_trampoline\n+kretprobe_trampoline:\n+\tret\n+\t.file\t0 \"core.c\" md5 0xbbd69fc03ce253b2dbaab2522dd519ae"
    },
    {
      "sha": "6f4ebf047186bdfec652ce7290f3ad79e8087e1b",
      "filename": "gas/testsuite/gas/i386/dwarf5-line-3.d",
      "status": "added",
      "additions": 49,
      "deletions": 0,
      "changes": 49,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-3.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-3.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/dwarf5-line-3.d?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -0,0 +1,49 @@\n+#as: -g -gdwarf-5\n+#readelf: -wl\n+#name: DWARF5 .debug_line 2\n+\n+Raw dump of debug contents of section \\.z?debug_line:\n+\n+  Offset:                      0x0\n+  Length:                      .*\n+  DWARF Version:               5\n+  Address size \\(bytes\\):        .*\n+  Segment selector \\(bytes\\):    0\n+  Prologue Length:             .*\n+  Minimum Instruction Length:  1\n+  Maximum Ops per Instruction: 1\n+  Initial value of 'is_stmt':  1\n+  Line Base:                   -5\n+  Line Range:                  14\n+  Opcode Base:                 13\n+\n+ Opcodes:\n+  Opcode 1 has 0 args\n+  Opcode 2 has 1 arg\n+  Opcode 3 has 1 arg\n+  Opcode 4 has 1 arg\n+  Opcode 5 has 1 arg\n+  Opcode 6 has 0 args\n+  Opcode 7 has 0 args\n+  Opcode 8 has 0 args\n+  Opcode 9 has 1 arg\n+  Opcode 10 has 0 args\n+  Opcode 11 has 0 args\n+  Opcode 12 has 1 arg\n+\n+ The Directory Table \\(offset 0x.*, lines 1, columns 1\\):\n+  Entry\tName\n+  0\t\\(indirect line string, offset: 0x.*\\): .*\n+\n+ The File Name Table \\(offset 0x.*, lines 2, columns 2\\):\n+  Entry\tDir\tName\n+  0\t0\t\\(indirect line string, offset: 0x.*\\): dwarf5-line-2.S\n+  1\t0\t\\(indirect line string, offset: 0x.*\\): dwarf5-line-2.S\n+\n+ Line Number Statements:\n+  \\[0x.*\\]  Extended opcode 2: set Address to 0x0\n+  \\[0x.*\\]  Special opcode 7: advance Address by 0 to 0x0 and Line by 2 to 3\n+  \\[0x.*\\]  Advance PC by 1 to 0x1\n+  \\[0x.*\\]  Extended opcode 1: End of Sequence\n+\n+"
    },
    {
      "sha": "52e259d1033f0c41eefb147eab6359cb9e999938",
      "filename": "gas/testsuite/gas/i386/dwarf5-line-3.s",
      "status": "added",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-3.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/dwarf5-line-3.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/dwarf5-line-3.s?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -0,0 +1,10 @@\n+# 1 \"foo.S\"\n+# 1 \"<built-in>\"\n+# 1 \"<command-line>\"\n+# 31 \"<command-line>\"\n+# 1 \"/usr/include/stdc-predef.h\" 1 3 4\n+# 32 \"<command-line>\" 2\n+# 1 \"dwarf5-line-2.S\"\n+ .text\n+lbasename:\n+ .nop"
    },
    {
      "sha": "d8bae38e54fc90361418e7218c849860d6b65d19",
      "filename": "gas/testsuite/gas/i386/i386.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/i386.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bd0c565edbf4ba8121fded38e389530d7fa6f963/gas/testsuite/gas/i386/i386.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/i386.exp?ref=bd0c565edbf4ba8121fded38e389530d7fa6f963",
      "patch": "@@ -615,6 +615,8 @@ if [gas_32_check] then {\n \trun_dump_test \"dwarf2-line-3\"\n \trun_dump_test \"dwarf2-line-4\"\n \trun_dump_test \"dwarf5-line-1\"\n+\trun_dump_test \"dwarf5-line-2\"\n+\trun_dump_test \"dwarf5-line-3\"\n \n \trun_dump_test \"dw2-compress-2\"\n \trun_dump_test \"dw2-compressed-2\""
    }
  ]
}