{
  "sha": "08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDhjYzM3ZGQwNDIzMzgyMDljOGUyYWE1ZGIwNGFlZjJlY2I1YzYyYg==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-09-15T15:27:01Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2020-09-15T15:27:01Z"
    },
    "message": "Avoid running one Rust test against older LLVM\n\nLLVM 8.0 introduced some changes to let the Rust compiler emit DWARF\nvariant parts.  Before this change, the compiler would emit two types\nwith the same name, and unfortunately gdb happens to pick the wrong\none.  So, this patch disables the test when using an older version of\nLLVM.\n\ngdb/testsuite/ChangeLog\n2020-09-15  Tom Tromey  <tromey@adacore.com>\n\n\tPR rust/26197:\n\t* lib/rust-support.exp (rust_llvm_version): New proc.\n\t* gdb.rust/simple.exp: Check rust_llvm_version.",
    "tree": {
      "sha": "d53ceebe483d7a77b4701254429be25206f54432",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d53ceebe483d7a77b4701254429be25206f54432"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "cbe256847e19f044039afeba7b152ef19d9e0635",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cbe256847e19f044039afeba7b152ef19d9e0635",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/cbe256847e19f044039afeba7b152ef19d9e0635"
    }
  ],
  "stats": {
    "total": 38,
    "additions": 36,
    "deletions": 2
  },
  "files": [
    {
      "sha": "0438760080dd3439b312aa87c2869a7c51696c95",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
      "patch": "@@ -1,3 +1,9 @@\n+2020-09-15  Tom Tromey  <tromey@adacore.com>\n+\n+\tPR rust/26197:\n+\t* lib/rust-support.exp (rust_llvm_version): New proc.\n+\t* gdb.rust/simple.exp: Check rust_llvm_version.\n+\n 2020-09-14  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.rust/traits.exp: Fix PATH warning."
    },
    {
      "sha": "882c2e07bcd58d56cd2cca5f09701741e43856af",
      "filename": "gdb/testsuite/gdb.rust/simple.exp",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/gdb/testsuite/gdb.rust/simple.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/gdb/testsuite/gdb.rust/simple.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.rust/simple.exp?ref=08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
      "patch": "@@ -375,5 +375,14 @@ gdb_test \"python print(e.type.fields()\\[0\\].artificial)\" \"True\"\n gdb_test \"python print(e.type.fields()\\[1\\].name)\" \"Two\"\n \n gdb_test \"python print(e.type.dynamic)\" \"False\"\n-gdb_test \"python print(gdb.lookup_type('simple::MoreComplicated').dynamic)\" \\\n-    \"True\"\n+\n+# Before LLVM 8, the rust compiler would emit two types named\n+# \"simple::MoreComplicated\" -- the C-like \"underlying\" enum type and\n+# the Rust enum.  lookup_type seems to get the former, which isn't\n+# very useful.  With later versions of LLVM, this test works\n+# correctly.\n+set v [split [rust_llvm_version] .]\n+if {[lindex $v 0] >= 8} {\n+    gdb_test \"python print(gdb.lookup_type('simple::MoreComplicated').dynamic)\" \\\n+\t\"True\"\n+}"
    },
    {
      "sha": "9c9ef1bbd2afafbf9f89057ca780f2caf87d95ac",
      "filename": "gdb/testsuite/lib/rust-support.exp",
      "status": "modified",
      "additions": 19,
      "deletions": 0,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/gdb/testsuite/lib/rust-support.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/08cc37dd042338209c8e2aa5db04aef2ecb5c62b/gdb/testsuite/lib/rust-support.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/rust-support.exp?ref=08cc37dd042338209c8e2aa5db04aef2ecb5c62b",
      "patch": "@@ -35,3 +35,22 @@ proc gdb_compile_rust {sources dest options} {\n     }\n     return \"\"\n }\n+\n+# Return the version of LLVM used by the Rust compiler.  Note that\n+# older versions of rustc don't print this -- in this case the\n+# returned version is \"0.0\".\n+gdb_caching_proc rust_llvm_version {\n+    set rustc [find_rustc]\n+    if {$rustc == \"\"} {\n+\tverbose \"could not find rustc\"\n+    } else {\n+\tset output [lindex [remote_exec host \"$rustc --version --verbose\"] 1]\n+\tforeach line [split $output \\n] {\n+\t    if {[regexp \"LLVM version: (.+)\\$\" $output ignore version]} {\n+\t\treturn $version\n+\t    }\n+\t}\n+\tverbose \"could not match rustc version output: $output\"\n+    }\n+    return 0.0\n+}"
    }
  ]
}