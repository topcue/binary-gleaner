{
  "sha": "197a63068b10d50c01fbe024a45d47cd25a907e3",
  "node_id": "C_kwDOANOeidoAKDE5N2E2MzA2OGIxMGQ1MGMwMWZiZTAyNGE0NWQ0N2NkMjVhOTA3ZTM",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-12-06T15:01:47Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-12-06T15:01:47Z"
    },
    "message": "[gdb/testsuite] Fix data alignment in gdb.arch/i386-{avx,sse}.exp\n\nWhen running test-case gdb.arch/i386-avx.exp with clang I ran into:\n...\n(gdb) PASS: gdb.arch/i386-avx.exp: set first breakpoint in main\ncontinue^M\nContinuing.^M\n^M\nProgram received signal SIGSEGV, Segmentation fault.^M\n0x000000000040052b in main (argc=1, argv=0x7fffffffd3c8) at i386-avx.c:54^M\n54        asm (\"vmovaps 0(%0), %%ymm0\\n\\t\"^M\n(gdb) FAIL: gdb.arch/i386-avx.exp: continue to breakpoint: \\\n  continue to first breakpoint in main\n...\n\nThe problem is that the vmovaps insn requires an 256-bit (or 32-byte) aligned\naddress, and it's only 16-byte aligned:\n...\n(gdb) p /x $rax\n$1 = 0x601030\n...\n\nFix this by using a sufficiently aligned address, using _Alignas.\n\nCompile using -std=gnu11 to support _Alignas.\n\nLikewise in gdb.arch/i386-sse.exp.\n\nTested on x86_64-linux, with both gcc and clang.",
    "tree": {
      "sha": "d4bfe298f6e544518ec001b952ff555ecbf78396",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d4bfe298f6e544518ec001b952ff555ecbf78396"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/197a63068b10d50c01fbe024a45d47cd25a907e3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/197a63068b10d50c01fbe024a45d47cd25a907e3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/197a63068b10d50c01fbe024a45d47cd25a907e3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/197a63068b10d50c01fbe024a45d47cd25a907e3/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f21dbd7c8038acee8ece4d57f2454083c37e98f6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f21dbd7c8038acee8ece4d57f2454083c37e98f6",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f21dbd7c8038acee8ece4d57f2454083c37e98f6"
    }
  ],
  "stats": {
    "total": 32,
    "additions": 24,
    "deletions": 8
  },
  "files": [
    {
      "sha": "765026c83fb07bb7e6839f4efbb23e893769a9b1",
      "filename": "gdb/testsuite/gdb.arch/i386-avx.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-avx.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-avx.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.arch/i386-avx.c?ref=197a63068b10d50c01fbe024a45d47cd25a907e3",
      "patch": "@@ -20,8 +20,11 @@\n #include <stdio.h>\n #include \"nat/x86-cpuid.h\"\n \n+/* Align sufficient to be able to use vmovaps.  */\n+#define ALIGN 32\n+\n typedef struct {\n-  float f[8];\n+  _Alignas (ALIGN) float f[8];\n } v8sf_t;\n \n "
    },
    {
      "sha": "d721b8c462492547d29e636a35c71239ed9bda0e",
      "filename": "gdb/testsuite/gdb.arch/i386-avx.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 3,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-avx.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-avx.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.arch/i386-avx.exp?ref=197a63068b10d50c01fbe024a45d47cd25a907e3",
      "patch": "@@ -35,12 +35,17 @@ if [get_compiler_info] {\n     return -1\n }\n \n-set additional_flags \"\"\n+set flags { debug }\n+\n+# C11 for _Alignas, gnu for asm.\n+lappend flags additional_flags=-std=gnu11\n+\n if { [test_compiler_info gcc*] || [test_compiler_info clang*] } {\n-    set additional_flags \"additional_flags=-mavx -I${srcdir}/..\"\n+    lappend flags \"additional_flags=-mavx -I${srcdir}/..\"\n }\n \n-if { [gdb_compile \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" executable [list debug $additional_flags]] != \"\" } {\n+if { [gdb_compile \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" executable \\\n+\t  $flags] != \"\" } {\n     unsupported \"compiler does not support AVX\"\n     return\n }"
    },
    {
      "sha": "10bd4b62ff08b88d32a6f61717ceca217d9d5eff",
      "filename": "gdb/testsuite/gdb.arch/i386-sse.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-sse.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-sse.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.arch/i386-sse.c?ref=197a63068b10d50c01fbe024a45d47cd25a907e3",
      "patch": "@@ -20,8 +20,11 @@\n #include <stdio.h>\n #include \"nat/x86-cpuid.h\"\n \n+/* Align sufficient to be able to use movaps.  */\n+#define ALIGN 16\n+\n typedef struct {\n-  float f[4];\n+  _Alignas (ALIGN) float f[4];\n } v4sf_t;\n \n "
    },
    {
      "sha": "15649e435f74a7de9deddd4ca200a6f29b8d59bf",
      "filename": "gdb/testsuite/gdb.arch/i386-sse.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 3,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-sse.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/197a63068b10d50c01fbe024a45d47cd25a907e3/gdb/testsuite/gdb.arch/i386-sse.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.arch/i386-sse.exp?ref=197a63068b10d50c01fbe024a45d47cd25a907e3",
      "patch": "@@ -30,12 +30,17 @@ if [get_compiler_info] {\n     return -1\n }\n \n-set additional_flags \"\"\n+set flags { debug }\n+\n+# C11 for _Alignas, gnu for asm.\n+lappend flags additional_flags=-std=gnu11\n+\n if { [test_compiler_info gcc*] || [test_compiler_info clang*] } {\n-    set additional_flags \"additional_flags=-msse -I${srcdir}/..\"\n+    lappend flags \"additional_flags=-msse -I${srcdir}/..\"\n }\n \n-if { [gdb_compile \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" executable [list debug $additional_flags]] != \"\" } {\n+if { [gdb_compile \"${srcdir}/${subdir}/${srcfile}\" \"${binfile}\" executable \\\n+\t  $flags] != \"\" } {\n     unsupported \"compiler does not support SSE\"\n     return\n }"
    }
  ]
}