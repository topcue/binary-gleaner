{
  "sha": "e2de1eec22358c64510dc18e755d0ff4cf91ad7a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTJkZTFlZWMyMjM1OGM2NDUxMGRjMThlNzU1ZDBmZjRjZjkxYWQ3YQ==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-01-13T18:59:18Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-01-13T18:59:18Z"
    },
    "message": "gdb: make regformats output a declaration for the init function\n\nWhen compiling gdbserver for an architecture that uses the regdat.sh\nscript (such as m68k) and the -Wmissing-declarations compiler flag, I\nget:\n\n  REGDAT reg-m68k-generated.c\n  CXX    reg-m68k.o\nreg-m68k-generated.c:30:1: error: no previous declaration for 'void init_registers_m68k()' [-Werror=missing-declarations]\n   30 | init_registers_m68k (void)\n      | ^~~~~~~~~~~~~~~~~~~\n\nThe same happens with other architectures, such as s390, but I'll be\nusing 68k as an example.\n\nThe init_registers_m68k function is defined in reg-m68k-generated.c,\nwhich is produced by the regformats/regdat.sh script.  This script reads\nthe regformats/reg-m68k.dat file, containing a register description, and\nproduces C code that creates a corresponding target description at\nruntime.\n\nThe init_registers_m68k function is invoked at initialization time in\nlinux-m68k-low.c.  The function must therefore be non-static, but does\nnot have a declaration at the moment.\n\nThe real clean way of fixing this would be to make regdat.sh generate a\n.h file (in addition to the .c file) with declarations for whatever is\nin the .c file.  The generated .c file would include the .h file, and\ntherefore the definition would have a corresponding declaration.  The\nlinux-m68k-low.c file would also include this .h file, instead of having\nits own declaration of init_registers_m68k, like it does now.\n\nHowever, this would be a quite big change for not much gain.  As far as\nI understand, some common architectures (i386, x86-64, ARM, AArch64)\nhave been moved to dynamically building target descriptions based on\nfeatures (the linux-*-tdesc.c files in gdbserver) and don't use\nregdat.sh anymore.  Logically (and given infinite development\nresources), the other architectures would be migrated to this system too\nand the regdat.sh script would be dropped.  A new architecture would\nprobably not use regdat.sh either.  So I therefore propose this simpler\npatch instead, which just adds a local declaration in the generated\nfile.\n\ngdb/ChangeLog:\n\n\t* regformats/regdat.sh: Generate declaration for init function.",
    "tree": {
      "sha": "f93a2bfb6121f33de34a1347a29e5c2e3a30b0e4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f93a2bfb6121f33de34a1347a29e5c2e3a30b0e4"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e2de1eec22358c64510dc18e755d0ff4cf91ad7a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2de1eec22358c64510dc18e755d0ff4cf91ad7a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e2de1eec22358c64510dc18e755d0ff4cf91ad7a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e2de1eec22358c64510dc18e755d0ff4cf91ad7a/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4025fa094d2420134acc4fea2049e707df8ecd01",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4025fa094d2420134acc4fea2049e707df8ecd01",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4025fa094d2420134acc4fea2049e707df8ecd01"
    }
  ],
  "stats": {
    "total": 8,
    "additions": 8,
    "deletions": 0
  },
  "files": [
    {
      "sha": "78387ff010afd3550e62bc89fed38b62e4d3bba8",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2de1eec22358c64510dc18e755d0ff4cf91ad7a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2de1eec22358c64510dc18e755d0ff4cf91ad7a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=e2de1eec22358c64510dc18e755d0ff4cf91ad7a",
      "patch": "@@ -1,3 +1,7 @@\n+2020-01-13  Simon Marchi  <simon.marchi@polymtl.ca>\n+\n+\t* regformats/regdat.sh: Generate declaration for init function.\n+\n 2020-01-13  Simon Marchi  <simon.marchi@polymtl.ca>\n \n \t* remote-sim.c (next_pid, INITIAL_PID, sim_inferior_data): Move"
    },
    {
      "sha": "a40f2336484fc983c398dbb8591342cc4f2ded53",
      "filename": "gdb/regformats/regdat.sh",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e2de1eec22358c64510dc18e755d0ff4cf91ad7a/gdb/regformats/regdat.sh",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e2de1eec22358c64510dc18e755d0ff4cf91ad7a/gdb/regformats/regdat.sh",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/regformats/regdat.sh?ref=e2de1eec22358c64510dc18e755d0ff4cf91ad7a",
      "patch": "@@ -127,6 +127,10 @@ do\n \n     echo \"const struct target_desc *tdesc_${name};\"\n     echo \"\"\n+\n+    # This is necessary for -Wmissing-declarations.\n+    echo \"void init_registers_${name} (void);\"\n+\n     echo \"void\"\n     echo \"init_registers_${name} (void)\"\n     echo \"{\""
    }
  ]
}