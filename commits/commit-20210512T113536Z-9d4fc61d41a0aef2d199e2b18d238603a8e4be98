{
  "sha": "9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OWQ0ZmM2MWQ0MWEwYWVmMmQxOTllMmIxOGQyMzg2MDNhOGU0YmU5OA==",
  "commit": {
    "author": {
      "name": "George Barrett",
      "email": "bob@bob131.so",
      "date": "2021-04-28T17:32:47Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-05-12T11:35:36Z"
    },
    "message": "Guile: add value-{rvalue-,}reference-value\n\nThe Guile API doesn't currently have an equivalent to the Python API's\nValue.reference_value() or Value.rvalue_reference_value(). This commit\nadds a procedure with equivalent semantics to the Guile API.\n\ngdb/ChangeLog:\n\n\t* NEWS (Guile API): Note the addition of new procedures.\n\t* guile/scm-value.c (gdbscm_reference_value): Add helper function\n\tfor reference value creation.\n\t(gdbscm_value_reference_value): Add implementation of\n\tvalue-reference-value procedure.\n\t(gdbscm_value_rvalue_reference_value): Add implementation of\n\tvalue-rvalue-reference-value procedure.\n\t(value_functions): Add value-reference-value procedure.  Add\n\tvalue-rvalue-reference-value procedure.\n\ngdb/doc/ChangeLog:\n\n\t* guile.texi (Values From Inferior In Guile): Add documentation\n\tfor value-reference-value.  Add documentation for\n\tvalue-rvalue-reference-value.\n\ngdb/testsuite/ChangeLog:\n\n\t* gdb.guile/scm-value.exp (test_value_in_inferior): Add test for\n\tvalue-reference-value.  Add test for value-rvalue-reference-value.",
    "tree": {
      "sha": "6d14bbf4abcb031b467556465c1dab31060159ac",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6d14bbf4abcb031b467556465c1dab31060159ac"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/comments",
  "author": {
    "login": "Bob131",
    "id": 4337852,
    "node_id": "MDQ6VXNlcjQzMzc4NTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4337852?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Bob131",
    "html_url": "https://github.com/Bob131",
    "followers_url": "https://api.github.com/users/Bob131/followers",
    "following_url": "https://api.github.com/users/Bob131/following{/other_user}",
    "gists_url": "https://api.github.com/users/Bob131/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Bob131/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Bob131/subscriptions",
    "organizations_url": "https://api.github.com/users/Bob131/orgs",
    "repos_url": "https://api.github.com/users/Bob131/repos",
    "events_url": "https://api.github.com/users/Bob131/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Bob131/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "97cef6b7b79c22a3cc14ef369c1dc09a8bcca357",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/97cef6b7b79c22a3cc14ef369c1dc09a8bcca357",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/97cef6b7b79c22a3cc14ef369c1dc09a8bcca357"
    }
  ],
  "stats": {
    "total": 88,
    "additions": 88,
    "deletions": 0
  },
  "files": [
    {
      "sha": "f29f60a7d62b9c713b85e6bceca0c0b1cec96911",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -1,3 +1,15 @@\n+2021-05-12  George Barrett  <bob@bob131.so>\n+\n+\t* NEWS (Guile API): Note the addition of new procedures.\n+\t* guile/scm-value.c (gdbscm_reference_value): Add helper function\n+\tfor reference value creation.\n+\t(gdbscm_value_reference_value): Add implementation of\n+\tvalue-reference-value procedure.\n+\t(gdbscm_value_rvalue_reference_value): Add implementation of\n+\tvalue-rvalue-reference-value procedure.\n+\t(value_functions): Add value-reference-value procedure.  Add\n+\tvalue-rvalue-reference-value procedure.\n+\n 2021-05-12  George Barrett  <bob@bob131.so>\n \n \t* guile/scm-type.c (type_integer_constants): Add binding for"
    },
    {
      "sha": "f7844e5d9e344cda0ed7ae908b55866778219656",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -207,6 +207,9 @@ QMemTags\n      value-referenced-value procedure now handles rvalue reference\n      values.\n \n+  ** New procedures for obtaining reference values:\n+     value-reference-value and value-rvalue-reference-value.\n+\n *** Changes in GDB 10\n \n * There are new feature names for ARC targets: \"org.gnu.gdb.arc.core\""
    },
    {
      "sha": "029e2404470b945060b8573e0499579369745862",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-12  George Barrett  <bob@bob131.so>\n+\n+\t* guile.texi (Values From Inferior In Guile): Add documentation\n+\tfor value-reference-value.  Add documentation for\n+\tvalue-rvalue-reference-value.\n+\n 2021-05-12  George Barrett  <bob@bob131.so>\n \n \t* guile.texi (Types In Guile): Add documentation for"
    },
    {
      "sha": "cca3a943c61ab7a936e4725ded04a9820de3297c",
      "filename": "gdb/doc/guile.texi",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/doc/guile.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/doc/guile.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/guile.texi?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -801,6 +801,16 @@ The @code{<gdb:value>} object @code{scm-val} is identical to that\n corresponding to @code{val}.\n @end deffn\n \n+@deffn {Scheme Procedure} value-reference-value value\n+Return a new @code{<gdb:value>} object which is a reference to the value\n+encapsulated by @code{<gdb:value>} object @var{value}.\n+@end deffn\n+\n+@deffn {Scheme Procedure} value-rvalue-reference-value value\n+Return a new @code{<gdb:value>} object which is an rvalue reference to\n+the value encapsulated by @code{<gdb:value>} object @var{value}.\n+@end deffn\n+\n @deffn {Scheme Procedure} value-field value field-name\n Return field @var{field-name} from @code{<gdb:value>} object @var{value}.\n @end deffn"
    },
    {
      "sha": "a07bc7d2e6129223f1bfb4c7310e6fe6f60513d5",
      "filename": "gdb/guile/scm-value.c",
      "status": "modified",
      "additions": 42,
      "deletions": 0,
      "changes": 42,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/guile/scm-value.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/guile/scm-value.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/guile/scm-value.c?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -488,6 +488,38 @@ gdbscm_value_referenced_value (SCM self)\n     });\n }\n \n+static SCM\n+gdbscm_reference_value (SCM self, enum type_code refcode)\n+{\n+  value_smob *v_smob\n+    = vlscm_get_value_smob_arg_unsafe (self, SCM_ARG1, FUNC_NAME);\n+  struct value *value = v_smob->value;\n+\n+  return gdbscm_wrap ([=]\n+    {\n+      scoped_value_mark free_values;\n+\n+      struct value *res_val = value_ref (value, refcode);\n+      return vlscm_scm_from_value (res_val);\n+    });\n+}\n+\n+/* (value-reference-value <gdb:value>) -> <gdb:value> */\n+\n+static SCM\n+gdbscm_value_reference_value (SCM self)\n+{\n+  return gdbscm_reference_value (self, TYPE_CODE_REF);\n+}\n+\n+/* (value-rvalue-reference-value <gdb:value>) -> <gdb:value> */\n+\n+static SCM\n+gdbscm_value_rvalue_reference_value (SCM self)\n+{\n+  return gdbscm_reference_value (self, TYPE_CODE_RVALUE_REF);\n+}\n+\n /* (value-type <gdb:value>) -> <gdb:type> */\n \n static SCM\n@@ -1352,6 +1384,16 @@ For example, for a value which is a reference to an 'int' pointer ('int *'),\\n\\\n value-dereference will result in a value of type 'int' while\\n\\\n value-referenced-value will result in a value of type 'int *'.\" },\n \n+  { \"value-reference-value\", 1, 0, 0,\n+    as_a_scm_t_subr (gdbscm_value_reference_value),\n+    \"\\\n+Return a <gdb:value> object which is a reference to the given value.\" },\n+\n+  { \"value-rvalue-reference-value\", 1, 0, 0,\n+    as_a_scm_t_subr (gdbscm_value_rvalue_reference_value),\n+    \"\\\n+Return a <gdb:value> object which is an rvalue reference to the given value.\" },\n+\n   { \"value-field\", 2, 0, 0, as_a_scm_t_subr (gdbscm_value_field),\n     \"\\\n Return the specified field of the value.\\n\\"
    },
    {
      "sha": "691e83cdc94fa938c299c80df67d7d95ea53ccf8",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -1,3 +1,8 @@\n+2021-05-12  George Barrett  <bob@bob131.so>\n+\n+\t* gdb.guile/scm-value.exp (test_value_in_inferior): Add test for\n+\tvalue-reference-value.  Add test for value-rvalue-reference-value.\n+\n 2021-05-11  Tom de Vries  <tdevries@suse.de>\n \n \t* gdb.base/watch_thread_num.exp: Fix \"set debug infrun 1\" FAILs."
    },
    {
      "sha": "b3f785c9ecf5789eb7f2ad7d0c92723eaf27e647",
      "filename": "gdb/testsuite/gdb.guile/scm-value.exp",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/testsuite/gdb.guile/scm-value.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d4fc61d41a0aef2d199e2b18d238603a8e4be98/gdb/testsuite/gdb.guile/scm-value.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.guile/scm-value.exp?ref=9d4fc61d41a0aef2d199e2b18d238603a8e4be98",
      "patch": "@@ -173,6 +173,16 @@ proc test_value_in_inferior {} {\n \t\"get string beyond null\"\n     gdb_test \"gu (print nullst)\" \\\n \t\"= divide\\\\\\\\000et\"\n+\n+    gdb_scm_test_silent_cmd \"gu (define argv-ref (value-reference-value argv))\" \\\n+\t\"test value-reference-value\"\n+    gdb_test \"gu (equal? argv (value-referenced-value argv-ref))\" \"#t\"\n+    gdb_test \"gu (eqv? (type-code (value-type argv-ref)) TYPE_CODE_REF)\" \"#t\"\n+\n+    gdb_scm_test_silent_cmd \"gu (define argv-rref (value-rvalue-reference-value argv))\" \\\n+\t\"test value-rvalue-reference-value\"\n+    gdb_test \"gu (equal? argv (value-referenced-value argv-rref))\" \"#t\"\n+    gdb_test \"gu (eqv? (type-code (value-type argv-rref)) TYPE_CODE_RVALUE_REF)\" \"#t\"\n }\n \n proc test_strings {} {"
    }
  ]
}