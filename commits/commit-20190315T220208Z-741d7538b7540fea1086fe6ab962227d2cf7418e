{
  "sha": "741d7538b7540fea1086fe6ab962227d2cf7418e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzQxZDc1MzhiNzU0MGZlYTEwODZmZTZhYjk2MjIyN2QyY2Y3NDE4ZQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-03-02T19:05:57Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-03-15T22:02:08Z"
    },
    "message": "Remove minsym termination\n\nI was curious what used the terminating \"null\" minimal symbol; and\nafter looking I could not find anything.  This patch removes\nterminate_minimal_symbol_table and the extra minimal symbol that is\nallocated for it.\n\ngdb/ChangeLog\n2019-03-15  Tom Tromey  <tom@tromey.com>\n\n\t* symfile.c (reread_symbols): Update.\n\t* objfiles.c (objfile::objfile): Update.\n\t* minsyms.h (terminate_minimal_symbol_table): Don't declare.\n\t* minsyms.c (lookup_minimal_symbol_by_pc_section): Update\n\tcomment.\n\t(minimal_symbol_reader::install): Update.\n\t(terminate_minimal_symbol_table): Remove.\n\t* jit.c (jit_object_close_impl): Update.",
    "tree": {
      "sha": "e71eac2f51a9c6b88294567242b3320eca0edc26",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e71eac2f51a9c6b88294567242b3320eca0edc26"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/741d7538b7540fea1086fe6ab962227d2cf7418e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/741d7538b7540fea1086fe6ab962227d2cf7418e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/741d7538b7540fea1086fe6ab962227d2cf7418e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/741d7538b7540fea1086fe6ab962227d2cf7418e/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "788c80d1aff685e66b8105ddc7451cfa6a03bf1d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/788c80d1aff685e66b8105ddc7451cfa6a03bf1d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/788c80d1aff685e66b8105ddc7451cfa6a03bf1d"
    }
  ],
  "stats": {
    "total": 63,
    "additions": 14,
    "deletions": 49
  },
  "files": [
    {
      "sha": "e1adb08b3a326e2ebb3601847ab81f3d2e60d206",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=741d7538b7540fea1086fe6ab962227d2cf7418e",
      "patch": "@@ -1,3 +1,14 @@\n+2019-03-15  Tom Tromey  <tom@tromey.com>\n+\n+\t* symfile.c (reread_symbols): Update.\n+\t* objfiles.c (objfile::objfile): Update.\n+\t* minsyms.h (terminate_minimal_symbol_table): Don't declare.\n+\t* minsyms.c (lookup_minimal_symbol_by_pc_section): Update\n+\tcomment.\n+\t(minimal_symbol_reader::install): Update.\n+\t(terminate_minimal_symbol_table): Remove.\n+\t* jit.c (jit_object_close_impl): Update.\n+\n 2019-03-15  Tom Tromey  <tom@tromey.com>\n \n \t* minsyms.c (minimal_symbol_reader::record_full): Remove some"
    },
    {
      "sha": "1f87bf2538d010f160b0a5af4ef7b5e8ddf5a765",
      "filename": "gdb/jit.c",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/jit.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/jit.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/jit.c?ref=741d7538b7540fea1086fe6ab962227d2cf7418e",
      "patch": "@@ -805,8 +805,6 @@ jit_object_close_impl (struct gdb_symbol_callbacks *cb,\n \t\t\t\tOBJF_NOT_FILENAME);\n   objfile->per_bfd->gdbarch = target_gdbarch ();\n \n-  terminate_minimal_symbol_table (objfile);\n-\n   j = NULL;\n   for (i = obj->symtabs; i; i = j)\n     {"
    },
    {
      "sha": "efeaf2a0194d2a09e7a4a978f5c604d4c9f3bbd7",
      "filename": "gdb/minsyms.c",
      "status": "modified",
      "additions": 3,
      "deletions": 37,
      "changes": 40,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/minsyms.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/minsyms.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/minsyms.c?ref=741d7538b7540fea1086fe6ab962227d2cf7418e",
      "patch": "@@ -735,11 +735,8 @@ lookup_minimal_symbol_by_pc_section (CORE_ADDR pc_in, struct obj_section *sectio\n     {\n       CORE_ADDR pc = pc_in;\n \n-      /* If this objfile has a minimal symbol table, go search it using\n-         a binary search.  Note that a minimal symbol table always consists\n-         of at least two symbols, a \"real\" symbol and the terminating\n-         \"null symbol\".  If there are no real symbols, then there is no\n-         minimal symbol table at all.  */\n+      /* If this objfile has a minimal symbol table, go search it\n+         using a binary search.  */\n \n       if (objfile->per_bfd->minimal_symbol_count > 0)\n \t{\n@@ -1363,7 +1360,7 @@ minimal_symbol_reader::install ()\n          compact out the duplicate entries.  Once we have a final table,\n          we will give back the excess space.  */\n \n-      alloc_count = m_msym_count + m_objfile->per_bfd->minimal_symbol_count + 1;\n+      alloc_count = m_msym_count + m_objfile->per_bfd->minimal_symbol_count;\n       obstack_blank (&m_objfile->per_bfd->storage_obstack,\n \t\t     alloc_count * sizeof (struct minimal_symbol));\n       msymbols = (struct minimal_symbol *)\n@@ -1406,16 +1403,6 @@ minimal_symbol_reader::install ()\n       msymbols = (struct minimal_symbol *)\n \tobstack_finish (&m_objfile->per_bfd->storage_obstack);\n \n-      /* We also terminate the minimal symbol table with a \"null symbol\",\n-         which is *not* included in the size of the table.  This makes it\n-         easier to find the end of the table when we are handed a pointer\n-         to some symbol in the middle of it.  Zero out the fields in the\n-         \"null symbol\" allocated at the end of the array.  Note that the\n-         symbol count does *not* include this null symbol, which is why it\n-         is indexed by mcount and not mcount-1.  */\n-\n-      memset (&msymbols[mcount], 0, sizeof (struct minimal_symbol));\n-\n       /* Attach the minimal symbol table to the specified objfile.\n          The strings themselves are also located in the storage_obstack\n          of this objfile.  */\n@@ -1431,27 +1418,6 @@ minimal_symbol_reader::install ()\n     }\n }\n \n-/* See minsyms.h.  */\n-\n-void\n-terminate_minimal_symbol_table (struct objfile *objfile)\n-{\n-  if (! objfile->per_bfd->msymbols)\n-    objfile->per_bfd->msymbols = XOBNEW (&objfile->per_bfd->storage_obstack,\n-\t\t\t\t\t minimal_symbol);\n-\n-  {\n-    struct minimal_symbol *m\n-      = &objfile->per_bfd->msymbols[objfile->per_bfd->minimal_symbol_count];\n-\n-    memset (m, 0, sizeof (*m));\n-    /* Don't rely on these enumeration values being 0's.  */\n-    MSYMBOL_TYPE (m) = mst_unknown;\n-    MSYMBOL_SET_LANGUAGE (m, language_unknown,\n-\t\t\t  &objfile->per_bfd->storage_obstack);\n-  }\n-}\n-\n /* Check if PC is in a shared library trampoline code stub.\n    Return minimal symbol for the trampoline entry or NULL if PC is not\n    in a trampoline code stub.  */"
    },
    {
      "sha": "3e414f6ff7bdd8cf169d586f9a17dbc97a2d32a3",
      "filename": "gdb/minsyms.h",
      "status": "modified",
      "additions": 0,
      "deletions": 7,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/minsyms.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/minsyms.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/minsyms.h?ref=741d7538b7540fea1086fe6ab962227d2cf7418e",
      "patch": "@@ -148,13 +148,6 @@ class minimal_symbol_reader\n   int m_msym_count;\n };\n \n-/* Create the terminating entry of OBJFILE's minimal symbol table.\n-   If OBJFILE->msymbols is zero, allocate a single entry from\n-   OBJFILE->objfile_obstack; otherwise, just initialize\n-   OBJFILE->msymbols[OBJFILE->minimal_symbol_count].  */\n-\n-void terminate_minimal_symbol_table (struct objfile *objfile);\n-\n \f\n \n /* Return whether MSYMBOL is a function/method.  If FUNC_ADDRESS_P is"
    },
    {
      "sha": "2468ca7a3f7188ad00d156e69180e73ab55c262f",
      "filename": "gdb/objfiles.c",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/objfiles.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/objfiles.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.c?ref=741d7538b7540fea1086fe6ab962227d2cf7418e",
      "patch": "@@ -411,8 +411,6 @@ objfile::objfile (bfd *abfd, const char *name, objfile_flags flags_)\n \n   per_bfd = get_objfile_bfd_data (this, abfd);\n \n-  terminate_minimal_symbol_table (this);\n-\n   /* Add this file onto the tail of the linked list of other such files.  */\n \n   if (object_files == NULL)"
    },
    {
      "sha": "68ec491d3572d49dfe2bfddcb5cfe11accea3041",
      "filename": "gdb/symfile.c",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/symfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/741d7538b7540fea1086fe6ab962227d2cf7418e/gdb/symfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symfile.c?ref=741d7538b7540fea1086fe6ab962227d2cf7418e",
      "patch": "@@ -2580,7 +2580,6 @@ reread_symbols (void)\n \t  objfile_set_sym_fns (objfile, find_sym_fns (objfile->obfd));\n \n \t  build_objfile_section_table (objfile);\n-\t  terminate_minimal_symbol_table (objfile);\n \n \t  /* We use the same section offsets as from last time.  I'm not\n \t     sure whether that is always correct for shared libraries.  */"
    }
  ]
}