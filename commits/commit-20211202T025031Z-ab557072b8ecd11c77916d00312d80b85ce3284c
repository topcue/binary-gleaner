{
  "sha": "ab557072b8ecd11c77916d00312d80b85ce3284c",
  "node_id": "C_kwDOANOeidoAKGFiNTU3MDcyYjhlY2QxMWM3NzkxNmQwMDMxMmQ4MGI4NWNlMzI4NGM",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-11-23T01:57:42Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2021-12-02T02:50:31Z"
    },
    "message": "gdb: use actual DWARF version in compunit's debugformat field\n\nThe \"info source\" command, with a DWARF-compile program, always show\nthat the debug info is \"DWARF 2\":\n\n    (gdb) info source\n    Current source file is test.c\n    Compilation directory is /home/smarchi/build/binutils-gdb/gdb\n    Located in /home/smarchi/build/binutils-gdb/gdb/test.c\n    Contains 2 lines.\n    Source language is c.\n    Producer is GNU C17 9.3.0 -mtune=generic -march=x86-64 -g3 -gdwarf-5 -O0 -fasynchronous-unwind-tables -fstack-protector-strong -fstack-clash-protection -fcf-protection.\n    Compiled with DWARF 2 debugging format.\n    Includes preprocessor macro info.\n\nChange it to display the actual DWARF version:\n\n    (gdb) info source\n    Current source file is test.c\n    Compilation directory is /home/smarchi/build/binutils-gdb/gdb\n    Located in /home/smarchi/build/binutils-gdb/gdb/test.c\n    Contains 2 lines.\n    Source language is c.\n    Producer is GNU C17 9.3.0 -mtune=generic -march=x86-64 -g3 -gdwarf-5 -O0 -fasynchronous-unwind-tables -fstack-protector-strong -fstack-clash-protection -fcf-protection.\n    Compiled with DWARF 5 debugging format.\n    Includes preprocessor macro info.\n\nThe comp_unit_head::version field is guaranteed to be between 2 and 5,\nthanks to the check in read_comp_unit_head.  So we can still use static\nstrings to pass to record_debugformat, and keep it efficient.\n\nIn the future, when somebody will update GDB to support DWARF 6, they'll\nhit this assert and have to update this code.\n\nChange-Id: I3270b7ebf5e9a17b4215405bd2e365662a4d6172",
    "tree": {
      "sha": "65c36d5fae2dab4f121caef68f67437ea150ea7e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/65c36d5fae2dab4f121caef68f67437ea150ea7e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ab557072b8ecd11c77916d00312d80b85ce3284c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab557072b8ecd11c77916d00312d80b85ce3284c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ab557072b8ecd11c77916d00312d80b85ce3284c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab557072b8ecd11c77916d00312d80b85ce3284c/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1f1d0f8888a6c944e612b416a2a6e11abcf5199f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1f1d0f8888a6c944e612b416a2a6e11abcf5199f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1f1d0f8888a6c944e612b416a2a6e11abcf5199f"
    }
  ],
  "stats": {
    "total": 13,
    "additions": 12,
    "deletions": 1
  },
  "files": [
    {
      "sha": "61981a45f8a888eea58e06a89370a3b157e944a8",
      "filename": "gdb/dwarf2/cu.c",
      "status": "modified",
      "additions": 12,
      "deletions": 1,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab557072b8ecd11c77916d00312d80b85ce3284c/gdb/dwarf2/cu.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab557072b8ecd11c77916d00312d80b85ce3284c/gdb/dwarf2/cu.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/cu.c?ref=ab557072b8ecd11c77916d00312d80b85ce3284c",
      "patch": "@@ -64,7 +64,18 @@ dwarf2_cu::start_symtab (const char *name, const char *comp_dir,\n \n   list_in_scope = get_builder ()->get_file_symbols ();\n \n-  get_builder ()->record_debugformat (\"DWARF 2\");\n+  /* DWARF versions are restricted to [2, 5], thanks to the check in\n+     read_comp_unit_head.  */\n+  gdb_assert (this->header.version >= 2 && this->header.version <= 5);\n+  static const char *debugformat_strings[] = {\n+    \"DWARF 2\",\n+    \"DWARF 3\",\n+    \"DWARF 4\",\n+    \"DWARF 5\",\n+  };\n+  const char *debugformat = debugformat_strings[this->header.version - 2];\n+\n+  get_builder ()->record_debugformat (debugformat);\n   get_builder ()->record_producer (producer);\n \n   processing_has_namespace_info = false;"
    }
  ]
}