{
  "sha": "9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OWQyZDhhMTZlMWNlMDMzZDZiNzk1NmQ0YjRmMzc5NjE3MDViYjVjZg==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-01-13T20:08:51Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2021-01-22T19:09:31Z"
    },
    "message": "gdb: add new version style\n\nThis commit adds a new 'version' style, which replaces the hard coded\nstyling currently used for GDB's version string.  GDB's version number\nis displayed:\n\n  1. In the output of 'show version', and\n\n  2. When GDB starts up (without the --quiet option).\n\nThis new style can only ever affect the first of these two cases as\nthe second case is printed before GDB has processed any initialization\nfiles, or processed any GDB commands passed on the command line.\n\nHowever, because the first case exists I think this commit makes\nsense, it means the style is no longer hard coded into GDB, and we can\nadd some tests that the style can be enabled/disabled correctly.\n\nThis commit is an alternative to a patch Tom posted here:\n\n  https://sourceware.org/pipermail/gdb-patches/2020-June/169820.html\n\nI've used the style name 'version' instead of 'startup' to reflect\nwhat the style is actually used for.  If other parts of the startup\ntext end up being highlighted I imagine they would get their own\nstyles based on what is being highlighted.  I feel this is more inline\nwith the other style names that are already in use within GDB.\n\nI also decoupled adding this style from the idea of startup options,\nand the possibility of auto-saving startup options.  Those ideas can\nbe explored in later patches.\n\nThis commit should probably be considered only a partial solution to\nissue PR cli/25956.  The colours of the style are no longer hard\ncoded, however, it is still impossible to change the styling of the\nversion string displayed during startup, so in one sense, the styling\nof that string is still \"hard coded\".  A later patch will hopefully\nextend GDB to allow it to adjust the version styling before the\ninitial version string is printed.\n\ngdb/ChangeLog:\n\n\tPR cli/25956\n\t* cli/cli-style.c: Add 'cli/cli-setshow.h' include.\n\t(version_style): Define.\n\t(cli_style_option::cli_style_option): Add intensity parameter, and\n\tuse as appropriate.\n\t(_initialize_cli_style): Register version style set/show commands.\n\t* cli/cli-style.h (cli_style_option): Add intensity parameter.\n\t(version_style): Declare.\n\t* top.c (print_gdb_version): Use version_stype, and styled_string\n\tto print the GDB version string.\n\ngdb/doc/ChangeLog:\n\n\tPR cli/25956\n\t* gdb.texinfo (Output Styling): Document version style.\n\ngdb/testsuite/ChangeLog:\n\n\tPR cli/25956\n\t* gdb.base/style.exp (run_style_tests): Add version string test.\n\t(test_startup_version_string): Use version style name.\n\t* lib/gdb-utils.exp (style): Handle version style name.",
    "tree": {
      "sha": "8125bc0637b54354f56ba62a74e3dc46bb3b8149",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8125bc0637b54354f56ba62a74e3dc46bb3b8149"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e7b430724d89288f06926999811c71400e0d1531",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e7b430724d89288f06926999811c71400e0d1531",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e7b430724d89288f06926999811c71400e0d1531"
    }
  ],
  "stats": {
    "total": 86,
    "additions": 74,
    "deletions": 12
  },
  "files": [
    {
      "sha": "bbb00e4dfd0159e64c44be1ce3d16aaf229ddfa7",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -1,3 +1,17 @@\n+2021-01-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\tPR cli/25956\n+\t* NEWS: Mention new command.\n+\t* cli/cli-style.c: Add 'cli/cli-setshow.h' include.\n+\t(version_style): Define.\n+\t(cli_style_option::cli_style_option): Add intensity parameter, and\n+\tuse as appropriate.\n+\t(_initialize_cli_style): Register version style set/show commands.\n+\t* cli/cli-style.h (cli_style_option): Add intensity parameter.\n+\t(version_style): Declare.\n+\t* top.c (print_gdb_version): Use version_stype, and styled_string\n+\tto print the GDB version string.\n+\n 2021-01-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* utils.c (emit_style_escape): Only emit an escape sequence if the"
    },
    {
      "sha": "d2ed28857b0c05c5fe1f4e7cd54f5b24641e396b",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -75,6 +75,11 @@ maintenance flush-symbol-cache\n   'maintenance flush register-cache' and 'maintenance flush\n   symbol-cache' respectively.\n \n+set style version foreground COLOR\n+set style version background COLOR\n+set style version intensity VALUE\n+  Control the styling of GDB's version number text.\n+\n *** Changes in GDB 10\n \n * There are new feature names for ARC targets: \"org.gnu.gdb.arc.core\""
    },
    {
      "sha": "8b4b6b24cda4396fdef7aaa66f82403a437b10c4",
      "filename": "gdb/cli/cli-style.c",
      "status": "modified",
      "additions": 15,
      "deletions": 2,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/cli/cli-style.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/cli/cli-style.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-style.c?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -19,6 +19,7 @@\n \n #include \"defs.h\"\n #include \"cli/cli-cmds.h\"\n+#include \"cli/cli-setshow.h\"\n #include \"cli/cli-style.h\"\n #include \"source-cache.h\"\n #include \"observable.h\"\n@@ -98,13 +99,19 @@ cli_style_option metadata_style (\"metadata\", ui_file_style::DIM);\n \n /* See cli-style.h.  */\n \n+cli_style_option version_style (\"version\", ui_file_style::MAGENTA,\n+\t\t\t\tui_file_style::BOLD);\n+\n+/* See cli-style.h.  */\n+\n cli_style_option::cli_style_option (const char *name,\n-\t\t\t\t    ui_file_style::basic_color fg)\n+\t\t\t\t    ui_file_style::basic_color fg,\n+\t\t\t\t    ui_file_style::intensity intensity)\n   : changed (name),\n     m_name (name),\n     m_foreground (cli_colors[fg - ui_file_style::NONE]),\n     m_background (cli_colors[0]),\n-    m_intensity (cli_intensities[ui_file_style::NORMAL])\n+    m_intensity (cli_intensities[intensity])\n {\n }\n \n@@ -382,4 +389,10 @@ TUI window that does have the focus.\"),\n \t\t\t\t\t\t&style_set_list,\n \t\t\t\t\t\t&style_show_list,\n \t\t\t\t\t\ttrue);\n+\n+  version_style.add_setshow_commands (no_class, _(\"\\\n+Version string display styling.\\n\\\n+Configure colors used to display the GDB version string.\"),\n+\t\t\t\t      &style_set_list, &style_show_list,\n+\t\t\t\t      false);\n }"
    },
    {
      "sha": "187e1d07ce7dbc12d8dd8c6a6bee626af2c9a773",
      "filename": "gdb/cli/cli-style.h",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/cli/cli-style.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/cli/cli-style.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/cli/cli-style.h?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -30,7 +30,8 @@ class cli_style_option\n public:\n \n   /* Construct a CLI style option with a foreground color.  */\n-  cli_style_option (const char *name, ui_file_style::basic_color fg);\n+  cli_style_option (const char *name, ui_file_style::basic_color fg,\n+\t\t    ui_file_style::intensity = ui_file_style::NORMAL);\n \n   /* Construct a CLI style option with an intensity.  */\n   cli_style_option (const char *name, ui_file_style::intensity i);\n@@ -124,6 +125,9 @@ extern cli_style_option tui_border_style;\n /* The border style of a TUI window that does have the focus.  */\n extern cli_style_option tui_active_border_style;\n \n+/* The style to use for the GDB version string.  */\n+extern cli_style_option version_style;\n+\n /* True if source styling is enabled.  */\n extern bool source_styling;\n "
    },
    {
      "sha": "8f0ae35cf7ed023319d264b96ac579c6811d463a",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -1,3 +1,8 @@\n+2021-01-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\tPR cli/25956\n+\t* gdb.texinfo (Output Styling): Document version style.\n+\n 2021-01-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.texinfo (Auto-loading extensions): Add additional cross"
    },
    {
      "sha": "3e3c38dea3afacbc230ea5d612c80fe0fb888e70",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -25788,6 +25788,18 @@ Control the styling of addresses.  These are managed with the\n @code{set style address} family of commands.  By default, this style's\n foreground color is blue.\n \n+@item version\n+Control the styling of @value{GDBN}'s version number text.  By\n+default, this style's foreground color is magenta and it has bold\n+intensity.  The version number is displayed in two places, the output\n+of @command{show version}, and when @value{GDBN} starts up.\n+\n+Currently the version string displayed at startup is printed before\n+@value{GDBN} has parsed any command line options, or parsed any\n+command files, so there is currently no way to control the styling of\n+this string.  However, @value{GDBN}'s @code{--quiet} command line option\n+can be used to disable printing of the version string on startup.\n+\n @item title\n Control the styling of titles.  These are managed with the\n @code{set style title} family of commands.  By default, this style's"
    },
    {
      "sha": "d6fa7402aa82c0bff5f74ee608d647d7e2b662ce",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -1,3 +1,10 @@\n+2021-01-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\tPR cli/25956\n+\t* gdb.base/style.exp (run_style_tests): Add version string test.\n+\t(test_startup_version_string): Use version style name.\n+\t* lib/gdb-utils.exp (style): Handle version style name.\n+\n 2021-01-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.base/style.exp (limited_style): New proc."
    },
    {
      "sha": "0754c9daa49d799dfcfdae88563a9fde34c6a547",
      "filename": "gdb/testsuite/gdb.base/style.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/testsuite/gdb.base/style.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/testsuite/gdb.base/style.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/style.exp?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -270,6 +270,12 @@ proc run_style_tests { } {\n \tgdb_test \"p 5\" \\\n \t    \"Warning: '[limited_style p title]', an alias for the command '[limited_style print title]', is deprecated.*Use '[limited_style new_p title]'.*\" \\\n \t    \"p deprecated warning, with replacement\"\n+\n+\t# Check that the version string is styled in the output of 'show\n+\t# version', and that this styling can be disabled.\n+\tset vers [style \"GNU gdb.*\" version]\n+\tgdb_test \"show version\" \"${vers}.*\" \\\n+\t    \"version is styled in 'show version'\"\n     }\n }\n \n@@ -282,7 +288,7 @@ proc test_startup_version_string { } {\n \n     # Deliberate use of base STYLE proc here as the style of the\n     # startup version string can't (currently) be controlled.\n-    set vers [style \"GNU gdb.*\" \"35;1\"]\n+    set vers [style \"GNU gdb.*\" version]\n     gdb_test \"\" \"${vers}.*\" \"version is styled at startup\"\n }\n "
    },
    {
      "sha": "ad7d2884aae96c534ff54fc0b8bffb37aba865e8",
      "filename": "gdb/testsuite/lib/gdb-utils.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/testsuite/lib/gdb-utils.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/testsuite/lib/gdb-utils.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb-utils.exp?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -55,6 +55,7 @@ proc style {str style} {\n \tvariable { set style 36 }\n \taddress { set style 34 }\n \tmetadata { set style 2 }\n+\tversion { set style \"35;1\" }\n     }\n     return \"\\033\\\\\\[${style}m${str}\\033\\\\\\[m\"\n }"
    },
    {
      "sha": "08c4742251467380a2120943adc0dc413eaa7f57",
      "filename": "gdb/top.c",
      "status": "modified",
      "additions": 3,
      "deletions": 8,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf/gdb/top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.c?ref=9d2d8a16e1ce033d6b7956d4b4f37961705bb5cf",
      "patch": "@@ -1391,14 +1391,9 @@ print_gdb_version (struct ui_file *stream, bool interactive)\n      program to parse, and is just canonical program name and version\n      number, which starts after last space.  */\n \n-  ui_file_style style;\n-  if (interactive)\n-    {\n-      ui_file_style nstyle = { ui_file_style::MAGENTA, ui_file_style::NONE,\n-\t\t\t       ui_file_style::BOLD };\n-      style = nstyle;\n-    }\n-  fprintf_styled (stream, style, \"GNU gdb %s%s\\n\", PKGVERSION, version);\n+  std::string v_str = string_printf (\"GNU gdb %s%s\", PKGVERSION, version);\n+  fprintf_filtered (stream, \"%ps\\n\",\n+\t\t    styled_string (version_style.style (), v_str.c_str ()));\n \n   /* Second line is a copyright notice.  */\n "
    }
  ]
}