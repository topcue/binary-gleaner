{
  "sha": "bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmNhYzU5OWY3Mzg3NGZkNjNhMzkwMWYwYTlmN2QyNGU1MGMyYWQyNA==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-12-16T21:40:42Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-12-16T21:40:51Z"
    },
    "message": "ld: Skip libdep plugin if not all plugin hooks are available\n\nSkip plugin if not all required plugin hooks are available.\n\n2020-12-16  Howard Chu <hyc@symas.com>\n\t    H.J. Lu  <hongjiu.lu@intel.com>\n\n\tPR ld/27081\n\t* libdep_plugin.c (onload): Skip if not all required plugin hooks\n\tare available.\n\t* testsuite/config/default.exp (dep_plug_opt): New.\n\t* testsuite/ld-elf/elf.exp: Pass $dep_plug_opt to nm.\n\t* testsuite/ld-elf/pr26391.fd: New file.",
    "tree": {
      "sha": "8186c2ed9d2266e9fab2d5d17f607d3f58e3e4f8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8186c2ed9d2266e9fab2d5d17f607d3f58e3e4f8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "592995fadd37e3a8d831fc3f48994c9d5cc2a974",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/592995fadd37e3a8d831fc3f48994c9d5cc2a974",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/592995fadd37e3a8d831fc3f48994c9d5cc2a974"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 32,
    "deletions": 20
  },
  "files": [
    {
      "sha": "34d58d4fcbbe0ac785d7010dbe9f6c0089cc19c6",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
      "patch": "@@ -1,3 +1,13 @@\n+2020-12-16  Howard Chu <hyc@symas.com>\n+\t    H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27081\n+\t* libdep_plugin.c (onload): Skip if not all required plugin hooks\n+\tare available.\n+\t* testsuite/config/default.exp (dep_plug_opt): New.\n+\t* testsuite/ld-elf/elf.exp: Pass $dep_plug_opt to nm.\n+\t* testsuite/ld-elf/pr26391.fd: New file.\n+\n 2020-12-16  Alan Modra  <amodra@gmail.com>\n \n \t* ld.h (ld_config_type): Delete maxpagesize and commonpagesize."
    },
    {
      "sha": "b81364fdca598e6bc5f3817d956d164fa27047d0",
      "filename": "ld/libdep_plugin.c",
      "status": "modified",
      "additions": 6,
      "deletions": 19,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/libdep_plugin.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/libdep_plugin.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/libdep_plugin.c?ref=bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
      "patch": "@@ -339,27 +339,14 @@ onload (struct ld_plugin_tv *tv)\n   while ((tv++)->tv_tag != LDPT_NULL);\n \n   /* Register hooks.  */\n-  if (!tv_register_claim_file)\n+  if (tv_register_claim_file\n+      && tv_register_all_symbols_read\n+      && tv_register_cleanup)\n     {\n-      TV_MESSAGE (LDPL_FATAL, \"No register_claim_file hook\");\n-      fflush (NULL);\n-      return LDPS_ERR;\n-    }\n-  (*tv_register_claim_file) (onclaim_file);\n-  if (!tv_register_all_symbols_read)\n-    {\n-      TV_MESSAGE (LDPL_FATAL, \"No register_all_symbols_read hook\");\n-      fflush (NULL);\n-      return LDPS_ERR;\n-    }\n-  (*tv_register_all_symbols_read) (onall_symbols_read);\n-  if (!tv_register_cleanup)\n-    {\n-      TV_MESSAGE (LDPL_FATAL, \"No register_cleanup hook\");\n-      fflush (NULL);\n-      return LDPS_ERR;\n+      (*tv_register_claim_file) (onclaim_file);\n+      (*tv_register_all_symbols_read) (onall_symbols_read);\n+      (*tv_register_cleanup) (oncleanup);\n     }\n-  (*tv_register_cleanup) (oncleanup);\n   fflush (NULL);\n   return LDPS_OK;\n }"
    },
    {
      "sha": "a8ad1fdb6f00edc75cb53d01b117e0b9076fa01a",
      "filename": "ld/testsuite/config/default.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/testsuite/config/default.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/testsuite/config/default.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/config/default.exp?ref=bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
      "patch": "@@ -443,3 +443,11 @@ if { [check_compiler_available] } {\n \t}\n     }\n }\n+\n+if {[file exists .libs/libdep.so]} {\n+  set dep_plug_opt \"--plugin .libs/libdep.so\"\n+} elseif {[file exists .libs/libdep.dll]} {\n+  set dep_plug_opt \"--plugin .libs/libdep.dll\"\n+} else {\n+    set dep_plug_opt \"\"\n+}"
    },
    {
      "sha": "a58b17b512642fc8e3d9e76c933233abd4cbab5c",
      "filename": "ld/testsuite/ld-elf/elf.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/testsuite/ld-elf/elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/testsuite/ld-elf/elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/elf.exp?ref=bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
      "patch": "@@ -415,7 +415,10 @@ run_ld_link_tests [list \\\n \t\"\" \\\n \t\"\" \\\n \t{pr26391a.c pr26391b.c pr26391c.c pr26391d.c} \\\n-\t{{nm \"\" pr26391.nd}} \\\n+\t[list \\\n+\t    [list \"nm\" \"$dep_plug_opt\" \"pr26391.nd\"] \\\n+\t    [list \"nm\" \"$dep_plug_opt\" \"pr26391.fd\"] \\\n+\t] \\\n \t\"pr26391-5.o\" \\\n \t\"-fno-function-sections\" \\\n     ] \\"
    },
    {
      "sha": "1921cd6c7063f276a86ec1abcdfd6f77773fecad",
      "filename": "ld/testsuite/ld-elf/pr26391.fd",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/testsuite/ld-elf/pr26391.fd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bcac599f73874fd63a3901f0a9f7d24e50c2ad24/ld/testsuite/ld-elf/pr26391.fd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr26391.fd?ref=bcac599f73874fd63a3901f0a9f7d24e50c2ad24",
      "patch": "@@ -0,0 +1,4 @@\n+#failif\n+#...\n+bfd plugin: No register_all_symbols_read hook\n+#..."
    }
  ]
}