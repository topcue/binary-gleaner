{
  "sha": "ecda90163e2b0a6f0be96e3fc262c28820a27211",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZWNkYTkwMTYzZTJiMGE2ZjBiZTk2ZTNmYzI2MmMyODgyMGEyNzIxMQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-02-25T11:30:33Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-02-25T11:31:40Z"
    },
    "message": "Don't call lto-wrapper for ar and ranlib\n\nSince ar and ranlib don't need to know symbol types to work properly,\nwe should avoid calling lto-wrapper for them to speed them up.\n\nbfd/\n\n\tPR binutils/25584\n\t* plugin.c (need_lto_wrapper_p): New.\n\t(bfd_plugin_set_program_name): Add an int argument to set\n\tneed_lto_wrapper_p.\n\t(get_lto_wrapper): Return FALSE if need_lto_wrapper_p isn't\n\tset.\n\t* plugin.h (bfd_plugin_set_program_name): Add an int argument.\n\nbinutils/\n\n\tPR binutils/25584\n\t* ar.c (main): Pass 0 to bfd_plugin_set_program_name.\n\t* nm.c (main): Pass 1 to bfd_plugin_set_program_name.",
    "tree": {
      "sha": "7d5371a80bf0df07028f0f107a4d70927040e089",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/7d5371a80bf0df07028f0f107a4d70927040e089"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ecda90163e2b0a6f0be96e3fc262c28820a27211",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ecda90163e2b0a6f0be96e3fc262c28820a27211",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ecda90163e2b0a6f0be96e3fc262c28820a27211",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ecda90163e2b0a6f0be96e3fc262c28820a27211/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "265b467340e5334a682e47a0e1b69a80c4428349",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/265b467340e5334a682e47a0e1b69a80c4428349",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/265b467340e5334a682e47a0e1b69a80c4428349"
    }
  ],
  "stats": {
    "total": 44,
    "additions": 33,
    "deletions": 11
  },
  "files": [
    {
      "sha": "7e8e454632ce6bb2802ec19f7698798044ba4f50",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ecda90163e2b0a6f0be96e3fc262c28820a27211/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ecda90163e2b0a6f0be96e3fc262c28820a27211/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=ecda90163e2b0a6f0be96e3fc262c28820a27211",
      "patch": "@@ -1,3 +1,13 @@\n+2020-02-25  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR binutils/25584\n+\t* plugin.c (need_lto_wrapper_p): New.\n+\t(bfd_plugin_set_program_name): Add an int argument to set\n+\tneed_lto_wrapper_p.\n+\t(get_lto_wrapper): Return FALSE if need_lto_wrapper_p isn't\n+\tset.\n+\t* plugin.h (bfd_plugin_set_program_name): Add an int argument.\n+\n 2020-02-24  Alan Modra  <amodra@gmail.com>\n \n \t* vms-lib.c (_bfd_vms_lib_archive_p): Correct overflow checks."
    },
    {
      "sha": "c79468fab87c37b7b1e9647d19735e307f1b6590",
      "filename": "bfd/plugin.c",
      "status": "modified",
      "additions": 14,
      "deletions": 8,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ecda90163e2b0a6f0be96e3fc262c28820a27211/bfd/plugin.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ecda90163e2b0a6f0be96e3fc262c28820a27211/bfd/plugin.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/plugin.c?ref=ecda90163e2b0a6f0be96e3fc262c28820a27211",
      "patch": "@@ -147,6 +147,17 @@ struct plugin_list_entry\n   bfd_boolean initialized;\n };\n \n+static const char *plugin_program_name;\n+static int need_lto_wrapper_p;\n+\n+void\n+bfd_plugin_set_program_name (const char *program_name,\n+\t\t\t     int need_lto_wrapper)\n+{\n+  plugin_program_name = program_name;\n+  need_lto_wrapper_p = need_lto_wrapper;\n+}\n+\n /* Use GCC LTO wrapper to covert LTO IR object to the real object.  */\n \n static bfd_boolean\n@@ -165,6 +176,9 @@ get_lto_wrapper (struct plugin_list_entry *plugin)\n   char dir_seperator = '\\0';\n   char *resolution_file;\n \n+  if (!need_lto_wrapper_p)\n+    return FALSE;\n+\n   if (plugin->initialized)\n     {\n       if (plugin->lto_wrapper)\n@@ -489,14 +503,6 @@ add_symbols (void * handle,\n   return LDPS_OK;\n }\n \n-static const char *plugin_program_name;\n-\n-void\n-bfd_plugin_set_program_name (const char *program_name)\n-{\n-  plugin_program_name = program_name;\n-}\n-\n int\n bfd_plugin_open_input (bfd *ibfd, struct ld_plugin_input_file *file)\n {"
    },
    {
      "sha": "b2d5e50137f2c30b436c3c14d3017d38676b6b5b",
      "filename": "bfd/plugin.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ecda90163e2b0a6f0be96e3fc262c28820a27211/bfd/plugin.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ecda90163e2b0a6f0be96e3fc262c28820a27211/bfd/plugin.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/plugin.h?ref=ecda90163e2b0a6f0be96e3fc262c28820a27211",
      "patch": "@@ -21,7 +21,7 @@\n #ifndef _PLUGIN_H_\n #define _PLUGIN_H_\n \n-void bfd_plugin_set_program_name (const char *);\n+void bfd_plugin_set_program_name (const char *, int);\n int bfd_plugin_open_input (bfd *, struct ld_plugin_input_file *);\n void bfd_plugin_set_plugin (const char *);\n bfd_boolean bfd_plugin_target_p (const bfd_target *);"
    },
    {
      "sha": "dbb8fe070783a0a92b5b62bd0d863631b599baa6",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ecda90163e2b0a6f0be96e3fc262c28820a27211/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ecda90163e2b0a6f0be96e3fc262c28820a27211/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=ecda90163e2b0a6f0be96e3fc262c28820a27211",
      "patch": "@@ -1,3 +1,9 @@\n+2020-02-25  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR binutils/25584\n+\t* ar.c (main): Pass 0 to bfd_plugin_set_program_name.\n+\t* nm.c (main): Pass 1 to bfd_plugin_set_program_name.\n+\n 2020-02-24  Nick Clifton  <nickc@redhat.com>\n \n \tPR 25499"
    },
    {
      "sha": "35dd51e04af48ecbd5d514faea3405bd08de1cc4",
      "filename": "binutils/ar.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ecda90163e2b0a6f0be96e3fc262c28820a27211/binutils/ar.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ecda90163e2b0a6f0be96e3fc262c28820a27211/binutils/ar.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ar.c?ref=ecda90163e2b0a6f0be96e3fc262c28820a27211",
      "patch": "@@ -725,7 +725,7 @@ main (int argc, char **argv)\n   xmalloc_set_program_name (program_name);\n   bfd_set_error_program_name (program_name);\n #if BFD_SUPPORTS_PLUGINS\n-  bfd_plugin_set_program_name (program_name);\n+  bfd_plugin_set_program_name (program_name, 0);\n #endif\n \n   expandargv (&argc, &argv);"
    },
    {
      "sha": "5b386592a615c4b9decb8647db06fa7cb01e641b",
      "filename": "binutils/nm.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ecda90163e2b0a6f0be96e3fc262c28820a27211/binutils/nm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ecda90163e2b0a6f0be96e3fc262c28820a27211/binutils/nm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/nm.c?ref=ecda90163e2b0a6f0be96e3fc262c28820a27211",
      "patch": "@@ -1701,7 +1701,7 @@ main (int argc, char **argv)\n   xmalloc_set_program_name (program_name);\n   bfd_set_error_program_name (program_name);\n #if BFD_SUPPORTS_PLUGINS\n-  bfd_plugin_set_program_name (program_name);\n+  bfd_plugin_set_program_name (program_name, 1);\n #endif\n \n   START_PROGRESS (program_name, 0);"
    }
  ]
}