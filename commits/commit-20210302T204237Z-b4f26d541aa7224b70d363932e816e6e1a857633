{
  "sha": "b4f26d541aa7224b70d363932e816e6e1a857633",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjRmMjZkNTQxYWE3MjI0YjcwZDM2MzkzMmU4MTZlNmUxYTg1NzYzMw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-03-02T20:42:37Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-03-02T20:42:37Z"
    },
    "message": "Import GNU Readline 8.1\n\nThis imports readline 8.1.  I did this via various hackery in a\nreadline git repository to make a version of readline identical to\ngdb's, then did a git merge.\n\nreadline/ChangeLog\n2021-03-02  Tom Tromey  <tom@tromey.com>\n\n\t* Import readline 8.1.",
    "tree": {
      "sha": "d66d3fd86d996bdead07351e57dd8ec416381526",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d66d3fd86d996bdead07351e57dd8ec416381526"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b4f26d541aa7224b70d363932e816e6e1a857633",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4f26d541aa7224b70d363932e816e6e1a857633",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b4f26d541aa7224b70d363932e816e6e1a857633",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4f26d541aa7224b70d363932e816e6e1a857633/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "bbcdf9ab73018ff43855945fd72c642a67437d8b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bbcdf9ab73018ff43855945fd72c642a67437d8b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bbcdf9ab73018ff43855945fd72c642a67437d8b"
    }
  ],
  "stats": {
    "total": 7962,
    "additions": 3795,
    "deletions": 4167
  },
  "files": [
    {
      "sha": "4961f999f109b5c7ffed098a8ada710e89975fb9",
      "filename": "readline/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/ChangeLog?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,3 +1,7 @@\n+2021-03-02  Tom Tromey  <tom@tromey.com>\n+\n+\t* Import readline 8.1.\n+\n 2020-06-30  Tom Tromey  <tom@tromey.com>\n \n \t* README: Update instructions."
    },
    {
      "sha": "5c24e91e0ad1446754266ea7ec8045713dfdd62e",
      "filename": "readline/readline/CHANGELOG",
      "status": "modified",
      "additions": 53,
      "deletions": 8,
      "changes": 61,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/CHANGELOG",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/CHANGELOG",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/CHANGELOG?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,11 +1,4 @@\n-2019-12-23  Eli Zaretskii  <eliz@gnu.org>\n-\n-\t* posixstat.h (S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH)\n-\t(S_IXOTH, S_IRWXG, S_IRWXO): Define if undefined, even if S_IRWXU\n-\tis defined, because non-Posix systems may defined only the user\n-\tbits.\n-\n-[Readline-specific changelog.  Descriptions of changes to the source are\n+\\[Readline-specific changelog.  Descriptions of changes to the source are\n  found in the bash changelog.]\n \n \t\t\t\t    6/9\n@@ -1358,3 +1351,55 @@ Makefile.in\n \t\t\t\t   ----\n Makefile.in\n \t- installdirs: create $(pkgconfigdir) if it doesn't exist\n+\n+\n+\t\t\t\t 4/8/2019\n+\t\t\t\t --------\n+readline.pc.in\n+\t- change CFLAGS to include ${includedir} instead of ${includedir}/readline,\n+\t  to support the recommended `#include <readline/readline.h>'. Report\n+\t  and fix from Andrea Bolognani <abologna@redhat.com>\n+\n+\t\t\t\t   5/13\n+\t\t\t\t   ----\n+configure.ac\n+\t- hpux: add -DTGETENT_BROKEN to LOCAL_CFLAGS\n+\n+\t\t\t\t   8/28\n+\t\t\t\t   ----\n+configure.ac\n+\t- hpux: add -DTGETFLAG_BROKEN to LOCAL_CFLAGS\n+\n+\t\t\t\t    9/6\n+\t\t\t\t    ---\n+examples/autoconf/RL_LIB_READLINE_VERSION\n+\t- include <stdlib.h> in the AC_TRY_RUN block to accommodate compilers\n+\t  that treat functions without an existing prototype as fatal errors.\n+\t  Report and fix from Florian Weimer <fweimer@redhat.com>\n+\n+\t\t\t\t   12/13\n+\t\t\t\t   -----\n+support/shlib-install\n+\t- remove old code for FreeBSD and Dragonfly; they are ELF-only now and\n+\t  can use the same code as Linux. Fix from\n+\t  Baptiste Daroussin <bapt@FreeBSD.org>\n+\n+\t\t\t\t 5/20/2020\n+\t\t\t\t ---------\n+configure.ac\n+\t- bumped version number up to 8.1\n+\n+\t\t\t\t   6/15\n+\t\t\t\t   ----\n+configure.ac\n+\t- add -Wno-parentheses -Wno-format-security to CFLAGS if gcc (or clang)\n+\t  is the compiler\n+\n+\t\t\t\t   10/29\n+\t\t\t\t   -----\n+configure.ac\n+\t- --enable-bracketed-paste-default: new invocation option, toggles the\n+\t  default value of enable-bracketed-paste (on by default)\n+\n+INSTALL\n+\t- document new --enable-bracketed-paste-default configure option"
    },
    {
      "sha": "747fa41962f2ee6604a6354b691ea5a136a7487d",
      "filename": "readline/readline/CHANGES",
      "status": "modified",
      "additions": 123,
      "deletions": 0,
      "changes": 123,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/CHANGES",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/CHANGES",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/CHANGES?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,3 +1,126 @@\n+This document details the changes between this version, readline-8.1, and\n+the previous version, readline-8.0.\n+\n+1. Changes to Readline\n+\n+a. There are a number of fixes that were found as the result of fuzzing with\n+   random input.\n+\n+b. Changed the revert-all-at-newline behavior to make sure to start at the end\n+   of the history list when doing it, instead of the line where the user hit\n+   return.\n+\n+c. When parsing `set' commands from the inputrc file or an application, readline\n+   now allows trailing whitespace.\n+\n+d. Fixed a bug that left a file descriptor open to the history file if the\n+   file size was 0.\n+\n+e. Fixed a problem with binding key sequences containing meta characters.\n+\n+f. Fixed a bug that caused the wrong line to be displayed if the user tried to\n+   move back beyond the beginning of the history list, or forward past the end\n+   of the history list.\n+\n+g. If readline catches SIGTSTP, it now sets a hook that allows the calling\n+   application to handle it if it desires.\n+\n+h. Fixed a redisplay problem with a prompt string containing embedded newlines.\n+\n+i. Fixed a problem with completing filenames containing invalid multibyte\n+   sequences when case-insensitive comparisons are enabled.\n+\n+j. Fixed a redisplay problem with prompt strings containing invisible multibyte\n+   characters.\n+\n+k. Fixed a problem with multibyte characters mapped to editing commands that\n+   modify the search string in incremental search.\n+\n+l. Fixed a bug with maintaining the key sequence while resolving a bound\n+   command in the presence of ambiguous sequences (sequences with a common\n+   prefix), in most cases while attempting to unbind it.\n+\n+m. Fixed several buffer overflows found as the result of fuzzing.\n+\n+n. Reworked backslash handling when translating key sequences for key binding\n+   to be more uniform and consistent, which introduces a slight backwards\n+   incompatibility.\n+\n+o. Fixed a bug with saving the history that resulted in errors not being\n+   propagated to the calling application when the history file is not writable.\n+\n+p. Readline only calls chown(2) on a newly-written history file if it really\n+   needs to, instead of having it be a no-op.\n+\n+q. Readline now behaves better when operate-and-get-next is used when the\n+   history list is `full': when there are already $HISTSIZE entries.\n+\n+r. Fixed a bug that could cause vi redo (`.') of a replace command not to work\n+   correctly in the C or POSIX locale.\n+\n+s. Fixed a bug with vi-mode digit arguments that caused the last command to be\n+   set incorrectly. This prevents yank-last-arg from working as intended, for\n+   example.\n+\n+t. Make sure that all undo groups are closed when leaving vi insertion mode.  \n+\n+u. Make sure that the vi-mode `C' and `c' commands enter insert mode even if\n+   the motion command doesn't have any effect.\n+\n+v. Fixed several potential memory leaks in the callback mode context handling.\n+\n+w. If readline is handling a SIGTTOU, make sure SIGTTOU is blocked while\n+   executing the terminal cleanup code, since it's no longer run in a signal\n+   handling context.\n+\n+x. Fixed a bug that could cause an application with an application-specific \n+   redisplay function to crash if the line data structures had not been\n+   initialized.\n+\n+y. Terminals that are named \"dumb\" or unknown do not enable bracketed paste\n+   by default.\n+\n+z. Ensure that disabling bracketed paste turns off highlighting the incremental\n+   search string when the search is successful.\n+\n+2. New Features in Readline\n+\n+a. If a second consecutive completion attempt produces matches where the first\n+   did not, treat it as a new completion attempt and insert a match as\n+   appropriate.\n+\n+b. Bracketed paste mode works in more places: incremental search strings, vi\n+   overstrike mode, character search, and reading numeric arguments.\n+\n+c. Readline automatically switches to horizontal scrolling if the terminal has\n+   only one line.\n+\n+d. Unbinding all key sequences bound to a particular readline function now\n+   descends into keymaps for multi-key sequences.\n+\n+e. rl-clear-display: new bindable command that clears the screen and, if\n+   possible, the scrollback buffer (bound to emacs mode M-C-l by default).\n+\n+f. New active mark and face feature: when enabled, it will highlight the text\n+   inserted by a bracketed paste (the `active region') and the text found by\n+   incremental and non-incremental history searches. This is tied to bracketed\n+   paste and can be disabled by turning off bracketed paste.\n+\n+g. Readline sets the mark in several additional commands.\n+\n+h. Bracketed paste mode is enabled by default. There is a configure-time\n+   option (--enable-bracketed-paste-default) to set the default to on or off.\n+\n+i. Readline tries to take advantage of the more regular structure of UTF-8\n+   characters to identify the beginning and end of characters when moving\n+   through the line buffer.\n+\n+j. The bindable operate-and-get-next command (and its default bindings) are\n+   now part of readline instead of a bash-specific addition.\n+\n+k. The signal cleanup code now blocks SIGINT while processing after a SIGINT.  \n+\n+-------------------------------------------------------------------------------\n This document details the changes between this version, readline-8.0, and the\n previous version, readline-7.0.\n "
    },
    {
      "sha": "4f0d7b0c0d5d9d2dabac9f80c8400c5923372232",
      "filename": "readline/readline/INSTALL",
      "status": "modified",
      "additions": 6,
      "deletions": 1,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/INSTALL",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/INSTALL",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/INSTALL?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n Basic Installation\n ==================\n \n-These are installation instructions for Readline-8.0.\n+These are installation instructions for Readline-8.1.\n \n The simplest way to compile readline is:\n \n@@ -183,6 +183,11 @@ The readline `configure' recognizes a single `--with-PACKAGE' option:\n \n `--enable-static'\n     Build the static libraries by default.  The default is `yes'.\n+\n+`--enable-bracketed-paste-default'\n+    Enable bracketed paste by default, so the initial value of the\n+    `enable-bracketed-paste' Readline variable is `on'. The default\n+    is `yes'.\n  \n Shared Libraries\n ================"
    },
    {
      "sha": "c01da8d07a681e859f517005f99baaf2a17533e4",
      "filename": "readline/readline/Makefile.in",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/Makefile.in?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -72,10 +72,10 @@ DESTDIR =\n \n # Programs to make tags files.\n ETAGS = etags\n-CTAGS = ctags -tw\n+CTAGS = ctags -w\n \n CFLAGS = @CFLAGS@\n-LOCAL_CFLAGS = @LOCAL_CFLAGS@ -DRL_LIBRARY_VERSION='\"$(RL_LIBRARY_VERSION)\"'\n+LOCAL_CFLAGS = @LOCAL_CFLAGS@ -DRL_LIBRARY_VERSION='\"$(RL_LIBRARY_VERSION)\"' @BRACKETED_PASTE@\n CPPFLAGS = @CPPFLAGS@\n \n DEFS = @DEFS@ @CROSS_COMPILE@"
    },
    {
      "sha": "56ab93aa1b98f5bfc988cbf798e14def60ae4586",
      "filename": "readline/readline/NEWS",
      "status": "modified",
      "additions": 62,
      "deletions": 0,
      "changes": 62,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/NEWS?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,3 +1,44 @@\n+This is a terse description of the new features added to readline-8.1 since\n+the release of readline-8.0.\n+\n+New Features in Readline\n+\n+a. If a second consecutive completion attempt produces matches where the first\n+   did not, treat it as a new completion attempt and insert a match as\n+   appropriate.\n+\n+b. Bracketed paste mode works in more places: incremental search strings, vi\n+   overstrike mode, character search, and reading numeric arguments.\n+\n+c. Readline automatically switches to horizontal scrolling if the terminal has\n+   only one line.\n+\n+d. Unbinding all key sequences bound to a particular readline function now\n+   descends into keymaps for multi-key sequences.\n+\n+e. rl-clear-display: new bindable command that clears the screen and, if\n+   possible, the scrollback buffer (bound to emacs mode M-C-l by default).\n+\n+f. New active mark and face feature: when enabled, it will highlight the text\n+   inserted by a bracketed paste (the `active region') and the text found by\n+   incremental and non-incremental history searches. This is tied to bracketed\n+   paste and can be disabled by turning off bracketed paste.\n+\n+g. Readline sets the mark in several additional commands.\n+\n+h. Bracketed paste mode is enabled by default. There is a configure-time\n+   option (--enable-bracketed-paste-default) to set the default to on or off.\n+\n+i. Readline tries to take advantage of the more regular structure of UTF-8\n+   characters to identify the beginning and end of characters when moving\n+   through the line buffer.\n+\n+j. The bindable operate-and-get-next command (and its default bindings) are\n+   now part of readline instead of a bash-specific addition.\n+\n+k. The signal cleanup code now blocks SIGINT while processing after a SIGINT.  \n+\n+-------------------------------------------------------------------------------\n This is a terse description of the new features added to readline-8.0 since\n the release of readline-7.0.\n \n@@ -178,6 +219,27 @@ n.  New application-settable variable: rl_signal_event_hook; function that is\n     called when readline is reading terminal input and read(2) is interrupted\n     by a signal.  Currently not called for SIGHUP or SIGTERM.\n \n+-------------------------------------------------------------------------------\n+This is a terse description of the new features added to readline-6.2 since\n+the release of readline-6.1.\n+\n+a.  The history library does not try to write the history filename in the\n+    current directory if $HOME is unset.  This closes a potential security\n+    problem if the application does not specify a history filename.\n+\n+b.  New bindable variable `completion-display-width' to set the number of\n+    columns used when displaying completions.\n+\n+c.  New bindable variable `completion-case-map' to cause case-insensitive\n+    completion to treat `-' and `_' as identical.\n+\n+d.  There are new bindable vi-mode command names to avoid readline's case-\n+    insensitive matching not allowing them to be bound separately.\n+\n+e.  New bindable variable `menu-complete-display-prefix' causes the menu\n+    completion code to display the common prefix of the possible completions\n+    before cycling through the list, instead of after.\n+\n -------------------------------------------------------------------------------\n This is a terse description of the new features added to readline-6.1 since\n the release of readline-6.0."
    },
    {
      "sha": "de985752374ece41c458366e46bf9f9cada954e6",
      "filename": "readline/readline/README",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/README",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/README",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/README?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n Introduction\n ============\n \n-This is the Gnu Readline library, version 8.0.\n+This is the Gnu Readline library, version 8.1.\n \n The Readline library provides a set of functions for use by applications\n that allow users to edit command lines as they are typed in.  Both"
    },
    {
      "sha": "6899e8202ae191a98c74db831d3baac4793b2b48",
      "filename": "readline/readline/aclocal.m4",
      "status": "modified",
      "additions": 85,
      "deletions": 2045,
      "changes": 2130,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/aclocal.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/aclocal.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/aclocal.m4?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,4 +1,4 @@\n-nl\n+dnl\n dnl Bash specific tests\n dnl\n dnl Some derived from PDKSH 5.1.3 autoconf tests\n@@ -10,6 +10,7 @@ AC_DEFUN(BASH_C_LONG_LONG,\n   ac_cv_c_long_long=yes\n else\n AC_TRY_RUN([\n+#include <stdlib.h>\n int\n main()\n {\n@@ -33,6 +34,7 @@ AC_DEFUN(BASH_C_LONG_DOUBLE,\n   ac_cv_c_long_double=yes\n else\n AC_TRY_RUN([\n+#include <stdlib.h>\n int\n main()\n {\n@@ -64,6 +66,8 @@ AC_DEFUN(BASH_HEADER_INTTYPES,\n dnl\n dnl check for typedef'd symbols in header files, but allow the caller to\n dnl specify the include files to be checked in addition to the default\n+dnl\n+dnl This could be changed to use AC_COMPILE_IFELSE instead of AC_EGREP_CPP\n dnl \n dnl BASH_CHECK_TYPE(TYPE, HEADERS, DEFAULT[, VALUE-IF-FOUND])\n AC_DEFUN(BASH_CHECK_TYPE,\n@@ -134,6 +138,8 @@ typedef int (*_bashfunc)(const char *, ...);\n #else\n typedef int (*_bashfunc)();\n #endif\n+#include <stdlib.h>\n+int\n main()\n {\n _bashfunc pf;\n@@ -191,9 +197,11 @@ AC_CACHE_VAL(bash_cv_under_sys_siglist,\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n+#include <stdlib.h>\n #ifndef UNDER_SYS_SIGLIST_DECLARED\n extern char *_sys_siglist[];\n #endif\n+int\n main()\n {\n char *msg = (char *)_sys_siglist[2];\n@@ -218,9 +226,11 @@ AC_CACHE_VAL(bash_cv_sys_siglist,\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n+#include <stdlib.h>\n #if !HAVE_DECL_SYS_SIGLIST\n extern char *sys_siglist[];\n #endif\n+int\n main()\n {\n char *msg = sys_siglist[2];\n@@ -273,6 +283,8 @@ AC_CACHE_VAL(bash_cv_dup2_broken,\n [AC_TRY_RUN([\n #include <sys/types.h>\n #include <fcntl.h>\n+#include <stdlib.h>\n+int\n main()\n {\n   int fd1, fd2, fl;\n@@ -300,7 +312,8 @@ AC_DEFUN(BASH_FUNC_STRSIGNAL,\n [AC_MSG_CHECKING([for the existence of strsignal])\n AC_CACHE_VAL(bash_cv_have_strsignal,\n [AC_TRY_LINK([#include <sys/types.h>\n-#include <signal.h>],\n+#include <signal.h>\n+#include <string.h>],\n [char *s = (char *)strsignal(2);],\n  bash_cv_have_strsignal=yes, bash_cv_have_strsignal=no)])\n AC_MSG_RESULT($bash_cv_have_strsignal)\n@@ -321,6 +334,9 @@ AC_CACHE_VAL(bash_cv_opendir_not_robust,\n #ifdef HAVE_UNISTD_H\n # include <unistd.h>\n #endif /* HAVE_UNISTD_H */\n+#ifdef HAVE_SYS_STAT_H\n+#include <sys/stat.h>\n+#endif\n #if defined(HAVE_DIRENT_H)\n # include <dirent.h>\n #else\n@@ -335,6 +351,8 @@ AC_CACHE_VAL(bash_cv_opendir_not_robust,\n #  include <ndir.h>\n # endif\n #endif /* HAVE_DIRENT_H */\n+#include <stdlib.h>\n+int\n main()\n {\n DIR *dir;\n@@ -514,6 +532,8 @@ AC_TRY_RUN([\n #include <sys/types.h>\n #include <sys/time.h>\n #include <sys/resource.h>\n+#include <stdlib.h>\n+int\n main()\n {\n #ifdef HAVE_QUAD_T\n@@ -583,6 +603,7 @@ AC_CACHE_VAL(bash_cv_getenv_redef,\n #ifdef HAVE_UNISTD_H\n #  include <unistd.h>\n #endif\n+#include <stdlib.h>\n #ifndef __STDC__\n #  ifndef const\n #    define const\n@@ -598,6 +619,7 @@ getenv (name)\n {\n return \"42\";\n }\n+int\n main()\n {\n char *s;\n@@ -684,6 +706,11 @@ AC_DEFUN(BASH_FUNC_ULIMIT_MAXFDS,\n [AC_MSG_CHECKING(whether ulimit can substitute for getdtablesize)\n AC_CACHE_VAL(bash_cv_ulimit_maxfds,\n [AC_TRY_RUN([\n+#include <stdlib.h>\n+#ifdef HAVE_ULIMIT_H\n+#include <ulimit.h>\n+#endif\n+int\n main()\n {\n long maxfds = ulimit(4, 0L);\n@@ -707,7 +734,9 @@ AC_CACHE_VAL(bash_cv_getcwd_malloc,\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n+#include <stdlib.h>\n \n+int\n main()\n {\n \tchar\t*xpwd;\n@@ -757,12 +786,13 @@ AC_CACHE_VAL(bash_cv_fnm_extmatch,\n [AC_TRY_RUN([\n #include <fnmatch.h>\n \n+int\n main()\n {\n #ifdef FNM_EXTMATCH\n-  exit (0);\n+  return (0);\n #else\n-  exit (1);\n+  return (1);\n #endif\n }\n ], bash_cv_fnm_extmatch=yes, bash_cv_fnm_extmatch=no,\n@@ -786,7 +816,9 @@ AC_CACHE_VAL(bash_cv_func_sigsetjmp,\n #include <sys/types.h>\n #include <signal.h>\n #include <setjmp.h>\n+#include <stdlib.h>\n \n+int\n main()\n {\n #if !defined (_POSIX_VERSION) || !defined (HAVE_POSIX_SIGNALS)\n@@ -835,7 +867,10 @@ AC_CACHE_VAL(bash_cv_func_strcoll_broken,\n #if defined (HAVE_LOCALE_H)\n #include <locale.h>\n #endif\n+#include <string.h>\n+#include <stdlib.h>\n \n+int\n main(c, v)\n int     c;\n char    *v[];\n@@ -881,6 +916,7 @@ AC_CACHE_VAL(bash_cv_printf_a_format,\n [AC_TRY_RUN([\n #include <stdio.h>\n #include <string.h>\n+#include <stdlib.h>\n \n int\n main()\n@@ -934,6 +970,7 @@ AC_CACHE_VAL(bash_cv_struct_stat_st_blocks,\n #include <sys/stat.h>\n ],\n [\n+int\n main()\n {\n static struct stat a;\n@@ -1142,12 +1179,17 @@ fi\n AC_DEFUN(BASH_STRUCT_TIMEVAL,\n [AC_MSG_CHECKING(for struct timeval in sys/time.h and time.h)\n AC_CACHE_VAL(bash_cv_struct_timeval,\n-[\n-AC_EGREP_HEADER(struct timeval, sys/time.h,\n-\t\tbash_cv_struct_timeval=yes,\n-\t\tAC_EGREP_HEADER(struct timeval, time.h,\n-\t\t\tbash_cv_struct_timeval=yes,\n-\t\t\tbash_cv_struct_timeval=no))\n+[AC_COMPILE_IFELSE(\n+\t[AC_LANG_PROGRAM(\n+\t\t[[#if HAVE_SYS_TIME_H\n+\t\t  #include <sys/time.h>\n+\t\t  #endif\n+\t\t  #include <time.h>\n+\t\t]],\n+\t\t[[static struct timeval x; x.tv_sec = x.tv_usec;]]\n+\t)],\n+\tbash_cv_struct_timeval=yes,\n+\tbash_cv_struct_timeval=no)\n ])\n AC_MSG_RESULT($bash_cv_struct_timeval)\n if test $bash_cv_struct_timeval = yes; then\n@@ -1241,6 +1283,11 @@ AC_CACHE_VAL(bash_cv_pgrp_pipe,\n #ifdef HAVE_UNISTD_H\n #  include <unistd.h>\n #endif\n+#ifdef HAVE_SYS_WAIT_H\n+#  include <sys/wait.h>\n+#endif\n+#include <stdlib.h>\n+int\n main()\n {\n # ifdef GETPGRP_VOID\n@@ -1305,6 +1352,7 @@ AC_CACHE_VAL(bash_cv_must_reinstall_sighandlers,\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n+#include <stdlib.h>\n \n typedef RETSIGTYPE sigfunc();\n \n@@ -1335,6 +1383,7 @@ int s;\n   nsigint++;\n }\n \n+int\n main()\n {\n \tnsigint = 0;\n@@ -1418,8 +1467,11 @@ AC_CACHE_VAL(bash_cv_sys_named_pipes,\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n+#include <stdio.h>\n+#include <stdlib.h>\n \n /* Add more tests in here as appropriate. */\n+int\n main()\n {\n int fd, err;\n@@ -1651,11 +1703,13 @@ AC_CACHE_VAL(bash_cv_unusable_rtsigs,\n [AC_TRY_RUN([\n #include <sys/types.h>\n #include <signal.h>\n+#include <stdlib.h>\n \n #ifndef NSIG\n #  define NSIG 64\n #endif\n \n+int\n main ()\n {\n   int n_sigs = 2 * NSIG;\n@@ -1770,6 +1824,7 @@ bash_cv_wcwidth_broken,\n #include <locale.h>\n #include <wchar.h>\n \n+int\n main(c, v)\n int     c;\n char    **v;\n@@ -1834,9 +1889,11 @@ AC_CACHE_VAL(ac_cv_rl_version,\n [AC_TRY_RUN([\n #include <stdio.h>\n #include <readline/readline.h>\n+#include <stdlib.h>\n \n extern int rl_gnu_readline_p;\n \n+int\n main()\n {\n \tFILE *fp;\n@@ -1926,7 +1983,9 @@ AC_CACHE_VAL(bash_cv_func_ctype_nonascii,\n #endif\n #include <stdio.h>\n #include <ctype.h>\n+#include <stdlib.h>\n \n+int\n main(c, v)\n int\tc;\n char\t*v[];\n@@ -1969,10 +2028,12 @@ AC_CACHE_VAL(bash_cv_wcontinued_broken,\n #include <sys/wait.h>\n #include <unistd.h>\n #include <errno.h>\n+#include <stdlib.h>\n \n #ifndef errno\n extern int errno;\n #endif\n+int\n main()\n {\n \tint\tx;\n@@ -2023,2036 +2084,6 @@ AC_DEFUN([AM_PATH_LISPDIR],\n  AC_SUBST(lispdir)\n ])\n \n-dnl\n-dnl tests added for gettext\n-dnl\n-# codeset.m4 serial AM1 (gettext-0.10.40)\n-dnl Copyright (C) 2000-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Bruno Haible.\n-\n-AC_DEFUN([AM_LANGINFO_CODESET],\n-[\n-  AC_CACHE_CHECK([for nl_langinfo and CODESET], am_cv_langinfo_codeset,\n-    [AC_TRY_LINK([#include <langinfo.h>],\n-      [char* cs = nl_langinfo(CODESET);],\n-      am_cv_langinfo_codeset=yes,\n-      am_cv_langinfo_codeset=no)\n-    ])\n-  if test $am_cv_langinfo_codeset = yes; then\n-    AC_DEFINE(HAVE_LANGINFO_CODESET, 1,\n-      [Define if you have <langinfo.h> and nl_langinfo(CODESET).])\n-  fi\n-])\n-# gettext.m4 serial 20 (gettext-0.12)\n-dnl Copyright (C) 1995-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-dnl\n-dnl This file can can be used in projects which are not available under\n-dnl the GNU General Public License or the GNU Library General Public\n-dnl License but which still want to provide support for the GNU gettext\n-dnl functionality.\n-dnl Please note that the actual code of the GNU gettext library is covered\n-dnl by the GNU Library General Public License, and the rest of the GNU\n-dnl gettext package package is covered by the GNU General Public License.\n-dnl They are *not* in the public domain.\n-\n-dnl Authors:\n-dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.\n-dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2003.\n-\n-dnl Macro to add for using GNU gettext.\n-\n-dnl Usage: AM_GNU_GETTEXT([INTLSYMBOL], [NEEDSYMBOL], [INTLDIR]).\n-dnl INTLSYMBOL can be one of 'external', 'no-libtool', 'use-libtool'. The\n-dnl    default (if it is not specified or empty) is 'no-libtool'.\n-dnl    INTLSYMBOL should be 'external' for packages with no intl directory,\n-dnl    and 'no-libtool' or 'use-libtool' for packages with an intl directory.\n-dnl    If INTLSYMBOL is 'use-libtool', then a libtool library\n-dnl    $(top_builddir)/intl/libintl.la will be created (shared and/or static,\n-dnl    depending on --{enable,disable}-{shared,static} and on the presence of\n-dnl    AM-DISABLE-SHARED). If INTLSYMBOL is 'no-libtool', a static library\n-dnl    $(top_builddir)/intl/libintl.a will be created.\n-dnl If NEEDSYMBOL is specified and is 'need-ngettext', then GNU gettext\n-dnl    implementations (in libc or libintl) without the ngettext() function\n-dnl    will be ignored.  If NEEDSYMBOL is specified and is\n-dnl    'need-formatstring-macros', then GNU gettext implementations that don't\n-dnl    support the ISO C 99 <inttypes.h> formatstring macros will be ignored.\n-dnl INTLDIR is used to find the intl libraries.  If empty,\n-dnl    the value `$(top_builddir)/intl/' is used.\n-dnl\n-dnl The result of the configuration is one of three cases:\n-dnl 1) GNU gettext, as included in the intl subdirectory, will be compiled\n-dnl    and used.\n-dnl    Catalog format: GNU --> install in $(datadir)\n-dnl    Catalog extension: .mo after installation, .gmo in source tree\n-dnl 2) GNU gettext has been found in the system's C library.\n-dnl    Catalog format: GNU --> install in $(datadir)\n-dnl    Catalog extension: .mo after installation, .gmo in source tree\n-dnl 3) No internationalization, always use English msgid.\n-dnl    Catalog format: none\n-dnl    Catalog extension: none\n-dnl If INTLSYMBOL is 'external', only cases 2 and 3 can occur.\n-dnl The use of .gmo is historical (it was needed to avoid overwriting the\n-dnl GNU format catalogs when building on a platform with an X/Open gettext),\n-dnl but we keep it in order not to force irrelevant filename changes on the\n-dnl maintainers.\n-dnl\n-AC_DEFUN([AM_GNU_GETTEXT],\n-[\n-  dnl Argument checking.\n-  ifelse([$1], [], , [ifelse([$1], [external], , [ifelse([$1], [no-libtool], , [ifelse([$1], [use-libtool], ,\n-    [errprint([ERROR: invalid first argument to AM_GNU_GETTEXT\n-])])])])])\n-  ifelse([$2], [], , [ifelse([$2], [need-ngettext], , [ifelse([$2], [need-formatstring-macros], ,\n-    [errprint([ERROR: invalid second argument to AM_GNU_GETTEXT\n-])])])])\n-  define(gt_included_intl, ifelse([$1], [external], [no], [yes]))\n-  define(gt_libtool_suffix_prefix, ifelse([$1], [use-libtool], [l], []))\n-\n-  AC_REQUIRE([AM_PO_SUBDIRS])dnl\n-  ifelse(gt_included_intl, yes, [\n-    AC_REQUIRE([AM_INTL_SUBDIR])dnl\n-  ])\n-\n-  dnl Prerequisites of AC_LIB_LINKFLAGS_BODY.\n-  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])\n-  AC_REQUIRE([AC_LIB_RPATH])\n-\n-  dnl Sometimes libintl requires libiconv, so first search for libiconv.\n-  dnl Ideally we would do this search only after the\n-  dnl      if test \"$USE_NLS\" = \"yes\"; then\n-  dnl        if test \"$gt_cv_func_gnugettext_libc\" != \"yes\"; then\n-  dnl tests. But if configure.in invokes AM_ICONV after AM_GNU_GETTEXT\n-  dnl the configure script would need to contain the same shell code\n-  dnl again, outside any 'if'. There are two solutions:\n-  dnl - Invoke AM_ICONV_LINKFLAGS_BODY here, outside any 'if'.\n-  dnl - Control the expansions in more detail using AC_PROVIDE_IFELSE.\n-  dnl Since AC_PROVIDE_IFELSE is only in autoconf >= 2.52 and not\n-  dnl documented, we avoid it.\n-  ifelse(gt_included_intl, yes, , [\n-    AC_REQUIRE([AM_ICONV_LINKFLAGS_BODY])\n-  ])\n-\n-  dnl Set USE_NLS.\n-  AM_NLS\n-\n-  ifelse(gt_included_intl, yes, [\n-    BUILD_INCLUDED_LIBINTL=no\n-    USE_INCLUDED_LIBINTL=no\n-  ])\n-  LIBINTL=\n-  LTLIBINTL=\n-  POSUB=\n-\n-  dnl If we use NLS figure out what method\n-  if test \"$USE_NLS\" = \"yes\"; then\n-    gt_use_preinstalled_gnugettext=no\n-    ifelse(gt_included_intl, yes, [\n-      AC_MSG_CHECKING([whether included gettext is requested])\n-      AC_ARG_WITH(included-gettext,\n-        [  --with-included-gettext use the GNU gettext library included here],\n-        nls_cv_force_use_gnu_gettext=$withval,\n-        nls_cv_force_use_gnu_gettext=no)\n-      AC_MSG_RESULT($nls_cv_force_use_gnu_gettext)\n-\n-      nls_cv_use_gnu_gettext=\"$nls_cv_force_use_gnu_gettext\"\n-      if test \"$nls_cv_force_use_gnu_gettext\" != \"yes\"; then\n-    ])\n-        dnl User does not insist on using GNU NLS library.  Figure out what\n-        dnl to use.  If GNU gettext is available we use this.  Else we have\n-        dnl to fall back to GNU NLS library.\n-\n-        dnl Add a version number to the cache macros.\n-        define([gt_api_version], ifelse([$2], [need-formatstring-macros], 3, ifelse([$2], [need-ngettext], 2, 1)))\n-        define([gt_cv_func_gnugettext_libc], [gt_cv_func_gnugettext]gt_api_version[_libc])\n-        define([gt_cv_func_gnugettext_libintl], [gt_cv_func_gnugettext]gt_api_version[_libintl])\n-\n-        AC_CACHE_CHECK([for GNU gettext in libc], gt_cv_func_gnugettext_libc,\n-         [AC_TRY_LINK([#include <libintl.h>\n-]ifelse([$2], [need-formatstring-macros],\n-[#ifndef __GNU_GETTEXT_SUPPORTED_REVISION\n-#define __GNU_GETTEXT_SUPPORTED_REVISION(major) ((major) == 0 ? 0 : -1)\n-#endif\n-changequote(,)dnl\n-typedef int array [2 * (__GNU_GETTEXT_SUPPORTED_REVISION(0) >= 1) - 1];\n-changequote([,])dnl\n-], [])[extern int _nl_msg_cat_cntr;\n-extern int *_nl_domain_bindings;],\n-            [bindtextdomain (\"\", \"\");\n-return (int) gettext (\"\")]ifelse([$2], [need-ngettext], [ + (int) ngettext (\"\", \"\", 0)], [])[ + _nl_msg_cat_cntr + *_nl_domain_bindings],\n-            gt_cv_func_gnugettext_libc=yes,\n-            gt_cv_func_gnugettext_libc=no)])\n-\n-        if test \"$gt_cv_func_gnugettext_libc\" != \"yes\"; then\n-          dnl Sometimes libintl requires libiconv, so first search for libiconv.\n-          ifelse(gt_included_intl, yes, , [\n-            AM_ICONV_LINK\n-          ])\n-          dnl Search for libintl and define LIBINTL, LTLIBINTL and INCINTL\n-          dnl accordingly. Don't use AC_LIB_LINKFLAGS_BODY([intl],[iconv])\n-          dnl because that would add \"-liconv\" to LIBINTL and LTLIBINTL\n-          dnl even if libiconv doesn't exist.\n-          AC_LIB_LINKFLAGS_BODY([intl])\n-          AC_CACHE_CHECK([for GNU gettext in libintl],\n-            gt_cv_func_gnugettext_libintl,\n-           [gt_save_CPPFLAGS=\"$CPPFLAGS\"\n-            CPPFLAGS=\"$CPPFLAGS $INCINTL\"\n-            gt_save_LIBS=\"$LIBS\"\n-            LIBS=\"$LIBS $LIBINTL\"\n-            dnl Now see whether libintl exists and does not depend on libiconv.\n-            AC_TRY_LINK([#include <libintl.h>\n-]ifelse([$2], [need-formatstring-macros],\n-[#ifndef __GNU_GETTEXT_SUPPORTED_REVISION\n-#define __GNU_GETTEXT_SUPPORTED_REVISION(major) ((major) == 0 ? 0 : -1)\n-#endif\n-changequote(,)dnl\n-typedef int array [2 * (__GNU_GETTEXT_SUPPORTED_REVISION(0) >= 1) - 1];\n-changequote([,])dnl\n-], [])[extern int _nl_msg_cat_cntr;\n-extern\n-#ifdef __cplusplus\n-\"C\"\n-#endif\n-const char *_nl_expand_alias ();],\n-              [bindtextdomain (\"\", \"\");\n-return (int) gettext (\"\")]ifelse([$2], [need-ngettext], [ + (int) ngettext (\"\", \"\", 0)], [])[ + _nl_msg_cat_cntr + *_nl_expand_alias (0)],\n-              gt_cv_func_gnugettext_libintl=yes,\n-              gt_cv_func_gnugettext_libintl=no)\n-            dnl Now see whether libintl exists and depends on libiconv.\n-            if test \"$gt_cv_func_gnugettext_libintl\" != yes && test -n \"$LIBICONV\"; then\n-              LIBS=\"$LIBS $LIBICONV\"\n-              AC_TRY_LINK([#include <libintl.h>\n-]ifelse([$2], [need-formatstring-macros],\n-[#ifndef __GNU_GETTEXT_SUPPORTED_REVISION\n-#define __GNU_GETTEXT_SUPPORTED_REVISION(major) ((major) == 0 ? 0 : -1)\n-#endif\n-changequote(,)dnl\n-typedef int array [2 * (__GNU_GETTEXT_SUPPORTED_REVISION(0) >= 1) - 1];\n-changequote([,])dnl\n-], [])[extern int _nl_msg_cat_cntr;\n-extern\n-#ifdef __cplusplus\n-\"C\"\n-#endif\n-const char *_nl_expand_alias ();],\n-                [bindtextdomain (\"\", \"\");\n-return (int) gettext (\"\")]ifelse([$2], [need-ngettext], [ + (int) ngettext (\"\", \"\", 0)], [])[ + _nl_msg_cat_cntr + *_nl_expand_alias (0)],\n-               [LIBINTL=\"$LIBINTL $LIBICONV\"\n-                LTLIBINTL=\"$LTLIBINTL $LTLIBICONV\"\n-                gt_cv_func_gnugettext_libintl=yes\n-               ])\n-            fi\n-            CPPFLAGS=\"$gt_save_CPPFLAGS\"\n-            LIBS=\"$gt_save_LIBS\"])\n-        fi\n-\n-        dnl If an already present or preinstalled GNU gettext() is found,\n-        dnl use it.  But if this macro is used in GNU gettext, and GNU\n-        dnl gettext is already preinstalled in libintl, we update this\n-        dnl libintl.  (Cf. the install rule in intl/Makefile.in.)\n-        if test \"$gt_cv_func_gnugettext_libc\" = \"yes\" \\\n-           || { test \"$gt_cv_func_gnugettext_libintl\" = \"yes\" \\\n-                && test \"$PACKAGE\" != gettext-runtime \\\n-                && test \"$PACKAGE\" != gettext-tools; }; then\n-          gt_use_preinstalled_gnugettext=yes\n-        else\n-          dnl Reset the values set by searching for libintl.\n-          LIBINTL=\n-          LTLIBINTL=\n-          INCINTL=\n-        fi\n-\n-    ifelse(gt_included_intl, yes, [\n-        if test \"$gt_use_preinstalled_gnugettext\" != \"yes\"; then\n-          dnl GNU gettext is not found in the C library.\n-          dnl Fall back on included GNU gettext library.\n-          nls_cv_use_gnu_gettext=yes\n-        fi\n-      fi\n-\n-      if test \"$nls_cv_use_gnu_gettext\" = \"yes\"; then\n-        dnl Mark actions used to generate GNU NLS library.\n-        BUILD_INCLUDED_LIBINTL=yes\n-        USE_INCLUDED_LIBINTL=yes\n-        LIBINTL=\"ifelse([$3],[],\\${top_builddir}/intl,[$3])/libintl.[]gt_libtool_suffix_prefix[]a $LIBICONV\"\n-        LTLIBINTL=\"ifelse([$3],[],\\${top_builddir}/intl,[$3])/libintl.[]gt_libtool_suffix_prefix[]a $LTLIBICONV\"\n-        LIBS=`echo \" $LIBS \" | sed -e 's/ -lintl / /' -e 's/^ //' -e 's/ $//'`\n-      fi\n-\n-      if test \"$gt_use_preinstalled_gnugettext\" = \"yes\" \\\n-         || test \"$nls_cv_use_gnu_gettext\" = \"yes\"; then\n-        dnl Mark actions to use GNU gettext tools.\n-        CATOBJEXT=.gmo\n-      fi\n-    ])\n-\n-    if test \"$gt_use_preinstalled_gnugettext\" = \"yes\" \\\n-       || test \"$nls_cv_use_gnu_gettext\" = \"yes\"; then\n-      AC_DEFINE(ENABLE_NLS, 1,\n-        [Define to 1 if translation of program messages to the user's native language\n-   is requested.])\n-    else\n-      USE_NLS=no\n-    fi\n-  fi\n-\n-  AC_MSG_CHECKING([whether to use NLS])\n-  AC_MSG_RESULT([$USE_NLS])\n-  if test \"$USE_NLS\" = \"yes\"; then\n-    AC_MSG_CHECKING([where the gettext function comes from])\n-    if test \"$gt_use_preinstalled_gnugettext\" = \"yes\"; then\n-      if test \"$gt_cv_func_gnugettext_libintl\" = \"yes\"; then\n-        gt_source=\"external libintl\"\n-      else\n-        gt_source=\"libc\"\n-      fi\n-    else\n-      gt_source=\"included intl directory\"\n-    fi\n-    AC_MSG_RESULT([$gt_source])\n-  fi\n-\n-  if test \"$USE_NLS\" = \"yes\"; then\n-\n-    if test \"$gt_use_preinstalled_gnugettext\" = \"yes\"; then\n-      if test \"$gt_cv_func_gnugettext_libintl\" = \"yes\"; then\n-        AC_MSG_CHECKING([how to link with libintl])\n-        AC_MSG_RESULT([$LIBINTL])\n-        AC_LIB_APPENDTOVAR([CPPFLAGS], [$INCINTL])\n-      fi\n-\n-      dnl For backward compatibility. Some packages may be using this.\n-      AC_DEFINE(HAVE_GETTEXT, 1,\n-       [Define if the GNU gettext() function is already present or preinstalled.])\n-      AC_DEFINE(HAVE_DCGETTEXT, 1,\n-       [Define if the GNU dcgettext() function is already present or preinstalled.])\n-    fi\n-\n-    dnl We need to process the po/ directory.\n-    POSUB=po\n-  fi\n-\n-  ifelse(gt_included_intl, yes, [\n-    dnl If this is used in GNU gettext we have to set BUILD_INCLUDED_LIBINTL\n-    dnl to 'yes' because some of the testsuite requires it.\n-    if test \"$PACKAGE\" = gettext-runtime || test \"$PACKAGE\" = gettext-tools; then\n-      BUILD_INCLUDED_LIBINTL=yes\n-    fi\n-\n-    dnl Make all variables we use known to autoconf.\n-    AC_SUBST(BUILD_INCLUDED_LIBINTL)\n-    AC_SUBST(USE_INCLUDED_LIBINTL)\n-    AC_SUBST(CATOBJEXT)\n-\n-    dnl For backward compatibility. Some configure.ins may be using this.\n-    nls_cv_header_intl=\n-    nls_cv_header_libgt=\n-\n-    dnl For backward compatibility. Some Makefiles may be using this.\n-    DATADIRNAME=share\n-    AC_SUBST(DATADIRNAME)\n-\n-    dnl For backward compatibility. Some Makefiles may be using this.\n-    INSTOBJEXT=.mo\n-    AC_SUBST(INSTOBJEXT)\n-\n-    dnl For backward compatibility. Some Makefiles may be using this.\n-    GENCAT=gencat\n-    AC_SUBST(GENCAT)\n-\n-    dnl For backward compatibility. Some Makefiles may be using this.\n-    if test \"$USE_INCLUDED_LIBINTL\" = yes; then\n-      INTLOBJS=\"\\$(GETTOBJS)\"\n-    fi\n-    AC_SUBST(INTLOBJS)\n-\n-    dnl Enable libtool support if the surrounding package wishes it.\n-    INTL_LIBTOOL_SUFFIX_PREFIX=gt_libtool_suffix_prefix\n-    AC_SUBST(INTL_LIBTOOL_SUFFIX_PREFIX)\n-  ])\n-\n-  dnl For backward compatibility. Some Makefiles may be using this.\n-  INTLLIBS=\"$LIBINTL\"\n-  AC_SUBST(INTLLIBS)\n-\n-  dnl Make all documented variables known to autoconf.\n-  AC_SUBST(LIBINTL)\n-  AC_SUBST(LTLIBINTL)\n-  AC_SUBST(POSUB)\n-])\n-\n-\n-dnl Checks for all prerequisites of the intl subdirectory,\n-dnl except for INTL_LIBTOOL_SUFFIX_PREFIX (and possibly LIBTOOL), INTLOBJS,\n-dnl            USE_INCLUDED_LIBINTL, BUILD_INCLUDED_LIBINTL.\n-AC_DEFUN([AM_INTL_SUBDIR],\n-[\n-  AC_REQUIRE([AC_PROG_INSTALL])dnl\n-  AC_REQUIRE([AM_MKINSTALLDIRS])dnl\n-  AC_REQUIRE([AC_PROG_CC])dnl\n-  AC_REQUIRE([AC_CANONICAL_HOST])dnl\n-  AC_REQUIRE([AC_PROG_RANLIB])dnl\n-  AC_REQUIRE([AC_ISC_POSIX])dnl\n-  AC_REQUIRE([AC_HEADER_STDC])dnl\n-  AC_REQUIRE([AC_C_CONST])dnl\n-  AC_REQUIRE([AC_C_INLINE])dnl\n-  AC_REQUIRE([AC_TYPE_OFF_T])dnl\n-  AC_REQUIRE([AC_TYPE_SIZE_T])dnl\n-  AC_REQUIRE([AC_FUNC_ALLOCA])dnl\n-  AC_REQUIRE([AC_FUNC_MMAP])dnl\n-  AC_REQUIRE([jm_GLIBC21])dnl\n-  AC_REQUIRE([gt_INTDIV0])dnl\n-  AC_REQUIRE([jm_AC_TYPE_UINTMAX_T])dnl\n-  AC_REQUIRE([gt_HEADER_INTTYPES_H])dnl\n-  AC_REQUIRE([gt_INTTYPES_PRI])dnl\n-\n-  AC_CHECK_HEADERS([argz.h limits.h locale.h nl_types.h malloc.h stddef.h \\\n-stdlib.h string.h unistd.h sys/param.h])\n-  AC_CHECK_FUNCS([feof_unlocked fgets_unlocked getc_unlocked getcwd getegid \\\n-geteuid getgid getuid mempcpy munmap putenv setenv setlocale localeconv stpcpy \\\n-strcasecmp strdup strtoul tsearch __argz_count __argz_stringify __argz_next \\\n-__fsetlocking])\n-\n-  AM_ICONV\n-  AM_LANGINFO_CODESET\n-  if test $ac_cv_header_locale_h = yes; then\n-    AM_LC_MESSAGES\n-  fi\n-\n-  dnl intl/plural.c is generated from intl/plural.y. It requires bison,\n-  dnl because plural.y uses bison specific features. It requires at least\n-  dnl bison-1.26 because earlier versions generate a plural.c that doesn't\n-  dnl compile.\n-  dnl bison is only needed for the maintainer (who touches plural.y). But in\n-  dnl order to avoid separate Makefiles or --enable-maintainer-mode, we put\n-  dnl the rule in general Makefile. Now, some people carelessly touch the\n-  dnl files or have a broken \"make\" program, hence the plural.c rule will\n-  dnl sometimes fire. To avoid an error, defines BISON to \":\" if it is not\n-  dnl present or too old.\n-  AC_CHECK_PROGS([INTLBISON], [bison])\n-  if test -z \"$INTLBISON\"; then\n-    ac_verc_fail=yes\n-  else\n-    dnl Found it, now check the version.\n-    AC_MSG_CHECKING([version of bison])\n-changequote(<<,>>)dnl\n-    ac_prog_version=`$INTLBISON --version 2>&1 | sed -n 's/^.*GNU Bison.* \\([0-9]*\\.[0-9.]*\\).*$/\\1/p'`\n-    case $ac_prog_version in\n-      '') ac_prog_version=\"v. ?.??, bad\"; ac_verc_fail=yes;;\n-      1.2[6-9]* | 1.[3-9][0-9]* | [2-9].*)\n-changequote([,])dnl\n-         ac_prog_version=\"$ac_prog_version, ok\"; ac_verc_fail=no;;\n-      *) ac_prog_version=\"$ac_prog_version, bad\"; ac_verc_fail=yes;;\n-    esac\n-    AC_MSG_RESULT([$ac_prog_version])\n-  fi\n-  if test $ac_verc_fail = yes; then\n-    INTLBISON=:\n-  fi\n-])\n-\n-\n-dnl Usage: AM_GNU_GETTEXT_VERSION([gettext-version])\n-AC_DEFUN([AM_GNU_GETTEXT_VERSION], [])\n-# glibc21.m4 serial 2 (fileutils-4.1.3, gettext-0.10.40)\n-dnl Copyright (C) 2000-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-# Test for the GNU C Library, version 2.1 or newer.\n-# From Bruno Haible.\n-\n-AC_DEFUN([jm_GLIBC21],\n-  [\n-    AC_CACHE_CHECK(whether we are using the GNU C Library 2.1 or newer,\n-      ac_cv_gnu_library_2_1,\n-      [AC_EGREP_CPP([Lucky GNU user],\n-\t[\n-#include <features.h>\n-#ifdef __GNU_LIBRARY__\n- #if (__GLIBC__ == 2 && __GLIBC_MINOR__ >= 1) || (__GLIBC__ > 2)\n-  Lucky GNU user\n- #endif\n-#endif\n-\t],\n-\tac_cv_gnu_library_2_1=yes,\n-\tac_cv_gnu_library_2_1=no)\n-      ]\n-    )\n-    AC_SUBST(GLIBC21)\n-    GLIBC21=\"$ac_cv_gnu_library_2_1\"\n-  ]\n-)\n-# iconv.m4 serial AM4 (gettext-0.11.3)\n-dnl Copyright (C) 2000-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Bruno Haible.\n-\n-AC_DEFUN([AM_ICONV_LINKFLAGS_BODY],\n-[\n-  dnl Prerequisites of AC_LIB_LINKFLAGS_BODY.\n-  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])\n-  AC_REQUIRE([AC_LIB_RPATH])\n-\n-  dnl Search for libiconv and define LIBICONV, LTLIBICONV and INCICONV\n-  dnl accordingly.\n-  AC_LIB_LINKFLAGS_BODY([iconv])\n-])\n-\n-AC_DEFUN([AM_ICONV_LINK],\n-[\n-  dnl Some systems have iconv in libc, some have it in libiconv (OSF/1 and\n-  dnl those with the standalone portable GNU libiconv installed).\n-\n-  dnl Search for libiconv and define LIBICONV, LTLIBICONV and INCICONV\n-  dnl accordingly.\n-  AC_REQUIRE([AM_ICONV_LINKFLAGS_BODY])\n-\n-  dnl Add $INCICONV to CPPFLAGS before performing the following checks,\n-  dnl because if the user has installed libiconv and not disabled its use\n-  dnl via --without-libiconv-prefix, he wants to use it. The first\n-  dnl AC_TRY_LINK will then fail, the second AC_TRY_LINK will succeed.\n-  am_save_CPPFLAGS=\"$CPPFLAGS\"\n-  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INCICONV])\n-\n-  AC_CACHE_CHECK(for iconv, am_cv_func_iconv, [\n-    am_cv_func_iconv=\"no, consider installing GNU libiconv\"\n-    am_cv_lib_iconv=no\n-    AC_TRY_LINK([#include <stdlib.h>\n-#include <iconv.h>],\n-      [iconv_t cd = iconv_open(\"\",\"\");\n-       iconv(cd,NULL,NULL,NULL,NULL);\n-       iconv_close(cd);],\n-      am_cv_func_iconv=yes)\n-    if test \"$am_cv_func_iconv\" != yes; then\n-      am_save_LIBS=\"$LIBS\"\n-      LIBS=\"$LIBS $LIBICONV\"\n-      AC_TRY_LINK([#include <stdlib.h>\n-#include <iconv.h>],\n-        [iconv_t cd = iconv_open(\"\",\"\");\n-         iconv(cd,NULL,NULL,NULL,NULL);\n-         iconv_close(cd);],\n-        am_cv_lib_iconv=yes\n-        am_cv_func_iconv=yes)\n-      LIBS=\"$am_save_LIBS\"\n-    fi\n-  ])\n-  if test \"$am_cv_func_iconv\" = yes; then\n-    AC_DEFINE(HAVE_ICONV, 1, [Define if you have the iconv() function.])\n-  fi\n-  if test \"$am_cv_lib_iconv\" = yes; then\n-    AC_MSG_CHECKING([how to link with libiconv])\n-    AC_MSG_RESULT([$LIBICONV])\n-  else\n-    dnl If $LIBICONV didn't lead to a usable library, we don't need $INCICONV\n-    dnl either.\n-    CPPFLAGS=\"$am_save_CPPFLAGS\"\n-    LIBICONV=\n-    LTLIBICONV=\n-  fi\n-  AC_SUBST(LIBICONV)\n-  AC_SUBST(LTLIBICONV)\n-])\n-\n-AC_DEFUN([AM_ICONV],\n-[\n-  AM_ICONV_LINK\n-  if test \"$am_cv_func_iconv\" = yes; then\n-    AC_MSG_CHECKING([for iconv declaration])\n-    AC_CACHE_VAL(am_cv_proto_iconv, [\n-      AC_TRY_COMPILE([\n-#include <stdlib.h>\n-#include <iconv.h>\n-extern\n-#ifdef __cplusplus\n-\"C\"\n-#endif\n-#if defined(__STDC__) || defined(__cplusplus)\n-size_t iconv (iconv_t cd, char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);\n-#else\n-size_t iconv();\n-#endif\n-], [], am_cv_proto_iconv_arg1=\"\", am_cv_proto_iconv_arg1=\"const\")\n-      am_cv_proto_iconv=\"extern size_t iconv (iconv_t cd, $am_cv_proto_iconv_arg1 char * *inbuf, size_t *inbytesleft, char * *outbuf, size_t *outbytesleft);\"])\n-    am_cv_proto_iconv=`echo \"[$]am_cv_proto_iconv\" | tr -s ' ' | sed -e 's/( /(/'`\n-    AC_MSG_RESULT([$]{ac_t:-\n-         }[$]am_cv_proto_iconv)\n-    AC_DEFINE_UNQUOTED(ICONV_CONST, $am_cv_proto_iconv_arg1,\n-      [Define as const if the declaration of iconv() needs const.])\n-  fi\n-])\n-# intdiv0.m4 serial 1 (gettext-0.11.3)\n-dnl Copyright (C) 2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Bruno Haible.\n-\n-AC_DEFUN([gt_INTDIV0],\n-[\n-  AC_REQUIRE([AC_PROG_CC])dnl\n-  AC_REQUIRE([AC_CANONICAL_HOST])dnl\n-\n-  AC_CACHE_CHECK([whether integer division by zero raises SIGFPE],\n-    gt_cv_int_divbyzero_sigfpe,\n-    [\n-      AC_TRY_RUN([\n-#include <stdlib.h>\n-#include <signal.h>\n-\n-static void\n-#ifdef __cplusplus\n-sigfpe_handler (int sig)\n-#else\n-sigfpe_handler (sig) int sig;\n-#endif\n-{\n-  /* Exit with code 0 if SIGFPE, with code 1 if any other signal.  */\n-  exit (sig != SIGFPE);\n-}\n-\n-int x = 1;\n-int y = 0;\n-int z;\n-int nan;\n-\n-int main ()\n-{\n-  signal (SIGFPE, sigfpe_handler);\n-/* IRIX and AIX (when \"xlc -qcheck\" is used) yield signal SIGTRAP.  */\n-#if (defined (__sgi) || defined (_AIX)) && defined (SIGTRAP)\n-  signal (SIGTRAP, sigfpe_handler);\n-#endif\n-/* Linux/SPARC yields signal SIGILL.  */\n-#if defined (__sparc__) && defined (__linux__)\n-  signal (SIGILL, sigfpe_handler);\n-#endif\n-\n-  z = x / y;\n-  nan = y / y;\n-  exit (1);\n-}\n-], gt_cv_int_divbyzero_sigfpe=yes, gt_cv_int_divbyzero_sigfpe=no,\n-        [\n-          # Guess based on the CPU.\n-          case \"$host_cpu\" in\n-            alpha* | i[34567]86 | m68k | s390*)\n-              gt_cv_int_divbyzero_sigfpe=\"guessing yes\";;\n-            *)\n-              gt_cv_int_divbyzero_sigfpe=\"guessing no\";;\n-          esac\n-        ])\n-    ])\n-  case \"$gt_cv_int_divbyzero_sigfpe\" in\n-    *yes) value=1;;\n-    *) value=0;;\n-  esac\n-  AC_DEFINE_UNQUOTED(INTDIV0_RAISES_SIGFPE, $value,\n-    [Define if integer division by zero raises signal SIGFPE.])\n-])\n-# inttypes.m4 serial 1 (gettext-0.11.4)\n-dnl Copyright (C) 1997-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Paul Eggert.\n-\n-# Define HAVE_INTTYPES_H if <inttypes.h> exists and doesn't clash with\n-# <sys/types.h>.\n-\n-AC_DEFUN([gt_HEADER_INTTYPES_H],\n-[\n-  AC_CACHE_CHECK([for inttypes.h], gt_cv_header_inttypes_h,\n-  [\n-    AC_TRY_COMPILE(\n-      [#include <sys/types.h>\n-#include <inttypes.h>],\n-      [], gt_cv_header_inttypes_h=yes, gt_cv_header_inttypes_h=no)\n-  ])\n-  if test $gt_cv_header_inttypes_h = yes; then\n-    AC_DEFINE_UNQUOTED(HAVE_INTTYPES_H, 1,\n-      [Define if <inttypes.h> exists and doesn't clash with <sys/types.h>.])\n-  fi\n-])\n-# inttypes_h.m4 serial 5 (gettext-0.12)\n-dnl Copyright (C) 1997-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Paul Eggert.\n-\n-# Define HAVE_INTTYPES_H_WITH_UINTMAX if <inttypes.h> exists,\n-# doesn't clash with <sys/types.h>, and declares uintmax_t.\n-\n-AC_DEFUN([jm_AC_HEADER_INTTYPES_H],\n-[\n-  AC_CACHE_CHECK([for inttypes.h], jm_ac_cv_header_inttypes_h,\n-  [AC_TRY_COMPILE(\n-    [#include <sys/types.h>\n-#include <inttypes.h>],\n-    [uintmax_t i = (uintmax_t) -1;],\n-    jm_ac_cv_header_inttypes_h=yes,\n-    jm_ac_cv_header_inttypes_h=no)])\n-  if test $jm_ac_cv_header_inttypes_h = yes; then\n-    AC_DEFINE_UNQUOTED(HAVE_INTTYPES_H_WITH_UINTMAX, 1,\n-      [Define if <inttypes.h> exists, doesn't clash with <sys/types.h>,\n-       and declares uintmax_t. ])\n-  fi\n-])\n-# inttypes-pri.m4 serial 1 (gettext-0.11.4)\n-dnl Copyright (C) 1997-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Bruno Haible.\n-\n-# Define PRI_MACROS_BROKEN if <inttypes.h> exists and defines the PRI*\n-# macros to non-string values.  This is the case on AIX 4.3.3.\n-\n-AC_DEFUN([gt_INTTYPES_PRI],\n-[\n-  AC_REQUIRE([gt_HEADER_INTTYPES_H])\n-  if test $gt_cv_header_inttypes_h = yes; then\n-    AC_CACHE_CHECK([whether the inttypes.h PRIxNN macros are broken],\n-      gt_cv_inttypes_pri_broken,\n-      [\n-        AC_TRY_COMPILE([#include <inttypes.h>\n-#ifdef PRId32\n-char *p = PRId32;\n-#endif\n-], [], gt_cv_inttypes_pri_broken=no, gt_cv_inttypes_pri_broken=yes)\n-      ])\n-  fi\n-  if test \"$gt_cv_inttypes_pri_broken\" = yes; then\n-    AC_DEFINE_UNQUOTED(PRI_MACROS_BROKEN, 1,\n-      [Define if <inttypes.h> exists and defines unusable PRI* macros.])\n-  fi\n-])\n-# isc-posix.m4 serial 2 (gettext-0.11.2)\n-dnl Copyright (C) 1995-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-# This file is not needed with autoconf-2.53 and newer.  Remove it in 2005.\n-\n-# This test replaces the one in autoconf.\n-# Currently this macro should have the same name as the autoconf macro\n-# because gettext's gettext.m4 (distributed in the automake package)\n-# still uses it.  Otherwise, the use in gettext.m4 makes autoheader\n-# give these diagnostics:\n-#   configure.in:556: AC_TRY_COMPILE was called before AC_ISC_POSIX\n-#   configure.in:556: AC_TRY_RUN was called before AC_ISC_POSIX\n-\n-undefine([AC_ISC_POSIX])\n-\n-AC_DEFUN([AC_ISC_POSIX],\n-  [\n-    dnl This test replaces the obsolescent AC_ISC_POSIX kludge.\n-    AC_CHECK_LIB(cposix, strerror, [LIBS=\"$LIBS -lcposix\"])\n-  ]\n-)\n-# lcmessage.m4 serial 3 (gettext-0.11.3)\n-dnl Copyright (C) 1995-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-dnl\n-dnl This file can can be used in projects which are not available under\n-dnl the GNU General Public License or the GNU Library General Public\n-dnl License but which still want to provide support for the GNU gettext\n-dnl functionality.\n-dnl Please note that the actual code of the GNU gettext library is covered\n-dnl by the GNU Library General Public License, and the rest of the GNU\n-dnl gettext package package is covered by the GNU General Public License.\n-dnl They are *not* in the public domain.\n-\n-dnl Authors:\n-dnl   Ulrich Drepper <drepper@cygnus.com>, 1995.\n-\n-# Check whether LC_MESSAGES is available in <locale.h>.\n-\n-AC_DEFUN([AM_LC_MESSAGES],\n-[\n-  AC_CACHE_CHECK([for LC_MESSAGES], am_cv_val_LC_MESSAGES,\n-    [AC_TRY_LINK([#include <locale.h>], [return LC_MESSAGES],\n-       am_cv_val_LC_MESSAGES=yes, am_cv_val_LC_MESSAGES=no)])\n-  if test $am_cv_val_LC_MESSAGES = yes; then\n-    AC_DEFINE(HAVE_LC_MESSAGES, 1,\n-      [Define if your <locale.h> file defines LC_MESSAGES.])\n-  fi\n-])\n-# lib-ld.m4 serial 2 (gettext-0.12)\n-dnl Copyright (C) 1996-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl Subroutines of libtool.m4,\n-dnl with replacements s/AC_/AC_LIB/ and s/lt_cv/acl_cv/ to avoid collision\n-dnl with libtool.m4.\n-\n-dnl From libtool-1.4. Sets the variable with_gnu_ld to yes or no.\n-AC_DEFUN([AC_LIB_PROG_LD_GNU],\n-[AC_CACHE_CHECK([if the linker ($LD) is GNU ld], acl_cv_prog_gnu_ld,\n-[# I'd rather use --version here, but apparently some GNU ld's only accept -v.\n-if $LD -v 2>&1 </dev/null | egrep '(GNU|with BFD)' 1>&5; then\n-  acl_cv_prog_gnu_ld=yes\n-else\n-  acl_cv_prog_gnu_ld=no\n-fi])\n-with_gnu_ld=$acl_cv_prog_gnu_ld\n-])\n-\n-dnl From libtool-1.4. Sets the variable LD.\n-AC_DEFUN([AC_LIB_PROG_LD],\n-[AC_ARG_WITH(gnu-ld,\n-[  --with-gnu-ld           assume the C compiler uses GNU ld [default=no]],\n-test \"$withval\" = no || with_gnu_ld=yes, with_gnu_ld=no)\n-AC_REQUIRE([AC_PROG_CC])dnl\n-AC_REQUIRE([AC_CANONICAL_HOST])dnl\n-# Prepare PATH_SEPARATOR.\n-# The user is always right.\n-if test \"${PATH_SEPARATOR+set}\" != set; then\n-  echo \"#! /bin/sh\" >conf$$.sh\n-  echo  \"exit 0\"   >>conf$$.sh\n-  chmod +x conf$$.sh\n-  if (PATH=\"/nonexistent;.\"; conf$$.sh) >/dev/null 2>&1; then\n-    PATH_SEPARATOR=';'\n-  else\n-    PATH_SEPARATOR=:\n-  fi\n-  rm -f conf$$.sh\n-fi\n-ac_prog=ld\n-if test \"$GCC\" = yes; then\n-  # Check if gcc -print-prog-name=ld gives a path.\n-  AC_MSG_CHECKING([for ld used by GCC])\n-  case $host in\n-  *-*-mingw*)\n-    # gcc leaves a trailing carriage return which upsets mingw\n-    ac_prog=`($CC -print-prog-name=ld) 2>&5 | tr -d '\\015'` ;;\n-  *)\n-    ac_prog=`($CC -print-prog-name=ld) 2>&5` ;;\n-  esac\n-  case $ac_prog in\n-    # Accept absolute paths.\n-    [[\\\\/]* | [A-Za-z]:[\\\\/]*)]\n-      [re_direlt='/[^/][^/]*/\\.\\./']\n-      # Canonicalize the path of ld\n-      ac_prog=`echo $ac_prog| sed 's%\\\\\\\\%/%g'`\n-      while echo $ac_prog | grep \"$re_direlt\" > /dev/null 2>&1; do\n-\tac_prog=`echo $ac_prog| sed \"s%$re_direlt%/%\"`\n-      done\n-      test -z \"$LD\" && LD=\"$ac_prog\"\n-      ;;\n-  \"\")\n-    # If it fails, then pretend we aren't using GCC.\n-    ac_prog=ld\n-    ;;\n-  *)\n-    # If it is relative, then search for the first ld in PATH.\n-    with_gnu_ld=unknown\n-    ;;\n-  esac\n-elif test \"$with_gnu_ld\" = yes; then\n-  AC_MSG_CHECKING([for GNU ld])\n-else\n-  AC_MSG_CHECKING([for non-GNU ld])\n-fi\n-AC_CACHE_VAL(acl_cv_path_LD,\n-[if test -z \"$LD\"; then\n-  IFS=\"${IFS= \t}\"; ac_save_ifs=\"$IFS\"; IFS=\"${IFS}${PATH_SEPARATOR-:}\"\n-  for ac_dir in $PATH; do\n-    test -z \"$ac_dir\" && ac_dir=.\n-    if test -f \"$ac_dir/$ac_prog\" || test -f \"$ac_dir/$ac_prog$ac_exeext\"; then\n-      acl_cv_path_LD=\"$ac_dir/$ac_prog\"\n-      # Check to see if the program is GNU ld.  I'd rather use --version,\n-      # but apparently some GNU ld's only accept -v.\n-      # Break only if it was the GNU/non-GNU ld that we prefer.\n-      if \"$acl_cv_path_LD\" -v 2>&1 < /dev/null | egrep '(GNU|with BFD)' > /dev/null; then\n-\ttest \"$with_gnu_ld\" != no && break\n-      else\n-\ttest \"$with_gnu_ld\" != yes && break\n-      fi\n-    fi\n-  done\n-  IFS=\"$ac_save_ifs\"\n-else\n-  acl_cv_path_LD=\"$LD\" # Let the user override the test with a path.\n-fi])\n-LD=\"$acl_cv_path_LD\"\n-if test -n \"$LD\"; then\n-  AC_MSG_RESULT($LD)\n-else\n-  AC_MSG_RESULT(no)\n-fi\n-test -z \"$LD\" && AC_MSG_ERROR([no acceptable ld found in \\$PATH])\n-AC_LIB_PROG_LD_GNU\n-])\n-# lib-link.m4 serial 4 (gettext-0.12)\n-dnl Copyright (C) 2001-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Bruno Haible.\n-\n-dnl AC_LIB_LINKFLAGS(name [, dependencies]) searches for libname and\n-dnl the libraries corresponding to explicit and implicit dependencies.\n-dnl Sets and AC_SUBSTs the LIB${NAME} and LTLIB${NAME} variables and\n-dnl augments the CPPFLAGS variable.\n-AC_DEFUN([AC_LIB_LINKFLAGS],\n-[\n-  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])\n-  AC_REQUIRE([AC_LIB_RPATH])\n-  define([Name],[translit([$1],[./-], [___])])\n-  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],\n-                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])\n-  AC_CACHE_CHECK([how to link with lib[]$1], [ac_cv_lib[]Name[]_libs], [\n-    AC_LIB_LINKFLAGS_BODY([$1], [$2])\n-    ac_cv_lib[]Name[]_libs=\"$LIB[]NAME\"\n-    ac_cv_lib[]Name[]_ltlibs=\"$LTLIB[]NAME\"\n-    ac_cv_lib[]Name[]_cppflags=\"$INC[]NAME\"\n-  ])\n-  LIB[]NAME=\"$ac_cv_lib[]Name[]_libs\"\n-  LTLIB[]NAME=\"$ac_cv_lib[]Name[]_ltlibs\"\n-  INC[]NAME=\"$ac_cv_lib[]Name[]_cppflags\"\n-  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INC]NAME)\n-  AC_SUBST([LIB]NAME)\n-  AC_SUBST([LTLIB]NAME)\n-  dnl Also set HAVE_LIB[]NAME so that AC_LIB_HAVE_LINKFLAGS can reuse the\n-  dnl results of this search when this library appears as a dependency.\n-  HAVE_LIB[]NAME=yes\n-  undefine([Name])\n-  undefine([NAME])\n-])\n-\n-dnl AC_LIB_HAVE_LINKFLAGS(name, dependencies, includes, testcode)\n-dnl searches for libname and the libraries corresponding to explicit and\n-dnl implicit dependencies, together with the specified include files and\n-dnl the ability to compile and link the specified testcode. If found, it\n-dnl sets and AC_SUBSTs HAVE_LIB${NAME}=yes and the LIB${NAME} and\n-dnl LTLIB${NAME} variables and augments the CPPFLAGS variable, and\n-dnl #defines HAVE_LIB${NAME} to 1. Otherwise, it sets and AC_SUBSTs\n-dnl HAVE_LIB${NAME}=no and LIB${NAME} and LTLIB${NAME} to empty.\n-AC_DEFUN([AC_LIB_HAVE_LINKFLAGS],\n-[\n-  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])\n-  AC_REQUIRE([AC_LIB_RPATH])\n-  define([Name],[translit([$1],[./-], [___])])\n-  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],\n-                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])\n-\n-  dnl Search for lib[]Name and define LIB[]NAME, LTLIB[]NAME and INC[]NAME\n-  dnl accordingly.\n-  AC_LIB_LINKFLAGS_BODY([$1], [$2])\n-\n-  dnl Add $INC[]NAME to CPPFLAGS before performing the following checks,\n-  dnl because if the user has installed lib[]Name and not disabled its use\n-  dnl via --without-lib[]Name-prefix, he wants to use it.\n-  ac_save_CPPFLAGS=\"$CPPFLAGS\"\n-  AC_LIB_APPENDTOVAR([CPPFLAGS], [$INC]NAME)\n-\n-  AC_CACHE_CHECK([for lib[]$1], [ac_cv_lib[]Name], [\n-    ac_save_LIBS=\"$LIBS\"\n-    LIBS=\"$LIBS $LIB[]NAME\"\n-    AC_TRY_LINK([$3], [$4], [ac_cv_lib[]Name=yes], [ac_cv_lib[]Name=no])\n-    LIBS=\"$ac_save_LIBS\"\n-  ])\n-  if test \"$ac_cv_lib[]Name\" = yes; then\n-    HAVE_LIB[]NAME=yes\n-    AC_DEFINE([HAVE_LIB]NAME, 1, [Define if you have the $1 library.])\n-    AC_MSG_CHECKING([how to link with lib[]$1])\n-    AC_MSG_RESULT([$LIB[]NAME])\n-  else\n-    HAVE_LIB[]NAME=no\n-    dnl If $LIB[]NAME didn't lead to a usable library, we don't need\n-    dnl $INC[]NAME either.\n-    CPPFLAGS=\"$ac_save_CPPFLAGS\"\n-    LIB[]NAME=\n-    LTLIB[]NAME=\n-  fi\n-  AC_SUBST([HAVE_LIB]NAME)\n-  AC_SUBST([LIB]NAME)\n-  AC_SUBST([LTLIB]NAME)\n-  undefine([Name])\n-  undefine([NAME])\n-])\n-\n-dnl Determine the platform dependent parameters needed to use rpath:\n-dnl libext, shlibext, hardcode_libdir_flag_spec, hardcode_libdir_separator,\n-dnl hardcode_direct, hardcode_minus_L.\n-AC_DEFUN([AC_LIB_RPATH],\n-[\n-  AC_REQUIRE([AC_PROG_CC])                dnl we use $CC, $GCC, $LDFLAGS\n-  AC_REQUIRE([AC_LIB_PROG_LD])            dnl we use $LD, $with_gnu_ld\n-  AC_REQUIRE([AC_CANONICAL_HOST])         dnl we use $host\n-  AC_REQUIRE([AC_CONFIG_AUX_DIR_DEFAULT]) dnl we use $ac_aux_dir\n-  AC_CACHE_CHECK([for shared library run path origin], acl_cv_rpath, [\n-    CC=\"$CC\" GCC=\"$GCC\" LDFLAGS=\"$LDFLAGS\" LD=\"$LD\" with_gnu_ld=\"$with_gnu_ld\" \\\n-    ${CONFIG_SHELL-/bin/sh} \"$ac_aux_dir/config.rpath\" \"$host\" > conftest.sh\n-    . ./conftest.sh\n-    rm -f ./conftest.sh\n-    acl_cv_rpath=done\n-  ])\n-  wl=\"$acl_cv_wl\"\n-  libext=\"$acl_cv_libext\"\n-  shlibext=\"$acl_cv_shlibext\"\n-  hardcode_libdir_flag_spec=\"$acl_cv_hardcode_libdir_flag_spec\"\n-  hardcode_libdir_separator=\"$acl_cv_hardcode_libdir_separator\"\n-  hardcode_direct=\"$acl_cv_hardcode_direct\"\n-  hardcode_minus_L=\"$acl_cv_hardcode_minus_L\"\n-  dnl Determine whether the user wants rpath handling at all.\n-  AC_ARG_ENABLE(rpath,\n-    [  --disable-rpath         do not hardcode runtime library paths],\n-    :, enable_rpath=yes)\n-])\n-\n-dnl AC_LIB_LINKFLAGS_BODY(name [, dependencies]) searches for libname and\n-dnl the libraries corresponding to explicit and implicit dependencies.\n-dnl Sets the LIB${NAME}, LTLIB${NAME} and INC${NAME} variables.\n-AC_DEFUN([AC_LIB_LINKFLAGS_BODY],\n-[\n-  define([NAME],[translit([$1],[abcdefghijklmnopqrstuvwxyz./-],\n-                               [ABCDEFGHIJKLMNOPQRSTUVWXYZ___])])\n-  dnl By default, look in $includedir and $libdir.\n-  use_additional=yes\n-  AC_LIB_WITH_FINAL_PREFIX([\n-    eval additional_includedir=\\\"$includedir\\\"\n-    eval additional_libdir=\\\"$libdir\\\"\n-  ])\n-  AC_LIB_ARG_WITH([lib$1-prefix],\n-[  --with-lib$1-prefix[=DIR]  search for lib$1 in DIR/include and DIR/lib\n-  --without-lib$1-prefix     don't search for lib$1 in includedir and libdir],\n-[\n-    if test \"X$withval\" = \"Xno\"; then\n-      use_additional=no\n-    else\n-      if test \"X$withval\" = \"X\"; then\n-        AC_LIB_WITH_FINAL_PREFIX([\n-          eval additional_includedir=\\\"$includedir\\\"\n-          eval additional_libdir=\\\"$libdir\\\"\n-        ])\n-      else\n-        additional_includedir=\"$withval/include\"\n-        additional_libdir=\"$withval/lib\"\n-      fi\n-    fi\n-])\n-  dnl Search the library and its dependencies in $additional_libdir and\n-  dnl $LDFLAGS. Using breadth-first-seach.\n-  LIB[]NAME=\n-  LTLIB[]NAME=\n-  INC[]NAME=\n-  rpathdirs=\n-  ltrpathdirs=\n-  names_already_handled=\n-  names_next_round='$1 $2'\n-  while test -n \"$names_next_round\"; do\n-    names_this_round=\"$names_next_round\"\n-    names_next_round=\n-    for name in $names_this_round; do\n-      already_handled=\n-      for n in $names_already_handled; do\n-        if test \"$n\" = \"$name\"; then\n-          already_handled=yes\n-          break\n-        fi\n-      done\n-      if test -z \"$already_handled\"; then\n-        names_already_handled=\"$names_already_handled $name\"\n-        dnl See if it was already located by an earlier AC_LIB_LINKFLAGS\n-        dnl or AC_LIB_HAVE_LINKFLAGS call.\n-        uppername=`echo \"$name\" | sed -e 'y|abcdefghijklmnopqrstuvwxyz./-|ABCDEFGHIJKLMNOPQRSTUVWXYZ___|'`\n-        eval value=\\\"\\$HAVE_LIB$uppername\\\"\n-        if test -n \"$value\"; then\n-          if test \"$value\" = yes; then\n-            eval value=\\\"\\$LIB$uppername\\\"\n-            test -z \"$value\" || LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$value\"\n-            eval value=\\\"\\$LTLIB$uppername\\\"\n-            test -z \"$value\" || LTLIB[]NAME=\"${LTLIB[]NAME}${LTLIB[]NAME:+ }$value\"\n-          else\n-            dnl An earlier call to AC_LIB_HAVE_LINKFLAGS has determined\n-            dnl that this library doesn't exist. So just drop it.\n-            :\n-          fi\n-        else\n-          dnl Search the library lib$name in $additional_libdir and $LDFLAGS\n-          dnl and the already constructed $LIBNAME/$LTLIBNAME.\n-          found_dir=\n-          found_la=\n-          found_so=\n-          found_a=\n-          if test $use_additional = yes; then\n-            if test \"X$prefer_shared\" = \"Xyes\" && test -n \"$shlibext\" && test -f \"$additional_libdir/lib$name.$shlibext\"; then\n-              found_dir=\"$additional_libdir\"\n-              found_so=\"$additional_libdir/lib$name.$shlibext\"\n-              if test -f \"$additional_libdir/lib$name.la\"; then\n-                found_la=\"$additional_libdir/lib$name.la\"\n-              fi\n-            else\n-              if test -f \"$additional_libdir/lib$name.$libext\"; then\n-                found_dir=\"$additional_libdir\"\n-                found_a=\"$additional_libdir/lib$name.$libext\"\n-                if test -f \"$additional_libdir/lib$name.la\"; then\n-                  found_la=\"$additional_libdir/lib$name.la\"\n-                fi\n-              fi\n-            fi\n-          fi\n-          if test \"X$found_dir\" = \"X\"; then\n-            for x in $LDFLAGS $LTLIB[]NAME; do\n-              AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-              case \"$x\" in\n-                -L*)\n-                  dir=`echo \"X$x\" | sed -e 's/^X-L//'`\n-                  if test \"X$prefer_shared\" = \"Xyes\" && test -n \"$shlibext\" && test -f \"$dir/lib$name.$shlibext\"; then\n-                    found_dir=\"$dir\"\n-                    found_so=\"$dir/lib$name.$shlibext\"\n-                    if test -f \"$dir/lib$name.la\"; then\n-                      found_la=\"$dir/lib$name.la\"\n-                    fi\n-                  else\n-                    if test -f \"$dir/lib$name.$libext\"; then\n-                      found_dir=\"$dir\"\n-                      found_a=\"$dir/lib$name.$libext\"\n-                      if test -f \"$dir/lib$name.la\"; then\n-                        found_la=\"$dir/lib$name.la\"\n-                      fi\n-                    fi\n-                  fi\n-                  ;;\n-              esac\n-              if test \"X$found_dir\" != \"X\"; then\n-                break\n-              fi\n-            done\n-          fi\n-          if test \"X$found_dir\" != \"X\"; then\n-            dnl Found the library.\n-            LTLIB[]NAME=\"${LTLIB[]NAME}${LTLIB[]NAME:+ }-L$found_dir -l$name\"\n-            if test \"X$found_so\" != \"X\"; then\n-              dnl Linking with a shared library. We attempt to hardcode its\n-              dnl directory into the executable's runpath, unless it's the\n-              dnl standard /usr/lib.\n-              if test \"$enable_rpath\" = no || test \"X$found_dir\" = \"X/usr/lib\"; then\n-                dnl No hardcoding is needed.\n-                LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$found_so\"\n-              else\n-                dnl Use an explicit option to hardcode DIR into the resulting\n-                dnl binary.\n-                dnl Potentially add DIR to ltrpathdirs.\n-                dnl The ltrpathdirs will be appended to $LTLIBNAME at the end.\n-                haveit=\n-                for x in $ltrpathdirs; do\n-                  if test \"X$x\" = \"X$found_dir\"; then\n-                    haveit=yes\n-                    break\n-                  fi\n-                done\n-                if test -z \"$haveit\"; then\n-                  ltrpathdirs=\"$ltrpathdirs $found_dir\"\n-                fi\n-                dnl The hardcoding into $LIBNAME is system dependent.\n-                if test \"$hardcode_direct\" = yes; then\n-                  dnl Using DIR/libNAME.so during linking hardcodes DIR into the\n-                  dnl resulting binary.\n-                  LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$found_so\"\n-                else\n-                  if test -n \"$hardcode_libdir_flag_spec\" && test \"$hardcode_minus_L\" = no; then\n-                    dnl Use an explicit option to hardcode DIR into the resulting\n-                    dnl binary.\n-                    LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$found_so\"\n-                    dnl Potentially add DIR to rpathdirs.\n-                    dnl The rpathdirs will be appended to $LIBNAME at the end.\n-                    haveit=\n-                    for x in $rpathdirs; do\n-                      if test \"X$x\" = \"X$found_dir\"; then\n-                        haveit=yes\n-                        break\n-                      fi\n-                    done\n-                    if test -z \"$haveit\"; then\n-                      rpathdirs=\"$rpathdirs $found_dir\"\n-                    fi\n-                  else\n-                    dnl Rely on \"-L$found_dir\".\n-                    dnl But don't add it if it's already contained in the LDFLAGS\n-                    dnl or the already constructed $LIBNAME\n-                    haveit=\n-                    for x in $LDFLAGS $LIB[]NAME; do\n-                      AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-                      if test \"X$x\" = \"X-L$found_dir\"; then\n-                        haveit=yes\n-                        break\n-                      fi\n-                    done\n-                    if test -z \"$haveit\"; then\n-                      LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }-L$found_dir\"\n-                    fi\n-                    if test \"$hardcode_minus_L\" != no; then\n-                      dnl FIXME: Not sure whether we should use\n-                      dnl \"-L$found_dir -l$name\" or \"-L$found_dir $found_so\"\n-                      dnl here.\n-                      LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$found_so\"\n-                    else\n-                      dnl We cannot use $hardcode_runpath_var and LD_RUN_PATH\n-                      dnl here, because this doesn't fit in flags passed to the\n-                      dnl compiler. So give up. No hardcoding. This affects only\n-                      dnl very old systems.\n-                      dnl FIXME: Not sure whether we should use\n-                      dnl \"-L$found_dir -l$name\" or \"-L$found_dir $found_so\"\n-                      dnl here.\n-                      LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }-l$name\"\n-                    fi\n-                  fi\n-                fi\n-              fi\n-            else\n-              if test \"X$found_a\" != \"X\"; then\n-                dnl Linking with a static library.\n-                LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$found_a\"\n-              else\n-                dnl We shouldn't come here, but anyway it's good to have a\n-                dnl fallback.\n-                LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }-L$found_dir -l$name\"\n-              fi\n-            fi\n-            dnl Assume the include files are nearby.\n-            additional_includedir=\n-            case \"$found_dir\" in\n-              */lib | */lib/)\n-                basedir=`echo \"X$found_dir\" | sed -e 's,^X,,' -e 's,/lib/*$,,'`\n-                additional_includedir=\"$basedir/include\"\n-                ;;\n-            esac\n-            if test \"X$additional_includedir\" != \"X\"; then\n-              dnl Potentially add $additional_includedir to $INCNAME.\n-              dnl But don't add it\n-              dnl   1. if it's the standard /usr/include,\n-              dnl   2. if it's /usr/local/include and we are using GCC on Linux,\n-              dnl   3. if it's already present in $CPPFLAGS or the already\n-              dnl      constructed $INCNAME,\n-              dnl   4. if it doesn't exist as a directory.\n-              if test \"X$additional_includedir\" != \"X/usr/include\"; then\n-                haveit=\n-                if test \"X$additional_includedir\" = \"X/usr/local/include\"; then\n-                  if test -n \"$GCC\"; then\n-                    case $host_os in\n-                      linux*) haveit=yes;;\n-                    esac\n-                  fi\n-                fi\n-                if test -z \"$haveit\"; then\n-                  for x in $CPPFLAGS $INC[]NAME; do\n-                    AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-                    if test \"X$x\" = \"X-I$additional_includedir\"; then\n-                      haveit=yes\n-                      break\n-                    fi\n-                  done\n-                  if test -z \"$haveit\"; then\n-                    if test -d \"$additional_includedir\"; then\n-                      dnl Really add $additional_includedir to $INCNAME.\n-                      INC[]NAME=\"${INC[]NAME}${INC[]NAME:+ }-I$additional_includedir\"\n-                    fi\n-                  fi\n-                fi\n-              fi\n-            fi\n-            dnl Look for dependencies.\n-            if test -n \"$found_la\"; then\n-              dnl Read the .la file. It defines the variables\n-              dnl dlname, library_names, old_library, dependency_libs, current,\n-              dnl age, revision, installed, dlopen, dlpreopen, libdir.\n-              save_libdir=\"$libdir\"\n-              case \"$found_la\" in\n-                */* | *\\\\*) . \"$found_la\" ;;\n-                *) . \"./$found_la\" ;;\n-              esac\n-              libdir=\"$save_libdir\"\n-              dnl We use only dependency_libs.\n-              for dep in $dependency_libs; do\n-                case \"$dep\" in\n-                  -L*)\n-                    additional_libdir=`echo \"X$dep\" | sed -e 's/^X-L//'`\n-                    dnl Potentially add $additional_libdir to $LIBNAME and $LTLIBNAME.\n-                    dnl But don't add it\n-                    dnl   1. if it's the standard /usr/lib,\n-                    dnl   2. if it's /usr/local/lib and we are using GCC on Linux,\n-                    dnl   3. if it's already present in $LDFLAGS or the already\n-                    dnl      constructed $LIBNAME,\n-                    dnl   4. if it doesn't exist as a directory.\n-                    if test \"X$additional_libdir\" != \"X/usr/lib\"; then\n-                      haveit=\n-                      if test \"X$additional_libdir\" = \"X/usr/local/lib\"; then\n-                        if test -n \"$GCC\"; then\n-                          case $host_os in\n-                            linux*) haveit=yes;;\n-                          esac\n-                        fi\n-                      fi\n-                      if test -z \"$haveit\"; then\n-                        haveit=\n-                        for x in $LDFLAGS $LIB[]NAME; do\n-                          AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-                          if test \"X$x\" = \"X-L$additional_libdir\"; then\n-                            haveit=yes\n-                            break\n-                          fi\n-                        done\n-                        if test -z \"$haveit\"; then\n-                          if test -d \"$additional_libdir\"; then\n-                            dnl Really add $additional_libdir to $LIBNAME.\n-                            LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }-L$additional_libdir\"\n-                          fi\n-                        fi\n-                        haveit=\n-                        for x in $LDFLAGS $LTLIB[]NAME; do\n-                          AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-                          if test \"X$x\" = \"X-L$additional_libdir\"; then\n-                            haveit=yes\n-                            break\n-                          fi\n-                        done\n-                        if test -z \"$haveit\"; then\n-                          if test -d \"$additional_libdir\"; then\n-                            dnl Really add $additional_libdir to $LTLIBNAME.\n-                            LTLIB[]NAME=\"${LTLIB[]NAME}${LTLIB[]NAME:+ }-L$additional_libdir\"\n-                          fi\n-                        fi\n-                      fi\n-                    fi\n-                    ;;\n-                  -R*)\n-                    dir=`echo \"X$dep\" | sed -e 's/^X-R//'`\n-                    if test \"$enable_rpath\" != no; then\n-                      dnl Potentially add DIR to rpathdirs.\n-                      dnl The rpathdirs will be appended to $LIBNAME at the end.\n-                      haveit=\n-                      for x in $rpathdirs; do\n-                        if test \"X$x\" = \"X$dir\"; then\n-                          haveit=yes\n-                          break\n-                        fi\n-                      done\n-                      if test -z \"$haveit\"; then\n-                        rpathdirs=\"$rpathdirs $dir\"\n-                      fi\n-                      dnl Potentially add DIR to ltrpathdirs.\n-                      dnl The ltrpathdirs will be appended to $LTLIBNAME at the end.\n-                      haveit=\n-                      for x in $ltrpathdirs; do\n-                        if test \"X$x\" = \"X$dir\"; then\n-                          haveit=yes\n-                          break\n-                        fi\n-                      done\n-                      if test -z \"$haveit\"; then\n-                        ltrpathdirs=\"$ltrpathdirs $dir\"\n-                      fi\n-                    fi\n-                    ;;\n-                  -l*)\n-                    dnl Handle this in the next round.\n-                    names_next_round=\"$names_next_round \"`echo \"X$dep\" | sed -e 's/^X-l//'`\n-                    ;;\n-                  *.la)\n-                    dnl Handle this in the next round. Throw away the .la's\n-                    dnl directory; it is already contained in a preceding -L\n-                    dnl option.\n-                    names_next_round=\"$names_next_round \"`echo \"X$dep\" | sed -e 's,^X.*/,,' -e 's,^lib,,' -e 's,\\.la$,,'`\n-                    ;;\n-                  *)\n-                    dnl Most likely an immediate library name.\n-                    LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$dep\"\n-                    LTLIB[]NAME=\"${LTLIB[]NAME}${LTLIB[]NAME:+ }$dep\"\n-                    ;;\n-                esac\n-              done\n-            fi\n-          else\n-            dnl Didn't find the library; assume it is in the system directories\n-            dnl known to the linker and runtime loader. (All the system\n-            dnl directories known to the linker should also be known to the\n-            dnl runtime loader, otherwise the system is severely misconfigured.)\n-            LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }-l$name\"\n-            LTLIB[]NAME=\"${LTLIB[]NAME}${LTLIB[]NAME:+ }-l$name\"\n-          fi\n-        fi\n-      fi\n-    done\n-  done\n-  if test \"X$rpathdirs\" != \"X\"; then\n-    if test -n \"$hardcode_libdir_separator\"; then\n-      dnl Weird platform: only the last -rpath option counts, the user must\n-      dnl pass all path elements in one option. We can arrange that for a\n-      dnl single library, but not when more than one $LIBNAMEs are used.\n-      alldirs=\n-      for found_dir in $rpathdirs; do\n-        alldirs=\"${alldirs}${alldirs:+$hardcode_libdir_separator}$found_dir\"\n-      done\n-      dnl Note: hardcode_libdir_flag_spec uses $libdir and $wl.\n-      acl_save_libdir=\"$libdir\"\n-      libdir=\"$alldirs\"\n-      eval flag=\\\"$hardcode_libdir_flag_spec\\\"\n-      libdir=\"$acl_save_libdir\"\n-      LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$flag\"\n-    else\n-      dnl The -rpath options are cumulative.\n-      for found_dir in $rpathdirs; do\n-        acl_save_libdir=\"$libdir\"\n-        libdir=\"$found_dir\"\n-        eval flag=\\\"$hardcode_libdir_flag_spec\\\"\n-        libdir=\"$acl_save_libdir\"\n-        LIB[]NAME=\"${LIB[]NAME}${LIB[]NAME:+ }$flag\"\n-      done\n-    fi\n-  fi\n-  if test \"X$ltrpathdirs\" != \"X\"; then\n-    dnl When using libtool, the option that works for both libraries and\n-    dnl executables is -R. The -R options are cumulative.\n-    for found_dir in $ltrpathdirs; do\n-      LTLIB[]NAME=\"${LTLIB[]NAME}${LTLIB[]NAME:+ }-R$found_dir\"\n-    done\n-  fi\n-])\n-\n-dnl AC_LIB_APPENDTOVAR(VAR, CONTENTS) appends the elements of CONTENTS to VAR,\n-dnl unless already present in VAR.\n-dnl Works only for CPPFLAGS, not for LIB* variables because that sometimes\n-dnl contains two or three consecutive elements that belong together.\n-AC_DEFUN([AC_LIB_APPENDTOVAR],\n-[\n-  for element in [$2]; do\n-    haveit=\n-    for x in $[$1]; do\n-      AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-      if test \"X$x\" = \"X$element\"; then\n-        haveit=yes\n-        break\n-      fi\n-    done\n-    if test -z \"$haveit\"; then\n-      [$1]=\"${[$1]}${[$1]:+ }$element\"\n-    fi\n-  done\n-])\n-# lib-prefix.m4 serial 2 (gettext-0.12)\n-dnl Copyright (C) 2001-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Bruno Haible.\n-\n-dnl AC_LIB_ARG_WITH is synonymous to AC_ARG_WITH in autoconf-2.13, and\n-dnl similar to AC_ARG_WITH in autoconf 2.52...2.57 except that is doesn't\n-dnl require excessive bracketing.\n-ifdef([AC_HELP_STRING],\n-[AC_DEFUN([AC_LIB_ARG_WITH], [AC_ARG_WITH([$1],[[$2]],[$3],[$4])])],\n-[AC_DEFUN([AC_LIB_ARG_WITH], [AC_ARG_WITH([$1],[$2],[$3],[$4])])])\n-\n-dnl AC_LIB_PREFIX adds to the CPPFLAGS and LDFLAGS the flags that are needed\n-dnl to access previously installed libraries. The basic assumption is that\n-dnl a user will want packages to use other packages he previously installed\n-dnl with the same --prefix option.\n-dnl This macro is not needed if only AC_LIB_LINKFLAGS is used to locate\n-dnl libraries, but is otherwise very convenient.\n-AC_DEFUN([AC_LIB_PREFIX],\n-[\n-  AC_BEFORE([$0], [AC_LIB_LINKFLAGS])\n-  AC_REQUIRE([AC_PROG_CC])\n-  AC_REQUIRE([AC_CANONICAL_HOST])\n-  AC_REQUIRE([AC_LIB_PREPARE_PREFIX])\n-  dnl By default, look in $includedir and $libdir.\n-  use_additional=yes\n-  AC_LIB_WITH_FINAL_PREFIX([\n-    eval additional_includedir=\\\"$includedir\\\"\n-    eval additional_libdir=\\\"$libdir\\\"\n-  ])\n-  AC_LIB_ARG_WITH([lib-prefix],\n-[  --with-lib-prefix[=DIR] search for libraries in DIR/include and DIR/lib\n-  --without-lib-prefix    don't search for libraries in includedir and libdir],\n-[\n-    if test \"X$withval\" = \"Xno\"; then\n-      use_additional=no\n-    else\n-      if test \"X$withval\" = \"X\"; then\n-        AC_LIB_WITH_FINAL_PREFIX([\n-          eval additional_includedir=\\\"$includedir\\\"\n-          eval additional_libdir=\\\"$libdir\\\"\n-        ])\n-      else\n-        additional_includedir=\"$withval/include\"\n-        additional_libdir=\"$withval/lib\"\n-      fi\n-    fi\n-])\n-  if test $use_additional = yes; then\n-    dnl Potentially add $additional_includedir to $CPPFLAGS.\n-    dnl But don't add it\n-    dnl   1. if it's the standard /usr/include,\n-    dnl   2. if it's already present in $CPPFLAGS,\n-    dnl   3. if it's /usr/local/include and we are using GCC on Linux,\n-    dnl   4. if it doesn't exist as a directory.\n-    if test \"X$additional_includedir\" != \"X/usr/include\"; then\n-      haveit=\n-      for x in $CPPFLAGS; do\n-        AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-        if test \"X$x\" = \"X-I$additional_includedir\"; then\n-          haveit=yes\n-          break\n-        fi\n-      done\n-      if test -z \"$haveit\"; then\n-        if test \"X$additional_includedir\" = \"X/usr/local/include\"; then\n-          if test -n \"$GCC\"; then\n-            case $host_os in\n-              linux*) haveit=yes;;\n-            esac\n-          fi\n-        fi\n-        if test -z \"$haveit\"; then\n-          if test -d \"$additional_includedir\"; then\n-            dnl Really add $additional_includedir to $CPPFLAGS.\n-            CPPFLAGS=\"${CPPFLAGS}${CPPFLAGS:+ }-I$additional_includedir\"\n-          fi\n-        fi\n-      fi\n-    fi\n-    dnl Potentially add $additional_libdir to $LDFLAGS.\n-    dnl But don't add it\n-    dnl   1. if it's the standard /usr/lib,\n-    dnl   2. if it's already present in $LDFLAGS,\n-    dnl   3. if it's /usr/local/lib and we are using GCC on Linux,\n-    dnl   4. if it doesn't exist as a directory.\n-    if test \"X$additional_libdir\" != \"X/usr/lib\"; then\n-      haveit=\n-      for x in $LDFLAGS; do\n-        AC_LIB_WITH_FINAL_PREFIX([eval x=\\\"$x\\\"])\n-        if test \"X$x\" = \"X-L$additional_libdir\"; then\n-          haveit=yes\n-          break\n-        fi\n-      done\n-      if test -z \"$haveit\"; then\n-        if test \"X$additional_libdir\" = \"X/usr/local/lib\"; then\n-          if test -n \"$GCC\"; then\n-            case $host_os in\n-              linux*) haveit=yes;;\n-            esac\n-          fi\n-        fi\n-        if test -z \"$haveit\"; then\n-          if test -d \"$additional_libdir\"; then\n-            dnl Really add $additional_libdir to $LDFLAGS.\n-            LDFLAGS=\"${LDFLAGS}${LDFLAGS:+ }-L$additional_libdir\"\n-          fi\n-        fi\n-      fi\n-    fi\n-  fi\n-])\n-\n-dnl AC_LIB_PREPARE_PREFIX creates variables acl_final_prefix,\n-dnl acl_final_exec_prefix, containing the values to which $prefix and\n-dnl $exec_prefix will expand at the end of the configure script.\n-AC_DEFUN([AC_LIB_PREPARE_PREFIX],\n-[\n-  dnl Unfortunately, prefix and exec_prefix get only finally determined\n-  dnl at the end of configure.\n-  if test \"X$prefix\" = \"XNONE\"; then\n-    acl_final_prefix=\"$ac_default_prefix\"\n-  else\n-    acl_final_prefix=\"$prefix\"\n-  fi\n-  if test \"X$exec_prefix\" = \"XNONE\"; then\n-    acl_final_exec_prefix='${prefix}'\n-  else\n-    acl_final_exec_prefix=\"$exec_prefix\"\n-  fi\n-  acl_save_prefix=\"$prefix\"\n-  prefix=\"$acl_final_prefix\"\n-  eval acl_final_exec_prefix=\\\"$acl_final_exec_prefix\\\"\n-  prefix=\"$acl_save_prefix\"\n-])\n-\n-dnl AC_LIB_WITH_FINAL_PREFIX([statement]) evaluates statement, with the\n-dnl variables prefix and exec_prefix bound to the values they will have\n-dnl at the end of the configure script.\n-AC_DEFUN([AC_LIB_WITH_FINAL_PREFIX],\n-[\n-  acl_save_prefix=\"$prefix\"\n-  prefix=\"$acl_final_prefix\"\n-  acl_save_exec_prefix=\"$exec_prefix\"\n-  exec_prefix=\"$acl_final_exec_prefix\"\n-  $1\n-  exec_prefix=\"$acl_save_exec_prefix\"\n-  prefix=\"$acl_save_prefix\"\n-])\n-# nls.m4 serial 1 (gettext-0.12)\n-dnl Copyright (C) 1995-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-dnl\n-dnl This file can can be used in projects which are not available under\n-dnl the GNU General Public License or the GNU Library General Public\n-dnl License but which still want to provide support for the GNU gettext\n-dnl functionality.\n-dnl Please note that the actual code of the GNU gettext library is covered\n-dnl by the GNU Library General Public License, and the rest of the GNU\n-dnl gettext package package is covered by the GNU General Public License.\n-dnl They are *not* in the public domain.\n-\n-dnl Authors:\n-dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.\n-dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2003.\n-\n-AC_DEFUN([AM_NLS],\n-[\n-  AC_MSG_CHECKING([whether NLS is requested])\n-  dnl Default is enabled NLS\n-  AC_ARG_ENABLE(nls,\n-    [  --disable-nls           do not use Native Language Support],\n-    USE_NLS=$enableval, USE_NLS=yes)\n-  AC_MSG_RESULT($USE_NLS)\n-  AC_SUBST(USE_NLS)\n-])\n-\n-AC_DEFUN([AM_MKINSTALLDIRS],\n-[\n-  dnl If the AC_CONFIG_AUX_DIR macro for autoconf is used we possibly\n-  dnl find the mkinstalldirs script in another subdir but $(top_srcdir).\n-  dnl Try to locate it.\n-  MKINSTALLDIRS=\n-  if test -n \"$ac_aux_dir\"; then\n-    case \"$ac_aux_dir\" in\n-      /*) MKINSTALLDIRS=\"$ac_aux_dir/mkinstalldirs\" ;;\n-      *) MKINSTALLDIRS=\"\\$(top_builddir)/$ac_aux_dir/mkinstalldirs\" ;;\n-    esac\n-  fi\n-  if test -z \"$MKINSTALLDIRS\"; then\n-    MKINSTALLDIRS=\"\\$(top_srcdir)/mkinstalldirs\"\n-  fi\n-  AC_SUBST(MKINSTALLDIRS)\n-])\n-# po.m4 serial 1 (gettext-0.12)\n-dnl Copyright (C) 1995-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-dnl\n-dnl This file can can be used in projects which are not available under\n-dnl the GNU General Public License or the GNU Library General Public\n-dnl License but which still want to provide support for the GNU gettext\n-dnl functionality.\n-dnl Please note that the actual code of the GNU gettext library is covered\n-dnl by the GNU Library General Public License, and the rest of the GNU\n-dnl gettext package package is covered by the GNU General Public License.\n-dnl They are *not* in the public domain.\n-\n-dnl Authors:\n-dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.\n-dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2003.\n-\n-dnl Checks for all prerequisites of the po subdirectory.\n-AC_DEFUN([AM_PO_SUBDIRS],\n-[\n-  AC_REQUIRE([AC_PROG_MAKE_SET])dnl\n-  AC_REQUIRE([AC_PROG_INSTALL])dnl\n-  AC_REQUIRE([AM_MKINSTALLDIRS])dnl\n-  AC_REQUIRE([AM_NLS])dnl\n-\n-  dnl Perform the following tests also if --disable-nls has been given,\n-  dnl because they are needed for \"make dist\" to work.\n-\n-  dnl Search for GNU msgfmt in the PATH.\n-  dnl The first test excludes Solaris msgfmt and early GNU msgfmt versions.\n-  dnl The second test excludes FreeBSD msgfmt.\n-  AM_PATH_PROG_WITH_TEST(MSGFMT, msgfmt,\n-    [$ac_dir/$ac_word --statistics /dev/null >/dev/null 2>&1 &&\n-     (if $ac_dir/$ac_word --statistics /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi)],\n-    :)\n-  AC_PATH_PROG(GMSGFMT, gmsgfmt, $MSGFMT)\n-\n-  dnl Search for GNU xgettext 0.12 or newer in the PATH.\n-  dnl The first test excludes Solaris xgettext and early GNU xgettext versions.\n-  dnl The second test excludes FreeBSD xgettext.\n-  AM_PATH_PROG_WITH_TEST(XGETTEXT, xgettext,\n-    [$ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >/dev/null 2>&1 &&\n-     (if $ac_dir/$ac_word --omit-header --copyright-holder= --msgid-bugs-address= /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi)],\n-    :)\n-  dnl Remove leftover from FreeBSD xgettext call.\n-  rm -f messages.po\n-\n-  dnl Search for GNU msgmerge 0.11 or newer in the PATH.\n-  AM_PATH_PROG_WITH_TEST(MSGMERGE, msgmerge,\n-    [$ac_dir/$ac_word --update -q /dev/null /dev/null >/dev/null 2>&1], :)\n-\n-  dnl This could go away some day; the PATH_PROG_WITH_TEST already does it.\n-  dnl Test whether we really found GNU msgfmt.\n-  if test \"$GMSGFMT\" != \":\"; then\n-    dnl If it is no GNU msgfmt we define it as : so that the\n-    dnl Makefiles still can work.\n-    if $GMSGFMT --statistics /dev/null >/dev/null 2>&1 &&\n-       (if $GMSGFMT --statistics /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then\n-      : ;\n-    else\n-      GMSGFMT=`echo \"$GMSGFMT\" | sed -e 's,^.*/,,'`\n-      AC_MSG_RESULT(\n-        [found $GMSGFMT program is not GNU msgfmt; ignore it])\n-      GMSGFMT=\":\"\n-    fi\n-  fi\n-\n-  dnl This could go away some day; the PATH_PROG_WITH_TEST already does it.\n-  dnl Test whether we really found GNU xgettext.\n-  if test \"$XGETTEXT\" != \":\"; then\n-    dnl If it is no GNU xgettext we define it as : so that the\n-    dnl Makefiles still can work.\n-    if $XGETTEXT --omit-header --copyright-holder= --msgid-bugs-address= /dev/null >/dev/null 2>&1 &&\n-       (if $XGETTEXT --omit-header --copyright-holder= --msgid-bugs-address= /dev/null 2>&1 >/dev/null | grep usage >/dev/null; then exit 1; else exit 0; fi); then\n-      : ;\n-    else\n-      AC_MSG_RESULT(\n-        [found xgettext program is not GNU xgettext; ignore it])\n-      XGETTEXT=\":\"\n-    fi\n-    dnl Remove leftover from FreeBSD xgettext call.\n-    rm -f messages.po\n-  fi\n-\n-  AC_OUTPUT_COMMANDS([\n-    for ac_file in $CONFIG_FILES; do\n-      # Support \"outfile[:infile[:infile...]]\"\n-      case \"$ac_file\" in\n-        *:*) ac_file=`echo \"$ac_file\"|sed 's%:.*%%'` ;;\n-      esac\n-      # PO directories have a Makefile.in generated from Makefile.in.in.\n-      case \"$ac_file\" in */Makefile.in)\n-        # Adjust a relative srcdir.\n-        ac_dir=`echo \"$ac_file\"|sed 's%/[^/][^/]*$%%'`\n-        ac_dir_suffix=\"/`echo \"$ac_dir\"|sed 's%^\\./%%'`\"\n-        ac_dots=`echo \"$ac_dir_suffix\"|sed 's%/[^/]*%../%g'`\n-        # In autoconf-2.13 it is called $ac_given_srcdir.\n-        # In autoconf-2.50 it is called $srcdir.\n-        test -n \"$ac_given_srcdir\" || ac_given_srcdir=\"$srcdir\"\n-        case \"$ac_given_srcdir\" in\n-          .)  top_srcdir=`echo $ac_dots|sed 's%/$%%'` ;;\n-          /*) top_srcdir=\"$ac_given_srcdir\" ;;\n-          *)  top_srcdir=\"$ac_dots$ac_given_srcdir\" ;;\n-        esac\n-        if test -f \"$ac_given_srcdir/$ac_dir/POTFILES.in\"; then\n-          rm -f \"$ac_dir/POTFILES\"\n-          test -n \"$as_me\" && echo \"$as_me: creating $ac_dir/POTFILES\" || echo \"creating $ac_dir/POTFILES\"\n-          cat \"$ac_given_srcdir/$ac_dir/POTFILES.in\" | sed -e \"/^#/d\" -e \"/^[ \t]*\\$/d\" -e \"s,.*,     $top_srcdir/& \\\\\\\\,\" | sed -e \"\\$s/\\(.*\\) \\\\\\\\/\\1/\" > \"$ac_dir/POTFILES\"\n-          POMAKEFILEDEPS=\"POTFILES.in\"\n-          # ALL_LINGUAS, POFILES, GMOFILES, UPDATEPOFILES, DUMMYPOFILES depend\n-          # on $ac_dir but don't depend on user-specified configuration\n-          # parameters.\n-          if test -f \"$ac_given_srcdir/$ac_dir/LINGUAS\"; then\n-            # The LINGUAS file contains the set of available languages.\n-            if test -n \"$OBSOLETE_ALL_LINGUAS\"; then\n-              test -n \"$as_me\" && echo \"$as_me: setting ALL_LINGUAS in configure.in is obsolete\" || echo \"setting ALL_LINGUAS in configure.in is obsolete\"\n-            fi\n-            ALL_LINGUAS_=`sed -e \"/^#/d\" \"$ac_given_srcdir/$ac_dir/LINGUAS\"`\n-            # Hide the ALL_LINGUAS assigment from automake.\n-            eval 'ALL_LINGUAS''=$ALL_LINGUAS_'\n-            POMAKEFILEDEPS=\"$POMAKEFILEDEPS LINGUAS\"\n-          else\n-            # The set of available languages was given in configure.in.\n-            eval 'ALL_LINGUAS''=$OBSOLETE_ALL_LINGUAS'\n-          fi\n-          case \"$ac_given_srcdir\" in\n-            .) srcdirpre= ;;\n-            *) srcdirpre='$(srcdir)/' ;;\n-          esac\n-          POFILES=\n-          GMOFILES=\n-          UPDATEPOFILES=\n-          DUMMYPOFILES=\n-          for lang in $ALL_LINGUAS; do\n-            POFILES=\"$POFILES $srcdirpre$lang.po\"\n-            GMOFILES=\"$GMOFILES $srcdirpre$lang.gmo\"\n-            UPDATEPOFILES=\"$UPDATEPOFILES $lang.po-update\"\n-            DUMMYPOFILES=\"$DUMMYPOFILES $lang.nop\"\n-          done\n-          # CATALOGS depends on both $ac_dir and the user's LINGUAS\n-          # environment variable.\n-          INST_LINGUAS=\n-          if test -n \"$ALL_LINGUAS\"; then\n-            for presentlang in $ALL_LINGUAS; do\n-              useit=no\n-              if test \"%UNSET%\" != \"$LINGUAS\"; then\n-                desiredlanguages=\"$LINGUAS\"\n-              else\n-                desiredlanguages=\"$ALL_LINGUAS\"\n-              fi\n-              for desiredlang in $desiredlanguages; do\n-                # Use the presentlang catalog if desiredlang is\n-                #   a. equal to presentlang, or\n-                #   b. a variant of presentlang (because in this case,\n-                #      presentlang can be used as a fallback for messages\n-                #      which are not translated in the desiredlang catalog).\n-                case \"$desiredlang\" in\n-                  \"$presentlang\"*) useit=yes;;\n-                esac\n-              done\n-              if test $useit = yes; then\n-                INST_LINGUAS=\"$INST_LINGUAS $presentlang\"\n-              fi\n-            done\n-          fi\n-          CATALOGS=\n-          if test -n \"$INST_LINGUAS\"; then\n-            for lang in $INST_LINGUAS; do\n-              CATALOGS=\"$CATALOGS $lang.gmo\"\n-            done\n-          fi\n-          test -n \"$as_me\" && echo \"$as_me: creating $ac_dir/Makefile\" || echo \"creating $ac_dir/Makefile\"\n-          sed -e \"/^POTFILES =/r $ac_dir/POTFILES\" -e \"/^# Makevars/r $ac_given_srcdir/$ac_dir/Makevars\" -e \"s|@POFILES@|$POFILES|g\" -e \"s|@GMOFILES@|$GMOFILES|g\" -e \"s|@UPDATEPOFILES@|$UPDATEPOFILES|g\" -e \"s|@DUMMYPOFILES@|$DUMMYPOFILES|g\" -e \"s|@CATALOGS@|$CATALOGS|g\" -e \"s|@POMAKEFILEDEPS@|$POMAKEFILEDEPS|g\" \"$ac_dir/Makefile.in\" > \"$ac_dir/Makefile\"\n-          for f in \"$ac_given_srcdir/$ac_dir\"/Rules-*; do\n-            if test -f \"$f\"; then\n-              case \"$f\" in\n-                *.orig | *.bak | *~) ;;\n-                *) cat \"$f\" >> \"$ac_dir/Makefile\" ;;\n-              esac\n-            fi\n-          done\n-        fi\n-        ;;\n-      esac\n-    done],\n-   [# Capture the value of obsolete ALL_LINGUAS because we need it to compute\n-    # POFILES, GMOFILES, UPDATEPOFILES, DUMMYPOFILES, CATALOGS. But hide it\n-    # from automake.\n-    eval 'OBSOLETE_ALL_LINGUAS''=\"$ALL_LINGUAS\"'\n-    # Capture the value of LINGUAS because we need it to compute CATALOGS.\n-    LINGUAS=\"${LINGUAS-%UNSET%}\"\n-   ])\n-])\n-# progtest.m4 serial 3 (gettext-0.12)\n-dnl Copyright (C) 1996-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-dnl\n-dnl This file can can be used in projects which are not available under\n-dnl the GNU General Public License or the GNU Library General Public\n-dnl License but which still want to provide support for the GNU gettext\n-dnl functionality.\n-dnl Please note that the actual code of the GNU gettext library is covered\n-dnl by the GNU Library General Public License, and the rest of the GNU\n-dnl gettext package package is covered by the GNU General Public License.\n-dnl They are *not* in the public domain.\n-\n-dnl Authors:\n-dnl   Ulrich Drepper <drepper@cygnus.com>, 1996.\n-\n-# Search path for a program which passes the given test.\n-\n-dnl AM_PATH_PROG_WITH_TEST(VARIABLE, PROG-TO-CHECK-FOR,\n-dnl   TEST-PERFORMED-ON-FOUND_PROGRAM [, VALUE-IF-NOT-FOUND [, PATH]])\n-AC_DEFUN([AM_PATH_PROG_WITH_TEST],\n-[\n-# Prepare PATH_SEPARATOR.\n-# The user is always right.\n-if test \"${PATH_SEPARATOR+set}\" != set; then\n-  echo \"#! /bin/sh\" >conf$$.sh\n-  echo  \"exit 0\"   >>conf$$.sh\n-  chmod +x conf$$.sh\n-  if (PATH=\"/nonexistent;.\"; conf$$.sh) >/dev/null 2>&1; then\n-    PATH_SEPARATOR=';'\n-  else\n-    PATH_SEPARATOR=:\n-  fi\n-  rm -f conf$$.sh\n-fi\n-\n-# Find out how to test for executable files. Don't use a zero-byte file,\n-# as systems may use methods other than mode bits to determine executability.\n-cat >conf$$.file <<_ASEOF\n-#! /bin/sh\n-exit 0\n-_ASEOF\n-chmod +x conf$$.file\n-if test -x conf$$.file >/dev/null 2>&1; then\n-  ac_executable_p=\"test -x\"\n-else\n-  ac_executable_p=\"test -f\"\n-fi\n-rm -f conf$$.file\n-\n-# Extract the first word of \"$2\", so it can be a program name with args.\n-set dummy $2; ac_word=[$]2\n-AC_MSG_CHECKING([for $ac_word])\n-AC_CACHE_VAL(ac_cv_path_$1,\n-[case \"[$]$1\" in\n-  [[\\\\/]]* | ?:[[\\\\/]]*)\n-    ac_cv_path_$1=\"[$]$1\" # Let the user override the test with a path.\n-    ;;\n-  *)\n-    ac_save_IFS=\"$IFS\"; IFS=$PATH_SEPARATOR\n-    for ac_dir in ifelse([$5], , $PATH, [$5]); do\n-      IFS=\"$ac_save_IFS\"\n-      test -z \"$ac_dir\" && ac_dir=.\n-      for ac_exec_ext in '' $ac_executable_extensions; do\n-        if $ac_executable_p \"$ac_dir/$ac_word$ac_exec_ext\"; then\n-          if [$3]; then\n-            ac_cv_path_$1=\"$ac_dir/$ac_word$ac_exec_ext\"\n-            break 2\n-          fi\n-        fi\n-      done\n-    done\n-    IFS=\"$ac_save_IFS\"\n-dnl If no 4th arg is given, leave the cache variable unset,\n-dnl so AC_PATH_PROGS will keep looking.\n-ifelse([$4], , , [  test -z \"[$]ac_cv_path_$1\" && ac_cv_path_$1=\"$4\"\n-])dnl\n-    ;;\n-esac])dnl\n-$1=\"$ac_cv_path_$1\"\n-if test ifelse([$4], , [-n \"[$]$1\"], [\"[$]$1\" != \"$4\"]); then\n-  AC_MSG_RESULT([$]$1)\n-else\n-  AC_MSG_RESULT(no)\n-fi\n-AC_SUBST($1)dnl\n-])\n-# stdint_h.m4 serial 3 (gettext-0.12)\n-dnl Copyright (C) 1997-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Paul Eggert.\n-\n-# Define HAVE_STDINT_H_WITH_UINTMAX if <stdint.h> exists,\n-# doesn't clash with <sys/types.h>, and declares uintmax_t.\n-\n-AC_DEFUN([jm_AC_HEADER_STDINT_H],\n-[\n-  AC_CACHE_CHECK([for stdint.h], jm_ac_cv_header_stdint_h,\n-  [AC_TRY_COMPILE(\n-    [#include <sys/types.h>\n-#include <stdint.h>],\n-    [uintmax_t i = (uintmax_t) -1;],\n-    jm_ac_cv_header_stdint_h=yes,\n-    jm_ac_cv_header_stdint_h=no)])\n-  if test $jm_ac_cv_header_stdint_h = yes; then\n-    AC_DEFINE_UNQUOTED(HAVE_STDINT_H_WITH_UINTMAX, 1,\n-      [Define if <stdint.h> exists, doesn't clash with <sys/types.h>,\n-       and declares uintmax_t. ])\n-  fi\n-])\n-# uintmax_t.m4 serial 7 (gettext-0.12)\n-dnl Copyright (C) 1997-2003 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Paul Eggert.\n-\n-AC_PREREQ(2.13)\n-\n-# Define uintmax_t to 'unsigned long' or 'unsigned long long'\n-# if it is not already defined in <stdint.h> or <inttypes.h>.\n-\n-AC_DEFUN([jm_AC_TYPE_UINTMAX_T],\n-[\n-  AC_REQUIRE([jm_AC_HEADER_INTTYPES_H])\n-  AC_REQUIRE([jm_AC_HEADER_STDINT_H])\n-  if test $jm_ac_cv_header_inttypes_h = no && test $jm_ac_cv_header_stdint_h = no; then\n-    AC_REQUIRE([jm_AC_TYPE_UNSIGNED_LONG_LONG])\n-    test $ac_cv_type_unsigned_long_long = yes \\\n-      && ac_type='unsigned long long' \\\n-      || ac_type='unsigned long'\n-    AC_DEFINE_UNQUOTED(uintmax_t, $ac_type,\n-      [Define to unsigned long or unsigned long long\n-       if <stdint.h> and <inttypes.h> don't define.])\n-  else\n-    AC_DEFINE(HAVE_UINTMAX_T, 1,\n-      [Define if you have the 'uintmax_t' type in <stdint.h> or <inttypes.h>.])\n-  fi\n-])\n-# ulonglong.m4 serial 2 (fileutils-4.0.32, gettext-0.10.40)\n-dnl Copyright (C) 1999-2002 Free Software Foundation, Inc.\n-dnl This file is free software, distributed under the terms of the GNU\n-dnl General Public License.  As a special exception to the GNU General\n-dnl Public License, this file may be distributed as part of a program\n-dnl that contains a configuration script generated by Autoconf, under\n-dnl the same distribution terms as the rest of that program.\n-\n-dnl From Paul Eggert.\n-\n-AC_DEFUN([jm_AC_TYPE_UNSIGNED_LONG_LONG],\n-[\n-  AC_CACHE_CHECK([for unsigned long long], ac_cv_type_unsigned_long_long,\n-  [AC_TRY_LINK([unsigned long long ull = 1; int i = 63;],\n-    [unsigned long long ullmax = (unsigned long long) -1;\n-     return ull << i | ull >> i | ullmax / ull | ullmax % ull;],\n-    ac_cv_type_unsigned_long_long=yes,\n-    ac_cv_type_unsigned_long_long=no)])\n-  if test $ac_cv_type_unsigned_long_long = yes; then\n-    AC_DEFINE(HAVE_UNSIGNED_LONG_LONG, 1,\n-      [Define if you have the unsigned long long type.])\n-  fi\n-])\n-\n dnl From gnulib\n AC_DEFUN([BASH_FUNC_FPURGE],\n [\n@@ -4068,7 +2099,9 @@ AC_DEFUN([BASH_FUNC_SNPRINTF],\n     AC_CACHE_CHECK([for standard-conformant snprintf], [bash_cv_func_snprintf],\n       [AC_TRY_RUN([\n #include <stdio.h>\n+#include <stdlib.h>\n \n+int\n main()\n {\n   int n;\n@@ -4125,6 +2158,7 @@ foo(format, va_alist)\n   return n;\n }\n \n+int\n main()\n {\n   int n;\n@@ -4154,6 +2188,7 @@ AC_CACHE_VAL(bash_cv_wexitstatus_offset,\n \n #include <sys/wait.h>\n \n+int\n main(c, v)\n      int c;\n      char **v;\n@@ -4172,7 +2207,7 @@ main(c, v)\n     exit (255);\n \n   /* crack s */\n-  for (i = 0; i < (sizeof(s) - 8); i++)\n+  for (i = 0; i < (sizeof(s) * 8); i++)\n     {\n       n = (s >> i) & 0xff;\n       if (n == 42)\n@@ -4195,7 +2230,12 @@ AC_DEFINE_UNQUOTED([WEXITSTATUS_OFFSET], [$bash_cv_wexitstatus_offset], [Offset\n \n AC_DEFUN([BASH_FUNC_SBRK],\n [\n-  AC_CHECK_FUNCS_ONCE([sbrk])\n+  AC_MSG_CHECKING([for sbrk])\n+  AC_CACHE_VAL(ac_cv_func_sbrk,\n+  [AC_TRY_LINK([#include <unistd.h>],\n+  [ void *x = sbrk (4096); ],\n+  ac_cv_func_sbrk=yes, ac_cv_func_sbrk=no)])\n+  AC_MSG_RESULT($ac_cv_func_sbrk)\n   if test X$ac_cv_func_sbrk = Xyes; then\n     AC_CACHE_CHECK([for working sbrk], [bash_cv_func_sbrk],\n       [AC_TRY_RUN([\n@@ -4218,8 +2258,8 @@ main(int c, char **v)\n       ac_cv_func_sbrk=no\n     fi\n   fi\n-  if test $ac_cv_func_sbrk = no; then\n-    AC_DEFINE(HAVE_SBRK, 0,\n+  if test $ac_cv_func_sbrk = yes; then\n+    AC_DEFINE(HAVE_SBRK, 1,\n       [Define if you have a working sbrk function.])\n   fi\n ])\n@@ -4242,7 +2282,7 @@ unsigned char string[4] = { '\\xc3', '\\xa4', '\\0' };\n int\n main (int c, char **v)\n {\n-  setlocale (LC_ALL, \"de_DE.UTF-8\");\n+  setlocale (LC_ALL, \"en_US.UTF-8\");\n   if (fnmatch (pattern, (const char *)string, 0) != FNM_NOMATCH)\n     exit (0);\n   exit (1);"
    },
    {
      "sha": "87596dcec95ad161743c6adf84e25f15ba7401b3",
      "filename": "readline/readline/bind.c",
      "status": "modified",
      "additions": 153,
      "deletions": 103,
      "changes": 256,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/bind.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/bind.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/bind.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* bind.c -- key binding and startup file support for the readline library. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.\n@@ -135,12 +135,13 @@ rl_add_defun (const char *name, rl_command_func_t *function, int key)\n int\n rl_bind_key (int key, rl_command_func_t *function)\n {\n-  char keyseq[3];\n+  char keyseq[4];\n   int l;\n \n-  if (key < 0)\n+  if (key < 0 || key > largest_char)\n     return (key);\n \n+  /* Want to make this a multi-character key sequence with an ESC prefix */\n   if (META_CHAR (key) && _rl_convert_meta_chars_to_ascii)\n     {\n       if (_rl_keymap[ESC].type == ISKMAP)\n@@ -153,24 +154,43 @@ rl_bind_key (int key, rl_command_func_t *function)\n \t  escmap[key].function = function;\n \t  return (0);\n \t}\n-      return (key);\n+\n+      /* Otherwise, let's just let rl_generic_bind handle the key sequence.\n+\t We start it off with ESC here and let the code below add the rest\n+\t of the sequence. */\n+      keyseq[0] = ESC;\n+      l = 1;\n+      key = UNMETA(key);\n+      goto bind_keyseq;\n     }\n \n   /* If it's bound to a function or macro, just overwrite.  Otherwise we have\n      to treat it as a key sequence so rl_generic_bind handles shadow keymaps\n-     for us.  If we are binding '\\' make sure to escape it so it makes it\n-     through the call to rl_translate_keyseq. */\n+     for us.  If we are binding '\\' or \\C-@ (NUL) make sure to escape it so\n+     it makes it through the call to rl_translate_keyseq. */\n   if (_rl_keymap[key].type != ISKMAP)\n     {\n+      if (_rl_keymap[key].type == ISMACR)\n+\txfree ((char *)_rl_keymap[key].function);\n       _rl_keymap[key].type = ISFUNC;\n       _rl_keymap[key].function = function;\n     }\n   else\n     {\n       l = 0;\n+bind_keyseq:\n       if (key == '\\\\')\n-\tkeyseq[l++] = '\\\\';\n-      keyseq[l++] = key;\n+\t{\n+\t  keyseq[l++] = '\\\\';\n+\t  keyseq[l++] = '\\\\';\n+\t}\n+      else if (key == '\\0')\t  \n+\t{\n+\t  keyseq[l++] = '\\\\';\n+\t  keyseq[l++] = '0';\n+\t}\n+      else\n+\tkeyseq[l++] = key;\n       keyseq[l] = '\\0';\n       rl_bind_keyseq (keyseq, function);\n     }\n@@ -242,6 +262,13 @@ rl_unbind_function_in_map (rl_command_func_t *func, Keymap map)\n \t  map[i].function = (rl_command_func_t *)NULL;\n \t  rval = 1;\n \t}\n+      else if (map[i].type == ISKMAP)\t\t/* TAG:readline-8.1 */\n+\t{\n+\t  int r;\n+\t  r = rl_unbind_function_in_map (func, FUNCTION_TO_KEYMAP (map, i));\n+\t  if (r == 1)\n+\t    rval = 1;\n+\t}\n     }\n   return rval;\n }\n@@ -352,7 +379,7 @@ int\n rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n {\n   char *keys;\n-  int keys_len, prevkey;\n+  int keys_len, prevkey, ic;\n   register int i;\n   KEYMAP_ENTRY k;\n   Keymap prevmap;  \n@@ -385,7 +412,6 @@ rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n   for (i = 0; i < keys_len; i++)\n     {\n       unsigned char uc = keys[i];\n-      int ic;\n \n       if (i > 0)\n \tprevkey = ic;\n@@ -397,6 +423,9 @@ rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n \t  return -1;\n         }\n \n+      /* We now rely on rl_translate_keyseq to do this conversion, so this\n+\t check is superfluous. */\n+#if 0\n       if (META_CHAR (ic) && _rl_convert_meta_chars_to_ascii)\n \t{\n \t  ic = UNMETA (ic);\n@@ -406,6 +435,7 @@ rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n \t      map = FUNCTION_TO_KEYMAP (map, ESC);\n \t    }\n \t}\n+#endif\n \n       if ((i + 1) < keys_len)\n \t{\n@@ -439,9 +469,7 @@ rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n \t}\n       else\n \t{\n-\t  if (map[ic].type == ISMACR)\n-\t    xfree ((char *)map[ic].function);\n-\t  else if (map[ic].type == ISKMAP)\n+\t  if (map[ic].type == ISKMAP)\n \t    {\n \t      prevmap = map;\n \t      map = FUNCTION_TO_KEYMAP (map, ic);\n@@ -454,6 +482,8 @@ rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n \t      if (type == ISFUNC && data == 0)\n \t\tdata = (char *)_rl_null_function;\n \t    }\n+\t  if (map[ic].type == ISMACR)\n+\t    xfree ((char *)map[ic].function);\n \n \t  map[ic].function = KEYMAP_TO_FUNCTION (data);\n \t  map[ic].type = type;\n@@ -492,59 +522,38 @@ rl_generic_bind (int type, const char *keyseq, char *data, Keymap map)\n int\n rl_translate_keyseq (const char *seq, char *array, int *len)\n {\n-  register int i, c, l, temp;\n+  register int i, l, temp;\n+  int has_control, has_meta;\n+  unsigned char c;\n \n-  for (i = l = 0; c = seq[i]; i++)\n+  has_control = 0;\n+  has_meta = 0;\n+\n+  /* When there are incomplete prefixes \\C- or \\M- (has_control || has_meta)\n+     without base character at the end of SEQ, they are processed as the\n+     prefixes for '\\0'.\n+  */\n+  for (i = l = 0; (c = seq[i]) || has_control || has_meta; i++)\n     {\n-      if (c == '\\\\')\n+      /* Only backslashes followed by a non-null character are handled\n+\t specially.  Trailing backslash (backslash followed by '\\0') is\n+\t processed as a normal character.\n+      */\n+      if (c == '\\\\' && seq[i + 1] != '\\0')\n \t{\n \t  c = seq[++i];\n \n-\t  if (c == 0)\n+\t  /* Handle \\C- and \\M- prefixes. */\n+\t  if (c == 'C' && seq[i + 1] == '-')\n \t    {\n-\t      array[l++] = '\\\\';\t/* preserve trailing backslash */\n-\t      break;\n+\t      i++;\n+\t      has_control = 1;\n+\t      continue;\n \t    }\n-\n-\t  /* Handle \\C- and \\M- prefixes. */\n-\t  if ((c == 'C' || c == 'M') && seq[i + 1] == '-')\n+\t  else if (c == 'M' && seq[i + 1] == '-')\n \t    {\n-\t      /* Handle special case of backwards define. */\n-\t      if (strncmp (&seq[i], \"C-\\\\M-\", 5) == 0)\n-\t\t{\n-\t\t  array[l++] = ESC;\t/* ESC is meta-prefix */\n-\t\t  i += 5;\n-\t\t  array[l++] = CTRL (_rl_to_upper (seq[i]));\n-\t\t}\n-\t      else if (c == 'M')\n-\t\t{\n-\t\t  i++;\t\t/* seq[i] == '-' */\n-\t\t  /* XXX - obey convert-meta setting */\n-\t\t  if (_rl_convert_meta_chars_to_ascii && _rl_keymap[ESC].type == ISKMAP)\n-\t\t    array[l++] = ESC;\t/* ESC is meta-prefix */\n-\t\t  else if (seq[i+1] == '\\\\' && seq[i+2] == 'C' && seq[i+3] == '-')\n-\t\t    {\n-\t\t      i += 4;\n-\t\t      temp = (seq[i] == '?') ? RUBOUT : CTRL (_rl_to_upper (seq[i]));\n-\t\t      array[l++] = META (temp);\n-\t\t    }\n-\t\t  else\n-\t\t    {\n-\t\t      /* This doesn't yet handle things like \\M-\\a, which may\n-\t\t\t or may not have any reasonable meaning.  You're\n-\t\t\t probably better off using straight octal or hex. */\n-\t\t      i++;\n-\t\t      array[l++] = META (seq[i]);\n-\t\t    }\n-\t\t}\n-\t      else if (c == 'C')\n-\t\t{\n-\t\t  i += 2;\n-\t\t  /* Special hack for C-?... */\n-\t\t  array[l++] = (seq[i] == '?') ? RUBOUT : CTRL (_rl_to_upper (seq[i]));\n-\t\t}\n-\t      if (seq[i] == '\\0')\n-\t\tbreak;\n+\t      i++;\n+\t      has_meta = 1;\n \t      continue;\n \t    }\t      \n \n@@ -555,42 +564,42 @@ rl_translate_keyseq (const char *seq, char *array, int *len)\n \t  switch (c)\n \t    {\n \t    case 'a':\n-\t      array[l++] = '\\007';\n+\t      c = '\\007';\n \t      break;\n \t    case 'b':\n-\t      array[l++] = '\\b';\n+\t      c = '\\b';\n \t      break;\n \t    case 'd':\n-\t      array[l++] = RUBOUT;\t/* readline-specific */\n+\t      c = RUBOUT;\t/* readline-specific */\n \t      break;\n \t    case 'e':\n-\t      array[l++] = ESC;\n+\t      c = ESC;\n \t      break;\n \t    case 'f':\n-\t      array[l++] = '\\f';\n+\t      c = '\\f';\n \t      break;\n \t    case 'n':\n-\t      array[l++] = NEWLINE;\n+\t      c = NEWLINE;\n \t      break;\n \t    case 'r':\n-\t      array[l++] = RETURN;\n+\t      c = RETURN;\n \t      break;\n \t    case 't':\n-\t      array[l++] = TAB;\n+\t      c = TAB;\n \t      break;\n \t    case 'v':\n-\t      array[l++] = 0x0B;\n+\t      c = 0x0B;\n \t      break;\n \t    case '\\\\':\n-\t      array[l++] = '\\\\';\n+\t      c = '\\\\';\n \t      break;\n \t    case '0': case '1': case '2': case '3':\n \t    case '4': case '5': case '6': case '7':\n \t      i++;\n \t      for (temp = 2, c -= '0'; ISOCTAL ((unsigned char)seq[i]) && temp--; i++)\n \t        c = (c * 8) + OCTVALUE (seq[i]);\n \t      i--;\t/* auto-increment in for loop */\n-\t      array[l++] = c & largest_char;\n+\t      c &= largest_char;\n \t      break;\n \t    case 'x':\n \t      i++;\n@@ -599,16 +608,40 @@ rl_translate_keyseq (const char *seq, char *array, int *len)\n \t      if (temp == 2)\n \t        c = 'x';\n \t      i--;\t/* auto-increment in for loop */\n-\t      array[l++] = c & largest_char;\n+\t      c &= largest_char;\n \t      break;\n \t    default:\t/* backslashes before non-special chars just add the char */\n-\t      array[l++] = c;\n+\t      c &= largest_char;\n \t      break;\t/* the backslash is stripped */\n \t    }\n-\t  continue;\n \t}\n \n-      array[l++] = c;\n+      /* Process \\C- and \\M- flags */\n+      if (has_control)\n+\t{\n+\t  /* Special treatment for C-? */\n+\t  c = (c == '?') ? RUBOUT : CTRL (_rl_to_upper (c));\n+\t  has_control = 0;\n+\t}\n+      if (has_meta)\n+\t{\n+\t  c = META (c);\n+\t  has_meta = 0;\n+\t}\n+\n+      /* If convert-meta is turned on, convert a meta char to a key sequence  */\n+      if (META_CHAR (c) && _rl_convert_meta_chars_to_ascii)\n+\t{\n+\t  array[l++] = ESC;\t/* ESC is meta-prefix */\n+\t  array[l++] = UNMETA (c);\n+\t}\n+      else\n+\tarray[l++] = (c);\n+\n+      /* Null characters may be processed for incomplete prefixes at the end of\n+\t sequence */\n+      if (seq[i] == '\\0')\n+\tbreak;\n     }\n \n   *len = l;\n@@ -756,7 +789,7 @@ _rl_untranslate_macro_value (char *seq, int use_escapes)\n \n /* Return a pointer to the function that STRING represents.\n    If STRING doesn't have a matching function, then a NULL pointer\n-   is returned. */\n+   is returned. The string match is case-insensitive. */\n rl_command_func_t *\n rl_named_function (const char *string)\n {\n@@ -809,7 +842,7 @@ _rl_function_of_keyseq_internal (const char *keyseq, size_t len, Keymap map, int\n \t{\n \t  /* If this is the last key in the key sequence, return the\n \t     map. */\n-\t  if (keyseq[i + 1] == '\\0')\n+\t  if (i + 1 == len)\n \t    {\n \t      if (type)\n \t\t*type = ISKMAP;\n@@ -822,9 +855,9 @@ _rl_function_of_keyseq_internal (const char *keyseq, size_t len, Keymap map, int\n       /* If we're not at the end of the key sequence, and the current key\n \t is bound to something other than a keymap, then the entire key\n \t sequence is not bound. */\n-      else if (map[ic].type != ISKMAP && keyseq[i+1])\n+      else if (map[ic].type != ISKMAP && i+1 < len)\n \treturn ((rl_command_func_t *)NULL);\n-      else\t/* map[ic].type != ISKMAP && keyseq[i+1] == 0 */\n+      else\t/* map[ic].type != ISKMAP && i+1 == len */\n \t{\n \t  if (type)\n \t    *type = map[ic].type;\n@@ -1569,15 +1602,11 @@ rl_parse_and_bind (char *string)\n       /* Strip trailing whitespace from values of boolean variables. */\n       if (find_boolean_var (var) >= 0)\n \t{\n-\t  /* remove trailing whitespace */\n-remove_trailing:\n-\t  e = value + strlen (value) - 1;\n-\t  while (e >= value && whitespace (*e))\n-\t    e--;\n-\t  e++;\t\t/* skip back to whitespace or EOS */\n-\t  \n-\t  if (*e && e >= value)\n-\t    *e = '\\0';\n+\t  /* just read a whitespace-delimited word or empty string */\n+\t  for (e = value; *e && whitespace (*e) == 0; e++)\n+\t    ;\n+\t  if (e > value)\n+\t    *e = '\\0';\t\t/* cut off everything trailing */\n \t}\n       else if ((i = find_string_var (var)) >= 0)\n \t{\n@@ -1589,9 +1618,24 @@ rl_parse_and_bind (char *string)\n \t      value++;\t/* skip past the quote */\n \t    }\n \t  else\n-\t    goto remove_trailing;\n+\t    {\n+\t      /* remove trailing whitespace */\n+\t      e = value + strlen (value) - 1;\n+\t      while (e >= value && whitespace (*e))\n+\t\te--;\n+\t      e++;\t\t/* skip back to whitespace or EOS */\n+\t  \n+\t      if (*e && e >= value)\n+\t\t*e = '\\0';\n+\t    }\n \t}\n-\t\n+      else\n+\t{\n+\t  /* avoid calling rl_variable_bind just to find this out */\n+\t  _rl_init_file_error (\"%s: unknown variable name\", var);\n+\t  return 1;\n+\t}\n+\n       rl_variable_bind (var, value);\n       return 0;\n     }\n@@ -1768,7 +1812,7 @@ static const struct {\n   { \"convert-meta\",\t\t&_rl_convert_meta_chars_to_ascii, 0 },\n   { \"disable-completion\",\t&rl_inhibit_completion,\t\t0 },\n   { \"echo-control-characters\",\t&_rl_echo_control_chars,\t0 },\n-  { \"enable-bracketed-paste\",\t&_rl_enable_bracketed_paste,\t0 },\n+  { \"enable-bracketed-paste\",\t&_rl_enable_bracketed_paste,\tV_SPECIAL },\n   { \"enable-keypad\",\t\t&_rl_enable_keypad,\t\t0 },\n   { \"enable-meta-key\",\t\t&_rl_enable_meta,\t\t0 },\n   { \"expand-tilde\",\t\t&rl_complete_with_tilde_expansion, 0 },\n@@ -1834,6 +1878,8 @@ hack_special_boolean_var (int i)\n     }\n   else if (_rl_stricmp (name, \"show-mode-in-prompt\") == 0)\n     _rl_reset_prompt ();\n+  else if (_rl_stricmp (name, \"enable-bracketed-paste\") == 0)\n+    _rl_enable_active_region = _rl_enable_bracketed_paste;\n }\n \n typedef int _rl_sv_func_t PARAMS((const char *));\n@@ -1903,7 +1949,7 @@ string_varname (int i)\n }  \n \n /* A boolean value that can appear in a `set variable' command is true if\n-   the value is null or empty, `on' (case-insensitive), or \"1\".  Any other\n+   the value is null or empty, `on' (case-insensitive), or \"1\".  All other\n    values result in 0 (false). */\n static int\n bool_to_int (const char *value)\n@@ -1928,7 +1974,7 @@ rl_variable_value (const char *name)\n     return (_rl_get_string_variable_value (string_varlist[i].name));\n \n   /* Unknown variable names return NULL. */\n-  return 0;\n+  return (char *)NULL;\n }\n \n int\n@@ -1959,6 +2005,8 @@ rl_variable_bind (const char *name, const char *value)\n     }\n \n   v = (*string_varlist[i].set_func) (value);\n+  if (v != 0)\n+    _rl_init_file_error (\"%s: could not set value to `%s'\", name, value);\n   return v;\n }\n \n@@ -2581,20 +2629,22 @@ rl_invoking_keyseqs_in_map (rl_command_func_t *function, Keymap map)\n \t\t    else\n \t\t      sprintf (keyname, \"\\\\e\");\n \t\t  }\n-\t\telse if (CTRL_CHAR (key))\n-\t\t  sprintf (keyname, \"\\\\C-%c\", _rl_to_lower (UNCTRL (key)));\n-\t\telse if (key == RUBOUT)\n-\t\t  sprintf (keyname, \"\\\\C-?\");\n-\t\telse if (key == '\\\\' || key == '\"')\n-\t\t  {\n-\t\t    keyname[0] = '\\\\';\n-\t\t    keyname[1] = (char) key;\n-\t\t    keyname[2] = '\\0';\n-\t\t  }\n \t\telse\n \t\t  {\n-\t\t    keyname[0] = (char) key;\n-\t\t    keyname[1] = '\\0';\n+\t\t    int c = key, l = 0;\n+\t\t    if (CTRL_CHAR (c) || c == RUBOUT)\n+\t\t      {\n+\t\t\tkeyname[l++] = '\\\\';\n+\t\t\tkeyname[l++] = 'C';\n+\t\t\tkeyname[l++] = '-';\n+\t\t\tc = (c == RUBOUT) ? '?' : _rl_to_lower (UNCTRL (c));\n+\t\t      }\n+\n+\t\t    if (c == '\\\\' || c == '\"')\n+\t\t      keyname[l++] = '\\\\';\n+\n+\t\t    keyname[l++] = (char) c;\n+\t\t    keyname[l++] = '\\0';\n \t\t  }\n \t\t\n \t\tstrcat (keyname, seqs[i]);"
    },
    {
      "sha": "9e37527ef3509ce4ae33094fd26d67831c9551ce",
      "filename": "readline/readline/colors.c",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/colors.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/colors.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/colors.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -2,7 +2,7 @@\n \n    Modified by Chet Ramey for Readline.\n \n-   Copyright (C) 1985, 1988, 1990-1991, 1995-2010, 2012, 2015, 2017\n+   Copyright (C) 1985, 1988, 1990-1991, 1995-2010, 2012, 2015, 2017, 2019\n    Free Software Foundation, Inc.\n \n    This program is free software: you can redistribute it and/or modify\n@@ -32,6 +32,13 @@\n \n #include \"rlconf.h\"\n \n+#if defined __TANDEM\n+#  define _XOPEN_SOURCE_EXTENDED 1\n+#  define _TANDEM_SOURCE 1\n+#  include <sys/types.h>\n+#  include <sys/stat.h>\n+#endif\n+\n #include <stdio.h>\n \n #include \"posixstat.h\" // stat related macros (S_ISREG, ...)"
    },
    {
      "sha": "fc5c3adb3564d6408214f74a0a3e64a0f0437cd4",
      "filename": "readline/readline/complete.c",
      "status": "modified",
      "additions": 68,
      "deletions": 36,
      "changes": 104,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/complete.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/complete.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/complete.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* complete.c -- filename completion for readline. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.\n@@ -21,11 +21,18 @@\n \n #define READLINE_LIBRARY\n \n+#if defined (__TANDEM)\n+#  define _XOPEN_SOURCE_EXTENDED 1\n+#endif\n+\n #if defined (HAVE_CONFIG_H)\n #  include <config.h>\n #endif\n \n #include <sys/types.h>\n+#if defined (__TANDEM)\n+#  include <sys/stat.h>\n+#endif\n #include <fcntl.h>\n #if defined (HAVE_SYS_FILE_H)\n #  include <sys/file.h>\n@@ -141,6 +148,7 @@ static int complete_fncmp PARAMS((const char *, int, const char *, int));\n static void display_matches PARAMS((char **));\n static int compute_lcd_of_matches PARAMS((char **, int, const char *));\n static int postprocess_matches PARAMS((char ***, int));\n+static int compare_match PARAMS((char *, const char *));\n static int complete_get_screenwidth PARAMS((void));\n \n static char *make_quoted_replacement PARAMS((char *, int, char *));\n@@ -406,6 +414,7 @@ int rl_sort_completion_matches = 1;\n \n /* Local variable states what happened during the last completion attempt. */\n static int completion_changed_buffer;\n+static int last_completion_failed = 0;\n \n /* The result of the query to the user about displaying completion matches */\n static int completion_y_or_n;\n@@ -428,7 +437,11 @@ rl_complete (int ignore, int invoking_key)\n \n   if (rl_inhibit_completion)\n     return (_rl_insert_char (ignore, invoking_key));\n-  else if (rl_last_func == rl_complete && !completion_changed_buffer)\n+#if 0\n+  else if (rl_last_func == rl_complete && completion_changed_buffer == 0 && last_completion_failed == 0)\n+#else\n+  else if (rl_last_func == rl_complete && completion_changed_buffer == 0)\n+#endif\n     return (rl_complete_internal ('?'));\n   else if (_rl_complete_show_all)\n     return (rl_complete_internal ('!'));\n@@ -477,7 +490,7 @@ rl_completion_mode (rl_command_func_t *cfunc)\n /*\t\t\t\t    */\n /************************************/\n \n-/* Reset readline state on a signal or other event. */\n+/* Reset public readline state on a signal or other event. */\n void\n _rl_reset_completion_state (void)\n {\n@@ -1330,12 +1343,13 @@ compute_lcd_of_matches (char **match_list, int matches, const char *text)\n \t  memset (&ps2, 0, sizeof (mbstate_t));\n \t}\n #endif\n-      if (_rl_completion_case_fold)\n+      for (si = 0; (c1 = match_list[i][si]) && (c2 = match_list[i + 1][si]); si++)\n \t{\n-\t  for (si = 0;\n-\t       (c1 = _rl_to_lower(match_list[i][si])) &&\n-\t       (c2 = _rl_to_lower(match_list[i + 1][si]));\n-\t       si++)\n+\t    if (_rl_completion_case_fold)\n+\t      {\n+\t        c1 = _rl_to_lower (c1);\n+\t        c2 = _rl_to_lower (c2);\n+\t      }\n #if defined (HANDLE_MULTIBYTE)\n \t    if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n \t      {\n@@ -1347,35 +1361,17 @@ compute_lcd_of_matches (char **match_list, int matches, const char *text)\n \t\t      break;\n \t\t    continue;\n \t\t  }\n-\t\twc1 = towlower (wc1);\n-\t\twc2 = towlower (wc2);\n+\t\tif (_rl_completion_case_fold)\n+\t\t  {\n+\t\t    wc1 = towlower (wc1);\n+\t\t   wc2 = towlower (wc2);\n+\t\t  }\n \t\tif (wc1 != wc2)\n \t\t  break;\n \t\telse if (v1 > 1)\n \t\t  si += v1 - 1;\n \t      }\n \t    else\n-#endif\n-\t    if (c1 != c2)\n-\t      break;\n-\t}\n-      else\n-\t{\n-\t  for (si = 0;\n-\t       (c1 = match_list[i][si]) &&\n-\t       (c2 = match_list[i + 1][si]);\n-\t       si++)\n-#if defined (HANDLE_MULTIBYTE)\n-\t    if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n-\t      {\n-\t\tmbstate_t ps_back;\n-\t\tps_back = ps1;\n-\t\tif (!_rl_compare_chars (match_list[i], si, &ps1, match_list[i+1], si, &ps2))\n-\t\t  break;\n-\t\telse if ((v = _rl_get_char_len (&match_list[i][si], &ps_back)) > 1)\n-\t\t  si += v - 1;\n-\t      }\n-\t    else\n #endif\n \t    if (c1 != c2)\n \t      break;\n@@ -1969,6 +1965,26 @@ _rl_free_match_list (char **matches)\n   xfree (matches);\n }\n \n+/* Compare a possibly-quoted filename TEXT from the line buffer and a possible\n+   MATCH that is the product of filename completion, which acts on the dequoted\n+   text. */\n+static int\n+compare_match (char *text, const char *match)\n+{\n+  char *temp;\n+  int r;\n+\n+  if (rl_filename_completion_desired && rl_filename_quoting_desired && \n+      rl_completion_found_quote && rl_filename_dequoting_function)\n+    {\n+      temp = (*rl_filename_dequoting_function) (text, rl_completion_quote_character);\n+      r = strcmp (temp, match);\n+      free (temp);\n+      return r;\n+    }      \n+  return (strcmp (text, match));\n+}\n+\n /* Complete the word at or before point.\n    WHAT_TO_DO says what to do with the completion.\n    `?' means list the possible completions.\n@@ -1986,10 +2002,12 @@ rl_complete_internal (int what_to_do)\n   int start, end, delimiter, found_quote, i, nontrivial_lcd;\n   char *text, *saved_line_buffer;\n   char quote_char;\n-  int tlen, mlen;\n+  int tlen, mlen, saved_last_completion_failed;\n \n   RL_SETSTATE(RL_STATE_COMPLETING);\n \n+  saved_last_completion_failed = last_completion_failed;\n+\n   set_completion_defaults (what_to_do);\n \n   saved_line_buffer = rl_line_buffer ? savestring (rl_line_buffer) : (char *)NULL;\n@@ -2013,7 +2031,7 @@ rl_complete_internal (int what_to_do)\n   matches = gen_completion_matches (text, start, end, our_func, found_quote, quote_char);\n   /* nontrivial_lcd is set if the common prefix adds something to the word\n      being completed. */\n-  nontrivial_lcd = matches && strcmp (text, matches[0]) != 0;\n+  nontrivial_lcd = matches && compare_match (text, matches[0]) != 0;\n   if (what_to_do == '!' || what_to_do == '@')\n     tlen = strlen (text);\n   xfree (text);\n@@ -2023,6 +2041,7 @@ rl_complete_internal (int what_to_do)\n       rl_ding ();\n       FREE (saved_line_buffer);\n       completion_changed_buffer = 0;\n+      last_completion_failed = 1;\n       RL_UNSETSTATE(RL_STATE_COMPLETING);\n       _rl_reset_completion_state ();\n       return (0);\n@@ -2038,11 +2057,15 @@ rl_complete_internal (int what_to_do)\n       rl_ding ();\n       FREE (saved_line_buffer);\n       completion_changed_buffer = 0;\n+      last_completion_failed = 1;\n       RL_UNSETSTATE(RL_STATE_COMPLETING);\n       _rl_reset_completion_state ();\n       return (0);\n     }\n \n+  if (matches && matches[0] && *matches[0])\n+    last_completion_failed = 0;\n+\n   switch (what_to_do)\n     {\n     case TAB:\n@@ -2098,6 +2121,15 @@ rl_complete_internal (int what_to_do)\n       break;\n \n     case '?':\n+      /* Let's try to insert a single match here if the last completion failed\n+\t but this attempt returned a single match. */\n+      if (saved_last_completion_failed && matches[0] && *matches[0] && matches[1] == 0)\n+\t{\n+\t  insert_match (matches[0], start, matches[1] ? MULT_MATCH : SINGLE_MATCH, &quote_char);\n+\t  append_to_match (matches[0], delimiter, quote_char, nontrivial_lcd);\n+\t  break;\n+\t}\n+      \n       if (rl_completion_display_matches_hook == 0)\n \t{\n \t  _rl_sigcleanup = _rl_complete_sigcleanup;\n@@ -2761,7 +2793,7 @@ rl_old_menu_complete (int count, int invoking_key)\n     {\n       insert_match (matches[match_list_index], orig_start, SINGLE_MATCH, &quote_char);\n       append_to_match (matches[match_list_index], delimiter, quote_char,\n-\t\t       strcmp (orig_text, matches[match_list_index]));\n+\t\t       compare_match (orig_text, matches[match_list_index]));\n     }\n \n   completion_changed_buffer = 1;\n@@ -2835,7 +2867,7 @@ rl_menu_complete (int count, int ignore)\n       matches = gen_completion_matches (orig_text, orig_start, orig_end,\n \t\t\t\t\tour_func, found_quote, quote_char);\n \n-      nontrivial_lcd = matches && strcmp (orig_text, matches[0]) != 0;\n+      nontrivial_lcd = matches && compare_match (orig_text, matches[0]) != 0;\n \n       /* If we are matching filenames, the attempted completion function will\n \t have set rl_filename_completion_desired to a non-zero value.  The basic\n@@ -2942,7 +2974,7 @@ rl_menu_complete (int count, int ignore)\n     {\n       insert_match (matches[match_list_index], orig_start, SINGLE_MATCH, &quote_char);\n       append_to_match (matches[match_list_index], delimiter, quote_char,\n-\t\t       strcmp (orig_text, matches[match_list_index]));\n+\t\t       compare_match (orig_text, matches[match_list_index]));\n     }\n \n   completion_changed_buffer = 1;"
    },
    {
      "sha": "6ea4545e26f25e8ee923d02a9855f43088b5abc6",
      "filename": "readline/readline/configure",
      "status": "modified",
      "additions": 52,
      "deletions": 14,
      "changes": 66,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/configure?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n #! /bin/sh\n-# From configure.ac for Readline 8.0, version 2.85.\n+# From configure.ac for Readline 8.1, version 2.90.\n # Guess values for system-dependent variables and create Makefiles.\n-# Generated by GNU Autoconf 2.69 for readline 8.0.\n+# Generated by GNU Autoconf 2.69 for readline 8.1.\n #\n # Report bugs to <bug-readline@gnu.org>.\n #\n@@ -581,8 +581,8 @@ MAKEFLAGS=\n # Identity of this package.\n PACKAGE_NAME='readline'\n PACKAGE_TARNAME='readline'\n-PACKAGE_VERSION='8.0'\n-PACKAGE_STRING='readline 8.0'\n+PACKAGE_VERSION='8.1'\n+PACKAGE_STRING='readline 8.1'\n PACKAGE_BUGREPORT='bug-readline@gnu.org'\n PACKAGE_URL=''\n \n@@ -673,6 +673,7 @@ CFLAGS\n CC\n SET_MAKE\n CROSS_COMPILE\n+BRACKETED_PASTE\n host_os\n host_vendor\n host_cpu\n@@ -726,6 +727,7 @@ with_curses\n enable_multibyte\n enable_static\n enable_install_examples\n+enable_bracketed_paste_default\n enable_largefile\n '\n       ac_precious_vars='build_alias\n@@ -1277,7 +1279,7 @@ if test \"$ac_init_help\" = \"long\"; then\n   # Omit some internal or obsolete options to make the list less imposing.\n   # This message is too long to be a string in the A/UX 3.1 sh.\n   cat <<_ACEOF\n-\\`configure' configures readline 8.0 to adapt to many kinds of systems.\n+\\`configure' configures readline 8.1 to adapt to many kinds of systems.\n \n Usage: $0 [OPTION]... [VAR=VALUE]...\n \n@@ -1342,7 +1344,7 @@ fi\n \n if test -n \"$ac_init_help\"; then\n   case $ac_init_help in\n-     short | recursive ) echo \"Configuration of readline 8.0:\";;\n+     short | recursive ) echo \"Configuration of readline 8.1:\";;\n    esac\n   cat <<\\_ACEOF\n \n@@ -1354,6 +1356,9 @@ Optional Features:\n   --enable-static         build static libraries [[default=YES]]\n   --disable-install-examples\n                           don't install examples [[default=install]]\n+  --disable-bracketed-paste-default\n+                          disable bracketed paste by default\n+                          [[default=enable]]\n   --disable-largefile     omit support for large files\n \n Optional Packages:\n@@ -1438,7 +1443,7 @@ fi\n test -n \"$ac_init_help\" && exit $ac_status\n if $ac_init_version; then\n   cat <<\\_ACEOF\n-readline configure 8.0\n+readline configure 8.1\n generated by GNU Autoconf 2.69\n \n Copyright (C) 2012 Free Software Foundation, Inc.\n@@ -2090,7 +2095,7 @@ cat >config.log <<_ACEOF\n This file contains any messages produced by compilers while\n running configure, to aid debugging if configure makes a mistake.\n \n-It was created by readline $as_me 8.0, which was\n+It was created by readline $as_me 8.1, which was\n generated by GNU Autoconf 2.69.  Invocation command line was\n \n   $ $0 $@\n@@ -2477,7 +2482,7 @@ ac_configure=\"$SHELL $ac_aux_dir/configure\"  # Please don't use this var.\n ac_config_headers=\"$ac_config_headers config.h\"\n \n \n-LIBVERSION=8.0\n+LIBVERSION=8.1\n \n # Make sure we can run config.sub.\n $SHELL \"$ac_aux_dir/config.sub\" sun4 >/dev/null 2>&1 ||\n@@ -2569,6 +2574,7 @@ opt_multibyte=yes\n opt_static_libs=yes\n opt_shared_libs=no\n opt_install_examples=no\n+opt_bracketed_paste_default=yes\n \n # Check whether --enable-multibyte was given.\n if test \"${enable_multibyte+set}\" = set; then :\n@@ -2586,11 +2592,24 @@ if test \"${enable_install_examples+set}\" = set; then :\n fi\n \n \n+# Check whether --enable-bracketed-paste-default was given.\n+if test \"${enable_bracketed_paste_default+set}\" = set; then :\n+  enableval=$enable_bracketed_paste_default; opt_bracketed_paste_default=$enableval\n+fi\n+\n+\n if test $opt_multibyte = no; then\n $as_echo \"#define NO_MULTIBYTE_SUPPORT 1\" >>confdefs.h\n \n fi\n \n+if test $opt_bracketed_paste_default = yes; then\n+\tBRACKETED_PASTE='-DBRACKETED_PASTE_DEFAULT=1'\n+else\n+\tBRACKETED_PASTE='-DBRACKETED_PASTE_DEFAULT=0'\n+fi\n+\n+\n \n \n CROSS_COMPILE=\n@@ -2622,7 +2641,7 @@ echo \"Beginning configuration for readline-$LIBVERSION for ${host_cpu}-${host_ve\n echo \"\"\n \n # We want these before the checks, so the checks can modify their values.\n-test -z \"$CFLAGS\" && CFLAGS=-g auto_cflags=1\n+test -z \"$CFLAGS\" && want_auto_cflags=1\n \n { $as_echo \"$as_me:${as_lineno-$LINENO}: checking whether ${MAKE-make} sets \\$(MAKE)\" >&5\n $as_echo_n \"checking whether ${MAKE-make} sets \\$(MAKE)... \" >&6; }\n@@ -3905,8 +3924,11 @@ $as_echo \"$ac_cv_safe_to_define___extensions__\" >&6; }\n \n \n \n-# If we're using gcc and the user hasn't specified CFLAGS, add -O to CFLAGS.\n-test -n \"$GCC\" && test -n \"$auto_cflags\" && CFLAGS=\"$CFLAGS -O\"\n+# If we're using gcc and the user hasn't specified CFLAGS, add -O2 to CFLAGS\n+if test -n \"$want_auto_cflags\" ; then\n+\tAUTO_CFLAGS=\"-g ${GCC+-O2}\"\n+\tSTYLE_CFLAGS=\"${GCC+-Wno-parentheses} ${GCC+-Wno-format-security}\"\n+fi\n \n if test $ac_cv_c_compiler_gnu = yes; then\n     { $as_echo \"$as_me:${as_lineno-$LINENO}: checking whether $CC needs -traditional\" >&5\n@@ -5316,6 +5338,7 @@ else\n #ifdef HAVE_UNISTD_H\n #include <unistd.h>\n #endif\n+#include <stdlib.h>\n \n typedef RETSIGTYPE sigfunc();\n \n@@ -5346,6 +5369,7 @@ int s;\n   nsigint++;\n }\n \n+int\n main()\n {\n \tnsigint = 0;\n@@ -5396,7 +5420,9 @@ else\n #include <sys/types.h>\n #include <signal.h>\n #include <setjmp.h>\n+#include <stdlib.h>\n \n+int\n main()\n {\n #if !defined (_POSIX_VERSION) || !defined (HAVE_POSIX_SIGNALS)\n@@ -5499,7 +5525,10 @@ else\n #if defined (HAVE_LOCALE_H)\n #include <locale.h>\n #endif\n+#include <string.h>\n+#include <stdlib.h>\n \n+int\n main(c, v)\n int     c;\n char    *v[];\n@@ -5569,7 +5598,9 @@ else\n #endif\n #include <stdio.h>\n #include <ctype.h>\n+#include <stdlib.h>\n \n+int\n main(c, v)\n int\tc;\n char\t*v[];\n@@ -6713,6 +6744,7 @@ else\n #include <locale.h>\n #include <wchar.h>\n \n+int\n main(c, v)\n int     c;\n char    **v;\n@@ -6803,6 +6835,7 @@ esac\n \n case \"$host_os\" in\n isc*)\tLOCAL_CFLAGS=-Disc386 ;;\n+hpux*)\tLOCAL_CFLAGS=\"-DTGETENT_BROKEN -DTGETFLAG_BROKEN\" ;;\n esac\n \n # shared library configuration section\n@@ -6883,6 +6916,11 @@ esac\n \n \n \n+if test -n \"$want_auto_cflags\"; then\n+\tCFLAGS=\"$AUTO_CFLAGS\"\n+fi\n+CFLAGS=\"$CFLAGS $STYLE_CFLAGS\"\n+\n \n \n \n@@ -7409,7 +7447,7 @@ cat >>$CONFIG_STATUS <<\\_ACEOF || ac_write_fail=1\n # report actual input values of CONFIG_FILES etc. instead of their\n # values after options handling.\n ac_log=\"\n-This file was extended by readline $as_me 8.0, which was\n+This file was extended by readline $as_me 8.1, which was\n generated by GNU Autoconf 2.69.  Invocation command line was\n \n   CONFIG_FILES    = $CONFIG_FILES\n@@ -7475,7 +7513,7 @@ _ACEOF\n cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1\n ac_cs_config=\"`$as_echo \"$ac_configure_args\" | sed 's/^ //; s/[\\\\\"\"\\`\\$]/\\\\\\\\&/g'`\"\n ac_cs_version=\"\\\\\n-readline config.status 8.0\n+readline config.status 8.1\n configured by $0, generated by GNU Autoconf 2.69,\n   with options \\\\\"\\$ac_cs_config\\\\\"\n "
    },
    {
      "sha": "912c99b65750d43ad975cf3602f00ec65012a00c",
      "filename": "readline/readline/configure.ac",
      "status": "modified",
      "additions": 26,
      "deletions": 7,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/configure.ac?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -5,7 +5,7 @@ dnl report bugs to chet@po.cwru.edu\n dnl\n dnl Process this file with autoconf to produce a configure script.\n \n-# Copyright (C) 1987-2018 Free Software Foundation, Inc.\n+# Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n #   This program is free software: you can redistribute it and/or modify\n #   it under the terms of the GNU General Public License as published by\n@@ -20,11 +20,11 @@ dnl Process this file with autoconf to produce a configure script.\n #   You should have received a copy of the GNU General Public License\n #   along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n-AC_REVISION([for Readline 8.0, version 2.85])\n+AC_REVISION([for Readline 8.1, version 2.90])\n \n m4_include([../../config/override.m4])\n \n-AC_INIT(readline, 8.0, bug-readline@gnu.org)\n+AC_INIT(readline, 8.1, bug-readline@gnu.org)\n \n dnl make sure we are using a recent autoconf version\n AC_PREREQ(2.50)\n@@ -36,7 +36,7 @@ AC_CONFIG_AUX_DIR(../..)\n AC_CONFIG_HEADERS(config.h)\n \n dnl update the value of RL_READLINE_VERSION in readline.h when this changes\n-LIBVERSION=8.0\n+LIBVERSION=8.1\n \n AC_CANONICAL_HOST\n AC_CANONICAL_BUILD\n@@ -56,16 +56,26 @@ opt_multibyte=yes\n opt_static_libs=yes\n opt_shared_libs=no\n opt_install_examples=no\n+opt_bracketed_paste_default=yes\n \n AC_ARG_ENABLE(multibyte, AC_HELP_STRING([--enable-multibyte], [enable multibyte characters if OS supports them]), opt_multibyte=$enableval)\n dnl AC_ARG_ENABLE(shared, AC_HELP_STRING([--enable-shared], [build shared libraries [[default=YES]]]), opt_shared_libs=$enableval)\n AC_ARG_ENABLE(static, AC_HELP_STRING([--enable-static], [build static libraries [[default=YES]]]), opt_static_libs=$enableval)\n AC_ARG_ENABLE(install-examples, AC_HELP_STRING([--disable-install-examples], [don't install examples [[default=install]]]), opt_install_examples=$enableval)\n \n+AC_ARG_ENABLE(bracketed-paste-default, AC_HELP_STRING([--disable-bracketed-paste-default], [disable bracketed paste by default [[default=enable]]]), opt_bracketed_paste_default=$enableval)\n+\n if test $opt_multibyte = no; then\n AC_DEFINE(NO_MULTIBYTE_SUPPORT)\n fi\n \n+if test $opt_bracketed_paste_default = yes; then\n+\tBRACKETED_PASTE='-DBRACKETED_PASTE_DEFAULT=1'\n+else\n+\tBRACKETED_PASTE='-DBRACKETED_PASTE_DEFAULT=0'\n+fi\n+AC_SUBST(BRACKETED_PASTE)\n+\n dnl load up the cross-building cache file -- add more cases and cache\n dnl files as necessary\n \n@@ -101,15 +111,18 @@ echo \"Beginning configuration for readline-$LIBVERSION for ${host_cpu}-${host_ve\n echo \"\"\n \n # We want these before the checks, so the checks can modify their values.\n-test -z \"$CFLAGS\" && CFLAGS=-g auto_cflags=1\n+test -z \"$CFLAGS\" && want_auto_cflags=1\n \n AC_PROG_MAKE_SET\n AC_PROG_CC\n dnl AC_AIX\n AC_MINIX\n \n-# If we're using gcc and the user hasn't specified CFLAGS, add -O to CFLAGS.\n-test -n \"$GCC\" && test -n \"$auto_cflags\" && CFLAGS=\"$CFLAGS -O\"\n+# If we're using gcc and the user hasn't specified CFLAGS, add -O2 to CFLAGS\n+if test -n \"$want_auto_cflags\" ; then\n+\tAUTO_CFLAGS=\"-g ${GCC+-O2}\"\n+\tSTYLE_CFLAGS=\"${GCC+-Wno-parentheses} ${GCC+-Wno-format-security}\"\n+fi\n \n AC_PROG_GCC_TRADITIONAL\n AC_PROG_INSTALL\n@@ -219,6 +232,7 @@ esac\n \n case \"$host_os\" in\n isc*)\tLOCAL_CFLAGS=-Disc386 ;;\n+hpux*)\tLOCAL_CFLAGS=\"-DTGETENT_BROKEN -DTGETFLAG_BROKEN\" ;;\n esac\n \n # shared library configuration section\n@@ -297,6 +311,11 @@ esac\n \n AC_SUBST(BUILD_DIR)\n \n+if test -n \"$want_auto_cflags\"; then\n+\tCFLAGS=\"$AUTO_CFLAGS\"\n+fi\n+CFLAGS=\"$CFLAGS $STYLE_CFLAGS\"\n+\n AC_SUBST(CFLAGS)\n AC_SUBST(LOCAL_CFLAGS)\n AC_SUBST(LOCAL_LDFLAGS)"
    },
    {
      "sha": "38b3d0e761369b3c7c71721c733af64805a72bb2",
      "filename": "readline/readline/display.c",
      "status": "modified",
      "additions": 566,
      "deletions": 258,
      "changes": 824,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/display.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/display.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/display.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* display.c -- readline redisplay facility. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library    \n    for reading lines of text with interactive input and history editing.\n@@ -63,23 +63,31 @@\n extern char *strchr (), *strrchr ();\n #endif /* !strchr && !__STDC__ */\n \n-static void update_line PARAMS((char *, char *, int, int, int, int));\n+static void putc_face PARAMS((int, int, char *));\n+static void puts_face PARAMS((const char *, const char *, int));\n+static void norm_face PARAMS((char *, int));\n+\n+static void update_line PARAMS((char *, char *, char *, char *, int, int, int, int));\n static void space_to_eol PARAMS((int));\n static void delete_chars PARAMS((int));\n static void insert_some_chars PARAMS((char *, int, int));\n static void open_some_spaces PARAMS((int));\n static void cr PARAMS((void));\n static void redraw_prompt PARAMS((char *));\n+static void _rl_move_cursor_relative PARAMS((int, const char *, const char *));\n \n /* Values for FLAGS */\n #define PMT_MULTILINE\t0x01\n \n static char *expand_prompt PARAMS((char *, int, int *, int *, int *, int *));\n \n+#define DEFAULT_LINE_BUFFER_SIZE\t1024\n+\n /* State of visible and invisible lines. */\n struct line_state\n   {\n     char *line;\n+    char *lface;\n     int *lbreaks;\n     int lbsize;\n #if defined (HANDLE_MULTIBYTE)\n@@ -102,7 +110,9 @@ static int line_structures_initialized = 0;\n #define vis_lbsize\t(line_state_visible->lbsize)\n \n #define visible_line\t(line_state_visible->line)\n+#define vis_face\t(line_state_visible->lface)\n #define invisible_line\t(line_state_invisible->line)\n+#define inv_face\t(line_state_invisible->lface)\n \n #if defined (HANDLE_MULTIBYTE)\n static int _rl_col_width PARAMS((const char *, int, int, int));\n@@ -123,6 +133,10 @@ static int _rl_col_width PARAMS((const char *, int, int, int));\n    to use prompt_last_invisible directly. */\n #define PROMPT_ENDING_INDEX \\\n   ((MB_CUR_MAX > 1 && rl_byte_oriented == 0) ? prompt_physical_chars : prompt_last_invisible+1)\n+\n+#define FACE_NORMAL\t'0'\n+#define FACE_STANDOUT\t'1'\n+#define FACE_INVALID\t((char)1)\n   \n /* **************************************************************** */\n /*\t\t\t\t\t\t\t\t    */\n@@ -190,6 +204,8 @@ int _rl_last_v_pos = 0;\n   on screen minus 1. */\n int _rl_vis_botlin = 0;\n \n+static int _rl_quick_redisplay = 0;\n+\n /* This is a hint update_line gives to rl_redisplay that it has adjusted the\n    value of _rl_last_c_pos *and* taken the presence of any invisible chars in\n    the prompt into account.  rl_redisplay notes this and does not do the\n@@ -219,7 +235,11 @@ static int msg_bufsiz = 0;\n static int forced_display;\n \n /* Default and initial buffer size.  Can grow. */\n-static int line_size = 1024;\n+static int line_size  = 0;\n+\n+/* Set to a non-zero value if horizontal scrolling has been enabled\n+   automatically because the terminal was resized to height 1. */\n+static int horizontal_scrolling_autoset = 0;\t/* explicit initialization */\n \n /* Variables to keep track of the expanded prompt string, which may\n    include invisible characters. */\n@@ -574,11 +594,6 @@ rl_expand_prompt (char *prompt)\n     {\n       /* The prompt spans multiple lines. */\n       t = ++p;\n-      local_prompt = expand_prompt (p, PMT_MULTILINE,\n-\t\t\t\t       &prompt_visible_length,\n-\t\t\t\t       &prompt_last_invisible,\n-\t\t\t\t       &prompt_invis_chars_first_line,\n-\t\t\t\t       &prompt_physical_chars);\n       c = *t; *t = '\\0';\n       /* The portion of the prompt string up to and including the\n \t final newline is now null-terminated. */\n@@ -588,11 +603,53 @@ rl_expand_prompt (char *prompt)\n \t\t\t\t\t\t   (int *)NULL,\n \t\t\t\t\t\t   (int *)NULL);\n       *t = c;\n+\n+      local_prompt = expand_prompt (p, PMT_MULTILINE,\n+\t\t\t\t       &prompt_visible_length,\n+\t\t\t\t       &prompt_last_invisible,\n+\t\t\t\t       &prompt_invis_chars_first_line,\n+\t\t\t\t       &prompt_physical_chars);\n       local_prompt_len = local_prompt ? strlen (local_prompt) : 0;\n       return (prompt_prefix_length);\n     }\n }\n \n+/* Allocate the various line structures, making sure they can hold MINSIZE\n+   bytes. If the existing line size can accommodate MINSIZE bytes, don't do\n+   anything. */\n+static void\n+realloc_line (int minsize)\n+{\n+  int minimum_size;\n+  int newsize, delta;\n+\n+  minimum_size = DEFAULT_LINE_BUFFER_SIZE;\n+  if (minsize < minimum_size)\n+    minsize = minimum_size;\n+  if (minsize <= _rl_screenwidth)\t/* XXX - for gdb */\n+    minsize = _rl_screenwidth + 1;\n+  if (line_size >= minsize)\n+    return;\n+\n+  newsize = minimum_size;\n+  while (newsize < minsize)\n+    newsize *= 2;\n+\n+  visible_line = (char *)xrealloc (visible_line, newsize);\n+  vis_face = (char *)xrealloc (vis_face, newsize);\n+\n+  invisible_line = (char *)xrealloc (invisible_line, newsize);\n+  inv_face = (char *)xrealloc (inv_face, newsize);\n+\n+  delta = newsize - line_size;  \n+  memset (visible_line + line_size, 0, delta);\n+  memset (vis_face + line_size, FACE_NORMAL, delta);\n+  memset (invisible_line + line_size, 1, delta);\n+  memset (inv_face + line_size, FACE_INVALID, delta);\n+\n+  line_size = newsize;\n+}\n+\n /* Initialize the VISIBLE_LINE and INVISIBLE_LINE arrays, and their associated\n    arrays of line break markers.  MINSIZE is the minimum size of VISIBLE_LINE\n    and INVISIBLE_LINE; if it is greater than LINE_SIZE, LINE_SIZE is\n@@ -601,33 +658,12 @@ rl_expand_prompt (char *prompt)\n static void\n init_line_structures (int minsize)\n {\n-  register int n;\n-  int original_minsize = minsize;\n-\n-  if (minsize <= _rl_screenwidth)\t/* XXX - for gdb */\n-    minsize = _rl_screenwidth + 1;\n-\n   if (invisible_line == 0)\t/* initialize it */\n     {\n-      if (line_size < minsize)\n-\tline_size = minsize;\n-      visible_line = (char *)xmalloc (line_size);\n-      invisible_line = (char *)xmalloc (line_size);\n-    }\n-  else if (line_size < minsize)\t/* ensure it can hold MINSIZE chars */\n-    {\n-      line_size *= 2;\n-      if (line_size < minsize)\n-\tline_size = minsize;\n-      visible_line = (char *)xrealloc (visible_line, line_size);\n-      invisible_line = (char *)xrealloc (invisible_line, line_size);\n-    }\n-\n-  for (n = original_minsize; n < line_size; n++)\n-    {\n-      visible_line[n] = 0;\n-      invisible_line[n] = 1;\n+      if (line_size > minsize)\n+\tminsize = line_size;\n     }\n+   realloc_line (minsize); \n \n   if (vis_lbreaks == 0)\n     {\n@@ -649,16 +685,68 @@ init_line_structures (int minsize)\n \n   line_structures_initialized = 1;\n }\n-  \n+\n+/* Convenience functions to add chars to the invisible line that update the\n+   face information at the same time. */\n+static void\t\t/* XXX - change this */\n+invis_addc (int *outp, char c, char face)\n+{\n+  realloc_line (*outp + 1);\n+  invisible_line[*outp] = c;\n+  inv_face[*outp] = face;\n+  *outp += 1;\n+}\n+\n+static void\n+invis_adds (int *outp, const char *str, int n, char face)\n+{\n+  int i;\n+\n+  for (i = 0; i < n; i++)\n+    invis_addc (outp, str[i], face);\n+}\n+\n+static void\n+invis_nul (int *outp)\n+{\n+  invis_addc (outp, '\\0', 0);\n+  *outp -= 1;\n+}\n+\n+static void\n+set_active_region (int *beg, int *end)\n+{\n+  if (rl_point >= 0 && rl_point <= rl_end && rl_mark >= 0 && rl_mark <= rl_end)\n+    {\n+      *beg = (rl_mark < rl_point) ? rl_mark : rl_point;\n+      *end = (rl_mark < rl_point) ? rl_point : rl_mark;\n+    }\n+}\n+\n+/* Do whatever tests are necessary and tell update_line that it can do a\n+   quick, dumb redisplay on the assumption that there are so many\n+   differences between the old and new lines that it would be a waste to\n+   compute all the differences.\n+   Right now, it just sets _rl_quick_redisplay if the current visible line\n+   is a single line (so we don't have to move vertically or mess with line\n+   wrapping). */\n+void\n+_rl_optimize_redisplay (void)\n+{\n+  if (_rl_vis_botlin == 0)\n+    _rl_quick_redisplay = 1;\n+}  \n+\n /* Basic redisplay algorithm.  See comments inline. */\n void\n rl_redisplay (void)\n {\n-  register int in, out, c, linenum, cursor_linenum;\n-  register char *line;\n+  int in, out, c, linenum, cursor_linenum;\n   int inv_botlin, lb_botlin, lb_linenum, o_cpos;\n   int newlines, lpos, temp, n0, num, prompt_lines_estimate;\n   char *prompt_this_line;\n+  char cur_face;\n+  int hl_begin, hl_end;\n   int mb_cur_max = MB_CUR_MAX;\n #if defined (HANDLE_MULTIBYTE)\n   wchar_t wc;\n@@ -676,6 +764,14 @@ rl_redisplay (void)\n   _rl_block_sigint ();  \n   RL_SETSTATE (RL_STATE_REDISPLAYING);\n \n+  cur_face = FACE_NORMAL;\n+  /* Can turn this into an array for multiple highlighted objects in addition\n+     to the region */\n+  hl_begin = hl_end = -1;\n+\n+  if (rl_mark_active_p ())\n+    set_active_region (&hl_begin, &hl_end);\n+\n   if (!rl_display_prompt)\n     rl_display_prompt = \"\";\n \n@@ -687,21 +783,32 @@ rl_redisplay (void)\n   else if (line_size <= _rl_screenwidth)\n     init_line_structures (_rl_screenwidth + 1);\n \n+  /* Enable horizontal scrolling automatically for terminals of height 1\n+     where wrapping lines doesn't work. Disable it as soon as the terminal\n+     height is increased again if it was automatically enabled. */\n+  if (_rl_screenheight <= 1)\n+    {\n+      if (_rl_horizontal_scroll_mode == 0)\n+\t horizontal_scrolling_autoset = 1;\n+      _rl_horizontal_scroll_mode = 1;\n+    }\n+  else if (horizontal_scrolling_autoset)\n+    _rl_horizontal_scroll_mode = 0;\n+\n   /* Draw the line into the buffer. */\n   cpos_buffer_position = -1;\n \n   prompt_multibyte_chars = prompt_visible_length - prompt_physical_chars;\n \n-  line = invisible_line;\n   out = inv_botlin = 0;\n \n   /* Mark the line as modified or not.  We only do this for history\n      lines. */\n   modmark = 0;\n   if (_rl_mark_modified_lines && current_history () && rl_undo_list)\n     {\n-      line[out++] = '*';\n-      line[out] = '\\0';\n+      invis_addc (&out, '*', cur_face);\n+      invis_nul (&out);\n       modmark = 1;\n     }\n \n@@ -714,7 +821,7 @@ rl_redisplay (void)\n   /* If the prompt to be displayed is the `primary' readline prompt (the\n      one passed to readline()), use the values we have already expanded.\n      If not, use what's already in rl_display_prompt.  WRAP_OFFSET is the\n-     number of non-visible characters in the prompt string. */\n+     number of non-visible characters (bytes) in the prompt string. */\n   /* This is where we output the characters in the prompt before the last\n      newline, if any.  If there aren't any embedded newlines, we don't\n      write anything. Copy the last line of the prompt string into the line in\n@@ -725,18 +832,8 @@ rl_redisplay (void)\n \t_rl_output_some_chars (local_prompt_prefix, strlen (local_prompt_prefix));\n \n       if (local_prompt_len > 0)\n-\t{\n-\t  temp = local_prompt_len + out + 2;\n-\t  if (temp >= line_size)\n-\t    {\n-\t      line_size = (temp + 1024) - (temp % 1024);\n-\t      visible_line = (char *)xrealloc (visible_line, line_size);\n-\t      line = invisible_line = (char *)xrealloc (invisible_line, line_size);\n-\t    }\n-\t  strncpy (line + out, local_prompt, local_prompt_len);\n-\t  out += local_prompt_len;\n-\t}\n-      line[out] = '\\0';\n+\tinvis_adds (&out, local_prompt, local_prompt_len, cur_face);\n+      invis_nul (&out);\n       wrap_offset = local_prompt_len - prompt_visible_length;\n     }\n   else\n@@ -759,17 +856,9 @@ rl_redisplay (void)\n \t    }\n \t}\n \n-      prompt_physical_chars = pmtlen = strlen (prompt_this_line);\n-      temp = pmtlen + out + 2;\n-      if (temp >= line_size)\n-\t{\n-\t  line_size = (temp + 1024) - (temp % 1024);\n-\t  visible_line = (char *)xrealloc (visible_line, line_size);\n-\t  line = invisible_line = (char *)xrealloc (invisible_line, line_size);\n-\t}\n-      strncpy (line + out,  prompt_this_line, pmtlen);\n-      out += pmtlen;\n-      line[out] = '\\0';\n+      prompt_physical_chars = pmtlen = strlen (prompt_this_line);\t/* XXX */\n+      invis_adds (&out, prompt_this_line, pmtlen, cur_face);\n+      invis_nul (&out);\n       wrap_offset = prompt_invis_chars_first_line = 0;\n     }\n \n@@ -850,8 +939,8 @@ rl_redisplay (void)\n   num = 0;\n #endif\n \n-  /* prompt_invis_chars_first_line is the number of invisible characters in\n-     the first physical line of the prompt.\n+  /* prompt_invis_chars_first_line is the number of invisible characters (bytes)\n+     in the first physical line of the prompt.\n      wrap_offset - prompt_invis_chars_first_line is usually the number of\n      invis chars on the second (or, more generally, last) line. */\n \n@@ -907,6 +996,11 @@ rl_redisplay (void)\n   for (in = 0; in < rl_end; in++)\n #endif\n     {\n+      if (in == hl_begin)\n+\tcur_face = FACE_STANDOUT;\n+      else if (in == hl_end)\n+\tcur_face = FACE_NORMAL;\n+\n       c = (unsigned char)rl_line_buffer[in];\n \n #if defined (HANDLE_MULTIBYTE)\n@@ -931,14 +1025,6 @@ rl_redisplay (void)\n \t}\n #endif\n \n-      if (out + 8 >= line_size)\t\t/* XXX - 8 for \\t */\n-\t{\n-\t  line_size *= 2;\n-\t  visible_line = (char *)xrealloc (visible_line, line_size);\n-\t  invisible_line = (char *)xrealloc (invisible_line, line_size);\n-\t  line = invisible_line;\n-\t}\n-\n       if (in == rl_point)\n \t{\n \t  cpos_buffer_position = out;\n@@ -953,26 +1039,33 @@ rl_redisplay (void)\n \t{\n \t  if (_rl_output_meta_chars == 0)\n \t    {\n-\t      sprintf (line + out, \"\\\\%o\", c);\n+\t      char obuf[5];\n+\t      int olen;\n \n-\t      if (lpos + 4 >= _rl_screenwidth)\n+\t      olen = sprintf (obuf, \"\\\\%o\", c);\n+\t  \n+\t      if (lpos + olen >= _rl_screenwidth)\n \t\t{\n \t\t  temp = _rl_screenwidth - lpos;\n \t\t  CHECK_INV_LBREAKS ();\n \t\t  inv_lbreaks[++newlines] = out + temp;\n #if defined (HANDLE_MULTIBYTE)\n \t\t  line_state_invisible->wrapped_line[newlines] = _rl_wrapped_multicolumn;\n #endif\n-\t\t  lpos = 4 - temp;\n+\t\t  lpos = olen - temp;\n \t\t}\n \t      else\n-\t\tlpos += 4;\n+\t\tlpos += olen;\n \n-\t      out += 4;\n+\t      for (temp = 0; temp < olen; temp++)\n+\t\t{\n+\t\t  invis_addc (&out, obuf[temp], cur_face);\n+\t\t  CHECK_LPOS ();\n+\t\t}\n \t    }\n \t  else\n \t    {\n-\t      line[out++] = c;\n+\t      invis_addc (&out, c, cur_face);\n \t      CHECK_LPOS();\n \t    }\n \t}\n@@ -981,11 +1074,7 @@ rl_redisplay (void)\n \t{\n \t  register int newout;\n \n-#if 0\n-\t  newout = (out | (int)7) + 1;\n-#else\n \t  newout = out + 8 - lpos % 8;\n-#endif\n \t  temp = newout - out;\n \t  if (lpos + temp >= _rl_screenwidth)\n \t    {\n@@ -998,19 +1087,19 @@ rl_redisplay (void)\n #endif\n \t      lpos = temp - temp2;\n \t      while (out < newout)\n-\t\tline[out++] = ' ';\n+\t\tinvis_addc (&out, ' ', cur_face);\n \t    }\n \t  else\n \t    {\n \t      while (out < newout)\n-\t\tline[out++] = ' ';\n+\t\tinvis_addc (&out, ' ', cur_face);\n \t      lpos += temp;\n \t    }\n \t}\n #endif\n       else if (c == '\\n' && _rl_horizontal_scroll_mode == 0 && _rl_term_up && *_rl_term_up)\n \t{\n-\t  line[out++] = '\\0';\t/* XXX - sentinel */\n+\t  invis_addc (&out, '\\0', cur_face);\n \t  CHECK_INV_LBREAKS ();\n \t  inv_lbreaks[++newlines] = out;\n #if defined (HANDLE_MULTIBYTE)\n@@ -1020,9 +1109,9 @@ rl_redisplay (void)\n \t}\n       else if (CTRL_CHAR (c) || c == RUBOUT)\n \t{\n-\t  line[out++] = '^';\n+\t  invis_addc (&out, '^', cur_face);\n \t  CHECK_LPOS();\n-\t  line[out++] = CTRL_CHAR (c) ? UNCTRL (c) : '?';\n+\t  invis_addc (&out, CTRL_CHAR (c) ? UNCTRL (c) : '?', cur_face);\n \t  CHECK_LPOS();\n \t}\n       else\n@@ -1038,7 +1127,7 @@ rl_redisplay (void)\n \t\tfor (i = lpos; i < _rl_screenwidth; i++)\n \t\t  {\n \t\t    /* The space will be removed in update_line() */\n-\t\t    line[out++] = ' ';\n+\t\t    invis_addc (&out, ' ', cur_face);\n \t\t    _rl_wrapped_multicolumn++;\n \t\t    CHECK_LPOS();\n \t\t  }\n@@ -1048,17 +1137,17 @@ rl_redisplay (void)\n \t\t  lb_linenum = newlines;\n \t\t}\n \t      for (i = in; i < in+wc_bytes; i++)\n-\t\tline[out++] = rl_line_buffer[i];\n+\t\tinvis_addc (&out, rl_line_buffer[i], cur_face);\n \t      for (i = 0; i < wc_width; i++)\n \t\tCHECK_LPOS();\n \t    }\n \t  else\n \t    {\n-\t      line[out++] = c;\n+\t      invis_addc (&out, c, cur_face);\n \t      CHECK_LPOS();\n \t    }\n #else\n-\t  line[out++] = c;\n+\t  invis_addc (&out, c, cur_face);\n \t  CHECK_LPOS();\n #endif\n \t}\n@@ -1080,14 +1169,19 @@ rl_redisplay (void)\n         in++;\n #endif\n     }\n-  line[out] = '\\0';\n+  invis_nul (&out);\n   line_totbytes = out;\n   if (cpos_buffer_position < 0)\n     {\n       cpos_buffer_position = out;\n       lb_linenum = newlines;\n     }\n \n+  /* If we are switching from one line to multiple wrapped lines, we don't\n+     want to do a dumb update (or we want to make it smarter). */\n+  if (_rl_quick_redisplay && newlines > 0)\n+    _rl_quick_redisplay = 0;\n+\n   inv_botlin = lb_botlin = _rl_inv_botlin = newlines;\n   CHECK_INV_LBREAKS ();\n   inv_lbreaks[newlines+1] = out;\n@@ -1124,7 +1218,7 @@ rl_redisplay (void)\n \t    {\n #if defined (HANDLE_MULTIBYTE)\n \t      if (mb_cur_max > 1 && rl_byte_oriented == 0)\n-\t\tout = _rl_find_prev_mbchar (line, _rl_screenchars, MB_FIND_ANY);\n+\t\tout = _rl_find_prev_mbchar (invisible_line, _rl_screenchars, MB_FIND_ANY);\n \t      else\n #endif\n \t\tout = _rl_screenchars - 1;\n@@ -1142,22 +1236,42 @@ rl_redisplay (void)\n #define VIS_LLEN(l)\t((l) > _rl_vis_botlin ? 0 : (vis_lbreaks[l+1] - vis_lbreaks[l]))\n #define INV_LLEN(l)\t(inv_lbreaks[l+1] - inv_lbreaks[l])\n #define VIS_CHARS(line) (visible_line + vis_lbreaks[line])\n+#define VIS_FACE(line) (vis_face + vis_lbreaks[line])\n #define VIS_LINE(line) ((line) > _rl_vis_botlin) ? \"\" : VIS_CHARS(line)\n+#define VIS_LINE_FACE(line) ((line) > _rl_vis_botlin) ? \"\" : VIS_FACE(line)\n #define INV_LINE(line) (invisible_line + inv_lbreaks[line])\n+#define INV_LINE_FACE(line) (inv_face + inv_lbreaks[line])\n \n #define OLD_CPOS_IN_PROMPT() (cpos_adjusted == 0 && \\\n \t\t\t_rl_last_c_pos != o_cpos && \\\n \t\t\t_rl_last_c_pos > wrap_offset && \\\n \t\t\to_cpos < prompt_last_invisible)\n \n+\n+\t  /* We don't want to highlight anything that's going to be off the top\n+\t     of the display; if the current line takes up more than an entire\n+\t    screen, just mark the lines that won't be displayed as having a\n+\t    `normal' face.\n+\t    It's imperfect, but better than display corruption. */\n+\t  if (rl_mark_active_p () && inv_botlin > _rl_screenheight)\n+\t    {\n+\t      int extra;\n+\n+\t      extra = inv_botlin - _rl_screenheight;\n+\t      for (linenum = 0; linenum <= extra; linenum++)\n+\t\tnorm_face (INV_LINE_FACE(linenum), INV_LLEN (linenum));\n+\t    }\n+\n \t  /* For each line in the buffer, do the updating display. */\n \t  for (linenum = 0; linenum <= inv_botlin; linenum++)\n \t    {\n \t      /* This can lead us astray if we execute a program that changes\n \t\t the locale from a non-multibyte to a multibyte one. */\n \t      o_cpos = _rl_last_c_pos;\n \t      cpos_adjusted = 0;\n-\t      update_line (VIS_LINE(linenum), INV_LINE(linenum), linenum,\n+\t      update_line (VIS_LINE(linenum), VIS_LINE_FACE(linenum),\n+\t\t\t   INV_LINE(linenum), INV_LINE_FACE(linenum),\n+\t\t\t   linenum,\n \t\t\t   VIS_LLEN(linenum), INV_LLEN(linenum), inv_botlin);\n \n \t      /* update_line potentially changes _rl_last_c_pos, but doesn't\n@@ -1205,19 +1319,35 @@ rl_redisplay (void)\n \t\t    _rl_clear_to_eol (nleft);\n \t\t}\n #if 0\n-\t      /* This segment is intended to handle the case where the prompt\n-\t\t has invisible characters on the second line and the new line\n+\t      /* This segment is intended to handle the case where the old\n+\t\t visible prompt has invisible characters and the new line\n \t\t to be displayed needs to clear the rest of the old characters\n-\t\t out (e.g., when printing the i-search prompt).  In general,\n-\t\t the case of the new line being shorter than the old.\n-\t\t Incomplete */\n-\t      else if (linenum == prompt_last_screen_line &&\n-\t\t       prompt_physical_chars > _rl_screenwidth &&\n-\t\t       wrap_offset != prompt_invis_chars_first_line &&\n+\t\t out (e.g., when printing the i-search prompt): in general,\n+\t\t the case of the new line being shorter than the old.  We need\n+\t\t to be at the end of the new line and the old line needs to be\n+\t\t longer than the current cursor position. It's not perfect,\n+\t\t since it uses the byte length of the first line, but this will\n+\t\t at worst result in some extra clear-to-end-of-lines. We can't\n+\t\t use the prompt length variables because they may not\n+\t\t correspond to the visible line (see printing the i-search\n+\t\t prompt above). The tests for differing numbers of invisible\n+\t\t characters may not matter and can probably be removed. */\n+\t      else if (linenum == 0 &&\n+\t\t       linenum == prompt_last_screen_line &&\n \t\t       _rl_last_c_pos == out &&\n+\t\t       _rl_last_c_pos < visible_first_line_len &&\n+\t\t       visible_wrap_offset &&\n+\t\t       visible_wrap_offset != wrap_offset)\n+\t\t{\n+\t\t  if (mb_cur_max > 1 && rl_byte_oriented == 0)\n+\t\t    nleft = _rl_screenwidth - _rl_last_c_pos;\n+\t\t  else\n+\t\t    nleft = _rl_screenwidth + wrap_offset - _rl_last_c_pos;\n+\t\t  if (nleft)\n+\t\t    _rl_clear_to_eol (nleft);\n+\t\t}\n #endif\n \n-\n \t      /* Since the new first line is now visible, save its length. */\n \t      if (linenum == 0)\n \t\tvisible_first_line_len = (inv_botlin > 0) ? inv_lbreaks[1] : out - wrap_offset;\n@@ -1232,7 +1362,7 @@ rl_redisplay (void)\n \t\t{\n \t\t  tt = VIS_CHARS (linenum);\n \t\t  _rl_move_vert (linenum);\n-\t\t  _rl_move_cursor_relative (0, tt);\n+\t\t  _rl_move_cursor_relative (0, tt, VIS_FACE(linenum));\n \t\t  _rl_clear_to_eol\n \t\t    ((linenum == _rl_vis_botlin) ? strlen (tt) : _rl_screenwidth);\n \t\t}\n@@ -1261,20 +1391,12 @@ rl_redisplay (void)\n \t     the characters from the current cursor position.  But we\n \t     only need to reprint it if the cursor is before the last\n \t     invisible character in the prompt string. */\n+\t  /* XXX - why not use local_prompt_len? */\n \t  nleft = prompt_visible_length + wrap_offset;\n \t  if (cursor_linenum == 0 && wrap_offset > 0 && _rl_last_c_pos > 0 &&\n-#if 0\n-\t      _rl_last_c_pos <= PROMPT_ENDING_INDEX && local_prompt)\n-#else\n \t      _rl_last_c_pos < PROMPT_ENDING_INDEX && local_prompt)\n-#endif\n \t    {\n-#if defined (__MSDOS__)\n-\t      putc ('\\r', rl_outstream);\n-#else\n-\t      if (_rl_term_cr)\n-\t\ttputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif\n+\t      _rl_cr ();\n \t      if (modmark)\n \t\t_rl_output_some_chars (\"*\", 1);\n \n@@ -1288,8 +1410,8 @@ rl_redisplay (void)\n \t  /* Where on that line?  And where does that line start\n \t     in the buffer? */\n \t  pos = inv_lbreaks[cursor_linenum];\n-\t  /* nleft == number of characters in the line buffer between the\n-\t     start of the line and the desired cursor position. */\n+\t  /* nleft == number of characters (bytes) in the line buffer between\n+\t     the start of the line and the desired cursor position. */\n \t  nleft = cpos_buffer_position - pos;\n \n \t  /* NLEFT is now a number of characters in a buffer.  When in a\n@@ -1320,9 +1442,9 @@ rl_redisplay (void)\n \t     point specified by a buffer position (NLEFT) that doesn't take\n \t     invisible characters into account. */\n \t  if (mb_cur_max > 1 && rl_byte_oriented == 0)\n-\t    _rl_move_cursor_relative (nleft, &invisible_line[pos]);\n+\t    _rl_move_cursor_relative (nleft, &invisible_line[pos], &inv_face[pos]);\n \t  else if (nleft != _rl_last_c_pos)\n-\t    _rl_move_cursor_relative (nleft, &invisible_line[pos]);\n+\t    _rl_move_cursor_relative (nleft, &invisible_line[pos], &inv_face[pos]);\n \t}\n     }\n   else\t\t\t\t/* Do horizontal scrolling. Much simpler */\n@@ -1378,23 +1500,23 @@ rl_redisplay (void)\n       /* If the first character on the screen isn't the first character\n \t in the display line, indicate this with a special character. */\n       if (lmargin > 0)\n-\tline[lmargin] = '<';\n+\tinvisible_line[lmargin] = '<';\n \n       /* If SCREENWIDTH characters starting at LMARGIN do not encompass\n \t the whole line, indicate that with a special character at the\n \t right edge of the screen.  If LMARGIN is 0, we need to take the\n \t wrap offset into account. */\n       t = lmargin + M_OFFSET (lmargin, wrap_offset) + _rl_screenwidth;\n       if (t > 0 && t < out)\n-\tline[t - 1] = '>';\n+\tinvisible_line[t - 1] = '>';\n \n       if (rl_display_fixed == 0 || forced_display || lmargin != last_lmargin)\n \t{\n \t  forced_display = 0;\n \t  o_cpos = _rl_last_c_pos;\n \t  cpos_adjusted = 0;\n-\t  update_line (&visible_line[last_lmargin],\n-\t\t       &invisible_line[lmargin],\n+\t  update_line (&visible_line[last_lmargin], &vis_face[last_lmargin],\n+\t\t       &invisible_line[lmargin], &inv_face[lmargin],\n \t\t       0,\n \t\t       _rl_screenwidth + visible_wrap_offset,\n \t\t       _rl_screenwidth + (lmargin ? 0 : wrap_offset),\n@@ -1419,7 +1541,7 @@ rl_redisplay (void)\n \t  if (visible_first_line_len > _rl_screenwidth)\n \t    visible_first_line_len = _rl_screenwidth;\n \n-\t  _rl_move_cursor_relative (cpos_buffer_position - lmargin, &invisible_line[lmargin]);\n+\t  _rl_move_cursor_relative (cpos_buffer_position - lmargin, &invisible_line[lmargin], &inv_face[lmargin]);\n \t  last_lmargin = lmargin;\n \t}\n     }\n@@ -1440,32 +1562,75 @@ rl_redisplay (void)\n       visible_wrap_offset = 0;\n     else\n       visible_wrap_offset = wrap_offset;\n+\n+    _rl_quick_redisplay = 0;\n   }\n \n   RL_UNSETSTATE (RL_STATE_REDISPLAYING);\n   _rl_release_sigint ();\n }\n \n+static void\n+putc_face (int c, int face, char *cur_face)\n+{\n+  char cf;\n+  cf = *cur_face;\n+  if (cf != face)\n+    {\n+      if (cf != FACE_NORMAL && cf != FACE_STANDOUT)\n+\treturn;\n+      if (face != FACE_NORMAL && face != FACE_STANDOUT)\n+\treturn;\n+      if (face == FACE_STANDOUT && cf == FACE_NORMAL)\n+        _rl_standout_on ();\n+      if (face == FACE_NORMAL && cf == FACE_STANDOUT)\n+        _rl_standout_off ();\n+      *cur_face = face;\n+    }\n+  if (c != EOF)\n+    putc (c, rl_outstream);\n+}\n+\n+static void\n+puts_face (const char *str, const char *face, int n)\n+{\n+  int i;\n+  char cur_face;\n+\n+  for (cur_face = FACE_NORMAL, i = 0; i < n; i++)\n+    putc_face (str[i], face[i], &cur_face);\n+  putc_face (EOF, FACE_NORMAL, &cur_face);\n+}\n+\n+static void\n+norm_face (char *face, int n)\n+{\n+  memset (face, FACE_NORMAL, n);\n+}\n+\n+#define ADJUST_CPOS(x) do { _rl_last_c_pos -= (x) ; cpos_adjusted = 1; } while (0)\n+\n /* PWP: update_line() is based on finding the middle difference of each\n    line on the screen; vis:\n \n \t\t\t     /old first difference\n-\t/beginning of line   |\t      /old last same       /old EOL\n-\tv\t\t     v\t      v\t\t    v\n+\t/beginning of line   |              /old last same       /old EOL\n+\tv \t\t     v              v                    v\n old:\teddie> Oh, my little gruntle-buggy is to me, as lurgid as\n new:\teddie> Oh, my little buggy says to me, as lurgid as\n-\t^\t\t     ^\t^\t\t\t   ^\n-\t\\beginning of line   |\t\\new last same\t   \\new end of line\n+\t^\t\t     ^        ^\t\t\t   ^\n+\t\\beginning of line   |\t      \\new last same\t   \\new end of line\n \t\t\t     \\new first difference\n \n    All are character pointers for the sake of speed.  Special cases for\n    no differences, as well as for end of line additions must be handled.\n \n    Could be made even smarter, but this works well enough */\n static void\n-update_line (char *old, char *new, int current_line, int omax, int nmax, int inv_botlin)\n+update_line (char *old, char *old_face, char *new, char *new_face, int current_line, int omax, int nmax, int inv_botlin)\n {\n-  register char *ofd, *ols, *oe, *nfd, *nls, *ne;\n+  char *ofd, *ols, *oe, *nfd, *nls, *ne;\n+  char *ofdf, *nfdf, *olsf, *nlsf;\n   int temp, lendiff, wsatend, od, nd, twidth, o_cpos;\n   int current_invis_chars;\n   int col_lendiff, col_temp;\n@@ -1600,17 +1765,24 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t      int count, i, j;\n \t      char *optr;\n \n-\t      _rl_output_some_chars (new, newbytes);\n+\t      puts_face (new, new_face, newbytes);\n \t      _rl_last_c_pos = newwidth;\n \t      _rl_last_v_pos++;\n \n \t      /* 5a. If the number of screen positions doesn't match, punt\n-\t\t and do a dumb update. */\n-\t      if (newwidth != oldwidth)\n+\t\t and do a dumb update.\n+\t\t 5b. If the number of bytes is greater in the new line than\n+\t\t the old, do a dumb update, because there is no guarantee we\n+\t\t can extend the old line enough to fit the new bytes. */\n+\t      if (newwidth != oldwidth || newbytes > oldbytes)\n \t\t{\n+\t\t  oe = old + omax;\n \t\t  ne = new + nmax;\n \t\t  nd = newbytes;\n \t\t  nfd = new + nd;\n+\t\t  ofdf = old_face + oldbytes;\n+\t\t  nfdf = new_face + newbytes;\n+\n \t\t  goto dumb_update;\n \t\t}\n \t      if (oldbytes != 0 && newbytes != 0)\n@@ -1619,13 +1791,21 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t     consume the first character of old. Fix up `old' so it\n \t\t     reflects the new screen contents.  We use +1 in the\n \t\t     memmove call to copy the trailing NUL. */\n-\t\t  memmove (old+newbytes, old+oldbytes, strlen (old+oldbytes) + 1);\n+\t\t  /* (strlen(old+oldbytes) == (omax - oldbytes - 1)) */\n+\n+\t\t  /* Don't bother trying to fit the bytes if the number of bytes\n+\t\t     doesn't change. */\n+\t\t  if (oldbytes != newbytes)\n+\t\t    {\n+\t\t      memmove (old+newbytes, old+oldbytes, strlen (old+oldbytes) + 1);\n+\t\t      memmove (old_face+newbytes, old_face+oldbytes, strlen (old+oldbytes) + 1);\n+\t\t    }\n \t\t  memcpy (old, new, newbytes);\n+\t\t  memcpy (old_face, new_face, newbytes);\n \t\t  j = newbytes - oldbytes;\n-\t\t      \n \t\t  omax += j;\n \t\t  /* Fix up indices if we copy data from one line to another */\n-\t\t  for (i = current_line+1; i <= inv_botlin+1; i++)\n+\t\t  for (i = current_line+1; j != 0 && i <= inv_botlin+1 && i <=_rl_vis_botlin+1; i++)\n \t\t    vis_lbreaks[i] += j;\n \t\t}\n \t    }\n@@ -1635,21 +1815,69 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t      _rl_last_c_pos = 1;\n \t      _rl_last_v_pos++;\n \t      if (old[0] && new[0])\n-\t\told[0] = new[0];\n+\t\t{\n+\t\t  old[0] = new[0];\n+\t\t  old_face[0] = new_face[0];\n+\t\t}\n \t    }\n \t}\n       else\n #endif\n \t{\n \t  if (new[0])\n-\t    putc (new[0], rl_outstream);\n+\t    puts_face (new, new_face, 1);\n \t  else\n \t    putc (' ', rl_outstream);\n \t  _rl_last_c_pos = 1;\n \t  _rl_last_v_pos++;\n \t  if (old[0] && new[0])\n-\t    old[0] = new[0];\n+\t    {\n+\t      old[0] = new[0];\n+\t      old_face[0] = new_face[0];\n+\t    }\n+\t}\n+    }\n+\n+  /* We know that we are dealing with a single screen line here */\n+  if (_rl_quick_redisplay)\n+    {\n+      nfd = new;\n+      nfdf = new_face;\n+      ofd = old;\n+      ofdf = old_face;\n+      for (od = 0, oe = ofd; od < omax && *oe; oe++, od++);\n+      for (nd = 0, ne = nfd; nd < nmax && *ne; ne++, nd++);\n+      od = nd = 0;\n+      _rl_move_cursor_relative (0, old, old_face);\n+\n+      bytes_to_insert = ne - nfd;\n+      if (bytes_to_insert < local_prompt_len)\t/* ??? */\n+\tgoto dumb_update;\n+\n+      /* output the prompt, output the line contents, clear the rest */\n+      _rl_output_some_chars (nfd, local_prompt_len);\n+      if (mb_cur_max > 1 && rl_byte_oriented == 0)\n+\t_rl_last_c_pos = prompt_physical_chars;\n+      else\n+\t_rl_last_c_pos = local_prompt_len;\n+\n+      bytes_to_insert -= local_prompt_len;\n+      if (bytes_to_insert > 0)\n+\t{\n+\t  puts_face (new+local_prompt_len, nfdf+local_prompt_len, bytes_to_insert);\n+\t  if (mb_cur_max > 1 && rl_byte_oriented)\n+\t    _rl_last_c_pos += _rl_col_width (new, local_prompt_len, ne-new, 1);\n+\t  else\n+\t    _rl_last_c_pos += bytes_to_insert;\n \t}\n+\n+      /* See comments at dumb_update: for an explanation of this heuristic */\n+      if (nmax < omax)\n+\tgoto clear_rest_of_line;\n+      else if ((nmax - W_OFFSET(current_line, wrap_offset)) < (omax - W_OFFSET (current_line, visible_wrap_offset)))\n+\tgoto clear_rest_of_line;\n+      else\n+\treturn;\n     }\n \n   /* Find first difference. */\n@@ -1659,48 +1887,56 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n       /* See if the old line is a subset of the new line, so that the\n \t only change is adding characters. */\n       temp = (omax < nmax) ? omax : nmax;\n-      if (memcmp (old, new, temp) == 0)\t\t/* adding at the end */\n+      if (memcmp (old, new, temp) == 0 && memcmp (old_face, new_face, temp) == 0)\n \t{\n-\t  new_offset = old_offset = temp;\n+\t  new_offset = old_offset = temp;\t/* adding at the end */\n \t  ofd = old + temp;\n+\t  ofdf = old_face + temp;\n \t  nfd = new + temp;\n+\t  nfdf = new_face + temp;\n \t}\n       else\n \t{      \n \t  memset (&ps_new, 0, sizeof(mbstate_t));\n \t  memset (&ps_old, 0, sizeof(mbstate_t));\n \n \t  /* Are the old and new lines the same? */\n-\t  if (omax == nmax && STREQN (new, old, omax))\n+\t  if (omax == nmax && memcmp (new, old, omax) == 0 && memcmp (new_face, old_face, omax) == 0)\n \t    {\n \t      old_offset = omax;\n \t      new_offset = nmax;\n \t      ofd = old + omax;\n+\t      ofdf = old_face + omax;\n \t      nfd = new + nmax;\n+\t      nfdf = new_face + nmax;\n \t    }\n \t  else\n \t    {\n \t      /* Go through the line from the beginning and find the first\n-\t\t difference. */\n+\t\t difference. We assume that faces change at (possibly multi-\n+\t\t byte) character boundaries. */\n \t      new_offset = old_offset = 0;\n-\t      for (ofd = old, nfd = new;\n+\t      for (ofd = old, ofdf = old_face, nfd = new, nfdf = new_face;\n \t\t    (ofd - old < omax) && *ofd &&\n-\t\t    _rl_compare_chars(old, old_offset, &ps_old, new, new_offset, &ps_new); )\n+\t\t    _rl_compare_chars(old, old_offset, &ps_old, new, new_offset, &ps_new) &&\n+\t\t    *ofdf == *nfdf; )\n \t\t{\n \t\t  old_offset = _rl_find_next_mbchar (old, old_offset, 1, MB_FIND_ANY);\n \t\t  new_offset = _rl_find_next_mbchar (new, new_offset, 1, MB_FIND_ANY);\n \n \t\t  ofd = old + old_offset;\n+\t\t  ofdf = old_face + old_offset;\n \t\t  nfd = new + new_offset;\n+\t\t  nfdf = new_face + new_offset;\n \t\t}\n \t    }\n \t}\n     }\n   else\n #endif\n-  for (ofd = old, nfd = new;\n-       (ofd - old < omax) && *ofd && (*ofd == *nfd);\n-       ofd++, nfd++)\n+  for (ofd = old, ofdf = old_face, nfd = new, nfdf = new_face;\n+       (ofd - old < omax) && *ofd && (*ofd == *nfd) && (*ofdf == *nfdf);\n+       ofd++, nfd++, ofdf++, nfdf++)\n     ;\n \n   /* Move to the end of the screen line.  ND and OD are used to keep track\n@@ -1729,7 +1965,9 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t  old_offset = _rl_find_prev_mbchar (old, ofd - old, MB_FIND_ANY);\n \t  new_offset = _rl_find_prev_mbchar (new, nfd - new, MB_FIND_ANY);\n \t  ofd = old + old_offset;\t/* equal by definition */\n+\t  ofdf = old_face + old_offset;\n \t  nfd = new + new_offset;\n+\t  nfdf = new_face + new_offset;\n \t}\n     }\n #endif\n@@ -1742,40 +1980,41 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n   if (mb_cur_max > 1 && rl_byte_oriented == 0)\n     {\n       ols = old + _rl_find_prev_mbchar (old, oe - old, MB_FIND_ANY);\n+      olsf = old_face + (ols - old);\n       nls = new + _rl_find_prev_mbchar (new, ne - new, MB_FIND_ANY);\n+      nlsf = new_face + (nls - new);\n \n       while ((ols > ofd) && (nls > nfd))\n \t{\n \t  memset (&ps_old, 0, sizeof (mbstate_t));\n \t  memset (&ps_new, 0, sizeof (mbstate_t));\n \n-#if 0\n-\t  /* On advice from jir@yamato.ibm.com */\n-\t  _rl_adjust_point (old, ols - old, &ps_old);\n-\t  _rl_adjust_point (new, nls - new, &ps_new);\n-#endif\n-\n-\t  if (_rl_compare_chars (old, ols - old, &ps_old, new, nls - new, &ps_new) == 0)\n+\t  if (_rl_compare_chars (old, ols - old, &ps_old, new, nls - new, &ps_new) == 0 ||\n+\t\t*olsf != *nlsf)\n \t    break;\n \n \t  if (*ols == ' ')\n \t    wsatend = 0;\n \n \t  ols = old + _rl_find_prev_mbchar (old, ols - old, MB_FIND_ANY);\n+\t  olsf = old_face + (ols - old);\n \t  nls = new + _rl_find_prev_mbchar (new, nls - new, MB_FIND_ANY);\n+\t  nlsf = new_face + (nls - new);\n \t}\n     }\n   else\n     {\n #endif /* HANDLE_MULTIBYTE */\n   ols = oe - 1;\t\t\t/* find last same */\n+  olsf = old_face + (ols - old);\n   nls = ne - 1;\n-  while ((ols > ofd) && (nls > nfd) && (*ols == *nls))\n+  nlsf = new_face + (nls - new);\n+  while ((ols > ofd) && (nls > nfd) && (*ols == *nls) && (*olsf == *nlsf))\n     {\n       if (*ols != ' ')\n \twsatend = 0;\n-      ols--;\n-      nls--;\n+      ols--; olsf--;\n+      nls--; nlsf--;\n     }\n #if defined (HANDLE_MULTIBYTE)\n     }\n@@ -1784,15 +2023,17 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n   if (wsatend)\n     {\n       ols = oe;\n+      olsf = old_face + (ols - old);\n       nls = ne;\n+      nlsf = new_face + (nls - new);\n     }\n #if defined (HANDLE_MULTIBYTE)\n   /* This may not work for stateful encoding, but who cares?  To handle\n      stateful encoding properly, we have to scan each string from the\n      beginning and compare. */\n-  else if (_rl_compare_chars (ols, 0, NULL, nls, 0, NULL) == 0)\n+  else if (_rl_compare_chars (ols, 0, NULL, nls, 0, NULL) == 0 || *olsf != *nlsf)\n #else\n-  else if (*ols != *nls)\n+  else if (*ols != *nls || *olsf != *nlsf)\n #endif\n     {\n       if (*ols)\t\t\t/* don't step past the NUL */\n@@ -1809,6 +2050,8 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t  else\n \t    nls++;\n \t}\n+      olsf = old_face + (ols - old);\n+      nlsf = new_face + (nls - new);\n     }\n \n   /* count of invisible characters in the current invisible line. */\n@@ -1821,6 +2064,10 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n          visible_wrap_offset based on what we know. */\n       if (current_line == 0)\n \tvisible_wrap_offset = prompt_invis_chars_first_line;\t/* XXX */\n+#if 0\t\t/* XXX - not yet */\n+      else if (current_line == prompt_last_screen_line && wrap_offset > prompt_invis_chars_first_line)\n+\tvisible_wrap_offset = wrap_offset - prompt_invis_chars_first_line\n+#endif\n       if ((mb_cur_max == 1 || rl_byte_oriented) && current_line == 0 && visible_wrap_offset)\n \t_rl_last_c_pos += visible_wrap_offset;\n     }\n@@ -1858,19 +2105,21 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n       (((od > 0 || nd > 0) && (od <= prompt_last_invisible || nd <= prompt_last_invisible)) ||\n \t\t((od >= lendiff) && _rl_last_c_pos < PROMPT_ENDING_INDEX)))\n     {\n-#if defined (__MSDOS__)\n-      putc ('\\r', rl_outstream);\n-#else\n-      tputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif\n+      _rl_cr ();\n       if (modmark)\n \t_rl_output_some_chars (\"*\", 1);\n       _rl_output_some_chars (local_prompt, lendiff);\n       if (mb_cur_max > 1 && rl_byte_oriented == 0)\n \t{\n-\t  /* We take wrap_offset into account here so we can pass correct\n-\t     information to _rl_move_cursor_relative. */\n-\t  _rl_last_c_pos = _rl_col_width (local_prompt, 0, lendiff, 1) - wrap_offset + modmark;\n+\t  /* If we just output the entire prompt string we can take advantage\n+\t     of knowing the number of physical characters in the prompt. If\n+\t     the prompt wraps lines (lendiff clamped at nmax), we can't. */\n+\t  if (lendiff == local_prompt_len)\n+\t    _rl_last_c_pos = prompt_physical_chars + modmark;\n+\t  else\n+\t    /* We take wrap_offset into account here so we can pass correct\n+\t       information to _rl_move_cursor_relative. */\n+\t    _rl_last_c_pos = _rl_col_width (local_prompt, 0, lendiff, 1) - wrap_offset + modmark;\n \t  cpos_adjusted = 1;\n \t}\n       else\n@@ -1891,18 +2140,19 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t to just output the prompt from the beginning of the line up to the\n \t first difference, but you don't know the number of invisible\n \t characters in that case.\n-\t This needs a lot of work to be efficient. */\n+\t This needs a lot of work to be efficient, but it usually doesn't matter. */\n       if ((od <= prompt_last_invisible || nd <= prompt_last_invisible))\n \t{\n \t  nfd = new + lendiff;\t/* number of characters we output above */\n+\t  nfdf = new_face + lendiff;\n \t  nd = lendiff;\n \n \t  /* Do a dumb update and return */\n dumb_update:\n \t  temp = ne - nfd;\n \t  if (temp > 0)\n \t    {\n-\t      _rl_output_some_chars (nfd, temp);\n+\t      puts_face (nfd, nfdf, temp);\n \t      if (mb_cur_max > 1 && rl_byte_oriented == 0)\n \t\t{\n \t\t  _rl_last_c_pos += _rl_col_width (new, nd, ne - new, 1);\n@@ -1916,16 +2166,33 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t      current_line == prompt_last_screen_line &&\n \t\t      prompt_physical_chars > _rl_screenwidth &&\n \t\t      _rl_horizontal_scroll_mode == 0)\n-\t\t    {\n-\t\t      _rl_last_c_pos -= wrap_offset - prompt_invis_chars_first_line;\n-\t\t      cpos_adjusted = 1;\n-\t\t    }\n+\t\t    ADJUST_CPOS (wrap_offset - prompt_invis_chars_first_line);\n+\n+\t\t  /* If we just output a new line including the prompt, and\n+\t\t     the prompt includes invisible characters, we need to\n+\t\t     account for them in the _rl_last_c_pos calculation, since\n+\t\t     _rl_col_width does not. This happens when other code does\n+\t\t     a goto dumb_update; */\n+\t\t  else if (current_line == 0 &&\n+\t\t\t   nfd == new &&\n+\t\t\t   prompt_invis_chars_first_line &&\n+\t\t\t   local_prompt_len <= temp &&\n+\t\t\t   wrap_offset >= prompt_invis_chars_first_line &&\n+\t\t\t   _rl_horizontal_scroll_mode == 0)\n+\t\t    ADJUST_CPOS (prompt_invis_chars_first_line);\n \t\t}\n \t      else\n \t\t_rl_last_c_pos += temp;\n \t    }\n+\t  /* This is a useful heuristic, but what we really want is to clear\n+\t     if the new number of visible screen characters is less than the\n+\t     old number of visible screen characters. If the prompt has changed,\n+\t     we don't really have enough information about the visible line to\n+\t     know for sure, so we use another heuristic calclulation below. */\n \t  if (nmax < omax)\n \t    goto clear_rest_of_line;\t/* XXX */\n+\t  else if ((nmax - W_OFFSET(current_line, wrap_offset)) < (omax - W_OFFSET (current_line, visible_wrap_offset)))\n+\t    goto clear_rest_of_line;\n \t  else\n \t    return;\n \t}\n@@ -1936,7 +2203,7 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n   /* When this function returns, _rl_last_c_pos is correct, and an absolute\n      cursor position in multibyte mode, but a buffer index when not in a\n      multibyte locale. */\n-  _rl_move_cursor_relative (od, old);\n+  _rl_move_cursor_relative (od, old, old_face);\n \n #if defined (HANDLE_MULTIBYTE)\n   /* We need to indicate that the cursor position is correct in the presence of\n@@ -1954,15 +2221,76 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n      When not using multibyte characters, these are equal */\n   lendiff = (nls - nfd) - (ols - ofd);\n   if (mb_cur_max > 1 && rl_byte_oriented == 0)\n-    col_lendiff = _rl_col_width (new, nfd - new, nls - new, 1) - _rl_col_width (old, ofd - old, ols - old, 1);\n+    {\n+      int newchars, newwidth, newind;\n+      int oldchars, oldwidth, oldind;\n+\n+      newchars = nls - new;\n+      oldchars = ols - old;\n+\n+      /* If we can do it, try to adjust nls and ols so that nls-new will\n+\t contain the entire new prompt string. That way we can use\n+\t prompt_physical_chars and not have to recompute column widths.\n+\t _rl_col_width adds wrap_offset and expects the caller to compensate,\n+\t which we do below, so we do the same thing if we don't call\n+\t _rl_col_width.\n+\t We don't have to compare, since we know the characters are the same.\n+\t The check of differing numbers of invisible chars may be extraneous.\n+\t XXX - experimental */\n+      if (current_line == 0 && nfd == new && newchars > prompt_last_invisible &&\n+\t  newchars <= local_prompt_len &&\n+\t  local_prompt_len <= nmax &&\n+\t  current_invis_chars != visible_wrap_offset)\n+\t{\n+\t  while (newchars < nmax && oldchars < omax &&  newchars < local_prompt_len)\n+\t    {\n+#if defined (HANDLE_MULTIBYTE)\n+\t      newind = _rl_find_next_mbchar (new, newchars, 1, MB_FIND_NONZERO);\n+\t      oldind = _rl_find_next_mbchar (old, oldchars, 1, MB_FIND_NONZERO);\n+\n+\t      nls += newind - newchars;\n+\t      ols += oldind - oldchars;\n+\n+\t      newchars = newind;\n+\t      oldchars = oldind;\n+#else\n+\t      nls++; ols++;\n+\t      newchars++; oldchars++;\n+#endif\n+\t    }\n+\t  newwidth = (newchars == local_prompt_len) ? prompt_physical_chars + wrap_offset\n+\t  \t\t\t\t\t    : _rl_col_width (new, 0, nls - new, 1);\n+\t  /* if we changed nls and ols, we need to recompute lendiff */\n+\t  lendiff = (nls - nfd) - (ols - ofd);\n+\n+\t  nlsf = new_face + (nls - new);\n+\t  olsf = old_face + (ols - old);\n+\t}\n+      else\n+\tnewwidth = _rl_col_width (new, nfd - new, nls - new, 1);\n+\n+      oldwidth = _rl_col_width (old, ofd - old, ols - old, 1);\n+\n+      col_lendiff = newwidth - oldwidth;\n+    }\n   else\n     col_lendiff = lendiff;\n \n+  /* col_lendiff uses _rl_col_width(), which doesn't know about whether or not\n+     the multibyte characters it counts are invisible, so unless we're printing\n+     the entire prompt string (in which case we can use prompt_physical_chars)\n+     the count is short by the number of bytes in the invisible multibyte\n+     characters - the number of multibyte characters.\n+\n+     We don't have a good way to solve this without moving to something like\n+     a bitmap that indicates which characters are visible and which are\n+     invisible. We fix it up (imperfectly) in the caller and by trying to use\n+     the entire prompt string wherever we can. */\n+     \n   /* If we are changing the number of invisible characters in a line, and\n      the spot of first difference is before the end of the invisible chars,\n      lendiff needs to be adjusted. */\n-  if (current_line == 0 && /* !_rl_horizontal_scroll_mode && */\n-      current_invis_chars != visible_wrap_offset)\n+  if (current_line == 0 && current_invis_chars != visible_wrap_offset)\n     {\n       if (mb_cur_max > 1 && rl_byte_oriented == 0)\n \t{\n@@ -2004,16 +2332,13 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t only happen in a multibyte environment. */\n       if (lendiff < 0)\n \t{\n-\t  _rl_output_some_chars (nfd, temp);\n-\t  _rl_last_c_pos += col_temp;\t/* XXX - was _rl_col_width (nfd, 0, temp, 1); */\n+\t  puts_face (nfd, nfdf, temp);\n+\t  _rl_last_c_pos += col_temp;\n \t  /* If nfd begins before any invisible characters in the prompt,\n \t     adjust _rl_last_c_pos to account for wrap_offset and set\n \t     cpos_adjusted to let the caller know. */\n \t  if (current_line == 0 && displaying_prompt_first_line && wrap_offset && ((nfd - new) <= prompt_last_invisible))\n-\t    {\n-\t      _rl_last_c_pos -= wrap_offset;\t/* XXX - prompt_invis_chars_first_line? */\n-\t      cpos_adjusted = 1;\n-\t    }\n+\t    ADJUST_CPOS (wrap_offset);\t/* XXX - prompt_invis_chars_first_line? */\n \t  return;\n \t}\n       /* Sometimes it is cheaper to print the characters rather than\n@@ -2041,7 +2366,7 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t      (visible_wrap_offset >= current_invis_chars))\n \t    {\n \t      open_some_spaces (col_lendiff);\n-\t      _rl_output_some_chars (nfd, bytes_to_insert);\n+\t      puts_face (nfd, nfdf, bytes_to_insert);\n \t      if (mb_cur_max > 1 && rl_byte_oriented == 0)\n \t\t_rl_last_c_pos += _rl_col_width (nfd, 0, bytes_to_insert, 1);\n \t      else\n@@ -2051,22 +2376,19 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t    {\n \t      /* At the end of a line the characters do not have to\n \t\t be \"inserted\".  They can just be placed on the screen. */\n-\t      _rl_output_some_chars (nfd, temp);\n+\t      puts_face (nfd, nfdf, temp);\n \t      _rl_last_c_pos += col_temp;\n \t      return;\n \t    }\n \t  else\t/* just write from first difference to end of new line */\n \t    {\n-\t      _rl_output_some_chars (nfd, temp);\n+\t      puts_face (nfd, nfdf, temp);\n \t      _rl_last_c_pos += col_temp;\n \t      /* If nfd begins before the last invisible character in the\n \t\t prompt, adjust _rl_last_c_pos to account for wrap_offset\n \t\t and set cpos_adjusted to let the caller know. */\n \t      if ((mb_cur_max > 1 && rl_byte_oriented == 0) && current_line == 0 && displaying_prompt_first_line && wrap_offset && ((nfd - new) <= prompt_last_invisible))\n-\t\t{\n-\t\t  _rl_last_c_pos -= wrap_offset;\t/* XXX - prompt_invis_chars_first_line? */\n-\t\t  cpos_adjusted = 1;\n-\t\t}\n+\t\tADJUST_CPOS (wrap_offset);\t/* XXX - prompt_invis_chars_first_line? */\n \t      return;\n \t    }\n \n@@ -2076,16 +2398,13 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t prompt, adjust _rl_last_c_pos to account for wrap_offset\n \t\t and set cpos_adjusted to let the caller know. */\n \t      if ((mb_cur_max > 1 && rl_byte_oriented == 0) && current_line == 0 && displaying_prompt_first_line && wrap_offset && ((nfd - new) <= prompt_last_invisible))\n-\t\t{\n-\t\t  _rl_last_c_pos -= wrap_offset;\t/* XXX - prompt_invis_chars_first_line? */\n-\t\t  cpos_adjusted = 1;\n-\t\t}\n+\t\tADJUST_CPOS (wrap_offset);\t/* XXX - prompt_invis_chars_first_line? */\n \t    }\n \t}\n       else\n \t{\n \t  /* cannot insert chars, write to EOL */\n-\t  _rl_output_some_chars (nfd, temp);\n+\t  puts_face (nfd, nfdf, temp);\n \t  _rl_last_c_pos += col_temp;\n \t  /* If we're in a multibyte locale and were before the last invisible\n \t     char in the current line (which implies we just output some invisible\n@@ -2100,10 +2419,11 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\tdisplaying_prompt_first_line &&\n \t\twrap_offset != prompt_invis_chars_first_line &&\n \t\t((nfd-new) < (prompt_last_invisible-(current_line*_rl_screenwidth+prompt_invis_chars_first_line))))\n-\t    {\n-\t      _rl_last_c_pos -= wrap_offset - prompt_invis_chars_first_line;\n-\t      cpos_adjusted = 1;\n-\t    }\n+\t    ADJUST_CPOS (wrap_offset - prompt_invis_chars_first_line);\n+\n+\t  /* XXX - what happens if wrap_offset == prompt_invis_chars_first_line\n+\t     and we are drawing the first line (current_line == 0)? We should\n+\t     adjust by _rl_last_c_pos -= prompt_invis_chars_first_line */\n \t}\n     }\n   else\t\t\t\t/* Delete characters from line. */\n@@ -2138,18 +2458,18 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t characters in the prompt, we need to adjust _rl_last_c_pos\n \t\t in a multibyte locale to account for the wrap offset and\n \t\t set cpos_adjusted accordingly. */\n-\t      _rl_output_some_chars (nfd, bytes_to_insert);\n+\t      puts_face (nfd, nfdf, bytes_to_insert);\n \t      if (mb_cur_max > 1 && rl_byte_oriented == 0)\n \t\t{\n+\t\t  /* This still doesn't take into account whether or not the\n+\t\t     characters that this counts are invisible. */\n \t\t  _rl_last_c_pos += _rl_col_width (nfd, 0, bytes_to_insert, 1);\n \t\t  if (current_line == 0 && wrap_offset &&\n \t\t\tdisplaying_prompt_first_line &&\n-\t\t\t_rl_last_c_pos >= wrap_offset &&\t/* XXX was > */\n+\t\t\tprompt_invis_chars_first_line &&\n+\t\t\t_rl_last_c_pos >= prompt_invis_chars_first_line &&\n \t\t\t((nfd - new) <= prompt_last_invisible))\n-\t\t    {\n-\t\t      _rl_last_c_pos -= wrap_offset;\t/* XXX - prompt_invis_chars_first_line? */\n-\t\t      cpos_adjusted = 1;\n-\t\t    }\n+\t\t    ADJUST_CPOS (prompt_invis_chars_first_line);\n \n #if 1\n #ifdef HANDLE_MULTIBYTE\n@@ -2172,7 +2492,7 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t so we move there with _rl_move_cursor_relative */\n \t      if (_rl_horizontal_scroll_mode && ((oe-old) > (ne-new)))\n \t\t{\n-\t\t  _rl_move_cursor_relative (ne-new, new);\n+\t\t  _rl_move_cursor_relative (ne-new, new, new_face);\n \t\t  goto clear_rest_of_line;\n \t\t}\n \t    }\n@@ -2186,18 +2506,15 @@ update_line (char *old, char *new, int current_line, int omax, int nmax, int inv\n \t\t characters in the prompt, we need to adjust _rl_last_c_pos\n \t\t in a multibyte locale to account for the wrap offset and\n \t\t set cpos_adjusted accordingly. */\n-\t      _rl_output_some_chars (nfd, temp);\n+\t      puts_face (nfd, nfdf, temp);\n \t      _rl_last_c_pos += col_temp;\t\t/* XXX */\n \t      if (mb_cur_max > 1 && rl_byte_oriented == 0)\n \t\t{\n \t\t  if (current_line == 0 && wrap_offset &&\n \t\t\tdisplaying_prompt_first_line &&\n \t\t\t_rl_last_c_pos > wrap_offset &&\n \t\t\t((nfd - new) <= prompt_last_invisible))\n-\t\t    {\n-\t\t      _rl_last_c_pos -= wrap_offset;\t/* XXX - prompt_invis_chars_first_line? */\n-\t\t      cpos_adjusted = 1;\n-\t\t    }\n+\t\t    ADJUST_CPOS (wrap_offset);\t/* XXX - prompt_invis_chars_first_line? */\n \t\t}\n \t    }\n clear_rest_of_line:\n@@ -2246,11 +2563,7 @@ rl_clear_visible_line (void)\n   int curr_line;\n \n   /* Make sure we move to column 0 so we clear the entire line */\n-#if defined (__MSDOS__)\n-  putc ('\\r', rl_outstream);\n-#else\n-  tputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif\n+  _rl_cr ();\n   _rl_last_c_pos = 0;\n \n   /* Move to the last screen line of the current visible line */\n@@ -2363,8 +2676,8 @@ rl_redraw_prompt_last_line (void)\n    DATA is the contents of the screen line of interest; i.e., where\n    the movement is being done.\n    DATA is always the visible line or the invisible line */\n-void\n-_rl_move_cursor_relative (int new, const char *data)\n+static void\n+_rl_move_cursor_relative (int new, const char *data, const char *dataf)\n {\n   register int i;\n   int woff;\t\t\t/* number of invisible chars on current line */\n@@ -2461,11 +2774,7 @@ _rl_move_cursor_relative (int new, const char *data)\n   if (dpos == 0 || CR_FASTER (dpos, _rl_last_c_pos) ||\n       (_rl_term_autowrap && i == _rl_screenwidth))\n     {\n-#if defined (__MSDOS__)\n-      putc ('\\r', rl_outstream);\n-#else\n-      tputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif /* !__MSDOS__ */\n+      _rl_cr ();\n       cpos = _rl_last_c_pos = 0;\n     }\n \n@@ -2497,14 +2806,12 @@ _rl_move_cursor_relative (int new, const char *data)\n \t    }\n \t  else\n \t    {\n-\t      tputs (_rl_term_cr, 1, _rl_output_character_function);\n-\t      for (i = 0; i < new; i++)\n-\t\tputc (data[i], rl_outstream);\n+\t      _rl_cr ();\n+\t      puts_face (data, dataf, new);\n \t    }\n \t}\n       else\n-\tfor (i = cpos; i < new; i++)\n-\t  putc (data[i], rl_outstream);\n+\tputs_face (data + cpos, dataf + cpos, new - cpos);\n     }\n \n #if defined (HANDLE_MULTIBYTE)\n@@ -2532,11 +2839,7 @@ _rl_move_vert (int to)\n     {\n       for (i = 0; i < delta; i++)\n \tputc ('\\n', rl_outstream);\n-#if defined (__MSDOS__)\n-      putc ('\\r', rl_outstream);\n-#else\n-      tputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif\n+      _rl_cr ();\n       _rl_last_c_pos = 0;\n     }\n   else\n@@ -2877,14 +3180,18 @@ space_to_eol (int count)\n }\n \n void\n-_rl_clear_screen (void)\n+_rl_clear_screen (int clrscr)\n {\n #if defined (__DJGPP__)\n   ScreenClear ();\n   ScreenSetCursor (0, 0);\n #else\n   if (_rl_term_clrpag)\n-    tputs (_rl_term_clrpag, 1, _rl_output_character_function);\n+    {\n+      tputs (_rl_term_clrpag, 1, _rl_output_character_function);\n+      if (clrscr && _rl_term_clrscroll)\n+\ttputs (_rl_term_clrscroll, 1, _rl_output_character_function);\n+    }\n   else\n     rl_crlf ();\n #endif /* __DJGPP__ */\n@@ -2964,6 +3271,9 @@ _rl_update_final (void)\n {\n   int full_lines, woff, botline_length;\n \n+  if (line_structures_initialized == 0)\n+    return;\n+\n   full_lines = 0;\n   /* If the cursor is the only thing on an otherwise-blank last line,\n      compensate so we don't print an extra CRLF. */\n@@ -2979,18 +3289,20 @@ _rl_update_final (void)\n   /* If we've wrapped lines, remove the final xterm line-wrap flag. */\n   if (full_lines && _rl_term_autowrap && botline_length == _rl_screenwidth)\n     {\n-      char *last_line;\n+      char *last_line, *last_face;\n \n       /* LAST_LINE includes invisible characters, so if you want to get the\n \t last character of the first line, you have to take WOFF into account.\n \t This needs to be done for both calls to _rl_move_cursor_relative,\n \t which takes a buffer position as the first argument, and any direct\n \t subscripts of LAST_LINE. */\n       last_line = &visible_line[vis_lbreaks[_rl_vis_botlin]]; /* = VIS_CHARS(_rl_vis_botlin); */\n+      last_face = &vis_face[vis_lbreaks[_rl_vis_botlin]]; /* = VIS_CHARS(_rl_vis_botlin); */\n       cpos_buffer_position = -1;\t/* don't know where we are in buffer */\n-      _rl_move_cursor_relative (_rl_screenwidth - 1 + woff, last_line);\t/* XXX */\n+      _rl_move_cursor_relative (_rl_screenwidth - 1 + woff, last_line, last_face);\t/* XXX */\n       _rl_clear_to_eol (0);\n-      putc (last_line[_rl_screenwidth - 1 + woff], rl_outstream);\n+      puts_face (&last_line[_rl_screenwidth - 1 + woff],\n+\t\t &last_face[_rl_screenwidth - 1 + woff], 1);\n     }\n   _rl_vis_botlin = 0;\n   if (botline_length > 0 || _rl_last_c_pos > 0)\n@@ -3003,15 +3315,8 @@ _rl_update_final (void)\n static void\n cr (void)\n {\n-  if (_rl_term_cr)\n-    {\n-#if defined (__MSDOS__)\n-      putc ('\\r', rl_outstream);\n-#else\n-      tputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif\n-      _rl_last_c_pos = 0;\n-    }\n+  _rl_cr ();\n+  _rl_last_c_pos = 0;\n }\n \n /* Redraw the last line of a multi-line prompt that may possibly contain\n@@ -3054,24 +3359,19 @@ _rl_redisplay_after_sigwinch (void)\n     {\n       _rl_move_vert (_rl_vis_botlin);\n \n-#if defined (__MSDOS__)\n-      putc ('\\r', rl_outstream);\n-#else\n-      tputs (_rl_term_cr, 1, _rl_output_character_function);\n-#endif\n+      _rl_cr ();\n       _rl_last_c_pos = 0;\n-#if defined (__MSDOS__)\n-      space_to_eol (_rl_screenwidth);\n-      putc ('\\r', rl_outstream);\n-#else\n+\n+#if !defined (__MSDOS__)\n       if (_rl_term_clreol)\n \ttputs (_rl_term_clreol, 1, _rl_output_character_function);\n       else\n+#endif\n \t{\n \t  space_to_eol (_rl_screenwidth);\n-\t  tputs (_rl_term_cr, 1, _rl_output_character_function);\n+\t  _rl_cr ();\n \t}\n-#endif\n+\n       if (_rl_last_v_pos > 0)\n \t_rl_move_vert (0);\n     }\n@@ -3136,6 +3436,14 @@ _rl_current_display_line (void)\n   return ret;\n }\n \n+void\n+_rl_refresh_line (void)\n+{\n+  rl_clear_visible_line ();\n+  rl_redraw_prompt_last_line ();\n+  rl_keep_mark_active ();\n+}\n+\n #if defined (HANDLE_MULTIBYTE)\n /* Calculate the number of screen columns occupied by STR from START to END.\n    In the case of multibyte characters with stateful encoding, we have to"
    },
    {
      "sha": "df6cd376c4763d5bae658bb9f626f7458d707452",
      "filename": "readline/readline/doc/history.3",
      "status": "modified",
      "additions": 31,
      "deletions": 24,
      "changes": 55,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/history.3",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/history.3",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/history.3?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -6,9 +6,9 @@\n .\\\"\tCase Western Reserve University\n .\\\"\tchet.ramey@case.edu\n .\\\"\n-.\\\"\tLast Change: Sun Oct  8 11:43:43 EDT 2017\n+.\\\"\tLast Change: Fri Jul 17 09:43:01 EDT 2020\n .\\\"\n-.TH HISTORY 3 \"2017 October 8\" \"GNU History 6.3\"\n+.TH HISTORY 3 \"2020 July 17\" \"GNU History 8.1\"\n .\\\"\n .\\\" File Name macro.  This used to be `.PN', for Path Name,\n .\\\" but Sun doesn't seem to like that very much.\n@@ -40,16 +40,15 @@\n .SH NAME\n history \\- GNU History Library\n .SH COPYRIGHT\n-.if t The GNU History Library is Copyright \\(co 1989-2017 by the Free Software Foundation, Inc.\n-.if n The GNU History Library is Copyright (C) 1989-2017 by the Free Software Foundation, Inc.\n+.if t The GNU History Library is Copyright \\(co 1989-2020 by the Free Software Foundation, Inc.\n+.if n The GNU History Library is Copyright (C) 1989-2020 by the Free Software Foundation, Inc.\n .SH DESCRIPTION\n Many programs read input from the user a line at a time.  The GNU\n History library is able to keep track of those lines, associate arbitrary\n data with each line, and utilize information from previous lines in\n composing new ones. \n .PP\n .SH \"HISTORY EXPANSION\"\n-.PP\n The history library supports a history expansion feature that\n is identical to the history expansion in\n .BR bash.\n@@ -80,7 +79,6 @@ history expansion character, which is \\^\\fB!\\fP\\^ by default.\n Only backslash (\\^\\fB\\e\\fP\\^) and single quotes can quote\n the history expansion character.\n .SS Event Designators\n-.PP\n An event designator is a reference to a command line entry in the\n history list.\n Unless the reference is absolute, events are relative to the current\n@@ -118,21 +116,22 @@ containing\n The trailing \\fB?\\fP may be omitted if\n .I string\n is followed immediately by a newline.\n+If \\fIstring\\fP is missing, the string from the most recent search is used;\n+it is an error if there is no previous search string.\n .TP\n .B \\d\\s+2^\\s-2\\u\\fIstring1\\fP\\d\\s+2^\\s-2\\u\\fIstring2\\fP\\d\\s+2^\\s-2\\u\n Quick substitution.  Repeat the last command, replacing\n .I string1\n with\n .IR string2 .\n Equivalent to\n-``!!:s/\\fIstring1\\fP/\\fIstring2\\fP/''\n+``!!:s\\d\\s+2^\\s-2\\u\\fIstring1\\fP\\d\\s+2^\\s-2\\u\\fIstring2\\fP\\d\\s+2^\\s-2\\u''\n (see \\fBModifiers\\fP below).\n .TP\n .B !#\n The entire command line typed so far.\n .PD\n .SS Word Designators\n-.PP\n Word designators are used to select desired words from the event.\n A\n .B :\n@@ -165,7 +164,8 @@ The last word.  This is usually the last argument, but will expand to the\n zeroth word if there is only one word in the line.\n .TP\n .B %\n-The word matched by the most recent `?\\fIstring\\fR?' search.\n+The first word matched by the most recent `?\\fIstring\\fR?' search,\n+if the search string begins with a character that is part of a word.\n .TP\n .I x\\fB\\-\\fPy\n A range of words; `\\-\\fIy\\fR' abbreviates `0\\-\\fIy\\fR'.\n@@ -182,14 +182,15 @@ Abbreviates \\fIx\\-$\\fP.\n .TP\n .B x\\-\n Abbreviates \\fIx\\-$\\fP like \\fBx*\\fP, but omits the last word.\n+If \\fBx\\fP is missing, it defaults to 0.\n .PD\n .PP\n If a word designator is supplied without an event specification, the\n previous command is used as the event.\n .SS Modifiers\n-.PP\n After the optional word designator, there may appear a sequence of\n one or more of the following modifiers, each preceded by a `:'.\n+These modify, or edit, the word or words selected from the history event.\n .PP\n .PD 0\n .PP\n@@ -219,23 +220,28 @@ Quote the substituted words as with\n but break into words at\n .B blanks\n and newlines.\n+The \\fBq\\fP and \\fBx\\fP modifiers are mutually exclusive; the last one\n+supplied is used.\n .TP\n .B s/\\fIold\\fP/\\fInew\\fP/\n Substitute\n .I new\n for the first occurrence of\n .I old\n-in the event line.  Any delimiter can be used in place of /.  The\n-final delimiter is optional if it is the last character of the\n-event line.  The delimiter may be quoted in\n+in the event line.\n+Any character may be used as the delimiter in place of /.\n+The final delimiter is optional if it is the last character of the\n+event line.\n+The delimiter may be quoted in\n .I old\n and\n .I new\n with a single backslash.  If & appears in\n .IR new ,\n it is replaced by\n .IR old .\n-A single backslash will quote the &.  If\n+A single backslash will quote the &.\n+If\n .I old\n is null, it is set to the last\n .I old\n@@ -245,6 +251,11 @@ the last\n in a\n .B !?\\fIstring\\fR\\fB[?]\\fR\n search.\n+If\n+.I new\n+is null, each matching\n+.I old\n+is deleted.\n .TP\n .B &\n Repeat the previous substitution.\n@@ -259,13 +270,13 @@ if it is the last character of the event line.\n An \\fBa\\fP may be used as a synonym for \\fBg\\fP.\n .TP\n .B G\n-Apply the following `\\fBs\\fP' modifier once to each word in the event line.\n+Apply the following `\\fBs\\fP' or `\\fB&\\fP' modifier once to each word\n+in the event line.\n .PD\n .SH \"PROGRAMMING WITH HISTORY FUNCTIONS\"\n This section describes how to use the History library in other programs.\n .SS Introduction to History\n-.PP\n-The programmer using the History library has available functions\n+A programmer using the History library has available functions\n for remembering lines on a history list, associating arbitrary data\n with a line, removing lines from the list, searching through the list\n for a line containing an arbitrary text string, and referencing any line\n@@ -280,7 +291,7 @@ in new commands.  The basic history manipulation commands are\n identical to\n the history substitution provided by \\fBbash\\fP.\n .PP\n-If the programmer desires, he can use the Readline library, which\n+The programmer can also use the Readline library, which\n includes some history manipulation by default, and has the added\n advantage of command line editing.\n .PP\n@@ -292,9 +303,7 @@ in any file that uses the\n History library's features.  It supplies extern declarations for all\n of the library's public functions and variables, and declares all of\n the public data structures.\n-\n .SS History Storage\n-.PP\n The history list is an array of history entries.  A history entry is\n declared as follows:\n .PP\n@@ -330,7 +339,6 @@ typedef struct _hist_state {\n If the flags member includes \\fBHS_STIFLED\\fP, the history has been\n stifled.\n .SH \"History Functions\"\n-.PP\n This section describes the calling sequence for the various functions\n exported by the GNU History library.\n .SS Initializing History and State Management\n@@ -349,7 +357,6 @@ Return a structure describing the current state of the input history.\n Set the state of the history list according to \\fIstate\\fP.\n \n .SS History List Management\n-\n These functions manage individual entries on the history list, or set\n parameters managing the list itself.\n \n@@ -545,7 +552,7 @@ if the returned line should be displayed, but not executed,\n as with the \\fB:p\\fP modifier.\n .PD\n .RE\n-If an error ocurred in expansion, then \\fIoutput\\fP contains a descriptive\n+If an error occurred in expansion, then \\fIoutput\\fP contains a descriptive\n error message.\n \n .Fn3 \"char *\" get_history_event \"const char *string\" \"int *cindex\" \"int qchar\"\n@@ -583,7 +590,7 @@ The number of entries currently stored in the history list.\n The maximum number of history entries.  This must be changed using\n \\fBstifle_history()\\fP.\n \n-.Vb int history_wite_timestamps\n+.Vb int history_write_timestamps\n If non-zero, timestamps are written to the history file, so they can be\n preserved between sessions.  The default value is 0, meaning that\n timestamps are not saved."
    },
    {
      "sha": "7a3a4767e7a591ded5f14e0b4879cd4a28358e37",
      "filename": "readline/readline/doc/history.texi",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/history.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/history.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/history.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -12,7 +12,7 @@ This document describes the GNU History library\n a programming tool that provides a consistent user interface for\n recalling lines of previously typed input.\n \n-Copyright @copyright{} 1988--2016 Free Software Foundation, Inc.\n+Copyright @copyright{} 1988--2020 Free Software Foundation, Inc.\n \n @quotation\n Permission is granted to copy, distribute and/or modify this document"
    },
    {
      "sha": "7ac11953df304255a3f64424ab073656ab731e84",
      "filename": "readline/readline/doc/hstech.texi",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/hstech.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/hstech.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/hstech.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n @ignore\n This file documents the user interface to the GNU History library.\n \n-Copyright (C) 1988-2016 Free Software Foundation, Inc.\n+Copyright (C) 1988-2020 Free Software Foundation, Inc.\n Authored by Brian Fox and Chet Ramey.\n \n Permission is granted to make and distribute verbatim copies of this manual\n@@ -48,7 +48,7 @@ History library is able to keep track of those lines, associate arbitrary\n data with each line, and utilize information from previous lines in\n composing new ones. \n \n-The programmer using the History library has available functions\n+A programmer using the History library has available functions\n for remembering lines on a history list, associating arbitrary data\n with a line, removing lines from the list, searching through the list\n for a line containing an arbitrary text string, and referencing any line\n@@ -62,7 +62,7 @@ commands for manipulating the text of previous lines and using that text\n in new commands.  The basic history manipulation commands are similar to\n the history substitution provided by @code{csh}.\n \n-If the programmer desires, he can use the Readline library, which\n+The programmer can also use the Readline library, which\n includes some history manipulation by default, and has the added\n advantage of command line editing.\n "
    },
    {
      "sha": "5e30ded7896e753141d6be32f54c90b82b2381f8",
      "filename": "readline/readline/doc/hsuser.texi",
      "status": "modified",
      "additions": 31,
      "deletions": 8,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/hsuser.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/hsuser.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/hsuser.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n @ignore\n This file documents the user interface to the GNU History library.\n \n-Copyright (C) 1988--2018 Free Software Foundation, Inc.\n+Copyright (C) 1988--2020 Free Software Foundation, Inc.\n Authored by Brian Fox and Chet Ramey.\n \n Permission is granted to make and distribute verbatim copies of this manual\n@@ -151,7 +151,14 @@ Both @var{first} and\n @var{last} may be specified as a string (to locate the most recent\n command beginning with that string) or as a number (an index into the\n history list, where a negative number is used as an offset from the\n-current command number).  If @var{last} is not specified, it is set to\n+current command number).\n+\n+When listing, a @var{first} or @var{last} of 0 is equivalent to -1\n+and -0 is equivalent to the current command (usually the @code{fc}\n+command);\n+otherwise 0 is equivalent to -1 and -0 is invalid.\n+\n+If @var{last} is not specified, it is set to\n @var{first}.  If @var{first} is not specified, it is set to the previous\n command for editing and @minus{}16 for listing.  If the @option{-l} flag is\n given, the commands are listed on standard output.  The @option{-n} flag\n@@ -166,7 +173,7 @@ When editing is complete, the edited commands are echoed and executed.\n \n In the second form, @var{command} is re-executed after each instance\n of @var{pat} in the selected command is replaced by @var{rep}.\n-@var{command} is intepreted the same as @var{first} above.\n+@var{command} is interpreted the same as @var{first} above.\n \n A useful alias to use with the @code{fc} command is @code{r='fc -s'}, so\n that typing @samp{r cc} runs the last command beginning with @code{cc}\n@@ -372,11 +379,13 @@ containing @var{string}.\n The trailing\n @samp{?} may be omitted if the @var{string} is followed immediately by\n a newline.\n+If @var{string} is missing, the string from the most recent search is used;\n+it is an error if there is no previous search string.\n \n @item @code{^@var{string1}^@var{string2}^}\n Quick Substitution.  Repeat the last command, replacing @var{string1}\n with @var{string2}.  Equivalent to\n-@code{!!:s/@var{string1}/@var{string2}/}.\n+@code{!!:s^@var{string1}^@var{string2}^}.\n \n @item @code{!#}\n The entire command line typed so far.\n@@ -428,7 +437,8 @@ The first argument; that is, word 1.\n The last argument.\n \n @item %\n-The word matched by the most recent @samp{?@var{string}?} search.\n+The first word matched by the most recent @samp{?@var{string}?} search,\n+if the search string begins with a character that is part of a word.\n \n @item @var{x}-@var{y}\n A range of words; @samp{-@var{y}} abbreviates @samp{0-@var{y}}.\n@@ -443,6 +453,7 @@ Abbreviates @samp{@var{x}-$}\n \n @item @var{x}-\n Abbreviates @samp{@var{x}-$} like @samp{@var{x}*}, but omits the last word.\n+If @samp{x} is missing, it defaults to 0.\n \n @end table\n \n@@ -454,6 +465,7 @@ previous command is used as the event.\n \n After the optional word designator, you can add a sequence of one or more\n of the following modifiers, each preceded by a @samp{:}.\n+These modify, or edit, the word or words selected from the history event.\n \n @table @code\n \n@@ -480,15 +492,25 @@ Quote the substituted words, escaping further substitutions.\n @item x\n Quote the substituted words as with @samp{q},\n but break into words at spaces, tabs, and newlines.\n+The @samp{q} and @samp{x} modifiers are mutually exclusive; the last one\n+supplied is used.\n @end ifset\n \n @item s/@var{old}/@var{new}/\n Substitute @var{new} for the first occurrence of @var{old} in the\n-event line.  Any delimiter may be used in place of @samp{/}.\n+event line.\n+Any character may be used as the delimiter in place of @samp{/}.\n The delimiter may be quoted in @var{old} and @var{new}\n with a single backslash.  If @samp{&} appears in @var{new},\n it is replaced by @var{old}.  A single backslash will quote\n-the @samp{&}.  The final delimiter is optional if it is the last\n+the @samp{&}.\n+If @var{old} is null, it is set to the last @var{old}\n+substituted, or, if no previous history substitutions took place,\n+the last @var{string}\n+in a !?@var{string}@code{[?]}\n+search.\n+If @var{new} is is null, each matching @var{old} is deleted.\n+The final delimiter is optional if it is the last\n character on the input line.\n \n @item &\n@@ -501,6 +523,7 @@ conjunction with @samp{s}, as in @code{gs/@var{old}/@var{new}/},\n or with @samp{&}.\n \n @item G\n-Apply the following @samp{s} modifier once to each word in the event.\n+Apply the following @samp{s} or @samp{&} modifier once to each word\n+in the event.\n \n @end table"
    },
    {
      "sha": "179c7814bcd384110e37df8e072a6841e08693f2",
      "filename": "readline/readline/doc/readline.3",
      "status": "modified",
      "additions": 29,
      "deletions": 24,
      "changes": 53,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/readline.3",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/readline.3",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/readline.3?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -6,9 +6,9 @@\n .\\\"\tCase Western Reserve University\n .\\\"\tchet.ramey@case.edu\n .\\\"\n-.\\\"\tLast Change: Thu Dec 28 14:49:51 EST 2017\n+.\\\"\tLast Change: Tue Mar 24 09:27:30 EDT 2020\n .\\\"\n-.TH READLINE 3 \"2017 December 28\" \"GNU Readline 7.0\"\n+.TH READLINE 3 \"2020 October 29\" \"GNU Readline 8.1\"\n .\\\"\n .\\\" File Name macro.  This used to be `.PN', for Path Name,\n .\\\" but Sun doesn't seem to like that very much.\n@@ -34,8 +34,8 @@ readline \\- get a line from a user with editing\n \\fBreadline\\fP (\\fIconst char *prompt\\fP);\n .fi\n .SH COPYRIGHT\n-.if n Readline is Copyright (C) 1989\\-2014 Free Software Foundation,  Inc.\n-.if t Readline is Copyright \\(co 1989\\-2014 Free Software Foundation, Inc.\n+.if n Readline is Copyright (C) 1989\\-2020 Free Software Foundation,  Inc.\n+.if t Readline is Copyright \\(co 1989\\-2020 Free Software Foundation, Inc.\n .SH DESCRIPTION\n .LP\n .B readline\n@@ -163,7 +163,6 @@ In addition to command names, readline allows keys to be bound\n to a string that is inserted when the key is pressed (a \\fImacro\\fP).\n .PP\n .SS Key Bindings\n-.PP\n The syntax for controlling key bindings in the\n .I inputrc\n file is simple.  All that is required is the name of the\n@@ -318,7 +317,6 @@ similar mechanisms.  The\n file may be edited and re-read if a program does not provide\n any other means to incorporate new bindings.\n .SS Variables\n-.PP\n Readline has variables that can be used to further customize its\n behavior.  A variable may be set in the\n .I inputrc\n@@ -405,10 +403,11 @@ replaced with an ellipsis when displaying possible completions.\n This determines when the user is queried about viewing\n the number of possible completions\n generated by the \\fBpossible\\-completions\\fP command.\n-It may be set to any integer value greater than or equal to\n-zero.  If the number of possible completions is greater than\n-or equal to the value of this variable, the user is asked whether\n-or not he wishes to view them; otherwise they are simply listed\n+It may be set to any integer value greater than or equal to zero.\n+If the number of possible completions is greater than\n+or equal to the value of this variable,\n+readline will ask whether or not the user wishes to view them;\n+otherwise they are simply listed\n on the terminal.  A negative value causes readline to never ask.\n .TP\n .B convert\\-meta (On)\n@@ -448,7 +447,7 @@ Use the \\e1 and \\e2 escapes to begin and end sequences of\n non-printing characters, which can be used to embed a terminal control \n sequence into the mode string.\n .TP\n-.B enable\\-bracketed\\-paste (Off)\n+.B enable\\-bracketed\\-paste (On)\n When set to \\fBOn\\fP, readline will configure the terminal in a way\n that will enable it to insert each paste into the editing buffer as a\n single string of characters, instead of treating each character as if\n@@ -488,6 +487,7 @@ the maximum number of history entries will be set to 500.\n When set to \\fBOn\\fP, makes readline use a single line for display,\n scrolling the input horizontally on a single screen line when it\n becomes longer than the screen width rather than wrapping to a new line.\n+This setting is automatically enabled for terminals of height 1.\n .TP\n .B input\\-meta (Off)\n If set to \\fBOn\\fP, readline will enable eight-bit input (that is,\n@@ -633,7 +633,6 @@ by \\fIstat\\fP(2) is appended to the filename when listing possible\n completions.\n .PD\n .SS Conditional Constructs\n-.PP\n Readline implements a facility similar in spirit to the conditional\n compilation features of the C preprocessor which allows key\n bindings and variable settings to be performed as the result\n@@ -731,7 +730,6 @@ would read \\fI/etc/inputrc\\fP:\n .fi \n .RE\n .SH SEARCHING\n-.PP\n Readline provides commands for searching through the command history\n for lines containing a specified string.\n There are two search modes:\n@@ -771,7 +769,6 @@ Non-incremental searches read the entire search string before starting\n to search for matching history lines.  The search string may be\n typed by the user or be part of the contents of the current line.\n .SH EDITING COMMANDS\n-.PP\n The following is a list of the names of the commands and the default\n key sequences to which they are bound.\n Command names without an accompanying key sequence are unbound by default.\n@@ -781,7 +778,6 @@ position, and \\fImark\\fP refers to a cursor position saved by the\n \\fBset\\-mark\\fP command.\n The text between the point and mark is referred to as the \\fIregion\\fP.\n .SS Commands for Moving\n-.PP\n .PD 0\n .TP\n .B beginning\\-of\\-line (C\\-a)\n@@ -817,16 +813,22 @@ Readline line does not take up more than one physical line or if the length\n of the current Readline line is not greater than the length of the prompt\n plus the screen width.\n .TP\n+.B clear\\-display (M\\-C\\-l)\n+Clear the screen and, if possible, the terminal's scrollback buffer,\n+then redraw the current line,\n+leaving the current line at the top of the screen.\n+.TP\n .B clear\\-screen (C\\-l)\n-Clear the screen leaving the current line at the top of the screen.\n+Clear the screen,\n+then redraw the current line,\n+leaving the current line at the top of the screen.\n With an argument, refresh the current line without clearing the\n screen.\n .TP\n .B redraw\\-current\\-line\n Refresh the current line.\n .PD\n .SS Commands for Manipulating the History\n-.PP\n .PD 0\n .TP\n .B accept\\-line (Newline, Return)\n@@ -917,9 +919,17 @@ the direction to move through the history.  A negative argument switches\n the direction through the history (back or forward).\n The history expansion facilities are used to extract the last argument,\n as if the \"!$\" history expansion had been specified.\n+.TP\n+.B\n+operate\\-and\\-get\\-next (C\\-o)\n+Accept the current line for return to the calling application as if a\n+newline had been entered,\n+and fetch the next line relative to the current line from the history\n+for editing.\n+A numeric argument, if supplied, specifies the history entry to use instead\n+of the current line.\n .PD\n .SS Commands for Changing Text\n-.PP\n .PD 0\n .TP\n .B \\fIend\\-of\\-file\\fP (usually C\\-d)\n@@ -994,7 +1004,6 @@ Characters bound to \\fBbackward\\-delete\\-char\\fP replace the character\n before point with a space.  By default, this command is unbound.\n .PD\n .SS Killing and Yanking\n-.PP\n .PD 0\n .TP\n .B kill\\-line (C\\-k)\n@@ -1057,7 +1066,6 @@ or\n .BR yank\\-pop .\n .PD\n .SS Numeric Arguments\n-.PP\n .PD 0\n .TP\n .B digit\\-argument (M\\-0, M\\-1, ..., M\\-\\-)\n@@ -1079,7 +1087,6 @@ first time makes the argument count four, a second time makes the\n argument count sixteen, and so on.\n .PD\n .SS Completing\n-.PP\n .PD 0\n .TP\n .B complete (TAB)\n@@ -1136,7 +1143,6 @@ If at the end of the line, behaves identically to\n \\fBpossible-completions\\fP.\n .PD\n .SS Keyboard Macros\n-.PP\n .PD 0\n .TP\n .B start\\-kbd\\-macro (C\\-x (\\^)\n@@ -1155,7 +1161,6 @@ Print the last keyboard macro defined in a format suitable for the\n \\fIinputrc\\fP file.\n .PD\n .SS Miscellaneous\n-.PP\n .PD 0\n .TP\n .B re\\-read\\-init\\-file (C\\-x C\\-r)\n@@ -1331,6 +1336,7 @@ Emacs Meta bindings\n \"M-C-H\"  backward-kill-word\n \"M-C-I\"  tab-insert\n \"M-C-J\"  vi-editing-mode\n+\"M-C-L\"  clear-display\n \"M-C-M\"  vi-editing-mode\n \"M-C-R\"  revert-line\n \"M-C-Y\"  yank-nth-arg\n@@ -1535,5 +1541,4 @@ Comments and bug reports concerning\n this manual page should be directed to\n .IR chet.ramey@case.edu .\n .SH BUGS\n-.PP\n It's too big and too slow."
    },
    {
      "sha": "ec7487b7a78812f10d236078f88fd1b431aa03c5",
      "filename": "readline/readline/doc/rlman.texi",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rlman.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rlman.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/rlman.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -13,7 +13,7 @@ This manual describes the GNU Readline Library\n consistency of user interface across discrete programs which provide\n a command line interface.\n \n-Copyright @copyright{} 1988--2016 Free Software Foundation, Inc.\n+Copyright @copyright{} 1988--2020 Free Software Foundation, Inc.\n \n @quotation\n Permission is granted to copy, distribute and/or modify this document"
    },
    {
      "sha": "bbf57c239c92fad7286aa15ee3508ca08fc277b3",
      "filename": "readline/readline/doc/rltech.texi",
      "status": "modified",
      "additions": 34,
      "deletions": 8,
      "changes": 42,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rltech.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rltech.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/rltech.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -7,7 +7,7 @@ This document describes the GNU Readline Library, a utility for aiding\n in the consistency of user interface across discrete programs that need\n to provide a command line interface.\n \n-Copyright (C) 1988--2016 Free Software Foundation, Inc.\n+Copyright (C) 1988--2020 Free Software Foundation, Inc.\n \n Permission is granted to make and distribute verbatim copies of\n this manual provided the copyright notice and this permission notice\n@@ -1342,6 +1342,29 @@ This differs from @code{clear_history} because it frees private data\n Readline saves in the history list.\n @end deftypefun\n \n+@deftypefun {void} rl_activate_mark (void)\n+Enable an @emph{active} mark.\n+When this is enabled, the text between point and mark (the @var{region}) is\n+displayed in the terminal's standout mode (a @var{face}).\n+This is called by various readline functions that set the mark and insert\n+text, and is available for applications to call.\n+@end deftypefun\n+\n+@deftypefun {void} rl_deactivate_mark (void)\n+Turn off the active mark.\n+@end deftypefun\n+\n+@deftypefun {void} rl_keep_mark_active (void)\n+Indicate that the mark should remain active when the current readline function\n+completes and after redisplay occurs.\n+In most cases, the mark remains active for only the duration of a single\n+bindable readline function.\n+@end deftypefun\n+\n+@deftypefun {int} rl_mark_active_p (void)\n+Return a non-zero value if the mark is currently active; zero otherwise.\n+@end deftypefun\n+\n @node Alternate Interface\n @subsection Alternate Interface\n \n@@ -1733,8 +1756,8 @@ to determine whether or not there are any pending signals.\n \n If an application does not wish Readline to catch @code{SIGWINCH}, it may\n call @code{rl_resize_terminal()} or @code{rl_set_screen_size()} to force\n-Readline to update its idea of the terminal size when a @code{SIGWINCH}\n-is received.\n+Readline to update its idea of the terminal size when it receives\n+a @code{SIGWINCH}.\n \n @deftypefun void rl_echo_signal_char (int sig)\n If an application wishes to install its own signal handlers, but still\n@@ -1751,11 +1774,14 @@ Update Readline's internal screen size by reading values from the kernel.\n Set Readline's idea of the terminal size to @var{rows} rows and\n @var{cols} columns.  If either @var{rows} or @var{columns} is less than\n or equal to 0, Readline's idea of that terminal dimension is unchanged.\n+This is intended to tell Readline the physical dimensions of the terminal,\n+and is used internally to calculate the maximum number of characters that\n+may appear on a single line and on the screen.\n @end deftypefun\n \n If an application does not want to install a @code{SIGWINCH} handler, but\n-is still interested in the screen dimensions, Readline's idea of the screen\n-size may be queried.\n+is still interested in the screen dimensions, it may query Readline's idea\n+of the screen size.\n \n @deftypefun void rl_get_screen_size (int *rows, int *cols)\n Return Readline's idea of the terminal's size in the\n@@ -2039,7 +2065,7 @@ remove any quote characters from the directory name, because its result will\n be passed directly to @code{opendir()}.\n \n The directory rewrite hook returns an integer that should be non-zero if\n-the function modfies its directory argument.\n+the function modifies its directory argument.\n The function should not modify the directory argument if it returns 0.\n @end deftypevar\n \n@@ -2051,7 +2077,7 @@ is passed to @code{stat()} to determine the file's type and characteristics.\n This function does not need to remove quote characters from the filename.\n \n The stat hook returns an integer that should be non-zero if\n-the function modfies its directory argument.\n+the function modifies its directory argument.\n The function should not modify the directory argument if it returns 0.\n @end deftypevar\n \n@@ -2645,7 +2671,7 @@ com_help (arg)\n \n   if (!printed)\n     @{\n-      printf (\"No commands match `%s'.  Possibilties are:\\n\", arg);\n+      printf (\"No commands match `%s'.  Possibilities are:\\n\", arg);\n \n       for (i = 0; commands[i].name; i++)\n         @{"
    },
    {
      "sha": "26b0ff072c7a8503f3e9e567ca4cfecdd3dcc506",
      "filename": "readline/readline/doc/rluser.texi",
      "status": "modified",
      "additions": 56,
      "deletions": 23,
      "changes": 79,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rluser.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rluser.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/rluser.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -9,7 +9,7 @@ use these features.  There is a document entitled \"readline.texinfo\"\n which contains both end-user and programmer documentation for the\n GNU Readline Library.\n \n-Copyright (C) 1988--2016 Free Software Foundation, Inc.\n+Copyright (C) 1988--2020 Free Software Foundation, Inc.\n \n Authored by Brian Fox and Chet Ramey.\n \n@@ -350,6 +350,11 @@ file is taken from the value of the environment variable @env{INPUTRC}.  If\n that variable is unset, the default is @file{~/.inputrc}.  If that\n file does not exist or cannot be read, the ultimate default is\n @file{/etc/inputrc}.\n+@ifset BashFeatures\n+The @w{@code{bind}} builtin command can also be used to set Readline\n+keybindings and variables.\n+@xref{Bash Builtins}.\n+@end ifset\n \n When a program which uses the Readline library starts up, the\n init file is read, and the key bindings are set.\n@@ -488,9 +493,9 @@ replaced with an ellipsis when displaying possible completions.\n @vindex completion-query-items\n The number of possible completions that determines when the user is\n asked whether the list of possibilities should be displayed.\n-If the number of possible completions is greater than this value,\n-Readline will ask the user whether or not he wishes to view\n-them; otherwise, they are simply listed.\n+If the number of possible completions is greater than or equal to this value,\n+Readline will ask whether or not the user wishes to view them;\n+otherwise, they are simply listed.\n This variable must be set to an integer value greater than or equal to 0.\n A negative value means Readline should never ask.\n The default limit is @code{100}.\n@@ -541,7 +546,7 @@ When set to @samp{On}, Readline will configure the terminal in a way\n that will enable it to insert each paste into the editing buffer as a\n single string of characters, instead of treating each character as if\n it had been read from the keyboard.  This can prevent pasted characters\n-from being interpreted as editing commands.  The default is @samp{off}.\n+from being interpreted as editing commands.  The default is @samp{On}.\n \n @item enable-keypad\n @vindex enable-keypad\n@@ -583,8 +588,9 @@ the maximum number of history entries will be set to 500.\n This variable can be set to either @samp{on} or @samp{off}.  Setting it\n to @samp{on} means that the text of the lines being edited will scroll\n horizontally on a single screen line when they are longer than the width\n-of the screen, instead of wrapping onto a new screen line.  By default,\n-this variable is set to @samp{off}.\n+of the screen, instead of wrapping onto a new screen line.\n+This variable is automatically set to @samp{on} for terminals of height 1.\n+By default, this variable is set to @samp{off}.\n \n @item input-meta\n @vindex input-meta\n@@ -1109,8 +1115,8 @@ set convert-meta off\n # rather than as meta-prefixed characters\n set output-meta on\n \n-# if there are more than 150 possible completions for\n-# a word, ask the user if he wants to see all of them\n+# if there are 150 or more possible completions for a word,\n+# ask whether or not the user wants to see all of them\n set completion-query-items 150\n \n # For FTP\n@@ -1173,11 +1179,11 @@ Move back to the start of the current or previous word.\n Words are composed of letters and digits.\n \n @ifset BashFeatures\n-@item shell-forward-word ()\n+@item shell-forward-word (M-C-f)\n Move forward to the end of the next word.\n Words are delimited by non-quoted shell metacharacters.\n \n-@item shell-backward-word ()\n+@item shell-backward-word (M-C-b)\n Move back to the start of the current or previous word.\n Words are delimited by non-quoted shell metacharacters.\n @end ifset\n@@ -1195,8 +1201,14 @@ Readline line does not take up more than one physical line or if the length\n of the current Readline line is not greater than the length of the prompt\n plus the screen width.\n \n+@item clear-display (M-C-l)\n+Clear the screen and, if possible, the terminal's scrollback buffer,\n+then redraw the current line,\n+leaving the current line at the top of the screen.\n+\n @item clear-screen (C-l)\n-Clear the screen and redraw the current line,\n+Clear the screen,\n+then redraw the current line,\n leaving the current line at the top of the screen.\n \n @item redraw-current-line ()\n@@ -1242,10 +1254,12 @@ being entered.\n @item reverse-search-history (C-r)\n Search backward starting at the current line and moving `up' through\n the history as necessary.  This is an incremental search.\n+This command sets the region to the matched text and activates the mark.\n \n @item forward-search-history (C-s)\n Search forward starting at the current line and moving `down' through\n the history as necessary.  This is an incremental search.\n+This command sets the region to the matched text and activates the mark.\n \n @item non-incremental-reverse-search-history (M-p)\n Search backward starting at the current line and moving `up'\n@@ -1310,6 +1324,14 @@ the direction through the history (back or forward).\n The history expansion facilities are used to extract the last argument,\n as if the @samp{!$} history expansion had been specified.\n \n+@item operate-and-get-next (C-o)\n+Accept the current line for return to the calling application as if a\n+newline had been entered,\n+and fetch the next line relative to the current line from the history\n+for editing.\n+A numeric argument, if supplied, specifies the history entry to use instead\n+of the current line.\n+\n @end ftable\n \n @node Commands For Text\n@@ -1357,6 +1379,11 @@ each character as if it had been read from the keyboard.  The characters\n are inserted as if each one was bound to @code{self-insert} instead of\n executing any editing commands.\n \n+Bracketed paste sets the region (the characters between point and the mark)\n+to the inserted text. It uses the concept of an @emph{active mark}: when the\n+mark is active, Readline redisplay uses the terminal's standout mode to\n+denote the region.\n+\n @item transpose-chars (C-t)\n Drag the character before the cursor forward over\n the character at the cursor, moving the\n@@ -1406,9 +1433,13 @@ By default, this command is unbound.\n \n @item kill-line (C-k)\n Kill the text from point to the end of the line.\n+With a negative numeric argument, kill backward from the cursor to the\n+beginning of the current line.\n \n @item backward-kill-line (C-x Rubout)\n Kill backward from the cursor to the beginning of the current line.\n+With a negative numeric argument, kill forward from the cursor to the\n+end of the current line.\n \n @item unix-line-discard (C-u)\n Kill backward from the cursor to the beginning of the current line.\n@@ -1427,7 +1458,7 @@ Kill the word behind point.\n Word boundaries are the same as @code{backward-word}.\n \n @ifset BashFeatures\n-@item shell-kill-word ()\n+@item shell-kill-word (M-C-d)\n Kill from point to the end of the current word, or if between\n words, to the end of the next word.\n Word boundaries are the same as @code{shell-forward-word}.\n@@ -1437,6 +1468,14 @@ Kill the word behind point.\n Word boundaries are the same as @code{shell-backward-word}.\n @end ifset\n \n+@item shell-transpose-words (M-C-t)\n+Drag the word before point past the word after point,\n+moving point past that word as well.\n+If the insertion point is at the end of the line, this transposes\n+the last two words on the line.\n+Word boundaries are the same as @code{shell-forward-word} and\n+@code{shell-backward-word}.\n+\n @item unix-word-rubout (C-w)\n Kill the word behind point, using white space as a word boundary.\n The killed text is saved on the kill-ring.\n@@ -1774,12 +1813,6 @@ Perform history and alias expansion on the current line.\n @item insert-last-argument (M-. or M-_)\n A synonym for @code{yank-last-arg}.\n \n-@item operate-and-get-next (C-o)\n-Accept the current line for execution and fetch the next line\n-relative to the current line from the history for editing.\n-A numeric argument, if supplied, specifies the history entry to use instead\n-of the current line.\n-\n @item edit-and-execute-command (C-x C-e)\n Invoke an editor on the current command line, and execute the result as shell\n commands.\n@@ -2044,7 +2077,7 @@ The @option{-E} option indicates that other supplied options and actions should\n apply to ``empty'' command completion; that is, completion attempted on a \n blank line.\n The @option{-I} option indicates that other supplied options and actions should\n-apply to completion on the inital non-assignment word on the line, or after a\n+apply to completion on the initial non-assignment word on the line, or after a\n command delimiter such as @samp{;} or @samp{|}, which is usually command\n name completion.\n If multiple options are supplied, the @option{-D} option takes precedence\n@@ -2255,7 +2288,7 @@ The @option{-E} option indicates that other supplied options should\n apply to ``empty'' command completion; that is, completion attempted on a \n blank line.\n The @option{-I} option indicates that other supplied options should\n-apply to completion on the inital non-assignment word on the line, or after a\n+apply to completion on the initial non-assignment word on the line, or after a\n command delimiter such as @samp{;} or @samp{|}, which is usually command\n name completion.\n \n@@ -2370,7 +2403,7 @@ character to the directory name, in case we want to append to it.\n The @option{-o bashdefault} option brings in the rest of the \"Bash default\"\n completions -- possible completion that Bash adds to the default Readline\n set.  These include things like command name completion, variable completion\n-for words beginning with @samp{@{}, completions containing pathname\n+for words beginning with @samp{$} or @samp{$@{}, completions containing pathname\n expansion patterns (@pxref{Filename Expansion}), and so on.\n \n Once installed using @code{complete}, @code{_comp_cd} will be called every\n@@ -2380,7 +2413,7 @@ Many more examples -- an extensive collection of completions for most of\n the common GNU, Unix, and Linux commands -- are available as part of the\n bash_completion project.  This is installed by default on many GNU/Linux\n distributions.  Originally written by Ian Macdonald, the project now lives\n-at @url{http://bash-completion.alioth.debian.org/}.  There are ports for\n+at @url{https://github.com/scop/bash-completion/}.  There are ports for\n other systems such as Solaris and Mac OS X.\n \n An older version of the bash_completion package is distributed with bash"
    },
    {
      "sha": "6e8e848b6e5ae993259eb3a964e8573fe3a73fc5",
      "filename": "readline/readline/doc/rluserman.texi",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rluserman.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/rluserman.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/rluserman.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -12,7 +12,7 @@ This manual describes the end user interface of the GNU Readline Library\n consistency of user interface across discrete programs which provide\n a command line interface.\n \n-Copyright @copyright{} 1988--2016 Free Software Foundation, Inc.\n+Copyright @copyright{} 1988--2020 Free Software Foundation, Inc.\n \n @quotation\n Permission is granted to copy, distribute and/or modify this document"
    },
    {
      "sha": "17f43557ba804306ba98fb9c2ab5d70242ff33f8",
      "filename": "readline/readline/doc/texi2dvi",
      "status": "modified",
      "additions": 866,
      "deletions": 814,
      "changes": 1680,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/texi2dvi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/texi2dvi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/texi2dvi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,10 +1,7 @@\n #! /bin/sh\n # texi2dvi --- produce DVI (or PDF) files from Texinfo (or (La)TeX) sources.\n-# $Id: texi2dvi 5704 2014-07-07 17:45:16Z karl $\n #\n-# Copyright 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2001, 2002,\n-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014\n-# Free Software Foundation, Inc.\n+# Copyright 1992-2019 Free Software Foundation, Inc.\n #\n # This program is free software; you can redistribute it and/or modify\n # it under the terms of the GNU General Public License as published by\n@@ -36,20 +33,17 @@ set -e\n # In case the default sed doesn't suffice.\n : ${SED=sed}\n \n-# This string is expanded automatically when this file is checked out.\n-rcs_revision='$Revision: 5704 $'\n-rcs_version=`set - $rcs_revision; echo $2`\n program=`echo $0 | $SED -e 's!.*/!!'`\n \n build_mode=${TEXI2DVI_BUILD_MODE:-local}\n build_dir=${TEXI2DVI_BUILD_DIRECTORY:-.}\n \n+orig_pwd=`pwd`\n+\n # Initialize variables for option overriding and otherwise.\n # Don't use `unset' since old bourne shells don't have this command.\n # Instead, assign them an empty value.\n action=compile\n-batch=false     # interact normally\n-catcode_special=maybe\n debug=false\n escape=\"\\\\\"\n expand=false    # true for expansion via makeinfo\n@@ -68,84 +62,188 @@ txiprereq=19990129 # minimum texinfo.tex version with macro expansion\n verb=false      # true for verbose mode\n translate_file= # name of charset translation file\n \n-orig_pwd=`pwd`\n-\n # We have to initialize IFS to space tab newline since we save and\n # restore IFS and apparently POSIX allows stupid/broken behavior with\n # empty-but-set IFS.\n # http://lists.gnu.org/archive/html/automake-patches/2006-05/msg00008.html\n-# We need space, tab and new line, in precisely that order.  And don't leave\n+# We need space, tab and newline, in precisely that order.  And don't leave\n # trailing blanks.\n space=' '\n tab='\t'\n newline='\n '\n IFS=\"$space$tab$newline\"\n \n-# In case someone pedantic insists on using grep -E.\n : ${EGREP=egrep}\n \n # Systems which define $COMSPEC or $ComSpec use semicolons to separate\n-# directories in TEXINPUTS -- except for Cygwin et al., where COMSPEC\n+# directories in TEXINPUTS -- except for Cygwin and Msys, where COMSPEC\n # might be inherited, but : is used.\n+\n+# In the case of Msys, uname returns a value derived from MSYSTEM, as\n+# MSYSTEM is user configurable, it is not so safe to use it to detect\n+# Msys. It is safer to use OSTYPE, this is why we set MSYSTEM to\n+# $OSTYPE before calling uname\n if test -n \"$COMSPEC$ComSpec\" \\\n-   && uname | $EGREP -iv 'cygwin|mingw|djgpp' >/dev/null; then\n+   && MSYSTEM=$OSTYPE uname | $EGREP -iv 'cygwin|msys' >/dev/null; then\n   path_sep=\";\"\n else\n   path_sep=\":\"\n fi\n \n+\n # Pacify verbose cds.\n CDPATH=${ZSH_VERSION+.}$path_sep\n \n-# If $TEX is set to a directory, don't use it.\n-test -n \"$TEX\" && test -d \"$TEX\" && unset TEX\n \n-# \f\n-## --------------------- ##\n-## Auxiliary functions.  ##\n-## --------------------- ##\n-\n-# In case `local' is not supported by the shell, provide a function\n-# that simulates it by simply performing the assignments.  This means\n-# that we must not expect `local' to work, i.e., we must not (i) rely\n-# on it during recursion, and (ii) have two local declarations of the\n-# same variable.  (ii) is easy to check statically, and our test suite\n-# does make sure there is never twice a static local declaration of a\n-# variable.  (i) cannot be checked easily, so just be careful.\n-#\n-# Note that since we might use a function simulating `local', we can\n-# no longer rely on the fact that no IFS-splitting is performed.  So,\n-# while\n-#\n-# foo=$bar\n-#\n-# is fine (no IFS-splitting), never write\n-#\n-# local foo=$bar\n-#\n-# but rather\n+# Now we define numerous functions, with no other executable code.\n+# The main program is at the end of the file.\n+\n+\t\n+# \f Standard help and version functions.\n #\n-# local foo=\"$bar\"\n-(\n-  foo=bar\n-  test_local () {\n-    local foo=foo\n-  }\n-  test_local >/dev/null 2>&1\n-  test $foo = bar\n-) || eval '\n-local () {\n+# usage - display usage and exit successfully.\n+usage ()\n+{\n+  cat <<EOF\n+Usage: $program [OPTION]... FILE...\n+  or:  texi2pdf [OPTION]... FILE...\n+  or:  pdftexi2dvi [OPTION]... FILE...\n+\n+Run each Texinfo or (La)TeX FILE through TeX in turn until all\n+cross-references are resolved, building all indices.  The directory\n+containing each FILE is searched for included files.  The suffix of FILE\n+is used to determine its language ((La)TeX or Texinfo).  To process\n+(e)plain TeX files, set the environment variable LATEX=tex.\n+\n+When invoked as \\`texi2pdf' or given the option --pdf generate PDF output.\n+Otherwise, generate DVI.\n+\n+General options:\n+  -D, --debug         turn on shell debugging (set -x)\n+  -h, --help          display this help and exit successfully\n+  -o, --output=OFILE  leave output in OFILE; only one input FILE is allowed\n+  -q, --quiet         no output unless errors\n+  -v, --version       display version information and exit successfully\n+  -V, --verbose       report on what is done\n+  --max-iterations=N  don't process files more than N times [$max_iters]\n+  --mostly-clean      remove auxiliary files or directories from\n+                          previous runs (but not the output)\n+\n+Output format:\n+      --dvi     output a DVI file [default]\n+      --dvipdf  output a PDF file via DVI (using a dvi-to-pdf program)\n+      --html    output an HTML file from LaTeX, using HeVeA\n+      --info    output an Info file from LaTeX, using HeVeA\n+  -p, --pdf     use pdftex or pdflatex for processing\n+      --ps      output a PostScript file via DVI (using dvips)\n+      --text    output a plain text file from LaTeX, using HeVeA\n+\n+TeX tuning:\n+  -E, --expand               macro expansion using makeinfo\n+  -I DIR                     search DIR for Texinfo files\n+  -l, --language=LANG        specify LANG for FILE, either latex or texinfo\n+      --no-line-error        do not pass --file-line-error to TeX\n+      --shell-escape         pass --shell-escape to TeX\n+      --src-specials         pass --src-specials to TeX\n+      --translate-file=FILE  use given charset translation file for TeX\n+  -t, --command=CMD          insert CMD in copy of input file\n+\n+Build modes:\n+  --build=MODE         specify the treatment of auxiliary files [$build_mode]\n+      --tidy           same as --build=tidy\n+  -c, --clean          same as --build=clean\n+      --build-dir=DIR  specify where the tidy compilation is performed;\n+                         implies --tidy;\n+                         defaults to TEXI2DVI_BUILD_DIRECTORY [$build_dir]\n+\n+The MODE specifies where the TeX compilation takes place, and, as a\n+consequence, how auxiliary files are treated.  The build mode can also\n+be set using the environment variable TEXI2DVI_BUILD_MODE.\n+\n+Valid values of MODE are:\n+  \\`local'      compile in the current directory, leaving all the auxiliary\n+               files around.  This is the traditional TeX use.\n+  \\`tidy'       compile in a local *.t2d directory, where the auxiliary files\n+               are left.  Output files are copied back to the original file.\n+  \\`clean'      same as \\`tidy', but remove the auxiliary directory afterwards.\n+               Every compilation therefore requires the full cycle.\n+\n+The values of these environment variables are used to run the\n+corresponding commands, if they are set:\n+\n+  BIBER BIBTEX DVIPDF DVIPS EGREP HEVEA LATEX MAKEINDEX MAKEINFO\n+  PDFLATEX PDFTEX SED T4HT TEX TEX4HT TEXINDEX TEXINDY THUMBPDF_CMD\n+\n+Regarding --dvipdf, if DVIPDF is not set in the environment, the\n+following programs are looked for (in this order): dvipdfmx dvipdfm\n+dvipdf dvi2pdf dvitopdf.\n+\n+If Texinfo is installed on your site, then the command\n+\n+  info texi2dvi\n+  \n+should give you access to more documentation.\n+\n+Report bugs to bug-texinfo@gnu.org,\n+general questions and discussion to help-texinfo@gnu.org.\n+GNU Texinfo home page: <http://www.gnu.org/software/texinfo/>\n+General help using GNU software: <http://www.gnu.org/gethelp/>\n+EOF\n+  exit 0\n+}\n+\n+\n+# version - Display version info and exit successfully.\n+version ()\n+{\n+  cat <<EOF\n+texi2dvi (GNU Texinfo 6.7)\n+\n+Copyright (C) 2019 Free Software Foundation, Inc.\n+License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n+This is free software: you are free to change and redistribute it.\n+There is NO WARRANTY, to the extent permitted by law.\n+EOF\n+  exit 0\n+}\n+\n+\n+# \f Generic auxiliary functions.\n+\n+# Used to access files and directories after we have changed directory\n+# (for --tidy).\n+rel=\n+\n+# Change directory, updating some relative paths.\n+cd_dir ()\n+{\n+  cd \"$1\"\n+\n+  # Check if argument or input file is absolute, and if so, make all the path \n+  # variables absolute.\n+  use_absolute=false\n   case $1 in\n-    *=*) eval \"$1\";;\n+  [\\\\/]* | ?:[\\\\/]*)  # absolute path\n+    use_absolute=true ;;\n+  esac\n+  case $in_input in\n+  [\\\\/]* | ?:[\\\\/]*)\n+    use_absolute=true ;;\n   esac\n-}\n-'\n \n+  if $use_absolute ; then\n+    for cdd_dir in work_build workdir t2ddir work_bak in_input in_dir; do\n+      eval \"$cdd_dir=\\`absolute \\$$cdd_dir\\`\"\n+    done\n+    return\n+  fi\n+\n+  # Replace each path component with \"..\" and add a single trailing slash.\n+  rel=`echo \"$1\" | \\$SED -e 's/[^/\\\\][^/\\\\]*/../g' -e 's/[/\\\\]*$/\\//'`\n+}\n \n-# cd_orig\n-# -------\n-# Return to the original directory.\n+# cd_orig - Return to the original directory.\n cd_orig ()\n {\n   # In case $orig_pwd is on a different drive (for DOS).\n@@ -155,57 +253,50 @@ cd_orig ()\n   # - the next file is processed in correct conditions\n   # - the temporary file can be removed\n   cd \"$orig_pwd\" || exit 1\n+\n+  rel=\n }\n \n-# func_dirname FILE\n-# -----------------\n-# Return the directory part of FILE.\n+\n+# func_dirname FILE - Return the directory part of FILE.\n func_dirname ()\n {\n   dirname \"$1\" 2>/dev/null \\\n   || { echo \"$1\" | $SED 's!/[^/]*$!!;s!^$!.!'; }\n }\n \n \n-# noexit FILE\n-# -----------\n-# Return FILE with one extension remove.  foo.bar.baz -> foo.bar.\n+# noext FILE - Return FILE with one extension removed:\n+#   foo.bar.baz -> foo.bar\n noext ()\n {\n   echo \"$1\" | $SED -e 's/\\.[^/.][^/.]*$//'\n }\n \n \n-# absolute NAME -> ABS-NAME\n-# -------------------------\n-# Return an absolute path to NAME.\n+# absolute NAME - Return an absolute path to NAME.\n absolute ()\n {\n   case $1 in\n    [\\\\/]* | ?:[\\\\/]*)\n       # Absolute paths don't need to be expanded.\n       echo \"$1\"\n       ;;\n-   *) local slashes\n-      slashes=`echo \"$1\" | $SED -n 's,.*[^/]\\(/*\\)$,\\1,p'`\n-      local rel\n-      rel=$orig_pwd/`func_dirname \"$1\"`\n-      if test -d \"$rel\"; then\n-        (cd \"$rel\" 2>/dev/null \\\n-         && local n\n-         n=`pwd`/`basename \"$1\"`\"$slashes\"\n-         echo \"$n\")\n+   *) absolute_slashes=`echo \"$1\" | $SED -n 's,.*[^/]\\(/*\\)$,\\1,p'`\n+      absolute_rel=$orig_pwd/`func_dirname \"$1\"`\n+      if test -d \"$absolute_rel\"; then\n+        (cd \"$absolute_rel\" 2>/dev/null \\\n+         && absolute_name=`pwd`/`basename \"$1\"`\"$absolute_slashes\"\n+         echo \"$absolute_name\")\n       else\n-        error 1 \"not a directory: $rel\"\n+        error 1 \"not a directory: $absolute_rel\"\n       fi\n       ;;\n   esac\n }\n \n \n-# ensure_dir DIR1 DIR2...\n-# -----------------------\n-# Make sure the directories exist.\n+# ensure_dir DIR1 DIR2... - Make sure given directories exist.\n ensure_dir ()\n {\n   for dir\n@@ -221,26 +312,23 @@ ensure_dir ()\n }\n \n \n-# error EXIT_STATUS LINE1 LINE2...\n-# --------------------------------\n-# Report an error and exit with failure if EXIT_STATUS is non-null.\n+# error EXIT_STATUS LINE1 LINE2... - Report an error and exit with\n+#   failure if EXIT_STATUS is non-null.\n error ()\n {\n-  local s=\"$1\"\n+  error_status=\"$1\"\n   shift\n   report \"$@\"\n-  if test \"$s\" != 0; then\n-    exit $s\n+  if test \"$error_status\" != 0; then\n+    exit $error_status\n   fi\n }\n \n \n-# findprog PROG\n-# -------------\n-# Return true if PROG is somewhere in PATH, else false.\n+# findprog PROG - Return true if PROG is somewhere in PATH, else false.\n findprog ()\n {\n-  local saveIFS=\"$IFS\"\n+  saveIFS=\"$IFS\"\n   IFS=$path_sep  # break path components at the path separator\n   for dir in $PATH; do\n     IFS=$saveIFS\n@@ -261,9 +349,7 @@ findprog ()\n   return 1\n }\n \n-# report LINE1 LINE2...\n-# ---------------------\n-# Report some information on stderr.\n+# report LINE1 LINE2... - Echo each argument to stderr.\n report ()\n {\n   for i in \"$@\"\n@@ -273,9 +359,7 @@ report ()\n }\n \n \n-# run COMMAND-LINE\n-# ----------------\n-# Run the COMMAND-LINE verbosely, and catching errors as failures.\n+# run COMMAND-LINE - Run COMMAND-LINE verbosely, catching errors as failures.\n run ()\n {\n   verbose \"Running $@\"\n@@ -284,135 +368,7 @@ run ()\n }\n \n \n-# usage\n-# -----\n-# Display usage and exit successfully.\n-usage ()\n-{\n-  # We used to simply have `echo \"$usage\"', but coping with the\n-  # changing behavior of `echo' is much harder than simply using a\n-  # here-doc.\n-  #\n-  #             echo '\\noto'   echo '\\\\noto'   echo -e '\\\\noto'\n-  # bash 3.1      \\noto           \\\\noto          \\noto\n-  # bash 3.2       %oto           \\noto           -e \\noto\n-  #\n-  # where % denotes the eol character.\n-  cat <<EOF\n-Usage: $program [OPTION]... FILE...\n-  or:  texi2pdf [OPTION]... FILE...\n-  or:  pdftexi2dvi [OPTION]... FILE...\n-\n-Run each Texinfo or (La)TeX FILE through TeX in turn until all\n-cross-references are resolved, building all indices.  The directory\n-containing each FILE is searched for included files.  The suffix of FILE\n-is used to determine its language ((La)TeX or Texinfo).  To process\n-(e)plain TeX files, set the environment variable LATEX=tex.\n-\n-In order to make texi2dvi a drop-in replacement of TeX/LaTeX in AUC-TeX,\n-the FILE may also be composed of the following simple TeX commands.\n-  \\`\\\\input{FILE}'     the actual file to compile\n-  \\`\\\\nonstopmode'     same as --batch\n-\n-When invoked as \\`texi2pdf' or \\`pdftexi2dvi', or given the option --pdf\n-or --dvipdf, generate PDF output.  Otherwise, generate DVI.\n-\n-General options:\n-  -b, --batch         no interaction\n-  -D, --debug         turn on shell debugging (set -x)\n-  -h, --help          display this help and exit successfully\n-  -o, --output=OFILE  leave output in OFILE; only one input FILE is allowed\n-  -q, --quiet         no output unless errors (implies --batch)\n-  -s, --silent        same as --quiet\n-  -v, --version       display version information and exit successfully\n-  -V, --verbose       report on what is done\n-\n-Output format:\n-      --dvi     output a DVI file [default]\n-      --dvipdf  output a PDF file via DVI (using a dvi-to-pdf program)\n-      --html    output an HTML file from LaTeX, using HeVeA\n-      --info    output an Info file from LaTeX, using HeVeA\n-  -p, --pdf     use pdftex or pdflatex for processing\n-      --ps      output a PostScript file via DVI (using dvips)\n-      --text    output a plain text file from LaTeX, using HeVeA\n-\n-TeX tuning:\n-  -@                         use @input instead of \\input for preloaded Texinfo\n-  -e, -E, --expand           force macro expansion using makeinfo\n-  -I DIR                     search DIR for Texinfo files\n-  -l, --language=LANG        specify LANG for FILE, either latex or texinfo\n-      --no-line-error        do not pass --file-line-error to TeX\n-      --shell-escape         pass --shell-escape to TeX\n-      --src-specials         pass --src-specials to TeX\n-  -t, --command=CMD          insert CMD in copy of input file\n-   or --texinfo=CMD          multiple values accumulate\n-      --translate-file=FILE  use given charset translation file for TeX\n-\n-Build modes:\n-  --build=MODE         specify the treatment of auxiliary files [$build_mode]\n-      --tidy           same as --build=tidy\n-  -c, --clean          same as --build=clean\n-      --build-dir=DIR  specify where the tidy compilation is performed;\n-                         implies --tidy;\n-                         defaults to TEXI2DVI_BUILD_DIRECTORY [$build_dir]\n-  --mostly-clean       remove the auxiliary files and directories\n-                         but not the output\n-  --max-iterations=N   don't process files more than N times [$max_iters]\n-\n-The MODE specifies where the TeX compilation takes place, and, as a\n-consequence, how auxiliary files are treated.  The build mode\n-can also be set using the environment variable TEXI2DVI_BUILD_MODE.\n-\n-Valid MODEs are:\n-  \\`local'      compile in the current directory, leaving all the auxiliary\n-               files around.  This is the traditional TeX use.\n-  \\`tidy'       compile in a local *.t2d directory, where the auxiliary files\n-               are left.  Output files are copied back to the original file.\n-  \\`clean'      same as \\`tidy', but remove the auxiliary directory afterwards.\n-               Every compilation therefore requires the full cycle.\n-\n-Using the \\`tidy' mode brings several advantages:\n-  - the current directory is not cluttered with plethora of temporary files.\n-  - clutter can be even further reduced using --build-dir=dir: all the *.t2d\n-    directories are stored there.\n-  - clutter can be reduced to zero using, e.g., --build-dir=/tmp/\\$USER.t2d\n-    or --build-dir=\\$HOME/.t2d.\n-  - the output file is updated after every successful TeX run, for\n-    sake of concurrent visualization of the output.  In a \\`local' build\n-    the viewer stops during the whole TeX run.\n-  - if the compilation fails, the previous state of the output file\n-    is preserved.\n-  - PDF and DVI compilation are kept in separate subdirectories\n-    preventing any possibility of auxiliary file incompatibility.\n-\n-On the other hand, because \\`tidy' compilation takes place in another\n-directory, occasionally TeX won't be able to find some files (e.g., when\n-using \\\\graphicspath): in that case, use -I to specify the additional\n-directories to consider.\n-\n-The values of the BIBER, BIBTEX, DVIPDF, DVIPS, HEVEA, LATEX, MAKEINDEX,\n-MAKEINFO, PDFLATEX, PDFTEX, SED, T4HT, TEX, TEX4HT, TEXINDEX, and THUMBPDF_CMD\n-environment variables are used to run those commands, if they are set.\n-\n-Regarding --dvipdf, if DVIPDF is not set in the environment, the\n-following programs are looked for (in this order): dvipdfmx dvipdfm\n-dvipdf dvi2pdf dvitopdf.\n-\n-Any CMD strings are added after @setfilename for Texinfo input, or in\n-the first line for LaTeX input.\n-\n-Report bugs to bug-texinfo@gnu.org,\n-general questions and discussion to help-texinfo@gnu.org.\n-GNU Texinfo home page: <http://www.gnu.org/software/texinfo/>\n-General help using GNU software: <http://www.gnu.org/gethelp/>\n-EOF\n-  exit 0\n-}\n-\n-\n-# verbose WORD1 WORD2\n-# -------------------\n-# Report some verbose information.\n+# verbose WORD1 WORD2... - Echo concatenated WORDs to stderr, if $verb.\n verbose ()\n {\n   if $verb; then\n@@ -421,134 +377,100 @@ verbose ()\n }\n \n \n-# version\n-# -------\n-# Display version info and exit successfully.\n-version ()\n-{\n-  cat <<EOF\n-texi2dvi (GNU Texinfo 5.2) $rcs_version\n-\n-Copyright (C) 2014 Free Software Foundation, Inc.\n-License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n-This is free software: you are free to change and redistribute it.\n-There is NO WARRANTY, to the extent permitted by law.\n-EOF\n-  exit 0\n-}\n-\n-\n-## ---------------- ##\n-## Handling lists.  ##\n-## ---------------- ##\n-\n-\n-# list_append LIST-NAME ELEM\n-# --------------------------\n-# Set LIST-NAME to its former contents, with ELEM appended.\n+# \f Handling lists.\n+#\n+# list_append LIST-NAME ELEM - Append ELEM to (the contents of) LIST-NAME.\n list_append ()\n {\n-  local la_l=\"$1\"\n+  list_name=\"$1\"\n   shift\n-  eval set X \\$$la_l \"$@\"\n+  eval set X \\$$list_name \"$@\"\n   shift\n-  eval $la_l=\\\"\"$@\"\\\"\n+  eval $list_name=\\\"\"$@\"\\\"\n }\n \n \n-# list_concat_dirs LIST-NAME DIR-LIST\n-# -----------------------------------\n-# Append to LIST-NAME all the components (included empty) from\n-# the $path_sep separated list DIR-LIST.  Make the paths absolute.\n+# list_concat_dirs LIST-NAME DIR-LIST - Append to LIST-NAME all the\n+# components (including empty ones) from the $path_sep-separated list\n+# DIR-LIST.  Make the paths absolute.\n list_concat_dirs ()\n {\n-  local lcd_list=\"$1\"\n+  lcd_list=\"$1\"\n   # Empty path components are meaningful to tex.  We rewrite them as\n   # `EMPTY' so they don't get lost when we split on $path_sep.\n   # Hopefully no one will have an actual directory named EMPTY.\n-  local replace_EMPTY=\"-e 's/^$path_sep/EMPTY$path_sep/g' \\\n-                       -e 's/$path_sep\\$/${path_sep}EMPTY/g' \\\n-                       -e 's/$path_sep$path_sep/${path_sep}EMPTY:/g'\"\n+  lcd_replace_EMPTY=\"-e 's/^$path_sep/EMPTY$path_sep/g' \\\n+                     -e 's/$path_sep\\$/${path_sep}EMPTY/g' \\\n+                     -e 's/$path_sep$path_sep/${path_sep}EMPTY${path_sep}/g'\"\n   save_IFS=$IFS\n   IFS=$path_sep\n-  set x `echo \"$2\" | eval $SED $replace_EMPTY`; shift\n+  set x `echo \"$2\" | eval $SED $lcd_replace_EMPTY`; shift\n   IFS=$save_IFS\n-  local dir\n-  for dir\n+  for lcd_dir\n   do\n-    case $dir in\n+    case $lcd_dir in\n       EMPTY)\n        list_append $lcd_list \"\"\n        ;;\n       *)\n-       if test -d $dir; then\n-          dir=`absolute \"$dir\"`\n-         list_append $lcd_list \"$dir\"\n+       if test -d $lcd_dir; then\n+          dir=`absolute \"$lcd_dir\"`\n+         list_append $lcd_list \"$lcd_dir\"\n        fi\n        ;;\n     esac\n   done\n }\n \n \n-# list_prefix LIST-NAME SEP -> STRING\n-# -----------------------------------\n-# Return a string that is composed of the LIST-NAME with each item\n-# preceded by SEP.\n+# list_prefix LIST-NAME SEP -> STRING - Return string with each element\n+# of LIST-NAME preceded by SEP.\n list_prefix ()\n {\n-  local lp_p=\"$2\"\n+  lp_separator=\"$2\"\n   eval set X \\$$1\n   shift\n-  local lp_res\n+  lp_result=''\n   for i\n   do\n-    lp_res=\"$lp_res \\\"$lp_p\\\" \\\"$i\\\"\"\n+    lp_result=\"$lp_result \\\"$lp_separator\\\" \\\"$i\\\"\"\n   done\n-  echo \"$lp_res\"\n+  echo \"$lp_result\"\n }\n \n-# list_infix LIST-NAME SEP -> STRING\n-# ----------------------------------\n-# Same as list_prefix, but a separator.\n+# list_infix LIST-NAME SEP -> STRING - Same as list_prefix, but a separator.\n list_infix ()\n {\n   eval set X \\$$1\n   shift\n-  local la_IFS=\"$IFS\"\n+  save_IFS=\"$IFS\"\n   IFS=$path_sep\n   echo \"$*\"\n-  IFS=$la_IFS\n+  IFS=$save_IFS\n }\n \n-# list_dir_to_abs LIST-NAME\n-# -------------------------\n-# Convert the list to using only absolute dir names.\n+# list_dir_to_abs LIST-NAME - Convert list to using only absolute dir names.\n # Currently unused, but should replace absolute_filenames some day.\n list_dir_to_abs ()\n {\n-  local ld_l=\"$1\"\n-  eval set X \\$$ld_l\n+  ldta_list=\"$1\"\n+  eval set X \\$$ldta_list\n   shift\n-  local ld_res\n+  ldta_result=''\n   for dir\n   do\n     dir=`absolute \"$dir\"`\n     test -d \"$dir\" || continue\n-    ld_res=\"$ld_res \\\"$dir\\\"\"\n+    ldta_result=\"$ldata_result \\\"$dir\\\"\"\n   done\n-  set X $ld_res; shift\n-  eval $ld_l=\\\"$@\\\"\n+  set X $ldta_result; shift\n+  eval $ldta_list=\\\"$@\\\"\n }\n \n \n-## ------------------------------ ##\n-## Language auxiliary functions.  ##\n-## ------------------------------ ##\n-\n-\n-# out_lang_set LANG\n-# -----------------\n+# \f Language auxiliary functions. \n+#\n+# out_lang_set LANG - set $out_lang to LANG (dvi, pdf, etc.), or error.\n out_lang_set ()\n {\n   case $1 in\n@@ -557,10 +479,7 @@ out_lang_set ()\n   esac\n }\n \n-\n-# out_lang_tex\n-# ------------\n-# Return the tex output language (DVI or PDF) for $OUT_LANG.\n+# out_lang_tex - Return the tex output language (DVI or PDF) for $out_lang.\n out_lang_tex ()\n {\n   case $out_lang in\n@@ -571,10 +490,7 @@ out_lang_tex ()\n   esac\n }\n \n-\n-# out_lang_ext\n-# ------------\n-# Return the extension for $OUT_LANG.\n+# out_lang_ext - Return the extension for $out_lang (pdf, dvi, etc.).\n out_lang_ext ()\n {\n   case $out_lang in\n@@ -585,83 +501,64 @@ out_lang_ext ()\n }\n \n \n-## ------------------------- ##\n-## TeX auxiliary functions.  ##\n-## ------------------------- ##\n-\n-# Save TEXINPUTS so we can construct a new TEXINPUTS path for each file.\n-# Likewise for bibtex and makeindex.\n-tex_envvars=\"BIBINPUTS BSTINPUTS DVIPSHEADERS INDEXSTYLE MFINPUTS MPINPUTS \\\n-TEXINPUTS TFMFONTS\"\n-for var in $tex_envvars; do\n-  eval ${var}_orig=\\$$var\n-  export $var\n-done\n-\n-\n-# absolute_filenames TEX-PATH -> TEX-PATH\n-# ---------------------------------------\n-# Convert relative paths to absolute paths, so we can run in another\n-# directory (e.g., in tidy build mode, or during the macro-support\n-# detection).  Prepend \".\".\n+# \f TeX file auxiliary functions.\n+#\n+# absolute_filenames TEX-PATH -> TEX-PATH - Convert relative paths to\n+# absolute, so we can run in another directory (e.g., in tidy build\n+# mode, or during the macro-support detection).\n absolute_filenames ()\n {\n   # Empty path components are meaningful to tex.  We rewrite them as\n   # `EMPTY' so they don't get lost when we split on $path_sep.\n   # Hopefully no one will have an actual directory named EMPTY.\n-  local replace_empty=\"-e 's/^$path_sep/EMPTY$path_sep/g' \\\n-                       -e 's/$path_sep\\$/${path_sep}EMPTY/g' \\\n-                       -e 's/$path_sep$path_sep/${path_sep}EMPTY:/g'\"\n-  local res\n-  res=`echo \"$1\" | eval $SED $replace_empty`\n+  af_replace_empty=\"-e 's/^$path_sep/EMPTY$path_sep/g' \\\n+                    -e 's/$path_sep\\$/${path_sep}EMPTY/g' \\\n+                    -e 's/$path_sep$path_sep/${path_sep}EMPTY${path_sep}/g'\"\n+  af_result=`echo \"$1\" | eval $SED $af_replace_empty`\n   save_IFS=$IFS\n   IFS=$path_sep\n-  set x $res; shift\n-  res=.\n+  set x $af_result; shift\n+  af_result=\n+  af_path_sep=\n   for dir\n   do\n     case $dir in\n       EMPTY)\n-        res=$res$path_sep\n+        af_result=$af_result$af_path_sep\n         ;;\n       *)\n         if test -d \"$dir\"; then\n-          res=$res$path_sep`absolute \"$dir\"`\n+          af_result=$af_result$af_path_sep`absolute \"$dir\"`\n         else\n           # Even if $dir is not a directory, preserve it in the path.\n           # It might contain metacharacters that TeX will expand in\n           # turn, e.g., /some/path/{a,b,c}.  This will not get the\n           # implicit absolutification of the path, but we can't help that.\n-          res=$res$path_sep$dir\n+          af_result=$af_result$af_path_sep$dir\n         fi\n         ;;\n     esac\n+    af_path_sep=$path_sep\n   done\n-  echo \"$res\"\n+  echo \"$af_result\"\n }\n \n \n-# output_base_name FILE\n-# ---------------------\n-# The name of FILE, possibly renamed to satisfy --output.\n-# FILE is local, there is no directory part.\n+# output_base_name FILE - Return the name of FILE, possibly renamed to\n+# satisfy --output.  FILE is local, i.e., without any directory part.\n output_base_name ()\n {\n   case $oname in\n     '') echo \"$1\";;\n-     *) local out_noext\n-        out_noext=`noext \"$oname\"`\n-        local file_ext\n-        file_ext=`echo \"$1\" | $SED 's/^.*\\.//'`\n-        echo \"$out_noext.$file_ext\"\n+     *) obn_out_noext=`noext \"$oname\"`\n+        obn_file_ext=`echo \"$1\" | $SED 's/^.*\\.//'`\n+        echo \"$obn_out_noext.$obn_file_ext\"\n       ;;\n   esac\n }\n \n \n-# destdir\n-# -------\n-# Return the name of the directory where the output is expected.\n+# destdir - Return the directory where the output is expected.\n destdir ()\n {\n   case $oname in\n@@ -671,15 +568,13 @@ destdir ()\n }\n \n \n-# move_to_dest FILE...\n-# --------------------\n-# Move FILE to the place where the user expects it.  Truly move it, that\n-# is, it must not remain in its build location unless that is also the\n-# output location.  (Otherwise it might appear as an extra file in make\n-# distcheck.)\n+# move_to_dest FILE... - Move FILE(s) to the place where the user expects.\n+# Truly move it, that is, it must not remain in its build location\n+# unless that is also the output location.  (Otherwise it might appear\n+# as an extra file in make distcheck.)\n #\n-# FILE can be the principal output (in which case -o directly applies), or\n-# an auxiliary file with the same base name.\n+# FILE can be the principal output (in which case -o directly applies),\n+# or an auxiliary file with the same base name.\n move_to_dest ()\n {\n #  echo \"move_to_dest $*, tidy=$tidy, oname=$oname\"\n@@ -690,23 +585,17 @@ move_to_dest ()\n     false:) return;;\n   esac\n \n-  local destfile\n-  local destdir\n-  local destbase\n-  local sourcedir\n-  local sourcebase\n-\n   for file\n   do\n     test -f \"$file\" \\\n     || error 1 \"no such file or directory: $file\"\n     case $tidy:$oname in\n-      true:)  destdir=$orig_pwd\n-              destfile=$destdir/$file;;\n-      true:*) destfile=`output_base_name \"$file\"`\n-              destdir=`dirname \"$destfile\"`;;\n-      false:*) destfile=$oname\n-               destdir=`dirname \"$destfile\"`;;\n+      true:)  mtd_destdir=$orig_pwd\n+              mtd_destfile=$mtd_destdir/$file;;\n+      true:*) mtd_destfile=`output_base_name \"$file\"`\n+              mtd_destdir=`dirname \"$mtd_destfile\"`;;\n+      false:*) mtd_destfile=$oname\n+               mtd_destdir=`dirname \"$mtd_destfile\"`;;\n     esac\n  \n     # We want to compare the source location and the output location,\n@@ -716,45 +605,39 @@ move_to_dest ()\n     # directory names, canonicalized with pwd.  We can't use cmp -s\n     # since the output file might not actually change from run to run;\n     # e.g., TeX DVI output is timestamped to only the nearest minute.\n-    destdir=`cd \"$destdir\" && pwd`\n-    destbase=`basename \"$destfile\"`\n-\n-    sourcedir=`dirname \"$file\"`\n-    sourcedir=`cd \"$sourcedir\" && pwd`\n-    sourcebase=`basename \"$file\"`\n-\n-    if test \"$sourcedir/$sourcebase\" != \"$destdir/$destbase\"; then\n-      verbose \"Moving $file to $destfile\"\n-      rm -f \"$destfile\"\n-      mv \"$file\" \"$destfile\"\n+    mtd_destdir=`cd \"$mtd_destdir\" && pwd`\n+    mtd_destbase=`basename \"$mtd_destfile\"`\n+\n+    mtd_sourcedir=`dirname \"$file\"`\n+    mtd_sourcedir=`cd \"$mtd_sourcedir\" && pwd`\n+    mtd_sourcebase=`basename \"$file\"`\n+\n+    if test \"$mtd_sourcedir/$mtd_sourcebase\" != \"$mtd_destdir/$mtd_destbase\"\n+    then\n+      verbose \"Moving $file to $mtd_destfile\"\n+      rm -f \"$mtd_destfile\"\n+      mv \"$file\" \"$mtd_destfile\"\n     fi\n   done\n }\n \n \n-## --------------------- ##\n-## Managing xref files.  ##\n-## --------------------- ##\n-\n-# aux_file_p FILE\n-# ---------------\n-# Return with success if FILE is an aux file.\n+# \f Managing xref files.\n+#\n+# aux_file_p FILE - Echo FILE if FILE is an aux file.\n aux_file_p ()\n {\n-  test -f \"$1\" || return 1\n+  test -f \"$1\" || return 0\n   case $1 in\n-    *.aux) return 0;;\n-    *)     return 1;;\n+    *.aux) echo \"$1\";;\n+    *)     return 0;;\n   esac\n }\n \n-# bibaux_file_p FILE\n-# ------------------\n-# Return with success if FILE is an aux file containing citation\n-# requests.\n+# bibaux_file_p FILE - Echo FILE if FILE contains citation requests.\n bibaux_file_p ()\n {\n-  test -s \"$1\" || return 1\n+  test -s \"$1\" || return 0\n   if (grep '^\\\\bibstyle[{]' \"$1\"   \\\n       && grep '^\\\\bibdata[{]' \"$1\" \\\n       ## The following line is suspicious: fails when there\n@@ -763,38 +646,37 @@ bibaux_file_p ()\n       ## && grep '^\\\\citation[{]' \"$f\"\n       ) >&6 2>&1;\n   then\n-    return 0\n+    echo \"$1\"\n   fi\n-  return 1\n+  return 0\n }\n \n-# index_file_p FILE\n-# -----------------\n-# Return with success if FILE is an index file.\n+# index_file_p FILE - Echo FILE if FILE is an index file.\n index_file_p ()\n {\n-  test -f \"$1\" || return 1\n+  test -f \"$1\" || return 0\n   case $in_lang:$latex2html:`out_lang_tex`:`$SED '1q' \"$1\"` in\n     # When working with TeX4HT, *.idx are created by LaTeX.  They must\n     # be processed to produce *.4ix, *.4dx files.  The *.4dx file is\n     # passed to makeindex to produce the *.ind file.  This sequence is\n     # handled by run_index, so we are only interested in the *.idx\n     # files, which have each \"\\indexentry\" preceded by a\n     # \"\\beforeentry\".\n-    latex:tex4ht:html:\"\\\\beforeentry {\"*) return 0;;\n+    latex:tex4ht:html:\"\\\\beforeentry {\"*) echo $1;;\n \n     # When index.sty is used, there is a space before the brace.\n-    latex:*:*:\"\\\\indexentry{\"*|latex:*:*:\"\\\\indexentry {\"*) return 0;;\n-\n-    texinfo:*:*:\"\\\\entry{\"*) return 0;;\n+    latex:*:*:\"\\\\indexentry{\"*|latex:*:*:\"\\\\indexentry {\"*) echo $1;;\n \n-    *) return 1;;\n+    texinfo:*:*:\"\\\\entry{\"*) echo $1;;\n+    texinfo:*:*:\"@entry{\"*) echo $1;;\n+    # @entry is output from newer versions of texinfo.tex\n   esac\n+  return 0\n }\n \n-# xref_file_p FILE\n-# ----------------\n-# Return with success if FILE is an xref file (indexes, tables and lists).\n+########### not used currently\n+# xref_file_p FILE - Return success if FILE is an xref file (indexes,\n+# tables and lists).\n xref_file_p ()\n {\n   test -f \"$1\" || return 1\n@@ -810,67 +692,52 @@ xref_file_p ()\n }\n \n \n-# generated_files_get FILENAME-NOEXT [PREDICATE-FILTER]\n-# -----------------------------------------------------\n-# Return the list of files generated by the TeX compilation of FILENAME-NOEXT.\n-generated_files_get ()\n+# Used in generated_files_get\n+generated_files_get_from_log ()\n {\n-  local filter=true\n-  if test -n \"$2\"; then\n-    filter=$2\n+  if test -f \"$1.log\"; then\n+    # Usually the output is like: \\openout1 = `foobar.tex'.\n+    # (including the final period)\n+    # but luatex outputs: \\openout1 = foobar.tex\n+    # (no quotes, no period).\n+    # So we have to make the punctuation optional.\n+    grep '^\\\\openout[0-9]' \"$1.log\" \\\n+      | $SED -e \"s/\\\\\\\\openout[^=]*= *[\\`']*//\" \\\n+           -e \"s/'\\.$//\"\n   fi\n+}\n \n-  # Gather the files created by TeX.\n-  (\n-    if test -f \"$1.log\"; then\n-      $SED -n -e \"s,^\\\\\\\\openout.* = \\`\\\\(.*\\\\)'\\\\.,\\\\1,p\" \"$1.log\"\n-    fi\n-    echo \"$1.log\"\n-  ) |\n-  # Depending on these files, infer outputs from other tools.\n-  while read file; do\n-    echo $file\n-    case $in_lang in\n-      texinfo)\n-        # texindex: texinfo.cp -> texinfo.cps\n-       if index_file_p $file; then\n-         echo ${file}s\n-       fi\n-       ;;\n-      latex)\n-        if aux_file_p $file; then\n-          # bibtex: *.aux -> *.bbl and *.blg.\n-          echo $file | $SED 's/^\\(.*\\)\\.aux$/\\1.bbl/'\n-          echo $file | $SED 's/^\\(.*\\)\\.aux$/\\1.blg/'\n-          # -recorder: .fls\n-          echo $file | $SED 's/^\\(.*\\)\\.aux$/\\1.fls/'\n-       fi\n-       ;;\n-    esac\n-  done |\n-  # Filter existing files matching the criterion.\n-  #\n-  # With an input file name containing a space, this produces a\n-  # \"command not found\" message (and filtering is ineffective).\n-  # The situation with a newline is presumably even worse.\n-  while read file; do\n-    if $filter \"$file\"; then\n-      echo $file\n+# Used in generated_files_get\n+generated_files_get_from_fls ()\n+{\n+  if test -f \"$1.fls\"; then\n+    grep '^OUTPUT ' \"$1.fls\" | cut -b 8- \\\n+      | grep -v '\\.dvi$' | grep -v '\\.log$' | grep -v '\\.pdf$' || true\n+  fi\n+}\n+\n+# generated_files_get - Output the list of files generated by the TeX \n+#                       compilation.\n+generated_files_get ()\n+{\n+  $generated_files_get_method \"$in_noext\"\n+  if test $generated_files_get_method = generated_files_get_from_fls; then\n+    if test -r \"$in_noext.fl\"; then\n+      report 'WARNING!!  The fl index may typeset as garbage!' # goes to stderr\n+      report 'Try upgrading your version of texinfo.tex, or else try setting'\n+      report 'the environment variable TEXI2DVI_USE_RECORDER to '\\''no'\\''.'\n+report 'Once you'\\''ve done that, delete the file with an '\\''fl'\\'' extension.'\n     fi\n-  done |\n-  sort |\n-  # Some files are opened several times, e.g., listings.sty's *.vrb.\n-  uniq\n+  fi\n }\n \n \n-# xref_files_save\n-# ---------------\n-# Save the xref files.\n+# xref_files_save - set xref_files_orig from xref_files_new, and save xref \n+#                   files in $work_bak.\n xref_files_save ()\n {\n   # Save copies of auxiliary files for later comparison.\n-  xref_files_orig=`generated_files_get \"$in_noext\" xref_file_p`\n+  xref_files_orig=$xref_files_new\n   if test -n \"$xref_files_orig\"; then\n     verbose \"Backing up xref files: $xref_files_orig\"\n     # The following line improves `cp $xref_files_orig \"$work_bak\"'\n@@ -880,14 +747,24 @@ xref_files_save ()\n     # Users may have, e.g., --keep-old-files.  Don't let this interfere.\n     # (Don't use unset for the sake of ancient shells.)\n     TAR_OPTIONS=; export TAR_OPTIONS\n-    tar cf - $xref_files_orig | (cd \"$work_bak\" && tar xf -)\n+    tar cf - $xref_files_orig | (cd \"$rel$work_bak\" && tar xf -)\n+  fi\n+\n+  # Remove auxiliary files in same directory as main input file.  Otherwise,\n+  # these will likely be read instead of those in the build dir.\n+  if $tidy ; then\n+    secondary_xref_files=`sorted_index_files`\n+    for f in $xref_files_new $secondary_xref_files ; do\n+      if test -f \"$rel$in_dir/$f\" ; then\n+        remove $rel$in_dir/$f\n+      fi\n+    done\n   fi\n }\n \n \n-# xref_files_changed\n-# ------------------\n-# Whether the xref files were changed since the previous run.\n+# xref_files_changed - Return success if the xref files have changed\n+# since the previous run.\n xref_files_changed ()\n {\n   # LaTeX (and the package changebar) report in the LOG file if it\n@@ -898,14 +775,14 @@ xref_files_changed ()\n   if grep \"Rerun to get\" \"$in_noext.log\" >&6 2>&1; then\n     return 0\n   fi\n-  # biblatex report of whether rerunning is needed.\n+  # Similarly, check for biblatex report of whether rerunning is needed.\n   if grep \"biblatex.*(re)run\" \"$in_noext.log\" >&6 2>&1; then\n     return 0\n   fi\n \n   # If old and new lists don't have the same file list,\n   # then something has definitely changed.\n-  xref_files_new=`generated_files_get \"$in_noext\" xref_file_p`\n+  xref_files_new=`generated_files_get`\n   verbose \"Original xref files = $xref_files_orig\"\n   verbose \"New xref files      = $xref_files_new\"\n   if test \"x$xref_files_orig\" != \"x$xref_files_new\"; then\n@@ -916,31 +793,32 @@ xref_files_changed ()\n   for this_file in $xref_files_new; do\n     verbose \"Comparing xref file `echo $this_file | $SED 's|\\./||g'` ...\"\n     # cmp -s returns nonzero exit status if files differ.\n-    if cmp -s \"$this_file\" \"$work_bak/$this_file\"; then :; else\n+    if cmp -s \"$this_file\" \"$rel$work_bak/$this_file\"; then :; else\n       verbose \"xref file `echo $this_file | $SED 's|\\./||g'` differed ...\"\n       if $debug; then\n-        diff -u \"$work_bak/$this_file\" \"$this_file\"\n+        diff -u \"$rel$work_bak/$this_file\" \"$this_file\"\n       fi\n       return 0\n     fi\n   done\n \n+  secondary_xref_files=`sorted_index_files`\n+  verbose \"Secondary xref files = $secondary_xref_files\"\n+  for this_file in $secondary_xref_files; do\n+    if test -f $this_file; then :; else\n+      verbose \"$this_file missing ...\"\n+      return 0\n+    fi\n+  done\n+\n   # No change.\n   return 1\n }\n \n-\n-\n-## ----------------------- ##\n-## Running the TeX suite.  ##\n-## ----------------------- ##\n-\n-\n-\n-# run_tex ()\n-# ----------\n-# Run TeX as \"$tex $in_input\", taking care of errors and logs.\n-run_tex ()\n+# \f Running the TeX suite.\n+#\n+# Set tex_cmd variable, for running TeX.\n+make_tex_cmd ()\n {\n   case $in_lang:$latex2html:`out_lang_tex` in\n     latex:*:dvi|latex:tex4ht:html)\n@@ -955,18 +833,9 @@ run_tex ()\n                *) tex=$TEX\n         esac;;\n     texinfo:*:pdf) tex=$PDFTEX;;\n-\n     *) error 1 \"$out_lang not supported for $in_lang\";;\n   esac\n \n-  # do the special catcode trick for ~ in filenames only for Texinfo,\n-  # not LaTeX.\n-  if test x\"$in_lang\" = xtexinfo && test $catcode_special = maybe; then\n-    catcode_special=true\n-  else\n-    catcode_special=false\n-  fi\n-\n   # Beware of aux files in subdirectories that require the\n   # subdirectory to exist.\n   case $in_lang:$tidy in\n@@ -981,7 +850,7 @@ run_tex ()\n   esac\n \n   # Note that this will be used via an eval: quote properly.\n-  local cmd=\"$tex\"\n+  tex_cmd=\"$tex\"\n \n   # If possible, make TeX report error locations in GNU format.\n   if $line_error; then\n@@ -995,98 +864,90 @@ run_tex ()\n     # The mk program and perhaps others want to parse TeX's\n     # original error messages.\n     case $tex_help in\n-      *file-line-error*) cmd=\"$cmd --file-line-error\";;\n+      *file-line-error*) tex_cmd=\"$tex_cmd --file-line-error\";;\n     esac\n   fi\n \n+  # Tell TeX about -recorder option, if specified\n+  # recorder_option_maybe is in { \" -recorder\", \"\" }\n+  tex_cmd=\"$tex_cmd$recorder_option_maybe\"\n+  \n+  \n   # Tell TeX about TCX file, if specified.\n-  test -n \"$translate_file\" && cmd=\"$cmd --translate-file=$translate_file\"\n+  test -n \"$translate_file\" \\\n+                       && tex_cmd=\"$tex_cmd --translate-file=$translate_file\"\n \n   # Tell TeX to make source specials (for backtracking from output to\n   # source, given a sufficiently smart editor), if specified.\n-  test -n \"$src_specials\" && cmd=\"$cmd $src_specials\"\n+  test -n \"$src_specials\" && tex_cmd=\"$tex_cmd $src_specials\"\n \n   # Tell TeX to allow running external executables\n-  test -n \"$shell_escape\" && cmd=\"$cmd $shell_escape\"\n-\n-  # Tell TeX to be batch if requested.\n-  if $batch; then\n-    # \\batchmode does not show terminal output at all, so we don't\n-    # want that.  And even in batch mode, TeX insists on having input\n-    # from the user.  Close its stdin to make it impossible.\n-    cmd=\"$cmd </dev/null '${escape}nonstopmode'\"\n-  fi\n+  test -n \"$shell_escape\" && tex_cmd=\"$tex_cmd $shell_escape\"\n \n-  # we'd like to handle arbitrary input file names, especially\n-  # foo~bar/a~b.tex, since Debian likes ~ characters.\n-  if $catcode_special; then\n-    # $normaltilde is just to reduce line length in this source file.\n-    # The idea is to define \\normaltilde as a catcode other ~ character,\n-    # then make the active ~ be equivalent to that, instead of the plain\n-    # TeX tie.  Then when the active ~ appears in the filename, it will\n-    # be expanded to itself, as far as \\input will see.  (This is the\n-    # same thing that texinfo.tex does in general, BTW.)\n-    normaltilde=\"${escape}catcode126=12 ${escape}def${escape}normaltilde{~}\"\n-    cmd=\"$cmd '$normaltilde${escape}catcode126=13 ${escape}let~\\normaltilde '\"\n-  fi\n-  # Other special (non-active) characters could be supported by\n-  # resetting their catcodes to other on the command line and changing\n-  # texinfo.tex to initialize everything to plain catcodes.  Maybe someday.\n-\n-  # append the \\input command.\n-  cmd=\"$cmd '${escape}input'\"\n-\n-  # TeX's \\input does not (easily or reliably) support whitespace\n-  # characters or other special characters in file names.  Our intensive\n-  # use of absolute file names makes this worse: the enclosing directory\n-  # names may include white spaces.  Improve the situation using a\n-  # symbolic link to the filename in the current directory, in tidy mode\n-  # only.  Do not alter in_input.\n-  #\n-  # The filename is almost always tokenized using plain TeX conventions\n-  # (the exception would be if the user made a texinfo.fmt file).  Not\n-  # all the plain TeX special characters cause trouble, but there's no\n-  # harm in making the link.\n-  #\n-  case $tidy:`func_dirname \"$in_input\"` in\n-    true:*[\"$space$tab$newline\\\"#\\$%\\\\^_{}~\"]*)\n-      _run_tex_file_name=`basename \"$in_input\"`\n-      if test ! -f \"$_run_tex_file_name\"; then\n-        # It might not be a file, clear it.\n-        run rm -f \"$_run_tex_file_name\"\n-        run ln -s \"$in_input\"\n-      fi\n-      cmd=\"$cmd '$_run_tex_file_name'\"\n-      ;;\n+  # Run without interaction.\n+  # \\batchmode does not show terminal output at all, so we don't\n+  # want that.  And even in batch mode, TeX insists on having input\n+  # from the user.  Close its stdin to make it impossible.\n+  tex_cmd=\"$tex_cmd </dev/null '${escape}nonstopmode'\"\n+}\n \n-    *)\n-      cmd=\"$cmd '$in_input'\"\n-      ;;\n-  esac\n \n-  verbose \"$0: Running $cmd ...\"\n-  if eval \"$cmd\" >&5; then\n+# run_tex - Run TeX, taking care of errors and logs.\n+run_tex ()\n+{\n+  # Check for any unusual characters in the filename.\n+  # However, >, \\ and any whitespace characters are not supported\n+  # filenames.\n+  in_input_funnies=`echo \"$in_input\" \\\n+    | $SED -e 's![^}#$%&^_{~]!!g' -e 's!\\(.\\)!\\1\\''\n+!g' | uniq`\n+\n+  if test -n \"$in_input_funnies\" ; then\n+    # Make > an end group character, as it's unlikely to appear in\n+    # a filename.\n+    tex_cmd=\"$tex_cmd '${escape}bgroup${escape}catcode62=2${escape}relax'\"\n+\n+    # If the filename has funny characters, change the TeX category codes of \n+    # some characters within a group, and use \\expandafter to input the file\n+    # outside of the group.\n+    for w in $in_input_funnies ; do\n+      tex_cmd=\"$tex_cmd '${escape}catcode\\`${escape}$w=12${escape}relax'\"\n+    done\n+\n+    # Set \\toks0 to \"\\input FILENAME\\relax\"\n+    tex_cmd=\"$tex_cmd '${escape}toks0${escape}bgroup${escape}input' '$rel$in_input' '${escape}relax>\"\n+\n+    # Expand \\toks0 after the end of the group\n+    tex_cmd=\"$tex_cmd${escape}expandafter${escape}egroup\"\n+    tex_cmd=\"$tex_cmd${escape}the${escape}toks0${escape}relax'\"\n+  else\n+    # In the case of a simple filename, just pass the filename\n+    # with no funny tricks.\n+    tex_cmd=\"$tex_cmd '${escape}input' '$rel$in_input'\"\n+  fi\n+\n+  verbose \"$0: Running $tex_cmd ...\"\n+  if (eval \"$tex_cmd\" >&5); then\n     case $out_lang in\n       dvi | pdf ) move_to_dest \"$in_noext.$out_lang\";;\n     esac\n   else\n-    error 1 \"$tex exited with bad status, quitting.\"\n+    tex_failed=true\n   fi\n }\n \n-# run_bibtex ()\n-# -------------\n-# Run bibtex on (or biber) current file.\n-# - If its input (AUX) exists.\n-# - If some citations are missing (LOG contains `Citation').\n-#   or the LOG complains of a missing .bbl\n+\n+# run_bibtex - Run bibtex (or biber) on current file\n+# - if its input (AUX) exists,\n+# - or if some citations are missing (LOG contains `Citation'),\n+# - or if the LOG complains of a missing .bbl.\n #\n # Don't try to be too smart:\n # 1. Running bibtex only if the bbl file exists and is older than\n # the LaTeX file is wrong, since the document might include files\n # that have changed.\n #\n-# 3. Because there can be several AUX (if there are \\include's),\n+# 2. Because there can be several AUX (if there are \\include's),\n # but a single LOG, looking for missing citations in LOG is\n # easier, though we take the risk of matching false messages.\n run_bibtex ()\n@@ -1109,7 +970,7 @@ run_bibtex ()\n               && grep '^\\\\bibdata' \"$in_noext.aux\") ) \\\n         >&6 2>&1; \\\n   then\n-    bibtex_aux=`generated_files_get \"$in_noext\" bibaux_file_p`\n+    bibtex_aux=`filter_files bibaux_file_p`\n     for f in $bibtex_aux; do\n       run $bibtex \"$f\"\n     done\n@@ -1122,25 +983,38 @@ run_bibtex ()\n   fi\n }\n \n-# run_index ()\n-# ------------\n-# Run texindex (or makeindex or texindy) on current index files.  If\n-# they already exist, and after running TeX a first time the index\n-# files don't change, then there's no reason to run TeX again.  But we\n-# won't know that if the index files are out of date or nonexistent.\n+\n+# filter_file PREDICATE - Go through the list of files in xref_files_new\n+# and use PREDICATE on each one to optionally print it or print other files \n+# based on the filename.\n+filter_files ()\n+{\n+  test -n \"$xref_files_new\" || return 0\n+  echo \"$xref_files_new\" |\n+  # Filter existing files matching the criterion.\n+  #\n+  while read file; do\n+    $1 \"$file\"\n+  done |\n+  sort |\n+  # Some files are opened several times, e.g., listings.sty's *.vrb.\n+  uniq\n+}\n+\n+# run_index - Run texindex (or makeindex or texindy) on current index\n+# files.  If they already exist, and after running TeX a first time the\n+# index files don't change, then there's no reason to run TeX again.\n+# But we won't know that if the index files are out of date or nonexistent.\n run_index ()\n {\n-  local index_files\n-  index_files=`generated_files_get $in_noext index_file_p`\n+  index_files=`filter_files index_file_p`\n   test -n \"$index_files\" \\\n   || return 0\n \n   : ${MAKEINDEX:=makeindex}\n   : ${TEXINDEX:=texindex}\n   : ${TEXINDY:=texindy}\n \n-  local index_file\n-  local index_noext\n   case $in_lang:$latex2html:`out_lang_tex` in\n     latex:tex4ht:html)\n       for index_file in $index_files\n@@ -1168,16 +1042,14 @@ run_index ()\n }\n \n \n-# run_tex4ht ()\n-# -------------\n-# Run the last two phases of TeX4HT: tex4ht extracts the HTML from the\n-# instrumented DVI file, and t4ht converts the figures and installs\n-# the files when given -d.\n+# run_tex4ht - Run the last two phases of TeX4HT: tex4ht extracts the\n+# HTML from the instrumented DVI file, and t4ht converts the figures and\n+# installs the files when given -d.\n #\n # Because knowing exactly which files are created is complex (in\n # addition the names are not simple to compute), which makes it\n-# difficult to install the output files in a second step, it is much\n-# simpler to install directly the output files.\n+# difficult to install the output files in a second step, we\n+# tell t4ht to install the output files.\n run_tex4ht ()\n {\n   case $in_lang:$latex2html:`out_lang_tex` in\n@@ -1191,8 +1063,7 @@ run_tex4ht ()\n }\n \n \n-# run_thumbpdf ()\n-# ---------------\n+# run_thumbpdf - Run thumbpdf.\n run_thumbpdf ()\n {\n   if test `out_lang_tex` = pdf \\\n@@ -1212,14 +1083,15 @@ run_thumbpdf ()\n }\n \n \n-# run_dvipdf FILE.dvi\n-# -------------------\n-# Convert FILE.dvi to FILE.pdf.\n+# run_dvipdf FILE.dvi - Convert FILE.dvi to FILE.pdf.\n run_dvipdf ()\n {\n   # Find which dvi->pdf program is available.\n-  if test -z \"$dvipdf\"; then\n-    for i in \"$DVIPDF\" dvipdfmx dvipdfm dvipdf dvi2pdf dvitopdf; do\n+  if test -n \"$DVIPDF\"; then\n+    dvipdf=$DVIPDF  # user envvar, use it without checking\n+\n+  elif test -z \"$dvipdf\"; then\n+    for i in dvipdfmx dvipdfm dvipdf dvi2pdf dvitopdf; do\n       if findprog $i; then\n         dvipdf=$i\n       fi\n@@ -1234,43 +1106,53 @@ run_dvipdf ()\n   fi\n }\n \n-# run_tex_suite ()\n-# ----------------\n-# Run the TeX tools until a fix point is reached.\n+# run_tex_suite - Run the TeX tools until a stable point is reached.\n run_tex_suite ()\n {\n+  make_tex_cmd\n+\n   # Move to the working directory.\n   if $tidy; then\n     verbose \"cd $work_build\"\n-    cd \"$work_build\" || exit 1\n+    cd_dir \"$work_build\" || exit 1\n   fi\n \n   # Count the number of cycles.\n-  local cycle=0\n+  suite_cycle=0\n+\n+  # Start by checking the log files for what files were created last\n+  # time.  This will mean that if they don't change, we finish in 1 cycle.\n+  xref_files_new=`generated_files_get`\n+  xref_files_save\n \n   while :; do\n-    # check for probably LaTeX loop (e.g. varioref)\n-    if test $cycle -eq \"$max_iters\"; then\n+    # check for (probably) LaTeX loop (e.g. varioref)\n+    if test $suite_cycle -eq \"$max_iters\"; then\n       error 0 \"Maximum of $max_iters cycles exceeded\"\n       break\n     fi\n \n     # report progress\n-    cycle=`expr $cycle + 1`\n-    verbose \"Cycle $cycle for $command_line_filename\"\n+    suite_cycle=`expr $suite_cycle + 1`\n+    verbose \"Cycle $suite_cycle for $command_line_filename\"\n \n+    tex_failed=false\n+    run_core_conversion\n+    xref_files_changed || break\n     xref_files_save\n \n     # We run bibtex first, because it's more likely for the indexes\n     # to change after bibtex is run than the reverse, though either\n     # would be rare.\n     run_bibtex\n     run_index\n-    run_core_conversion\n-\n-    xref_files_changed || break\n   done\n \n+  if $tex_failed ; then\n+    # TeX failed, and the xref files did not change.\n+    error 1 \"$tex exited with bad status, quitting.\"\n+  fi\n+\n   # If we were using thumbpdf and producing PDF, then run thumbpdf\n   # and TeX one last time.\n   run_thumbpdf\n@@ -1282,66 +1164,24 @@ run_tex_suite ()\n   # dvipdf or ps).\n   case $latex2html:$out_lang in\n     *:dvipdf)\n-      run_dvipdf \"$in_noext.`out_lang_tex`\"\n-      move_to_dest \"$in_noext.`out_lang_ext`\"\n-      ;;\n-    *:ps)\n-      : ${DVIPS:=dvips}\n-      run $DVIPS -o \"$in_noext.`out_lang_ext`\" \"$in_noext.`out_lang_tex`\"\n-      move_to_dest \"$in_noext.`out_lang_ext`\"\n-      ;;\n-  esac\n-\n-  cd_orig\n-}\n-\n-## -------------------------------- ##\n-## TeX processing auxiliary tools.  ##\n-## -------------------------------- ##\n-\n-\n-# A sed script that preprocesses Texinfo sources in order to keep the\n-# iftex sections only.  We want to remove non-TeX sections, and comment\n-# (with `@c _texi2dvi') TeX sections so that makeinfo does not try to\n-# parse them.  Nevertheless, while commenting TeX sections, don't\n-# comment @macro/@end macro so that makeinfo does propagate them.\n-# Unfortunately makeinfo --iftex --no-ifinfo doesn't work well enough\n-# (yet), makeinfo can't parse the TeX commands, so work around with sed.\n-#\n-# We assume that `@c _texi2dvi' starting a line is not present in the\n-# document.\n-#\n-comment_iftex=\\\n-'/^@tex/,/^@end tex/{\n-  s/^/@c _texi2dvi/\n-}\n-/^@iftex/,/^@end iftex/{\n-  s/^/@c _texi2dvi/\n-  /^@c _texi2dvi@macro/,/^@c _texi2dvi@end macro/{\n-    s/^@c _texi2dvi//\n-  }\n-}\n-/^@ifnottex/,/^@end ifnottex/{\n-  s/^/@c (_texi2dvi)/\n-}\n-/^@ifinfo/,/^@end ifinfo/{\n-  /^@node/p\n-  /^@menu/,/^@end menu/p\n-  t\n-  s/^/@c (_texi2dvi)/\n-}\n-s/^@ifnotinfo/@c _texi2dvi@ifnotinfo/\n-s/^@end ifnotinfo/@c _texi2dvi@end ifnotinfo/'\n+      run_dvipdf \"$in_noext.`out_lang_tex`\"\n+      move_to_dest \"$in_noext.`out_lang_ext`\"\n+      ;;\n+    *:ps)\n+      : ${DVIPS:=dvips}\n+      run $DVIPS -o \"$in_noext.`out_lang_ext`\" \"$in_noext.`out_lang_tex`\"\n+      move_to_dest \"$in_noext.`out_lang_ext`\"\n+      ;;\n+  esac\n \n-# Uncommenting is simpler: remove any leading `@c texi2dvi'; repeated\n-# copies can sneak in via macro invocations.\n-uncomment_iftex='s/^@c _texi2dvi\\(@c _texi2dvi\\)*//'\n+  cd_orig\n+}\n \n \n-# run_makeinfo ()\n-# ---------------\n-# Expand macro commands in the original source file using Makeinfo.\n-# Always use `end' footnote style, since the `separate' style\n+# \f TeX processing auxiliary tools.\n+#\n+# run_makeinfo - Expand macro commands in the original source file using\n+# Makeinfo.  Always use `end' footnote style, since the `separate' style\n # generates different output (arguably this is a bug in -E).  Discard\n # main info output, the user asked to run TeX, not makeinfo.\n run_makeinfo ()\n@@ -1395,15 +1235,14 @@ to tex itself simply not working.\"\n     work_src=$workdir/src\n     ensure_dir \"$work_src\"\n     in_src=$work_src/$in_base\n-    local miincludes\n-    miincludes=`list_prefix includes -I`\n+    run_mi_includes=`list_prefix includes -I`\n     verbose \"Macro-expanding $command_line_filename to $in_src ...\"\n     # eval $makeinfo because it might be defined as something complex\n     # (running missing) and then we end up with things like '\"-I\"',\n     # and \"-I\" (including the quotes) is not an option name.  This\n     # happens with gettext 0.14.5, at least.\n     $SED \"$comment_iftex\" \"$command_line_filename\" \\\n-      | eval $makeinfo --footnote-style=end -I \"$in_dir\" $miincludes \\\n+      | eval $makeinfo --footnote-style=end -I \"$in_dir\" $run_mi_includes \\\n         -o /dev/null --macro-expand=- \\\n       | $SED \"$uncomment_iftex\" >\"$in_src\"\n     # Continue only if everything succeeded.\n@@ -1416,9 +1255,62 @@ to tex itself simply not working.\"\n   fi\n }\n \n-# insert_commands ()\n-# ------------------\n-# Used most commonly for @finalout, @smallbook, etc.\n+# Unfortunately, makeinfo --iftex --no-ifinfo doesn't work well enough\n+# in versions before 5.0, as makeinfo can't parse the TeX commands\n+# inside @tex blocks, so work around with sed.\n+#\n+# This sed script preprocesses Texinfo sources in order to keep the\n+# iftex sections only.  We want to remove non-TeX sections, and comment\n+# (with `@c _texi2dvi') TeX sections so that makeinfo does not try to\n+# parse them.  Nevertheless, while commenting TeX sections, don't\n+# comment @macro/@end macro so that makeinfo does propagate them.\n+# Similarly, preserve the @top node to avoid makeinfo complaining about\n+# it being missed.  Comment it out after preprocessing, so that it does\n+# not appear in the generated document.\n+#\n+# We assume that `@c _texi2dvi' or `@c (_texi2dvi)' starting a line is\n+# not present in the document.  Additionally, conditionally defined\n+# macros inside the @top node may end up with the wrong value, although\n+# this is unlikely in practice.\n+#\n+comment_iftex=\\\n+'/^@tex/,/^@end tex/{\n+  s/^/@c _texi2dvi/\n+}\n+/^@iftex/,/^@end iftex/{\n+  s/^/@c _texi2dvi/\n+  /^@c _texi2dvi@macro/,/^@c _texi2dvi@end macro/{\n+    s/^@c _texi2dvi//\n+  }\n+}\n+/^@ifnottex/,/^@end ifnottex/{\n+  s/^/@c (_texi2dvi)/\n+  /^@c (_texi2dvi)@node Top/,/^@c (_texi2dvi)@end ifnottex/ {\n+    /^@c (_texi2dvi)@end ifnottex/b\n+    s/^@c (_texi2dvi)//\n+  }\n+}\n+/^@ifinfo/,/^@end ifinfo/{\n+  /^@node/p\n+  /^@menu/,/^@end menu/p\n+  t\n+  s/^/@c (_texi2dvi)/\n+}\n+s/^@ifnotinfo/@c _texi2dvi@ifnotinfo/\n+s/^@end ifnotinfo/@c _texi2dvi@end ifnotinfo/'\n+\n+# Uncomment @iftex blocks by removing any leading `@c texi2dvi' (repeated\n+# copies can sneak in via macro invocations).  Likewise, comment out\n+# the @top node inside a @ifnottex block.\n+uncomment_iftex=\\\n+'s/^@c _texi2dvi\\(@c _texi2dvi\\)*//\n+/^@c (_texi2dvi)@ifnottex/,/^@c (_texi2dvi)@end ifnottex/{\n+  s/^/@c (_texi2dvi)/\n+}'\n+\n+\n+# insert_commands - Insert $textra commands at the beginning of the file. \n+# Recommended to be used for @finalout, @smallbook, etc.\n insert_commands ()\n {\n   if test -n \"$textra\"; then\n@@ -1427,10 +1319,15 @@ insert_commands ()\n     in_xtr=$work_xtr/$in_base\n     ensure_dir \"$work_xtr\"\n     verbose \"Inserting extra commands: $textra\"\n-    local textra_cmd\n     case $in_lang in\n       latex)   textra_cmd=1i;;\n-      texinfo) textra_cmd='/^@setfilename/a';;\n+      texinfo)\n+        textra_cmd='/^\\\\input texinfo/a'\n+        # insert after @setfilename line if present\n+        if head -n 10 $in_input | grep '^@setfilename' ; then\n+          textra_cmd='/^@setfilename/a'\n+        fi\n+        ;;\n       *)       error 1 \"internal error, unknown language: $in_lang\";;\n     esac\n     $SED \"$textra_cmd\\\\\n@@ -1453,10 +1350,9 @@ $textra\" \"$in_input\" >\"$in_xtr\"\n   esac\n }\n \n-# compute_language FILENAME\n-# -------------------------\n-# Return the short string describing the language in which FILENAME\n-# is written: `texinfo' or `latex'.\n+\n+# compute_language FILENAME - Return the short string for the language\n+# in which FILENAME is written: `texinfo' or `latex'.\n compute_language ()\n {\n   # If the user explicitly specified the language, use that.\n@@ -1477,9 +1373,7 @@ compute_language ()\n }\n \n \n-# run_hevea (MODE)\n-# ----------------\n-# Convert to HTML/INFO/TEXT.\n+# run_hevea (MODE) - Convert to HTML/INFO/TEXT.\n #\n # Don't pass `-noiso' to hevea: it's useless in HTML since anyway the\n # charset is set to latin1, and troublesome in other modes since\n@@ -1490,27 +1384,27 @@ compute_language ()\n # to handle images some day.\n run_hevea ()\n {\n-  local hevea=\"${HEVEA:-hevea}\"\n-  local run_hevea=\"$hevea\"\n+  run_hevea_name=\"${HEVEA:-hevea}\"\n+  run_hevea_cmd=\"$run_hevea_name\"\n \n   case $1 in\n     html) ;;\n-    text|info) run_hevea=\"$run_hevea -$1\";;\n-    *) error 1 \"run_hevea: invalid argument: $1\";;\n+    text|info) run_hevea_cmd=\"$run_hevea_cmd -$1\";;\n+    *) error 1 \"run_hevea_cmd: invalid argument: $1\";;\n   esac\n \n   # Compiling to the tmp directory enables to preserve a previous\n   # successful compilation.\n-  run_hevea=\"$run_hevea -fix -O -o '$out_base'\"\n-  run_hevea=\"$run_hevea `list_prefix includes -I` -I '$orig_pwd' \"\n-  run_hevea=\"$run_hevea '$in_input'\"\n+  run_hevea_cmd=\"$run_hevea_cmd -fix -O -o '$out_base'\"\n+  run_hevea_cmd=\"$run_hevea_cmd `list_prefix includes -I` -I '$orig_pwd' \"\n+  run_hevea_cmd=\"$run_hevea_cmd '$rel$in_input'\"\n \n   if $debug; then\n-    run_hevea=\"$run_hevea -v -v\"\n+    run_hevea_cmd=\"$run_hevea_cmd -v -v\"\n   fi\n \n-  verbose \"running $run_hevea\"\n-  if eval \"$run_hevea\" >&5; then\n+  verbose \"running $run_hevea_cmd\"\n+  if eval \"$run_hevea_cmd\" >&5; then\n     # hevea leaves trailing white spaces, this is annoying.\n     case $1 in text|info)\n       perl -pi -e 's/[ \\t]+$//g' \"$out_base\"*;;\n@@ -1521,14 +1415,12 @@ run_hevea ()\n                move_to_dest \"$out_base\"*;;\n     esac\n   else\n-    error 1 \"$hevea exited with bad status, quitting.\"\n+    error 1 \"$run_hevea_name exited with bad status, quitting.\"\n   fi\n }\n \n \n-# run_core_conversion ()\n-# ----------------------\n-# Run the TeX (or HeVeA).\n+# run_core_conversion - Run TeX (or HeVeA).\n run_core_conversion ()\n {\n   case $in_lang:$latex2html:`out_lang_tex` in\n@@ -1542,31 +1434,30 @@ run_core_conversion ()\n }\n \n \n-# compile ()\n-# ----------\n-# Run the full compilation chain, from pre-processing to installation\n-# of the output at its expected location.\n+# compile - Run the full compilation chain, from pre-processing to\n+# installation of the output at its expected location.\n compile ()\n {\n-  # Source file might include additional sources.\n-  # We want `.:$orig_pwd' before anything else.  (We'll add `.:' later\n-  # after all other directories have been turned into absolute paths.)\n-  # `.' goes first to ensure that any old .aux, .cps,\n-  # etc. files in ${directory} don't get used in preference to fresher\n-  # files in `.'.  Include orig_pwd in case we are in clean build mode, where\n-  # we have cd'd to a temp directory.\n+  # Set include path for tools:\n+  #   .  Include current directory in case there are files there already, so\n+  #     we don't have more TeX runs than necessary.  orig_pwd is used in case \n+  #     we are in clean build mode, where we have cd'd to a temp directory.\n+  #   .  Include directory containing file, in case there are other\n+  #     files @include'd.\n+  #   .  Keep a final path_sep to get the default (system) TeX\n+  #     directories included.\n+  #   .  If we have any includes, put those at the end.\n+\n   common=\"$orig_pwd$path_sep$in_dir$path_sep\"\n   #\n-  # If we have any includes, put those at the end.\n-  # Keep a final path_sep to get the default (system) TeX directories included.\n   txincludes=`list_infix includes $path_sep`\n   test -n \"$txincludes\" && common=\"$common$txincludes$path_sep\"\n   #\n   for var in $tex_envvars; do\n     eval val=\"\\$common\\$${var}_orig\"\n     # Convert relative paths to absolute paths, so we can run in another\n     # directory (e.g., in clean build mode, or during the macro-support\n-    # detection). \".:\" is added here.\n+    # detection).\n     val=`absolute_filenames \"$val\"`\n     eval $var=\"\\\"$val\\\"\"\n     export $var\n@@ -1579,56 +1470,292 @@ compile ()\n   # --command, --texinfo\n   insert_commands\n \n-  # Run until a fix point is reached.\n+  # Run until a fixed point is reached.\n   run_tex_suite\n }\n \n+# make_openout_test FLAGS EXTENSION\n+# - Run TeX with an input file that performs an \\openout.  Pass FLAGS to TeX.\n+#\n+make_openout_test ()\n+{\n+    recorder_option_maybe=\"$1\"\n+    make_tex_cmd\n+\n+    ensure_dir \"$workdir\"/check_recorder\n+    cd_dir \"$workdir\"/check_recorder\n+\n+    cat > openout.tex <<EOF\n+\\newwrite\\ourwrite\n+\\immediate\\openout\\ourwrite dum.dum\n+\\bye\n+EOF\n+    # \\bye doesn't work for LaTeX, but it will cause latex\n+    # to exit with an input error.\n+    tex_cmd=\"$tex_cmd '${escape}input' ./openout.tex\"\n+    # ./ in case . isn't in path\n+    verbose \"$0: running $tex_cmd ...\"\n+    rm -fr \"openout.$2\"\n+    (eval \"$tex_cmd\" >/dev/null 2>&1)\n+}\n+\n+# Check tex supports -recorder option\n+check_recorder_support ()\n+{\n+  verbose \"Checking TeX recorder support...\"\n+  make_openout_test \" -recorder\" fls\n+  if test -f openout.fls && grep '^OUTPUT dum.dum$' openout.fls > /dev/null\n+  then\n+    cd_orig\n+    verbose \"Checking TeX recorder support... yes\"\n+    return 0\n+  else\n+    cd_orig\n+    verbose \"Checking TeX recorder support... no\"\n+    return 1\n+  fi\n+}\n+\n+# Check tex supports \\openout traces in log\n+check_openout_in_log_support ()\n+{\n+  verbose \"Checking TeX \\openout in log support...\"\n+  make_openout_test \"\" log\n+  if test -f openout.log \\\n+     && grep '^\\\\openout..\\? *= *`\\?dum\\.dum'\\''\\?' openout.log >/dev/null\n+  then\n+    cd_orig\n+    verbose \"Checking TeX \\openout in log support... yes\"\n+    return 0\n+  else\n+    cd_orig\n+    verbose \"Checking TeX \\openout in log support... no\"\n+    return 1\n+  fi\n+}\n+\n+# Set that output auxiliary files are detected with the -recorder option,\n+# which creates a file JOBNAME.fls which is a machine-readable listing of\n+# files read and written during the job.\n+set_aux_files_from_fls ()\n+{\n+  recorder_option_maybe=\" -recorder\"\n+  generated_files_get_method=generated_files_get_from_fls\n+}\n+\n+# Set that output auxiliary files are detected with searching for \\openout\n+# in the log file.\n+set_aux_files_from_log ()\n+{\n+  recorder_option_maybe=''\n+  generated_files_get_method=generated_files_get_from_log\n+}\n+\n+# Decide whether output auxiliary files are detected with the -recorder\n+# option, or by searching for \\openout in the log file.\n+decide_aux_files_method ()\n+{\n+  # Select output file detection method\n+  # Valid values of TEXI2DVI_USE_RECORDER are:\n+  #   yes           use the -recorder option, no checks.\n+  #   no            scan for \\openout in the log file, no checks.\n+  #   yesmaybe      check whether -recorder option is supported, and if yes\n+  #                use it, otherwise check for tracing \\openout in the\n+  #                log file is supported, and if yes use it, else it is an \n+  #                error.\n+  #   nomaybe      same as `yesmaybe', except that the \\openout trace in\n+  #                log file is checked first.\n+  #\n+  #  The default behaviour is `nomaybe'.\n+\n+  test -n \"$TEXI2DVI_USE_RECORDER\" || TEXI2DVI_USE_RECORDER=nomaybe\n \n-# remove FILES\n-# ------------\n+  case $TEXI2DVI_USE_RECORDER in\n+    yes) set_aux_files_from_fls;;\n+\n+    no)\tset_aux_files_from_log;;\n+\n+    yesmaybe)\n+      if check_recorder_support; then\n+        set_aux_files_from_fls\n+      elif check_openout_in_log_support; then\n+        set_aux_files_from_log\n+      else\n+        error 1 \"TeX neither supports -recorder nor outputs \\\\openout lines in its log file\"\n+      fi\n+      ;;\n+\n+    nomaybe)\n+      if check_openout_in_log_support; then\n+        set_aux_files_from_log\n+      elif check_recorder_support; then\n+        set_aux_files_from_fls\n+      else\n+        error 1 \"TeX neither supports -recorder nor outputs \\\\openout lines in its log file\"\n+      fi\n+      ;;\n+    \n+    *) error 1 \"Invalid value of TEXI2DVI_USE_RECORDER environment variable : $TEXI2DVI_USE_RECORDER.\";;\n+\n+  esac\n+}\n+\n+# remove FILE...\n remove ()\n {\n   verbose \"Removing\" \"$@\"\n   rm -rf \"$@\"\n }\n \n \n-# mostly_clean\n-# ------------\n-# Remove auxiliary files and directories.  Changes the current directory.\n+# all_files - Echo the names of all files generated, including those by\n+#             auxiliary tools like texindex.\n+all_files ()\n+{\n+  echo $in_noext.log\n+  echo $in_noext.fls\n+  echo $xref_files_new\n+  echo `sorted_index_files`\n+}\n+\n+sorted_index_files ()\n+{\n+  filter_files sorted_index_filter\n+}\n+\n+# Print the name of a generated file based on FILE if there is one.\n+sorted_index_filter ()\n+{\n+  case $in_lang in\n+    texinfo)\n+      # texindex: texinfo.cp -> texinfo.cps\n+      if test -n \"`index_file_p $1`\" ; then\n+        echo $1s\n+      fi\n+      ;;\n+  esac\n+}\n+\n+\n+# Not currently used - use with filter_files to add secondary files created by \n+# bibtex\n+bibtex_secondary_files ()\n+{\n+  case $in_lang in\n+    latex)\n+      if test -n \"`aux_file_p $1`\"; then\n+        # bibtex: *.aux -> *.bbl and *.blg.\n+        echo $1 | $SED 's/^\\(.*\\)\\.aux$/\\1.bbl/'\n+        echo $1 | $SED 's/^\\(.*\\)\\.aux$/\\1.blg/'\n+      fi\n+      ;;\n+  esac\n+}\n+\n+# mostly_clean - Remove auxiliary files and directories.  Changes back to\n+# the original directory.\n mostly_clean ()\n {\n   cd_orig\n   set X \"$t2ddir\"\n   shift\n   $tidy || {\n-    local log=\"$work_build/$in_noext.log\"\n-    set X ${1+\"$@\"} \"$log\" `generated_files_get \"$work_build/$in_noext\"`\n+    set X ${1+\"$@\"} `all_files`\n     shift\n   }\n   remove ${1+\"$@\"}\n }\n \n \n-# cleanup ()\n-# ----------\n-# Remove what should be removed according to options.\n+# cleanup - Remove what should be removed according to options.\n # Called at the end of each compilation cycle, and at the end of\n # the script.  Changes the current directory.\n cleanup ()\n {\n-  case $build_mode in\n-    local) cd_orig; remove \"$t2ddir\";;\n-    clean) mostly_clean;;\n-    tidy)  ;;\n+  case $clean:$tidy in\n+    true:true) mostly_clean ;;                # build mode is \"clean\"\n+    false:false) cd_orig; remove \"$t2ddir\";;  # build mode is \"local\"\n+  esac\n+}\n+\n+\n+# \f input_file_name_decode - Decode COMMAND_LINE_FILENAME, and set the\n+# following shell variables:\n+#\n+# - COMMAND_LINE_FILENAME\n+#   The filename given on the commmand line, but cleaned of TeX commands.\n+# - IN_DIR\n+#   The directory containing the input file.\n+# - IN_BASE\n+#   The input file base name (no directory part).\n+# - IN_NOEXT\n+#   The input file name with neither file extensions nor directory part.\n+# - IN_INPUT\n+#   The path to the input file for passing as a command-line argument\n+#   to TeX.  Defaults to COMMAND_LINE_FILENAME, but might change if the\n+#   input is preprocessed.\n+input_file_name_decode ()\n+{\n+  case $command_line_filename in\n+    *\\\\input{*}*)\n+      # Let AUC-TeX error parser deal with line numbers.\n+      line_error=false\n+      command_line_filename=`\\\n+        expr X\"$command_line_filename\" : X'.*input{\\([^}]*\\)}'`\n+      ;;\n   esac\n+\n+  # If the COMMAND_LINE_FILENAME is not absolute (e.g., --debug.tex),\n+  # prepend `./' in order to avoid that the tools take it as an option.\n+  echo \"$command_line_filename\" | LC_ALL=C $EGREP '^(/|[A-Za-z]:/)' >&6 \\\n+  || command_line_filename=\"./$command_line_filename\"\n+\n+  # See if the file exists.  If it doesn't we're in trouble since, even\n+  # though the user may be able to reenter a valid filename at the tex\n+  # prompt (assuming they're attending the terminal), this script won't\n+  # be able to find the right xref files and so forth.\n+  test -r \"$command_line_filename\" \\\n+  || error 1 \"cannot read $command_line_filename, skipping.\"\n+\n+  # Get the name of the current directory.\n+  in_dir=`func_dirname \"$command_line_filename\"`\n+\n+  # Strip directory part but leave extension.\n+  in_base=`basename \"$command_line_filename\"`\n+  # Strip extension.\n+  in_noext=`noext \"$in_base\"`\n+\n+  # The normalized file name to compile.  Must always point to the\n+  # file to actually compile (in case of recoding, macro-expansion etc.).\n+  in_input=$in_dir/$in_base\n+\n+\n+  # Compute the output file name.\n+  if test x\"$oname\" != x; then\n+    out_name=$oname\n+  else\n+    out_name=$in_noext.`out_lang_ext`\n+  fi\n+  out_dir=`func_dirname \"$out_name\"`\n+  out_dir_abs=`absolute \"$out_dir\"`\n+  out_base=`basename \"$out_name\"`\n+  out_noext=`noext \"$out_base\"`\n }\n \n \n+# \f\n+#################### Main program starts ##########################\n \n-## ---------------------- ##\n-## Command line parsing.  ##\n-## ---------------------- ##\n+# Initialize more variables.\n+#\n+# Save TEXINPUTS so we can construct a new TEXINPUTS path for each file.\n+# Likewise for bibtex and makeindex.\n+tex_envvars=\"BIBINPUTS BSTINPUTS DVIPSHEADERS INDEXSTYLE MFINPUTS MPINPUTS \\\n+TEXINPUTS TFMFONTS\"\n+for var in $tex_envvars; do\n+  eval ${var}_orig=\\$$var\n+  export $var\n+done\n \n # Push a token among the arguments that will be used to notice when we\n # ended options/arguments parsing.\n@@ -1640,10 +1767,7 @@ cleanup ()\n arg_sep=\"$$--$$\"\n set dummy ${1+\"$@\"} \"$arg_sep\"; shift\n \n-# \f\n-# Parse command line arguments.\n while test x\"$1\" != x\"$arg_sep\"; do\n-\n   # Handle --option=value by splitting apart and putting back on argv.\n   case \"$1\" in\n     --*=*)\n@@ -1656,9 +1780,8 @@ while test x\"$1\" != x\"$arg_sep\"; do\n \n   case \"$1\" in\n     -@ ) escape=@;;\n-    -~ ) catcode_special=false;;\n-    # Silently and without documentation accept -b and --b[atch] as synonyms.\n-    -b | --batch) batch=true;;\n+    -~ ) verbose \"Option -~ is obsolete: texi2dvi ignores it.\";;\n+    -b | --batch) ;; # Obsolete\n          --build)      shift; build_mode=$1;;\n          --build-dir)  shift; build_dir=$1; build_mode=tidy;;\n     -c | --clean) build_mode=clean;;\n@@ -1681,7 +1804,7 @@ while test x\"$1\" != x\"$arg_sep\"; do\n        out_lang_set `echo \"x$1\" | $SED 's/^x--//'`;;\n \n     -p) out_lang_set pdf;;\n-    -q | -s | --quiet | --silent) quiet=true; batch=true;;\n+    -q | -s | --quiet | --silent) quiet=true;;\n     --src-specials) src_specials=--src-specials;;\n     --shell-escape) shell_escape=--shell-escape;;  \n     --tex4ht) latex2html=tex4ht;;\n@@ -1733,9 +1856,15 @@ esac\n \n \n # We can't do much without tex.\n+# End up with the TEX and PDFTEX variables set to what we are going to use.\n #\n-if findprog ${TEX:-tex}; then :; else cat <<EOM\n-You don't have a working TeX binary (${TEX:-tex}) installed anywhere in\n+# If $TEX is set to a directory, don't use it.\n+test -n \"$TEX\" && test -d \"$TEX\" && unset TEX\n+\n+# But otherwise, use $TEX if it is set.\n+if test -z \"$TEX\"; then\n+  if findprog tex; then :; else cat <<EOM >&2\n+You don't have a working TeX binary (tex) installed anywhere in\n your PATH, and texi2dvi cannot proceed without one.  If you want to use\n this script, you'll need to install TeX (if you don't have it) or change\n your PATH or TEX environment variable (if you do).  See the --help\n@@ -1744,20 +1873,19 @@ output for more details.\n For information about obtaining TeX, please see http://tug.org/texlive,\n or do a web search for TeX and your operating system or distro.\n EOM\n-  exit 1\n-fi\n-\n+    exit 1\n+  fi\n \n-# We want to use etex (or pdftex) if they are available, and the user\n-# didn't explicitly specify.  We don't check for elatex and pdfelatex\n-# because (as of 2003), the LaTeX team has asked that new distributions\n-# use etex by default anyway.\n-#\n-# End up with the TEX and PDFTEX variables set to what we are going to use.\n-if test -z \"$TEX\"; then\n+  # We want to use etex (or pdftex) if they are available, and the user\n+  # didn't explicitly specify.  We don't check for elatex and pdfelatex\n+  # because (as of 2003), the LaTeX team has asked that new distributions\n+  # use etex by default anyway.\n+  #\n   if findprog etex; then TEX=etex; else TEX=tex; fi\n fi\n-#\n+\n+# For many years, the pdftex binary has included the e-tex extensions,\n+# but for those people with ancient TeX distributions ...\n if test -z \"$PDFTEX\"; then\n   if findprog pdfetex; then PDFTEX=pdfetex; else PDFTEX=pdftex; fi\n fi\n@@ -1767,12 +1895,9 @@ fi\n # 0 standard input\n # 1 standard output (--verbose messages)\n # 2 standard error\n-# 3 some systems may open it to /dev/tty\n-# 4 used on the Kubota Titan\n # 5 tools output (turned off by --quiet)\n # 6 tracing/debugging (set -x output, etc.)\n \n-\n # Main tools' output (TeX, etc.) that TeX users are used to seeing.\n #\n # If quiet, discard, else redirect to the message flow.\n@@ -1797,87 +1922,8 @@ else\n   exec 6>/dev/null\n fi\n \n-# \f\n-\n-# input_file_name_decode\n-# ----------------------\n-# Decode COMMAND_LINE_FILENAME, and compute:\n-# - COMMAND_LINE_FILENAME clean of TeX commands\n-# - IN_DIR\n-#   The directory to the input file, possibly absolute if needed.\n-# - IN_DIR_ABS\n-#   The absolute directory of the input file.\n-# - IN_BASE\n-#   The input file base name (no directory part).\n-# - IN_NOEXT\n-#   The input file name without extensions (nor directory part).\n-# - IN_INPUT\n-#   Defaults to COMMAND_LINE_FILENAME, but might change if the\n-#   input is preprocessed.  With directory, possibly absolute.\n-input_file_name_decode ()\n-{\n-  # See if we are run from within AUC-Tex, in which case we are\n-  # passed `\\input{FOO.tex}' or even `\\nonstopmode\\input{FOO.tex}'.\n-  case $command_line_filename in\n-    *\\\\nonstopmode*)\n-      batch=true;;\n-  esac\n-  case $command_line_filename in\n-    *\\\\input{*}*)\n-      # Let AUC-TeX error parser deal with line numbers.\n-      line_error=false\n-      command_line_filename=`\\\n-        expr X\"$command_line_filename\" : X'.*input{\\([^}]*\\)}'`\n-      ;;\n-  esac\n-\n-  # If the COMMAND_LINE_FILENAME is not absolute (e.g., --debug.tex),\n-  # prepend `./' in order to avoid that the tools take it as an option.\n-  echo \"$command_line_filename\" | LC_ALL=C $EGREP '^(/|[A-Za-z]:/)' >&6 \\\n-  || command_line_filename=\"./$command_line_filename\"\n-\n-  # See if the file exists.  If it doesn't we're in trouble since, even\n-  # though the user may be able to reenter a valid filename at the tex\n-  # prompt (assuming they're attending the terminal), this script won't\n-  # be able to find the right xref files and so forth.\n-  test -r \"$command_line_filename\" \\\n-  || error 1 \"cannot read $command_line_filename, skipping.\"\n-\n-  # Get the name of the current directory.\n-  in_dir=`func_dirname \"$command_line_filename\"`\n-  in_dir_abs=`absolute \"$in_dir\"`\n-  # In a clean build, we `cd', so get an absolute file name.\n-  if $tidy; then\n-    in_dir=$in_dir_abs\n-  fi\n-\n-  # Strip directory part but leave extension.\n-  in_base=`basename \"$command_line_filename\"`\n-  # Strip extension.\n-  in_noext=`noext \"$in_base\"`\n-\n-  # The normalized file name to compile.  Must always point to the\n-  # file to actually compile (in case of recoding, macro-expansion etc.).\n-  in_input=$in_dir/$in_base\n-\n-\n-  # Compute the output file name.\n-  if test x\"$oname\" != x; then\n-    out_name=$oname\n-  else\n-    out_name=$in_noext.`out_lang_ext`\n-  fi\n-  out_dir=`func_dirname \"$out_name\"`\n-  out_dir_abs=`absolute \"$out_dir\"`\n-  out_base=`basename \"$out_name\"`\n-  out_noext=`noext \"$out_base\"`\n-}\n-\n-\n-## -------------- ##\n-## TeXify files.  ##\n-## -------------- ##\n \n+# \f Main program main loop - TeXify each file in turn.\n for command_line_filename\n do\n   verbose \"Processing $command_line_filename ...\"\n@@ -1905,8 +1951,6 @@ do\n \n   ensure_dir \"$build_dir\" \"$t2ddir\"\n \n-  # We will change directory, better work with an absolute path...\n-  t2ddir=`absolute \"$t2ddir\"`\n   # Sometimes there are incompatibilities between auxiliary files for\n   # DVI and PDF.  The contents can also change whether we work on PDF\n   # and/or DVI.  So keep separate spaces for each.\n@@ -1927,6 +1971,9 @@ do\n   # Make those directories.\n   ensure_dir \"$work_build\" \"$work_bak\"\n \n+  # Decide how to find auxiliary files created by TeX.\n+  decide_aux_files_method\n+  \n   case $action in\n     compile)\n       # Compile the document.\n@@ -1935,10 +1982,15 @@ do\n       ;;\n \n     mostly-clean)\n+      xref_files_new=`generated_files_get`\n       mostly_clean\n       ;;\n   esac\n done\n \n verbose \"done.\"\n exit 0 # exit successfully, not however we ended the loop.\n+# Local Variables:\n+# sh-basic-offset: 2\n+# sh-indentation: 2\n+# End:"
    },
    {
      "sha": "abb9cb6ba573493530f878612d271b4c80848fce",
      "filename": "readline/readline/doc/version.texi",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/version.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/doc/version.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/doc/version.texi?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,10 +1,10 @@\n @ignore\n-Copyright (C) 1988-2018 Free Software Foundation, Inc. \n+Copyright (C) 1988-2020 Free Software Foundation, Inc. \n @end ignore\n \n-@set EDITION 8.0\n-@set VERSION 8.0\n-@set UPDATED 30 November 2018\n-@set UPDATED-MONTH November 2018\n+@set EDITION 8.1\n+@set VERSION 8.1\n+@set UPDATED 29 October 2020\n+@set UPDATED-MONTH October 2020\n \n-@set LASTCHANGE Fri Nov 30 22:50:53 EST 2018\n+@set LASTCHANGE Thu Oct 29 16:49:01 EDT 2020"
    },
    {
      "sha": "02597dad31a4811bb55d44a30914b7b955eb2871",
      "filename": "readline/readline/emacs_keymap.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/emacs_keymap.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/emacs_keymap.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/emacs_keymap.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -47,7 +47,7 @@ KEYMAP_ENTRY_ARRAY emacs_standard_keymap = {\n   { ISFUNC, rl_clear_screen },\t\t\t/* Control-l */\n   { ISFUNC, rl_newline },\t\t\t/* Control-m */\n   { ISFUNC, rl_get_next_history },\t\t/* Control-n */\n-  { ISFUNC, (rl_command_func_t *)0x0 },\t\t/* Control-o */\n+  { ISFUNC, rl_operate_and_get_next },\t\t/* Control-o */\n   { ISFUNC, rl_get_previous_history },\t\t/* Control-p */\n   { ISFUNC, rl_quoted_insert },\t\t\t/* Control-q */\n   { ISFUNC, rl_reverse_search_history },\t/* Control-r */\n@@ -327,7 +327,7 @@ KEYMAP_ENTRY_ARRAY emacs_meta_keymap = {\n   { ISFUNC, rl_tab_insert },\t\t/* Meta-Control-i */\n   { ISFUNC, rl_vi_editing_mode },\t/* Meta-Control-j */\n   { ISFUNC, (rl_command_func_t *)0x0 },\t/* Meta-Control-k */\n-  { ISFUNC, (rl_command_func_t *)0x0 },\t/* Meta-Control-l */\n+  { ISFUNC, rl_clear_display },\t\t/* Meta-Control-l */\n   { ISFUNC, rl_vi_editing_mode }, \t/* Meta-Control-m */\n   { ISFUNC, (rl_command_func_t *)0x0 },\t/* Meta-Control-n */\n   { ISFUNC, (rl_command_func_t *)0x0 },\t/* Meta-Control-o */"
    },
    {
      "sha": "0a0988320a6ee22fe79fc69c9209d50e02bc6849",
      "filename": "readline/readline/examples/autoconf/BASH_CHECK_LIB_TERMCAP",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/examples/autoconf/BASH_CHECK_LIB_TERMCAP",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/examples/autoconf/BASH_CHECK_LIB_TERMCAP",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/examples/autoconf/BASH_CHECK_LIB_TERMCAP?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -12,7 +12,8 @@ AC_CACHE_VAL(bash_cv_termcap_lib,\n     [AC_CHECK_LIB(tinfo, tgetent, bash_cv_termcap_lib=libtinfo,\n         [AC_CHECK_LIB(curses, tgetent, bash_cv_termcap_lib=libcurses,\n \t    [AC_CHECK_LIB(ncurses, tgetent, bash_cv_termcap_lib=libncurses,\n-\t        bash_cv_termcap_lib=gnutermcap)])])])])])\n+                [AC_CHECK_LIB(ncursesw, tgetent, bash_cv_termcap_lib=libncursesw,\n+\t            bash_cv_termcap_lib=gnutermcap)])])])])])])\n if test \"X$_bash_needmsg\" = \"Xyes\"; then\n AC_MSG_CHECKING(which library has the termcap functions)\n fi"
    },
    {
      "sha": "cc158a8dabf8eea54f768ac05c195f5dea7e982f",
      "filename": "readline/readline/examples/autoconf/RL_LIB_READLINE_VERSION",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/examples/autoconf/RL_LIB_READLINE_VERSION",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/examples/autoconf/RL_LIB_READLINE_VERSION",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/examples/autoconf/RL_LIB_READLINE_VERSION?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -35,6 +35,7 @@ AC_CACHE_VAL(ac_cv_rl_version,\n [AC_TRY_RUN([\n #include <stdio.h>\n #include <readline/readline.h>\n+#include <stdlib.h>\n \n extern int rl_gnu_readline_p;\n "
    },
    {
      "sha": "f8d0be73eef1cba00906cb919b133783063c66a0",
      "filename": "readline/readline/examples/fileman.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/examples/fileman.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/examples/fileman.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/examples/fileman.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -377,11 +377,11 @@ com_stat (arg)\n \n   printf (\"Statistics for `%s':\\n\", arg);\n \n-  printf (\"%s has %d link%s, and is %d byte%s in length.\\n\",\n+  printf (\"%s has %d link%s, and is %lu byte%s in length.\\n\",\n \t  arg,\n           finfo.st_nlink,\n           (finfo.st_nlink == 1) ? \"\" : \"s\",\n-          finfo.st_size,\n+          (unsigned long)finfo.st_size,\n           (finfo.st_size == 1) ? \"\" : \"s\");\n   printf (\"Inode Last Change at: %s\", ctime (&finfo.st_ctime));\n   printf (\"      Last access at: %s\", ctime (&finfo.st_atime));"
    },
    {
      "sha": "eca49a3e4f61c0e57289d10352219830c59214ba",
      "filename": "readline/readline/funmap.c",
      "status": "modified",
      "additions": 6,
      "deletions": 4,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/funmap.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/funmap.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/funmap.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* funmap.c -- attach names to functions. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -73,6 +73,7 @@ static const FUNMAP default_funmap[] = {\n   { \"capitalize-word\", rl_capitalize_word },\n   { \"character-search\", rl_char_search },\n   { \"character-search-backward\", rl_backward_char_search },\n+  { \"clear-display\", rl_clear_display },\n   { \"clear-screen\", rl_clear_screen },\n   { \"complete\", rl_complete },\n   { \"copy-backward-word\", rl_copy_backward_word },\n@@ -116,6 +117,7 @@ static const FUNMAP default_funmap[] = {\n   { \"non-incremental-forward-search-history-again\", rl_noninc_forward_search_again },\n   { \"non-incremental-reverse-search-history-again\", rl_noninc_reverse_search_again },\n   { \"old-menu-complete\", rl_old_menu_complete },\n+  { \"operate-and-get-next\", rl_operate_and_get_next },\n   { \"overwrite-mode\", rl_overwrite_mode },\n #if defined (_WIN32)\n   { \"paste-from-clipboard\", rl_paste_from_clipboard },\n@@ -157,7 +159,7 @@ static const FUNMAP default_funmap[] = {\n   { \"vi-backward-bigword\", rl_vi_bWord },\n   { \"vi-backward-word\", rl_vi_bword },\n   { \"vi-bWord\", rl_vi_bWord },\n-  { \"vi-bword\", rl_vi_bword },\n+  { \"vi-bword\", rl_vi_bword },\t/* BEWARE: name matching is case insensitive */\n   { \"vi-change-case\", rl_vi_change_case },\n   { \"vi-change-char\", rl_vi_change_char },\n   { \"vi-change-to\", rl_vi_change_to },\n@@ -171,13 +173,13 @@ static const FUNMAP default_funmap[] = {\n   { \"vi-end-bigword\", rl_vi_eWord },\n   { \"vi-end-word\", rl_vi_end_word },\n   { \"vi-eof-maybe\", rl_vi_eof_maybe },\n-  { \"vi-eword\", rl_vi_eword },\n+  { \"vi-eword\", rl_vi_eword },\t/* BEWARE: name matching is case insensitive */\n   { \"vi-fWord\", rl_vi_fWord },\n   { \"vi-fetch-history\", rl_vi_fetch_history },\n   { \"vi-first-print\", rl_vi_first_print },\n   { \"vi-forward-bigword\", rl_vi_fWord },\n   { \"vi-forward-word\", rl_vi_fword },\n-  { \"vi-fword\", rl_vi_fword },\n+  { \"vi-fword\", rl_vi_fword },\t/* BEWARE: name matching is case insensitive */\n   { \"vi-goto-mark\", rl_vi_goto_mark },\n   { \"vi-insert-beg\", rl_vi_insert_beg },\n   { \"vi-insertion-mode\", rl_vi_insert_mode },"
    },
    {
      "sha": "b986dba0513f4cf4e28c167953df53f3ae5fa505",
      "filename": "readline/readline/histexpand.c",
      "status": "modified",
      "additions": 18,
      "deletions": 8,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/histexpand.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/histexpand.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/histexpand.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -89,7 +89,7 @@ char history_expansion_char = '!';\n char history_subst_char = '^';\n \n /* During tokenization, if this character is seen as the first character\n-   of a word, then it, and all subsequent characters upto a newline are\n+   of a word, then it, and all subsequent characters up to a newline are\n    ignored.  For a Bourne shell, this should be '#'.  Bash special cases\n    the interactive comment character to not be a comment delimiter. */\n char history_comment_char = '\\0';\n@@ -180,7 +180,7 @@ get_history_event (const char *string, int *caller_index, int delimiting_quote)\n     }\n \n   /* Hack case of numeric line specification. */\n-  if (string[i] == '-')\n+  if (string[i] == '-' && _rl_digit_p (string[i+1]))\n     {\n       sign = -1;\n       i++;\n@@ -230,10 +230,12 @@ get_history_event (const char *string, int *caller_index, int delimiting_quote)\n         }\n \n #endif /* HANDLE_MULTIBYTE */\n-      if ((!substring_okay && (whitespace (c) || c == ':' ||\n-          (history_event_delimiter_chars && member (c, history_event_delimiter_chars)) ||\n-\t  (history_search_delimiter_chars && member (c, history_search_delimiter_chars)) ||\n-\t  string[i] == delimiting_quote)) ||\n+      if ((!substring_okay &&\n+\t    (whitespace (c) || c == ':' ||\n+\t    (i > local_index && history_event_delimiter_chars && c == '-') ||\n+\t    (c != '-' && history_event_delimiter_chars && member (c, history_event_delimiter_chars)) ||\n+\t    (history_search_delimiter_chars && member (c, history_search_delimiter_chars)) ||\n+\t    string[i] == delimiting_quote)) ||\n \t  string[i] == '\\n' ||\n \t  (substring_okay && string[i] == '?'))\n \tbreak;\n@@ -409,7 +411,10 @@ hist_error(char *s, int start, int current, int errtype)\n     }\n \n   temp = (char *)xmalloc (ll + elen + 3);\n-  strncpy (temp, s + start, ll);\n+  if (s[start])\n+    strncpy (temp, s + start, ll);\n+  else\n+    ll = 0;\n   temp[ll] = ':';\n   temp[ll + 1] = ' ';\n   strcpy (temp + ll + 2, emsg);\n@@ -624,7 +629,7 @@ history_expand_internal (char *string, int start, int qc, int *end_index_ptr, ch\n \t     return an error state after adding this line to the\n \t     history. */\n \tcase 'p':\n-\t  print_only++;\n+\t  print_only = 1;\n \t  break;\n \n \t  /* :t discards all but the last part of the pathname. */\n@@ -1356,6 +1361,11 @@ get_history_word_specifier (char *spec, char *from, int *caller_index)\n \t  i++;\n \t  last = '$';\n \t}\n+      else if (spec[i] == '^')\n+\t{\n+\t  i++;\n+\t  last = 1;\n+\t}\n #if 0\n       else if (!spec[i] || spec[i] == ':')\n \t/* check against `:' because there could be a modifier separator */"
    },
    {
      "sha": "f0fa5ce15fe1a90d2e6c28e9f0729893e5589fee",
      "filename": "readline/readline/histfile.c",
      "status": "modified",
      "additions": 40,
      "deletions": 12,
      "changes": 52,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/histfile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/histfile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/histfile.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* histfile.c - functions to manipulate the history file. */\n \n-/* Copyright (C) 1989-2018 Free Software Foundation, Inc.\n+/* Copyright (C) 1989-2019 Free Software Foundation, Inc.\n \n    This file contains the GNU History Library (History), a set of\n    routines for managing the text of previously typed lines.\n@@ -26,6 +26,8 @@\n #define READLINE_LIBRARY\n \n #if defined (__TANDEM)\n+#  define _XOPEN_SOURCE_EXTENDED 1\n+#  include <unistd.h>\n #  include <floss.h>\n #endif\n \n@@ -79,6 +81,11 @@\n \n #endif /* HISTORY_USE_MMAP */\n \n+#if defined(_WIN32)\n+#  define WIN32_LEAN_AND_MEAN\n+#  include <windows.h>\n+#endif\n+\n /* If we're compiling for __EMX__ (OS/2) or __CYGWIN__ (cygwin32 environment\n    on win 95/98/nt), we want to open files with O_BINARY mode so that there\n    is no \\n -> \\r\\n conversion performed.  On other systems, we don't want to\n@@ -138,6 +145,7 @@ static char *history_backupfile PARAMS((const char *));\n static char *history_tempfile PARAMS((const char *));\n static int histfile_backup PARAMS((const char *, const char *));\n static int histfile_restore PARAMS((const char *, const char *));\n+static int history_rename PARAMS((const char *, const char *));\n \n /* Return the string that should be used in the place of this\n    filename.  This only matters when you don't specify the\n@@ -449,6 +457,18 @@ read_history_range (const char *filename, int from, int to)\n   return (0);\n }\n \n+/* We need a special version for WIN32 because Windows rename() refuses to\n+   overwrite an existing file. */\n+static int\n+history_rename (const char *old, const char *new)\n+{\n+#if defined (_WIN32)\n+  return (MoveFileEx (old, new, MOVEFILE_REPLACE_EXISTING) == 0 ? -1 : 0);\n+#else\n+  return (rename (old, new));\n+#endif\n+}\n+\n /* Save FILENAME to BACK, handling case where FILENAME is a symlink\n    (e.g., ~/.bash_history -> .histfiles/.bash_history.$HOSTNAME) */\n static int\n@@ -462,10 +482,10 @@ histfile_backup (const char *filename, const char *back)\n   if ((n = readlink (filename, linkbuf, sizeof (linkbuf) - 1)) > 0)\n     {\n       linkbuf[n] = '\\0';\n-      return (rename (linkbuf, back));\n+      return (history_rename (linkbuf, back));\n     }\n #endif\n-  return (rename (filename, back));\n+  return (history_rename (filename, back));\n }\n \n /* Restore ORIG from BACKUP handling case where ORIG is a symlink\n@@ -481,12 +501,18 @@ histfile_restore (const char *backup, const char *orig)\n   if ((n = readlink (orig, linkbuf, sizeof (linkbuf) - 1)) > 0)\n     {\n       linkbuf[n] = '\\0';\n-      return (rename (backup, linkbuf));\n+      return (history_rename (backup, linkbuf));\n     }\n #endif\n-  return (rename (backup, orig));\n+  return (history_rename (backup, orig));\n }\n \n+/* Should we call chown, based on whether finfo and nfinfo describe different\n+   files with different owners? */\n+\n+#define SHOULD_CHOWN(finfo, nfinfo) \\\n+  (finfo.st_uid != nfinfo.st_uid || finfo.st_gid != nfinfo.st_gid)\n+  \n /* Truncate the history file FNAME, leaving only LINES trailing lines.\n    If FNAME is NULL, then use ~/.history.  Writes a new file and renames\n    it to the original name.  Returns 0 on success, errno on failure. */\n@@ -495,7 +521,7 @@ history_truncate_file (const char *fname, int lines)\n {\n   char *buffer, *filename, *tempname, *bp, *bp1;\t\t/* bp1 == bp+1 */\n   int file, chars_read, rv, orig_lines, exists, r;\n-  struct stat finfo;\n+  struct stat finfo, nfinfo;\n   size_t file_size;\n \n   history_lines_written_to_file = 0;\n@@ -516,6 +542,9 @@ history_truncate_file (const char *fname, int lines)\n     }\n   exists = 1;\n \n+  nfinfo.st_uid = finfo.st_uid;\n+  nfinfo.st_gid = finfo.st_gid;\n+\n   if (S_ISREG (finfo.st_mode) == 0)\n     {\n       close (file);\n@@ -604,6 +633,9 @@ history_truncate_file (const char *fname, int lines)\n       if (write (file, bp, chars_read - (bp - buffer)) < 0)\n \trv = errno;\n \n+      if (fstat (file, &nfinfo) < 0 && rv == 0)\n+\trv = errno;\n+\n       if (close (file) < 0 && rv == 0)\n \trv = errno;\n     }\n@@ -631,7 +663,7 @@ history_truncate_file (const char *fname, int lines)\n      user is running this, it's a no-op.  If the shell is running after sudo\n      with a shared history file, we don't want to leave the history file\n      owned by root. */\n-  if (rv == 0 && exists)\n+  if (rv == 0 && exists && SHOULD_CHOWN (finfo, nfinfo))\n     r = chown (filename, finfo.st_uid, finfo.st_gid);\n #endif\n \n@@ -650,7 +682,7 @@ history_do_write (const char *filename, int nelements, int overwrite)\n   register int i;\n   char *output, *tempname, *histname;\n   int file, mode, rv, exists;\n-  struct stat finfo;\n+  struct stat finfo, nfinfo;\n #ifdef HISTORY_USE_MMAP\n   size_t cursize;\n \n@@ -695,15 +727,11 @@ history_do_write (const char *filename, int nelements, int overwrite)\n     the_history = history_list ();\n     /* Calculate the total number of bytes to write. */\n     for (buffer_size = 0, i = history_length - nelements; i < history_length; i++)\n-#if 0\n-      buffer_size += 2 + HISTENT_BYTES (the_history[i]);\n-#else\n       {\n \tif (history_write_timestamps && the_history[i]->timestamp && the_history[i]->timestamp[0])\n \t  buffer_size += strlen (the_history[i]->timestamp) + 1;\n \tbuffer_size += strlen (the_history[i]->line) + 1;\n       }\n-#endif\n \n     /* Allocate the buffer, and fill it. */\n #ifdef HISTORY_USE_MMAP"
    },
    {
      "sha": "61b0fde3c87f25644fd9ff7ec1ef0e02d14c403c",
      "filename": "readline/readline/input.c",
      "status": "modified",
      "additions": 27,
      "deletions": 6,
      "changes": 33,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/input.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/input.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/input.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -22,6 +22,8 @@\n #define READLINE_LIBRARY\n \n #if defined (__TANDEM)\n+#  define _XOPEN_SOURCE_EXTENDED 1\n+#  define _TANDEM_SOURCE 1\n #  include <floss.h>\n #endif\n \n@@ -347,8 +349,7 @@ _rl_input_available (void)\n   FD_ZERO (&exceptfds);\n   FD_SET (tty, &readfds);\n   FD_SET (tty, &exceptfds);\n-  timeout.tv_sec = 0;\n-  timeout.tv_usec = _keyboard_input_timeout;\n+  USEC_TO_TIMEVAL (_keyboard_input_timeout, timeout);\n   return (select (tty + 1, &readfds, (fd_set *)NULL, &exceptfds, &timeout) > 0);\n #else\n \n@@ -367,6 +368,24 @@ _rl_input_available (void)\n   return 0;\n }\n \n+int\n+_rl_nchars_available ()\n+{\n+  int chars_avail, fd, result;\n+  \n+  chars_avail = 0;\n+     \n+#if defined (FIONREAD)\n+  fd = fileno (rl_instream);\n+  errno = 0;    \n+  result = ioctl (fd, FIONREAD, &chars_avail);    \n+  if (result == -1 && errno == EIO)    \n+    return -1;    \n+#endif\n+\n+  return chars_avail;\n+}\n+\n int\n _rl_input_queued (int t)\n {\n@@ -493,7 +512,7 @@ rl_read_key (void)\n \t{\n \t  if (rl_get_char (&c) == 0)\n \t    c = (*rl_getc_function) (rl_instream);\n-/* fprintf(stderr, \"rl_read_key: calling RL_CHECK_SIGNALS: _rl_caught_signal = %d\", _rl_caught_signal); */\n+/* fprintf(stderr, \"rl_read_key: calling RL_CHECK_SIGNALS: _rl_caught_signal = %d\\r\\n\", _rl_caught_signal); */\n \t  RL_CHECK_SIGNALS ();\n \t}\n     }\n@@ -596,6 +615,10 @@ rl_getc (FILE *stream)\n       else if (_rl_caught_signal == SIGINT)\n #endif\n         RL_CHECK_SIGNALS ();\n+#if defined (SIGTSTP)\n+      else if (_rl_caught_signal == SIGTSTP)\n+\tRL_CHECK_SIGNALS ();\n+#endif\n       /* non-keyboard-generated signals of interest */\n #if defined (SIGWINCH)\n       else if (_rl_caught_signal == SIGWINCH)\n@@ -631,9 +654,7 @@ _rl_read_mbchar (char *mbchar, int size)\n   mb_len = 0;  \n   while (mb_len < size)\n     {\n-      RL_SETSTATE(RL_STATE_MOREINPUT);\n-      c = rl_read_key ();\n-      RL_UNSETSTATE(RL_STATE_MOREINPUT);\n+      c = (mb_len == 0) ? _rl_bracketed_read_key () : rl_read_key ();\n \n       if (c < 0)\n \tbreak;"
    },
    {
      "sha": "080ba3cbb9c56ca617a306873c731b55ef561e0e",
      "filename": "readline/readline/isearch.c",
      "status": "modified",
      "additions": 68,
      "deletions": 7,
      "changes": 75,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/isearch.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/isearch.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/isearch.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -6,7 +6,7 @@\n /*\t\t\t\t\t\t\t\t    */\n /* **************************************************************** */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -185,11 +185,13 @@ rl_display_search (char *search_string, int flags, int where)\n   strcpy (message + msglen, \"i-search)`\");\n   msglen += 10;\n \n-  if (search_string)\n+  if (search_string && *search_string)\n     {\n       strcpy (message + msglen, search_string);\n       msglen += searchlen;\n     }\n+  else\n+    _rl_optimize_redisplay ();\n \n   strcpy (message + msglen, \"': \");\n \n@@ -255,6 +257,9 @@ _rl_isearch_init (int direction)\n \n   _rl_iscxt = cxt;\t\t/* save globally */\n \n+  /* experimental right now */\n+  _rl_init_executing_keyseq ();\n+\n   return cxt;\n }\n \n@@ -287,16 +292,22 @@ _rl_isearch_fini (_rl_search_cxt *cxt)\n       else\n \tcxt->sline_index = strlen (rl_line_buffer);\n       rl_mark = cxt->save_mark;\n+      rl_deactivate_mark ();\n     }\n \n   rl_point = cxt->sline_index;\n   /* Don't worry about where to put the mark here; rl_get_previous_history\n-     and rl_get_next_history take care of it. */\n+     and rl_get_next_history take care of it.\n+     If we want to highlight the search string, this is where to set the\n+     point and mark to do it. */\n   _rl_fix_point (0);\n+  rl_deactivate_mark ();\n \n+/*  _rl_optimize_redisplay (); */\n   rl_clear_message ();\n }\n \n+/* XXX - we could use _rl_bracketed_read_mbstring () here. */\n int\n _rl_search_getchar (_rl_search_cxt *cxt)\n {\n@@ -342,6 +353,24 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n       return -1;\n     }\n \n+  _rl_add_executing_keyseq (c);\n+\n+  /* XXX - experimental code to allow users to bracketed-paste into the search\n+     string even when ESC is one of the isearch-terminators. Not perfect yet. */\n+  if (_rl_enable_bracketed_paste && c == ESC && strchr (cxt->search_terminators, c) && (n = _rl_nchars_available ()) > (BRACK_PASTE_SLEN-1))\n+    {\n+      j = _rl_read_bracketed_paste_prefix (c);\n+      if (j == 1)\n+\t{\n+\t  cxt->lastc = -7;\t\t/* bracketed paste, see below */\n+\t  goto opcode_dispatch;\t\n+        }\n+      else if (_rl_pushed_input_available ())\t/* eat extra char we pushed back */\n+\tc = cxt->lastc = rl_read_key ();\n+      else\n+\tc = cxt->lastc;\t\t\t/* last ditch */\n+    }\n+\n   /* If we are moving into a new keymap, modify cxt->keymap and go on.\n      This can be a problem if c == ESC and we want to terminate the\n      incremental search, so we check */\n@@ -387,7 +416,18 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n   /* Translate the keys we do something with to opcodes. */\n   if (c >= 0 && cxt->keymap[c].type == ISFUNC)\n     {\n-      f = cxt->keymap[c].function;\n+      /* If we have a multibyte character, see if it's bound to something that\n+\t affects the search. */\n+#if defined (HANDLE_MULTIBYTE)\n+      if (MB_CUR_MAX > 1 && rl_byte_oriented == 0 && cxt->mb[1])\n+\tf = rl_function_of_keyseq (cxt->mb, cxt->keymap, (int *)NULL);\n+      else\n+#endif\n+\t{\n+\t  f = cxt->keymap[c].function;\n+\t  if (f == rl_do_lowercase_version)\n+\t    f = cxt->keymap[_rl_to_lower (c)].function;\n+\t}\n \n       if (f == rl_reverse_search_history)\n \tcxt->lastc = (cxt->sflags & SF_REVERSE) ? -1 : -2;\n@@ -454,9 +494,14 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n \t}\n       else if (cxt->lastc > 0 && cxt->prevc > 0 && f && f != rl_insert)\n \t{\n-\t  rl_stuff_char (cxt->lastc);\n-\t  rl_execute_next (cxt->prevc);\n-\t  /* XXX - do we insert everything in cxt->pmb? */\n+\t  _rl_term_executing_keyseq ();\t\t/* should this go in the caller? */\n+\n+\t  _rl_pending_command.map = cxt->keymap;\n+\t  _rl_pending_command.count = 1;\t/* XXX */\n+\t  _rl_pending_command.key = cxt->lastc;\n+\t  _rl_pending_command.func = f;\n+\t  _rl_command_to_execute = &_rl_pending_command;\n+\n \t  return (0);\n \t}\n     }\n@@ -502,6 +547,9 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n \treturn (0);\n       }\n \n+  _rl_init_executing_keyseq ();\n+\n+opcode_dispatch:\n   /* Now dispatch on the character.  `Opcodes' affect the search string or\n      state.  Other characters are added to the string.  */\n   switch (cxt->lastc)\n@@ -519,6 +567,7 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n \t      rl_display_search (cxt->search_string, cxt->sflags, -1);\n \t      break;\n \t    }\n+\t  /* XXX - restore keymap here? */\n \t  return (1);\n \t}\n       else if ((cxt->sflags & SF_REVERSE) && cxt->sline_index >= 0)\n@@ -566,9 +615,11 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n       rl_replace_line (cxt->lines[cxt->save_line], 0);\n       rl_point = cxt->save_point;\n       rl_mark = cxt->save_mark;\n+      rl_deactivate_mark ();\n       rl_restore_prompt();\n       rl_clear_message ();\n \n+      _rl_fix_point (1);\t/* in case save_line and save_point are out of sync */\n       return -1;\n \n     case -5:\t/* C-W */\n@@ -632,6 +683,8 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n \t  free (paste);\n \t  break;\n \t}\n+      if (_rl_enable_active_region)\n+\trl_activate_mark ();\n       if (cxt->search_string_index + pastelen + 1 >= cxt->search_string_size)\n \t{\n \t  cxt->search_string_size += pastelen + 2;\n@@ -736,11 +789,15 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n       cxt->sline_index = (cxt->sflags & SF_REVERSE) ? cxt->sline_len - cxt->search_string_index : 0;\n     }\n \n+  /* reset the keymaps for the next time through the loop */\n+  cxt->keymap = cxt->okeymap = _rl_keymap;\n+\n   if (cxt->sflags & SF_FAILED)\n     {\n       /* We cannot find the search string.  Ding the bell. */\n       rl_ding ();\n       cxt->history_pos = cxt->last_found_line;\n+      rl_deactivate_mark ();\n       rl_display_search (cxt->search_string, cxt->sflags, (cxt->history_pos == cxt->save_line) ? -1 : cxt->history_pos);\n       return 1;\n     }\n@@ -752,7 +809,11 @@ _rl_isearch_dispatch (_rl_search_cxt *cxt, int c)\n     {\n       cxt->prev_line_found = cxt->lines[cxt->history_pos];\n       rl_replace_line (cxt->lines[cxt->history_pos], 0);\n+      if (_rl_enable_active_region)\n+\trl_activate_mark ();\t\n       rl_point = cxt->sline_index;\n+      if (rl_mark_active_p () && cxt->search_string_index > 0)\n+\trl_mark = rl_point + cxt->search_string_index;\n       cxt->last_found_line = cxt->history_pos;\n       rl_display_search (cxt->search_string, cxt->sflags, (cxt->history_pos == cxt->save_line) ? -1 : cxt->history_pos);\n     }"
    },
    {
      "sha": "50c3fdead765bc71b0e3e2d1ef81e4155982aa8a",
      "filename": "readline/readline/kill.c",
      "status": "modified",
      "additions": 105,
      "deletions": 5,
      "changes": 110,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/kill.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/kill.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/kill.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* kill.c -- kill ring management. */\n \n-/* Copyright (C) 1994-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1994-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -408,6 +408,7 @@ region_kill_internal (int delete)\n       _rl_copy_to_kill_ring (text, rl_point < rl_mark);\n     }\n \n+  _rl_fix_point (1);\n   _rl_last_command_was_kill++;\n   return 0;\n }\n@@ -427,8 +428,8 @@ rl_kill_region (int count, int key)\n \n   npoint = (rl_point < rl_mark) ? rl_point : rl_mark;\n   r = region_kill_internal (1);\n-  _rl_fix_point (1);\n   rl_point = npoint;\n+  _rl_fix_point (1);\n   return r;\n }\n \n@@ -605,7 +606,7 @@ rl_yank_nth_arg_internal (int count, int key, int history_skip)\n #if defined (VI_MODE)\n   /* Vi mode always inserts a space before yanking the argument, and it\n      inserts it right *after* rl_point. */\n-  if (rl_editing_mode == vi_mode)\n+  if (rl_editing_mode == vi_mode && _rl_keymap == vi_movement_keymap)\n     {\n       rl_vi_append_mode (1, key);\n       rl_insert_text (\" \");\n@@ -668,8 +669,7 @@ rl_yank_last_arg (int count, int key)\n \n /* Having read the special escape sequence denoting the beginning of a\n    `bracketed paste' sequence, read the rest of the pasted input until the\n-   closing sequence and insert the pasted text as a single unit without\n-   interpretation. */\n+   closing sequence and return the pasted text. */\n char *\n _rl_bracketed_text (size_t *lenp)\n {\n@@ -715,6 +715,10 @@ _rl_bracketed_text (size_t *lenp)\n   return (buf);\n }\n \n+/* Having read the special escape sequence denoting the beginning of a\n+   `bracketed paste' sequence, read the rest of the pasted input until the\n+   closing sequence and insert the pasted text as a single unit without\n+   interpretation. Temporarily highlight the inserted text. */\n int\n rl_bracketed_paste_begin (int count, int key)\n {\n@@ -723,12 +727,108 @@ rl_bracketed_paste_begin (int count, int key)\n   char *buf;\n \n   buf = _rl_bracketed_text (&len);\n+  rl_mark = rl_point;\n   retval = rl_insert_text (buf) == len ? 0 : 1;\n+  if (_rl_enable_active_region)\n+    rl_activate_mark ();\n \n   xfree (buf);\n   return (retval);\n }\n \n+int\n+_rl_read_bracketed_paste_prefix (int c)\n+{\n+  char pbuf[BRACK_PASTE_SLEN+1], *pbpref;\n+  int key, ind, j;\n+\n+  pbpref = BRACK_PASTE_PREF;\t\t/* XXX - debugging */\n+  if (c != pbpref[0])\n+    return (0);\n+  pbuf[ind = 0] = c;\n+  while (ind < BRACK_PASTE_SLEN-1 &&\n+\t (RL_ISSTATE (RL_STATE_INPUTPENDING|RL_STATE_MACROINPUT) == 0) &&\n+         _rl_pushed_input_available () == 0 &&\n+         _rl_input_queued (0))\n+    {\n+      key = rl_read_key ();\t\t/* XXX - for now */\n+      if (key < 0)\n+\tbreak;\n+      pbuf[++ind] = key;\n+      if (pbuf[ind] != pbpref[ind])\n+        break;\n+    }\n+\n+  if (ind < BRACK_PASTE_SLEN-1)\t\t/* read incomplete sequence */\n+    {\n+      while (ind >= 0)\n+\t_rl_unget_char (pbuf[ind--]);\n+      return (key < 0 ? key : 0);\n+    }\n+  return (key < 0 ? key : 1);\n+}\n+\n+/* Get a character from wherever we read input, handling input in bracketed\n+   paste mode. If we don't have or use bracketed paste mode, this can be\n+   used in place of rl_read_key(). */\n+int\n+_rl_bracketed_read_key ()\n+{\n+  int c, r;\n+  char *pbuf;\n+  size_t pblen;\n+\n+  RL_SETSTATE(RL_STATE_MOREINPUT);\n+  c = rl_read_key ();\n+  RL_UNSETSTATE(RL_STATE_MOREINPUT);\n+\n+  if (c < 0)\n+    return -1;\n+\n+  /* read pasted data with bracketed-paste mode enabled. */\n+  if (_rl_enable_bracketed_paste && c == ESC && (r = _rl_read_bracketed_paste_prefix (c)) == 1)\n+    {\n+      pbuf = _rl_bracketed_text (&pblen);\n+      if (pblen == 0)\n+\t{\n+\t  xfree (pbuf);\n+\t  return 0;\t\t/* XXX */\n+\t}\n+      c = (unsigned char)pbuf[0];\n+      if (pblen > 1)\n+\t{\n+\t  while (--pblen > 0)\n+\t    _rl_unget_char ((unsigned char)pbuf[pblen]);\n+\t}\n+      xfree (pbuf);\n+    }\n+\n+  return c;\n+}\n+\n+/* Get a character from wherever we read input, handling input in bracketed\n+   paste mode. If we don't have or use bracketed paste mode, this can be\n+   used in place of rl_read_key(). */\n+int\n+_rl_bracketed_read_mbstring (char *mb, int mlen)\n+{\n+  int c, r;\n+\n+  c = _rl_bracketed_read_key ();\n+  if (c < 0)\n+    return -1;\n+\n+#if defined (HANDLE_MULTIBYTE)\n+  if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n+    c = _rl_read_mbstring (c, mb, mlen);\n+  else\n+#endif\n+    mb[0] = c;\n+  mb[mlen] = '\\0';\t\t/* just in case */\n+\n+  return c;\n+}\n+\n /* A special paste command for Windows users. */\n #if defined (_WIN32)\n #include <windows.h>"
    },
    {
      "sha": "dc62b4cc24dd55df745c1e623a24f3ca94f21059",
      "filename": "readline/readline/mbutil.c",
      "status": "modified",
      "additions": 95,
      "deletions": 11,
      "changes": 106,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/mbutil.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/mbutil.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/mbutil.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* mbutil.c -- readline multibyte character utility functions */\n \n-/* Copyright (C) 2001-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 2001-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -86,7 +86,7 @@ int _rl_utf8locale = 0;\n static int\n _rl_utf8_mblen (const char *s, size_t n)\n {\n-  unsigned char c, c1;\n+  unsigned char c, c1, c2, c3;\n \n   if (s == 0)\n     return (0);\t/* no shift states */\n@@ -101,25 +101,46 @@ _rl_utf8_mblen (const char *s, size_t n)\n       c1 = (unsigned char)s[1];\n       if (c < 0xe0)\n \t{\n-\t  if (n >= 2 && (s[1] ^ 0x80) < 0x40)\n+\t  if (n == 1)\n+\t    return -2;\n+\t  if (n >= 2 && (c1 ^ 0x80) < 0x40)\n \t    return 2;\n \t}\n       else if (c < 0xf0)\n \t{\n-\t  if (n >= 3\n-\t\t&& (s[1] ^ 0x80) < 0x40 && (s[2] ^ 0x80) < 0x40\n+\t  if (n == 1)\n+\t    return -2;\n+\t  if ((c1 ^ 0x80) < 0x40\n \t\t&& (c >= 0xe1 || c1 >= 0xa0)\n \t\t&& (c != 0xed || c1 < 0xa0))\n-\t    return 3;\n+\t    {\n+\t      if (n == 2)\n+\t\treturn -2;\n+\t      c2 = (unsigned char)s[2];\n+\t      if ((c2 ^ 0x80) < 0x40)\n+\t\treturn 3;\n+\t    }\n \t}\n-      else if (c < 0xf8)\n+      else if (c < 0xf4)\n \t{\n-\t  if (n >= 4\n-\t\t&& (s[1] ^ 0x80) < 0x40 && (s[2] ^ 0x80) < 0x40\n-\t \t&& (s[3] ^ 0x80) < 0x40\n+\t  if (n == 1)\n+\t    return -2;\n+\t  if (((c1 ^ 0x80) < 0x40)\n \t\t&& (c >= 0xf1 || c1 >= 0x90)\n \t\t&& (c < 0xf4 || (c == 0xf4 && c1 < 0x90)))\n-\t    return 4;\n+\t    {\n+\t      if (n == 2)\n+\t\treturn -2;\n+\t      c2 = (unsigned char)s[2];\n+\t      if ((c2 ^ 0x80) < 0x40)\n+\t\t{\n+\t\t  if (n == 3)\n+\t\t    return -2;\n+\t\t  c3 = (unsigned char)s[3];\n+\t\t  if ((c3 ^ 0x80) < 0x40)\n+\t\t    return 4;\n+\t\t}\n+\t    }\n \t}\n     }\n   /* invalid or incomplete multibyte character */\n@@ -206,6 +227,66 @@ _rl_find_next_mbchar_internal (char *string, int seed, int count, int find_non_z\n   return point;\n }\n \n+static inline int\n+_rl_test_nonzero (char *string, int ind, int len)\n+{\n+  size_t tmp;\n+  wchar_t wc;\n+  mbstate_t ps;\n+\n+  memset (&ps, 0, sizeof (mbstate_t));\n+  tmp = mbrtowc (&wc, string + ind, len - ind, &ps);\n+  /* treat invalid multibyte sequences as non-zero-width */\n+  return (MB_INVALIDCH (tmp) || MB_NULLWCH (tmp) || WCWIDTH (wc) > 0);\n+}\n+\n+/* experimental -- needs to handle zero-width characters better */\n+static int\n+_rl_find_prev_utf8char (char *string, int seed, int find_non_zero)\n+{\n+  char *s;\n+  unsigned char b;\n+  int save, prev;\n+  size_t len;\n+\n+  if (find_non_zero)\n+    len = RL_STRLEN (string);\n+\n+  prev = seed - 1;\n+  while (prev >= 0)\n+   {\n+      b = (unsigned char)string[prev];\n+      if (UTF8_SINGLEBYTE (b))\n+\treturn (prev);\n+\n+      save = prev;\n+\n+      /* Move back until we're not in the middle of a multibyte char */\n+      if (UTF8_MBCHAR (b))\n+\t{\n+\t  while (prev > 0 && (b = (unsigned char)string[--prev]) && UTF8_MBCHAR (b))\n+\t    ;\n+\t}\n+\n+      if (UTF8_MBFIRSTCHAR (b))\n+\t{\n+\t  if (find_non_zero)\n+\t    {\n+\t      if (_rl_test_nonzero (string, prev, len))\n+\t\treturn (prev);\n+\t      else\t\t/* valid but WCWIDTH (wc) == 0 */\n+\t\tprev = prev - 1;\n+\t    }\n+\t  else\n+\t    return (prev);\n+\t}\n+      else\n+\treturn (save);\t\t\t/* invalid utf-8 multibyte sequence */\n+    }\n+\n+  return ((prev < 0) ? 0 : prev);\n+}  \n+\n /*static*/ int\n _rl_find_prev_mbchar_internal (char *string, int seed, int find_non_zero)\n {\n@@ -214,6 +295,9 @@ _rl_find_prev_mbchar_internal (char *string, int seed, int find_non_zero)\n   size_t tmp;\n   wchar_t wc;\n \n+  if (_rl_utf8locale)\n+    return (_rl_find_prev_utf8char (string, seed, find_non_zero));\n+\n   memset(&ps, 0, sizeof(mbstate_t));\n   length = strlen(string);\n   "
    },
    {
      "sha": "3d9a674ca59d9a4de961ac846cd66fe221c4f2c6",
      "filename": "readline/readline/misc.c",
      "status": "modified",
      "additions": 58,
      "deletions": 5,
      "changes": 63,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/misc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/misc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/misc.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* misc.c -- miscellaneous bindable readline functions. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2019 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -138,9 +138,7 @@ _rl_arg_dispatch (_rl_arg_cxt cxt, int c)\n         }\n       else\n \t{\n-\t  RL_SETSTATE(RL_STATE_MOREINPUT);\n-\t  key = rl_read_key ();\n-\t  RL_UNSETSTATE(RL_STATE_MOREINPUT);\n+\t  key = _rl_bracketed_read_key ();\n \t  rl_restore_prompt ();\n \t  rl_clear_message ();\n \t  RL_UNSETSTATE(RL_STATE_NUMERICARG);\n@@ -435,7 +433,7 @@ rl_replace_from_history (HIST_ENTRY *entry, int flags)\n    intended to be called while actively editing, and the current line is\n    not assumed to have been added to the history list. */\n void\n-_rl_revert_all_lines (void)\n+_rl_revert_previous_lines (void)\n {\n   int hpos;\n   HIST_ENTRY *entry;\n@@ -479,6 +477,19 @@ _rl_revert_all_lines (void)\n   xfree (lbuf);\n }  \n \n+/* Revert all lines in the history by making sure we are at the end of the\n+   history before calling _rl_revert_previous_lines() */\n+void\n+_rl_revert_all_lines (void)\n+{\n+  int pos;\n+\n+  pos = where_history ();\n+  using_history ();\n+  _rl_revert_previous_lines ();\n+  history_set_pos (pos);\n+}\n+\n /* Free the history list, including private readline data and take care\n    of pointer aliases to history data.  Resets rl_undo_list if it points\n    to an UNDO_LIST * saved as some history entry's data member.  This\n@@ -626,6 +637,48 @@ rl_get_previous_history (int count, int key)\n   return 0;\n }\n \n+/* The equivalent of the Korn shell C-o operate-and-get-next-history-line\n+   editing command. */\n+\n+/* This could stand to be global to the readline library */\n+static rl_hook_func_t *_rl_saved_internal_startup_hook = 0;\n+static int saved_history_logical_offset = -1;\n+\n+#define HISTORY_FULL() (history_is_stifled () && history_length >= history_max_entries)\n+\n+static int\n+set_saved_history ()\n+{\n+  int absolute_offset, count;\n+\n+  if (saved_history_logical_offset >= 0)\n+    {\n+      absolute_offset = saved_history_logical_offset - history_base;\n+      count = where_history () - absolute_offset;\n+      rl_get_previous_history (count, 0);\n+    }\n+  saved_history_logical_offset = -1;\n+  _rl_internal_startup_hook = _rl_saved_internal_startup_hook;\n+\n+  return (0);\n+}\n+\n+int\n+rl_operate_and_get_next (count, c)\n+     int count, c;\n+{\n+  /* Accept the current line. */\n+  rl_newline (1, c);\n+\n+  saved_history_logical_offset = rl_explicit_arg ? count : where_history () + history_base + 1;\n+\n+\n+  _rl_saved_internal_startup_hook = _rl_internal_startup_hook;\n+  _rl_internal_startup_hook = set_saved_history;\n+\n+  return 0;\n+}\n+\n /* **************************************************************** */\n /*\t\t\t\t\t\t\t\t    */\n /*\t\t\t    Editing Modes\t\t\t    */"
    },
    {
      "sha": "d8c9df7e6bb19b63a7c7f1c4f192a91529e40699",
      "filename": "readline/readline/patchlevel",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/patchlevel",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/patchlevel",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/patchlevel?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,3 +1,3 @@\n # Do not edit -- exists only for use by patch\n \n-4\n+0"
    },
    {
      "sha": "af5be8012b347eee3b62ba0e78f36109619999e0",
      "filename": "readline/readline/posixdir.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/posixdir.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/posixdir.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/posixdir.h?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -46,7 +46,7 @@\n #  define D_NAMLEN(d)   ((d)->d_namlen)\n #endif /* !HAVE_DIRENT_H */\n \n-/* The bash code fairly consistenly uses d_fileno; make sure it's available */\n+/* The bash code fairly consistently uses d_fileno; make sure it's available */\n #if defined (HAVE_STRUCT_DIRENT_D_INO) && !defined (HAVE_STRUCT_DIRENT_D_FILENO)\n #  define d_fileno d_ino\n #endif"
    },
    {
      "sha": "b60778606b65bedbb911ff105e1e4851af080075",
      "filename": "readline/readline/posixstat.h",
      "status": "modified",
      "additions": 4,
      "deletions": 4,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/posixstat.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/posixstat.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/posixstat.h?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n /* posixstat.h -- Posix stat(2) definitions for systems that\n    don't have them. */\n \n-/* Copyright (C) 1987,1991 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2019 Free Software Foundation, Inc.\n \n    This file is part of GNU Bash, the Bourne Again SHell.\n \n@@ -132,9 +132,9 @@\n #  define S_IRWXU\t(S_IRUSR | S_IWUSR | S_IXUSR)\n #  define S_IRWXG\t(S_IRGRP | S_IWGRP | S_IXGRP)\n #  define S_IRWXO\t(S_IROTH | S_IWOTH | S_IXOTH)\n-#else  /* !S_IRWXU */\n-   /* S_IRWXU is defined, but \"group\" and \"other\" bits might not be\n-      (happens in certain versions of MinGW).  */\n+#else /* !S_IRWXU */\n+  /* S_IRWXU is defined, but \"group\" and \"other\" bits might not be\n+     (happens in certain versions of MinGW).  */\n #  if !defined (S_IRGRP)\n #    define S_IRGRP\t(S_IREAD  >> 3)\t\t/* read, group */\n #    define S_IWGRP\t(S_IWRITE >> 3)\t\t/* write, group */"
    },
    {
      "sha": "e61d188bbe944264e8e6cbdd8a878bfb1db33a9a",
      "filename": "readline/readline/readline.c",
      "status": "modified",
      "additions": 91,
      "deletions": 7,
      "changes": 98,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/readline.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/readline.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/readline.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n /* readline.c -- a general facility for reading lines of input\n    with emacs style editing and completion. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -73,11 +73,11 @@ extern int errno;\n #include \"xmalloc.h\"\n \n #ifndef RL_LIBRARY_VERSION\n-#  define RL_LIBRARY_VERSION \"5.1\"\n+#  define RL_LIBRARY_VERSION \"8.0\"\n #endif\n \n #ifndef RL_READLINE_VERSION\n-#  define RL_READLINE_VERSION\t0x0501\n+#  define RL_READLINE_VERSION\t0x0800\n #endif\n \n extern void _rl_free_history_entry PARAMS((HIST_ENTRY *));\n@@ -199,6 +199,10 @@ int rl_key_sequence_length = 0;\n    before readline_internal_setup () prints the first prompt. */\n rl_hook_func_t *rl_startup_hook = (rl_hook_func_t *)NULL;\n \n+/* Any readline function can set this and have it run just before the user's\n+   rl_startup_hook. */\n+rl_hook_func_t *_rl_internal_startup_hook = (rl_hook_func_t *)NULL;\n+\n /* If non-zero, this is the address of a function to call just before\n    readline_internal_setup () returns and readline_internal starts\n    reading input characters. */\n@@ -258,6 +262,9 @@ int rl_executing_key;\n char *rl_executing_keyseq = 0;\n int _rl_executing_keyseq_size = 0;\n \n+struct _rl_cmd _rl_pending_command;\n+struct _rl_cmd *_rl_command_to_execute = (struct _rl_cmd *)NULL;\n+\n /* Timeout (specified in milliseconds) when reading characters making up an\n    ambiguous multiple-key sequence */\n int _rl_keyseq_timeout = 500;\n@@ -314,7 +321,8 @@ int _rl_show_mode_in_prompt = 0;\n /* Non-zero means to attempt to put the terminal in `bracketed paste mode',\n    where it will prefix pasted text with an escape sequence and send\n    another to mark the end of the paste. */\n-int _rl_enable_bracketed_paste = 0;\n+int _rl_enable_bracketed_paste = BRACKETED_PASTE_DEFAULT;\n+int _rl_enable_active_region = BRACKETED_PASTE_DEFAULT;\n \n /* **************************************************************** */\n /*\t\t\t\t\t\t\t\t    */\n@@ -417,6 +425,11 @@ readline_internal_setup (void)\n   if (rl_startup_hook)\n     (*rl_startup_hook) ();\n \n+  if (_rl_internal_startup_hook)\n+    (*_rl_internal_startup_hook) ();\n+\n+  rl_deactivate_mark ();\n+\n #if defined (VI_MODE)\n   if (rl_editing_mode == vi_mode)\n     rl_vi_insertion_mode (1, 'i');\t/* don't want to reset last */\n@@ -632,12 +645,34 @@ readline_internal_charloop (void)\n       r = _rl_dispatch ((unsigned char)c, _rl_keymap);\n       RL_CHECK_SIGNALS ();\n \n+      if (_rl_command_to_execute)\n+\t{\n+\t  (*rl_redisplay_function) ();\n+\n+\t  rl_executing_keymap = _rl_command_to_execute->map;\n+\t  rl_executing_key = _rl_command_to_execute->key;\n+\n+\t  rl_dispatching = 1;\n+\t  RL_SETSTATE(RL_STATE_DISPATCHING);\n+\t  r = (*(_rl_command_to_execute->func)) (_rl_command_to_execute->count, _rl_command_to_execute->key);\n+\t  _rl_command_to_execute = 0;\n+\t  RL_UNSETSTATE(RL_STATE_DISPATCHING);\n+\t  rl_dispatching = 0;\n+\n+\t  RL_CHECK_SIGNALS ();\n+\t}\n+\n       /* If there was no change in _rl_last_command_was_kill, then no kill\n \t has taken place.  Note that if input is pending we are reading\n \t a prefix command, so nothing has changed yet. */\n       if (rl_pending_input == 0 && lk == _rl_last_command_was_kill)\n \t_rl_last_command_was_kill = 0;\n \n+      if (_rl_keep_mark_active)\n+        _rl_keep_mark_active = 0;\n+      else if (rl_mark_active_p ())\n+        rl_deactivate_mark ();\n+\n       _rl_internal_char_cleanup ();\n \n #if defined (READLINE_CALLBACKS)\n@@ -856,7 +891,11 @@ _rl_dispatch_subseq (register int key, Keymap map, int got_subseq)\n \t  /* If we have input pending, then the last command was a prefix\n \t     command.  Don't change the state of rl_last_func.  Otherwise,\n \t     remember the last command executed in this variable. */\n+#if defined (VI_MODE)\n+\t  if (rl_pending_input == 0 && map[key].function != rl_digit_argument && map[key].function != rl_vi_arg_digit)\n+#else\n \t  if (rl_pending_input == 0 && map[key].function != rl_digit_argument)\n+#endif\n \t    rl_last_func = map[key].function;\n \n \t  RL_CHECK_SIGNALS ();\n@@ -870,6 +909,8 @@ _rl_dispatch_subseq (register int key, Keymap map, int got_subseq)\n \t    _rl_prev_macro_key ();\n \t  else\n \t    _rl_unget_char  (key);\n+\t  if (rl_key_sequence_length > 0)\n+\t    rl_executing_keyseq[--rl_key_sequence_length] = '\\0';\n \t  return -2;\n \t}\n       else if (got_subseq)\n@@ -882,6 +923,8 @@ _rl_dispatch_subseq (register int key, Keymap map, int got_subseq)\n \t    _rl_prev_macro_key ();\n \t  else\n \t    _rl_unget_char (key);\n+\t  if (rl_key_sequence_length > 0)\n+\t    rl_executing_keyseq[--rl_key_sequence_length] = '\\0';\n \t  return -1;\n \t}\n       else\n@@ -974,7 +1017,11 @@ _rl_dispatch_subseq (register int key, Keymap map, int got_subseq)\n \t  \t_rl_pushed_input_available () == 0 &&\n \t\t_rl_dispatching_keymap[ANYOTHERKEY].function &&\n \t\t_rl_input_queued (_rl_keyseq_timeout*1000) == 0)\n-\t    return (_rl_subseq_result (-2, map, key, got_subseq));\n+\t    {\n+\t      if (rl_key_sequence_length > 0)\n+\t\trl_executing_keyseq[--rl_key_sequence_length] = '\\0';\n+\t      return (_rl_subseq_result (-2, map, key, got_subseq));\n+\t    }\n \n \t  newkey = _rl_subseq_getchar (key);\n \t  if (newkey < 0)\n@@ -1065,6 +1112,8 @@ _rl_subseq_result (int r, Keymap map, int key, int got_subseq)\n \t_rl_prev_macro_key ();\n       else\n \t_rl_unget_char (key);\n+      if (rl_key_sequence_length > 0)\n+\trl_executing_keyseq[--rl_key_sequence_length] = '\\0';\n       _rl_dispatching_keymap = map;\n       return -2;\n     }\n@@ -1075,6 +1124,8 @@ _rl_subseq_result (int r, Keymap map, int key, int got_subseq)\n \t_rl_prev_macro_key ();\n       else\n \t_rl_unget_char (key);\n+      if (rl_key_sequence_length > 0)\n+\trl_executing_keyseq[--rl_key_sequence_length] = '\\0';\n       _rl_dispatching_keymap = map;\n       return -1;\n     }\n@@ -1241,7 +1292,7 @@ readline_initialize_everything (void)\n \n   rl_executing_keyseq = malloc (_rl_executing_keyseq_size = 16);\n   if (rl_executing_keyseq)\n-    rl_executing_keyseq[0] = '\\0';\n+    rl_executing_keyseq[rl_key_sequence_length = 0] = '\\0';\n }\n \n /* If this system allows us to look at the values of the regular\n@@ -1356,9 +1407,12 @@ bind_bracketed_paste_prefix (void)\n \n   _rl_keymap = emacs_standard_keymap;\n   rl_bind_keyseq_if_unbound (BRACK_PASTE_PREF, rl_bracketed_paste_begin);\n-  \n+\n+#if defined (VI_MODE)\n   _rl_keymap = vi_insertion_keymap;\n   rl_bind_keyseq_if_unbound (BRACK_PASTE_PREF, rl_bracketed_paste_begin);\n+  /* XXX - is there a reason to do this in the vi command keymap? */\n+#endif\n \n   _rl_keymap = xkeymap;\n }\n@@ -1446,5 +1500,35 @@ rl_restore_state (struct readline_state *sp)\n   rl_attempted_completion_function = sp->attemptfunc;\n   rl_completer_word_break_characters = sp->wordbreakchars;\n \n+  rl_deactivate_mark ();\n+\n   return (0);\n }\n+\n+/* Functions to manage the string that is the current key sequence. */\n+\n+void\n+_rl_init_executing_keyseq (void)\n+{\n+  rl_executing_keyseq[rl_key_sequence_length = 0] = '\\0';\n+}\n+\n+void\n+_rl_term_executing_keyseq (void)\n+{\n+  rl_executing_keyseq[rl_key_sequence_length] = '\\0';\n+}\n+\n+void\n+_rl_end_executing_keyseq (void)\n+{\n+  if (rl_key_sequence_length > 0)\n+    rl_executing_keyseq[--rl_key_sequence_length] = '\\0';\n+}\n+\n+void\n+_rl_add_executing_keyseq (int key)\n+{\n+  RESIZE_KEYSEQ_BUFFER ();\n+ rl_executing_keyseq[rl_key_sequence_length++] = key;\n+}"
    },
    {
      "sha": "78fa39d02a1d59c0d17bbcca01944b488f0d8a86",
      "filename": "readline/readline/readline.h",
      "status": "modified",
      "additions": 13,
      "deletions": 3,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/readline.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/readline.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/readline.h?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* Readline.h -- the names of functions callable from within readline. */\n \n-/* Copyright (C) 1987-2016 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -39,9 +39,9 @@ extern \"C\" {\n #endif\n \n /* Hex-encoded Readline version number. */\n-#define RL_READLINE_VERSION\t0x0800\t\t/* Readline 8.0 */\n+#define RL_READLINE_VERSION\t0x0801\t\t/* Readline 8.0 */\n #define RL_VERSION_MAJOR\t8\n-#define RL_VERSION_MINOR\t0\n+#define RL_VERSION_MINOR\t1\n \n /* Readline data structures. */\n \n@@ -95,6 +95,7 @@ extern int rl_forward_word PARAMS((int, int));\n extern int rl_backward_word PARAMS((int, int));\n extern int rl_refresh_line PARAMS((int, int));\n extern int rl_clear_screen PARAMS((int, int));\n+extern int rl_clear_display PARAMS((int, int));\n extern int rl_skip_csi_sequence PARAMS((int, int));\n extern int rl_arrow_keys PARAMS((int, int));\n \n@@ -132,6 +133,7 @@ extern int rl_beginning_of_history PARAMS((int, int));\n extern int rl_end_of_history PARAMS((int, int));\n extern int rl_get_next_history PARAMS((int, int));\n extern int rl_get_previous_history PARAMS((int, int));\n+extern int rl_operate_and_get_next PARAMS((int, int));\n \n /* Bindable commands for managing the mark and region. */\n extern int rl_set_mark PARAMS((int, int));\n@@ -392,6 +394,14 @@ extern int rl_clear_message PARAMS((void));\n extern int rl_reset_line_state PARAMS((void));\n extern int rl_crlf PARAMS((void));\n \n+/* Functions to manage the mark and region, especially the notion of an\n+   active mark and an active region. */\n+extern void rl_keep_mark_active PARAMS((void));\n+\n+extern void rl_activate_mark PARAMS((void));\n+extern void rl_deactivate_mark PARAMS((void));\n+extern int rl_mark_active_p PARAMS((void));\n+\n #if defined (USE_VARARGS) && defined (PREFER_STDARG)\n extern int rl_message (const char *, ...)  __attribute__((__format__ (printf, 1, 2)));\n #else"
    },
    {
      "sha": "ff79d7117886bf4a376e902fa0537e7aa43cdd4b",
      "filename": "readline/readline/readline.pc.in",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/readline.pc.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/readline.pc.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/readline.pc.in?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -9,4 +9,4 @@ URL: http://tiswww.cwru.edu/php/chet/readline/rltop.html\n Version: @LIBVERSION@\n Requires.private: @TERMCAP_PKG_CONFIG_LIB@\n Libs: -L${libdir} -lreadline\n-Cflags: -I${includedir}/readline\n+Cflags: -I${includedir}"
    },
    {
      "sha": "4d3e90706a2534e3d8cb524b99ff78ebe9cf96aa",
      "filename": "readline/readline/rlmbutil.h",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/rlmbutil.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/rlmbutil.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/rlmbutil.h?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -28,7 +28,7 @@\n /* check multibyte capability for I18N code     */\n /************************************************/\n \n-/* For platforms which support the ISO C amendement 1 functionality we\n+/* For platforms which support the ISO C amendment 1 functionality we\n    support user defined character classes.  */\n    /* Solaris 2.5 has a bug: <wchar.h> must be included before <wctype.h>.  */\n #if defined (HAVE_WCTYPE_H) && defined (HAVE_WCHAR_H) && defined (HAVE_LOCALE_H)"
    },
    {
      "sha": "23ab2d8cec0d02d1b862ae707ec4ff3c03d9f1d2",
      "filename": "readline/readline/rlprivate.h",
      "status": "modified",
      "additions": 37,
      "deletions": 5,
      "changes": 42,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/rlprivate.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/rlprivate.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/rlprivate.h?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n /* rlprivate.h -- functions and variables global to the readline library,\n \t\t  but not intended for use by applications. */\n \n-/* Copyright (C) 1999-2015 Free Software Foundation, Inc.\n+/* Copyright (C) 1999-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -65,7 +65,8 @@\n #define SF_FOUND\t\t0x02\n #define SF_FAILED\t\t0x04\n #define SF_CHGKMAP\t\t0x08\n-#define SF_PATTERN\t\t0x10\t\t/* unused so far */\n+#define SF_PATTERN\t\t0x10\n+#define SF_NOCASE\t\t0x20\t\t/* unused so far */\n \n typedef struct  __rl_search_context\n {\n@@ -109,6 +110,15 @@ typedef struct  __rl_search_context\n   char  *search_terminators;\n } _rl_search_cxt;\n \n+struct _rl_cmd {\n+  Keymap map;\n+  int count;\n+  int key;\n+  rl_command_func_t *func;\n+};\n+extern struct _rl_cmd _rl_pending_command;\n+extern struct _rl_cmd *_rl_command_to_execute;\n+\n /* Callback data for reading numeric arguments */\n #define NUM_SAWMINUS\t0x01\n #define NUM_SAWDIGITS\t0x02\n@@ -267,23 +277,25 @@ extern void _rl_free_match_list PARAMS((char **));\n /* display.c */\n extern char *_rl_strip_prompt PARAMS((char *));\n extern void _rl_reset_prompt PARAMS((void));\n-extern void _rl_move_cursor_relative PARAMS((int, const char *));\n extern void _rl_move_vert PARAMS((int));\n extern void _rl_save_prompt PARAMS((void));\n extern void _rl_restore_prompt PARAMS((void));\n extern char *_rl_make_prompt_for_search PARAMS((int));\n extern void _rl_erase_at_end_of_line PARAMS((int));\n extern void _rl_clear_to_eol PARAMS((int));\n-extern void _rl_clear_screen PARAMS((void));\n+extern void _rl_clear_screen PARAMS((int));\n extern void _rl_update_final PARAMS((void));\n+extern void _rl_optimize_redisplay PARAMS((void));\n extern void _rl_redisplay_after_sigwinch PARAMS((void));\n extern void _rl_clean_up_for_exit PARAMS((void));\n extern void _rl_erase_entire_line PARAMS((void));\n extern int _rl_current_display_line PARAMS((void));\n+extern void _rl_refresh_line PARAMS((void));\n \n /* input.c */\n extern int _rl_any_typein PARAMS((void));\n extern int _rl_input_available PARAMS((void));\n+extern int _rl_nchars_available PARAMS((void));\n extern int _rl_input_queued PARAMS((int));\n extern void _rl_insert_typein PARAMS((int));\n extern int _rl_unget_char PARAMS((int));\n@@ -300,6 +312,10 @@ extern int _rl_isearch_cleanup PARAMS((_rl_search_cxt *, int));\n extern int _rl_search_getchar PARAMS((_rl_search_cxt *));\n \n /* kill.c */\n+#ifndef BRACKETED_PASTE_DEFAULT\n+#  define BRACKETED_PASTE_DEFAULT\t1\t/* XXX - for now */\n+#endif\n+\n #define BRACK_PASTE_PREF\t\"\\033[200~\"\n #define BRACK_PASTE_SUFF\t\"\\033[201~\"\n \n@@ -309,7 +325,10 @@ extern int _rl_search_getchar PARAMS((_rl_search_cxt *));\n #define BRACK_PASTE_INIT\t\"\\033[?2004h\"\n #define BRACK_PASTE_FINI\t\"\\033[?2004l\\r\"\n \n+extern int _rl_read_bracketed_paste_prefix PARAMS((int));\n extern char *_rl_bracketed_text PARAMS((size_t *));\n+extern int _rl_bracketed_read_key PARAMS((void));\n+extern int _rl_bracketed_read_mbstring PARAMS((char *, int));\n \n /* macro.c */\n extern void _rl_with_macro_input PARAMS((char *));\n@@ -332,6 +351,7 @@ extern void _rl_start_using_history PARAMS((void));\n extern int _rl_free_saved_history_line PARAMS((void));\n extern void _rl_set_insert_mode PARAMS((int, int));\n \n+extern void _rl_revert_previous_lines PARAMS((void));\n extern void _rl_revert_all_lines PARAMS((void));\n \n /* nls.c */\n@@ -348,6 +368,11 @@ extern int _rl_dispatch PARAMS((int, Keymap));\n extern int _rl_dispatch_subseq PARAMS((int, Keymap, int));\n extern void _rl_internal_char_cleanup PARAMS((void));\n \n+extern void _rl_init_executing_keyseq PARAMS((void));\n+extern void _rl_term_executing_keyseq PARAMS((void));\n+extern void _rl_end_executing_keyseq PARAMS((void));\n+extern void _rl_add_executing_keyseq PARAMS((int)); \n+\n /* rltty.c */\n extern int _rl_disable_tty_signals PARAMS((void));\n extern int _rl_restore_tty_signals PARAMS((void));\n@@ -373,15 +398,19 @@ extern void _rl_output_character_function PARAMS((int));\n #else\n extern int _rl_output_character_function PARAMS((int));\n #endif\n+extern void _rl_cr PARAMS((void));\n extern void _rl_output_some_chars PARAMS((const char *, int));\n extern int _rl_backspace PARAMS((int));\n extern void _rl_enable_meta_key PARAMS((void));\n extern void _rl_disable_meta_key PARAMS((void));\n extern void _rl_control_keypad PARAMS((int));\n extern void _rl_set_cursor PARAMS((int, int));\n+extern void _rl_standout_on PARAMS((void));\n+extern void _rl_standout_off PARAMS((void));\n \n /* text.c */\n extern void _rl_fix_point PARAMS((int));\n+extern void _rl_fix_mark PARAMS((void));\n extern int _rl_replace_text PARAMS((const char *, int, int));\n extern int _rl_forward_char_internal PARAMS((int));\n extern int _rl_backward_char_internal PARAMS((int));\n@@ -507,6 +536,7 @@ extern int _rl_revert_all_at_newline;\n extern int _rl_echo_control_chars;\n extern int _rl_show_mode_in_prompt;\n extern int _rl_enable_bracketed_paste;\n+extern int _rl_enable_active_region;\n extern char *_rl_comment_begin;\n extern unsigned char _rl_parsing_conditionalized_out;\n extern Keymap _rl_keymap;\n@@ -521,11 +551,12 @@ extern int _rl_keyseq_timeout;\n \n extern int _rl_executing_keyseq_size;\n \n+extern rl_hook_func_t *_rl_internal_startup_hook;\n+\n /* search.c */\n extern _rl_search_cxt *_rl_nscxt;\n \n /* signals.c */\n-extern int _rl_interrupt_immediately;\n extern int volatile _rl_caught_signal;\n \n extern _rl_sigcleanup_func_t *_rl_sigcleanup;\n@@ -560,6 +591,7 @@ extern int _rl_term_autowrap;\n \n /* text.c */\n extern int _rl_optimize_typeahead;\n+extern int _rl_keep_mark_active;\n \n /* undo.c */\n extern int _rl_doing_an_undo;"
    },
    {
      "sha": "38a29361d7020897ebbc7cea7d7eeb4559223359",
      "filename": "readline/readline/search.c",
      "status": "modified",
      "additions": 42,
      "deletions": 5,
      "changes": 47,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/search.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/search.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/search.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* search.c - code for non-incremental searching in emacs and vi modes. */\n \n-/* Copyright (C) 1992-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1992-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -159,7 +159,7 @@ noninc_search_from_pos (char *string, int pos, int dir, int flags, int *ncp)\n static int\n noninc_dosearch (char *string, int dir, int flags)\n {\n-  int oldpos, pos;\n+  int oldpos, pos, ind;\n   HIST_ENTRY *entry;\n \n   if (string == 0 || *string == '\\0' || noninc_history_pos < 0)\n@@ -168,7 +168,7 @@ noninc_dosearch (char *string, int dir, int flags)\n       return 0;\n     }\n \n-  pos = noninc_search_from_pos (string, noninc_history_pos + dir, dir, flags, (int *)0);\n+  pos = noninc_search_from_pos (string, noninc_history_pos + dir, dir, flags, &ind);\n   if (pos == -1)\n     {\n       /* Search failed, current history position unchanged. */\n@@ -192,8 +192,19 @@ noninc_dosearch (char *string, int dir, int flags)\n \n   make_history_line_current (entry);\n \n-  rl_point = 0;\n-  rl_mark = rl_end;\n+  if (_rl_enable_active_region && ((flags & SF_PATTERN) == 0) && ind > 0 && ind < rl_end)\n+    {\n+      rl_point = ind;\n+      rl_mark = ind + strlen (string);\n+      if (rl_mark > rl_end)\n+\trl_mark = rl_end;\t/* can't happen? */\n+      rl_activate_mark ();\n+    }\n+  else\n+    {  \n+      rl_point = 0;\n+      rl_mark = rl_end;\n+    }\n \n   rl_clear_message ();\n   return 1;\n@@ -256,6 +267,7 @@ _rl_nsearch_abort (_rl_search_cxt *cxt)\n   rl_clear_message ();\n   rl_point = cxt->save_point;\n   rl_mark = cxt->save_mark;\n+  _rl_fix_point (1);\n   rl_restore_prompt ();\n \n   RL_UNSETSTATE (RL_STATE_NSEARCH);\n@@ -267,6 +279,8 @@ _rl_nsearch_abort (_rl_search_cxt *cxt)\n static int\n _rl_nsearch_dispatch (_rl_search_cxt *cxt, int c)\n {\n+  int n;\n+\n   if (c < 0)\n     c = CTRL ('C');  \n \n@@ -300,6 +314,28 @@ _rl_nsearch_dispatch (_rl_search_cxt *cxt, int c)\n       _rl_nsearch_abort (cxt);\n       return -1;\n \n+    case ESC:\n+      /* XXX - experimental code to allow users to bracketed-paste into the\n+\t search string. Similar code is in isearch.c:_rl_isearch_dispatch().\n+\t The difference here is that the bracketed paste sometimes doesn't\n+\t paste everything, so checking for the prefix and the suffix in the\n+\t input queue doesn't work well. We just have to check to see if the\n+\t number of chars in the input queue is enough for the bracketed paste\n+\t prefix and hope for the best. */\n+      if (_rl_enable_bracketed_paste && ((n = _rl_nchars_available ()) >= (BRACK_PASTE_SLEN-1)))\n+\t{\n+\t  if (_rl_read_bracketed_paste_prefix (c) == 1)\n+\t    rl_bracketed_paste_begin (1, c);\n+\t  else\n+\t    {\n+\t      c = rl_read_key ();\t/* get the ESC that got pushed back */\n+\t      _rl_insert_char (1, c);\n+\t    }\n+        }\n+      else\n+        _rl_insert_char (1, c);\n+      break;\n+\n     default:\n #if defined (HANDLE_MULTIBYTE)\n       if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n@@ -311,6 +347,7 @@ _rl_nsearch_dispatch (_rl_search_cxt *cxt, int c)\n     }\n \n   (*rl_redisplay_function) ();\n+  rl_deactivate_mark ();\n   return 1;\n }\n "
    },
    {
      "sha": "d138524ce9ee01e544dfd79d1e16bbd083e2281d",
      "filename": "readline/readline/shlib/Makefile.in",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/shlib/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/shlib/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/shlib/Makefile.in?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -64,7 +64,7 @@ localedir = @localedir@\n DESTDIR =\n \n CFLAGS = @CFLAGS@\n-LOCAL_CFLAGS = @LOCAL_CFLAGS@ -DRL_LIBRARY_VERSION='\"$(RL_LIBRARY_VERSION)\"'\n+LOCAL_CFLAGS = @LOCAL_CFLAGS@ -DRL_LIBRARY_VERSION='\"$(RL_LIBRARY_VERSION)\"' @BRACKETED_PASTE@\n CPPFLAGS = @CPPFLAGS@\n LDFLAGS = @LDFLAGS@ @LOCAL_LDFLAGS@ @CFLAGS@\n "
    },
    {
      "sha": "f9174ab8a0149a1a078553715643da4f49d20fef",
      "filename": "readline/readline/signals.c",
      "status": "modified",
      "additions": 62,
      "deletions": 25,
      "changes": 87,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/signals.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/signals.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/signals.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -99,7 +99,6 @@ int rl_catch_sigwinch = 0;\t/* for the readline state struct in readline.c */\n #endif\n \n /* Private variables. */\n-int _rl_interrupt_immediately = 0;\n int volatile _rl_caught_signal = 0;\t/* should be sig_atomic_t, but that requires including <signal.h> everywhere */\n \n /* If non-zero, print characters corresponding to received signals as long as\n@@ -136,7 +135,7 @@ void *_rl_sigcleanarg;\n \n /* Readline signal handler functions. */\n \n-/* Called from RL_CHECK_SIGNALS() macro */\n+/* Called from RL_CHECK_SIGNALS() macro to run signal handling code. */\n RETSIGTYPE\n _rl_signal_handler (int sig)\n {\n@@ -145,13 +144,17 @@ _rl_signal_handler (int sig)\n #if defined (SIGWINCH)\n   if (sig == SIGWINCH)\n     {\n+      RL_SETSTATE(RL_STATE_SIGHANDLER);\n+\n       rl_resize_terminal ();\n       /* XXX - experimental for now */\n       /* Call a signal hook because though we called the original signal handler\n \t in rl_sigwinch_handler below, we will not resend the signal to\n \t ourselves. */\n       if (rl_signal_event_hook)\n \t(*rl_signal_event_hook) ();\n+\n+      RL_UNSETSTATE(RL_STATE_SIGHANDLER);\n     }\n   else\n #endif\n@@ -163,22 +166,20 @@ _rl_signal_handler (int sig)\n static RETSIGTYPE\n rl_signal_handler (int sig)\n {\n-  if (_rl_interrupt_immediately)\n-    {\n-      _rl_interrupt_immediately = 0;\n-      _rl_handle_signal (sig);\n-    }\n-  else\n-    _rl_caught_signal = sig;\n-\n+  _rl_caught_signal = sig;\n   SIGHANDLER_RETURN;\n }\n \n+/* This is called to handle a signal when it is safe to do so (out of the\n+   signal handler execution path). Called by _rl_signal_handler for all the\n+   signals readline catches except SIGWINCH. */\n static RETSIGTYPE\n _rl_handle_signal (int sig)\n {\n+  int block_sig;\n+\n #if defined (HAVE_POSIX_SIGNALS)\n-  sigset_t set;\n+  sigset_t set, oset;\n #else /* !HAVE_POSIX_SIGNALS */\n #  if defined (HAVE_BSD_SIGNALS)\n   long omask;\n@@ -208,7 +209,16 @@ _rl_handle_signal (int sig)\n       _rl_sigcleanup = 0;\n       _rl_sigcleanarg = 0;\n     }\n-    \n+\n+#if defined (HAVE_POSIX_SIGNALS)\n+  /* Get the current set of blocked signals. If we want to block a signal for\n+     the duration of the cleanup functions, make sure to add it to SET and\n+     set block_sig = 1 (see the SIGHUP case below). */\n+  block_sig = 0;\t/* sentinel to block signals with sigprocmask */\n+  sigemptyset (&set);\n+  sigprocmask (SIG_BLOCK, (sigset_t *)NULL, &set);\n+#endif\n+\n   switch (sig)\n     {\n     case SIGINT:\n@@ -223,38 +233,60 @@ _rl_handle_signal (int sig)\n #if defined (SIGTSTP)\n     case SIGTSTP:\n     case SIGTTIN:\n+    case SIGTTOU:\n #  if defined (HAVE_POSIX_SIGNALS)\n       /* Block SIGTTOU so we can restore the terminal settings to something\n \t sane without stopping on SIGTTOU if we have been placed into the\n \t background.  Even trying to get the current terminal pgrp with\n-\t tcgetpgrp() will generate SIGTTOU, so we don't bother.  Don't bother\n-\t doing this if we've been stopped on SIGTTOU; it's aready too late. */\n-      sigemptyset (&set);\n+\t tcgetpgrp() will generate SIGTTOU, so we don't bother.  We still do\n+\t this even if we've been stopped on SIGTTOU, since we handle signals\n+\t when we have returned from the signal handler and the signal is no\n+\t longer blocked. */\n       sigaddset (&set, SIGTTOU);\n-      sigprocmask (SIG_BLOCK, &set, (sigset_t *)NULL);\n+      block_sig = 1;\n #  endif\n-    case SIGTTOU:\n #endif /* SIGTSTP */\n-    case SIGTERM:\n+   /* Any signals that should be blocked during cleanup should go here. */\n #if defined (SIGHUP)\n     case SIGHUP:\n-#endif\n+#  if defined (_AIX)\n+      if (block_sig == 0)\n+\t{\n+\t  sigaddset (&set, sig);\n+\t  block_sig = 1;\n+\t}\n+#  endif // _AIX\n+#endif\n+    /* Signals that don't require blocking during cleanup should go here. */\n+    case SIGTERM:\n #if defined (SIGALRM)\n     case SIGALRM:\n #endif\n #if defined (SIGQUIT)\n     case SIGQUIT:\n #endif\n+\n+      if (block_sig)\n+\tsigprocmask (SIG_BLOCK, &set, &oset);\n+\n       rl_echo_signal_char (sig);\n       rl_cleanup_after_signal ();\n \n+      /* At this point, the application's signal handler, if any, is the\n+\t current handler. */\n+\n #if defined (HAVE_POSIX_SIGNALS)\n-#  if defined (SIGTSTP)\n-      /* Unblock SIGTTOU blocked above */\n-      if (sig == SIGTTIN || sig == SIGTSTP)\n-\tsigprocmask (SIG_UNBLOCK, &set, (sigset_t *)NULL);\n-#  endif\n+      /* Unblock any signal(s) blocked above */\n+      if (block_sig)\n+\tsigprocmask (SIG_UNBLOCK, &oset, (sigset_t *)NULL);\n+#endif\n \n+      /* We don't have to bother unblocking the signal because we are not\n+\t running in a signal handler context. */\n+#if 0\n+#if defined (HAVE_POSIX_SIGNALS)\n+      /* Make sure this signal is not blocked when we resend it to the\n+\t calling application. */\n       sigemptyset (&set);\n       sigprocmask (SIG_BLOCK, (sigset_t *)NULL, &set);\n       sigdelset (&set, sig);\n@@ -263,6 +295,7 @@ _rl_handle_signal (int sig)\n       omask = sigblock (0);\n #  endif /* HAVE_BSD_SIGNALS */\n #endif /* !HAVE_POSIX_SIGNALS */\n+#endif\n \n #if defined (__EMX__)\n       signal (sig, SIG_ACK);\n@@ -274,14 +307,18 @@ _rl_handle_signal (int sig)\n       raise (sig);\t\t/* assume we have raise */\n #endif\n \n-      /* Let the signal that we just sent through.  */\n+      /* We don't need to modify the signal mask now that this is not run in\n+\t a signal handler context. */\n+#if 0\n+      /* Let the signal that we just sent through if it is blocked.  */\n #if defined (HAVE_POSIX_SIGNALS)\n       sigprocmask (SIG_SETMASK, &set, (sigset_t *)NULL);\n #else /* !HAVE_POSIX_SIGNALS */\n #  if defined (HAVE_BSD_SIGNALS)\n       sigsetmask (omask & ~(sigmask (sig)));\n #  endif /* HAVE_BSD_SIGNALS */\n #endif /* !HAVE_POSIX_SIGNALS */\n+#endif\n \n       rl_reset_after_signal ();      \n     }"
    },
    {
      "sha": "0fc11edb2d12e8bf868867f181d93e814e724015",
      "filename": "readline/readline/support/config.guess",
      "status": "modified",
      "additions": 175,
      "deletions": 191,
      "changes": 366,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/config.guess",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/config.guess",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/support/config.guess?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,8 +1,8 @@\n #! /bin/sh\n # Attempt to guess a canonical system name.\n-#   Copyright 1992-2019 Free Software Foundation, Inc.\n+#   Copyright 1992-2020 Free Software Foundation, Inc.\n \n-timestamp='2019-08-04'\n+timestamp='2020-11-07'\n \n # This file is free software; you can redistribute it and/or modify it\n # under the terms of the GNU General Public License as published by\n@@ -32,7 +32,7 @@ timestamp='2019-08-04'\n # Please send patches to <config-patches@gnu.org>.\n \n \n-me=`echo \"$0\" | sed -e 's,.*/,,'`\n+me=$(echo \"$0\" | sed -e 's,.*/,,')\n \n usage=\"\\\n Usage: $0 [OPTION]\n@@ -50,7 +50,7 @@ version=\"\\\n GNU config.guess ($timestamp)\n \n Originally written by Per Bothner.\n-Copyright 1992-2019 Free Software Foundation, Inc.\n+Copyright 1992-2020 Free Software Foundation, Inc.\n \n This is free software; see the source for copying conditions.  There is NO\n warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\"\n@@ -99,9 +99,11 @@ tmp=\n trap 'test -z \"$tmp\" || rm -fr \"$tmp\"' 0 1 2 13 15\n \n set_cc_for_build() {\n+    # prevent multiple calls if $tmp is already set\n+    test \"$tmp\" && return 0\n     : \"${TMPDIR=/tmp}\"\n     # shellcheck disable=SC2039\n-    { tmp=`(umask 077 && mktemp -d \"$TMPDIR/cgXXXXXX\") 2>/dev/null` && test -n \"$tmp\" && test -d \"$tmp\" ; } ||\n+    { tmp=$( (umask 077 && mktemp -d \"$TMPDIR/cgXXXXXX\") 2>/dev/null) && test -n \"$tmp\" && test -d \"$tmp\" ; } ||\n \t{ test -n \"$RANDOM\" && tmp=$TMPDIR/cg$$-$RANDOM && (umask 077 && mkdir \"$tmp\" 2>/dev/null) ; } ||\n \t{ tmp=$TMPDIR/cg-$$ && (umask 077 && mkdir \"$tmp\" 2>/dev/null) && echo \"Warning: creating insecure temp directory\" >&2 ; } ||\n \t{ echo \"$me: cannot create a temporary directory in $TMPDIR\" >&2 ; exit 1 ; }\n@@ -129,10 +131,10 @@ if test -f /.attbin/uname ; then\n \tPATH=$PATH:/.attbin ; export PATH\n fi\n \n-UNAME_MACHINE=`(uname -m) 2>/dev/null` || UNAME_MACHINE=unknown\n-UNAME_RELEASE=`(uname -r) 2>/dev/null` || UNAME_RELEASE=unknown\n-UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown\n-UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown\n+UNAME_MACHINE=$( (uname -m) 2>/dev/null) || UNAME_MACHINE=unknown\n+UNAME_RELEASE=$( (uname -r) 2>/dev/null) || UNAME_RELEASE=unknown\n+UNAME_SYSTEM=$( (uname -s) 2>/dev/null) || UNAME_SYSTEM=unknown\n+UNAME_VERSION=$( (uname -v) 2>/dev/null) || UNAME_VERSION=unknown\n \n case \"$UNAME_SYSTEM\" in\n Linux|GNU|GNU/*)\n@@ -148,17 +150,15 @@ Linux|GNU|GNU/*)\n \t#elif defined(__dietlibc__)\n \tLIBC=dietlibc\n \t#else\n+\t#include <stdarg.h>\n+\t#ifdef __DEFINED_va_list\n+\tLIBC=musl\n+\t#else\n \tLIBC=gnu\n \t#endif\n+\t#endif\n \tEOF\n-\teval \"`$CC_FOR_BUILD -E \"$dummy.c\" 2>/dev/null | grep '^LIBC' | sed 's, ,,g'`\"\n-\n-\t# If ldd exists, use it to detect musl libc.\n-\tif command -v ldd >/dev/null && \\\n-\t\tldd --version 2>&1 | grep -q ^musl\n-\tthen\n-\t    LIBC=musl\n-\tfi\n+\teval \"$($CC_FOR_BUILD -E \"$dummy.c\" 2>/dev/null | grep '^LIBC' | sed 's, ,,g')\"\n \t;;\n esac\n \n@@ -177,19 +177,20 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \t# Note: NetBSD doesn't particularly care about the vendor\n \t# portion of the name.  We always set it to \"unknown\".\n \tsysctl=\"sysctl -n hw.machine_arch\"\n-\tUNAME_MACHINE_ARCH=`(uname -p 2>/dev/null || \\\n+\tUNAME_MACHINE_ARCH=$( (uname -p 2>/dev/null || \\\n \t    \"/sbin/$sysctl\" 2>/dev/null || \\\n \t    \"/usr/sbin/$sysctl\" 2>/dev/null || \\\n-\t    echo unknown)`\n+\t    echo unknown))\n \tcase \"$UNAME_MACHINE_ARCH\" in\n+\t    aarch64eb) machine=aarch64_be-unknown ;;\n \t    armeb) machine=armeb-unknown ;;\n \t    arm*) machine=arm-unknown ;;\n \t    sh3el) machine=shl-unknown ;;\n \t    sh3eb) machine=sh-unknown ;;\n \t    sh5el) machine=sh5le-unknown ;;\n \t    earmv*)\n-\t\tarch=`echo \"$UNAME_MACHINE_ARCH\" | sed -e 's,^e\\(armv[0-9]\\).*$,\\1,'`\n-\t\tendian=`echo \"$UNAME_MACHINE_ARCH\" | sed -ne 's,^.*\\(eb\\)$,\\1,p'`\n+\t\tarch=$(echo \"$UNAME_MACHINE_ARCH\" | sed -e 's,^e\\(armv[0-9]\\).*$,\\1,')\n+\t\tendian=$(echo \"$UNAME_MACHINE_ARCH\" | sed -ne 's,^.*\\(eb\\)$,\\1,p')\n \t\tmachine=\"${arch}${endian}\"-unknown\n \t\t;;\n \t    *) machine=\"$UNAME_MACHINE_ARCH\"-unknown ;;\n@@ -220,7 +221,7 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \tcase \"$UNAME_MACHINE_ARCH\" in\n \t    earm*)\n \t\texpr='s/^earmv[0-9]/-eabi/;s/eb$//'\n-\t\tabi=`echo \"$UNAME_MACHINE_ARCH\" | sed -e \"$expr\"`\n+\t\tabi=$(echo \"$UNAME_MACHINE_ARCH\" | sed -e \"$expr\")\n \t\t;;\n \tesac\n \t# The OS release\n@@ -233,7 +234,7 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \t\trelease='-gnu'\n \t\t;;\n \t    *)\n-\t\trelease=`echo \"$UNAME_RELEASE\" | sed -e 's/[-_].*//' | cut -d. -f1,2`\n+\t\trelease=$(echo \"$UNAME_RELEASE\" | sed -e 's/[-_].*//' | cut -d. -f1,2)\n \t\t;;\n \tesac\n \t# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:\n@@ -242,19 +243,15 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \techo \"$machine-${os}${release}${abi-}\"\n \texit ;;\n     *:Bitrig:*:*)\n-\tUNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`\n-\techo \"$UNAME_MACHINE_ARCH\"-unknown-bitrig\"$UNAME_RELEASE\"\n-\texit ;;\n-    *:Bitrig:*:*)\n-\tUNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`\n+\tUNAME_MACHINE_ARCH=$(arch | sed 's/Bitrig.//')\n \techo \"$UNAME_MACHINE_ARCH\"-unknown-bitrig\"$UNAME_RELEASE\"\n \texit ;;\n     *:OpenBSD:*:*)\n-\tUNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`\n+\tUNAME_MACHINE_ARCH=$(arch | sed 's/OpenBSD.//')\n \techo \"$UNAME_MACHINE_ARCH\"-unknown-openbsd\"$UNAME_RELEASE\"\n \texit ;;\n     *:LibertyBSD:*:*)\n-\tUNAME_MACHINE_ARCH=`arch | sed 's/^.*BSD\\.//'`\n+\tUNAME_MACHINE_ARCH=$(arch | sed 's/^.*BSD\\.//')\n \techo \"$UNAME_MACHINE_ARCH\"-unknown-libertybsd\"$UNAME_RELEASE\"\n \texit ;;\n     *:MidnightBSD:*:*)\n@@ -266,6 +263,9 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n     *:SolidBSD:*:*)\n \techo \"$UNAME_MACHINE\"-unknown-solidbsd\"$UNAME_RELEASE\"\n \texit ;;\n+    *:OS108:*:*)\n+\techo \"$UNAME_MACHINE\"-unknown-os108_\"$UNAME_RELEASE\"\n+\texit ;;\n     macppc:MirBSD:*:*)\n \techo powerpc-unknown-mirbsd\"$UNAME_RELEASE\"\n \texit ;;\n@@ -275,26 +275,29 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n     *:Sortix:*:*)\n \techo \"$UNAME_MACHINE\"-unknown-sortix\n \texit ;;\n+    *:Twizzler:*:*)\n+\techo \"$UNAME_MACHINE\"-unknown-twizzler\n+\texit ;;\n     *:Redox:*:*)\n \techo \"$UNAME_MACHINE\"-unknown-redox\n \texit ;;\n     mips:OSF1:*.*)\n-        echo mips-dec-osf1\n-        exit ;;\n+\techo mips-dec-osf1\n+\texit ;;\n     alpha:OSF1:*:*)\n \tcase $UNAME_RELEASE in\n \t*4.0)\n-\t\tUNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`\n+\t\tUNAME_RELEASE=$(/usr/sbin/sizer -v | awk '{print $3}')\n \t\t;;\n \t*5.*)\n-\t\tUNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`\n+\t\tUNAME_RELEASE=$(/usr/sbin/sizer -v | awk '{print $4}')\n \t\t;;\n \tesac\n \t# According to Compaq, /usr/sbin/psrinfo has been available on\n \t# OSF/1 and Tru64 systems produced since 1995.  I hope that\n \t# covers most systems running today.  This code pipes the CPU\n \t# types through head -n 1, so we only detect the type of CPU 0.\n-\tALPHA_CPU_TYPE=`/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \\(.*\\) processor.*$/\\1/p' | head -n 1`\n+\tALPHA_CPU_TYPE=$(/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \\(.*\\) processor.*$/\\1/p' | head -n 1)\n \tcase \"$ALPHA_CPU_TYPE\" in\n \t    \"EV4 (21064)\")\n \t\tUNAME_MACHINE=alpha ;;\n@@ -332,7 +335,7 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \t# A Tn.n version is a released field test version.\n \t# A Xn.n version is an unreleased experimental baselevel.\n \t# 1.2 uses \"1.2\" for uname -r.\n-\techo \"$UNAME_MACHINE\"-dec-osf\"`echo \"$UNAME_RELEASE\" | sed -e 's/^[PVTX]//' | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz`\"\n+\techo \"$UNAME_MACHINE\"-dec-osf\"$(echo \"$UNAME_RELEASE\" | sed -e 's/^[PVTX]//' | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz)\"\n \t# Reset EXIT trap before exiting to avoid spurious non-zero exit code.\n \texitcode=$?\n \ttrap '' 0\n@@ -366,7 +369,7 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \texit ;;\n     Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)\n \t# akee@wpdis03.wpafb.af.mil (Earle F. Ake) contributed MIS and NILE.\n-\tif test \"`(/bin/universe) 2>/dev/null`\" = att ; then\n+\tif test \"$( (/bin/universe) 2>/dev/null)\" = att ; then\n \t\techo pyramid-pyramid-sysv3\n \telse\n \t\techo pyramid-pyramid-bsd\n@@ -379,20 +382,17 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \techo sparc-icl-nx6\n \texit ;;\n     DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)\n-\tcase `/usr/bin/uname -p` in\n+\tcase $(/usr/bin/uname -p) in\n \t    sparc) echo sparc-icl-nx7; exit ;;\n \tesac ;;\n     s390x:SunOS:*:*)\n-\techo \"$UNAME_MACHINE\"-ibm-solaris2\"`echo \"$UNAME_RELEASE\" | sed -e 's/[^.]*//'`\"\n+\techo \"$UNAME_MACHINE\"-ibm-solaris2\"$(echo \"$UNAME_RELEASE\" | sed -e 's/[^.]*//')\"\n \texit ;;\n     sun4H:SunOS:5.*:*)\n-\techo sparc-hal-solaris2\"`echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//'`\"\n+\techo sparc-hal-solaris2\"$(echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//')\"\n \texit ;;\n     sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)\n-\techo sparc-sun-solaris2\"`echo \"$UNAME_RELEASE\" | sed -e 's/[^.]*//'`\"\n-\texit ;;\n-    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)\n-\techo i386-pc-auroraux\"$UNAME_RELEASE\"\n+\techo sparc-sun-solaris2\"$(echo \"$UNAME_RELEASE\" | sed -e 's/[^.]*//')\"\n \texit ;;\n     i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)\n \techo i386-pc-auroraux\"$UNAME_RELEASE\"\n@@ -403,38 +403,38 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \t# If there is a compiler, see if it is configured for 64-bit objects.\n \t# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.\n \t# This test works for both compilers.\n-\tif [ \"$CC_FOR_BUILD\" != no_compiler_found ]; then\n+\tif test \"$CC_FOR_BUILD\" != no_compiler_found; then\n \t    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \\\n \t\t(CCOPTS=\"\" $CC_FOR_BUILD -E - 2>/dev/null) | \\\n \t\tgrep IS_64BIT_ARCH >/dev/null\n \t    then\n \t\tSUN_ARCH=x86_64\n \t    fi\n \tfi\n-\techo \"$SUN_ARCH\"-pc-solaris2\"`echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//'`\"\n+\techo \"$SUN_ARCH\"-pc-solaris2\"$(echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//')\"\n \texit ;;\n     sun4*:SunOS:6*:*)\n \t# According to config.sub, this is the proper way to canonicalize\n \t# SunOS6.  Hard to guess exactly what SunOS6 will be like, but\n \t# it's likely to be more like Solaris than SunOS4.\n-\techo sparc-sun-solaris3\"`echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//'`\"\n+\techo sparc-sun-solaris3\"$(echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//')\"\n \texit ;;\n     sun4*:SunOS:*:*)\n-\tcase \"`/usr/bin/arch -k`\" in\n+\tcase \"$(/usr/bin/arch -k)\" in\n \t    Series*|S4*)\n-\t\tUNAME_RELEASE=`uname -v`\n+\t\tUNAME_RELEASE=$(uname -v)\n \t\t;;\n \tesac\n \t# Japanese Language versions have a version number like `4.1.3-JL'.\n-\techo sparc-sun-sunos\"`echo \"$UNAME_RELEASE\"|sed -e 's/-/_/'`\"\n+\techo sparc-sun-sunos\"$(echo \"$UNAME_RELEASE\"|sed -e 's/-/_/')\"\n \texit ;;\n     sun3*:SunOS:*:*)\n \techo m68k-sun-sunos\"$UNAME_RELEASE\"\n \texit ;;\n     sun*:*:4.2BSD:*)\n-\tUNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null`\n+\tUNAME_RELEASE=$( (sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null)\n \ttest \"x$UNAME_RELEASE\" = x && UNAME_RELEASE=3\n-\tcase \"`/bin/arch`\" in\n+\tcase \"$(/bin/arch)\" in\n \t    sun3)\n \t\techo m68k-sun-sunos\"$UNAME_RELEASE\"\n \t\t;;\n@@ -514,8 +514,8 @@ case \"$UNAME_MACHINE:$UNAME_SYSTEM:$UNAME_RELEASE:$UNAME_VERSION\" in\n \t}\n EOF\n \t$CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" &&\n-\t  dummyarg=`echo \"$UNAME_RELEASE\" | sed -n 's/\\([0-9]*\\).*/\\1/p'` &&\n-\t  SYSTEM_NAME=`\"$dummy\" \"$dummyarg\"` &&\n+\t  dummyarg=$(echo \"$UNAME_RELEASE\" | sed -n 's/\\([0-9]*\\).*/\\1/p') &&\n+\t  SYSTEM_NAME=$(\"$dummy\" \"$dummyarg\") &&\n \t    { echo \"$SYSTEM_NAME\"; exit; }\n \techo mips-mips-riscos\"$UNAME_RELEASE\"\n \texit ;;\n@@ -542,11 +542,11 @@ EOF\n \texit ;;\n     AViiON:dgux:*:*)\n \t# DG/UX returns AViiON for all architectures\n-\tUNAME_PROCESSOR=`/usr/bin/uname -p`\n-\tif [ \"$UNAME_PROCESSOR\" = mc88100 ] || [ \"$UNAME_PROCESSOR\" = mc88110 ]\n+\tUNAME_PROCESSOR=$(/usr/bin/uname -p)\n+\tif test \"$UNAME_PROCESSOR\" = mc88100 || test \"$UNAME_PROCESSOR\" = mc88110\n \tthen\n-\t    if [ \"$TARGET_BINARY_INTERFACE\"x = m88kdguxelfx ] || \\\n-\t       [ \"$TARGET_BINARY_INTERFACE\"x = x ]\n+\t    if test \"$TARGET_BINARY_INTERFACE\"x = m88kdguxelfx || \\\n+\t       test \"$TARGET_BINARY_INTERFACE\"x = x\n \t    then\n \t\techo m88k-dg-dgux\"$UNAME_RELEASE\"\n \t    else\n@@ -570,17 +570,17 @@ EOF\n \techo m68k-tektronix-bsd\n \texit ;;\n     *:IRIX*:*:*)\n-\techo mips-sgi-irix\"`echo \"$UNAME_RELEASE\"|sed -e 's/-/_/g'`\"\n+\techo mips-sgi-irix\"$(echo \"$UNAME_RELEASE\"|sed -e 's/-/_/g')\"\n \texit ;;\n     ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.\n \techo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id\n-\texit ;;               # Note that: echo \"'`uname -s`'\" gives 'AIX '\n+\texit ;;               # Note that: echo \"'$(uname -s)'\" gives 'AIX '\n     i*86:AIX:*:*)\n \techo i386-ibm-aix\n \texit ;;\n     ia64:AIX:*:*)\n-\tif [ -x /usr/bin/oslevel ] ; then\n-\t\tIBM_REV=`/usr/bin/oslevel`\n+\tif test -x /usr/bin/oslevel ; then\n+\t\tIBM_REV=$(/usr/bin/oslevel)\n \telse\n \t\tIBM_REV=\"$UNAME_VERSION.$UNAME_RELEASE\"\n \tfi\n@@ -600,7 +600,7 @@ EOF\n \t\t\texit(0);\n \t\t\t}\n EOF\n-\t\tif $CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" && SYSTEM_NAME=`\"$dummy\"`\n+\t\tif $CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" && SYSTEM_NAME=$(\"$dummy\")\n \t\tthen\n \t\t\techo \"$SYSTEM_NAME\"\n \t\telse\n@@ -613,15 +613,15 @@ EOF\n \tfi\n \texit ;;\n     *:AIX:*:[4567])\n-\tIBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`\n+\tIBM_CPU_ID=$(/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }')\n \tif /usr/sbin/lsattr -El \"$IBM_CPU_ID\" | grep ' POWER' >/dev/null 2>&1; then\n \t\tIBM_ARCH=rs6000\n \telse\n \t\tIBM_ARCH=powerpc\n \tfi\n-\tif [ -x /usr/bin/lslpp ] ; then\n-\t\tIBM_REV=`/usr/bin/lslpp -Lqc bos.rte.libc |\n-\t\t\t   awk -F: '{ print $3 }' | sed s/[0-9]*$/0/`\n+\tif test -x /usr/bin/lslpp ; then\n+\t\tIBM_REV=$(/usr/bin/lslpp -Lqc bos.rte.libc |\n+\t\t\t   awk -F: '{ print $3 }' | sed s/[0-9]*$/0/)\n \telse\n \t\tIBM_REV=\"$UNAME_VERSION.$UNAME_RELEASE\"\n \tfi\n@@ -649,14 +649,14 @@ EOF\n \techo m68k-hp-bsd4.4\n \texit ;;\n     9000/[34678]??:HP-UX:*:*)\n-\tHPUX_REV=`echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*.[0B]*//'`\n+\tHPUX_REV=$(echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*.[0B]*//')\n \tcase \"$UNAME_MACHINE\" in\n \t    9000/31?)            HP_ARCH=m68000 ;;\n \t    9000/[34]??)         HP_ARCH=m68k ;;\n \t    9000/[678][0-9][0-9])\n-\t\tif [ -x /usr/bin/getconf ]; then\n-\t\t    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`\n-\t\t    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`\n+\t\tif test -x /usr/bin/getconf; then\n+\t\t    sc_cpu_version=$(/usr/bin/getconf SC_CPU_VERSION 2>/dev/null)\n+\t\t    sc_kernel_bits=$(/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null)\n \t\t    case \"$sc_cpu_version\" in\n \t\t      523) HP_ARCH=hppa1.0 ;; # CPU_PA_RISC1_0\n \t\t      528) HP_ARCH=hppa1.1 ;; # CPU_PA_RISC1_1\n@@ -668,7 +668,7 @@ EOF\n \t\t\tesac ;;\n \t\t    esac\n \t\tfi\n-\t\tif [ \"$HP_ARCH\" = \"\" ]; then\n+\t\tif test \"$HP_ARCH\" = \"\"; then\n \t\t    set_cc_for_build\n \t\t    sed 's/^\t\t//' << EOF > \"$dummy.c\"\n \n@@ -703,11 +703,11 @@ EOF\n \t\t    exit (0);\n \t\t}\n EOF\n-\t\t    (CCOPTS=\"\" $CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" 2>/dev/null) && HP_ARCH=`\"$dummy\"`\n+\t\t    (CCOPTS=\"\" $CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" 2>/dev/null) && HP_ARCH=$(\"$dummy\")\n \t\t    test -z \"$HP_ARCH\" && HP_ARCH=hppa\n \t\tfi ;;\n \tesac\n-\tif [ \"$HP_ARCH\" = hppa2.0w ]\n+\tif test \"$HP_ARCH\" = hppa2.0w\n \tthen\n \t    set_cc_for_build\n \n@@ -731,7 +731,7 @@ EOF\n \techo \"$HP_ARCH\"-hp-hpux\"$HPUX_REV\"\n \texit ;;\n     ia64:HP-UX:*:*)\n-\tHPUX_REV=`echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*.[0B]*//'`\n+\tHPUX_REV=$(echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*.[0B]*//')\n \techo ia64-hp-hpux\"$HPUX_REV\"\n \texit ;;\n     3050*:HI-UX:*:*)\n@@ -761,7 +761,7 @@ EOF\n \t  exit (0);\n \t}\n EOF\n-\t$CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" && SYSTEM_NAME=`\"$dummy\"` &&\n+\t$CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" && SYSTEM_NAME=$(\"$dummy\") &&\n \t\t{ echo \"$SYSTEM_NAME\"; exit; }\n \techo unknown-hitachi-hiuxwe2\n \texit ;;\n@@ -781,7 +781,7 @@ EOF\n \techo hppa1.0-hp-osf\n \texit ;;\n     i*86:OSF1:*:*)\n-\tif [ -x /usr/sbin/sysversion ] ; then\n+\tif test -x /usr/sbin/sysversion ; then\n \t    echo \"$UNAME_MACHINE\"-unknown-osf1mk\n \telse\n \t    echo \"$UNAME_MACHINE\"-unknown-osf1\n@@ -830,14 +830,14 @@ EOF\n \techo craynv-cray-unicosmp\"$UNAME_RELEASE\" | sed -e 's/\\.[^.]*$/.X/'\n \texit ;;\n     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)\n-\tFUJITSU_PROC=`uname -m | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz`\n-\tFUJITSU_SYS=`uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\\///'`\n-\tFUJITSU_REL=`echo \"$UNAME_RELEASE\" | sed -e 's/ /_/'`\n+\tFUJITSU_PROC=$(uname -m | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz)\n+\tFUJITSU_SYS=$(uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\\///')\n+\tFUJITSU_REL=$(echo \"$UNAME_RELEASE\" | sed -e 's/ /_/')\n \techo \"${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}\"\n \texit ;;\n     5000:UNIX_System_V:4.*:*)\n-\tFUJITSU_SYS=`uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\\///'`\n-\tFUJITSU_REL=`echo \"$UNAME_RELEASE\" | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/ /_/'`\n+\tFUJITSU_SYS=$(uname -p | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/\\///')\n+\tFUJITSU_REL=$(echo \"$UNAME_RELEASE\" | tr ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyz | sed -e 's/ /_/')\n \techo \"sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}\"\n \texit ;;\n     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\\ Embedded/OS:*:*)\n@@ -850,35 +850,32 @@ EOF\n \techo \"$UNAME_MACHINE\"-unknown-bsdi\"$UNAME_RELEASE\"\n \texit ;;\n     arm:FreeBSD:*:*)\n-\tUNAME_PROCESSOR=`uname -p`\n+\tUNAME_PROCESSOR=$(uname -p)\n \tset_cc_for_build\n \tif echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \\\n \t    | grep -q __ARM_PCS_VFP\n \tthen\n-\t    echo \"${UNAME_PROCESSOR}\"-unknown-freebsd\"`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`\"-gnueabi\n+\t    echo \"${UNAME_PROCESSOR}\"-unknown-freebsd\"$(echo ${UNAME_RELEASE}|sed -e 's/[-(].*//')\"-gnueabi\n \telse\n-\t    echo \"${UNAME_PROCESSOR}\"-unknown-freebsd\"`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`\"-gnueabihf\n+\t    echo \"${UNAME_PROCESSOR}\"-unknown-freebsd\"$(echo ${UNAME_RELEASE}|sed -e 's/[-(].*//')\"-gnueabihf\n \tfi\n \texit ;;\n     *:FreeBSD:*:*)\n-\tUNAME_PROCESSOR=`/usr/bin/uname -p`\n+\tUNAME_PROCESSOR=$(/usr/bin/uname -p)\n \tcase \"$UNAME_PROCESSOR\" in\n \t    amd64)\n \t\tUNAME_PROCESSOR=x86_64 ;;\n \t    i386)\n \t\tUNAME_PROCESSOR=i586 ;;\n \tesac\n-\techo \"$UNAME_PROCESSOR\"-unknown-freebsd\"`echo \"$UNAME_RELEASE\"|sed -e 's/[-(].*//'`\"\n+\techo \"$UNAME_PROCESSOR\"-unknown-freebsd\"$(echo \"$UNAME_RELEASE\"|sed -e 's/[-(].*//')\"\n \texit ;;\n     i*:CYGWIN*:*)\n \techo \"$UNAME_MACHINE\"-pc-cygwin\n \texit ;;\n     *:MINGW64*:*)\n \techo \"$UNAME_MACHINE\"-pc-mingw64\n \texit ;;\n-    *:MINGW64*:*)\n-\techo \"$UNAME_MACHINE\"-pc-mingw64\n-\texit ;;\n     *:MINGW*:*)\n \techo \"$UNAME_MACHINE\"-pc-mingw32\n \texit ;;\n@@ -907,15 +904,15 @@ EOF\n \techo x86_64-pc-cygwin\n \texit ;;\n     prep*:SunOS:5.*:*)\n-\techo powerpcle-unknown-solaris2\"`echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//'`\"\n+\techo powerpcle-unknown-solaris2\"$(echo \"$UNAME_RELEASE\"|sed -e 's/[^.]*//')\"\n \texit ;;\n     *:GNU:*:*)\n \t# the GNU system\n-\techo \"`echo \"$UNAME_MACHINE\"|sed -e 's,[-/].*$,,'`-unknown-$LIBC`echo \"$UNAME_RELEASE\"|sed -e 's,/.*$,,'`\"\n+\techo \"$(echo \"$UNAME_MACHINE\"|sed -e 's,[-/].*$,,')-unknown-$LIBC$(echo \"$UNAME_RELEASE\"|sed -e 's,/.*$,,')\"\n \texit ;;\n     *:GNU/*:*:*)\n \t# other systems with GNU libc and userland\n-\techo \"$UNAME_MACHINE-unknown-`echo \"$UNAME_SYSTEM\" | sed 's,^[^/]*/,,' | tr \"[:upper:]\" \"[:lower:]\"``echo \"$UNAME_RELEASE\"|sed -e 's/[-(].*//'`-$LIBC\"\n+\techo \"$UNAME_MACHINE-unknown-$(echo \"$UNAME_SYSTEM\" | sed 's,^[^/]*/,,' | tr \"[:upper:]\" \"[:lower:]\")$(echo \"$UNAME_RELEASE\"|sed -e 's/[-(].*//')-$LIBC\"\n \texit ;;\n     *:Minix:*:*)\n \techo \"$UNAME_MACHINE\"-unknown-minix\n@@ -928,31 +925,7 @@ EOF\n \techo \"$UNAME_MACHINE\"-unknown-linux-\"$LIBC\"\n \texit ;;\n     alpha:Linux:*:*)\n-\tcase `sed -n '/^cpu model/s/^.*: \\(.*\\)/\\1/p' < /proc/cpuinfo` in\n-\t  EV5)   UNAME_MACHINE=alphaev5 ;;\n-\t  EV56)  UNAME_MACHINE=alphaev56 ;;\n-\t  PCA56) UNAME_MACHINE=alphapca56 ;;\n-\t  PCA57) UNAME_MACHINE=alphapca56 ;;\n-\t  EV6)   UNAME_MACHINE=alphaev6 ;;\n-\t  EV67)  UNAME_MACHINE=alphaev67 ;;\n-\t  EV68*) UNAME_MACHINE=alphaev68 ;;\n-\tesac\n-\tobjdump --private-headers /bin/sh | grep -q ld.so.1\n-\tif test \"$?\" = 0 ; then LIBC=gnulibc1 ; fi\n-\techo \"$UNAME_MACHINE\"-unknown-linux-\"$LIBC\"\n-\texit ;;\n-    arc:Linux:*:* | arceb:Linux:*:*)\n-\techo \"$UNAME_MACHINE\"-unknown-linux-\"$LIBC\"\n-\texit ;;\n-    aarch64:Linux:*:*)\n-\techo \"$UNAME_MACHINE\"-unknown-linux-\"$LIBC\"\n-\texit ;;\n-    aarch64_be:Linux:*:*)\n-\tUNAME_MACHINE=aarch64_be\n-\techo \"$UNAME_MACHINE\"-unknown-linux-\"$LIBC\"\n-\texit ;;\n-    alpha:Linux:*:*)\n-\tcase `sed -n '/^cpu model/s/^.*: \\(.*\\)/\\1/p' < /proc/cpuinfo` in\n+\tcase $(sed -n '/^cpu model/s/^.*: \\(.*\\)/\\1/p' /proc/cpuinfo 2>/dev/null) in\n \t  EV5)   UNAME_MACHINE=alphaev5 ;;\n \t  EV56)  UNAME_MACHINE=alphaev56 ;;\n \t  PCA56) UNAME_MACHINE=alphapca56 ;;\n@@ -1061,7 +1034,7 @@ EOF\n \t#endif\n \t#endif\n EOF\n-\teval \"`$CC_FOR_BUILD -E \"$dummy.c\" 2>/dev/null | grep '^CPU\\|^MIPS_ENDIAN\\|^LIBCABI'`\"\n+\teval \"$($CC_FOR_BUILD -E \"$dummy.c\" 2>/dev/null | grep '^CPU\\|^MIPS_ENDIAN\\|^LIBCABI')\"\n \ttest \"x$CPU\" != x && { echo \"$CPU${MIPS_ENDIAN}-unknown-linux-$LIBCABI\"; exit; }\n \t;;\n     mips64el:Linux:*:*)\n@@ -1081,7 +1054,7 @@ EOF\n \texit ;;\n     parisc:Linux:*:* | hppa:Linux:*:*)\n \t# Look for CPU level\n-\tcase `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in\n+\tcase $(grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2) in\n \t  PA7*) echo hppa1.1-unknown-linux-\"$LIBC\" ;;\n \t  PA8*) echo hppa2.0-unknown-linux-\"$LIBC\" ;;\n \t  *)    echo hppa-unknown-linux-\"$LIBC\" ;;\n@@ -1121,7 +1094,17 @@ EOF\n \techo \"$UNAME_MACHINE\"-dec-linux-\"$LIBC\"\n \texit ;;\n     x86_64:Linux:*:*)\n-\techo \"$UNAME_MACHINE\"-pc-linux-\"$LIBC\"\n+\tset_cc_for_build\n+\tLIBCABI=$LIBC\n+\tif test \"$CC_FOR_BUILD\" != no_compiler_found; then\n+\t    if (echo '#ifdef __ILP32__'; echo IS_X32; echo '#endif') | \\\n+\t\t(CCOPTS=\"\" $CC_FOR_BUILD -E - 2>/dev/null) | \\\n+\t\tgrep IS_X32 >/dev/null\n+\t    then\n+\t\tLIBCABI=\"$LIBC\"x32\n+\t    fi\n+\tfi\n+\techo \"$UNAME_MACHINE\"-pc-linux-\"$LIBCABI\"\n \texit ;;\n     xtensa*:Linux:*:*)\n \techo \"$UNAME_MACHINE\"-unknown-linux-\"$LIBC\"\n@@ -1161,7 +1144,7 @@ EOF\n \techo \"$UNAME_MACHINE\"-pc-msdosdjgpp\n \texit ;;\n     i*86:*:4.*:*)\n-\tUNAME_REL=`echo \"$UNAME_RELEASE\" | sed 's/\\/MP$//'`\n+\tUNAME_REL=$(echo \"$UNAME_RELEASE\" | sed 's/\\/MP$//')\n \tif grep Novell /usr/include/link.h >/dev/null 2>/dev/null; then\n \t\techo \"$UNAME_MACHINE\"-univel-sysv\"$UNAME_REL\"\n \telse\n@@ -1170,7 +1153,7 @@ EOF\n \texit ;;\n     i*86:*:5:[678]*)\n \t# UnixWare 7.x, OpenUNIX and OpenServer 6.\n-\tcase `/bin/uname -X | grep \"^Machine\"` in\n+\tcase $(/bin/uname -X | grep \"^Machine\") in\n \t    *486*)\t     UNAME_MACHINE=i486 ;;\n \t    *Pentium)\t     UNAME_MACHINE=i586 ;;\n \t    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;\n@@ -1179,10 +1162,10 @@ EOF\n \texit ;;\n     i*86:*:3.2:*)\n \tif test -f /usr/options/cb.name; then\n-\t\tUNAME_REL=`sed -n 's/.*Version //p' </usr/options/cb.name`\n+\t\tUNAME_REL=$(sed -n 's/.*Version //p' </usr/options/cb.name)\n \t\techo \"$UNAME_MACHINE\"-pc-isc\"$UNAME_REL\"\n \telif /bin/uname -X 2>/dev/null >/dev/null ; then\n-\t\tUNAME_REL=`(/bin/uname -X|grep Release|sed -e 's/.*= //')`\n+\t\tUNAME_REL=$( (/bin/uname -X|grep Release|sed -e 's/.*= //'))\n \t\t(/bin/uname -X|grep i80486 >/dev/null) && UNAME_MACHINE=i486\n \t\t(/bin/uname -X|grep '^Machine.*Pentium' >/dev/null) \\\n \t\t\t&& UNAME_MACHINE=i586\n@@ -1232,7 +1215,7 @@ EOF\n     3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)\n \tOS_REL=''\n \ttest -r /etc/.relid \\\n-\t&& OS_REL=.`sed -n 's/[^ ]* [^ ]* \\([0-9][0-9]\\).*/\\1/p' < /etc/.relid`\n+\t&& OS_REL=.$(sed -n 's/[^ ]* [^ ]* \\([0-9][0-9]\\).*/\\1/p' < /etc/.relid)\n \t/bin/uname -p 2>/dev/null | grep 86 >/dev/null \\\n \t  && { echo i486-ncr-sysv4.3\"$OS_REL\"; exit; }\n \t/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \\\n@@ -1243,7 +1226,7 @@ EOF\n     NCR*:*:4.2:* | MPRAS*:*:4.2:*)\n \tOS_REL='.3'\n \ttest -r /etc/.relid \\\n-\t    && OS_REL=.`sed -n 's/[^ ]* [^ ]* \\([0-9][0-9]\\).*/\\1/p' < /etc/.relid`\n+\t    && OS_REL=.$(sed -n 's/[^ ]* [^ ]* \\([0-9][0-9]\\).*/\\1/p' < /etc/.relid)\n \t/bin/uname -p 2>/dev/null | grep 86 >/dev/null \\\n \t    && { echo i486-ncr-sysv4.3\"$OS_REL\"; exit; }\n \t/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \\\n@@ -1276,7 +1259,7 @@ EOF\n \texit ;;\n     *:SINIX-*:*:*)\n \tif uname -p 2>/dev/null >/dev/null ; then\n-\t\tUNAME_MACHINE=`(uname -p) 2>/dev/null`\n+\t\tUNAME_MACHINE=$( (uname -p) 2>/dev/null)\n \t\techo \"$UNAME_MACHINE\"-sni-sysv4\n \telse\n \t\techo ns32k-sni-sysv\n@@ -1310,7 +1293,7 @@ EOF\n \techo mips-sony-newsos6\n \texit ;;\n     R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)\n-\tif [ -d /usr/nec ]; then\n+\tif test -d /usr/nec; then\n \t\techo mips-nec-sysv\"$UNAME_RELEASE\"\n \telse\n \t\techo mips-unknown-sysv\"$UNAME_RELEASE\"\n@@ -1358,44 +1341,48 @@ EOF\n     *:Rhapsody:*:*)\n \techo \"$UNAME_MACHINE\"-apple-rhapsody\"$UNAME_RELEASE\"\n \texit ;;\n+    arm64:Darwin:*:*)\n+\techo aarch64-apple-darwin\"$UNAME_RELEASE\"\n+\texit ;;\n     *:Darwin:*:*)\n-\tUNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown\n-\tset_cc_for_build\n-\tif test \"$UNAME_PROCESSOR\" = unknown ; then\n-\t    UNAME_PROCESSOR=powerpc\n+\tUNAME_PROCESSOR=$(uname -p)\n+\tcase $UNAME_PROCESSOR in\n+\t    unknown) UNAME_PROCESSOR=powerpc ;;\n+\tesac\n+\tif command -v xcode-select > /dev/null 2> /dev/null && \\\n+\t\t! xcode-select --print-path > /dev/null 2> /dev/null ; then\n+\t    # Avoid executing cc if there is no toolchain installed as\n+\t    # cc will be a stub that puts up a graphical alert\n+\t    # prompting the user to install developer tools.\n+\t    CC_FOR_BUILD=no_compiler_found\n+\telse\n+\t    set_cc_for_build\n \tfi\n-\tif test \"`echo \"$UNAME_RELEASE\" | sed -e 's/\\..*//'`\" -le 10 ; then\n-\t    if [ \"$CC_FOR_BUILD\" != no_compiler_found ]; then\n-\t\tif (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \\\n-\t\t       (CCOPTS=\"\" $CC_FOR_BUILD -E - 2>/dev/null) | \\\n-\t\t       grep IS_64BIT_ARCH >/dev/null\n-\t\tthen\n-\t\t    case $UNAME_PROCESSOR in\n-\t\t\ti386) UNAME_PROCESSOR=x86_64 ;;\n-\t\t\tpowerpc) UNAME_PROCESSOR=powerpc64 ;;\n-\t\t    esac\n-\t\tfi\n-\t\t# On 10.4-10.6 one might compile for PowerPC via gcc -arch ppc\n-\t\tif (echo '#ifdef __POWERPC__'; echo IS_PPC; echo '#endif') | \\\n-\t\t       (CCOPTS=\"\" $CC_FOR_BUILD -E - 2>/dev/null) | \\\n-\t\t       grep IS_PPC >/dev/null\n-\t\tthen\n-\t\t    UNAME_PROCESSOR=powerpc\n-\t\tfi\n+\tif test \"$CC_FOR_BUILD\" != no_compiler_found; then\n+\t    if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \\\n+\t\t   (CCOPTS=\"\" $CC_FOR_BUILD -E - 2>/dev/null) | \\\n+\t\t   grep IS_64BIT_ARCH >/dev/null\n+\t    then\n+\t\tcase $UNAME_PROCESSOR in\n+\t\t    i386) UNAME_PROCESSOR=x86_64 ;;\n+\t\t    powerpc) UNAME_PROCESSOR=powerpc64 ;;\n+\t\tesac\n+\t    fi\n+\t    # On 10.4-10.6 one might compile for PowerPC via gcc -arch ppc\n+\t    if (echo '#ifdef __POWERPC__'; echo IS_PPC; echo '#endif') | \\\n+\t\t   (CCOPTS=\"\" $CC_FOR_BUILD -E - 2>/dev/null) | \\\n+\t\t   grep IS_PPC >/dev/null\n+\t    then\n+\t\tUNAME_PROCESSOR=powerpc\n \t    fi\n \telif test \"$UNAME_PROCESSOR\" = i386 ; then\n-\t    # Avoid executing cc on OS X 10.9, as it ships with a stub\n-\t    # that puts up a graphical alert prompting to install\n-\t    # developer tools.  Any system running Mac OS X 10.7 or\n-\t    # later (Darwin 11 and later) is required to have a 64-bit\n-\t    # processor. This is not true of the ARM version of Darwin\n-\t    # that Apple uses in portable devices.\n-\t    UNAME_PROCESSOR=x86_64\n+\t    # uname -m returns i386 or x86_64\n+\t    UNAME_PROCESSOR=$UNAME_MACHINE\n \tfi\n \techo \"$UNAME_PROCESSOR\"-apple-darwin\"$UNAME_RELEASE\"\n \texit ;;\n     *:procnto*:*:* | *:QNX:[0123456789]*:*)\n-\tUNAME_PROCESSOR=`uname -p`\n+\tUNAME_PROCESSOR=$(uname -p)\n \tif test \"$UNAME_PROCESSOR\" = x86; then\n \t\tUNAME_PROCESSOR=i386\n \t\tUNAME_MACHINE=pc\n@@ -1463,10 +1450,10 @@ EOF\n \techo mips-sei-seiux\"$UNAME_RELEASE\"\n \texit ;;\n     *:DragonFly:*:*)\n-\techo \"$UNAME_MACHINE\"-unknown-dragonfly\"`echo \"$UNAME_RELEASE\"|sed -e 's/[-(].*//'`\"\n+\techo \"$UNAME_MACHINE\"-unknown-dragonfly\"$(echo \"$UNAME_RELEASE\"|sed -e 's/[-(].*//')\"\n \texit ;;\n     *:*VMS:*:*)\n-\tUNAME_MACHINE=`(uname -p) 2>/dev/null`\n+\tUNAME_MACHINE=$( (uname -p) 2>/dev/null)\n \tcase \"$UNAME_MACHINE\" in\n \t    A*) echo alpha-dec-vms ; exit ;;\n \t    I*) echo ia64-dec-vms ; exit ;;\n@@ -1476,7 +1463,7 @@ EOF\n \techo i386-pc-xenix\n \texit ;;\n     i*86:skyos:*:*)\n-\techo \"$UNAME_MACHINE\"-pc-skyos\"`echo \"$UNAME_RELEASE\" | sed -e 's/ .*$//'`\"\n+\techo \"$UNAME_MACHINE\"-pc-skyos\"$(echo \"$UNAME_RELEASE\" | sed -e 's/ .*$//')\"\n \texit ;;\n     i*86:rdos:*:*)\n \techo \"$UNAME_MACHINE\"-pc-rdos\n@@ -1493,15 +1480,6 @@ EOF\n     *:Unleashed:*:*)\n \techo \"$UNAME_MACHINE\"-unknown-unleashed\"$UNAME_RELEASE\"\n \texit ;;\n-    i*86:AROS:*:*)\n-\techo \"$UNAME_MACHINE\"-pc-aros\n-\texit ;;\n-    x86_64:VMkernel:*:*)\n-\techo \"$UNAME_MACHINE\"-unknown-esx\n-\texit ;;\n-    amd64:Isilon\\ OneFS:*:*)\n-\techo x86_64-unknown-onefs\n-\texit ;;\n esac\n \n # No uname command or uname output not recognized.\n@@ -1543,7 +1521,7 @@ main ()\n #define __ARCHITECTURE__ \"m68k\"\n #endif\n   int version;\n-  version=`(hostinfo | sed -n 's/.*NeXT Mach \\([0-9]*\\).*/\\1/p') 2>/dev/null`;\n+  version=$( (hostinfo | sed -n 's/.*NeXT Mach \\([0-9]*\\).*/\\1/p') 2>/dev/null);\n   if (version < 4)\n     printf (\"%s-next-nextstep%d\\n\", __ARCHITECTURE__, version);\n   else\n@@ -1627,16 +1605,15 @@ main ()\n #endif\n #endif\n \n-case \"$UNAME_MACHINE:$UNAME_SYSTEM\" in\n-    mips:Linux | mips64:Linux)\n-\t# If we got here on MIPS GNU/Linux, output extra information.\n-\tcat >&2 <<EOF\n+#if defined (alliant) && defined (i860)\n+  printf (\"i860-alliant-bsd\\n\"); exit (0);\n+#endif\n \n-NOTE: MIPS GNU/Linux systems require a C compiler to fully recognize\n-the system type. Please install a C compiler and try again.\n+  exit (1);\n+}\n EOF\n \n-$CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" 2>/dev/null && SYSTEM_NAME=`$dummy` &&\n+$CC_FOR_BUILD -o \"$dummy\" \"$dummy.c\" 2>/dev/null && SYSTEM_NAME=$($dummy) &&\n \t{ echo \"$SYSTEM_NAME\"; exit; }\n \n # Apollos put the system type in the environment.\n@@ -1664,33 +1641,40 @@ copies of config.guess and config.sub with the latest versions from:\n   https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess\n and\n   https://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub\n+EOF\n+\n+year=$(echo $timestamp | sed 's,-.*,,')\n+# shellcheck disable=SC2003\n+if test \"$(expr \"$(date +%Y)\" - \"$year\")\" -lt 3 ; then\n+   cat >&2 <<EOF\n \n If $0 has already been updated, send the following data and any\n information you think might be pertinent to config-patches@gnu.org to\n provide the necessary information to handle your system.\n \n config.guess timestamp = $timestamp\n \n-uname -m = `(uname -m) 2>/dev/null || echo unknown`\n-uname -r = `(uname -r) 2>/dev/null || echo unknown`\n-uname -s = `(uname -s) 2>/dev/null || echo unknown`\n-uname -v = `(uname -v) 2>/dev/null || echo unknown`\n+uname -m = $( (uname -m) 2>/dev/null || echo unknown)\n+uname -r = $( (uname -r) 2>/dev/null || echo unknown)\n+uname -s = $( (uname -s) 2>/dev/null || echo unknown)\n+uname -v = $( (uname -v) 2>/dev/null || echo unknown)\n \n-/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null`\n-/bin/uname -X     = `(/bin/uname -X) 2>/dev/null`\n+/usr/bin/uname -p = $( (/usr/bin/uname -p) 2>/dev/null)\n+/bin/uname -X     = $( (/bin/uname -X) 2>/dev/null)\n \n-hostinfo               = `(hostinfo) 2>/dev/null`\n-/bin/universe          = `(/bin/universe) 2>/dev/null`\n-/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null`\n-/bin/arch              = `(/bin/arch) 2>/dev/null`\n-/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null`\n-/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null`\n+hostinfo               = $( (hostinfo) 2>/dev/null)\n+/bin/universe          = $( (/bin/universe) 2>/dev/null)\n+/usr/bin/arch -k       = $( (/usr/bin/arch -k) 2>/dev/null)\n+/bin/arch              = $( (/bin/arch) 2>/dev/null)\n+/usr/bin/oslevel       = $( (/usr/bin/oslevel) 2>/dev/null)\n+/usr/convex/getsysinfo = $( (/usr/convex/getsysinfo) 2>/dev/null)\n \n UNAME_MACHINE = \"$UNAME_MACHINE\"\n UNAME_RELEASE = \"$UNAME_RELEASE\"\n UNAME_SYSTEM  = \"$UNAME_SYSTEM\"\n UNAME_VERSION = \"$UNAME_VERSION\"\n EOF\n+fi\n \n exit 1\n "
    },
    {
      "sha": "c874b7a9df8a99e87f796cf953f120db5493bd2b",
      "filename": "readline/readline/support/config.sub",
      "status": "modified",
      "additions": 350,
      "deletions": 298,
      "changes": 648,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/config.sub",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/config.sub",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/support/config.sub?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,8 +1,8 @@\n #! /bin/sh\n # Configuration validation subroutine script.\n-#   Copyright 1992-2019 Free Software Foundation, Inc.\n+#   Copyright 1992-2020 Free Software Foundation, Inc.\n \n-timestamp='2019-08-04'\n+timestamp='2020-11-07'\n \n # This file is free software; you can redistribute it and/or modify it\n # under the terms of the GNU General Public License as published by\n@@ -50,7 +50,7 @@ timestamp='2019-08-04'\n #\tCPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM\n # It is wrong to echo any other type of specification.\n \n-me=`echo \"$0\" | sed -e 's,.*/,,'`\n+me=$(echo \"$0\" | sed -e 's,.*/,,')\n \n usage=\"\\\n Usage: $0 [OPTION] CPU-MFR-OPSYS or ALIAS\n@@ -67,7 +67,7 @@ Report bugs and patches to <config-patches@gnu.org>.\"\n version=\"\\\n GNU config.sub ($timestamp)\n \n-Copyright 1992-2019 Free Software Foundation, Inc.\n+Copyright 1992-2020 Free Software Foundation, Inc.\n \n This is free software; see the source for copying conditions.  There is NO\n warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\"\n@@ -124,28 +124,27 @@ case $1 in\n \t\t;;\n \t*-*-*-*)\n \t\tbasic_machine=$field1-$field2\n-\t\tos=$field3-$field4\n+\t\tbasic_os=$field3-$field4\n \t\t;;\n \t*-*-*)\n \t\t# Ambiguous whether COMPANY is present, or skipped and KERNEL-OS is two\n \t\t# parts\n \t\tmaybe_os=$field2-$field3\n \t\tcase $maybe_os in\n-\t\t\tnto-qnx* | linux-gnu* | linux-android* | linux-dietlibc \\\n-\t\t\t| linux-newlib* | linux-musl* | linux-uclibc* | uclinux-uclibc* \\\n+\t\t\tnto-qnx* | linux-* | uclinux-uclibc* \\\n \t\t\t| uclinux-gnu* | kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* \\\n \t\t\t| netbsd*-eabi* | kopensolaris*-gnu* | cloudabi*-eabi* \\\n \t\t\t| storm-chaos* | os2-emx* | rtmk-nova*)\n \t\t\t\tbasic_machine=$field1\n-\t\t\t\tos=$maybe_os\n+\t\t\t\tbasic_os=$maybe_os\n \t\t\t\t;;\n \t\t\tandroid-linux)\n \t\t\t\tbasic_machine=$field1-unknown\n-\t\t\t\tos=linux-android\n+\t\t\t\tbasic_os=linux-android\n \t\t\t\t;;\n \t\t\t*)\n \t\t\t\tbasic_machine=$field1-$field2\n-\t\t\t\tos=$field3\n+\t\t\t\tbasic_os=$field3\n \t\t\t\t;;\n \t\tesac\n \t\t;;\n@@ -154,15 +153,15 @@ case $1 in\n \t\tcase $field1-$field2 in\n \t\t\tdecstation-3100)\n \t\t\t\tbasic_machine=mips-dec\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\t*-*)\n \t\t\t\t# Second component is usually, but not always the OS\n \t\t\t\tcase $field2 in\n \t\t\t\t\t# Prevent following clause from handling this valid os\n \t\t\t\t\tsun*os*)\n \t\t\t\t\t\tbasic_machine=$field1\n-\t\t\t\t\t\tos=$field2\n+\t\t\t\t\t\tbasic_os=$field2\n \t\t\t\t\t\t;;\n \t\t\t\t\t# Manufacturers\n \t\t\t\t\tdec* | mips* | sequent* | encore* | pc533* | sgi* | sony* \\\n@@ -175,11 +174,11 @@ case $1 in\n \t\t\t\t\t| microblaze* | sim | cisco \\\n \t\t\t\t\t| oki | wec | wrs | winbond)\n \t\t\t\t\t\tbasic_machine=$field1-$field2\n-\t\t\t\t\t\tos=\n+\t\t\t\t\t\tbasic_os=\n \t\t\t\t\t\t;;\n \t\t\t\t\t*)\n \t\t\t\t\t\tbasic_machine=$field1\n-\t\t\t\t\t\tos=$field2\n+\t\t\t\t\t\tbasic_os=$field2\n \t\t\t\t\t\t;;\n \t\t\t\tesac\n \t\t\t;;\n@@ -191,450 +190,451 @@ case $1 in\n \t\tcase $field1 in\n \t\t\t386bsd)\n \t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\ta29khif)\n \t\t\t\tbasic_machine=a29k-amd\n-\t\t\t\tos=udi\n+\t\t\t\tbasic_os=udi\n \t\t\t\t;;\n \t\t\tadobe68k)\n \t\t\t\tbasic_machine=m68010-adobe\n-\t\t\t\tos=scout\n+\t\t\t\tbasic_os=scout\n \t\t\t\t;;\n \t\t\talliant)\n \t\t\t\tbasic_machine=fx80-alliant\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\taltos | altos3068)\n \t\t\t\tbasic_machine=m68k-altos\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tam29k)\n \t\t\t\tbasic_machine=a29k-none\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\tamdahl)\n \t\t\t\tbasic_machine=580-amdahl\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tamiga)\n \t\t\t\tbasic_machine=m68k-unknown\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tamigaos | amigados)\n \t\t\t\tbasic_machine=m68k-unknown\n-\t\t\t\tos=amigaos\n+\t\t\t\tbasic_os=amigaos\n \t\t\t\t;;\n \t\t\tamigaunix | amix)\n \t\t\t\tbasic_machine=m68k-unknown\n-\t\t\t\tos=sysv4\n+\t\t\t\tbasic_os=sysv4\n \t\t\t\t;;\n \t\t\tapollo68)\n \t\t\t\tbasic_machine=m68k-apollo\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tapollo68bsd)\n \t\t\t\tbasic_machine=m68k-apollo\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\taros)\n \t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=aros\n+\t\t\t\tbasic_os=aros\n \t\t\t\t;;\n \t\t\taux)\n \t\t\t\tbasic_machine=m68k-apple\n-\t\t\t\tos=aux\n+\t\t\t\tbasic_os=aux\n \t\t\t\t;;\n \t\t\tbalance)\n \t\t\t\tbasic_machine=ns32k-sequent\n-\t\t\t\tos=dynix\n+\t\t\t\tbasic_os=dynix\n \t\t\t\t;;\n \t\t\tblackfin)\n \t\t\t\tbasic_machine=bfin-unknown\n-\t\t\t\tos=linux\n+\t\t\t\tbasic_os=linux\n \t\t\t\t;;\n \t\t\tcegcc)\n \t\t\t\tbasic_machine=arm-unknown\n-\t\t\t\tos=cegcc\n+\t\t\t\tbasic_os=cegcc\n \t\t\t\t;;\n \t\t\tconvex-c1)\n \t\t\t\tbasic_machine=c1-convex\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\tconvex-c2)\n \t\t\t\tbasic_machine=c2-convex\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\tconvex-c32)\n \t\t\t\tbasic_machine=c32-convex\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\tconvex-c34)\n \t\t\t\tbasic_machine=c34-convex\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\tconvex-c38)\n \t\t\t\tbasic_machine=c38-convex\n-\t\t\t\tos=bsd\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\tcray)\n \t\t\t\tbasic_machine=j90-cray\n-\t\t\t\tos=unicos\n+\t\t\t\tbasic_os=unicos\n \t\t\t\t;;\n \t\t\tcrds | unos)\n \t\t\t\tbasic_machine=m68k-crds\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tda30)\n \t\t\t\tbasic_machine=m68k-da30\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tdecstation | pmax | pmin | dec3100 | decstatn)\n \t\t\t\tbasic_machine=mips-dec\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tdelta88)\n \t\t\t\tbasic_machine=m88k-motorola\n-\t\t\t\tos=sysv3\n+\t\t\t\tbasic_os=sysv3\n \t\t\t\t;;\n \t\t\tdicos)\n \t\t\t\tbasic_machine=i686-pc\n-\t\t\t\tos=dicos\n+\t\t\t\tbasic_os=dicos\n \t\t\t\t;;\n \t\t\tdjgpp)\n \t\t\t\tbasic_machine=i586-pc\n-\t\t\t\tos=msdosdjgpp\n+\t\t\t\tbasic_os=msdosdjgpp\n \t\t\t\t;;\n \t\t\tebmon29k)\n \t\t\t\tbasic_machine=a29k-amd\n-\t\t\t\tos=ebmon\n+\t\t\t\tbasic_os=ebmon\n \t\t\t\t;;\n \t\t\tes1800 | OSE68k | ose68k | ose | OSE)\n \t\t\t\tbasic_machine=m68k-ericsson\n-\t\t\t\tos=ose\n+\t\t\t\tbasic_os=ose\n \t\t\t\t;;\n \t\t\tgmicro)\n \t\t\t\tbasic_machine=tron-gmicro\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tgo32)\n \t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=go32\n+\t\t\t\tbasic_os=go32\n \t\t\t\t;;\n \t\t\th8300hms)\n \t\t\t\tbasic_machine=h8300-hitachi\n-\t\t\t\tos=hms\n+\t\t\t\tbasic_os=hms\n \t\t\t\t;;\n \t\t\th8300xray)\n \t\t\t\tbasic_machine=h8300-hitachi\n-\t\t\t\tos=xray\n+\t\t\t\tbasic_os=xray\n \t\t\t\t;;\n \t\t\th8500hms)\n \t\t\t\tbasic_machine=h8500-hitachi\n-\t\t\t\tos=hms\n+\t\t\t\tbasic_os=hms\n \t\t\t\t;;\n \t\t\tharris)\n \t\t\t\tbasic_machine=m88k-harris\n-\t\t\t\tos=sysv3\n+\t\t\t\tbasic_os=sysv3\n \t\t\t\t;;\n-\t\t\thp300)\n+\t\t\thp300 | hp300hpux)\n \t\t\t\tbasic_machine=m68k-hp\n+\t\t\t\tbasic_os=hpux\n \t\t\t\t;;\n \t\t\thp300bsd)\n \t\t\t\tbasic_machine=m68k-hp\n-\t\t\t\tos=bsd\n-\t\t\t\t;;\n-\t\t\thp300hpux)\n-\t\t\t\tbasic_machine=m68k-hp\n-\t\t\t\tos=hpux\n+\t\t\t\tbasic_os=bsd\n \t\t\t\t;;\n \t\t\thppaosf)\n \t\t\t\tbasic_machine=hppa1.1-hp\n-\t\t\t\tos=osf\n+\t\t\t\tbasic_os=osf\n \t\t\t\t;;\n \t\t\thppro)\n \t\t\t\tbasic_machine=hppa1.1-hp\n-\t\t\t\tos=proelf\n+\t\t\t\tbasic_os=proelf\n \t\t\t\t;;\n \t\t\ti386mach)\n \t\t\t\tbasic_machine=i386-mach\n-\t\t\t\tos=mach\n-\t\t\t\t;;\n-\t\t\tvsta)\n-\t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=vsta\n+\t\t\t\tbasic_os=mach\n \t\t\t\t;;\n \t\t\tisi68 | isi)\n \t\t\t\tbasic_machine=m68k-isi\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tm68knommu)\n \t\t\t\tbasic_machine=m68k-unknown\n-\t\t\t\tos=linux\n+\t\t\t\tbasic_os=linux\n \t\t\t\t;;\n \t\t\tmagnum | m3230)\n \t\t\t\tbasic_machine=mips-mips\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tmerlin)\n \t\t\t\tbasic_machine=ns32k-utek\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tmingw64)\n \t\t\t\tbasic_machine=x86_64-pc\n-\t\t\t\tos=mingw64\n+\t\t\t\tbasic_os=mingw64\n \t\t\t\t;;\n \t\t\tmingw32)\n \t\t\t\tbasic_machine=i686-pc\n-\t\t\t\tos=mingw32\n+\t\t\t\tbasic_os=mingw32\n \t\t\t\t;;\n \t\t\tmingw32ce)\n \t\t\t\tbasic_machine=arm-unknown\n-\t\t\t\tos=mingw32ce\n+\t\t\t\tbasic_os=mingw32ce\n \t\t\t\t;;\n \t\t\tmonitor)\n \t\t\t\tbasic_machine=m68k-rom68k\n-\t\t\t\tos=coff\n+\t\t\t\tbasic_os=coff\n \t\t\t\t;;\n \t\t\tmorphos)\n \t\t\t\tbasic_machine=powerpc-unknown\n-\t\t\t\tos=morphos\n+\t\t\t\tbasic_os=morphos\n \t\t\t\t;;\n \t\t\tmoxiebox)\n \t\t\t\tbasic_machine=moxie-unknown\n-\t\t\t\tos=moxiebox\n+\t\t\t\tbasic_os=moxiebox\n \t\t\t\t;;\n \t\t\tmsdos)\n \t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=msdos\n+\t\t\t\tbasic_os=msdos\n \t\t\t\t;;\n \t\t\tmsys)\n \t\t\t\tbasic_machine=i686-pc\n-\t\t\t\tos=msys\n+\t\t\t\tbasic_os=msys\n \t\t\t\t;;\n \t\t\tmvs)\n \t\t\t\tbasic_machine=i370-ibm\n-\t\t\t\tos=mvs\n+\t\t\t\tbasic_os=mvs\n \t\t\t\t;;\n \t\t\tnacl)\n \t\t\t\tbasic_machine=le32-unknown\n-\t\t\t\tos=nacl\n+\t\t\t\tbasic_os=nacl\n \t\t\t\t;;\n \t\t\tncr3000)\n \t\t\t\tbasic_machine=i486-ncr\n-\t\t\t\tos=sysv4\n+\t\t\t\tbasic_os=sysv4\n \t\t\t\t;;\n \t\t\tnetbsd386)\n \t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=netbsd\n+\t\t\t\tbasic_os=netbsd\n \t\t\t\t;;\n \t\t\tnetwinder)\n \t\t\t\tbasic_machine=armv4l-rebel\n-\t\t\t\tos=linux\n+\t\t\t\tbasic_os=linux\n \t\t\t\t;;\n \t\t\tnews | news700 | news800 | news900)\n \t\t\t\tbasic_machine=m68k-sony\n-\t\t\t\tos=newsos\n+\t\t\t\tbasic_os=newsos\n \t\t\t\t;;\n \t\t\tnews1000)\n \t\t\t\tbasic_machine=m68030-sony\n-\t\t\t\tos=newsos\n+\t\t\t\tbasic_os=newsos\n \t\t\t\t;;\n \t\t\tnecv70)\n \t\t\t\tbasic_machine=v70-nec\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tnh3000)\n \t\t\t\tbasic_machine=m68k-harris\n-\t\t\t\tos=cxux\n+\t\t\t\tbasic_os=cxux\n \t\t\t\t;;\n \t\t\tnh[45]000)\n \t\t\t\tbasic_machine=m88k-harris\n-\t\t\t\tos=cxux\n+\t\t\t\tbasic_os=cxux\n \t\t\t\t;;\n \t\t\tnindy960)\n \t\t\t\tbasic_machine=i960-intel\n-\t\t\t\tos=nindy\n+\t\t\t\tbasic_os=nindy\n \t\t\t\t;;\n \t\t\tmon960)\n \t\t\t\tbasic_machine=i960-intel\n-\t\t\t\tos=mon960\n+\t\t\t\tbasic_os=mon960\n \t\t\t\t;;\n \t\t\tnonstopux)\n \t\t\t\tbasic_machine=mips-compaq\n-\t\t\t\tos=nonstopux\n+\t\t\t\tbasic_os=nonstopux\n \t\t\t\t;;\n \t\t\tos400)\n \t\t\t\tbasic_machine=powerpc-ibm\n-\t\t\t\tos=os400\n+\t\t\t\tbasic_os=os400\n \t\t\t\t;;\n \t\t\tOSE68000 | ose68000)\n \t\t\t\tbasic_machine=m68000-ericsson\n-\t\t\t\tos=ose\n+\t\t\t\tbasic_os=ose\n \t\t\t\t;;\n \t\t\tos68k)\n \t\t\t\tbasic_machine=m68k-none\n-\t\t\t\tos=os68k\n+\t\t\t\tbasic_os=os68k\n \t\t\t\t;;\n \t\t\tparagon)\n \t\t\t\tbasic_machine=i860-intel\n-\t\t\t\tos=osf\n+\t\t\t\tbasic_os=osf\n \t\t\t\t;;\n \t\t\tparisc)\n \t\t\t\tbasic_machine=hppa-unknown\n-\t\t\t\tos=linux\n+\t\t\t\tbasic_os=linux\n+\t\t\t\t;;\n+\t\t\tpsp)\n+\t\t\t\tbasic_machine=mipsallegrexel-sony\n+\t\t\t\tbasic_os=psp\n \t\t\t\t;;\n \t\t\tpw32)\n \t\t\t\tbasic_machine=i586-unknown\n-\t\t\t\tos=pw32\n+\t\t\t\tbasic_os=pw32\n \t\t\t\t;;\n \t\t\trdos | rdos64)\n \t\t\t\tbasic_machine=x86_64-pc\n-\t\t\t\tos=rdos\n+\t\t\t\tbasic_os=rdos\n \t\t\t\t;;\n \t\t\trdos32)\n \t\t\t\tbasic_machine=i386-pc\n-\t\t\t\tos=rdos\n+\t\t\t\tbasic_os=rdos\n \t\t\t\t;;\n \t\t\trom68k)\n \t\t\t\tbasic_machine=m68k-rom68k\n-\t\t\t\tos=coff\n+\t\t\t\tbasic_os=coff\n \t\t\t\t;;\n \t\t\tsa29200)\n \t\t\t\tbasic_machine=a29k-amd\n-\t\t\t\tos=udi\n+\t\t\t\tbasic_os=udi\n \t\t\t\t;;\n \t\t\tsei)\n \t\t\t\tbasic_machine=mips-sei\n-\t\t\t\tos=seiux\n+\t\t\t\tbasic_os=seiux\n \t\t\t\t;;\n \t\t\tsequent)\n \t\t\t\tbasic_machine=i386-sequent\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tsps7)\n \t\t\t\tbasic_machine=m68k-bull\n-\t\t\t\tos=sysv2\n+\t\t\t\tbasic_os=sysv2\n \t\t\t\t;;\n \t\t\tst2000)\n \t\t\t\tbasic_machine=m68k-tandem\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tstratus)\n \t\t\t\tbasic_machine=i860-stratus\n-\t\t\t\tos=sysv4\n+\t\t\t\tbasic_os=sysv4\n \t\t\t\t;;\n \t\t\tsun2)\n \t\t\t\tbasic_machine=m68000-sun\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tsun2os3)\n \t\t\t\tbasic_machine=m68000-sun\n-\t\t\t\tos=sunos3\n+\t\t\t\tbasic_os=sunos3\n \t\t\t\t;;\n \t\t\tsun2os4)\n \t\t\t\tbasic_machine=m68000-sun\n-\t\t\t\tos=sunos4\n+\t\t\t\tbasic_os=sunos4\n \t\t\t\t;;\n \t\t\tsun3)\n \t\t\t\tbasic_machine=m68k-sun\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tsun3os3)\n \t\t\t\tbasic_machine=m68k-sun\n-\t\t\t\tos=sunos3\n+\t\t\t\tbasic_os=sunos3\n \t\t\t\t;;\n \t\t\tsun3os4)\n \t\t\t\tbasic_machine=m68k-sun\n-\t\t\t\tos=sunos4\n+\t\t\t\tbasic_os=sunos4\n \t\t\t\t;;\n \t\t\tsun4)\n \t\t\t\tbasic_machine=sparc-sun\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tsun4os3)\n \t\t\t\tbasic_machine=sparc-sun\n-\t\t\t\tos=sunos3\n+\t\t\t\tbasic_os=sunos3\n \t\t\t\t;;\n \t\t\tsun4os4)\n \t\t\t\tbasic_machine=sparc-sun\n-\t\t\t\tos=sunos4\n+\t\t\t\tbasic_os=sunos4\n \t\t\t\t;;\n \t\t\tsun4sol2)\n \t\t\t\tbasic_machine=sparc-sun\n-\t\t\t\tos=solaris2\n+\t\t\t\tbasic_os=solaris2\n \t\t\t\t;;\n \t\t\tsun386 | sun386i | roadrunner)\n \t\t\t\tbasic_machine=i386-sun\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\t\tsv1)\n \t\t\t\tbasic_machine=sv1-cray\n-\t\t\t\tos=unicos\n+\t\t\t\tbasic_os=unicos\n \t\t\t\t;;\n \t\t\tsymmetry)\n \t\t\t\tbasic_machine=i386-sequent\n-\t\t\t\tos=dynix\n+\t\t\t\tbasic_os=dynix\n \t\t\t\t;;\n \t\t\tt3e)\n \t\t\t\tbasic_machine=alphaev5-cray\n-\t\t\t\tos=unicos\n+\t\t\t\tbasic_os=unicos\n \t\t\t\t;;\n \t\t\tt90)\n \t\t\t\tbasic_machine=t90-cray\n-\t\t\t\tos=unicos\n+\t\t\t\tbasic_os=unicos\n \t\t\t\t;;\n \t\t\ttoad1)\n \t\t\t\tbasic_machine=pdp10-xkl\n-\t\t\t\tos=tops20\n+\t\t\t\tbasic_os=tops20\n \t\t\t\t;;\n \t\t\ttpf)\n \t\t\t\tbasic_machine=s390x-ibm\n-\t\t\t\tos=tpf\n+\t\t\t\tbasic_os=tpf\n \t\t\t\t;;\n \t\t\tudi29k)\n \t\t\t\tbasic_machine=a29k-amd\n-\t\t\t\tos=udi\n+\t\t\t\tbasic_os=udi\n \t\t\t\t;;\n \t\t\tultra3)\n \t\t\t\tbasic_machine=a29k-nyu\n-\t\t\t\tos=sym1\n+\t\t\t\tbasic_os=sym1\n \t\t\t\t;;\n \t\t\tv810 | necv810)\n \t\t\t\tbasic_machine=v810-nec\n-\t\t\t\tos=none\n+\t\t\t\tbasic_os=none\n \t\t\t\t;;\n \t\t\tvaxv)\n \t\t\t\tbasic_machine=vax-dec\n-\t\t\t\tos=sysv\n+\t\t\t\tbasic_os=sysv\n \t\t\t\t;;\n \t\t\tvms)\n \t\t\t\tbasic_machine=vax-dec\n-\t\t\t\tos=vms\n+\t\t\t\tbasic_os=vms\n+\t\t\t\t;;\n+\t\t\tvsta)\n+\t\t\t\tbasic_machine=i386-pc\n+\t\t\t\tbasic_os=vsta\n \t\t\t\t;;\n \t\t\tvxworks960)\n \t\t\t\tbasic_machine=i960-wrs\n-\t\t\t\tos=vxworks\n+\t\t\t\tbasic_os=vxworks\n \t\t\t\t;;\n \t\t\tvxworks68)\n \t\t\t\tbasic_machine=m68k-wrs\n-\t\t\t\tos=vxworks\n+\t\t\t\tbasic_os=vxworks\n \t\t\t\t;;\n \t\t\tvxworks29k)\n \t\t\t\tbasic_machine=a29k-wrs\n-\t\t\t\tos=vxworks\n+\t\t\t\tbasic_os=vxworks\n \t\t\t\t;;\n \t\t\txbox)\n \t\t\t\tbasic_machine=i686-pc\n-\t\t\t\tos=mingw32\n+\t\t\t\tbasic_os=mingw32\n \t\t\t\t;;\n \t\t\tymp)\n \t\t\t\tbasic_machine=ymp-cray\n-\t\t\t\tos=unicos\n+\t\t\t\tbasic_os=unicos\n \t\t\t\t;;\n \t\t\t*)\n \t\t\t\tbasic_machine=$1\n-\t\t\t\tos=\n+\t\t\t\tbasic_os=\n \t\t\t\t;;\n \t\tesac\n \t\t;;\n@@ -686,17 +686,17 @@ case $basic_machine in\n \tbluegene*)\n \t\tcpu=powerpc\n \t\tvendor=ibm\n-\t\tos=cnk\n+\t\tbasic_os=cnk\n \t\t;;\n \tdecsystem10* | dec10*)\n \t\tcpu=pdp10\n \t\tvendor=dec\n-\t\tos=tops10\n+\t\tbasic_os=tops10\n \t\t;;\n \tdecsystem20* | dec20*)\n \t\tcpu=pdp10\n \t\tvendor=dec\n-\t\tos=tops20\n+\t\tbasic_os=tops20\n \t\t;;\n \tdelta | 3300 | motorola-3300 | motorola-delta \\\n \t      | 3300-motorola | delta-motorola)\n@@ -706,7 +706,7 @@ case $basic_machine in\n \tdpx2*)\n \t\tcpu=m68k\n \t\tvendor=bull\n-\t\tos=sysv3\n+\t\tbasic_os=sysv3\n \t\t;;\n \tencore | umax | mmax)\n \t\tcpu=ns32k\n@@ -715,7 +715,7 @@ case $basic_machine in\n \telxsi)\n \t\tcpu=elxsi\n \t\tvendor=elxsi\n-\t\tos=${os:-bsd}\n+\t\tbasic_os=${basic_os:-bsd}\n \t\t;;\n \tfx2800)\n \t\tcpu=i860\n@@ -728,7 +728,7 @@ case $basic_machine in\n \th3050r* | hiux*)\n \t\tcpu=hppa1.1\n \t\tvendor=hitachi\n-\t\tos=hiuxwe2\n+\t\tbasic_os=hiuxwe2\n \t\t;;\n \thp3k9[0-9][0-9] | hp9[0-9][0-9])\n \t\tcpu=hppa1.0\n@@ -769,38 +769,38 @@ case $basic_machine in\n \t\tvendor=hp\n \t\t;;\n \ti*86v32)\n-\t\tcpu=`echo \"$1\" | sed -e 's/86.*/86/'`\n+\t\tcpu=$(echo \"$1\" | sed -e 's/86.*/86/')\n \t\tvendor=pc\n-\t\tos=sysv32\n+\t\tbasic_os=sysv32\n \t\t;;\n \ti*86v4*)\n-\t\tcpu=`echo \"$1\" | sed -e 's/86.*/86/'`\n+\t\tcpu=$(echo \"$1\" | sed -e 's/86.*/86/')\n \t\tvendor=pc\n-\t\tos=sysv4\n+\t\tbasic_os=sysv4\n \t\t;;\n \ti*86v)\n-\t\tcpu=`echo \"$1\" | sed -e 's/86.*/86/'`\n+\t\tcpu=$(echo \"$1\" | sed -e 's/86.*/86/')\n \t\tvendor=pc\n-\t\tos=sysv\n+\t\tbasic_os=sysv\n \t\t;;\n \ti*86sol2)\n-\t\tcpu=`echo \"$1\" | sed -e 's/86.*/86/'`\n+\t\tcpu=$(echo \"$1\" | sed -e 's/86.*/86/')\n \t\tvendor=pc\n-\t\tos=solaris2\n+\t\tbasic_os=solaris2\n \t\t;;\n \tj90 | j90-cray)\n \t\tcpu=j90\n \t\tvendor=cray\n-\t\tos=${os:-unicos}\n+\t\tbasic_os=${basic_os:-unicos}\n \t\t;;\n \tiris | iris4d)\n \t\tcpu=mips\n \t\tvendor=sgi\n-\t\tcase $os in\n+\t\tcase $basic_os in\n \t\t    irix*)\n \t\t\t;;\n \t\t    *)\n-\t\t\tos=irix4\n+\t\t\tbasic_os=irix4\n \t\t\t;;\n \t\tesac\n \t\t;;\n@@ -811,26 +811,26 @@ case $basic_machine in\n \t*mint | mint[0-9]* | *MiNT | *MiNT[0-9]*)\n \t\tcpu=m68k\n \t\tvendor=atari\n-\t\tos=mint\n+\t\tbasic_os=mint\n \t\t;;\n \tnews-3600 | risc-news)\n \t\tcpu=mips\n \t\tvendor=sony\n-\t\tos=newsos\n+\t\tbasic_os=newsos\n \t\t;;\n \tnext | m*-next)\n \t\tcpu=m68k\n \t\tvendor=next\n-\t\tcase $os in\n+\t\tcase $basic_os in\n \t\t    openstep*)\n \t\t        ;;\n \t\t    nextstep*)\n \t\t\t;;\n \t\t    ns2*)\n-\t\t      os=nextstep2\n+\t\t      basic_os=nextstep2\n \t\t\t;;\n \t\t    *)\n-\t\t      os=nextstep3\n+\t\t      basic_os=nextstep3\n \t\t\t;;\n \t\tesac\n \t\t;;\n@@ -841,12 +841,12 @@ case $basic_machine in\n \top50n-* | op60c-*)\n \t\tcpu=hppa1.1\n \t\tvendor=oki\n-\t\tos=proelf\n+\t\tbasic_os=proelf\n \t\t;;\n \tpa-hitachi)\n \t\tcpu=hppa1.1\n \t\tvendor=hitachi\n-\t\tos=hiuxwe2\n+\t\tbasic_os=hiuxwe2\n \t\t;;\n \tpbd)\n \t\tcpu=sparc\n@@ -883,12 +883,12 @@ case $basic_machine in\n \tsde)\n \t\tcpu=mipsisa32\n \t\tvendor=sde\n-\t\tos=${os:-elf}\n+\t\tbasic_os=${basic_os:-elf}\n \t\t;;\n \tsimso-wrs)\n \t\tcpu=sparclite\n \t\tvendor=wrs\n-\t\tos=vxworks\n+\t\tbasic_os=vxworks\n \t\t;;\n \ttower | tower-32)\n \t\tcpu=m68k\n@@ -905,7 +905,7 @@ case $basic_machine in\n \tw89k-*)\n \t\tcpu=hppa1.1\n \t\tvendor=winbond\n-\t\tos=proelf\n+\t\tbasic_os=proelf\n \t\t;;\n \tnone)\n \t\tcpu=none\n@@ -917,7 +917,7 @@ case $basic_machine in\n \t\t;;\n \tleon-*|leon[3-9]-*)\n \t\tcpu=sparc\n-\t\tvendor=`echo \"$basic_machine\" | sed 's/-.*//'`\n+\t\tvendor=$(echo \"$basic_machine\" | sed 's/-.*//')\n \t\t;;\n \n \t*-*)\n@@ -958,11 +958,11 @@ case $cpu-$vendor in\n \t# some cases the only manufacturer, in others, it is the most popular.\n \tcraynv-unknown)\n \t\tvendor=cray\n-\t\tos=${os:-unicosmp}\n+\t\tbasic_os=${basic_os:-unicosmp}\n \t\t;;\n \tc90-unknown | c90-cray)\n \t\tvendor=cray\n-\t\tos=${os:-unicos}\n+\t\tbasic_os=${Basic_os:-unicos}\n \t\t;;\n \tfx80-unknown)\n \t\tvendor=alliant\n@@ -1006,7 +1006,7 @@ case $cpu-$vendor in\n \tdpx20-unknown | dpx20-bull)\n \t\tcpu=rs6000\n \t\tvendor=bull\n-\t\tos=${os:-bosx}\n+\t\tbasic_os=${basic_os:-bosx}\n \t\t;;\n \n \t# Here we normalize CPU types irrespective of the vendor\n@@ -1015,7 +1015,7 @@ case $cpu-$vendor in\n \t\t;;\n \tblackfin-*)\n \t\tcpu=bfin\n-\t\tos=linux\n+\t\tbasic_os=linux\n \t\t;;\n \tc54x-*)\n \t\tcpu=tic54x\n@@ -1028,7 +1028,7 @@ case $cpu-$vendor in\n \t\t;;\n \te500v[12]-*)\n \t\tcpu=powerpc\n-\t\tos=$os\"spe\"\n+\t\tbasic_os=${basic_os}\"spe\"\n \t\t;;\n \tmips3*-*)\n \t\tcpu=mips64\n@@ -1038,7 +1038,7 @@ case $cpu-$vendor in\n \t\t;;\n \tm68knommu-*)\n \t\tcpu=m68k\n-\t\tos=linux\n+\t\tbasic_os=linux\n \t\t;;\n \tm9s12z-* | m68hcs12z-* | hcs12z-* | s12z-*)\n \t\tcpu=s12z\n@@ -1048,7 +1048,7 @@ case $cpu-$vendor in\n \t\t;;\n \tparisc-*)\n \t\tcpu=hppa\n-\t\tos=linux\n+\t\tbasic_os=linux\n \t\t;;\n \tpentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)\n \t\tcpu=i586\n@@ -1084,7 +1084,7 @@ case $cpu-$vendor in\n \t\tcpu=mipsisa64sb1el\n \t\t;;\n \tsh5e[lb]-*)\n-\t\tcpu=`echo \"$cpu\" | sed 's/^\\(sh.\\)e\\(.\\)$/\\1\\2e/'`\n+\t\tcpu=$(echo \"$cpu\" | sed 's/^\\(sh.\\)e\\(.\\)$/\\1\\2e/')\n \t\t;;\n \tspur-*)\n \t\tcpu=spur\n@@ -1102,13 +1102,16 @@ case $cpu-$vendor in\n \t\tcpu=x86_64\n \t\t;;\n \txscale-* | xscalee[bl]-*)\n-\t\tcpu=`echo \"$cpu\" | sed 's/^xscale/arm/'`\n+\t\tcpu=$(echo \"$cpu\" | sed 's/^xscale/arm/')\n+\t\t;;\n+\tarm64-*)\n+\t\tcpu=aarch64\n \t\t;;\n \n \t# Recognize the canonical CPU Types that limit and/or modify the\n \t# company names they are paired with.\n \tcr16-*)\n-\t\tos=${os:-elf}\n+\t\tbasic_os=${basic_os:-elf}\n \t\t;;\n \tcrisv32-* | etraxfs*-*)\n \t\tcpu=crisv32\n@@ -1119,7 +1122,7 @@ case $cpu-$vendor in\n \t\tvendor=axis\n \t\t;;\n \tcrx-*)\n-\t\tos=${os:-elf}\n+\t\tbasic_os=${basic_os:-elf}\n \t\t;;\n \tneo-tandem)\n \t\tcpu=neo\n@@ -1141,16 +1144,12 @@ case $cpu-$vendor in\n \t\tcpu=nsx\n \t\tvendor=tandem\n \t\t;;\n-\ts390-*)\n-\t\tcpu=s390\n-\t\tvendor=ibm\n-\t\t;;\n-\ts390x-*)\n-\t\tcpu=s390x\n-\t\tvendor=ibm\n+\tmipsallegrexel-sony)\n+\t\tcpu=mipsallegrexel\n+\t\tvendor=sony\n \t\t;;\n \ttile*-*)\n-\t\tos=${os:-linux-gnu}\n+\t\tbasic_os=${basic_os:-linux-gnu}\n \t\t;;\n \n \t*)\n@@ -1167,7 +1166,7 @@ case $cpu-$vendor in\n \t\t\t| am33_2.0 \\\n \t\t\t| amdgcn \\\n \t\t\t| arc | arceb \\\n-\t\t\t| arm  | arm[lb]e | arme[lb] | armv* \\\n+\t\t\t| arm | arm[lb]e | arme[lb] | armv* \\\n \t\t\t| avr | avr32 \\\n \t\t\t| asmjs \\\n \t\t\t| ba \\\n@@ -1232,6 +1231,7 @@ case $cpu-$vendor in\n \t\t\t| pyramid \\\n \t\t\t| riscv | riscv32 | riscv64 \\\n \t\t\t| rl78 | romp | rs6000 | rx \\\n+\t\t\t| s390 | s390x \\\n \t\t\t| score \\\n \t\t\t| sh | shl \\\n \t\t\t| sh[1234] | sh[24]a | sh[24]ae[lb] | sh[23]e | she[lb] | sh[lb]e \\\n@@ -1278,8 +1278,47 @@ esac\n \n # Decode manufacturer-specific aliases for certain operating systems.\n \n-if [ x$os != x ]\n+if test x$basic_os != x\n then\n+\n+# First recognize some ad-hoc caes, or perhaps split kernel-os, or else just\n+# set os.\n+case $basic_os in\n+\tgnu/linux*)\n+\t\tkernel=linux\n+\t\tos=$(echo $basic_os | sed -e 's|gnu/linux|gnu|')\n+\t\t;;\n+\tos2-emx)\n+\t\tkernel=os2\n+\t\tos=$(echo $basic_os | sed -e 's|os2-emx|emx|')\n+\t\t;;\n+\tnto-qnx*)\n+\t\tkernel=nto\n+\t\tos=$(echo $basic_os | sed -e 's|nto-qnx|qnx|')\n+\t\t;;\n+\t*-*)\n+\t\t# shellcheck disable=SC2162\n+\t\tIFS=\"-\" read kernel os <<EOF\n+$basic_os\n+EOF\n+\t\t;;\n+\t# Default OS when just kernel was specified\n+\tnto*)\n+\t\tkernel=nto\n+\t\tos=$(echo $basic_os | sed -e 's|nto|qnx|')\n+\t\t;;\n+\tlinux*)\n+\t\tkernel=linux\n+\t\tos=$(echo $basic_os | sed -e 's|linux|gnu|')\n+\t\t;;\n+\t*)\n+\t\tkernel=\n+\t\tos=$basic_os\n+\t\t;;\n+esac\n+\n+# Now, normalize the OS (knowing we just have one component, it's not a kernel,\n+# etc.)\n case $os in\n \t# First match some system type aliases that might get confused\n \t# with valid system types.\n@@ -1291,17 +1330,14 @@ case $os in\n \t\tos=cnk\n \t\t;;\n \tsolaris1 | solaris1.*)\n-\t\tos=`echo $os | sed -e 's|solaris1|sunos4|'`\n+\t\tos=$(echo $os | sed -e 's|solaris1|sunos4|')\n \t\t;;\n \tsolaris)\n \t\tos=solaris2\n \t\t;;\n \tunixware*)\n \t\tos=sysv4.2uw\n \t\t;;\n-\tgnu/linux*)\n-\t\tos=`echo $os | sed -e 's|gnu/linux|linux-gnu|'`\n-\t\t;;\n \t# es1800 is here to avoid being matched by es* (a different OS)\n \tes1800*)\n \t\tos=ose\n@@ -1323,12 +1359,9 @@ case $os in\n \t\tos=sco3.2v4\n \t\t;;\n \tsco3.2.[4-9]*)\n-\t\tos=`echo $os | sed -e 's/sco3.2./sco3.2v/'`\n-\t\t;;\n-\tsco3.2v[4-9]* | sco5v6*)\n-\t\t# Don't forget version if it is 3.2v4 or newer.\n+\t\tos=$(echo $os | sed -e 's/sco3.2./sco3.2v/')\n \t\t;;\n-\tscout)\n+\tsco*v* | scout)\n \t\t# Don't match below\n \t\t;;\n \tsco*)\n@@ -1337,78 +1370,26 @@ case $os in\n \tpsos*)\n \t\tos=psos\n \t\t;;\n-\t# Now accept the basic system types.\n-\t# The portable systems comes first.\n-\t# Each alternative MUST end in a * to match a version number.\n-\t# sysv* is not here because it comes later, after sysvr4.\n-\tgnu* | bsd* | mach* | minix* | genix* | ultrix* | irix* \\\n-\t     | *vms* | esix* | aix* | cnk* | sunos | sunos[34]*\\\n-\t     | hpux* | unos* | osf* | luna* | dgux* | auroraux* | solaris* \\\n-\t     | sym* | kopensolaris* | plan9* \\\n-\t     | amigaos* | amigados* | msdos* | newsos* | unicos* | aof* \\\n-\t     | aos* | aros* | cloudabi* | sortix* \\\n-\t     | nindy* | vxsim* | vxworks* | ebmon* | hms* | mvs* \\\n-\t     | clix* | riscos* | uniplus* | iris* | isc* | rtu* | xenix* \\\n-\t     | knetbsd* | mirbsd* | netbsd* \\\n-\t     | bitrig* | openbsd* | solidbsd* | libertybsd* \\\n-\t     | ekkobsd* | kfreebsd* | freebsd* | riscix* | lynxos* \\\n-\t     | bosx* | nextstep* | cxux* | aout* | elf* | oabi* \\\n-\t     | ptx* | coff* | ecoff* | winnt* | domain* | vsta* \\\n-\t     | udi* | eabi* | lites* | ieee* | go32* | aux* | hcos* \\\n-\t     | chorusrdb* | cegcc* | glidix* \\\n-\t     | cygwin* | msys* | pe* | moss* | proelf* | rtems* \\\n-\t     | midipix* | mingw32* | mingw64* | linux-gnu* | linux-android* \\\n-\t     | linux-newlib* | linux-musl* | linux-uclibc* \\\n-\t     | uxpv* | beos* | mpeix* | udk* | moxiebox* \\\n-\t     | interix* | uwin* | mks* | rhapsody* | darwin* \\\n-\t     | openstep* | oskit* | conix* | pw32* | nonstopux* \\\n-\t     | storm-chaos* | tops10* | tenex* | tops20* | its* \\\n-\t     | os2* | vos* | palmos* | uclinux* | nucleus* \\\n-\t     | morphos* | superux* | rtmk* | windiss* \\\n-\t     | powermax* | dnix* | nx6 | nx7 | sei* | dragonfly* \\\n-\t     | skyos* | haiku* | rdos* | toppers* | drops* | es* \\\n-\t     | onefs* | tirtos* | phoenix* | fuchsia* | redox* | bme* \\\n-\t     | midnightbsd* | amdhsa* | unleashed* | emscripten* | wasi*)\n-\t# Remember, each alternative MUST END IN *, to match a version number.\n-\t\t;;\n \tqnx*)\n-\t\tcase $cpu in\n-\t\t    x86 | i*86)\n-\t\t\t;;\n-\t\t    *)\n-\t\t\tos=nto-$os\n-\t\t\t;;\n-\t\tesac\n+\t\tos=qnx\n \t\t;;\n \thiux*)\n \t\tos=hiuxwe2\n \t\t;;\n-\tnto-qnx*)\n-\t\t;;\n-\tnto*)\n-\t\tos=`echo $os | sed -e 's|nto|nto-qnx|'`\n-\t\t;;\n-\tsim | xray | os68k* | v88r* \\\n-\t    | windows* | osx | abug | netware* | os9* \\\n-\t    | macos* | mpw* | magic* | mmixware* | mon960* | lnews*)\n-\t\t;;\n-\tlinux-dietlibc)\n-\t\tos=linux-dietlibc\n-\t\t;;\n-\tlinux*)\n-\t\tos=`echo $os | sed -e 's|linux|linux-gnu|'`\n-\t\t;;\n \tlynx*178)\n \t\tos=lynxos178\n \t\t;;\n \tlynx*5)\n \t\tos=lynxos5\n \t\t;;\n+\tlynxos*)\n+\t\t# don't get caught up in next wildcard\n+\t\t;;\n \tlynx*)\n \t\tos=lynxos\n \t\t;;\n-\tmac*)\n-\t\tos=`echo \"$os\" | sed -e 's|mac|macos|'`\n+\tmac[0-9]*)\n+\t\tos=$(echo \"$os\" | sed -e 's|mac|macos|')\n \t\t;;\n \topened*)\n \t\tos=openedition\n@@ -1417,10 +1398,10 @@ case $os in\n \t\tos=os400\n \t\t;;\n \tsunos5*)\n-\t\tos=`echo \"$os\" | sed -e 's|sunos5|solaris2|'`\n+\t\tos=$(echo \"$os\" | sed -e 's|sunos5|solaris2|')\n \t\t;;\n \tsunos6*)\n-\t\tos=`echo \"$os\" | sed -e 's|sunos6|solaris3|'`\n+\t\tos=$(echo \"$os\" | sed -e 's|sunos6|solaris3|')\n \t\t;;\n \twince*)\n \t\tos=wince\n@@ -1452,12 +1433,9 @@ case $os in\n \tns2)\n \t\tos=nextstep2\n \t\t;;\n-\tnsk*)\n-\t\tos=nsk\n-\t\t;;\n \t# Preserve the version number of sinix5.\n \tsinix5.*)\n-\t\tos=`echo $os | sed -e 's|sinix|sysv|'`\n+\t\tos=$(echo $os | sed -e 's|sinix|sysv|')\n \t\t;;\n \tsinix*)\n \t\tos=sysv4\n@@ -1480,18 +1458,12 @@ case $os in\n \tsysvr4)\n \t\tos=sysv4\n \t\t;;\n-\t# This must come after sysvr4.\n-\tsysv*)\n-\t\t;;\n \tose*)\n \t\tos=ose\n \t\t;;\n \t*mint | mint[0-9]* | *MiNT | MiNT[0-9]*)\n \t\tos=mint\n \t\t;;\n-\tzvmoe)\n-\t\tos=zvmoe\n-\t\t;;\n \tdicos*)\n \t\tos=dicos\n \t\t;;\n@@ -1508,19 +1480,11 @@ case $os in\n \t\t\t;;\n \t\tesac\n \t\t;;\n-\tnacl*)\n-\t\t;;\n-\tios)\n-\t\t;;\n-\tnone)\n-\t\t;;\n-\t*-eabi)\n-\t\t;;\n \t*)\n-\t\techo Invalid configuration \\`\"$1\"\\': system \\`\"$os\"\\' not recognized 1>&2\n-\t\texit 1\n+\t\t# No normalization, but not necessarily accepted, that comes below.\n \t\t;;\n esac\n+\n else\n \n # Here we handle the default operating systems that come with various machines.\n@@ -1533,6 +1497,7 @@ else\n # will signal an error saying that MANUFACTURER isn't an operating\n # system, and we'll never get to this point.\n \n+kernel=\n case $cpu-$vendor in\n \tscore-*)\n \t\tos=elf\n@@ -1544,7 +1509,8 @@ case $cpu-$vendor in\n \t\tos=riscix1.2\n \t\t;;\n \tarm*-rebel)\n-\t\tos=linux\n+\t\tkernel=linux\n+\t\tos=gnu\n \t\t;;\n \tarm*-semi)\n \t\tos=aout\n@@ -1601,9 +1567,6 @@ case $cpu-$vendor in\n \tmips*-*)\n \t\tos=elf\n \t\t;;\n-\tor1k-*)\n-\t\tos=-elf\n-\t\t;;\n \tor32-*)\n \t\tos=coff\n \t\t;;\n@@ -1713,84 +1676,173 @@ case $cpu-$vendor in\n \t\tos=none\n \t\t;;\n esac\n+\n fi\n \n+# Now, validate our (potentially fixed-up) OS.\n+case $os in\n+\t# Sometimes we do \"kernel-abi\", so those need to count as OSes.\n+\tmusl* | newlib* | uclibc*)\n+\t\t;;\n+\t# Likewise for \"kernel-libc\"\n+\teabi | eabihf | gnueabi | gnueabihf)\n+\t\t;;\n+\t# Now accept the basic system types.\n+\t# The portable systems comes first.\n+\t# Each alternative MUST end in a * to match a version number.\n+\tgnu* | android* | bsd* | mach* | minix* | genix* | ultrix* | irix* \\\n+\t     | *vms* | esix* | aix* | cnk* | sunos | sunos[34]* \\\n+\t     | hpux* | unos* | osf* | luna* | dgux* | auroraux* | solaris* \\\n+\t     | sym* |  plan9* | psp* | sim* | xray* | os68k* | v88r* \\\n+\t     | hiux* | abug | nacl* | netware* | windows* \\\n+\t     | os9* | macos* | osx* | ios* \\\n+\t     | mpw* | magic* | mmixware* | mon960* | lnews* \\\n+\t     | amigaos* | amigados* | msdos* | newsos* | unicos* | aof* \\\n+\t     | aos* | aros* | cloudabi* | sortix* | twizzler* \\\n+\t     | nindy* | vxsim* | vxworks* | ebmon* | hms* | mvs* \\\n+\t     | clix* | riscos* | uniplus* | iris* | isc* | rtu* | xenix* \\\n+\t     | mirbsd* | netbsd* | dicos* | openedition* | ose* \\\n+\t     | bitrig* | openbsd* | solidbsd* | libertybsd* | os108* \\\n+\t     | ekkobsd* | freebsd* | riscix* | lynxos* | os400* \\\n+\t     | bosx* | nextstep* | cxux* | aout* | elf* | oabi* \\\n+\t     | ptx* | coff* | ecoff* | winnt* | domain* | vsta* \\\n+\t     | udi* | lites* | ieee* | go32* | aux* | hcos* \\\n+\t     | chorusrdb* | cegcc* | glidix* \\\n+\t     | cygwin* | msys* | pe* | moss* | proelf* | rtems* \\\n+\t     | midipix* | mingw32* | mingw64* | mint* \\\n+\t     | uxpv* | beos* | mpeix* | udk* | moxiebox* \\\n+\t     | interix* | uwin* | mks* | rhapsody* | darwin* \\\n+\t     | openstep* | oskit* | conix* | pw32* | nonstopux* \\\n+\t     | storm-chaos* | tops10* | tenex* | tops20* | its* \\\n+\t     | os2* | vos* | palmos* | uclinux* | nucleus* | morphos* \\\n+\t     | scout* | superux* | sysv* | rtmk* | tpf* | windiss* \\\n+\t     | powermax* | dnix* | nx6 | nx7 | sei* | dragonfly* \\\n+\t     | skyos* | haiku* | rdos* | toppers* | drops* | es* \\\n+\t     | onefs* | tirtos* | phoenix* | fuchsia* | redox* | bme* \\\n+\t     | midnightbsd* | amdhsa* | unleashed* | emscripten* | wasi* \\\n+\t     | nsk* | powerunix* | genode* | zvmoe* | qnx* | emx*)\n+\t\t;;\n+\t# This one is extra strict with allowed versions\n+\tsco3.2v2 | sco3.2v[4-9]* | sco5v6*)\n+\t\t# Don't forget version if it is 3.2v4 or newer.\n+\t\t;;\n+\tnone)\n+\t\t;;\n+\t*)\n+\t\techo Invalid configuration \\`\"$1\"\\': OS \\`\"$os\"\\' not recognized 1>&2\n+\t\texit 1\n+\t\t;;\n+esac\n+\n+# As a final step for OS-related things, validate the OS-kernel combination\n+# (given a valid OS), if there is a kernel.\n+case $kernel-$os in\n+\tlinux-gnu* | linux-dietlibc* | linux-android* | linux-newlib* | linux-musl* | linux-uclibc* )\n+\t\t;;\n+\tuclinux-uclibc* )\n+\t\t;;\n+\t-dietlibc* | -newlib* | -musl* | -uclibc* )\n+\t\t# These are just libc implementations, not actual OSes, and thus\n+\t\t# require a kernel.\n+\t\techo \"Invalid configuration \\`$1': libc \\`$os' needs explicit kernel.\" 1>&2\n+\t\texit 1\n+\t\t;;\n+\tkfreebsd*-gnu* | kopensolaris*-gnu*)\n+\t\t;;\n+\tnto-qnx*)\n+\t\t;;\n+\tos2-emx)\n+\t\t;;\n+\t*-eabi* | *-gnueabi*)\n+\t\t;;\n+\t-*)\n+\t\t# Blank kernel with real OS is always fine.\n+\t\t;;\n+\t*-*)\n+\t\techo \"Invalid configuration \\`$1': Kernel \\`$kernel' not known to work with OS \\`$os'.\" 1>&2\n+\t\texit 1\n+\t\t;;\n+esac\n+\n # Here we handle the case where we know the os, and the CPU type, but not the\n # manufacturer.  We pick the logical manufacturer.\n case $vendor in\n \tunknown)\n-\t\tcase $os in\n-\t\t\triscix*)\n+\t\tcase $cpu-$os in\n+\t\t\t*-riscix*)\n \t\t\t\tvendor=acorn\n \t\t\t\t;;\n-\t\t\tsunos*)\n+\t\t\t*-sunos*)\n \t\t\t\tvendor=sun\n \t\t\t\t;;\n-\t\t\tcnk*|-aix*)\n+\t\t\t*-cnk* | *-aix*)\n \t\t\t\tvendor=ibm\n \t\t\t\t;;\n-\t\t\tbeos*)\n+\t\t\t*-beos*)\n \t\t\t\tvendor=be\n \t\t\t\t;;\n-\t\t\thpux*)\n+\t\t\t*-hpux*)\n \t\t\t\tvendor=hp\n \t\t\t\t;;\n-\t\t\tmpeix*)\n+\t\t\t*-mpeix*)\n \t\t\t\tvendor=hp\n \t\t\t\t;;\n-\t\t\thiux*)\n+\t\t\t*-hiux*)\n \t\t\t\tvendor=hitachi\n \t\t\t\t;;\n-\t\t\tunos*)\n+\t\t\t*-unos*)\n \t\t\t\tvendor=crds\n \t\t\t\t;;\n-\t\t\tdgux*)\n+\t\t\t*-dgux*)\n \t\t\t\tvendor=dg\n \t\t\t\t;;\n-\t\t\tluna*)\n+\t\t\t*-luna*)\n \t\t\t\tvendor=omron\n \t\t\t\t;;\n-\t\t\tgenix*)\n+\t\t\t*-genix*)\n \t\t\t\tvendor=ns\n \t\t\t\t;;\n-\t\t\tclix*)\n+\t\t\t*-clix*)\n \t\t\t\tvendor=intergraph\n \t\t\t\t;;\n-\t\t\tmvs* | opened*)\n+\t\t\t*-mvs* | *-opened*)\n+\t\t\t\tvendor=ibm\n+\t\t\t\t;;\n+\t\t\t*-os400*)\n \t\t\t\tvendor=ibm\n \t\t\t\t;;\n-\t\t\tos400*)\n+\t\t\ts390-* | s390x-*)\n \t\t\t\tvendor=ibm\n \t\t\t\t;;\n-\t\t\tptx*)\n+\t\t\t*-ptx*)\n \t\t\t\tvendor=sequent\n \t\t\t\t;;\n-\t\t\ttpf*)\n+\t\t\t*-tpf*)\n \t\t\t\tvendor=ibm\n \t\t\t\t;;\n-\t\t\tvxsim* | vxworks* | windiss*)\n+\t\t\t*-vxsim* | *-vxworks* | *-windiss*)\n \t\t\t\tvendor=wrs\n \t\t\t\t;;\n-\t\t\taux*)\n+\t\t\t*-aux*)\n \t\t\t\tvendor=apple\n \t\t\t\t;;\n-\t\t\thms*)\n+\t\t\t*-hms*)\n \t\t\t\tvendor=hitachi\n \t\t\t\t;;\n-\t\t\tmpw* | macos*)\n+\t\t\t*-mpw* | *-macos*)\n \t\t\t\tvendor=apple\n \t\t\t\t;;\n-\t\t\t*mint | mint[0-9]* | *MiNT | MiNT[0-9]*)\n+\t\t\t*-*mint | *-mint[0-9]* | *-*MiNT | *-MiNT[0-9]*)\n \t\t\t\tvendor=atari\n \t\t\t\t;;\n-\t\t\tvos*)\n+\t\t\t*-vos*)\n \t\t\t\tvendor=stratus\n \t\t\t\t;;\n \t\tesac\n \t\t;;\n esac\n \n-echo \"$cpu-$vendor-$os\"\n+echo \"$cpu-$vendor-${kernel:+$kernel-}$os\"\n exit\n \n # Local variables:"
    },
    {
      "sha": "661355d32b2db3a535c87032152df602eb515404",
      "filename": "readline/readline/support/shlib-install",
      "status": "modified",
      "additions": 2,
      "deletions": 34,
      "changes": 36,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/shlib-install",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/shlib-install",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/support/shlib-install?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -17,7 +17,7 @@ LDCONFIG=ldconfig\n PROGNAME=`basename $0`\n USAGE=\"$PROGNAME [-D] -O host_os [-V host_vendor] -d installation-dir [-b bin-dir] -i install-prog [-U] library\"\n \n-# process options\n+# process options - should use getopts\n \n while [ $# -gt 0 ]; do\n \tcase \"$1\" in\n@@ -118,7 +118,7 @@ INSTALL_LINK2='${echo} cd $INSTALLDIR && ${echo} ${LN} $LIBNAME $LINK2'\n # Create symlinks to the installed library.  This section is incomplete.\n #\n case \"$host_os-$host_vendor\" in\n-*linux*|freebsd*-gentoo)\n+*linux*|freebsd*|dragonfly*)\n \t# libname.so.M -> libname.so.M.N\n \t${echo} ${RM} ${INSTALLDIR}/$LINK2\n \tif [ -z \"$uninstall\" ]; then\n@@ -154,38 +154,6 @@ solaris2*|aix4.[2-9]*|aix[5-9]*|osf*|irix[56]*|sysv[45]*|dgux*|interix*)\n \tfi\n \t;;\n \n-\n-# FreeBSD 3.x and above can have either a.out or ELF shared libraries\n-freebsd3*|freebsdaout*)\n-\tif [ -x /usr/bin/objformat ] && [ \"`/usr/bin/objformat`\" = \"elf\" ]; then\n-\t\t# libname.so -> libname.so.M\n-\t\t${echo} ${RM} ${INSTALLDIR}/$LINK1\n-\t\tif [ -z \"$uninstall\" ]; then\n-\t\t\teval $INSTALL_LINK1\n-\t\tfi\n-\telse\n-\t\t# libname.so.M -> libname.so.M.N\n-\t\t${echo} ${RM} ${INSTALLDIR}/$LINK2\n-\t\tif [ -z \"$uninstall\" ]; then\n-\t\t\teval $INSTALL_LINK2\n-\t\tfi\n-\n-\t\t# libname.so -> libname.so.M.N\n-\t\t${echo} ${RM} ${INSTALLDIR}/$LINK1\n-\t\tif [ -z \"$uninstall\" ]; then\n-\t\t\teval $INSTALL_LINK1\n-\t\tfi\n-\tfi\n-\t;;\n-\n-freebsd[4-9]*|freebsd1[0-9]*|freebsdelf*|dragonfly*)\n-\t# libname.so -> libname.so.M\n-\t${echo} ${RM} ${INSTALLDIR}/$LINK1\n-\tif [ -z \"$uninstall\" ]; then\n-\t\teval $INSTALL_LINK1\n-\tfi\n-\t;;\n-\t\n hpux1*)\n \t# libname.sl -> libname.M\n \t${echo} ${RM} ${INSTALLDIR}/$LINK1.sl"
    },
    {
      "sha": "5a3f9776e910ba0bc8e521effca06989bd984903",
      "filename": "readline/readline/support/shobj-conf",
      "status": "modified",
      "additions": 9,
      "deletions": 50,
      "changes": 59,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/shobj-conf",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/support/shobj-conf",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/support/shobj-conf?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -10,7 +10,7 @@\n # Chet Ramey\n # chet@po.cwru.edu\n \n-#   Copyright (C) 1996-2014 Free Software Foundation, Inc.\n+#   Copyright (C) 1996-2019 Free Software Foundation, Inc.\n #\n #   This file is part of GNU Bash, the Bourne Again SHell.\n #\n@@ -65,7 +65,7 @@ while [ $# -gt 0 ]; do\n done\n \n case \"${host_os}-${SHOBJ_CC}-${host_vendor}\" in\n-nsk-cc-tandem)\n+nsk-cc-tandem|nsk-c99-tandem)\n \tSHOBJ_CFLAGS=-Wglobalized\n \tcase `uname -m` in\n \tNSR*)\n@@ -123,7 +123,7 @@ sunos5*|solaris2*)\n \t;;\n \n # All versions of Linux (including Gentoo/FreeBSD) or the semi-mythical GNU Hurd.\n-linux*-*|gnu*-*|k*bsd*-gnu-*|freebsd*-gentoo)\n+linux*-*|gnu*-*|k*bsd*-gnu-*|freebsd*|dragonfly*)\n \tSHOBJ_CFLAGS=-fPIC\n \tSHOBJ_LD='${CC}'\n \tSHOBJ_LDFLAGS='-shared -Wl,-soname,$@'\n@@ -132,44 +132,6 @@ linux*-*|gnu*-*|k*bsd*-gnu-*|freebsd*-gentoo)\n \tSHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)$(SHLIB_MINOR)'\n \t;;\n \n-freebsd2*)\n-\tSHOBJ_CFLAGS=-fpic\n-\tSHOBJ_LD=ld\n-\tSHOBJ_LDFLAGS='-x -Bshareable'\n-\n-\tSHLIB_XLDFLAGS='-R$(libdir)'\n-\tSHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)$(SHLIB_MINOR)'\n-\t;;\n-\n-# FreeBSD-3.x ELF\n-freebsd3*|freebsdaout*)\n-\tSHOBJ_CFLAGS=-fPIC\n-\tSHOBJ_LD='${CC}'\n-\n-\tif [ -x /usr/bin/objformat ] && [ \"`/usr/bin/objformat`\" = \"elf\" ]; then\n-\t\tSHOBJ_LDFLAGS='-shared -Wl,-soname,$@'\n-\n-\t\tSHLIB_XLDFLAGS='-Wl,-rpath,$(libdir)'\n-\t\tSHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)'\n-\telse\n-\t\tSHOBJ_LDFLAGS='-shared'\n-\n-\t\tSHLIB_XLDFLAGS='-R$(libdir)'\n-\t\tSHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)$(SHLIB_MINOR)'\n-\tfi\n-\t;;\n-\n-# FreeBSD-4.x and later have only ELF\n-freebsd[4-9]*|freebsd1[0-9]*|freebsdelf*|dragonfly*)\n-\tSHOBJ_CFLAGS=-fPIC\n-\tSHOBJ_LD='${CC}'\n-\n-\tSHOBJ_LDFLAGS='-shared -Wl,-soname,$@'\n-\tSHLIB_XLDFLAGS='-Wl,-rpath,$(libdir)'\n-\n-\tSHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)'\n-\t;;\n-\n # Darwin/MacOS X\n darwin*)\n \t# Common definitions for all darwin/mac os x versions\n@@ -402,18 +364,15 @@ hpux11*)\n \tSHLIB_STATUS=unsupported\n \n \t# If you are using the HP ANSI C compiler, you can uncomment and use\n-\t# this code (I have not tested it)\n-#\tSHOBJ_STATUS=supported\n-#\tSHLIB_STATUS=supported\n-#\n+\t# this code from michael.osipov@siemens.com (I have not tested it)\n #\tSHOBJ_CFLAGS='+z'\n-#\tSHOBJ_LD='ld'\n-#\tSHOBJ_LDFLAGS='-b +s +h $@'\n+#\tSHOBJ_LD='$(CC)'\n+#\tSHOBJ_LDFLAGS='-b -Wl,+s -Wl,+h,$@'\n #\n-#\tSHLIB_XLDFLAGS='+b $(libdir)'\n-#\tSHLIB_LIBSUFF='sl'\n+#\tSHLIB_XLDFLAGS='-Wl,+b,$(libdir)'\n+#\tSHLIB_LIBSUFF='so'\n #\tSHLIB_LIBVERSION='$(SHLIB_LIBSUFF).$(SHLIB_MAJOR)'\t\n-\n+#\tSHLIB_LIBS='$(TERMCAP_LIB)'\n \t;;\n \n sysv4*-*gcc*)"
    },
    {
      "sha": "05415dc42de1dca338d4047b168bc8b5aedd12ae",
      "filename": "readline/readline/terminal.c",
      "status": "modified",
      "additions": 71,
      "deletions": 5,
      "changes": 76,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/terminal.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/terminal.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/terminal.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -152,6 +152,10 @@ static int term_has_meta;\n static char *_rl_term_mm;\n static char *_rl_term_mo;\n \n+/* The sequences to enter and exit standout mode. */\n+static char *_rl_term_so;\n+static char *_rl_term_se;\n+\n /* The key sequences output by the arrow keys, if this terminal has any. */\n static char *_rl_term_ku;\n static char *_rl_term_kd;\n@@ -177,6 +181,19 @@ static char *_rl_term_kI;\n static char *_rl_term_vs;\t/* very visible */\n static char *_rl_term_ve;\t/* normal */\n \n+/* It's not clear how HPUX is so broken here. */\n+#ifdef TGETENT_BROKEN\n+#  define TGETENT_SUCCESS 0\n+#else\n+#  define TGETENT_SUCCESS 1\n+#endif\n+#ifdef TGETFLAG_BROKEN\n+#  define TGETFLAG_SUCCESS 0\n+#else\n+#  define TGETFLAG_SUCCESS 1\n+#endif\n+#define TGETFLAG(cap)\t(tgetflag (cap) == TGETFLAG_SUCCESS)\n+\n static void bind_termcap_arrow_keys PARAMS((Keymap));\n \n /* Variables that hold the screen dimensions, used by the display code. */\n@@ -410,6 +427,8 @@ static const struct _tc_string tc_strings[] =\n   { \"mo\", &_rl_term_mo },\n   { \"nd\", &_rl_term_forward_char },\n   { \"pc\", &_rl_term_pc },\n+  { \"se\", &_rl_term_se },\n+  { \"so\", &_rl_term_so },\n   { \"up\", &_rl_term_up },\n   { \"vb\", &_rl_visible_bell },\n   { \"vs\", &_rl_term_vs },\n@@ -437,7 +456,7 @@ _rl_init_terminal_io (const char *terminal_name)\n {\n   const char *term;\n   char *buffer;\n-  int tty, tgetent_ret;\n+  int tty, tgetent_ret, dumbterm;\n \n   term = terminal_name ? terminal_name : sh_get_env_value (\"TERM\");\n   _rl_term_clrpag = _rl_term_cr = _rl_term_clreol = _rl_term_clrscroll = (char *)NULL;\n@@ -446,6 +465,8 @@ _rl_init_terminal_io (const char *terminal_name)\n   if (term == 0)\n     term = \"dumb\";\n \n+  dumbterm = STREQ (term, \"dumb\");\n+\n #ifdef __MSDOS__\n   _rl_term_im = _rl_term_ei = _rl_term_ic = _rl_term_IC = (char *)NULL;\n   _rl_term_up = _rl_term_dc = _rl_term_DC = _rl_visible_bell = (char *)NULL;\n@@ -457,6 +478,7 @@ _rl_init_terminal_io (const char *terminal_name)\n   _rl_term_goto = _rl_term_pc = _rl_term_ip = (char *)NULL;\n   _rl_term_ks = _rl_term_ke =_rl_term_vs = _rl_term_ve = (char *)NULL;\n   _rl_term_kh = _rl_term_kH = _rl_term_at7 = _rl_term_kI = (char *)NULL;\n+  _rl_term_so = _rl_term_se = (char *)NULL;\n #if defined(HACK_TERMCAP_MOTION)\n   _rl_term_forward_char = (char *)NULL;\n #endif\n@@ -483,7 +505,7 @@ _rl_init_terminal_io (const char *terminal_name)\n       tgetent_ret = tgetent (term_buffer, term);\n     }\n \n-  if (tgetent_ret <= 0)\n+  if (tgetent_ret != TGETENT_SUCCESS)\n     {\n       FREE (term_string_buffer);\n       FREE (term_buffer);\n@@ -521,8 +543,13 @@ _rl_init_terminal_io (const char *terminal_name)\n       _rl_term_mm = _rl_term_mo = (char *)NULL;\n       _rl_term_ve = _rl_term_vs = (char *)NULL;\n       _rl_term_forward_char = (char *)NULL;\n+      _rl_term_so = _rl_term_se = (char *)NULL;\n       _rl_terminal_can_insert = term_has_meta = 0;\n \n+      /* Assume generic unknown terminal can't handle the enable/disable\n+\t escape sequences */\n+      _rl_enable_bracketed_paste = 0;\n+\n       /* Reasonable defaults for tgoto().  Readline currently only uses\n          tgoto if _rl_term_IC or _rl_term_DC is defined, but just in case we\n          change that later... */\n@@ -541,10 +568,10 @@ _rl_init_terminal_io (const char *terminal_name)\n   BC = _rl_term_backspace;\n   UP = _rl_term_up;\n \n-  if (!_rl_term_cr)\n+  if (_rl_term_cr == 0)\n     _rl_term_cr = \"\\r\";\n \n-  _rl_term_autowrap = tgetflag (\"am\") && tgetflag (\"xn\");\n+  _rl_term_autowrap = TGETFLAG (\"am\") && TGETFLAG (\"xn\");\n \n   /* Allow calling application to set default height and width, using\n      rl_set_screen_size */\n@@ -559,7 +586,7 @@ _rl_init_terminal_io (const char *terminal_name)\n \n   /* Check to see if this terminal has a meta key and clear the capability\n      variables if there is none. */\n-  term_has_meta = tgetflag (\"km\") != 0;\n+  term_has_meta = TGETFLAG (\"km\");\n   if (term_has_meta == 0)\n     _rl_term_mm = _rl_term_mo = (char *)NULL;\n #endif /* !__MSDOS__ */\n@@ -574,6 +601,11 @@ _rl_init_terminal_io (const char *terminal_name)\n   bind_termcap_arrow_keys (vi_insertion_keymap);\n #endif /* VI_MODE */\n \n+  /* There's no way to determine whether or not a given terminal supports\n+     bracketed paste mode, so we assume a terminal named \"dumb\" does not. */\n+  if (dumbterm)\n+    _rl_enable_bracketed_paste = 0;\n+    \n   return 0;\n }\n \n@@ -676,6 +708,16 @@ rl_crlf (void)\n   return 0;\n }\n \n+void\n+_rl_cr (void)\n+{\n+#if defined (__MSDOS__)\n+  putc ('\\r', rl_outstream);\n+#else\n+  tputs (_rl_term_cr, 1, _rl_output_character_function);\n+#endif\n+}\n+\n /* Ring the terminal bell. */\n int\n rl_ding (void)\n@@ -708,6 +750,30 @@ rl_ding (void)\n   return (-1);\n }\n \n+/* **************************************************************** */\n+/*\t\t\t\t\t\t\t\t    */\n+/*\t\tEntering and leaving terminal standout mode\t    */\n+/*\t\t\t\t\t\t\t\t    */\n+/* **************************************************************** */\n+\n+void\n+_rl_standout_on (void)\n+{\n+#ifndef __MSDOS__\n+  if (_rl_term_so && _rl_term_se)\n+    tputs (_rl_term_so, 1, _rl_output_character_function);\n+#endif\n+}\n+\n+void\n+_rl_standout_off (void)\n+{\n+#ifndef __MSDOS__\n+  if (_rl_term_so && _rl_term_se)\n+    tputs (_rl_term_se, 1, _rl_output_character_function);\n+#endif\n+}\n+\n /* **************************************************************** */\n /*\t\t\t\t\t\t\t\t    */\n /*\t \tControlling the Meta Key and Keypad\t\t    */"
    },
    {
      "sha": "2567dea268ae2412dda65d9c9fbd898e1ac11e86",
      "filename": "readline/readline/text.c",
      "status": "modified",
      "additions": 85,
      "deletions": 20,
      "changes": 105,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/text.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/text.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/text.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* text.c -- text handling commands for readline. */\n \n-/* Copyright (C) 1987-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -154,6 +154,7 @@ rl_delete_text (int from, int to)\n \n   rl_end -= diff;\n   rl_line_buffer[rl_end] = '\\0';\n+  _rl_fix_mark ();\n   return (diff);\n }\n \n@@ -176,6 +177,12 @@ _rl_fix_point (int fix_mark_too)\n   if (fix_mark_too)\n     _RL_FIX_POINT (rl_mark);\n }\n+\n+void\n+_rl_fix_mark (void)\n+{\n+  _RL_FIX_POINT (rl_mark);\n+}\n #undef _RL_FIX_POINT\n \n /* Replace the contents of the line buffer between START and END with\n@@ -479,6 +486,8 @@ rl_forward_word (int count, int key)\n \n   while (count)\n     {\n+      if (rl_point > rl_end)\n+\trl_point = rl_end;\n       if (rl_point == rl_end)\n \treturn 0;\n \n@@ -498,6 +507,8 @@ rl_forward_word (int count, int key)\n \t    }\n \t}\n \n+      if (rl_point > rl_end)\n+\trl_point = rl_end;\n       if (rl_point == rl_end)\n \treturn 0;\n \n@@ -569,18 +580,8 @@ rl_backward_word (int count, int key)\n int\n rl_refresh_line (int ignore1, int ignore2)\n {\n-  int curr_line;\n-\n-  curr_line = _rl_current_display_line ();\n-\n-  _rl_move_vert (curr_line);\n-  _rl_move_cursor_relative (0, rl_line_buffer);   /* XXX is this right */\n-\n-  _rl_clear_to_eol (0);\t\t/* arg of 0 means to not use spaces */\n-\n-  rl_redraw_prompt_last_line ();\n+  _rl_refresh_line ();\n   rl_display_fixed = 1;\n-\n   return 0;\n }\n \n@@ -596,7 +597,18 @@ rl_clear_screen (int count, int key)\n       return 0;\n     }\n \n-  _rl_clear_screen ();\t\t/* calls termcap function to clear screen */\n+  _rl_clear_screen (0);\t\t/* calls termcap function to clear screen */\n+  rl_keep_mark_active ();\n+  rl_forced_update_display ();\n+  rl_display_fixed = 1;\n+\n+  return 0;\n+}\n+\n+int\n+rl_clear_display (int count, int key)\n+{\n+  _rl_clear_screen (1);\t\t/* calls termcap function to clear screen and scrollback buffer */\n   rl_forced_update_display ();\n   rl_display_fixed = 1;\n \n@@ -1080,6 +1092,13 @@ rl_tab_insert (int count, int key)\n int\n rl_newline (int count, int key)\n {\n+  if (rl_mark_active_p ())\n+    {\n+      rl_deactivate_mark ();\n+      (*rl_redisplay_function) ();\n+      _rl_want_redisplay = 0;\n+    }\n+\n   rl_done = 1;\n \n   if (_rl_history_preserve_point)\n@@ -1452,7 +1471,18 @@ rl_change_case (int count, int op)\n \t  if  (nwc != wc)\t/*  just skip unchanged characters */\n \t    {\n \t      char *s, *e;\n-\t      mlen = wcrtomb (mb, nwc, &mps);\n+\t      mbstate_t ts;\n+\n+\t      memset (&ts, 0, sizeof (mbstate_t));\n+\t      mlen = wcrtomb (mb, nwc, &ts);\n+\t      if (mlen < 0)\n+\t\t{\n+\t\t  nwc = wc;\n+\t\t  memset (&ts, 0, sizeof (mbstate_t));\n+\t\t  mlen = wcrtomb (mb, nwc, &ts);\n+\t\t  if (mlen < 0)\t\t/* should not happen */\n+\t\t    strncpy (mb, rl_line_buffer + start, mlen = m);\n+\t\t}\n \t      if (mlen > 0)\n \t\tmb[mlen] = '\\0';\n \t      /* what to do if m != mlen? adjust below */\n@@ -1472,7 +1502,9 @@ rl_change_case (int count, int op)\n \t\t}\n \t      else if (m < mlen)\n \t\t{\n-\t\t  rl_extend_line_buffer (mlen - m + 1);\n+\t\t  rl_extend_line_buffer (rl_end + mlen + (e - s) - m + 2);\n+\t\t  s = rl_line_buffer + start;\t/* have to redo this */\n+\t\t  e = rl_line_buffer + rl_end;\n \t\t  memmove (s + mlen, s + m, (e - s) - m);\n \t\t  memcpy (s, mb, mlen);\n \t\t  next += mlen - m;\t/* next char changes */\n@@ -1711,10 +1743,7 @@ _rl_char_search (int count, int fdir, int bdir)\n {\n   int c;\n \n-  RL_SETSTATE(RL_STATE_MOREINPUT);\n-  c = rl_read_key ();\n-  RL_UNSETSTATE(RL_STATE_MOREINPUT);\n-\n+  c = _rl_bracketed_read_key ();\n   if (c < 0)\n     return 1;\n \n@@ -1809,7 +1838,43 @@ rl_exchange_point_and_mark (int count, int key)\n       return 1;\n     }\n   else\n-    SWAP (rl_point, rl_mark);\n+    {\n+      SWAP (rl_point, rl_mark);\n+      rl_activate_mark ();\n+    }\n \n   return 0;\n }\n+\n+/* Active mark support */\n+\n+/* Is the region active? */\n+static int mark_active = 0;\n+\n+/* Does the current command want the mark to remain active when it completes? */\n+int _rl_keep_mark_active;\n+\n+void\n+rl_keep_mark_active (void)\n+{\n+  _rl_keep_mark_active++;\n+}\n+\n+void\n+rl_activate_mark (void)\n+{\n+  mark_active = 1;\n+  rl_keep_mark_active ();\n+}\n+\n+void\n+rl_deactivate_mark (void)\n+{\n+  mark_active = 0;\n+}\n+\n+int\n+rl_mark_active_p (void)\n+{\n+  return (mark_active);\n+}"
    },
    {
      "sha": "d678a31ab2735a95b60906fd979e60cfe63c8056",
      "filename": "readline/readline/tilde.c",
      "status": "modified",
      "additions": 9,
      "deletions": 9,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/tilde.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/tilde.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/tilde.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,6 +1,6 @@\n /* tilde.c -- Tilde expansion code (~/foo := $HOME/foo). */\n \n-/* Copyright (C) 1988-2017 Free Software Foundation, Inc.\n+/* Copyright (C) 1988-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.\n@@ -57,10 +57,10 @@ static void *xmalloc (), *xrealloc ();\n \n #if !defined (HAVE_GETPW_DECLS)\n #  if defined (HAVE_GETPWUID)\n-extern struct passwd *getpwuid PARAMS((uid_t));\n+extern struct passwd *getpwuid (uid_t);\n #  endif\n #  if defined (HAVE_GETPWNAM)\n-extern struct passwd *getpwnam PARAMS((const char *));\n+extern struct passwd *getpwnam (const char *);\n #  endif\n #endif /* !HAVE_GETPW_DECLS */\n \n@@ -79,8 +79,8 @@ extern struct passwd *getpwnam PARAMS((const char *));\n /* If being compiled as part of bash, these will be satisfied from\n    variables.o.  If being compiled as part of readline, they will\n    be satisfied from shell.o. */\n-extern char *sh_get_home_dir PARAMS((void));\n-extern char *sh_get_env_value PARAMS((const char *));\n+extern char *sh_get_home_dir (void);\n+extern char *sh_get_env_value (const char *);\n \n /* The default value of tilde_additional_prefixes.  This is set to\n    whitespace preceding a tilde so that simple programs which do not\n@@ -116,10 +116,10 @@ char **tilde_additional_prefixes = (char **)default_prefixes;\n    `:' and `=~'. */\n char **tilde_additional_suffixes = (char **)default_suffixes;\n \n-static int tilde_find_prefix PARAMS((const char *, int *));\n-static int tilde_find_suffix PARAMS((const char *));\n-static char *isolate_tilde_prefix PARAMS((const char *, int *));\n-static char *glue_prefix_and_suffix PARAMS((char *, const char *, int));\n+static int tilde_find_prefix (const char *, int *);\n+static int tilde_find_suffix (const char *);\n+static char *isolate_tilde_prefix (const char *, int *);\n+static char *glue_prefix_and_suffix (char *, const char *, int);\n \n /* Find the start of a tilde expansion in STRING, and return the index of\n    the tilde which starts the expansion.  Place the length of the text"
    },
    {
      "sha": "147999119a6123532e8d932f2ccb1783e4c1a7a7",
      "filename": "readline/readline/undo.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/undo.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/undo.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/undo.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -196,6 +196,7 @@ rl_do_undo (void)\n \t/* Undoing deletes means inserting some text. */\n \tcase UNDO_DELETE:\n \t  rl_point = start;\n+\t  _rl_fix_point (1);\n \t  rl_insert_text (rl_undo_list->text);\n \t  xfree (rl_undo_list->text);\n \t  break;\n@@ -204,6 +205,7 @@ rl_do_undo (void)\n \tcase UNDO_INSERT:\n \t  rl_delete_text (start, end);\n \t  rl_point = start;\n+\t  _rl_fix_point (1);\n \t  break;\n \n \t/* Undoing an END means undoing everything 'til we get to a BEGIN. */"
    },
    {
      "sha": "1576b55d50d53cf2a61b32a879697b9a338f5647",
      "filename": "readline/readline/util.c",
      "status": "modified",
      "additions": 8,
      "deletions": 10,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/util.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/util.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/util.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -102,10 +102,11 @@ _rl_abort_internal (void)\n   rl_clear_message ();\n   _rl_reset_argument ();\n   rl_clear_pending_input ();\n+  rl_deactivate_mark ();\n \n-  RL_UNSETSTATE (RL_STATE_MACRODEF);\n   while (rl_executing_macro)\n     _rl_pop_executing_macro ();\n+  _rl_kill_kbd_macro ();\n \n   RL_UNSETSTATE (RL_STATE_MULTIKEY);\t/* XXX */\n \n@@ -502,17 +503,14 @@ _rl_tropen (void)\n   if (_rl_tracefp)\n     fclose (_rl_tracefp);\n #if defined (_WIN32) && !defined (__CYGWIN__)\n-  /* Windows doesn't have /var/tmp, so open the trace file in the\n-     user's temporary directory instead.  */\n-  snprintf (fnbuf, sizeof (fnbuf), \"%s/rltrace.%ld\",\n-\t   (sh_get_env_value (\"TEMP\")\n-\t    ? sh_get_env_value (\"TEMP\")\n-\t    : \".\"),\n-\t   getpid ());\n+  x = sh_get_env_value (\"TEMP\");\n+  if (x == 0)\n+    x = \".\";\n #else\n-  sprintf (fnbuf, \"/var/tmp/rltrace.%ld\", (long) getpid ());\n+  x = \"/var/tmp\";\n #endif\n-  unlink (fnbuf);\n+  snprintf (fnbuf, sizeof (fnbuf), \"%s/rltrace.%ld\", x, (long)getpid());\n+  unlink(fnbuf);\n   _rl_tracefp = fopen (fnbuf, \"w+\");\n   return _rl_tracefp != 0;\n }"
    },
    {
      "sha": "742341e362836fb72f361465856992e586a0fb6a",
      "filename": "readline/readline/vi_mode.c",
      "status": "modified",
      "additions": 138,
      "deletions": 44,
      "changes": 182,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/vi_mode.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b4f26d541aa7224b70d363932e816e6e1a857633/readline/readline/vi_mode.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/readline/readline/vi_mode.c?ref=b4f26d541aa7224b70d363932e816e6e1a857633",
      "patch": "@@ -1,7 +1,7 @@\n /* vi_mode.c -- A vi emulation mode for Bash.\n    Derived from code written by Jeff Sparkes (jsparkes@bnr.ca).  */\n \n-/* Copyright (C) 1987-2018 Free Software Foundation, Inc.\n+/* Copyright (C) 1987-2020 Free Software Foundation, Inc.\n \n    This file is part of the GNU Readline Library (Readline), a library\n    for reading lines of text with interactive input and history editing.      \n@@ -298,6 +298,11 @@ rl_vi_redo (int count, int c)\n       if (rl_point > 0)\n \t_rl_vi_backup ();\n     }\n+  else if (_rl_vi_last_command == '.' && _rl_keymap == vi_movement_keymap)\n+    {\n+      rl_ding ();\n+      r = 0;\n+    }\n   else\n     r = _rl_dispatch (_rl_vi_last_command, _rl_keymap);\n \n@@ -320,9 +325,9 @@ rl_vi_yank_arg (int count, int key)\n   /* Readline thinks that the first word on a line is the 0th, while vi\n      thinks the first word on a line is the 1st.  Compensate. */\n   if (rl_explicit_arg)\n-    rl_yank_nth_arg (count - 1, 0);\n+    rl_yank_nth_arg (count - 1, key);\n   else\n-    rl_yank_nth_arg ('$', 0);\n+    rl_yank_nth_arg ('$', key);\n \n   return (0);\n }\n@@ -837,6 +842,12 @@ _rl_vi_save_replace (void)\n   start = end - vi_replace_count + 1;\n   len = vi_replace_count + 1;\n \n+  if (start < 0)\n+    {\n+      len = end + 1;\n+      start = 0;\n+    }\n+\n   vi_save_insert_buffer (start, len);  \n }\n \n@@ -864,8 +875,8 @@ _rl_vi_done_inserting (void)\n {\n   if (_rl_vi_doing_insert)\n     {\n-      /* The `C', `s', and `S' commands set this. */\n-      rl_end_undo_group ();\n+      /* The `c', `s', `S', and `R' commands set this. */\n+      rl_end_undo_group ();\t/* for the group in rl_vi_start_inserting */\n       /* Now, the text between rl_undo_list->next->start and\n \t rl_undo_list->next->end is what was inserted while in insert\n \t mode.  It gets copied to VI_INSERT_BUFFER because it depends\n@@ -876,7 +887,9 @@ _rl_vi_done_inserting (void)\n \t_rl_vi_save_replace ();\t\t/* Half the battle */\n       else\n \t_rl_vi_save_insert (rl_undo_list->next);\n-      vi_continued_command = 1;\n+      /* sanity check, should always be >= 1 here */\n+      if (_rl_undo_group_level > 0)\n+\trl_end_undo_group ();\t/* for the group in the command (change or replace) */\n     }\n   else\n     {\n@@ -888,10 +901,12 @@ _rl_vi_done_inserting (void)\n       /* XXX - Other keys probably need to be checked. */\n       else if (_rl_vi_last_key_before_insert == 'C')\n \trl_end_undo_group ();\n-      while (_rl_undo_group_level > 0)\n-\trl_end_undo_group ();\n-      vi_continued_command = 0;\n     }\n+\n+  /* Sanity check, make sure all the undo groups are closed before we leave\n+     insert mode */\n+  while (_rl_undo_group_level > 0)\n+    rl_end_undo_group ();\n }\n \n int\n@@ -1162,6 +1177,7 @@ rl_domove_motion_callback (_rl_vimotion_cxt *m)\n   /* Append a blank character temporarily so that the motion routines\n      work right at the end of the line.  Original value of rl_end is saved\n      as m->end. */\n+  rl_extend_line_buffer (rl_end + 1);\n   rl_line_buffer[rl_end++] = ' ';\n   rl_line_buffer[rl_end] = '\\0';\n \n@@ -1193,12 +1209,15 @@ _rl_vi_domove_motion_cleanup (int c, _rl_vimotion_cxt *m)\n   /* Remove the blank that we added in rl_domove_motion_callback. */\n   rl_end = m->end;\n   rl_line_buffer[rl_end] = '\\0';\n-  if (rl_point > rl_end)\n-    rl_point = rl_end;\n+  _rl_fix_point (0);\n \n   /* No change in position means the command failed. */\n   if (rl_mark == rl_point)\n     {\n+      /* 'c' and 'C' enter insert mode after the delete even if the motion\n+\t didn't delete anything, as long as the motion command is valid. */\n+      if (_rl_to_upper (m->key) == 'C' && _rl_vi_motion_command (c))\n+\treturn (vidomove_dispatch (m));\n       RL_UNSETSTATE (RL_STATE_VIMOTION);\n       return (-1);\n     }\n@@ -1316,13 +1335,7 @@ rl_domove_read_callback (_rl_vimotion_cxt *m)\n static int\n rl_vi_domove_getchar (_rl_vimotion_cxt *m)\n {\n-  int c;\n-\n-  RL_SETSTATE(RL_STATE_MOREINPUT);\n-  c = rl_read_key ();\n-  RL_UNSETSTATE(RL_STATE_MOREINPUT);\n-\n-  return c;\n+  return (_rl_bracketed_read_key ());\n }\n \n #if defined (READLINE_CALLBACKS)\n@@ -1377,7 +1390,11 @@ rl_vi_delete_to (int count, int key)\n {\n   int c, r;\n \n-  _rl_vimvcxt = _rl_mvcxt_alloc (VIM_DELETE, key);\n+  if (_rl_vimvcxt)\n+    _rl_mvcxt_init (_rl_vimvcxt, VIM_DELETE, key);\n+  else\n+    _rl_vimvcxt = _rl_mvcxt_alloc (VIM_DELETE, key);\n+\n   _rl_vimvcxt->start = rl_point;\n \n   rl_mark = rl_point;\n@@ -1465,7 +1482,10 @@ rl_vi_change_to (int count, int key)\n {\n   int c, r;\n \n-  _rl_vimvcxt = _rl_mvcxt_alloc (VIM_CHANGE, key);\n+  if (_rl_vimvcxt)\n+    _rl_mvcxt_init (_rl_vimvcxt, VIM_CHANGE, key);\n+  else\n+    _rl_vimvcxt = _rl_mvcxt_alloc (VIM_CHANGE, key);\n   _rl_vimvcxt->start = rl_point;\n \n   rl_mark = rl_point;\n@@ -1524,6 +1544,8 @@ vi_yank_dispatch (_rl_vimotion_cxt *m)\n   rl_do_undo ();\n   rl_point = m->start;\n \n+  _rl_fix_point (1);\n+\n   return (0);\n }\n \n@@ -1532,7 +1554,10 @@ rl_vi_yank_to (int count, int key)\n {\n   int c, r;\n \n-  _rl_vimvcxt = _rl_mvcxt_alloc (VIM_YANK, key);\n+  if (_rl_vimvcxt)\n+    _rl_mvcxt_init (_rl_vimvcxt, VIM_YANK, key);\n+  else\n+    _rl_vimvcxt = _rl_mvcxt_alloc (VIM_YANK, key);\n   _rl_vimvcxt->start = rl_point;\n \n   rl_mark = rl_point;\n@@ -2000,21 +2025,7 @@ _rl_vi_change_char (int count, int c, char *mb)\n static int\n _rl_vi_callback_getchar (char *mb, int mlen)\n {\n-  int c;\n-\n-  RL_SETSTATE(RL_STATE_MOREINPUT);\n-  c = rl_read_key ();\n-  RL_UNSETSTATE(RL_STATE_MOREINPUT);\n-\n-  if (c < 0)\n-    return -1;\n-\n-#if defined (HANDLE_MULTIBYTE)\n-  if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n-    c = _rl_read_mbstring (c, mb, mlen);\n-#endif\n-\n-  return c;\n+  return (_rl_bracketed_read_mbstring (mb, mlen));\n }\n \n #if defined (READLINE_CALLBACKS)\n@@ -2026,10 +2037,11 @@ _rl_vi_callback_change_char (_rl_callback_generic_arg *data)\n \n   c = _rl_vi_callback_getchar (mb, MB_LEN_MAX);\n #if defined (HANDLE_MULTIBYTE)\n-  strncpy (_rl_vi_last_replacement, mb, MB_LEN_MAX);\n-#else\n-  _rl_vi_last_replacement[0] = c;\n+  if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n+    strncpy (_rl_vi_last_replacement, mb, MB_LEN_MAX);\n+  else\n #endif\n+    _rl_vi_last_replacement[0] = c;\n   _rl_vi_last_replacement[MB_LEN_MAX] = '\\0';\t/* XXX */\n \n   if (c < 0)\n@@ -2066,10 +2078,11 @@ rl_vi_change_char (int count, int key)\n     {\n       c = _rl_vi_callback_getchar (mb, MB_LEN_MAX);\n #ifdef HANDLE_MULTIBYTE\n-      strncpy (_rl_vi_last_replacement, mb, MB_LEN_MAX);\n-#else\n-      _rl_vi_last_replacement[0] = c;\n+      if (MB_CUR_MAX > 1 && rl_byte_oriented == 0)\n+\tstrncpy (_rl_vi_last_replacement, mb, MB_LEN_MAX);\n+      else\n #endif\n+\t_rl_vi_last_replacement[0] = c;\n       _rl_vi_last_replacement[MB_LEN_MAX] = '\\0';\t/* just in case */      \n     }\n \n@@ -2122,7 +2135,7 @@ rl_vi_overstrike_delete (int count, int key)\n       s = rl_point;\n \n       if (rl_do_undo ())\n-\tvi_replace_count--;\n+\tvi_replace_count--;\t\t/* XXX */\n \n       if (rl_point == s)\n \trl_backward_char (1, key);\n@@ -2137,6 +2150,67 @@ rl_vi_overstrike_delete (int count, int key)\n   return (0);\n }\n \n+static int\n+rl_vi_overstrike_kill_line (int count, int key)\n+{\n+  int r, end;\n+\n+  end = rl_end;\n+  r = rl_unix_line_discard (count, key);\n+  vi_replace_count -= end - rl_end;\n+  return r;\n+}\n+\n+static int\n+rl_vi_overstrike_kill_word (int count, int key)\n+{\n+  int r, end;\n+\n+  end = rl_end;\n+  r = rl_vi_unix_word_rubout (count, key);\n+  vi_replace_count -= end - rl_end;\n+  return r;\n+}\n+\n+static int\n+rl_vi_overstrike_yank (int count, int key)\n+{\n+  int r, end;\n+\n+  end = rl_end;\n+  r = rl_yank (count, key);\n+  vi_replace_count += rl_end - end;\n+  return r;\n+}\n+\n+/* Read bracketed paste mode pasted text and insert it in overwrite mode */\n+static int\n+rl_vi_overstrike_bracketed_paste (int count, int key)\n+{\n+  int r;\n+  char *pbuf;\n+  size_t pblen;\n+\n+  pbuf = _rl_bracketed_text (&pblen);\n+  if (pblen == 0)\n+    {\n+      xfree (pbuf);\n+      return 0;\n+    }\n+  r = pblen;\n+  while (--r >= 0)\n+    _rl_unget_char ((unsigned char)pbuf[r]);\n+  xfree (pbuf);\n+\n+  while (_rl_pushed_input_available ())\n+    {\n+      key = rl_read_key ();\n+      r = rl_vi_overstrike (1, key);\n+    }\n+\n+  return r;\n+}\n+\n int\n rl_vi_replace (int count, int key)\n {\n@@ -2169,16 +2243,34 @@ rl_vi_replace (int count, int key)\n \t  vi_insertion_keymap[CTRL ('H')].function == rl_rubout)\n \tvi_replace_map[CTRL ('H')].function = rl_vi_overstrike_delete;\n \n+      /* Same for ^U and unix-line-discard. */\n+      if (vi_insertion_keymap[CTRL ('U')].type == ISFUNC &&\n+\t  vi_insertion_keymap[CTRL ('U')].function == rl_unix_line_discard)\n+\tvi_replace_map[CTRL ('U')].function = rl_vi_overstrike_kill_line;\n+\n+      /* And for ^W and unix-word-rubout. */\n+      if (vi_insertion_keymap[CTRL ('W')].type == ISFUNC &&\n+\t  vi_insertion_keymap[CTRL ('W')].function == rl_vi_unix_word_rubout)\n+\tvi_replace_map[CTRL ('W')].function = rl_vi_overstrike_kill_word;\n+\n+      /* And finally for ^Y and yank. */\n+      if (vi_insertion_keymap[CTRL ('Y')].type == ISFUNC &&\n+\t  vi_insertion_keymap[CTRL ('Y')].function == rl_yank)\n+\tvi_replace_map[CTRL ('Y')].function = rl_vi_overstrike_yank;\n+\n       /* Make sure this is the value we need. */\n       vi_replace_map[ANYOTHERKEY].type = ISFUNC;\n       vi_replace_map[ANYOTHERKEY].function = (rl_command_func_t *)NULL;\n     }\n \n   rl_vi_start_inserting (key, 1, rl_arg_sign);\n \n-  _rl_vi_last_key_before_insert = key;\n+  _rl_vi_last_key_before_insert = 'R';\t/* in case someone rebinds it */\n   _rl_keymap = vi_replace_map;\n \n+  if (_rl_enable_bracketed_paste)\n+    rl_bind_keyseq_if_unbound (BRACK_PASTE_PREF, rl_vi_overstrike_bracketed_paste);\n+\n   return (0);\n }\n \n@@ -2268,6 +2360,7 @@ _rl_vi_goto_mark (void)\n   if (ch == '`')\n     {\n       rl_point = rl_mark;\n+      _rl_fix_point (1);\n       return 0;\n     }\n   else if (ch < 0 || ch < 'a' || ch > 'z')\t/* make test against 0 explicit */\n@@ -2283,6 +2376,7 @@ _rl_vi_goto_mark (void)\n       return 1;\n     }\n   rl_point = vi_mark_chars[ch];\n+  _rl_fix_point (1);\n   return 0;\n }\n "
    }
  ]
}