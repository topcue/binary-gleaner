{
  "sha": "bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmI2OGYyMmM4ZTY0ODAzMmEwZDFjMWQxNzM1M2VlYzU5OWZmNWU2YQ==",
  "commit": {
    "author": {
      "name": "Fangrui Song",
      "email": "maskray@google.com",
      "date": "2020-05-21T01:31:39Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-05-24T11:47:46Z"
    },
    "message": "ld: Handle --dynamic-list* before -Bsymbolic -Bsymbolic-functions\n\n--dynamic-list* should work both before and after -Bsymbolic and\n-Bsymbolic-functions.\n\n\tPR ld/26018\n\t* lexsup.c (parse_args): Simplify.\n\t* testsuite/ld-elf/dl4e.out: New.\n\t* testsuite/ld-elf/shared.exp: Updated for PR ld/26018 tests.",
    "tree": {
      "sha": "1fc263456d051a8cc7f2913664b4f9e3b8356666",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1fc263456d051a8cc7f2913664b4f9e3b8356666"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/comments",
  "author": {
    "login": "MaskRay",
    "id": 416322,
    "node_id": "MDQ6VXNlcjQxNjMyMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/416322?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MaskRay",
    "html_url": "https://github.com/MaskRay",
    "followers_url": "https://api.github.com/users/MaskRay/followers",
    "following_url": "https://api.github.com/users/MaskRay/following{/other_user}",
    "gists_url": "https://api.github.com/users/MaskRay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MaskRay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MaskRay/subscriptions",
    "organizations_url": "https://api.github.com/users/MaskRay/orgs",
    "repos_url": "https://api.github.com/users/MaskRay/repos",
    "events_url": "https://api.github.com/users/MaskRay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MaskRay/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "309cae1f7bbb6c4de0234e9f592d7dad3d6c61ba",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/309cae1f7bbb6c4de0234e9f592d7dad3d6c61ba",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/309cae1f7bbb6c4de0234e9f592d7dad3d6c61ba"
    }
  ],
  "stats": {
    "total": 62,
    "additions": 37,
    "deletions": 25
  },
  "files": [
    {
      "sha": "533685b363d7b05b55b8019fb09dca1bd9ec4b02",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
      "patch": "@@ -1,3 +1,10 @@\n+2020-05-24  Fangrui Song <maskray@google.com>\n+\n+\tPR ld/26018\n+\t* lexsup.c (parse_args): Simplify.\n+\t* testsuite/ld-elf/dl4e.out: New.\n+\t* testsuite/ld-elf/shared.exp: Updated for PR ld/26018 tests.\n+\n 2020-05-23  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/26018"
    },
    {
      "sha": "04db2f129f872891b5d97ccb223e023a6cf21140",
      "filename": "ld/lexsup.c",
      "status": "modified",
      "additions": 15,
      "deletions": 22,
      "changes": 37,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/lexsup.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/lexsup.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/lexsup.c?ref=bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
      "patch": "@@ -1390,22 +1390,16 @@ parse_args (unsigned argc, char **argv)\n \t  break;\n \tcase OPTION_DYNAMIC_LIST_DATA:\n \t  opt_dynamic_list = dynamic_list_data;\n-\t  if (opt_symbolic == symbolic)\n-\t    opt_symbolic = symbolic_unset;\n \t  break;\n \tcase OPTION_DYNAMIC_LIST_CPP_TYPEINFO:\n \t  lang_append_dynamic_list_cpp_typeinfo ();\n \t  if (opt_dynamic_list != dynamic_list_data)\n \t    opt_dynamic_list = dynamic_list;\n-\t  if (opt_symbolic == symbolic)\n-\t    opt_symbolic = symbolic_unset;\n \t  break;\n \tcase OPTION_DYNAMIC_LIST_CPP_NEW:\n \t  lang_append_dynamic_list_cpp_new ();\n \t  if (opt_dynamic_list != dynamic_list_data)\n \t    opt_dynamic_list = dynamic_list;\n-\t  if (opt_symbolic == symbolic)\n-\t    opt_symbolic = symbolic_unset;\n \t  break;\n \tcase OPTION_DYNAMIC_LIST:\n \t  /* This option indicates a small script that only specifies\n@@ -1422,8 +1416,6 @@ parse_args (unsigned argc, char **argv)\n \t  }\n \t  if (opt_dynamic_list != dynamic_list_data)\n \t    opt_dynamic_list = dynamic_list;\n-\t  if (opt_symbolic == symbolic)\n-\t    opt_symbolic = symbolic_unset;\n \t  break;\n \tcase OPTION_WARN_COMMON:\n \t  config.warn_common = TRUE;\n@@ -1632,6 +1624,19 @@ parse_args (unsigned argc, char **argv)\n       && command_line.check_section_addresses < 0)\n     command_line.check_section_addresses = 0;\n \n+  switch (opt_dynamic_list)\n+    {\n+    case dynamic_list_unset:\n+      break;\n+    case dynamic_list_data:\n+      link_info.dynamic_data = TRUE;\n+      /* Fall through.  */\n+    case dynamic_list:\n+      link_info.dynamic = TRUE;\n+      opt_symbolic = symbolic_unset;\n+      break;\n+    }\n+\n   /* -Bsymbolic and -Bsymbols-functions are for shared library output.  */\n   if (bfd_link_dll (&link_info))\n     switch (opt_symbolic)\n@@ -1651,25 +1656,13 @@ parse_args (unsigned argc, char **argv)\n \t    free (link_info.dynamic_list);\n \t    link_info.dynamic_list = NULL;\n \t  }\n-\topt_dynamic_list = dynamic_list_unset;\n \tbreak;\n       case symbolic_functions:\n-\topt_dynamic_list = dynamic_list_data;\n+\tlink_info.dynamic = TRUE;\n+\tlink_info.dynamic_data = TRUE;\n \tbreak;\n       }\n \n-  switch (opt_dynamic_list)\n-    {\n-    case dynamic_list_unset:\n-      break;\n-    case dynamic_list_data:\n-      link_info.dynamic_data = TRUE;\n-      /* Fall through.  */\n-    case dynamic_list:\n-      link_info.dynamic = TRUE;\n-      break;\n-    }\n-\n   if (!bfd_link_dll (&link_info))\n     {\n       if (command_line.filter_shlib)"
    },
    {
      "sha": "e5da6e21859ca87546c6facb64f79d70cfc38e9c",
      "filename": "ld/testsuite/ld-elf/dl4e.out",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/testsuite/ld-elf/dl4e.out",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/testsuite/ld-elf/dl4e.out",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/dl4e.out?ref=bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
      "patch": "@@ -0,0 +1,6 @@\n+bar OK2\n+bar OK4\n+DSO1\n+DSO2\n+OK2\n+OK4"
    },
    {
      "sha": "7d35f3f3795436d6df112bc1681697d8cbf1abac",
      "filename": "ld/testsuite/ld-elf/shared.exp",
      "status": "modified",
      "additions": 9,
      "deletions": 3,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/testsuite/ld-elf/shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/bb68f22c8e648032a0d1c1d17353eec599ff5e6a/ld/testsuite/ld-elf/shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/shared.exp?ref=bb68f22c8e648032a0d1c1d17353eec599ff5e6a",
      "patch": "@@ -598,6 +598,9 @@ set build_tests {\n   {\"Build libdl2c.so with --dynamic-list-data and dl2xxx.list\"\n    \"-shared -Wl,--dynamic-list-data,--dynamic-list=dl2xxx.list\" \"-fPIC\"\n    {dl2.c dl2xxx.c} {} \"libdl2c.so\"}\n+  {\"Build libdl2d.so with --dynamic-list-data -Bsymbolic\"\n+   \"-shared -Wl,-Bsymbolic,--dynamic-list-data\" \"-fPIC\"\n+   {dl2.c dl2xxx.c} {} \"libdl2d.so\"}\n   {\"Build libdl4a.so with --dynamic-list=dl4.list\"\n    \"-shared -Wl,--dynamic-list=dl4.list\" \"-fPIC\"\n    {dl4.c dl4xxx.c} {} \"libdl4a.so\"}\n@@ -874,6 +877,9 @@ set run_tests [list \\\n     [list \"Run with libdl2c.so\" \\\n      \"-Wl,--no-as-needed tmpdir/libdl2c.so\" \"\" \\\n      {dl2main.c} \"dl2c\" \"dl2b.out\" ] \\\n+    [list \"Run with libdl2d.so\" \\\n+     \"-Wl,--no-as-needed tmpdir/libdl2d.so\" \"\" \\\n+     {dl2main.c} \"dl2d\" \"dl2a.out\" ] \\\n     [list \"Run with libdl4a.so\" \\\n      \"-Wl,--no-as-needed tmpdir/libdl4a.so\" \"\" \\\n      {dl4main.c} \"dl4a\" \"dl4a.out\" ] \\\n@@ -888,10 +894,10 @@ set run_tests [list \\\n      {dl4main.c} \"dl4d\" \"dl4b.out\" ] \\\n     [list \"Run with libdl4e.so\" \\\n      \"-Wl,--no-as-needed tmpdir/libdl4e.so\" \"\" \\\n-     {dl4main.c} \"dl4e\" \"dl4a.out\" ] \\\n+     {dl4main.c} \"dl4e\" \"dl4e.out\" ] \\\n     [list \"Run with libdl4f.so\" \\\n      \"-Wl,--no-as-needed tmpdir/libdl4f.so\" \"\" \\\n-     {dl4main.c} \"dl4f\" \"dl4a.out\" ] \\\n+     {dl4main.c} \"dl4f\" \"dl4e.out\" ] \\\n     [list \"Run with libdata1.so\" \\\n      \"-Wl,--no-as-needed tmpdir/libdata1.so\" \"\" \\\n      {dynbss1.c} \"dynbss1\" \"pass.out\" ] \\\n@@ -988,7 +994,7 @@ set dlopen_run_tests [list \\\n      {dl6cmain.c} \"dl6c1\" \"dl6b.out\" ] \\\n     [list \"Run dl6d1 with --dynamic-list-data and dlopen on libdl6d.so\" \\\n      \"-Wl,--no-as-needed,--dynamic-list-data $extralibs\" \"\" \\\n-     {dl6dmain.c} \"dl6d1\" \"dl6b.out\" ] \\\n+     {dl6dmain.c} \"dl6d1\" \"dl6a.out\" ] \\\n     [list \"Run pr21964-2\" \\\n      \"-Wl,--no-as-needed,-rpath,tmpdir tmpdir/pr21964-2a.so $extralibs\" \"\" \\\n      {pr21964-2c.c} \"pr21964-2\" \"pass.out\" ] \\"
    }
  ]
}