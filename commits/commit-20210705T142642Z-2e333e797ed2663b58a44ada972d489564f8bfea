{
  "sha": "2e333e797ed2663b58a44ada972d489564f8bfea",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmUzMzNlNzk3ZWQyNjYzYjU4YTQ0YWRhOTcyZDQ4OTU2NGY4YmZlYQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-07-05T14:26:42Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-07-05T14:26:42Z"
    },
    "message": "[gdb/testsuite] Fix fail in gdb.fortran/ptype-on-functions.exp with gcc-7\n\nSince commit 05b85772061 \"gdb/fortran: Add type info of formal parameter for\nclang\" I see:\n...\n(gdb) ptype say_string^M\ntype = void (character*(*), integer(kind=4))^M\n(gdb) FAIL: gdb.fortran/ptype-on-functions.exp: ptype say_string\n...\n\nThe part of the commit causing the fail is:\n...\n gdb_test \"ptype say_string\" \\\n-    \"type = void \\\\(character\\\\*\\\\(\\\\*\\\\), integer\\\\(kind=\\\\d+\\\\)\\\\)\"\n+    \"type = void \\\\(character\\[^,\\]+, $integer8\\\\)\"\n...\nwhich fails to take into account that for gcc-7 and before, the type for\nstring length of a string argument is int, not size_t.\n\nFix this by allowing both $integer8 and $integer4.\n\nTested on x86_64-linux, with gcc-7 and gcc-10.\n\ngdb/testsuite/ChangeLog:\n\n2021-07-05  Tom de Vries  <tdevries@suse.de>\n\n\t* gdb.fortran/ptype-on-functions.exp: Allow both $integer8 and\n\t$integer4 for size of string length.",
    "tree": {
      "sha": "0260230116552f82630d8375bc3909310505c962",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0260230116552f82630d8375bc3909310505c962"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2e333e797ed2663b58a44ada972d489564f8bfea",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2e333e797ed2663b58a44ada972d489564f8bfea",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2e333e797ed2663b58a44ada972d489564f8bfea",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2e333e797ed2663b58a44ada972d489564f8bfea/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "99624310dd82542c389c89c2e55d8cae36bb74e1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/99624310dd82542c389c89c2e55d8cae36bb74e1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/99624310dd82542c389c89c2e55d8cae36bb74e1"
    }
  ],
  "stats": {
    "total": 14,
    "additions": 13,
    "deletions": 1
  },
  "files": [
    {
      "sha": "a6171ade8a94159a450716910375d58dc321cf10",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2e333e797ed2663b58a44ada972d489564f8bfea/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2e333e797ed2663b58a44ada972d489564f8bfea/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=2e333e797ed2663b58a44ada972d489564f8bfea",
      "patch": "@@ -1,3 +1,8 @@\n+2021-07-05  Tom de Vries  <tdevries@suse.de>\n+\n+\t* gdb.fortran/ptype-on-functions.exp: Allow both $integer8 and\n+\t$integer4 for size of string length.\n+\n 2021-07-03  Joel Brobecker  <brobecker@adacore.com>\n \n \t* gdb.base/default.exp: Change $_gdb_major to 12."
    },
    {
      "sha": "7d119679e65d146df5b6a2638dff80f4a390e4dd",
      "filename": "gdb/testsuite/gdb.fortran/ptype-on-functions.exp",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2e333e797ed2663b58a44ada972d489564f8bfea/gdb/testsuite/gdb.fortran/ptype-on-functions.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2e333e797ed2663b58a44ada972d489564f8bfea/gdb/testsuite/gdb.fortran/ptype-on-functions.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.fortran/ptype-on-functions.exp?ref=2e333e797ed2663b58a44ada972d489564f8bfea",
      "patch": "@@ -33,6 +33,13 @@ set integer4 [fortran_int4]\n set logical4 [fortran_logical4]\n set integer8 [fortran_int8]\n \n+# A fortran string parameter is passed as a char *, and an additional\n+# argument str_ for the string length.  The type used for the string length\n+# argument is size_t, but for gcc 7 and earlier, the actual type is int\n+# instead ( see\n+# https://gcc.gnu.org/onlinedocs/gfortran/Argument-passing-conventions.html ).\n+set stringlen ($integer8|$integer4)\n+\n if {[test_compiler_info {clang-*}]} {\n     set some_module_class_type \"Type number\"\n     set some_module_aux_info \", $integer8 \\\\(10\\\\)\"\n@@ -62,7 +69,7 @@ gdb_test \"ptype fun_ptr\" \\\n     \"type = PTR TO -> \\\\( $integer4 \\\\(\\\\) \\\\(${fun_ptr_arg}\\\\) \\\\)\"\n \n gdb_test \"ptype say_string\" \\\n-    \"type = void \\\\(character\\[^,\\]+, $integer8\\\\)\"\n+    \"type = void \\\\(character\\[^,\\]+, $stringlen\\\\)\"\n \n set say_array_artificial_first_arg \"\"\n if {[test_compiler_info {clang-*}]} {"
    }
  ]
}