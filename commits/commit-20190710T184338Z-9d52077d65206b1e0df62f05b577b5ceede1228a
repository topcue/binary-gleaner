{
  "sha": "9d52077d65206b1e0df62f05b577b5ceede1228a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OWQ1MjA3N2Q2NTIwNmIxZTBkZjYyZjA1YjU3N2I1Y2VlZGUxMjI4YQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-06-26T19:14:29Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-07-10T18:43:38Z"
    },
    "message": "Change spu-tdep.c to use type-safe registry\n\nThis changes spu-tdep.c to use the type-safe registry.\n\n2019-07-10  Tom Tromey  <tromey@adacore.com>\n\n\t* spu-tdep.c (spu_overlay_data): Change type.\n\t(spu_get_overlay_table, spu_overlay_new_objfile)\n\t(_initialize_spu_tdep): Update.",
    "tree": {
      "sha": "72f01584f996cb84ab5439611beddadf305422c1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/72f01584f996cb84ab5439611beddadf305422c1"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9d52077d65206b1e0df62f05b577b5ceede1228a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d52077d65206b1e0df62f05b577b5ceede1228a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9d52077d65206b1e0df62f05b577b5ceede1228a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9d52077d65206b1e0df62f05b577b5ceede1228a/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "22a20dca3a96c481093bdff5e17f1feb0f9e345c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/22a20dca3a96c481093bdff5e17f1feb0f9e345c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/22a20dca3a96c481093bdff5e17f1feb0f9e345c"
    }
  ],
  "stats": {
    "total": 18,
    "additions": 12,
    "deletions": 6
  },
  "files": [
    {
      "sha": "1c759655561b0beca3d08d2bb89d4575e50c148a",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d52077d65206b1e0df62f05b577b5ceede1228a/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d52077d65206b1e0df62f05b577b5ceede1228a/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=9d52077d65206b1e0df62f05b577b5ceede1228a",
      "patch": "@@ -1,3 +1,9 @@\n+2019-07-10  Tom Tromey  <tromey@adacore.com>\n+\n+\t* spu-tdep.c (spu_overlay_data): Change type.\n+\t(spu_get_overlay_table, spu_overlay_new_objfile)\n+\t(_initialize_spu_tdep): Update.\n+\n 2019-07-10  Tom Tromey  <tromey@adacore.com>\n \n \t* gdb-stabs.h (struct dbx_symfile_info): Add initializers and"
    },
    {
      "sha": "69ffb69fcb98fe05e4a1c0da3ddbacb327a667a9",
      "filename": "gdb/spu-tdep.c",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9d52077d65206b1e0df62f05b577b5ceede1228a/gdb/spu-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9d52077d65206b1e0df62f05b577b5ceede1228a/gdb/spu-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/spu-tdep.c?ref=9d52077d65206b1e0df62f05b577b5ceede1228a",
      "patch": "@@ -1767,14 +1767,15 @@ gdb_print_insn_spu (bfd_vma memaddr, struct disassemble_info *info)\n    a target address.  The overlay section is mapped iff the target\n    integer at this location equals MAPPED_VAL.  */\n \n-static const struct objfile_data *spu_overlay_data;\n-\n struct spu_overlay_table\n   {\n     CORE_ADDR mapped_ptr;\n     CORE_ADDR mapped_val;\n   };\n \n+static objfile_key<spu_overlay_table,\n+\t\t   gdb::noop_deleter<spu_overlay_table>> spu_overlay_data;\n+\n /* Retrieve the overlay table for OBJFILE.  If not already cached, read\n    the _ovly_table data structure from the target and initialize the\n    spu_overlay_table data structure from it.  */\n@@ -1791,7 +1792,7 @@ spu_get_overlay_table (struct objfile *objfile)\n   gdb_byte *ovly_table;\n   int i;\n \n-  tbl = (struct spu_overlay_table *) objfile_data (objfile, spu_overlay_data);\n+  tbl = spu_overlay_data.get (objfile);\n   if (tbl)\n     return tbl;\n \n@@ -1843,7 +1844,7 @@ spu_get_overlay_table (struct objfile *objfile)\n     }\n \n   xfree (ovly_table);\n-  set_objfile_data (objfile, spu_overlay_data, tbl);\n+  spu_overlay_data.set (objfile, tbl);\n   return tbl;\n }\n \n@@ -1901,7 +1902,7 @@ spu_overlay_new_objfile (struct objfile *objfile)\n   struct obj_section *osect;\n \n   /* If we've already touched this file, do nothing.  */\n-  if (!objfile || objfile_data (objfile, spu_overlay_data) != NULL)\n+  if (!objfile || spu_overlay_data.get (objfile) != NULL)\n     return;\n \n   /* Consider only SPU objfiles.  */\n@@ -2765,7 +2766,6 @@ _initialize_spu_tdep (void)\n \n   /* Add ourselves to objfile event chain.  */\n   gdb::observers::new_objfile.attach (spu_overlay_new_objfile);\n-  spu_overlay_data = register_objfile_data ();\n \n   /* Install spu stop-on-load handler.  */\n   gdb::observers::new_objfile.attach (spu_catch_start);"
    }
  ]
}