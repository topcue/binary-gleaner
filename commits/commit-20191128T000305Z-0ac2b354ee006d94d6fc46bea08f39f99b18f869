{
  "sha": "0ac2b354ee006d94d6fc46bea08f39f99b18f869",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MGFjMmIzNTRlZTAwNmQ5NGQ2ZmM0NmJlYTA4ZjM5Zjk5YjE4Zjg2OQ==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-11-04T23:03:10Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-11-28T00:03:05Z"
    },
    "message": "gas/riscv: Produce version 3 DWARF CIE by default\n\nThe flag controlling the default DWARF CIE version to produce now\nstarts with the value -1.  This can be modified with the command line\nflag as before, but after command line flag processing, in\nmd_after_parse_args targets can, if the global still has the value -1,\noverride this value.  This gives a target specific default.\n\nIf a CIE version is not select either by command line flag, or a\ntarget specific default, then some new code in dwarf2_init now select\na global default.  This remains as version 1 to match previous\nbehaviour.\n\nThis RISC-V has a target specific default of version provided, this\nmake the return column uleb128, which means we can use all DWARF\nregisters include CSRs.\n\nI chose to switch to version 3 rather than version 4 as this is most\nsimilar to the global default (version 1).  Switching to version 4\nadds additional columns to the CIE header.\n\ngas/ChangeLog:\n\n\t* as.c (flag_dwarf_cie_version): Change initial value to -1, and\n\tupdate comment.\n\t* config/tc-riscv.c (riscv_after_parse_args): Set\n\tflag_dwarf_cie_version if it has not already been set.\n\t* dwarf2dbg.c (dwarf2_init): Initialise flag_dwarf_cie_version if\n\tneeded.\n\t* testsuite/gas/riscv/default-cie-version.d: New file.\n\t* testsuite/gas/riscv/default-cie-version.s: New file.\n\nld/ChangeLog:\n\n\t* testsuite/ld-elf/eh5.d: Accept version 3 DWARF CIE.\n\nChange-Id: Ibbfe8f0979fba480bf0a359978b09d2b3055555e",
    "tree": {
      "sha": "e835558df4225cb8542515eb3ab5a65eaeef924b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e835558df4225cb8542515eb3ab5a65eaeef924b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/0ac2b354ee006d94d6fc46bea08f39f99b18f869",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0ac2b354ee006d94d6fc46bea08f39f99b18f869",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/0ac2b354ee006d94d6fc46bea08f39f99b18f869",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0ac2b354ee006d94d6fc46bea08f39f99b18f869/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "22eb4a06176dfef554008a62844e0ce30df2260f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/22eb4a06176dfef554008a62844e0ce30df2260f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/22eb4a06176dfef554008a62844e0ce30df2260f"
    }
  ],
  "stats": {
    "total": 71,
    "additions": 61,
    "deletions": 10
  },
  "files": [
    {
      "sha": "45e8b8a8e9a951a096932b82f63f7591512a8b9e",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -1,3 +1,14 @@\n+2019-11-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* as.c (flag_dwarf_cie_version): Change initial value to -1, and\n+\tupdate comment.\n+\t* config/tc-riscv.c (riscv_after_parse_args): Set\n+\tflag_dwarf_cie_version if it has not already been set.\n+\t* dwarf2dbg.c (dwarf2_init): Initialise flag_dwarf_cie_version if\n+\tneeded.\n+\t* testsuite/gas/riscv/default-cie-version.d: New file.\n+\t* testsuite/gas/riscv/default-cie-version.s: New file.\n+\n 2019-11-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* dw2gencfi.c (output_cie): Error on return column overflow."
    },
    {
      "sha": "091fe902da18ede2698b80859ade64c80ffba7d4",
      "filename": "gas/as.c",
      "status": "modified",
      "additions": 6,
      "deletions": 4,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/as.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/as.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/as.c?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -95,10 +95,12 @@ int debug_memory = 0;\n /* Enable verbose mode.  */\n int verbose = 0;\n \n-/* Which version of DWARF CIE to produce.  The default could be overridden\n-   by a target during its initialisation, or by the --gdwarf-cie-version\n-   command line flag.  */\n-int flag_dwarf_cie_version = 1;\n+/* Which version of DWARF CIE to produce.  This default value of -1\n+   indicates that this value has not been set yet, a default value is\n+   provided in dwarf2_init.  A different value can also be supplied by the\n+   command line flag --gdwarf-cie-version, or by a target in\n+   MD_AFTER_PARSE_ARGS.  */\n+int flag_dwarf_cie_version = -1;\n \n #if defined OBJ_ELF || defined OBJ_MAYBE_ELF\n int flag_use_elf_stt_common = DEFAULT_GENERATE_ELF_STT_COMMON;"
    },
    {
      "sha": "055d80c3444431d5b3305f72970fb96958cde4b4",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -2341,6 +2341,12 @@ riscv_after_parse_args (void)\n \n   /* Insert float_abi into the EF_RISCV_FLOAT_ABI field of elf_flags.  */\n   elf_flags |= float_abi * (EF_RISCV_FLOAT_ABI & ~(EF_RISCV_FLOAT_ABI << 1));\n+\n+  /* If the CIE to be produced has not been overridden on the command line,\n+     then produce version 3 by default.  This allows us to use the full\n+     range of registers in a .cfi_return_column directive.  */\n+  if (flag_dwarf_cie_version == -1)\n+    flag_dwarf_cie_version = 3;\n }\n \n long"
    },
    {
      "sha": "fd6ab54faa1f6fb355713ebb599d47b35091a124",
      "filename": "gas/dwarf2dbg.c",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/dwarf2dbg.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/dwarf2dbg.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/dwarf2dbg.c?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -2171,6 +2171,17 @@ void\n dwarf2_init (void)\n {\n   last_seg_ptr = &all_segs;\n+\n+  /* Select the default CIE version to produce here.  The global\n+     starts with a value of -1 and will be modified to a valid value\n+     either by the user providing a command line option, or some\n+     targets will select their own default in md_after_parse_args.  If\n+     we get here and the global still contains -1 then it is up to us\n+     to pick a sane default.  The default we choose is 1, this is the\n+     CIE version gas has produced for a long time, and there seems no\n+     reason to change it yet.  */\n+  if (flag_dwarf_cie_version == -1)\n+    flag_dwarf_cie_version = 1;\n }\n \n "
    },
    {
      "sha": "035f2587ff1eab7889c5ac611e69510bfbd60b1c",
      "filename": "gas/testsuite/gas/riscv/default-cie-version.d",
      "status": "added",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/testsuite/gas/riscv/default-cie-version.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/testsuite/gas/riscv/default-cie-version.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/default-cie-version.d?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -0,0 +1,15 @@\n+#objdump: --dwarf=frames\n+#as:\n+#...\n+.*:     file format elf.*-.*riscv\n+\n+Contents of the .* section:\n+\n+00000000 0+[0-9a-f]+ 0+000 CIE\n+  Version:               3\n+  Augmentation:          .*\n+  Code alignment factor: .*\n+  Data alignment factor: .*\n+  Return address column: .*\n+  Augmentation data:     .*\n+#...\n\\ No newline at end of file"
    },
    {
      "sha": "659b3b9d99b2ac48a1303f4b21b6e9d3706a7a6d",
      "filename": "gas/testsuite/gas/riscv/default-cie-version.s",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/testsuite/gas/riscv/default-cie-version.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/gas/testsuite/gas/riscv/default-cie-version.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/default-cie-version.s?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -0,0 +1,2 @@\n+\t.cfi_startproc\n+\t.cfi_endproc"
    },
    {
      "sha": "adca95ffc0b5aa6f8be46a12e78b0d92444e1d00",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -1,3 +1,7 @@\n+2019-11-27  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* testsuite/ld-elf/eh5.d: Accept version 3 DWARF CIE.\n+\n 2019-11-26  Martin Liska  <mliska@suse.cz>\n \n \t* scripttempl/arclinux.sc: Add .text.sorted.* which is sorted"
    },
    {
      "sha": "e61db610a4129305c60be4a9640bbb3fbbd02a3c",
      "filename": "ld/testsuite/ld-elf/eh5.d",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/0ac2b354ee006d94d6fc46bea08f39f99b18f869/ld/testsuite/ld-elf/eh5.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/0ac2b354ee006d94d6fc46bea08f39f99b18f869/ld/testsuite/ld-elf/eh5.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/eh5.d?ref=0ac2b354ee006d94d6fc46bea08f39f99b18f869",
      "patch": "@@ -9,7 +9,7 @@\n Contents of the .eh_frame section:\n \n 0+0000 0+001[04] 0+0000 CIE\n-  Version:               1\n+  Version:               [13]\n   Augmentation:          \"zR\"\n   Code alignment factor: .*\n   Data alignment factor: .*\n@@ -28,7 +28,7 @@ Contents of the .eh_frame section:\n   DW_CFA_nop\n \n 0+00(2c|30) 0+0014 0+0000 CIE\n-  Version:               1\n+  Version:               [13]\n   Augmentation:          \"zPR\"\n   Code alignment factor: .*\n   Data alignment factor: .*\n@@ -52,7 +52,7 @@ Contents of the .eh_frame section:\n   DW_CFA_nop\n \n 0+007[48] 0+001[8c] 0+0000 CIE\n-  Version:               1\n+  Version:               [13]\n   Augmentation:          \"zPLR\"\n   Code alignment factor: .*\n   Data alignment factor: .*\n@@ -73,7 +73,7 @@ Contents of the .eh_frame section:\n   DW_CFA_nop\n \n 0+00b[08] 0+001[04] 0+0000 CIE\n-  Version:               1\n+  Version:               [13]\n   Augmentation:          \"zR\"\n   Code alignment factor: .*\n   Data alignment factor: .*\n@@ -88,7 +88,7 @@ Contents of the .eh_frame section:\n   DW_CFA_nop\n #...\n 0+00[de]8 0+0014 0+0000 CIE\n-  Version:               1\n+  Version:               [13]\n   Augmentation:          \"zPR\"\n   Code alignment factor: .*\n   Data alignment factor: .*\n@@ -110,7 +110,7 @@ Contents of the .eh_frame section:\n   DW_CFA_nop\n #...\n 0+01(1c|30) 0+001[8c] 0+0000 CIE\n-  Version:               1\n+  Version:               [13]\n   Augmentation:          \"zPLR\"\n   Code alignment factor: .*\n   Data alignment factor: .*"
    }
  ]
}