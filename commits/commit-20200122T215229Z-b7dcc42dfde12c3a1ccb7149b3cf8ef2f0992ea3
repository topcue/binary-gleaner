{
  "sha": "b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjdkY2M0MmRmZGUxMmMzYTFjY2I3MTQ5YjNjZjhlZjJmMDk5MmVhMw==",
  "commit": {
    "author": {
      "name": "Jozef Lawrynowicz",
      "email": "jozef.l@mittosystems.com",
      "date": "2020-01-22T21:44:54Z"
    },
    "committer": {
      "name": "Jozef Lawrynowicz",
      "email": "jozef.l@mittosystems.com",
      "date": "2020-01-22T21:52:29Z"
    },
    "message": "MSP430: Fix simulator execution of RRUX instruction\n\nThe MSP430X RRUX instruction (unsigned right shift) is synthesized as\nthe RRC (rotate right through carry) instruction, but with the ZC\n(zero carry) bit of the opcode extention word set.\n\nEnsure the carry flag is ignored when the ZC bit is set.\n\nsim/msp430/ChangeLog:\n\n2020-01-22  Jozef Lawrynowicz  <jozef.l@mittosystems.com>\n\n\t* msp430-sim.c (msp430_step_once): Ignore the carry flag when executing\n\tan RRC instruction, if the ZC bit of the extension word is set.\n\nsim/testsuite/sim/msp430/ChangeLog:\n\n2020-01-22  Jozef Lawrynowicz  <jozef.l@mittosystems.com>\n\n\t* rrux.s: New test.",
    "tree": {
      "sha": "c2a177ad023f97f05bedfaa9271e035e371d6a09",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c2a177ad023f97f05bedfaa9271e035e371d6a09"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/comments",
  "author": {
    "login": "jozefl-mitto",
    "id": 36524004,
    "node_id": "MDQ6VXNlcjM2NTI0MDA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jozefl-mitto",
    "html_url": "https://github.com/jozefl-mitto",
    "followers_url": "https://api.github.com/users/jozefl-mitto/followers",
    "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}",
    "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions",
    "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs",
    "repos_url": "https://api.github.com/users/jozefl-mitto/repos",
    "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jozefl-mitto",
    "id": 36524004,
    "node_id": "MDQ6VXNlcjM2NTI0MDA0",
    "avatar_url": "https://avatars.githubusercontent.com/u/36524004?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jozefl-mitto",
    "html_url": "https://github.com/jozefl-mitto",
    "followers_url": "https://api.github.com/users/jozefl-mitto/followers",
    "following_url": "https://api.github.com/users/jozefl-mitto/following{/other_user}",
    "gists_url": "https://api.github.com/users/jozefl-mitto/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jozefl-mitto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jozefl-mitto/subscriptions",
    "organizations_url": "https://api.github.com/users/jozefl-mitto/orgs",
    "repos_url": "https://api.github.com/users/jozefl-mitto/repos",
    "events_url": "https://api.github.com/users/jozefl-mitto/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jozefl-mitto/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "be4c5e58bdc839898739e0332aee84abf6e5299a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/be4c5e58bdc839898739e0332aee84abf6e5299a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/be4c5e58bdc839898739e0332aee84abf6e5299a"
    }
  ],
  "stats": {
    "total": 29,
    "additions": 27,
    "deletions": 2
  },
  "files": [
    {
      "sha": "0f27982068c8a15c620d08757225914f98db3ec2",
      "filename": "sim/msp430/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/msp430/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/msp430/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/msp430/ChangeLog?ref=b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
      "patch": "@@ -1,3 +1,8 @@\n+2020-01-22  Jozef Lawrynowicz  <jozef.l@mittosystems.com>\n+\n+\t* msp430-sim.c (msp430_step_once): Ignore the carry flag when executing\n+\tan RRC instruction, if the ZC bit of the extension word is set.\n+\n 2017-09-06  John Baldwin  <jhb@FreeBSD.org>\n \n \t* configure: Regenerate."
    },
    {
      "sha": "e21c8cf6a649703a6a46b80849fc4bf689f9d73a",
      "filename": "sim/msp430/msp430-sim.c",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/msp430/msp430-sim.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/msp430/msp430-sim.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/msp430/msp430-sim.c?ref=b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
      "patch": "@@ -1292,8 +1292,10 @@ msp430_step_once (SIM_DESC sd)\n \t  u1 = SRC;\n \t  carry_to_use = u1 & 1;\n \t  uresult = u1 >> 1;\n-\t  if (SR & MSP430_FLAG_C)\n-\t  uresult |= (1 << (opcode->size - 1));\n+\t  /* If the ZC bit of the opcode is set, it means we are synthesizing\n+\t     RRUX, so the carry bit must be ignored.  */\n+\t  if (opcode->zc == 0 && (SR & MSP430_FLAG_C))\n+\t    uresult |= (1 << (opcode->size - 1));\n \t  TRACE_ALU (MSP430_CPU (sd), \"RRC: %#x >>= %#x\",\n \t\t     u1, uresult);\n \t  DEST (uresult);"
    },
    {
      "sha": "7dc370f0a41c37ded41f643a49eff727e95216a3",
      "filename": "sim/testsuite/sim/msp430/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/testsuite/sim/msp430/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/testsuite/sim/msp430/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/testsuite/sim/msp430/ChangeLog?ref=b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
      "patch": "@@ -1,3 +1,7 @@\n+2020-01-22  Jozef Lawrynowicz  <jozef.l@mittosystems.com>\n+\n+\t* rrux.s: New test.\n+\n 2016-01-05  Nick Clifton  <nickc@redhat.com>\n \n \t* testutils.inc (__pass): Use the LMA addresses of the _passmsg"
    },
    {
      "sha": "07fc8d5a8db481f556f838a3736a77a09167559c",
      "filename": "sim/testsuite/sim/msp430/rrux.s",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/testsuite/sim/msp430/rrux.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3/sim/testsuite/sim/msp430/rrux.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/testsuite/sim/msp430/rrux.s?ref=b7dcc42dfde12c3a1ccb7149b3cf8ef2f0992ea3",
      "patch": "@@ -0,0 +1,14 @@\n+# check that rrux (synthesized as rrc with ZC bit set) works.\n+# mach: msp430\n+\n+.include \"testutils.inc\"\n+\n+\tstart\n+\n+\tsetc\t\t; set the carry bit to ensure ZC bit is obeyed\n+\tmov.w\t#16, r10\n+\trrux.w\tr10\n+\tcmp.w\t#8, r10\n+\tjeq 1f\n+\tfail\n+\t1: pass"
    }
  ]
}