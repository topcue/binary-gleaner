{
  "sha": "be4c5e58bdc839898739e0332aee84abf6e5299a",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YmU0YzVlNThiZGM4Mzk4OTg3MzllMDMzMmFlZTg0YWJmNmU1Mjk5YQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-01-22T17:24:14Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-01-22T17:24:14Z"
    },
    "message": "x86: Always disallow double word suffix with word general register\n\nIn 64-bit mode, double word suffix in mnemonic with word general register\nis disallowed.  Otherwise, assembler gives a warning:\n\n$ cat /tmp/x.s\n\tmovl\t%ax, %bx\n\tmovl\t%ds, %ax\n\tmovl\t%ax, %cs\n$ gcc -c /tmp/x.s\n/tmp/x.s: Assembler messages:\n/tmp/x.s:1: Error: incorrect register `%bx' used with `l' suffix\n/tmp/x.s:2: Error: incorrect register `%ax' used with `l' suffix\n/tmp/x.s:3: Error: incorrect register `%ax' used with `l' suffix\n$ gcc -c /tmp/x.s -m32\n/tmp/x.s: Assembler messages:\n/tmp/x.s: Assembler messages:\n/tmp/x.s:1: Warning: using `%ebx' instead of `%bx' due to `l' suffix\n/tmp/x.s:1: Warning: using `%eax' instead of `%ax' due to `l' suffix\n/tmp/x.s:2: Warning: using `%eax' instead of `%ax' due to `l' suffix\n/tmp/x.s:3: Warning: using `%eax' instead of `%ax' due to `l' suffix\n\nThis patch makes it a hard error in all modes.  Now we get:\n\n$ gcc -c /tmp/x.s -m32\n/tmp/x.s: Assembler messages:\n/tmp/x.s:1: Error: incorrect register `%bx' used with `l' suffix\n/tmp/x.s:2: Error: incorrect register `%ax' used with `l' suffix\n/tmp/x.s:3: Error: incorrect register `%ax' used with `l' suffix\n\n\tPR gas/25438\n\t* config/tc-i386.c (check_long_reg): Always disallow double word\n\tsuffix in mnemonic with word general register.\n\t* testsuite/gas/i386/general.s: Replace word general register\n\twith double word general register for movl.\n\t* testsuite/gas/i386/inval.s: Add tests for movl with word general\n\tregister.\n\t* testsuite/gas/i386/general.l: Updated.\n\t* testsuite/gas/i386/inval.l: Likewise.",
    "tree": {
      "sha": "5b2fa8999c65f96def40ddd14b6560045d83f8b8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5b2fa8999c65f96def40ddd14b6560045d83f8b8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/be4c5e58bdc839898739e0332aee84abf6e5299a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/be4c5e58bdc839898739e0332aee84abf6e5299a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/be4c5e58bdc839898739e0332aee84abf6e5299a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/be4c5e58bdc839898739e0332aee84abf6e5299a/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6a462ad49ec13bec4659f2a8fb2301cac9742da9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6a462ad49ec13bec4659f2a8fb2301cac9742da9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6a462ad49ec13bec4659f2a8fb2301cac9742da9"
    }
  ],
  "stats": {
    "total": 65,
    "additions": 35,
    "deletions": 30
  },
  "files": [
    {
      "sha": "8a18aa7774dc4214270aa80ad1bb8a9165dcbd68",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=be4c5e58bdc839898739e0332aee84abf6e5299a",
      "patch": "@@ -1,3 +1,15 @@\n+2020-01-22  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR gas/25438\n+\t* config/tc-i386.c (check_long_reg): Always disallow double word\n+\tsuffix in mnemonic with word general register.\n+\t* testsuite/gas/i386/general.s: Replace word general register\n+\twith double word general register for movl.\n+\t* testsuite/gas/i386/inval.s: Add tests for movl with word general\n+\tregister.\n+\t* testsuite/gas/i386/general.l: Updated.\n+\t* testsuite/gas/i386/inval.l: Likewise.\n+\n 2020-01-22  Alan Modra  <amodra@gmail.com>\n \n \t* config/tc-ppc.c (parse_tls_arg): Handle tls arg for"
    },
    {
      "sha": "34778ae7605d353769db07a1c73eb8de3824266c",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 6,
      "deletions": 18,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=be4c5e58bdc839898739e0332aee84abf6e5299a",
      "patch": "@@ -6672,28 +6672,16 @@ check_long_reg (void)\n \t\ti.suffix);\n \treturn 0;\n       }\n-    /* Warn if the e prefix on a general reg is missing.  */\n-    else if ((!quiet_warnings || flag_code == CODE_64BIT)\n-\t     && i.types[op].bitfield.word\n+    /* Error if the e prefix on a general reg is missing.  */\n+    else if (i.types[op].bitfield.word\n \t     && (i.tm.operand_types[op].bitfield.class == Reg\n \t\t || i.tm.operand_types[op].bitfield.instance == Accum)\n \t     && i.tm.operand_types[op].bitfield.dword)\n       {\n-\t/* Prohibit these changes in the 64bit mode, since the\n-\t   lowering is more complicated.  */\n-\tif (flag_code == CODE_64BIT)\n-\t  {\n-\t    as_bad (_(\"incorrect register `%s%s' used with `%c' suffix\"),\n-\t\t    register_prefix, i.op[op].regs->reg_name,\n-\t\t    i.suffix);\n-\t    return 0;\n-\t  }\n-#if REGISTER_WARNINGS\n-\tas_warn (_(\"using `%s%s' instead of `%s%s' due to `%c' suffix\"),\n-\t\t register_prefix,\n-\t\t (i.op[op].regs + REGNAM_EAX - REGNAM_AX)->reg_name,\n-\t\t register_prefix, i.op[op].regs->reg_name, i.suffix);\n-#endif\n+\tas_bad (_(\"incorrect register `%s%s' used with `%c' suffix\"),\n+\t\tregister_prefix, i.op[op].regs->reg_name,\n+\t\ti.suffix);\n+\treturn 0;\n       }\n     /* Warn if the r prefix on a general reg is present.  */\n     else if (i.types[op].bitfield.qword"
    },
    {
      "sha": "470527716adca972a0dfb0807d092db39c4f391e",
      "filename": "gas/testsuite/gas/i386/general.l",
      "status": "modified",
      "additions": 3,
      "deletions": 9,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/general.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/general.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/general.l?ref=be4c5e58bdc839898739e0332aee84abf6e5299a",
      "patch": "@@ -9,8 +9,6 @@\n .*:25: Warning:.*\n .*:27: Warning:.*\n .*:29: Warning:.*\n-.*:39: Warning:.*\n-.*:41: Warning:.*\n .*:48: Warning:.*\n .*:51: Warning:.*\n .*:124: Warning:.*\n@@ -30,7 +28,6 @@\n .*:142: Warning:.*\n .*:143: Warning:.*\n .*:144: Warning:.*\n-.*:178: Warning:.*\n .*:224: Warning:.*\n .*:233: Warning:.*\n .*:234: Warning:.*\n@@ -84,11 +81,9 @@\n   36 007e 1F                \t\tpopl\t%ds\n   37 007f 8CD8              \t\tmov\t%ds,%eax\n   38 0081 8CD8              \t\tmovl\t%ds,%eax\n-  39 0083 8CD8              \t\tmovl\t%ds,%ax\n-.*Warning:.*\n+  39 0083 8CDB              \t\tmovl\t%ds,%ebx\n   40 0085 8ED8              \t\tmov\t%eax,%ds\n-  41 0087 8ED8              \t\tmovl\t%ax,%ds\n-.*Warning:.*\n+  41 0087 8EDB              \t\tmovl\t%ebx,%ds\n   42 0089 8ED8              \t\tmovl\t%eax,%ds\n   43                       \t\n   44 008b 661E              \t\tpushw\t%ds\n@@ -244,8 +239,7 @@\n  175 01a9 66F7F1            \t\tdiv\t%cx,%ax\n  176 01ac F7F1              \t\tdiv\t%ecx,%eax\n  177 01ae 8EDE              \t\tmov\t%si,%ds\n- 178 01b0 8EDE              \t\tmovl\t%si,%ds\t\t# warning here\n-.*Warning:.*\n+ 178 01b0 8EDF              \t\tmovl\t%edi,%ds\n  179 01b2 1E                \t\tpushl\t%ds\n  180 01b3 1E                \t\tpush\t%ds\n  181 01b4 A0000000 00       \t\tmov\t0,%al"
    },
    {
      "sha": "77f54ae91ff51ed711a67fd2c60425c3195e1932",
      "filename": "gas/testsuite/gas/i386/general.s",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/general.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/general.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/general.s?ref=be4c5e58bdc839898739e0332aee84abf6e5299a",
      "patch": "@@ -36,9 +36,9 @@\n \tpopl\t%ds\n \tmov\t%ds,%eax\n \tmovl\t%ds,%eax\n-\tmovl\t%ds,%ax\n+\tmovl\t%ds,%ebx\n \tmov\t%eax,%ds\n-\tmovl\t%ax,%ds\n+\tmovl\t%ebx,%ds\n \tmovl\t%eax,%ds\n \n \tpushw\t%ds\n@@ -175,7 +175,7 @@\n \tdiv\t%cx,%ax\n \tdiv\t%ecx,%eax\n \tmov\t%si,%ds\n-\tmovl\t%si,%ds\t\t# warning here\n+\tmovl\t%edi,%ds\n \tpushl\t%ds\n \tpush\t%ds\n \tmov\t0,%al"
    },
    {
      "sha": "0159e97a3fd4dec7a2b9f095c51ff2acbfb2f012",
      "filename": "gas/testsuite/gas/i386/inval.l",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/inval.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/inval.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/inval.l?ref=be4c5e58bdc839898739e0332aee84abf6e5299a",
      "patch": "@@ -88,6 +88,9 @@\n .*:98: Error: .*rol.*\n .*:99: Error: .*rcl.*\n .*:102: Error: .*\n+.*:104: Error: .*\n+.*:105: Error: .*\n+.*:106: Error: .*\n GAS LISTING .*\n \n \n@@ -196,3 +199,7 @@ GAS LISTING .*\n [ \t]*[1-9][0-9]*[ \t]+\n [ \t]*[1-9][0-9]*[ \t]+\\.att_syntax prefix\n [ \t]*[1-9][0-9]*[ \t]+movsd \\(%esi\\), %ss:\\(%edi\\), %ss:\\(%eax\\)\n+[ \t]*[1-9][0-9]*[ \t]+\n+[ \t]*[1-9][0-9]*[ \t]+movl\t%ds, %ax\n+[ \t]*[1-9][0-9]*[ \t]+movl\t%ax, %ds\n+[ \t]*[1-9][0-9]*[ \t]+movl\t%ax, %bx"
    },
    {
      "sha": "3ff58b34c67c74757fb7e411d6bbedd697f1e895",
      "filename": "gas/testsuite/gas/i386/inval.s",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/inval.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/be4c5e58bdc839898739e0332aee84abf6e5299a/gas/testsuite/gas/i386/inval.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/inval.s?ref=be4c5e58bdc839898739e0332aee84abf6e5299a",
      "patch": "@@ -100,3 +100,7 @@ movnti word ptr [eax], ax\n \n \t.att_syntax prefix\n \tmovsd (%esi), %ss:(%edi), %ss:(%eax)\n+\n+\tmovl\t%ds, %ax\n+\tmovl\t%ax, %ds\n+\tmovl\t%ax, %bx"
    }
  ]
}