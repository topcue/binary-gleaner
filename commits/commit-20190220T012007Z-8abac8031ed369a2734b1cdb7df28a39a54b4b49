{
  "sha": "8abac8031ed369a2734b1cdb7df28a39a54b4b49",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGFiYWM4MDMxZWQzNjlhMjczNGIxY2RiN2RmMjhhMzlhNTRiNGI0OQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-02-19T21:51:24Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2019-02-20T01:20:07Z"
    },
    "message": "PR24236, Heap buffer overflow in _bfd_archive_64_bit_slurp_armap\n\n\tPR 24236\n\t* archive64.c (_bfd_archive_64_bit_slurp_armap): Move code adding\n\tsentinel NUL to string buffer nearer to loop where it is used.\n\tDon't go past sentinel when scanning strings, and don't write\n\tNUL again.\n\t* archive.c (do_slurp_coff_armap): Simplify string handling to\n\tarchive64.c style.",
    "tree": {
      "sha": "e6a6f1ce759adb9afb1f515aa9347d06541b0f16",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e6a6f1ce759adb9afb1f515aa9347d06541b0f16"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8abac8031ed369a2734b1cdb7df28a39a54b4b49",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8abac8031ed369a2734b1cdb7df28a39a54b4b49",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8abac8031ed369a2734b1cdb7df28a39a54b4b49",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8abac8031ed369a2734b1cdb7df28a39a54b4b49/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7ae39e2d406dbec568c5ffd462119037b994fdf9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7ae39e2d406dbec568c5ffd462119037b994fdf9",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7ae39e2d406dbec568c5ffd462119037b994fdf9"
    }
  ],
  "stats": {
    "total": 37,
    "additions": 22,
    "deletions": 15
  },
  "files": [
    {
      "sha": "e39bb1264cb9e550bea1620d1114094905f07c6c",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8abac8031ed369a2734b1cdb7df28a39a54b4b49/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8abac8031ed369a2734b1cdb7df28a39a54b4b49/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=8abac8031ed369a2734b1cdb7df28a39a54b4b49",
      "patch": "@@ -1,3 +1,13 @@\n+2019-02-20  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 24236\n+\t* archive64.c (_bfd_archive_64_bit_slurp_armap): Move code adding\n+\tsentinel NUL to string buffer nearer to loop where it is used.\n+\tDon't go past sentinel when scanning strings, and don't write\n+\tNUL again.\n+\t* archive.c (do_slurp_coff_armap): Simplify string handling to\n+\tarchive64.c style.\n+\n 2019-02-19  Alan Modra  <amodra@gmail.com>\n \n \tPR 24235"
    },
    {
      "sha": "68a92a3e36314959661ae44bfcf6e2cc3bf2fb64",
      "filename": "bfd/archive.c",
      "status": "modified",
      "additions": 7,
      "deletions": 10,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8abac8031ed369a2734b1cdb7df28a39a54b4b49/bfd/archive.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8abac8031ed369a2734b1cdb7df28a39a54b4b49/bfd/archive.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/archive.c?ref=8abac8031ed369a2734b1cdb7df28a39a54b4b49",
      "patch": "@@ -1012,6 +1012,7 @@ do_slurp_coff_armap (bfd *abfd)\n   int *raw_armap, *rawptr;\n   struct artdata *ardata = bfd_ardata (abfd);\n   char *stringbase;\n+  char *stringend;\n   bfd_size_type stringsize;\n   bfd_size_type parsed_size;\n   carsym *carsyms;\n@@ -1071,22 +1072,18 @@ do_slurp_coff_armap (bfd *abfd)\n     }\n \n   /* OK, build the carsyms.  */\n-  for (i = 0; i < nsymz && stringsize > 0; i++)\n+  stringend = stringbase + stringsize;\n+  *stringend = 0;\n+  for (i = 0; i < nsymz; i++)\n     {\n-      bfd_size_type len;\n-\n       rawptr = raw_armap + i;\n       carsyms->file_offset = swap ((bfd_byte *) rawptr);\n       carsyms->name = stringbase;\n-      /* PR 17512: file: 4a1d50c1.  */\n-      len = strnlen (stringbase, stringsize);\n-      if (len < stringsize)\n-\tlen ++;\n-      stringbase += len;\n-      stringsize -= len;\n+      stringbase += strlen (stringbase);\n+      if (stringbase != stringend)\n+\t++stringbase;\n       carsyms++;\n     }\n-  *stringbase = 0;\n \n   ardata->symdef_count = nsymz;\n   ardata->first_file_filepos = bfd_tell (abfd);"
    },
    {
      "sha": "42f6ed92f095fb5cc404801b9d897bc7669bab41",
      "filename": "bfd/archive64.c",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8abac8031ed369a2734b1cdb7df28a39a54b4b49/bfd/archive64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8abac8031ed369a2734b1cdb7df28a39a54b4b49/bfd/archive64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/archive64.c?ref=8abac8031ed369a2734b1cdb7df28a39a54b4b49",
      "patch": "@@ -100,8 +100,6 @@ _bfd_archive_64_bit_slurp_armap (bfd *abfd)\n     return FALSE;\n   carsyms = ardata->symdefs;\n   stringbase = ((char *) ardata->symdefs) + carsym_size;\n-  stringbase[stringsize] = 0;\n-  stringend = stringbase + stringsize;\n \n   raw_armap = (bfd_byte *) bfd_alloc (abfd, ptrsize);\n   if (raw_armap == NULL)\n@@ -115,15 +113,17 @@ _bfd_archive_64_bit_slurp_armap (bfd *abfd)\n       goto release_raw_armap;\n     }\n \n+  stringend = stringbase + stringsize;\n+  *stringend = 0;\n   for (i = 0; i < nsymz; i++)\n     {\n       carsyms->file_offset = bfd_getb64 (raw_armap + i * 8);\n       carsyms->name = stringbase;\n-      if (stringbase < stringend)\n-\tstringbase += strlen (stringbase) + 1;\n+      stringbase += strlen (stringbase);\n+      if (stringbase != stringend)\n+\t++stringbase;\n       ++carsyms;\n     }\n-  *stringbase = '\\0';\n \n   ardata->symdef_count = nsymz;\n   ardata->first_file_filepos = bfd_tell (abfd);"
    }
  ]
}