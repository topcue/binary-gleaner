{
  "sha": "32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzI1ODBmNmQyZWNjZmUzMmVlNzJiMTdmNjNjOWU3MGNmODY3YzA5ZQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-09-17T17:47:50Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-09-17T17:58:56Z"
    },
    "message": "Use htab_up in completion_tracker\n\nThis changes completion_tracker to use htab_up, rather than explicit\ncalls to htab_delete.\n\ngdb/ChangeLog\n2020-09-17  Tom Tromey  <tom@tromey.com>\n\n\t* completer.c (completion_tracker::discard_completions)\n\t(completion_tracker::~completion_tracker)\n\t(completion_tracker::maybe_add_completion)\n\t(completion_tracker::remove_completion)\n\t(completion_tracker::recompute_lowest_common_denominator)\n\t(completion_tracker::build_completion_result): Update.\n\t* completer.h (class completion_tracker) <have_completions>:\n\tUpdate.\n\t<m_entries_hash>: Now htab_up.",
    "tree": {
      "sha": "c1f2849459cea4527e3de30f0327bb98d294a23f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/c1f2849459cea4527e3de30f0327bb98d294a23f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c1fb98360cf47485a5f943b657fe8d56244da7e7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c1fb98360cf47485a5f943b657fe8d56244da7e7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c1fb98360cf47485a5f943b657fe8d56244da7e7"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 27,
    "deletions": 18
  },
  "files": [
    {
      "sha": "8f8f7a9174b32b76f3a4d5f89393cf470298a3d4",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
      "patch": "@@ -1,3 +1,15 @@\n+2020-09-17  Tom Tromey  <tom@tromey.com>\n+\n+\t* completer.c (completion_tracker::discard_completions)\n+\t(completion_tracker::~completion_tracker)\n+\t(completion_tracker::maybe_add_completion)\n+\t(completion_tracker::remove_completion)\n+\t(completion_tracker::recompute_lowest_common_denominator)\n+\t(completion_tracker::build_completion_result): Update.\n+\t* completer.h (class completion_tracker) <have_completions>:\n+\tUpdate.\n+\t<m_entries_hash>: Now htab_up.\n+\n 2020-09-17  Tom Tromey  <tom@tromey.com>\n \n \t* breakpoint.c (ambiguous_names_p): Use htab_up."
    },
    {
      "sha": "e75b8b4b85dc2e8671d0fd04e8fcbf0dd0bdcd1d",
      "filename": "gdb/completer.c",
      "status": "modified",
      "additions": 13,
      "deletions": 16,
      "changes": 29,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/gdb/completer.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/gdb/completer.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/completer.c?ref=32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
      "patch": "@@ -1587,10 +1587,7 @@ completion_tracker::discard_completions ()\n   m_lowest_common_denominator_unique = false;\n   m_lowest_common_denominator_valid = false;\n \n-  /* A null check here allows this function to be used from the\n-     constructor.  */\n-  if (m_entries_hash != NULL)\n-    htab_delete (m_entries_hash);\n+  m_entries_hash.reset (nullptr);\n \n   /* A callback used by the hash table to compare new entries with existing\n      entries.  We can't use the standard streq_hash function here as the\n@@ -1618,18 +1615,17 @@ completion_tracker::discard_completions ()\n \treturn entry->hash_name ();\n       };\n \n-  m_entries_hash = htab_create_alloc (INITIAL_COMPLETION_HTAB_SIZE,\n-\t\t\t\t      entry_hash_func, entry_eq_func,\n-\t\t\t\t      completion_hash_entry::deleter,\n-\t\t\t\t      xcalloc, xfree);\n+  m_entries_hash.reset (htab_create_alloc (INITIAL_COMPLETION_HTAB_SIZE,\n+\t\t\t\t\t   entry_hash_func, entry_eq_func,\n+\t\t\t\t\t   completion_hash_entry::deleter,\n+\t\t\t\t\t   xcalloc, xfree));\n }\n \n /* See completer.h.  */\n \n completion_tracker::~completion_tracker ()\n {\n   xfree (m_lowest_common_denominator);\n-  htab_delete (m_entries_hash);\n }\n \n /* See completer.h.  */\n@@ -1645,11 +1641,12 @@ completion_tracker::maybe_add_completion\n   if (max_completions == 0)\n     return false;\n \n-  if (htab_elements (m_entries_hash) >= max_completions)\n+  if (htab_elements (m_entries_hash.get ()) >= max_completions)\n     return false;\n \n   hashval_t hash = htab_hash_string (name.get ());\n-  slot = htab_find_slot_with_hash (m_entries_hash, name.get (), hash, INSERT);\n+  slot = htab_find_slot_with_hash (m_entries_hash.get (), name.get (),\n+\t\t\t\t   hash, INSERT);\n   if (*slot == HTAB_EMPTY_ENTRY)\n     {\n       const char *match_for_lcd_str = NULL;\n@@ -1700,10 +1697,10 @@ void\n completion_tracker::remove_completion (const char *name)\n {\n   hashval_t hash = htab_hash_string (name);\n-  if (htab_find_slot_with_hash (m_entries_hash, name, hash, NO_INSERT)\n+  if (htab_find_slot_with_hash (m_entries_hash.get (), name, hash, NO_INSERT)\n       != NULL)\n     {\n-      htab_remove_elt_with_hash (m_entries_hash, name, hash);\n+      htab_remove_elt_with_hash (m_entries_hash.get (), name, hash);\n       m_lowest_common_denominator_valid = false;\n     }\n }\n@@ -2144,7 +2141,7 @@ completion_tracker::recompute_lowest_common_denominator ()\n \treturn 1;\n       };\n \n-  htab_traverse (m_entries_hash, visitor_func, this);\n+  htab_traverse (m_entries_hash.get (), visitor_func, this);\n   m_lowest_common_denominator_valid = true;\n }\n \n@@ -2227,7 +2224,7 @@ completion_result\n completion_tracker::build_completion_result (const char *text,\n \t\t\t\t\t     int start, int end)\n {\n-  size_t element_count = htab_elements (m_entries_hash);\n+  size_t element_count = htab_elements (m_entries_hash.get ());\n \n   if (element_count == 0)\n     return {};\n@@ -2294,7 +2291,7 @@ completion_tracker::build_completion_result (const char *text,\n \t  };\n \n       /* Build the completion list and add a null at the end.  */\n-      htab_traverse_noresize (m_entries_hash, func, &builder);\n+      htab_traverse_noresize (m_entries_hash.get (), func, &builder);\n       match_list[builder.index] = NULL;\n \n       return completion_result (match_list, builder.index - 1, false);"
    },
    {
      "sha": "60b3800b08058829ae23c0db0a8e177497170cf3",
      "filename": "gdb/completer.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/gdb/completer.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/32580f6d2eccfe32ee72b17f63c9e70cf867c09e/gdb/completer.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/completer.h?ref=32580f6d2eccfe32ee72b17f63c9e70cf867c09e",
      "patch": "@@ -393,7 +393,7 @@ class completion_tracker\n \n   /* True if we have any completion match recorded.  */\n   bool have_completions () const\n-  { return htab_elements (m_entries_hash) > 0; }\n+  { return htab_elements (m_entries_hash.get ()) > 0; }\n \n   /* Discard the current completion match list and the current\n      LCD.  */\n@@ -440,7 +440,7 @@ class completion_tracker\n      will remove duplicates, and if removal of duplicates there brings\n      the total under max_completions the user may think gdb quit\n      searching too early.  */\n-  htab_t m_entries_hash = NULL;\n+  htab_up m_entries_hash;\n \n   /* If non-zero, then this is the quote char that needs to be\n      appended after completion (iff we have a unique completion).  We"
    }
  ]
}