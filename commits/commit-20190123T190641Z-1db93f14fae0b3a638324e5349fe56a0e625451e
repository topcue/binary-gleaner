{
  "sha": "1db93f14fae0b3a638324e5349fe56a0e625451e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MWRiOTNmMTRmYWUwYjNhNjM4MzI0ZTUzNDlmZTU2YTBlNjI1NDUxZQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-01-23T18:58:34Z"
    },
    "committer": {
      "name": "Pedro Alves",
      "email": "palves@redhat.com",
      "date": "2019-01-23T19:06:41Z"
    },
    "message": "Remove cleanup from linux-nat.c\n\nThis removes a cleanup from linux-nat.c, replacing it with a\nscope_exit.\n\ngdb/ChangeLog:\n2019-01-23  Tom Tromey  <tom@tromey.com>\n\t    Pedro Alves  <palves@redhat.com>\n\n\t* linux-nat.c: Include scope-exit.h.\n\t(cleanup_target_stop): Remove.\n\t(linux_nat_target::static_tracepoint_markers_by_strid): Use\n\tSCOPE_EXIT.",
    "tree": {
      "sha": "f772610b174a828a2400ebfafb330a7adec930af",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f772610b174a828a2400ebfafb330a7adec930af"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1db93f14fae0b3a638324e5349fe56a0e625451e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1db93f14fae0b3a638324e5349fe56a0e625451e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1db93f14fae0b3a638324e5349fe56a0e625451e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1db93f14fae0b3a638324e5349fe56a0e625451e/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "palves",
    "id": 1202913,
    "node_id": "MDQ6VXNlcjEyMDI5MTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1202913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/palves",
    "html_url": "https://github.com/palves",
    "followers_url": "https://api.github.com/users/palves/followers",
    "following_url": "https://api.github.com/users/palves/following{/other_user}",
    "gists_url": "https://api.github.com/users/palves/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/palves/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/palves/subscriptions",
    "organizations_url": "https://api.github.com/users/palves/orgs",
    "repos_url": "https://api.github.com/users/palves/repos",
    "events_url": "https://api.github.com/users/palves/events{/privacy}",
    "received_events_url": "https://api.github.com/users/palves/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2cc83d1e0eeaad9927553ee157f810e43d47d24f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2cc83d1e0eeaad9927553ee157f810e43d47d24f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2cc83d1e0eeaad9927553ee157f810e43d47d24f"
    }
  ],
  "stats": {
    "total": 26,
    "additions": 11,
    "deletions": 15
  },
  "files": [
    {
      "sha": "4ee605196efa4ff6473e0309c5b7073f9e79ee77",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1db93f14fae0b3a638324e5349fe56a0e625451e/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1db93f14fae0b3a638324e5349fe56a0e625451e/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=1db93f14fae0b3a638324e5349fe56a0e625451e",
      "patch": "@@ -1,3 +1,11 @@\n+2019-01-23  Tom Tromey  <tom@tromey.com>\n+\t    Pedro Alves  <palves@redhat.com>\n+\n+\t* linux-nat.c: Include scope-exit.h.\n+\t(cleanup_target_stop): Remove.\n+\t(linux_nat_target::static_tracepoint_markers_by_strid): Use\n+\tSCOPE_EXIT.\n+\n 2019-01-23  Tom Tromey  <tom@tromey.com>\n \t    Pedro Alves  <palves@redhat.com>\n "
    },
    {
      "sha": "45da9fa9973359f5ed4845b5e138754080708b2d",
      "filename": "gdb/linux-nat.c",
      "status": "modified",
      "additions": 3,
      "deletions": 15,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1db93f14fae0b3a638324e5349fe56a0e625451e/gdb/linux-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1db93f14fae0b3a638324e5349fe56a0e625451e/gdb/linux-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/linux-nat.c?ref=1db93f14fae0b3a638324e5349fe56a0e625451e",
      "patch": "@@ -66,6 +66,7 @@\n #include \"objfiles.h\"\n #include \"nat/linux-namespaces.h\"\n #include \"fileio.h\"\n+#include \"common/scope-exit.h\"\n \n #ifndef SPUFS_MAGIC\n #define SPUFS_MAGIC 0x23c9b64e\n@@ -4223,22 +4224,10 @@ linux_nat_xfer_osdata (enum target_object object,\n     return TARGET_XFER_OK;\n }\n \n-static void\n-cleanup_target_stop (void *arg)\n-{\n-  ptid_t *ptid = (ptid_t *) arg;\n-\n-  gdb_assert (arg != NULL);\n-\n-  /* Unpause all */\n-  target_continue_no_signal (*ptid);\n-}\n-\n std::vector<static_tracepoint_marker>\n linux_nat_target::static_tracepoint_markers_by_strid (const char *strid)\n {\n   char s[IPA_CMD_BUF_SIZE];\n-  struct cleanup *old_chain;\n   int pid = inferior_ptid.pid ();\n   std::vector<static_tracepoint_marker> markers;\n   const char *p = s;\n@@ -4253,7 +4242,8 @@ linux_nat_target::static_tracepoint_markers_by_strid (const char *strid)\n \n   agent_run_command (pid, s, strlen (s) + 1);\n \n-  old_chain = make_cleanup (cleanup_target_stop, &ptid);\n+  /* Unpause all.  */\n+  SCOPE_EXIT { target_continue_no_signal (ptid); };\n \n   while (*p++ == 'm')\n     {\n@@ -4272,8 +4262,6 @@ linux_nat_target::static_tracepoint_markers_by_strid (const char *strid)\n       p = s;\n     }\n \n-  do_cleanups (old_chain);\n-\n   return markers;\n }\n "
    }
  ]
}