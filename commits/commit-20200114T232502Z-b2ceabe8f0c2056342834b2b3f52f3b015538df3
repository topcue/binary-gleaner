{
  "sha": "b2ceabe8f0c2056342834b2b3f52f3b015538df3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjJjZWFiZThmMGMyMDU2MzQyODM0YjJiM2Y1MmYzYjAxNTUzOGRmMw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-10-22T22:22:58Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-01-14T23:25:02Z"
    },
    "message": "Consolidate definition of USE_WIN32API\n\nI noticed that USE_WIN32API is defined separately by gdbserver and\ngdb.  However, because it is used by code in gdbsupport, it should be\ndefined by common.m4.  This approach ensures that the code will\ncontinue to work when it is moved to the top level.\n\ngdb/ChangeLog\n2020-01-14  Tom Tromey  <tom@tromey.com>\n\n\t* gdbsupport/common.m4 (GDB_AC_COMMON): Define WIN32APILIBS and\n\tUSE_WIN32API when needed.\n\t* configure.ac (USE_WIN32API): Don't define.\n\t(WIN32LIBS): Use WIN32APILIBS.\n\t* configure: Rebuild.\n\ngdb/gdbserver/ChangeLog\n2020-01-14  Tom Tromey  <tom@tromey.com>\n\n\t* configure.ac (LIBS): Use WIN32APILIBS.\n\t(USE_WIN32API): Don't define.\n\t* configure: Rebuild.\n\nChange-Id: I40d524d5445ebfb452b36f4d0e102f0b1e1089df",
    "tree": {
      "sha": "8b4c16a77281523092995fcff85984a7bad6a862",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8b4c16a77281523092995fcff85984a7bad6a862"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b2ceabe8f0c2056342834b2b3f52f3b015538df3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b2ceabe8f0c2056342834b2b3f52f3b015538df3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b2ceabe8f0c2056342834b2b3f52f3b015538df3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b2ceabe8f0c2056342834b2b3f52f3b015538df3/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "25c51f71d5bef8b4b71aa3e35cce974b54cda731",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/25c51f71d5bef8b4b71aa3e35cce974b54cda731",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/25c51f71d5bef8b4b71aa3e35cce974b54cda731"
    }
  ],
  "stats": {
    "total": 92,
    "additions": 55,
    "deletions": 37
  },
  "files": [
    {
      "sha": "85d7de25e8357c516098beadbab704dd3e8e6783",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -1,3 +1,11 @@\n+2020-01-14  Tom Tromey  <tom@tromey.com>\n+\n+\t* gdbsupport/common.m4 (GDB_AC_COMMON): Define WIN32APILIBS and\n+\tUSE_WIN32API when needed.\n+\t* configure.ac (USE_WIN32API): Don't define.\n+\t(WIN32LIBS): Use WIN32APILIBS.\n+\t* configure: Rebuild.\n+\n 2020-01-14  Tom Tromey  <tom@tromey.com>\n \n \t* configure: Rebuild."
    },
    {
      "sha": "fe2d887a1ab3b2e84cc44346f291c0c94dc3bf93",
      "filename": "gdb/configure",
      "status": "modified",
      "additions": 13,
      "deletions": 10,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -688,12 +688,12 @@ TCL_BIN_DIR\n TCL_PATCH_LEVEL\n TCL_VERSION\n WIN32LDAPP\n+WIN32LIBS\n GUI_CFLAGS_X\n LIBGUI\n LTLIBLZMA\n LIBLZMA\n HAVE_LIBLZMA\n-WIN32LIBS\n SER_HARDWIRE\n WERROR_CFLAGS\n WARN_CFLAGS\n@@ -13567,6 +13567,16 @@ _ACEOF\n fi\n \n \n+  WIN32APILIBS=\n+  case ${host} in\n+    *mingw32*)\n+\n+$as_echo \"#define USE_WIN32API 1\" >>confdefs.h\n+\n+      WIN32APILIBS=\"-lws2_32\"\n+      ;;\n+  esac\n+\n \n   { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for nl_langinfo and CODESET\" >&5\n $as_echo_n \"checking for nl_langinfo and CODESET... \" >&6; }\n@@ -16356,15 +16366,8 @@ if test x\"$gdb_cv_os_cygwin\" = xyes; then\n fi\n \n # The ser-tcp.c module requires sockets.\n-case ${host} in\n-  *mingw32*)\n-\n-$as_echo \"#define USE_WIN32API 1\" >>confdefs.h\n-\n-    WIN32LIBS=\"$WIN32LIBS -lws2_32\"\n-    ;;\n-esac\n-\n+# Note that WIN32APILIBS is set by GDB_AC_COMMON.\n+WIN32LIBS=\"$WIN32LIBS $WIN32APILIBS\"\n \n # Add ELF support to GDB, but only if BFD includes ELF support.\n "
    },
    {
      "sha": "a7b744bf241cb87cc6d0399fd210f79a3c12b115",
      "filename": "gdb/configure.ac",
      "status": "modified",
      "additions": 2,
      "deletions": 11,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure.ac?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -1827,17 +1827,8 @@ if test x\"$gdb_cv_os_cygwin\" = xyes; then\n fi\n \n # The ser-tcp.c module requires sockets.\n-case ${host} in\n-  *mingw32*)\n-    AC_DEFINE(USE_WIN32API, 1,\n-              [Define if we should use the Windows API, instead of the\n-\t       POSIX API.  On Windows, we use the Windows API when\n-\t       building for MinGW, but the POSIX API when building\n-\t       for Cygwin.])\n-    WIN32LIBS=\"$WIN32LIBS -lws2_32\"\n-    ;;\n-esac\n-AC_SUBST(WIN32LIBS)\n+# Note that WIN32APILIBS is set by GDB_AC_COMMON.\n+WIN32LIBS=\"$WIN32LIBS $WIN32APILIBS\"\n \n # Add ELF support to GDB, but only if BFD includes ELF support.\n GDB_AC_CHECK_BFD([for ELF support in BFD], gdb_cv_var_elf,"
    },
    {
      "sha": "6d9e314670693192f58334e4ddbb54e5fdb483fb",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -1,3 +1,9 @@\n+2020-01-14  Tom Tromey  <tom@tromey.com>\n+\n+\t* configure.ac (LIBS): Use WIN32APILIBS.\n+\t(USE_WIN32API): Don't define.\n+\t* configure: Rebuild.\n+\n 2020-01-14  Tom Tromey  <tom@tromey.com>\n \n \t* configure: Rebuild."
    },
    {
      "sha": "154eeac7f0c67249c0bd89535961162841693976",
      "filename": "gdb/gdbserver/configure",
      "status": "modified",
      "additions": 12,
      "deletions": 7,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbserver/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbserver/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/configure?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -6959,6 +6959,16 @@ _ACEOF\n fi\n \n \n+  WIN32APILIBS=\n+  case ${host} in\n+    *mingw32*)\n+\n+$as_echo \"#define USE_WIN32API 1\" >>confdefs.h\n+\n+      WIN32APILIBS=\"-lws2_32\"\n+      ;;\n+  esac\n+\n \n   { $as_echo \"$as_me:${as_lineno-$LINENO}: checking for nl_langinfo and CODESET\" >&5\n $as_echo_n \"checking for nl_langinfo and CODESET... \" >&6; }\n@@ -8705,19 +8715,14 @@ esac\n if test \"${srv_mingwce}\" = \"yes\"; then\n   LIBS=\"$LIBS -lws2\"\n elif test \"${srv_mingw}\" = \"yes\"; then\n-  LIBS=\"$LIBS -lws2_32\"\n+  # WIN32APILIBS is set by GDB_AC_COMMON.\n+  LIBS=\"$LIBS $WIN32APILIBS\"\n elif test \"${srv_qnx}\" = \"yes\"; then\n   LIBS=\"$LIBS -lsocket\"\n elif test \"${srv_lynxos}\" = \"yes\"; then\n   LIBS=\"$LIBS -lnetinet\"\n fi\n \n-if test \"${srv_mingw}\" = \"yes\"; then\n-\n-$as_echo \"#define USE_WIN32API 1\" >>confdefs.h\n-\n-fi\n-\n if test \"${srv_linux_usrregs}\" = \"yes\"; then\n \n $as_echo \"#define HAVE_LINUX_USRREGS 1\" >>confdefs.h"
    },
    {
      "sha": "fab765ea38df495ee2d9ceac066bf374e1dcd5b2",
      "filename": "gdb/gdbserver/configure.ac",
      "status": "modified",
      "additions": 2,
      "deletions": 9,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbserver/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbserver/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/configure.ac?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -248,21 +248,14 @@ esac\n if test \"${srv_mingwce}\" = \"yes\"; then\n   LIBS=\"$LIBS -lws2\"\n elif test \"${srv_mingw}\" = \"yes\"; then\n-  LIBS=\"$LIBS -lws2_32\"\n+  # WIN32APILIBS is set by GDB_AC_COMMON.\n+  LIBS=\"$LIBS $WIN32APILIBS\"\n elif test \"${srv_qnx}\" = \"yes\"; then\n   LIBS=\"$LIBS -lsocket\"\n elif test \"${srv_lynxos}\" = \"yes\"; then\n   LIBS=\"$LIBS -lnetinet\"\n fi\n \n-if test \"${srv_mingw}\" = \"yes\"; then\n-  AC_DEFINE(USE_WIN32API, 1,\n-\t    [Define if we should use the Windows API, instead of the\n-\t     POSIX API.  On Windows, we use the Windows API when\n-\t     building for MinGW, but the POSIX API when building\n-\t     for Cygwin.])\n-fi\n-\n if test \"${srv_linux_usrregs}\" = \"yes\"; then\n   AC_DEFINE(HAVE_LINUX_USRREGS, 1,\n \t    [Define if the target supports PTRACE_PEEKUSR for register ]"
    },
    {
      "sha": "9e15940eead9de85087c6b8a8bf74852d373ff59",
      "filename": "gdb/gdbsupport/common.m4",
      "status": "modified",
      "additions": 12,
      "deletions": 0,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbsupport/common.m4",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b2ceabe8f0c2056342834b2b3f52f3b015538df3/gdb/gdbsupport/common.m4",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbsupport/common.m4?ref=b2ceabe8f0c2056342834b2b3f52f3b015538df3",
      "patch": "@@ -21,6 +21,18 @@ AC_DEFUN([GDB_AC_COMMON], [\n   AC_HEADER_STDC\n   AC_FUNC_ALLOCA\n \n+  WIN32APILIBS=\n+  case ${host} in\n+    *mingw32*)\n+      AC_DEFINE(USE_WIN32API, 1,\n+\t\t[Define if we should use the Windows API, instead of the\n+\t\t POSIX API.  On Windows, we use the Windows API when\n+\t\t building for MinGW, but the POSIX API when building\n+\t\t for Cygwin.])\n+      WIN32APILIBS=\"-lws2_32\"\n+      ;;\n+  esac\n+\n   dnl Note that this requires codeset.m4, which is included\n   dnl by the users of common.m4.\n   AM_LANGINFO_CODESET"
    }
  ]
}