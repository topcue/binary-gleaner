{
  "sha": "7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6N2U0NWU3YTlhYjM4ZWU5MDRjYTYyZWQ5OTM0ZTkzM2ZkYjFkNmU5Yw==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-12-05T02:54:47Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-12-05T02:54:47Z"
    },
    "message": "x86-64: Convert load to mov only for GOTPCRELX relocations\n\nSince converting load to mov needs to rewrite the REX byte and we don't\nknow if there is a REX byte with GOTPCREL relocation, do it only for\nGOTPCRELX relocations.\n\nbfd/\n\n\tPR ld/27016\n\t* elf64-x86-64.c (elf_x86_64_convert_load_reloc): Convert load\n\tto mov only for GOTPCRELX relocations.\n\nld/\n\n\tPR ld/27016\n\t* testsuite/ld-x86-64/x86-64.exp: Run pr27016a and pr27016b.\n\t* testsuite/ld-x86-64/pr27016a.d: New file.\n\t* testsuite/ld-x86-64/pr27016a.s: Likewise.\n\t* testsuite/ld-x86-64/pr27016b.d: Likewise.\n\t* testsuite/ld-x86-64/pr27016b.s: Likewise.",
    "tree": {
      "sha": "685148c069150cb4bd123fd31be9ef7267951971",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/685148c069150cb4bd123fd31be9ef7267951971"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4979ae6a9edb63b2b4c466bf247e4b85706efb18",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4979ae6a9edb63b2b4c466bf247e4b85706efb18",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4979ae6a9edb63b2b4c466bf247e4b85706efb18"
    }
  ],
  "stats": {
    "total": 92,
    "additions": 91,
    "deletions": 1
  },
  "files": [
    {
      "sha": "2d1e4da18f2d65262f380e154c0952c8c952278d",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -1,3 +1,9 @@\n+2020-12-04  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27016\n+\t* elf64-x86-64.c (elf_x86_64_convert_load_reloc): Convert load\n+\tto mov only for GOTPCRELX relocations.\n+\n 2020-12-04  Alan Modra  <amodra@gmail.com>\n \n \tPR 26978"
    },
    {
      "sha": "bb339671717be2b8c8bd7cf3a776bce5b7ac3af5",
      "filename": "bfd/elf64-x86-64.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/bfd/elf64-x86-64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/bfd/elf64-x86-64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-x86-64.c?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -1731,7 +1731,7 @@ elf_x86_64_convert_load_reloc (bfd *abfd,\n \n       if (opcode == 0x8b)\n \t{\n-\t  if (abs_symbol && local_ref)\n+\t  if (abs_symbol && local_ref && relocx)\n \t    to_reloc_pc32 = FALSE;\n \n \t  if (to_reloc_pc32)"
    },
    {
      "sha": "f33bd41b01b679a43829c99a141ad80f0e21d340",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -1,3 +1,12 @@\n+2020-12-04  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/27016\n+\t* testsuite/ld-x86-64/x86-64.exp: Run pr27016a and pr27016b.\n+\t* testsuite/ld-x86-64/pr27016a.d: New file.\n+\t* testsuite/ld-x86-64/pr27016a.s: Likewise.\n+\t* testsuite/ld-x86-64/pr27016b.d: Likewise.\n+\t* testsuite/ld-x86-64/pr27016b.s: Likewise.\n+\n 2020-12-04  Alan Modra  <amodra@gmail.com>\n \n \t* testsuite/ld-elf/pr26978a.d,"
    },
    {
      "sha": "88fba0a37f41054557c75db91bf81f123103e887",
      "filename": "ld/testsuite/ld-x86-64/pr27016a.d",
      "status": "added",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr27016a.d?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -0,0 +1,23 @@\n+#source: pr27016a.s\n+#source: pr27016b.s\n+#as: --64 -mx86-used-note=no -mrelax-relocations=no\n+#ld: -m elf_x86_64 -z max-page-size=0x200000 -z noseparate-code -e main\n+#objdump: -dw\n+\n+.*: +file format .*\n+\n+\n+Disassembly of section .text:\n+\n+0+4000e8 <main>:\n+ +[a-f0-9]+:\t55                   \tpush   %rbp\n+ +[a-f0-9]+:\t48 89 e5             \tmov    %rsp,%rbp\n+ +[a-f0-9]+:\t4c 8d 1d 39 3f 00 00 \tlea    0x3f39\\(%rip\\),%r11        # 40402c <thesym>\n+ +[a-f0-9]+:\t41 8b 03             \tmov    \\(%r11\\),%eax\n+ +[a-f0-9]+:\t8d 50 01             \tlea    0x1\\(%rax\\),%edx\n+ +[a-f0-9]+:\t4c 8d 1d 2c 3f 00 00 \tlea    0x3f2c\\(%rip\\),%r11        # 40402c <thesym>\n+ +[a-f0-9]+:\t41 89 13             \tmov    %edx,\\(%r11\\)\n+ +[a-f0-9]+:\tb8 00 00 00 00       \tmov    \\$0x0,%eax\n+ +[a-f0-9]+:\t5d                   \tpop    %rbp\n+ +[a-f0-9]+:\tc3                   \tret    \n+#pass"
    },
    {
      "sha": "b64851a5ffbb3ac4fe4f790de4f63cbc2008df62",
      "filename": "ld/testsuite/ld-x86-64/pr27016a.s",
      "status": "added",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016a.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016a.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr27016a.s?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -0,0 +1,23 @@\n+        .text\n+        .comm   global_int,4,4\n+        .globl  main\n+        .type   main, @function\n+main:\n+        .cfi_startproc\n+        pushq   %rbp\n+        .cfi_def_cfa_offset 16\n+        .cfi_offset 6, -16\n+        movq    %rsp, %rbp\n+        .cfi_def_cfa_register 6\n+        movq    thesym@GOTPCREL(%rip), %r11\n+        movl    (%r11), %eax\n+        leal    1(%rax), %edx\n+        movq    thesym@GOTPCREL(%rip), %r11\n+        movl    %edx, (%r11)\n+        movl    $0, %eax\n+        popq    %rbp\n+        .cfi_def_cfa 7, 8\n+        ret\n+        .cfi_endproc\n+        .size   main, .-main\n+        .section        .note.GNU-stack,\"\",@progbits"
    },
    {
      "sha": "b17273632129a9b4f64d369eb2421c4222bba5f4",
      "filename": "ld/testsuite/ld-x86-64/pr27016b.d",
      "status": "added",
      "additions": 23,
      "deletions": 0,
      "changes": 23,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr27016b.d?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -0,0 +1,23 @@\n+#source: pr27016a.s\n+#source: pr27016b.s\n+#as: --64 -mx86-used-note=no -mrelax-relocations=yes\n+#ld: -m elf_x86_64 -z max-page-size=0x200000 -z noseparate-code -e main\n+#objdump: -dw\n+\n+.*: +file format .*\n+\n+\n+Disassembly of section .text:\n+\n+0+4000e8 <main>:\n+ +[a-f0-9]+:\t55                   \tpush   %rbp\n+ +[a-f0-9]+:\t48 89 e5             \tmov    %rsp,%rbp\n+ +[a-f0-9]+:\t49 c7 c3 2c 40 40 00 \tmov    \\$0x40402c,%r11\n+ +[a-f0-9]+:\t41 8b 03             \tmov    \\(%r11\\),%eax\n+ +[a-f0-9]+:\t8d 50 01             \tlea    0x1\\(%rax\\),%edx\n+ +[a-f0-9]+:\t49 c7 c3 2c 40 40 00 \tmov    \\$0x40402c,%r11\n+ +[a-f0-9]+:\t41 89 13             \tmov    %edx,\\(%r11\\)\n+ +[a-f0-9]+:\tb8 00 00 00 00       \tmov    \\$0x0,%eax\n+ +[a-f0-9]+:\t5d                   \tpop    %rbp\n+ +[a-f0-9]+:\tc3                   \tret    \n+#pass"
    },
    {
      "sha": "ded8d7a826c4e5a04d9ff5f3bc21d8d33bc9f74d",
      "filename": "ld/testsuite/ld-x86-64/pr27016b.s",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016b.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/pr27016b.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr27016b.s?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -0,0 +1,4 @@\n+\t.globl thesym\n+thesym = 0x40402c\n+\n+\t.section        .note.GNU-stack,\"\",@progbits"
    },
    {
      "sha": "41d385bf058c083ed29aa1193650c9ed4edfab28",
      "filename": "ld/testsuite/ld-x86-64/x86-64.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/x86-64.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c/ld/testsuite/ld-x86-64/x86-64.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/x86-64.exp?ref=7e45e7a9ab38ee904ca62ed9934e933fdb1d6e9c",
      "patch": "@@ -661,6 +661,8 @@ run_dump_test \"pr22048\"\n run_dump_test \"pr22929\"\n run_dump_test \"pr26939\"\n run_dump_test \"pr26939-x32\"\n+run_dump_test \"pr27016a\"\n+run_dump_test \"pr27016b\"\n \n proc undefined_weak {cflags ldflags} {\n     set testname \"Undefined weak symbol\""
    }
  ]
}