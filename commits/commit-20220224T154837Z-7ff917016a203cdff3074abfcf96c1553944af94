{
  "sha": "7ff917016a203cdff3074abfcf96c1553944af94",
  "node_id": "C_kwDOANOeidoAKDdmZjkxNzAxNmEyMDNjZGZmMzA3NGFiZmNmOTZjMTU1Mzk0NGFmOTQ",
  "commit": {
    "author": {
      "name": "Dominique Quatravaux",
      "email": "dominique.quatravaux@epfl.ch",
      "date": "2022-02-24T14:23:21Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2022-02-24T15:48:37Z"
    },
    "message": "gdb/darwin: skip over WIFSTOPPED wait4 status\n\nOn modern Darwin's, there appears to be a new circumstance in which a\nMACH_NOTIFY_DEAD_NAME message can be received, and which was not\npreviously accounted for: to signal the WIFSTOPPED condition in the\ndebuggee. In that case the debuggee is not dead yet (and in fact,\ncounting it as dead would cause a zombie leak - A process in such a\nstate reparents to PID 1, but cannot be killed).\n\n - Read and ignore such messages (counting on the next exception message\n   to let us know of the inferior's new state again)\n - Refactor logging so as to clearly distinguish between the\n   MACH_NOTIFY_DEAD_NAME cases (WIFEXITED, WIFSTOPPED, signal, or\n   something else), and warn in the last case\n\nCo-authored-by: Louis-He <1726110778@qq.com>\nCo-authored-by: Philippe Blain <levraiphilippeblain@gmail.com>\nChange-Id: Ie86904a894e9bd154e6b674b1bfbfbaee7fde3e1",
    "tree": {
      "sha": "e2a5a9a3d7a868acdff2b2f87e5e705bd30ff2f5",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e2a5a9a3d7a868acdff2b2f87e5e705bd30ff2f5"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7ff917016a203cdff3074abfcf96c1553944af94",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7ff917016a203cdff3074abfcf96c1553944af94",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7ff917016a203cdff3074abfcf96c1553944af94",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7ff917016a203cdff3074abfcf96c1553944af94/comments",
  "author": null,
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "0b313e95a73ad567915c9c1135d3d49f39236325",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0b313e95a73ad567915c9c1135d3d49f39236325",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0b313e95a73ad567915c9c1135d3d49f39236325"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 25,
    "deletions": 6
  },
  "files": [
    {
      "sha": "adbe7474c6876412e8db1c6311c89e9bc8a1ffa3",
      "filename": "gdb/darwin-nat.c",
      "status": "modified",
      "additions": 25,
      "deletions": 6,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7ff917016a203cdff3074abfcf96c1553944af94/gdb/darwin-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7ff917016a203cdff3074abfcf96c1553944af94/gdb/darwin-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/darwin-nat.c?ref=7ff917016a203cdff3074abfcf96c1553944af94",
      "patch": "@@ -1063,7 +1063,7 @@ darwin_nat_target::decode_message (mach_msg_header_t *hdr,\n     }\n   else if (hdr->msgh_id == 0x48)\n     {\n-      /* MACH_NOTIFY_DEAD_NAME: notification for exit.  */\n+      /* MACH_NOTIFY_DEAD_NAME: notification for exit *or* WIFSTOPPED.  */\n       int res;\n \n       res = darwin_decode_notify_message (hdr, &inf);\n@@ -1103,15 +1103,34 @@ darwin_nat_target::decode_message (mach_msg_header_t *hdr,\n \t\t  return minus_one_ptid;\n \t\t}\n \t      if (WIFEXITED (wstatus))\n-\t\tstatus->set_exited (WEXITSTATUS (wstatus));\n-\t      else\n+\t\t{\n+\t\t  status->set_exited (WEXITSTATUS (wstatus));\n+\t          inferior_debug (4, _(\"darwin_wait: pid=%d exit, status=0x%x\\n\"),\n+\t\t\t\t  res_pid, wstatus);\n+\t\t}\n+\t      else if (WIFSTOPPED (wstatus))\n+\t\t{\n+\t\t  /* Ignore stopped state, it will be handled by the next\n+\t\t     exception.  */\n+\t\t  status->set_ignore ();\n+\t\t  inferior_debug (4, _(\"darwin_wait: pid %d received WIFSTOPPED\\n\"),\n+\t\t\t\t  res_pid);\n+\t\t  return minus_one_ptid;\n+\t\t}\n+\t      else if (WIFSIGNALED (wstatus))\n \t\t{\n \t\t  status->set_signalled\n \t\t    (gdb_signal_from_host (WTERMSIG (wstatus)));\n+\t\t  inferior_debug (4, _(\"darwin_wait: pid=%d received signal %d\\n\"),\n+\t\t\t\t  res_pid, status->sig());\n+\t\t}\n+\t      else\n+\t\t{\n+\t\t  status->set_ignore ();\n+\t\t  warning (_(\"Unexpected wait status after MACH_NOTIFY_DEAD_NAME \"\n+\t\t             \"notification: 0x%x\"), wstatus);\n+\t\t  return minus_one_ptid;\n \t\t}\n-\n-\t      inferior_debug (4, _(\"darwin_wait: pid=%d exit, status=0x%x\\n\"),\n-\t\t\t      res_pid, wstatus);\n \n \t      return ptid_t (inf->pid);\n \t    }"
    }
  ]
}