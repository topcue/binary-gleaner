{
  "sha": "8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OGY3YjIyZWEyYTk1Y2NhYjZhZWFkZGNkZWU3NDcyZGJkYmNmYjRkMw==",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-03-25T16:32:46Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-03-25T16:32:51Z"
    },
    "message": "libctf: fix ELF-in-BFD checks in the presence of ASAN\n\nThe address sanitizer contains a redirector that captures dlopen calls,\nso checks for dlopen with AC_SEARCH_LIBS will always conclude that\ndlopen is present when the sanitizer is on.  This means it won't add\n-ldl to LIBS even if needed, and the immediately-following attempt to\nactually link with -lbfd will fail because libbfd also needs dlsym,\nwhich ASAN does *not* contain a redirector for.\n\nIf we check for dlsym instead of dlopen, the check works whether ASAN is\non or off.  (bfd uses both in close proximity: if it needs one, it will\nalways need the other.)\n\nlibctf/ChangeLog\n2021-03-25  Nick Alcock  <nick.alcock@oracle.com>\n\n\t* configure.ac: Check for dlsym, not dlopen.\n\t* configure: Regenerate.",
    "tree": {
      "sha": "99146cfc862fde4ea37024b82f971122e860414b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/99146cfc862fde4ea37024b82f971122e860414b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "15131809c235047c94387ef9aff207117191ed0b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/15131809c235047c94387ef9aff207117191ed0b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/15131809c235047c94387ef9aff207117191ed0b"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 18,
    "deletions": 13
  },
  "files": [
    {
      "sha": "e66224a4fd1d8d4da7513149f1e006a6276afa69",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
      "patch": "@@ -1,3 +1,8 @@\n+2021-03-25  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* configure.ac: Check for dlsym, not dlopen.\n+\t* configure: Regenerate.\n+\n 2021-03-25  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* testsuite/libctf-writable/symtypetab-nonlinker-writeout.c: Don't"
    },
    {
      "sha": "82bcf13a6061ae4fcd82d0d67731fb8fa995697f",
      "filename": "libctf/configure",
      "status": "modified",
      "additions": 12,
      "deletions": 12,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/libctf/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/libctf/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/configure?ref=8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
      "patch": "@@ -12798,9 +12798,9 @@ fi\n rm -f conftest.mmap conftest.txt\n \n # Needed for BFD capability checks.\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for library containing dlopen\" >&5\n-$as_echo_n \"checking for library containing dlopen... \" >&6; }\n-if ${ac_cv_search_dlopen+:} false; then :\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking for library containing dlsym\" >&5\n+$as_echo_n \"checking for library containing dlsym... \" >&6; }\n+if ${ac_cv_search_dlsym+:} false; then :\n   $as_echo_n \"(cached) \" >&6\n else\n   ac_func_search_save_LIBS=$LIBS\n@@ -12813,11 +12813,11 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext\n #ifdef __cplusplus\n extern \"C\"\n #endif\n-char dlopen ();\n+char dlsym ();\n int\n main ()\n {\n-return dlopen ();\n+return dlsym ();\n   ;\n   return 0;\n }\n@@ -12830,25 +12830,25 @@ for ac_lib in '' dl; do\n     LIBS=\"-l$ac_lib  $ac_func_search_save_LIBS\"\n   fi\n   if ac_fn_c_try_link \"$LINENO\"; then :\n-  ac_cv_search_dlopen=$ac_res\n+  ac_cv_search_dlsym=$ac_res\n fi\n rm -f core conftest.err conftest.$ac_objext \\\n     conftest$ac_exeext\n-  if ${ac_cv_search_dlopen+:} false; then :\n+  if ${ac_cv_search_dlsym+:} false; then :\n   break\n fi\n done\n-if ${ac_cv_search_dlopen+:} false; then :\n+if ${ac_cv_search_dlsym+:} false; then :\n \n else\n-  ac_cv_search_dlopen=no\n+  ac_cv_search_dlsym=no\n fi\n rm conftest.$ac_ext\n LIBS=$ac_func_search_save_LIBS\n fi\n-{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_dlopen\" >&5\n-$as_echo \"$ac_cv_search_dlopen\" >&6; }\n-ac_res=$ac_cv_search_dlopen\n+{ $as_echo \"$as_me:${as_lineno-$LINENO}: result: $ac_cv_search_dlsym\" >&5\n+$as_echo \"$ac_cv_search_dlsym\" >&6; }\n+ac_res=$ac_cv_search_dlsym\n if test \"$ac_res\" != no; then :\n   test \"$ac_res\" = \"none required\" || LIBS=\"$ac_res $LIBS\"\n "
    },
    {
      "sha": "80644b89d67a9ba50076fbf87661a9447c153344",
      "filename": "libctf/configure.ac",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/libctf/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3/libctf/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/configure.ac?ref=8f7b22ea2a95ccab6aeaddcdee7472dbdbcfb4d3",
      "patch": "@@ -68,7 +68,7 @@ ACX_PROG_CC_WARNING_OPTS([-Wall], [ac_libctf_warn_cflags])\n \n AC_FUNC_MMAP\n # Needed for BFD capability checks.\n-AC_SEARCH_LIBS(dlopen, dl)\n+AC_SEARCH_LIBS(dlsym, dl)\n AM_ZLIB\n \n GCC_ENABLE([libctf-hash-debugging], [no], [], [Enable expensive debugging of CTF deduplication type hashing])"
    }
  ]
}