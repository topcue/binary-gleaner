{
  "sha": "3c568b8afab512d12eb5adcf304e505b1bce644d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6M2M1NjhiOGFmYWI1MTJkMTJlYjVhZGNmMzA0ZTUwNWIxYmNlNjQ0ZA==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-05-19T22:25:56Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-05-19T22:29:15Z"
    },
    "message": "PR26011, excessive memory allocation with fuzzed reloc sections\n\nCheck sizes early, before users of slurp_relocs allocate buffers for\nthe swapped in relocs.\n\n\tPR 26011\n\t* elf.c (_bfd_elf_get_reloc_upper_bound): Sanity check reloc\n\tsection size against file size.\n\t(_bfd_elf_get_dynamic_reloc_upper_bound): Likewise.",
    "tree": {
      "sha": "ee5f7e9f4f5a438c803192e2ca709f7f6cde825f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/ee5f7e9f4f5a438c803192e2ca709f7f6cde825f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3c568b8afab512d12eb5adcf304e505b1bce644d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3c568b8afab512d12eb5adcf304e505b1bce644d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3c568b8afab512d12eb5adcf304e505b1bce644d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3c568b8afab512d12eb5adcf304e505b1bce644d/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c7e976792002c6a2810f9bb6cc3ad210514eb650",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c7e976792002c6a2810f9bb6cc3ad210514eb650",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c7e976792002c6a2810f9bb6cc3ad210514eb650"
    }
  ],
  "stats": {
    "total": 44,
    "additions": 41,
    "deletions": 3
  },
  "files": [
    {
      "sha": "6d3673d14c156df81f4ad15c83ae2191cc5e0f5f",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c568b8afab512d12eb5adcf304e505b1bce644d/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c568b8afab512d12eb5adcf304e505b1bce644d/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=3c568b8afab512d12eb5adcf304e505b1bce644d",
      "patch": "@@ -1,3 +1,10 @@\n+2020-05-20  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 26011\n+\t* elf.c (_bfd_elf_get_reloc_upper_bound): Sanity check reloc\n+\tsection size against file size.\n+\t(_bfd_elf_get_dynamic_reloc_upper_bound): Likewise.\n+\n 2020-05-19  Gunther Nikl  <gnikl@justmail.de>\n \n \tPR 26005"
    },
    {
      "sha": "0211970991c1d6d9ffe5ad3fbd8534acae9cd330",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 34,
      "deletions": 3,
      "changes": 37,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3c568b8afab512d12eb5adcf304e505b1bce644d/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3c568b8afab512d12eb5adcf304e505b1bce644d/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=3c568b8afab512d12eb5adcf304e505b1bce644d",
      "patch": "@@ -8508,9 +8508,23 @@ _bfd_elf_get_dynamic_symtab_upper_bound (bfd *abfd)\n }\n \n long\n-_bfd_elf_get_reloc_upper_bound (bfd *abfd ATTRIBUTE_UNUSED,\n-\t\t\t\tsec_ptr asect)\n+_bfd_elf_get_reloc_upper_bound (bfd *abfd, sec_ptr asect)\n {\n+  if (asect->reloc_count != 0)\n+    {\n+      /* Sanity check reloc section size.  */\n+      struct bfd_elf_section_data *d = elf_section_data (asect);\n+      Elf_Internal_Shdr *rel_hdr = &d->this_hdr;\n+      bfd_size_type ext_rel_size = rel_hdr->sh_size;\n+      ufile_ptr filesize = bfd_get_file_size (abfd);\n+\n+      if (filesize != 0 && ext_rel_size > filesize)\n+\t{\n+\t  bfd_set_error (bfd_error_file_truncated);\n+\t  return -1;\n+\t}\n+    }\n+\n #if SIZEOF_LONG == SIZEOF_INT\n   if (asect->reloc_count >= LONG_MAX / sizeof (arelent *))\n     {\n@@ -8576,7 +8590,7 @@ _bfd_elf_canonicalize_dynamic_symtab (bfd *abfd,\n long\n _bfd_elf_get_dynamic_reloc_upper_bound (bfd *abfd)\n {\n-  bfd_size_type count;\n+  bfd_size_type count, ext_rel_size;\n   asection *s;\n \n   if (elf_dynsymtab (abfd) == 0)\n@@ -8586,18 +8600,35 @@ _bfd_elf_get_dynamic_reloc_upper_bound (bfd *abfd)\n     }\n \n   count = 1;\n+  ext_rel_size = 0;\n   for (s = abfd->sections; s != NULL; s = s->next)\n     if (elf_section_data (s)->this_hdr.sh_link == elf_dynsymtab (abfd)\n \t&& (elf_section_data (s)->this_hdr.sh_type == SHT_REL\n \t    || elf_section_data (s)->this_hdr.sh_type == SHT_RELA))\n       {\n+\text_rel_size += s->size;\n+\tif (ext_rel_size < s->size)\n+\t  {\n+\t    bfd_set_error (bfd_error_file_truncated);\n+\t    return -1;\n+\t  }\n \tcount += s->size / elf_section_data (s)->this_hdr.sh_entsize;\n \tif (count > LONG_MAX / sizeof (arelent *))\n \t  {\n \t    bfd_set_error (bfd_error_file_too_big);\n \t    return -1;\n \t  }\n       }\n+  if (count > 1)\n+    {\n+      /* Sanity check reloc section sizes.  */\n+      ufile_ptr filesize = bfd_get_file_size (abfd);\n+      if (filesize != 0 && ext_rel_size > filesize)\n+\t{\n+\t  bfd_set_error (bfd_error_file_truncated);\n+\t  return -1;\n+\t}\n+    }\n   return count * sizeof (arelent *);\n }\n "
    }
  ]
}