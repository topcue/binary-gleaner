{
  "sha": "99bb393f1d107cf2c4016c486f85625d362027a7",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTliYjM5M2YxZDEwN2NmMmM0MDE2YzQ4NmY4NTYyNWQzNjIwMjdhNw==",
  "commit": {
    "author": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-09-23T16:16:24Z"
    },
    "committer": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-09-24T17:01:22Z"
    },
    "message": "Handle 64bit breakpoints of WOW64 processes as SIGINT\n\nWhen a WOW64 process triggers a breakpoint exception in 64bit code (which\nhappens when a 64bit gdb calls DebugBreakProcess for a 32bit target),\ngdb ignores the breakpoint (because Wow64GetThreadContext can only report\nthe pc of 32bit code, and there is not int3 at this location).\n\nBut if these 64bit breakpoint exceptions are handled as SIGINT, gdb\ndoesn't check for int3, and always stops the target.\n\ngdb/ChangeLog:\n\n2020-09-23  Hannes Domani  <ssbssa@yahoo.de>\n\n\t* nat/windows-nat.c (handle_exception): Handle 64bit breakpoints\n\tin WOW64 processes as SIGINT.\n\t* nat/windows-nat.h: Make wow64_process a shared variable.\n\t* windows-nat.c: Remove static wow64_process variable.\n\ngdbserver/ChangeLog:\n\n2020-09-23  Hannes Domani  <ssbssa@yahoo.de>\n\n\t* win32-low.cc: Remove local wow64_process variable.\n\t* win32-low.h: Remove local wow64_process variable.",
    "tree": {
      "sha": "4f39cc9663e5066636eca71bdefffca999bda68b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/4f39cc9663e5066636eca71bdefffca999bda68b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/99bb393f1d107cf2c4016c486f85625d362027a7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/99bb393f1d107cf2c4016c486f85625d362027a7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/99bb393f1d107cf2c4016c486f85625d362027a7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/99bb393f1d107cf2c4016c486f85625d362027a7/comments",
  "author": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "6eee0315f6767ba932f19513af1ff432e5071bea",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6eee0315f6767ba932f19513af1ff432e5071bea",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/6eee0315f6767ba932f19513af1ff432e5071bea"
    }
  ],
  "stats": {
    "total": 36,
    "additions": 29,
    "deletions": 7
  },
  "files": [
    {
      "sha": "3b851dba41ece1d4696d0f1b1b7b267cd007bfac",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -1,3 +1,10 @@\n+2020-09-23  Hannes Domani  <ssbssa@yahoo.de>\n+\n+\t* nat/windows-nat.c (handle_exception): Handle 64bit breakpoints\n+\tin WOW64 processes as SIGINT.\n+\t* nat/windows-nat.h: Make wow64_process a shared variable.\n+\t* windows-nat.c: Remove static wow64_process variable.\n+\n 2020-09-23  Tom Tromey  <tom@tromey.com>\n \n \tPR symtab/25470:"
    },
    {
      "sha": "2cbbc0f2ccb03f3c6e5073cce5d960afbbe7e359",
      "filename": "gdb/nat/windows-nat.c",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/nat/windows-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/nat/windows-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/windows-nat.c?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -41,6 +41,7 @@ std::vector<pending_stop> pending_stops;\n EXCEPTION_RECORD siginfo_er;\n \n #ifdef __x86_64__\n+bool wow64_process = false;\n bool ignore_first_breakpoint = false;\n #endif\n \n@@ -240,6 +241,20 @@ handle_exception (struct target_waitstatus *ourstatus, bool debug_exceptions)\n \t  ourstatus->kind = TARGET_WAITKIND_SPURIOUS;\n \t  ignore_first_breakpoint = false;\n \t}\n+      else if (wow64_process)\n+\t{\n+\t  /* This breakpoint exception is triggered for WOW64 processes when\n+\t     reaching an int3 instruction in 64bit code.\n+\t     gdb checks for int3 in case of SIGTRAP, this fails because\n+\t     Wow64GetThreadContext can only report the pc of 32bit code, and\n+\t     gdb lets the target process continue.\n+\t     So handle it as SIGINT instead, then the target is stopped\n+\t     unconditionally.  */\n+\t  DEBUG_EXCEPTION_SIMPLE (\"EXCEPTION_BREAKPOINT\");\n+\t  rec->ExceptionCode = DBG_CONTROL_C;\n+\t  ourstatus->value.sig = GDB_SIGNAL_INT;\n+\t  break;\n+\t}\n #endif\n       /* FALLTHROUGH */\n     case STATUS_WX86_BREAKPOINT:"
    },
    {
      "sha": "9bfcb16865c471a51d6694f6ddf4d4e2c84e4e6a",
      "filename": "gdb/nat/windows-nat.h",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/nat/windows-nat.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/nat/windows-nat.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/nat/windows-nat.h?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -215,6 +215,8 @@ extern std::vector<pending_stop> pending_stops;\n extern EXCEPTION_RECORD siginfo_er;\n \n #ifdef __x86_64__\n+/* The target is a WOW64 process */\n+extern bool wow64_process;\n /* Ignore first breakpoint exception of WOW64 process */\n extern bool ignore_first_breakpoint;\n #endif"
    },
    {
      "sha": "7fff41de760a32a0b7c13bf84c95c72af3ddfef0",
      "filename": "gdb/windows-nat.c",
      "status": "modified",
      "additions": 0,
      "deletions": 1,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/windows-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdb/windows-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/windows-nat.c?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -235,7 +235,6 @@ static std::vector<windows_thread_info *> thread_list;\n static int saw_create;\n static int open_process_used = 0;\n #ifdef __x86_64__\n-static bool wow64_process = false;\n static void *wow64_dbgbreak;\n #endif\n "
    },
    {
      "sha": "c97d4b1d28440e53d7449e2cb8e00c798acac8c9",
      "filename": "gdbserver/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/ChangeLog?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -1,3 +1,8 @@\n+2020-09-23  Hannes Domani  <ssbssa@yahoo.de>\n+\n+\t* win32-low.cc: Remove local wow64_process variable.\n+\t* win32-low.h: Remove local wow64_process variable.\n+\n 2020-09-18  Tom Tromey  <tromey@adacore.com>\n \n \t* netbsd-low.h (class netbsd_process_target) <wait>: Update."
    },
    {
      "sha": "e5f85a1a22fa65ccb5c7ca527ad7326e4f5d5a72",
      "filename": "gdbserver/win32-low.cc",
      "status": "modified",
      "additions": 0,
      "deletions": 4,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdbserver/win32-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdbserver/win32-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/win32-low.cc?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -91,10 +91,6 @@ static int faked_breakpoint = 0;\n /* True if current_process_handle needs to be closed.  */\n static bool open_process_used = false;\n \n-#ifdef __x86_64__\n-bool wow64_process = false;\n-#endif\n-\n const struct target_desc *win32_tdesc;\n #ifdef __x86_64__\n const struct target_desc *wow64_win32_tdesc;"
    },
    {
      "sha": "8c113f86c77226df17233a624ce0a3895b1b1206",
      "filename": "gdbserver/win32-low.h",
      "status": "modified",
      "additions": 0,
      "deletions": 2,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/99bb393f1d107cf2c4016c486f85625d362027a7/gdbserver/win32-low.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/99bb393f1d107cf2c4016c486f85625d362027a7/gdbserver/win32-low.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/win32-low.h?ref=99bb393f1d107cf2c4016c486f85625d362027a7",
      "patch": "@@ -30,8 +30,6 @@ extern const struct target_desc *win32_tdesc;\n #ifdef __x86_64__\n extern const struct target_desc *wow64_win32_tdesc;\n \n-extern bool wow64_process;\n-\n typedef BOOL (WINAPI *winapi_Wow64GetThreadContext) (HANDLE, PWOW64_CONTEXT);\n extern winapi_Wow64GetThreadContext win32_Wow64GetThreadContext;\n #endif"
    }
  ]
}