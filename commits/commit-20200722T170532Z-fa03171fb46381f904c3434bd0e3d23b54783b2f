{
  "sha": "fa03171fb46381f904c3434bd0e3d23b54783b2f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZmEwMzE3MWZiNDYzODFmOTA0YzM0MzRiZDBlM2QyM2I1NDc4M2IyZg==",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2020-06-11T19:19:07Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2020-07-22T17:05:32Z"
    },
    "message": "ld: do not produce one empty output .ctf section for every input .ctf\n\nThe trick we use to prevent ld doing as it does for almost all other\nsections and copying the input CTF section into the output has recently\nbroken, causing output to be produced with a valid CTF section followed\nby massive numbers of CTF sections, one per .ctf in the input (minus\none, for the one that was filled out by ctf_link).  Their size is being\nforcibly set to zero, but they're still present, wasting space and\nlooking ridiculous.\n\nThis is not right:\n\nld/ld-new  :\nsection                     size      addr\n.interp                       28   4194984\n[...]\n.bss                       21840   6788544\n.comment                      92         0\n.ctf                       87242         0\n.ctf                           0         0\n.ctf                           0         0\n[snip 131 more empty sections]\n.gnu.build.attributes       7704   6818576\n.debug_aranges              6592         0\n.debug_info              4488859         0\n.debug_abbrev             150099         0\n.debug_line               796759         0\n.debug_str                237926         0\n.debug_loc               2247302         0\n.debug_ranges             237920         0\nTotal                   10865285\n\nThe fix is to exclude these unwanted input sections from being present\nin the output.  We tried this before and it broke things, because if you\nexclude all the .ctf sections there isn't going to be one in the output\nso there is nowhere to put the deduplicated CTF. The solution to that is\nreally simple: set SEC_EXCLUDE on *all but one* CTF section.  We don't\ncare which one (they're all the same once their size has been zeroed),\nso just pick the first we see.\n\nld/\n\t* ldlang.c (ldlang_open_ctf): Set SEC_EXCLUDE on all but the\n\tfirst input .ctf section.",
    "tree": {
      "sha": "6944f4f31eeeb2f5aebba24f1cd8e2994ccc5afb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6944f4f31eeeb2f5aebba24f1cd8e2994ccc5afb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/fa03171fb46381f904c3434bd0e3d23b54783b2f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fa03171fb46381f904c3434bd0e3d23b54783b2f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/fa03171fb46381f904c3434bd0e3d23b54783b2f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/fa03171fb46381f904c3434bd0e3d23b54783b2f/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7cdfc3462fbbb27727ddd83d356cf79af8854740",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7cdfc3462fbbb27727ddd83d356cf79af8854740",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7cdfc3462fbbb27727ddd83d356cf79af8854740"
    }
  ],
  "stats": {
    "total": 10,
    "additions": 9,
    "deletions": 1
  },
  "files": [
    {
      "sha": "c0f6eca4f62afb8b74b2ee16965fd54bb71e2b45",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa03171fb46381f904c3434bd0e3d23b54783b2f/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa03171fb46381f904c3434bd0e3d23b54783b2f/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=fa03171fb46381f904c3434bd0e3d23b54783b2f",
      "patch": "@@ -1,3 +1,8 @@\n+2020-07-22  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* ldlang.c (ldlang_open_ctf): Set SEC_EXCLUDE on all but the\n+\tfirst input .ctf section.\n+\n 2020-07-22  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* configure.ac (enable_libctf): Substitute it."
    },
    {
      "sha": "6943adfdc31a60a5b881ae5ee46b02d9693ecc5d",
      "filename": "ld/ldlang.c",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/fa03171fb46381f904c3434bd0e3d23b54783b2f/ld/ldlang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/fa03171fb46381f904c3434bd0e3d23b54783b2f/ld/ldlang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ldlang.c?ref=fa03171fb46381f904c3434bd0e3d23b54783b2f",
      "patch": "@@ -3700,12 +3700,15 @@ ldlang_open_ctf (void)\n \t}\n \n       /* Prevent the contents of this section from being written, while\n-\t requiring the section itself to be duplicated in the output.  */\n+\t requiring the section itself to be duplicated in the output, but only\n+\t once.  */\n       /* This section must exist if ctf_bfdopen() succeeded.  */\n       sect = bfd_get_section_by_name (file->the_bfd, \".ctf\");\n       sect->size = 0;\n       sect->flags |= SEC_NEVER_LOAD | SEC_HAS_CONTENTS | SEC_LINKER_CREATED;\n \n+      if (any_ctf)\n+\tsect->flags |= SEC_EXCLUDE;\n       any_ctf = 1;\n     }\n "
    }
  ]
}