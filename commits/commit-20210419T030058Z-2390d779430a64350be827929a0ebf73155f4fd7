{
  "sha": "2390d779430a64350be827929a0ebf73155f4fd7",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjM5MGQ3Nzk0MzBhNjQzNTBiZTgyNzkyOWEwZWJmNzMxNTVmNGZkNw==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-19T02:24:37Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-04-19T03:00:58Z"
    },
    "message": "sim: iq2000: switch syscalls to common nltvals\n\nRather than hand duplicate the syscall table, switch to the common\nnltvals framework.  We have to tweak the constant names, but we get\neverything else for free.  I made sure the constants have the same\nvalues before & after too :).",
    "tree": {
      "sha": "377bebedd19ef230048f6f326ec1438fd90e57ce",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/377bebedd19ef230048f6f326ec1438fd90e57ce"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2390d779430a64350be827929a0ebf73155f4fd7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2390d779430a64350be827929a0ebf73155f4fd7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2390d779430a64350be827929a0ebf73155f4fd7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2390d779430a64350be827929a0ebf73155f4fd7/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "37e9f18266e768ad93243fd34f9046c260b3096b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/37e9f18266e768ad93243fd34f9046c260b3096b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/37e9f18266e768ad93243fd34f9046c260b3096b"
    }
  ],
  "stats": {
    "total": 86,
    "additions": 56,
    "deletions": 30
  },
  "files": [
    {
      "sha": "2d5934ad064a9935a7df75c07e57d6aa7e7187a9",
      "filename": "sim/common/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/common/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/common/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/ChangeLog?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -1,3 +1,8 @@\n+2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* gennltvals.py (TARGETS): Add iq2000.\n+\t* nltvals.def: Regenerate.\n+\n 2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n \n \t* syscall.c (cb_syscall): Implement CB_SYS_getpid."
    },
    {
      "sha": "a246977fbf8ee4418110e3ac37fe981e4849c54a",
      "filename": "sim/common/gennltvals.py",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/common/gennltvals.py",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/common/gennltvals.py",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/gennltvals.py?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -60,6 +60,7 @@\n     'fr30',\n     'frv',\n     'i960',\n+    'iq2000',\n     'lm32',\n     'm32r',\n     'mcore',"
    },
    {
      "sha": "4aaeff8a446de994aa07411d3899423463c2c5f9",
      "filename": "sim/common/nltvals.def",
      "status": "modified",
      "additions": 32,
      "deletions": 0,
      "changes": 32,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/common/nltvals.def",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/common/nltvals.def",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/common/nltvals.def?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -342,6 +342,37 @@\n /* end i960 sys target macros */\n #endif\n #endif\n+#ifdef NL_TARGET_iq2000\n+#ifdef sys_defs\n+/* from syscall.h */\n+/* begin iq2000 sys target macros */\n+ { \"SYS_argc\", 22 },\n+ { \"SYS_argn\", 24 },\n+ { \"SYS_argnlen\", 23 },\n+ { \"SYS_argv\", 13 },\n+ { \"SYS_argvlen\", 12 },\n+ { \"SYS_chdir\", 14 },\n+ { \"SYS_chmod\", 16 },\n+ { \"SYS_close\", 3 },\n+ { \"SYS_exit\", 1 },\n+ { \"SYS_fstat\", 10 },\n+ { \"SYS_getpid\", 8 },\n+ { \"SYS_gettimeofday\", 19 },\n+ { \"SYS_kill\", 9 },\n+ { \"SYS_link\", 21 },\n+ { \"SYS_lseek\", 6 },\n+ { \"SYS_open\", 2 },\n+ { \"SYS_read\", 4 },\n+ { \"SYS_reconfig\", 25 },\n+ { \"SYS_stat\", 15 },\n+ { \"SYS_time\", 18 },\n+ { \"SYS_times\", 20 },\n+ { \"SYS_unlink\", 7 },\n+ { \"SYS_utime\", 17 },\n+ { \"SYS_write\", 5 },\n+/* end iq2000 sys target macros */\n+#endif\n+#endif\n #ifdef NL_TARGET_lm32\n #ifdef sys_defs\n /* from syscall.h */\n@@ -553,6 +584,7 @@\n  { \"SYS_access\", 1033 },\n  { \"SYS_brk\", 214 },\n  { \"SYS_chdir\", 49 },\n+ { \"SYS_clock_gettime64\", 403 },\n  { \"SYS_close\", 57 },\n  { \"SYS_dup\", 23 },\n  { \"SYS_exit\", 93 },"
    },
    {
      "sha": "cb67450fd7a6cd6bb4982d48688fe7dd4bebaf93",
      "filename": "sim/iq2000/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/iq2000/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/iq2000/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/iq2000/ChangeLog?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -1,3 +1,10 @@\n+2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* Makefile.in (NL_TARGET): Define.\n+\t* iq2000.c: Include targ-vals.h.\n+\t(libgloss_syscall): Delete.\n+\t(do_syscall): Add TARGET_ prefix to all SYS_ constants.\n+\n 2021-04-18  Mike Frysinger  <vapier@gentoo.org>\n \n \t* configure: Regenerate."
    },
    {
      "sha": "baf49dd3330fe83177a136324d00c6d10b414651",
      "filename": "sim/iq2000/Makefile.in",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/iq2000/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/iq2000/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/iq2000/Makefile.in?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -15,6 +15,9 @@\n # You should have received a copy of the GNU General Public License\n # along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n+# This selects the newlib/libgloss syscall definitions.\n+NL_TARGET = -DNL_TARGET_iq2000\n+\n ## COMMON_PRE_CONFIG_FRAG\n \n IQ2000_OBJS = iq2000.o cpu.o decode.o sem.o model.o mloop.o"
    },
    {
      "sha": "66d7b47dfb4fc5aa9511cd0746740b65f7989703",
      "filename": "sim/iq2000/iq2000.c",
      "status": "modified",
      "additions": 8,
      "deletions": 30,
      "changes": 38,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2390d779430a64350be827929a0ebf73155f4fd7/sim/iq2000/iq2000.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2390d779430a64350be827929a0ebf73155f4fd7/sim/iq2000/iq2000.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/iq2000/iq2000.c?ref=2390d779430a64350be827929a0ebf73155f4fd7",
      "patch": "@@ -23,6 +23,7 @@\n #include \"sim-main.h\"\n #include \"cgen-mem.h\"\n #include \"cgen-ops.h\"\n+#include \"targ-vals.h\"\n #include <stdlib.h>\n \n enum\n@@ -32,29 +33,6 @@ enum\n   PC_REGNUM = 32\n };\n \n-enum libgloss_syscall\n-{\n-  SYS_exit = 1,\n-  SYS_open = 2, \n-  SYS_close = 3, \n-  SYS_read = 4,\n-  SYS_write = 5, \n-  SYS_lseek = 6, \n-  SYS_unlink = 7,\n-  SYS_getpid = 8,\n-  SYS_kill = 9,\n-  SYS_fstat = 10, \n-  SYS_argvlen = 12, \n-  SYS_argv = 13,\n-  SYS_chdir = 14, \n-  SYS_stat = 15, \n-  SYS_chmod = 16, \n-  SYS_utime = 17,\n-  SYS_time = 18,\n-  SYS_gettimeofday = 19,\n-  SYS_times = 20\n-};\n-\n /* Read a null terminated string from memory, return in a buffer */\n static char *\n fetch_str (SIM_CPU *current_cpu, PCADDR pc, DI addr)\n@@ -98,7 +76,7 @@ do_syscall (SIM_CPU *current_cpu, PCADDR pc)\n \t  exit (1);\n \t}\n \n-    case SYS_write:\n+    case TARGET_SYS_write:\n       buf = zalloc (PARM3);\n       sim_read (CPU_STATE (current_cpu), CPU2DATA(PARM2), buf, PARM3);\n       SET_H_GR (ret_reg,\n@@ -107,18 +85,18 @@ do_syscall (SIM_CPU *current_cpu, PCADDR pc)\n       free (buf);\n       break;\n \n-    case SYS_lseek:\n+    case TARGET_SYS_lseek:\n       SET_H_GR (ret_reg,\n \t\tsim_io_lseek (CPU_STATE (current_cpu),\n \t\t\t      PARM1, PARM2, PARM3));\n       break;\n \t    \n-    case SYS_exit:\n+    case TARGET_SYS_exit:\n       sim_engine_halt (CPU_STATE (current_cpu), current_cpu,\n \t\t       NULL, pc, sim_exited, PARM1);\n       break;\n \n-    case SYS_read:\n+    case TARGET_SYS_read:\n       buf = zalloc (PARM3);\n       SET_H_GR (ret_reg,\n \t\tsim_io_read (CPU_STATE (current_cpu),\n@@ -127,20 +105,20 @@ do_syscall (SIM_CPU *current_cpu, PCADDR pc)\n       free (buf);\n       break;\n \t    \n-    case SYS_open:\n+    case TARGET_SYS_open:\n       buf = fetch_str (current_cpu, pc, PARM1);\n       SET_H_GR (ret_reg,\n \t\tsim_io_open (CPU_STATE (current_cpu),\n \t\t\t     buf, PARM2));\n       free (buf);\n       break;\n \n-    case SYS_close:\n+    case TARGET_SYS_close:\n       SET_H_GR (ret_reg,\n \t\tsim_io_close (CPU_STATE (current_cpu), PARM1));\n       break;\n \n-    case SYS_time:\n+    case TARGET_SYS_time:\n       SET_H_GR (ret_reg, time (0));\n       break;\n "
    }
  ]
}