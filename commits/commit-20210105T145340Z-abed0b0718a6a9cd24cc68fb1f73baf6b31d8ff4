{
  "sha": "abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YWJlZDBiMDcxOGE2YTljZDI0Y2M2OGZiMWY3M2JhZjZiMzFkOGZmNA==",
  "commit": {
    "author": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-01-05T13:25:56Z"
    },
    "committer": {
      "name": "Nick Alcock",
      "email": "nick.alcock@oracle.com",
      "date": "2021-01-05T14:53:40Z"
    },
    "message": "libctf: warn about information loss because of unreleased format changes\n\nIn the last cycle there have been various changes that have replaced\nparts of the CTF format with other parts without format\ncompatibility.  This was not a compat break, because the old format was\nnever accepted by any version of libctf (the not-in-official-release CTF\ncompiler patch was emitting an invalid func info section), but\nnonetheless it can confuse users using that patch if they link together\nobject files and find the func info sections in the inputs silently\ndisappearing.\n\nScan the linker inputs for this problem and emit a warning if any are\nfound.\n\nlibctf/ChangeLog\n2021-01-05  Nick Alcock  <nick.alcock@oracle.com>\n\n\t* ctf-link.c (ctf_link_warn_outdated_inputs): New.\n\t(ctf_link_write): Call it.",
    "tree": {
      "sha": "490951afb5e422263c184bf5161884ff0dda493d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/490951afb5e422263c184bf5161884ff0dda493d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4/comments",
  "author": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickalcock",
    "id": 6503005,
    "node_id": "MDQ6VXNlcjY1MDMwMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6503005?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickalcock",
    "html_url": "https://github.com/nickalcock",
    "followers_url": "https://api.github.com/users/nickalcock/followers",
    "following_url": "https://api.github.com/users/nickalcock/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickalcock/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickalcock/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickalcock/subscriptions",
    "organizations_url": "https://api.github.com/users/nickalcock/orgs",
    "repos_url": "https://api.github.com/users/nickalcock/repos",
    "events_url": "https://api.github.com/users/nickalcock/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickalcock/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "9bc769718db238c98f14aafc335426f47b52d4cd",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9bc769718db238c98f14aafc335426f47b52d4cd",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/9bc769718db238c98f14aafc335426f47b52d4cd"
    }
  ],
  "stats": {
    "total": 35,
    "additions": 35,
    "deletions": 0
  },
  "files": [
    {
      "sha": "db75fd5a836ea8b94d0d1dc38a265655665fd1a5",
      "filename": "libctf/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4/libctf/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4/libctf/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ChangeLog?ref=abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4",
      "patch": "@@ -1,3 +1,8 @@\n+2021-01-05  Nick Alcock  <nick.alcock@oracle.com>\n+\n+\t* ctf-link.c (ctf_link_warn_outdated_inputs): New.\n+\t(ctf_link_write): Call it.\n+\n 2021-01-05  Nick Alcock  <nick.alcock@oracle.com>\n \n \t* testsuite/libctf-lookup/enum-symbol.lk: New symbol-lookup test."
    },
    {
      "sha": "5384b20543a84d8eaabf373eededa07a62b7c896",
      "filename": "libctf/ctf-link.c",
      "status": "modified",
      "additions": 30,
      "deletions": 0,
      "changes": 30,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4/libctf/ctf-link.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4/libctf/ctf-link.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/libctf/ctf-link.c?ref=abed0b0718a6a9cd24cc68fb1f73baf6b31d8ff4",
      "patch": "@@ -2004,6 +2004,34 @@ ctf_change_parent_name (void *key _libctf_unused_, void *value, void *arg)\n   ctf_parent_name_set (fp, name);\n }\n \n+/* Warn if we may suffer information loss because the CTF input files are too\n+   old.  Usually we provide complete backward compatibility, but compiler\n+   changes etc which never hit a release may have a flag in the header that\n+   simply prevents those changes from being used.  */\n+static void\n+ctf_link_warn_outdated_inputs (ctf_dict_t *fp)\n+{\n+  ctf_next_t *i = NULL;\n+  void *name_;\n+  void *ifp_;\n+  int err;\n+\n+  while ((err = ctf_dynhash_next (fp->ctf_link_inputs, &i, &name_, &ifp_)) == 0)\n+    {\n+      const char *name = (const char *) name_;\n+      ctf_dict_t *ifp = (ctf_dict_t *) ifp_;\n+\n+      if (!(ifp->ctf_header->cth_flags & CTF_F_NEWFUNCINFO)\n+\t  && (ifp->ctf_header->cth_varoff - ifp->ctf_header->cth_funcoff) > 0)\n+\tctf_err_warn (ifp, 1, 0, _(\"linker input %s has CTF func info but uses \"\n+\t\t\t\t   \"an old, unreleased func info format: \"\n+\t\t\t\t   \"this func info section will be dropped.\"),\n+\t\t      name);\n+    }\n+  if (err != ECTF_NEXT_END)\n+    ctf_err_warn (fp, 0, err, _(\"error checking for outdated inputs\"));\n+}\n+\n /* Write out a CTF archive (if there are per-CU CTF files) or a CTF file\n    (otherwise) into a new dynamically-allocated string, and return it.\n    Members with sizes above THRESHOLD are compressed.  */\n@@ -2023,6 +2051,8 @@ ctf_link_write (ctf_dict_t *fp, size_t *size, size_t threshold)\n   memset (&arg, 0, sizeof (ctf_name_list_accum_cb_arg_t));\n   arg.fp = fp;\n \n+  ctf_link_warn_outdated_inputs (fp);\n+\n   if (fp->ctf_link_outputs)\n     {\n       ctf_dynhash_iter (fp->ctf_link_outputs, ctf_accumulate_archive_names, &arg);"
    }
  ]
}