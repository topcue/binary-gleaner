{
  "sha": "24fd95b4cd40f0108299c02f31f2d2a129f83769",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjRmZDk1YjRjZDQwZjAxMDgyOTljMDJmMzFmMmQyYTEyOWY4Mzc2OQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-12-11T16:33:36Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2020-12-11T16:33:40Z"
    },
    "message": "Change varobj_dynamic::child_iter to unique_ptr\n\nThis changes varobj_dynamic::child_iter to be a unique_ptr, removing\nsome manual management.\n\ngdb/ChangeLog\n2020-12-11  Tom Tromey  <tom@tromey.com>\n\n\t* varobj.c (struct varobj_dynamic) <child_iter>: Now unique_ptr.\n\t(varobj_get_iterator): Return unique_ptr.\n\t(update_dynamic_varobj_children, install_visualizer)\n\t(varobj::~varobj): Update.\n\t* python/python-internal.h (py_varobj_get_iterator): Return\n\tunique_ptr.\n\t* python/py-varobj.c (py_varobj_get_iterator): Return unique_ptr.",
    "tree": {
      "sha": "6ec333c8b503bf0d1977889bcebba980dd1b24c9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6ec333c8b503bf0d1977889bcebba980dd1b24c9"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/24fd95b4cd40f0108299c02f31f2d2a129f83769",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/24fd95b4cd40f0108299c02f31f2d2a129f83769",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/24fd95b4cd40f0108299c02f31f2d2a129f83769",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/24fd95b4cd40f0108299c02f31f2d2a129f83769/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "7446266408f6c8cdf890c23c391c0c803c7077ca",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7446266408f6c8cdf890c23c391c0c803c7077ca",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/7446266408f6c8cdf890c23c391c0c803c7077ca"
    }
  ],
  "stats": {
    "total": 31,
    "additions": 19,
    "deletions": 12
  },
  "files": [
    {
      "sha": "dc369546d1f39c802f888db14a84287a27d117e9",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=24fd95b4cd40f0108299c02f31f2d2a129f83769",
      "patch": "@@ -1,3 +1,13 @@\n+2020-12-11  Tom Tromey  <tom@tromey.com>\n+\n+\t* varobj.c (struct varobj_dynamic) <child_iter>: Now unique_ptr.\n+\t(varobj_get_iterator): Return unique_ptr.\n+\t(update_dynamic_varobj_children, install_visualizer)\n+\t(varobj::~varobj): Update.\n+\t* python/python-internal.h (py_varobj_get_iterator): Return\n+\tunique_ptr.\n+\t* python/py-varobj.c (py_varobj_get_iterator): Return unique_ptr.\n+\n 2020-12-11  Tom Tromey  <tom@tromey.com>\n \n \t* varobj.c (struct varobj_dynamic) <saved_item>: Now unique_ptr."
    },
    {
      "sha": "dfc9e2baf6ce642cadb8560b359969bd03be7bb5",
      "filename": "gdb/python/py-varobj.c",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/python/py-varobj.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/python/py-varobj.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/py-varobj.c?ref=24fd95b4cd40f0108299c02f31f2d2a129f83769",
      "patch": "@@ -133,7 +133,7 @@ py_varobj_iter::py_varobj_iter (struct varobj *var, gdbpy_ref<> &&pyiter)\n /* Return a new pretty-printed varobj iterator suitable to iterate\n    over VAR's children.  */\n \n-struct varobj_iter *\n+std::unique_ptr<varobj_iter>\n py_varobj_get_iterator (struct varobj *var, PyObject *printer)\n {\n   gdbpy_enter_varobj enter_py (var);\n@@ -156,5 +156,6 @@ py_varobj_get_iterator (struct varobj *var, PyObject *printer)\n       error (_(\"Could not get children iterator\"));\n     }\n \n-  return new py_varobj_iter (var, std::move (iter));\n+  return std::unique_ptr<varobj_iter> (new py_varobj_iter (var,\n+\t\t\t\t\t\t\t   std::move (iter)));\n }"
    },
    {
      "sha": "f7e1edc5b28073de37bce7ec8b8f0062e7e98c26",
      "filename": "gdb/python/python-internal.h",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/python/python-internal.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/python/python-internal.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/python-internal.h?ref=24fd95b4cd40f0108299c02f31f2d2a129f83769",
      "patch": "@@ -754,8 +754,8 @@ int gdb_pymodule_addobject (PyObject *module, const char *name,\n \n struct varobj_iter;\n struct varobj;\n-struct varobj_iter *py_varobj_get_iterator (struct varobj *var,\n-\t\t\t\t\t    PyObject *printer);\n+std::unique_ptr<varobj_iter> py_varobj_get_iterator (struct varobj *var,\n+\t\t\t\t\t\t     PyObject *printer);\n \n /* Deleter for Py_buffer unique_ptr specialization.  */\n "
    },
    {
      "sha": "53e33b5d377f73c376c5e211d233a1c2bfd737f6",
      "filename": "gdb/varobj.c",
      "status": "modified",
      "additions": 4,
      "deletions": 8,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/varobj.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/24fd95b4cd40f0108299c02f31f2d2a129f83769/gdb/varobj.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/varobj.c?ref=24fd95b4cd40f0108299c02f31f2d2a129f83769",
      "patch": "@@ -124,7 +124,7 @@ struct varobj_dynamic\n \n   /* The iterator returned by the printer's 'children' method, or NULL\n      if not available.  */\n-  struct varobj_iter *child_iter = NULL;\n+  std::unique_ptr<varobj_iter> child_iter;\n \n   /* We request one extra item from the iterator, so that we can\n      report to the caller whether there are more items than we have\n@@ -660,7 +660,7 @@ dynamic_varobj_has_child_method (const struct varobj *var)\n /* A factory for creating dynamic varobj's iterators.  Returns an\n    iterator object suitable for iterating over VAR's children.  */\n \n-static struct varobj_iter *\n+static std::unique_ptr<varobj_iter>\n varobj_get_iterator (struct varobj *var)\n {\n #if HAVE_PYTHON\n@@ -701,7 +701,6 @@ update_dynamic_varobj_children (struct varobj *var,\n \n   if (update_children || var->dynamic->child_iter == NULL)\n     {\n-      delete var->dynamic->child_iter;\n       var->dynamic->child_iter = varobj_get_iterator (var);\n \n       varobj_clear_saved_item (var->dynamic);\n@@ -735,8 +734,7 @@ update_dynamic_varobj_children (struct varobj *var,\n       if (item == NULL)\n \t{\n \t  /* Iteration is done.  Remove iterator from VAR.  */\n-\t  delete var->dynamic->child_iter;\n-\t  var->dynamic->child_iter = NULL;\n+\t  var->dynamic->child_iter.reset (nullptr);\n \t  break;\n \t}\n       /* We don't want to push the extra child on any report list.  */\n@@ -1064,8 +1062,7 @@ install_visualizer (struct varobj_dynamic *var, PyObject *constructor,\n   Py_XDECREF (var->pretty_printer);\n   var->pretty_printer = visualizer;\n \n-  delete var->child_iter;\n-  var->child_iter = NULL;\n+  var->child_iter.reset (nullptr);\n }\n \n /* Install the default visualizer for VAR.  */\n@@ -1875,7 +1872,6 @@ varobj::~varobj ()\n     }\n #endif\n \n-  delete var->dynamic->child_iter;\n   varobj_clear_saved_item (var->dynamic);\n \n   if (is_root_p (var))"
    }
  ]
}