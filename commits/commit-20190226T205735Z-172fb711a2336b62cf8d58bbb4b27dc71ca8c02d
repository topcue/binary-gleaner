{
  "sha": "172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MTcyZmI3MTFhMjMzNmI2MmNmOGQ1OGJiYjRiMjdkYzcxY2E4YzAyZA==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-02-23T20:07:47Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-02-26T20:57:35Z"
    },
    "message": "gdb/riscv: Use legacy register numbers in default target description\n\nWhen the target description support was added to RISC-V, the register\nnumbers assigned to the fflags, frm, and fcsr control registers in the\ndefault target descriptions didn't match the register numbers used by\nGDB before the target description support was added.\n\nWhat this means is that if a tools exists in the wild that is using\nhard-coded register number, setup to match GDB's old numbering, then\nthis will have been broken (for fflags, frm, and fcsr) by the move to\ntarget descriptions.  QEMU is such a tool.\n\nThere are a couple of solutions that could be used to work around this\nissue:\n\n - The user can create their own xml description file with the\n   register numbers setup to match their old tool, then load this by\n   telling GDB 'set tdesc filename FILENAME'.\n\n - Update their old tool to use the newer default numbering scheme, or\n   better yet add proper target description support to their tool.\n\n - We could have RISC-V GDB change to maintain the old defaults.\n\nThis patch changes GDB back to using the old numbering scheme.\n\nThis change is only visible to remote targets that don't supply their\nown xml description file and instead rely on GDB's default numbering.\n\nNote that even though 32bit-cpu.xml and 64bit-cpu.xml have changed,\nthe corresponding .c file has not, this is because the numbering added\nto the registers in the xml files is number 0, this doesn't result in\nany new C code being generated .\n\ngdb/ChangeLog:\n\n\t* features/riscv/32bit-cpu.xml: Add register numbers.\n\t* features/riscv/32bit-fpu.c: Regenerate.\n\t* features/riscv/32bit-fpu.xml: Add register numbers.\n\t* features/riscv/64bit-cpu.xml: Add register numbers.\n\t* features/riscv/64bit-fpu.c: Regenerate.\n\t* features/riscv/64bit-fpu.xml: Add register numbers.",
    "tree": {
      "sha": "2ed60a0f66549ca1d8da7f0102bc9910b3a071ac",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2ed60a0f66549ca1d8da7f0102bc9910b3a071ac"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "8791793caa9a3186d4922cc786b6344e6093be73",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8791793caa9a3186d4922cc786b6344e6093be73",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/8791793caa9a3186d4922cc786b6344e6093be73"
    }
  ],
  "stats": {
    "total": 49,
    "additions": 39,
    "deletions": 10
  },
  "files": [
    {
      "sha": "1d747a7ad90cb8603b5b29c43396c6691a57bf7f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -1,3 +1,12 @@\n+2019-02-26  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* features/riscv/32bit-cpu.xml: Add register numbers.\n+\t* features/riscv/32bit-fpu.c: Regenerate.\n+\t* features/riscv/32bit-fpu.xml: Add register numbers.\n+\t* features/riscv/64bit-cpu.xml: Add register numbers.\n+\t* features/riscv/64bit-fpu.c: Regenerate.\n+\t* features/riscv/64bit-fpu.xml: Add register numbers.\n+\n 2019-02-26  Kevin Buettner  <kevinb@redhat.com>\n \n \t* NEWS: Mention two argument form of gdb.Value constructor."
    },
    {
      "sha": "0d07aaec857bc94bc5254b68ce5729638c2fe65c",
      "filename": "gdb/features/riscv/32bit-cpu.xml",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/32bit-cpu.xml",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/32bit-cpu.xml",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/riscv/32bit-cpu.xml?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -5,9 +5,13 @@\n      are permitted in any medium without royalty provided the copyright\n      notice and this notice are preserved.  -->\n \n+<!-- Register numbers are hard-coded in order to maintain backward\n+     compatibility with older versions of tools that didn't use xml\n+     register descriptions.  -->\n+\n <!DOCTYPE feature SYSTEM \"gdb-target.dtd\">\n <feature name=\"org.gnu.gdb.riscv.cpu\">\n-  <reg name=\"zero\" bitsize=\"32\" type=\"int\"/>\n+  <reg name=\"zero\" bitsize=\"32\" type=\"int\" regnum=\"0\"/>\n   <reg name=\"ra\" bitsize=\"32\" type=\"code_ptr\"/>\n   <reg name=\"sp\" bitsize=\"32\" type=\"data_ptr\"/>\n   <reg name=\"gp\" bitsize=\"32\" type=\"data_ptr\"/>"
    },
    {
      "sha": "a19780aab0c5315e590caf1d52559e198d60d20a",
      "filename": "gdb/features/riscv/32bit-fpu.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/32bit-fpu.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/32bit-fpu.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/riscv/32bit-fpu.c?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -9,6 +9,7 @@ create_feature_riscv_32bit_fpu (struct target_desc *result, long regnum)\n   struct tdesc_feature *feature;\n \n   feature = tdesc_create_feature (result, \"org.gnu.gdb.riscv.fpu\");\n+  regnum = 33;\n   tdesc_create_reg (feature, \"ft0\", regnum++, 1, NULL, 32, \"ieee_single\");\n   tdesc_create_reg (feature, \"ft1\", regnum++, 1, NULL, 32, \"ieee_single\");\n   tdesc_create_reg (feature, \"ft2\", regnum++, 1, NULL, 32, \"ieee_single\");\n@@ -41,6 +42,7 @@ create_feature_riscv_32bit_fpu (struct target_desc *result, long regnum)\n   tdesc_create_reg (feature, \"ft9\", regnum++, 1, NULL, 32, \"ieee_single\");\n   tdesc_create_reg (feature, \"ft10\", regnum++, 1, NULL, 32, \"ieee_single\");\n   tdesc_create_reg (feature, \"ft11\", regnum++, 1, NULL, 32, \"ieee_single\");\n+  regnum = 66;\n   tdesc_create_reg (feature, \"fflags\", regnum++, 1, NULL, 32, \"int\");\n   tdesc_create_reg (feature, \"frm\", regnum++, 1, NULL, 32, \"int\");\n   tdesc_create_reg (feature, \"fcsr\", regnum++, 1, NULL, 32, \"int\");"
    },
    {
      "sha": "1eaae9119e38f78196d89ebb77e39018a7ffd211",
      "filename": "gdb/features/riscv/32bit-fpu.xml",
      "status": "modified",
      "additions": 8,
      "deletions": 4,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/32bit-fpu.xml",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/32bit-fpu.xml",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/riscv/32bit-fpu.xml?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -5,9 +5,13 @@\n      are permitted in any medium without royalty provided the copyright\n      notice and this notice are preserved.  -->\n \n+<!-- Register numbers are hard-coded in order to maintain backward\n+     compatibility with older versions of tools that didn't use xml\n+     register descriptions.  -->\n+\n <!DOCTYPE feature SYSTEM \"gdb-target.dtd\">\n <feature name=\"org.gnu.gdb.riscv.fpu\">\n-  <reg name=\"ft0\" bitsize=\"32\" type=\"ieee_single\"/>\n+  <reg name=\"ft0\" bitsize=\"32\" type=\"ieee_single\" regnum=\"33\"/>\n   <reg name=\"ft1\" bitsize=\"32\" type=\"ieee_single\"/>\n   <reg name=\"ft2\" bitsize=\"32\" type=\"ieee_single\"/>\n   <reg name=\"ft3\" bitsize=\"32\" type=\"ieee_single\"/>\n@@ -40,7 +44,7 @@\n   <reg name=\"ft10\" bitsize=\"32\" type=\"ieee_single\"/>\n   <reg name=\"ft11\" bitsize=\"32\" type=\"ieee_single\"/>\n \n-  <reg name=\"fflags\" bitsize=\"32\" type=\"int\"/>\n-  <reg name=\"frm\" bitsize=\"32\" type=\"int\"/>\n-  <reg name=\"fcsr\" bitsize=\"32\" type=\"int\"/>\n+  <reg name=\"fflags\" bitsize=\"32\" type=\"int\" regnum=\"66\"/>\n+  <reg name=\"frm\" bitsize=\"32\" type=\"int\" regnum=\"67\"/>\n+  <reg name=\"fcsr\" bitsize=\"32\" type=\"int\" regnum=\"68\"/>\n </feature>"
    },
    {
      "sha": "b8aa424ae4b3f86773be7b08113dd689c69ee27b",
      "filename": "gdb/features/riscv/64bit-cpu.xml",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/64bit-cpu.xml",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/64bit-cpu.xml",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/riscv/64bit-cpu.xml?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -5,9 +5,13 @@\n      are permitted in any medium without royalty provided the copyright\n      notice and this notice are preserved.  -->\n \n+<!-- Register numbers are hard-coded in order to maintain backward\n+     compatibility with older versions of tools that didn't use xml\n+     register descriptions.  -->\n+\n <!DOCTYPE feature SYSTEM \"gdb-target.dtd\">\n <feature name=\"org.gnu.gdb.riscv.cpu\">\n-  <reg name=\"zero\" bitsize=\"64\" type=\"int\"/>\n+  <reg name=\"zero\" bitsize=\"64\" type=\"int\" regnum=\"0\"/>\n   <reg name=\"ra\" bitsize=\"64\" type=\"code_ptr\"/>\n   <reg name=\"sp\" bitsize=\"64\" type=\"data_ptr\"/>\n   <reg name=\"gp\" bitsize=\"64\" type=\"data_ptr\"/>"
    },
    {
      "sha": "b93cb4ec03b36cb42e2f8ef8a077cafbcfda112d",
      "filename": "gdb/features/riscv/64bit-fpu.c",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/64bit-fpu.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/64bit-fpu.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/riscv/64bit-fpu.c?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -17,6 +17,7 @@ create_feature_riscv_64bit_fpu (struct target_desc *result, long regnum)\n   field_type = tdesc_named_type (feature, \"ieee_double\");\n   tdesc_add_field (type_with_fields, \"double\", field_type);\n \n+  regnum = 33;\n   tdesc_create_reg (feature, \"ft0\", regnum++, 1, NULL, 64, \"riscv_double\");\n   tdesc_create_reg (feature, \"ft1\", regnum++, 1, NULL, 64, \"riscv_double\");\n   tdesc_create_reg (feature, \"ft2\", regnum++, 1, NULL, 64, \"riscv_double\");\n@@ -49,6 +50,7 @@ create_feature_riscv_64bit_fpu (struct target_desc *result, long regnum)\n   tdesc_create_reg (feature, \"ft9\", regnum++, 1, NULL, 64, \"riscv_double\");\n   tdesc_create_reg (feature, \"ft10\", regnum++, 1, NULL, 64, \"riscv_double\");\n   tdesc_create_reg (feature, \"ft11\", regnum++, 1, NULL, 64, \"riscv_double\");\n+  regnum = 66;\n   tdesc_create_reg (feature, \"fflags\", regnum++, 1, NULL, 32, \"int\");\n   tdesc_create_reg (feature, \"frm\", regnum++, 1, NULL, 32, \"int\");\n   tdesc_create_reg (feature, \"fcsr\", regnum++, 1, NULL, 32, \"int\");"
    },
    {
      "sha": "794854cc011bee00ce44a41456c03274af4b4b28",
      "filename": "gdb/features/riscv/64bit-fpu.xml",
      "status": "modified",
      "additions": 8,
      "deletions": 4,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/64bit-fpu.xml",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/172fb711a2336b62cf8d58bbb4b27dc71ca8c02d/gdb/features/riscv/64bit-fpu.xml",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/riscv/64bit-fpu.xml?ref=172fb711a2336b62cf8d58bbb4b27dc71ca8c02d",
      "patch": "@@ -5,6 +5,10 @@\n      are permitted in any medium without royalty provided the copyright\n      notice and this notice are preserved.  -->\n \n+<!-- Register numbers are hard-coded in order to maintain backward\n+     compatibility with older versions of tools that didn't use xml\n+     register descriptions.  -->\n+\n <!DOCTYPE feature SYSTEM \"gdb-target.dtd\">\n <feature name=\"org.gnu.gdb.riscv.fpu\">\n \n@@ -13,7 +17,7 @@\n     <field name=\"double\" type=\"ieee_double\"/>\n   </union>\n \n-  <reg name=\"ft0\" bitsize=\"64\" type=\"riscv_double\"/>\n+  <reg name=\"ft0\" bitsize=\"64\" type=\"riscv_double\" regnum=\"33\"/>\n   <reg name=\"ft1\" bitsize=\"64\" type=\"riscv_double\"/>\n   <reg name=\"ft2\" bitsize=\"64\" type=\"riscv_double\"/>\n   <reg name=\"ft3\" bitsize=\"64\" type=\"riscv_double\"/>\n@@ -46,7 +50,7 @@\n   <reg name=\"ft10\" bitsize=\"64\" type=\"riscv_double\"/>\n   <reg name=\"ft11\" bitsize=\"64\" type=\"riscv_double\"/>\n \n-  <reg name=\"fflags\" bitsize=\"32\" type=\"int\"/>\n-  <reg name=\"frm\" bitsize=\"32\" type=\"int\"/>\n-  <reg name=\"fcsr\" bitsize=\"32\" type=\"int\"/>\n+  <reg name=\"fflags\" bitsize=\"32\" type=\"int\" regnum=\"66\"/>\n+  <reg name=\"frm\" bitsize=\"32\" type=\"int\" regnum=\"67\"/>\n+  <reg name=\"fcsr\" bitsize=\"32\" type=\"int\" regnum=\"68\"/>\n </feature>"
    }
  ]
}