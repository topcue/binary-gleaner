{
  "sha": "8d4e4d13afbca26b6cfebf7221973bb21c40677e",
  "node_id": "C_kwDOANOeidoAKDhkNGU0ZDEzYWZiY2EyNmI2Y2ZlYmY3MjIxOTczYmIyMWM0MDY3N2U",
  "commit": {
    "author": {
      "name": "Carl Love",
      "email": "cel@us.ibm.com",
      "date": "2022-01-12T17:56:58Z"
    },
    "committer": {
      "name": "Carl Love",
      "email": "cel@us.ibm.com",
      "date": "2022-01-12T17:56:58Z"
    },
    "message": "gdb Power 9 add test for HW watchpoint support.\n\nThe Power 9 processor revision 2.2 has HW watchpoint support disabled due\nto a HW bug.  The support is fixed in Power 9 processor revision 2.3.  This\npatch add a test to lib/gdb.exp for Power to determine if the processor\nsupports HW watchpoints or not.  If the Power processor doesn't support HW\nwatchpoints the proceedure skip_hw_watchpoint_tests will return 1 to\ndisable the various HW watchpoint tests.\n\nThe patch has been tested on Power 9, processor revesions 2.2 and 2.3.  The\npatch has also been tested on Power 10.  No regression test failures were\nfound.",
    "tree": {
      "sha": "1f3a27b7fadae0607982a7ede16ab8e54a75ad91",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1f3a27b7fadae0607982a7ede16ab8e54a75ad91"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/8d4e4d13afbca26b6cfebf7221973bb21c40677e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8d4e4d13afbca26b6cfebf7221973bb21c40677e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/8d4e4d13afbca26b6cfebf7221973bb21c40677e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/8d4e4d13afbca26b6cfebf7221973bb21c40677e/comments",
  "author": {
    "login": "carlelove",
    "id": 86435705,
    "node_id": "MDQ6VXNlcjg2NDM1NzA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/86435705?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/carlelove",
    "html_url": "https://github.com/carlelove",
    "followers_url": "https://api.github.com/users/carlelove/followers",
    "following_url": "https://api.github.com/users/carlelove/following{/other_user}",
    "gists_url": "https://api.github.com/users/carlelove/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/carlelove/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/carlelove/subscriptions",
    "organizations_url": "https://api.github.com/users/carlelove/orgs",
    "repos_url": "https://api.github.com/users/carlelove/repos",
    "events_url": "https://api.github.com/users/carlelove/events{/privacy}",
    "received_events_url": "https://api.github.com/users/carlelove/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "carlelove",
    "id": 86435705,
    "node_id": "MDQ6VXNlcjg2NDM1NzA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/86435705?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/carlelove",
    "html_url": "https://github.com/carlelove",
    "followers_url": "https://api.github.com/users/carlelove/followers",
    "following_url": "https://api.github.com/users/carlelove/following{/other_user}",
    "gists_url": "https://api.github.com/users/carlelove/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/carlelove/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/carlelove/subscriptions",
    "organizations_url": "https://api.github.com/users/carlelove/orgs",
    "repos_url": "https://api.github.com/users/carlelove/repos",
    "events_url": "https://api.github.com/users/carlelove/events{/privacy}",
    "received_events_url": "https://api.github.com/users/carlelove/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "61671e97927dcc1b302bd01fd59bc61c27972839",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/61671e97927dcc1b302bd01fd59bc61c27972839",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/61671e97927dcc1b302bd01fd59bc61c27972839"
    }
  ],
  "stats": {
    "total": 62,
    "additions": 61,
    "deletions": 1
  },
  "files": [
    {
      "sha": "a3717a402297866e070ebb51d4b45e0d7d599d36",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 61,
      "deletions": 1,
      "changes": 62,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/8d4e4d13afbca26b6cfebf7221973bb21c40677e/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/8d4e4d13afbca26b6cfebf7221973bb21c40677e/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=8d4e4d13afbca26b6cfebf7221973bb21c40677e",
      "patch": "@@ -3740,12 +3740,15 @@ proc skip_hw_watchpoint_tests {} {\n     }\n \n     # These targets support hardware watchpoints natively\n+    # Note, not all Power 9 processors support hardware watchpoints due to a HW\n+    # bug.  Use has_hw_wp_support to check do a runtime check for hardware\n+    # watchpoint support on Powerpc.\n     if { [istarget \"i?86-*-*\"] \n \t || [istarget \"x86_64-*-*\"]\n \t || [istarget \"ia64-*-*\"] \n \t || [istarget \"arm*-*-*\"]\n \t || [istarget \"aarch64*-*-*\"]\n-\t || [istarget \"powerpc*-*-linux*\"]\n+\t || ([istarget \"powerpc*-*-linux*\"] && [has_hw_wp_support])\n \t || [istarget \"s390*-*-*\"] } {\n \treturn 0\n     }\n@@ -8331,5 +8334,62 @@ proc target_file_exists_with_timeout { path } {\n     return 0\n }\n \n+gdb_caching_proc has_hw_wp_support {\n+    # Power 9, proc rev 2.2 does not support HW watchpoints due to HW bug.\n+    # Need to use a runtime test to determine if the Power processor has\n+    # support for HW watchpoints.\n+    global srcdir subdir gdb_prompt inferior_exited_re\n+\n+    set compile_flags {debug nowarnings quiet}\n+    set me \"has_hw_wp_support\"\n+\n+    # Compile a test program to test if HW watchpoints are supported\n+    set src {\n+\tint main (void) {\n+\t    volatile int local;\n+\t    local = 1;\n+\t    if (local == 1)\n+\t\treturn 1;\n+\t    return 0;\n+\t}\n+    }\n+\n+    if {![gdb_simple_compile $me $src executable $compile_flags]} {\n+        return 0\n+    }\n+\n+    gdb_exit\n+    gdb_start\n+    gdb_reinitialize_dir $srcdir/$subdir\n+    gdb_load \"$obj\"\n+\n+    if ![runto_main] {\n+\tset has_hw_wp_support 0\n+\treturn $has_hw_wp_support\n+    }\n+\n+    # The goal is to determine if HW watchpoints are available in general.\n+    # Use \"watch\" and then check if gdb responds with hardware watch point.\n+    set test \"watch local\"\n+\n+    gdb_test_multiple  $test \"Check for HW watchpoint support\" {\n+\t-re \".*Hardware watchpoint.*\" {\n+\t    #  HW watchpoint supported by platform\n+\t    verbose -log \"\\n$me: Hardware watchpoint detected\"\n+            set has_hw_wp_support 1\n+\t}\n+\t-re \".*$gdb_prompt $\" {\n+\t    set has_hw_wp_support 0\n+\t    verbose -log \"\\n$me: Default, hardware watchpoint not deteced\"\n+\t}\n+    }\n+\n+    gdb_exit\n+    remote_file build delete $obj\n+\n+    verbose \"$me: returning $has_hw_wp_support\" 2\n+    return $has_hw_wp_support\n+}\n+\n # Always load compatibility stuff.\n load_lib future.exp"
    }
  ]
}