{
  "sha": "3847a7bfbf6340372962c07f31187ff87b4f492c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Mzg0N2E3YmZiZjYzNDAzNzI5NjJjMDdmMzExODdmZjg3YjRmNDkyYw==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-04-11T17:26:02Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2019-06-06T14:53:56Z"
    },
    "message": "Add timestamps to \"maint time\" output\n\nCurrently \"maint time\" will print the amount of time a command took.\nSometimes, though, it's useful to have a timestamp as well -- for\nexample if one is correlating a gdb log with some other log.\n\nThis patch adds a timestamp to the start and end of each command when\nthis setting is in effect.\n\nThis also removes a \"//\" comment and changes scoped_command_stats to\nuse DISABLE_COPY_AND_ASSIGN; two minor things I noticed while working\non the patch.\n\nTested on x86-64 Fedora 29.\n\ngdb/ChangeLog\n2019-06-06  Tom Tromey  <tromey@adacore.com>\n\n\t* maint.h (class scoped_command_stats): Use\n\tDISABLE_COPY_AND_ASSIGN.\n\t<print_time>: New method.\n\t* maint.c (scoped_command_stats, ~scoped_command_stats): Call\n\tprint_time.\n\t(scoped_command_stats::print_time): New method.\n\ngdb/testsuite/ChangeLog\n2019-06-06  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.base/maint.exp: Expect command started/finished output.",
    "tree": {
      "sha": "f6a4ea2e9ef30d4ccd0d913378475b0e5ef2b3fb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f6a4ea2e9ef30d4ccd0d913378475b0e5ef2b3fb"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/3847a7bfbf6340372962c07f31187ff87b4f492c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3847a7bfbf6340372962c07f31187ff87b4f492c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/3847a7bfbf6340372962c07f31187ff87b4f492c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/3847a7bfbf6340372962c07f31187ff87b4f492c/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "237df8fe1863bb47fcf71ce125cd962666173aaa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/237df8fe1863bb47fcf71ce125cd962666173aaa",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/237df8fe1863bb47fcf71ce125cd962666173aaa"
    }
  ],
  "stats": {
    "total": 52,
    "additions": 47,
    "deletions": 5
  },
  "files": [
    {
      "sha": "c0cc57f102eeeb19a58b8d34a25d36f90c4b9b99",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=3847a7bfbf6340372962c07f31187ff87b4f492c",
      "patch": "@@ -1,3 +1,12 @@\n+2019-06-06  Tom Tromey  <tromey@adacore.com>\n+\n+\t* maint.h (class scoped_command_stats): Use\n+\tDISABLE_COPY_AND_ASSIGN.\n+\t<print_time>: New method.\n+\t* maint.c (scoped_command_stats, ~scoped_command_stats): Call\n+\tprint_time.\n+\t(scoped_command_stats::print_time): New method.\n+\n 2019-06-05  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* riscv-tdep.c (riscv_insn::decode): Gracefully ignore"
    },
    {
      "sha": "aaabb3522497550e057f1141164890eeca7c14cd",
      "filename": "gdb/maint.c",
      "status": "modified",
      "additions": 25,
      "deletions": 0,
      "changes": 25,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/maint.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/maint.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/maint.c?ref=3847a7bfbf6340372962c07f31187ff87b4f492c",
      "patch": "@@ -794,6 +794,8 @@ scoped_command_stats::~scoped_command_stats ()\n \n   if (m_time_enabled && per_command_time)\n     {\n+      print_time (_(\"command finished\"));\n+\n       using namespace std::chrono;\n \n       run_time_clock::duration cmd_time\n@@ -867,6 +869,9 @@ scoped_command_stats::scoped_command_stats (bool msg_type)\n       m_start_cpu_time = run_time_clock::now ();\n       m_start_wall_time = steady_clock::now ();\n       m_time_enabled = 1;\n+\n+      if (per_command_time)\n+\tprint_time (_(\"command started\"));\n     }\n   else\n     m_time_enabled = 0;\n@@ -888,6 +893,26 @@ scoped_command_stats::scoped_command_stats (bool msg_type)\n   reset_prompt_for_continue_wait_time ();\n }\n \n+/* See maint.h.  */\n+\n+void\n+scoped_command_stats::print_time (const char *msg)\n+{\n+  using namespace std::chrono;\n+\n+  auto now = system_clock::now ();\n+  auto ticks = now.time_since_epoch ().count () / (1000 * 1000);\n+  auto millis = ticks % 1000;\n+\n+  std::time_t as_time = system_clock::to_time_t (now);\n+  struct tm *tm = localtime (&as_time);\n+\n+  char out[100];\n+  strftime (out, sizeof (out), \"%F %H:%M:%S\", tm);\n+\n+  printf_unfiltered (\"%s.%03d - %s\\n\", out, (int) millis, msg);\n+}\n+\n /* Handle unknown \"mt set per-command\" arguments.\n    In this case have \"mt set per-command on|off\" affect every setting.  */\n "
    },
    {
      "sha": "57f350ade8c69c7d2dc3c7d8c56f62f8ca0bc85d",
      "filename": "gdb/maint.h",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/maint.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/maint.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/maint.h?ref=3847a7bfbf6340372962c07f31187ff87b4f492c",
      "patch": "@@ -38,9 +38,10 @@ class scoped_command_stats\n \n  private:\n \n-  // No need for these.  They are intentionally not defined anywhere.\n-  scoped_command_stats &operator= (const scoped_command_stats &);\n-  scoped_command_stats (const scoped_command_stats &);\n+  DISABLE_COPY_AND_ASSIGN (scoped_command_stats);\n+\n+  /* Print the time, along with a string.  */\n+  void print_time (const char *msg);\n \n   /* Zero if the saved time is from the beginning of GDB execution.\n      One if from the beginning of an individual command execution.  */"
    },
    {
      "sha": "61affed773150f8bf484c46c1057ea6edd864d5a",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=3847a7bfbf6340372962c07f31187ff87b4f492c",
      "patch": "@@ -1,3 +1,7 @@\n+2019-06-06  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.base/maint.exp: Expect command started/finished output.\n+\n 2019-06-05  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.arch/riscv-unwind-long-insn-6.s: Remove use of 'I' in"
    },
    {
      "sha": "a7675ea215b592941dfe2740a9dbaffb975d037a",
      "filename": "gdb/testsuite/gdb.base/maint.exp",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/testsuite/gdb.base/maint.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/3847a7bfbf6340372962c07f31187ff87b4f492c/gdb/testsuite/gdb.base/maint.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/maint.exp?ref=3847a7bfbf6340372962c07f31187ff87b4f492c",
      "patch": "@@ -177,9 +177,12 @@ gdb_test_no_output \"maint check-symtabs\"\n \n # Test per-command stats.\n gdb_test_no_output \"maint set per-command on\"\n+set decimal \"\\[0-9\\]+\"\n+set time_fmt \"${decimal}-${decimal}-${decimal} ${decimal}:${decimal}:${decimal}\\\\.${decimal}\"\n gdb_test \"pwd\" \\\n-    \"Command execution time: \\[0-9.\\]+ \\\\(cpu\\\\), \\[0-9.\\]+ \\\\(wall\\\\)\\[\\r\\n\\]+Space used: $decimal \\\\(\\\\+$decimal for this command\\\\)\\[\\r\\n\\]+#symtabs: $decimal \\\\(\\\\+$decimal\\\\), #compunits: $decimal \\\\(\\\\+$decimal\\\\), #blocks: $decimal \\\\(\\\\+$decimal\\\\)\"\n-gdb_test_no_output \"maint set per-command off\"\n+    \"${time_fmt} - command started\\r\\n.*\\r\\n${time_fmt} - command finished\\r\\nCommand execution time: \\[0-9.\\]+ \\\\(cpu\\\\), \\[0-9.\\]+ \\\\(wall\\\\)\\[\\r\\n\\]+Space used: $decimal \\\\(\\\\+$decimal for this command\\\\)\\[\\r\\n\\]+#symtabs: $decimal \\\\(\\\\+$decimal\\\\), #compunits: $decimal \\\\(\\\\+$decimal\\\\), #blocks: $decimal \\\\(\\\\+$decimal\\\\)\"\n+gdb_test \"maint set per-command off\" \\\n+    \"${time_fmt} - command started\"\n \n # The timeout value is raised, because printing all the symbols and\n # statistical information about Cygwin and Windows libraries takes a lot"
    }
  ]
}