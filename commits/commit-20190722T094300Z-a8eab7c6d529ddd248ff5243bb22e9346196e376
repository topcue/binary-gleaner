{
  "sha": "a8eab7c6d529ddd248ff5243bb22e9346196e376",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YThlYWI3YzZkNTI5ZGRkMjQ4ZmY1MjQzYmIyMmU5MzQ2MTk2ZTM3Ng==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-11T20:02:59Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2019-07-22T09:43:00Z"
    },
    "message": "gdb: Switch \"info types\" over to use the gdb::options framework\n\nAdds a new -q flag to \"info types\" using the gdb::option framework.\nThis -q flag is similar to the -q flag already present for \"info\nvariables\" and \"info functions\".\n\ngdb/ChangeLog:\n\n\t* NEWS: Mention adding -q option to \"info types\".\n\t* symtab.c (struct info_types_options): New struct.\n\t(info_types_options_defs): New variable.\n\t(make_info_types_options_def_group): New function.\n\t(info_types_command): Use gdb::option framework to parse options.\n\t(info_types_command_completer): New function.\n\t(_initialize_symtab): Extend the help text on \"info types\" and\n\tregister command completer.\n\ngdb/doc/ChangeLog:\n\n\t* gdb.texinfo (Symbols): Add information about -q flag to \"info\n\ttypes\".",
    "tree": {
      "sha": "00960f66becd428c1f7ceb20b862e14de0a37b86",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/00960f66becd428c1f7ceb20b862e14de0a37b86"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/a8eab7c6d529ddd248ff5243bb22e9346196e376",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a8eab7c6d529ddd248ff5243bb22e9346196e376",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/a8eab7c6d529ddd248ff5243bb22e9346196e376",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a8eab7c6d529ddd248ff5243bb22e9346196e376/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b4603c34644847e2113e8c29408db09049c5c30f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b4603c34644847e2113e8c29408db09049c5c30f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b4603c34644847e2113e8c29408db09049c5c30f"
    }
  ],
  "stats": {
    "total": 91,
    "additions": 85,
    "deletions": 6
  },
  "files": [
    {
      "sha": "18987b0de405c04af3fa5b79b3f7d0ceb4dbb8a3",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=a8eab7c6d529ddd248ff5243bb22e9346196e376",
      "patch": "@@ -1,3 +1,14 @@\n+2019-07-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* NEWS: Mention adding -q option to \"info types\".\n+\t* symtab.c (struct info_types_options): New struct.\n+\t(info_types_options_defs): New variable.\n+\t(make_info_types_options_def_group): New function.\n+\t(info_types_command): Use gdb::option framework to parse options.\n+\t(info_types_command_completer): New function.\n+\t(_initialize_symtab): Extend the help text on \"info types\" and\n+\tregister command completer.\n+\n 2019-07-21  Christian Biesinger  <cbiesinger@google.com>\n \n \t* symtab.c (lookup_symbol_in_objfile_symtabs): Change int to block_enum."
    },
    {
      "sha": "cc1d58520d4bfe3ee59ac0d315051dda19a9c16d",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=a8eab7c6d529ddd248ff5243bb22e9346196e376",
      "patch": "@@ -211,6 +211,10 @@ maint show test-options-completion-result\n \n     (gdb) print -raw -pretty -object off -- *myptr\n \n+  ** The \"info types\" command now supports the '-q' flag to disable\n+     printing of some header information in a similar fashion to \"info\n+     variables\" and \"info functions\".\n+\n * Completion improvements\n \n   ** GDB can now complete the options of the \"thread apply all\" and"
    },
    {
      "sha": "ca0e3ee1155aa16db48cadde268139e0bc16ef33",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=a8eab7c6d529ddd248ff5243bb22e9346196e376",
      "patch": "@@ -1,3 +1,8 @@\n+2019-07-22  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.texinfo (Symbols): Add information about -q flag to \"info\n+\ttypes\".\n+\n 2019-07-20  Kevin Buettner  <kevinb@redhat.com>\n \n \t* python.texi (python command): Revise example to match"
    },
    {
      "sha": "be65d528d28fdd796af25049eec7adf42184f854",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=a8eab7c6d529ddd248ff5243bb22e9346196e376",
      "patch": "@@ -18428,8 +18428,7 @@ information.  Inspecting the type of a (global) variable for which\n of such variables.\n \n @kindex info types\n-@item info types @var{regexp}\n-@itemx info types\n+@item info types [-q] [@var{regexp}]\n Print a brief description of all types whose names match the regular\n expression @var{regexp} (or all types in your program, if you supply\n no argument).  Each complete typename is matched as though it were a\n@@ -18449,6 +18448,11 @@ This command differs from @code{ptype} in two ways: first, like\n @code{whatis}, it does not print a detailed description; second, it\n lists all source files and line numbers where a type is defined.\n \n+The output from @samp{into types} is proceeded with a header line\n+describing what types are being listed.  The optional flag @samp{-q},\n+which stands for @samp{quiet}, disables printing this header\n+information.\n+\n @kindex info type-printers\n @item info type-printers\n Versions of @value{GDBN} that ship with Python scripting enabled may"
    },
    {
      "sha": "ea2b813f293ad5851f0d862477b213861456f4c9",
      "filename": "gdb/symtab.c",
      "status": "modified",
      "additions": 59,
      "deletions": 4,
      "changes": 63,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/a8eab7c6d529ddd248ff5243bb22e9346196e376/gdb/symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.c?ref=a8eab7c6d529ddd248ff5243bb22e9346196e376",
      "patch": "@@ -4773,11 +4773,62 @@ info_functions_command (const char *args, int from_tty)\n \t\t      opts.type_regexp, from_tty);\n }\n \n+/* Holds the -q option for the 'info types' command.  */\n+\n+struct info_types_options\n+{\n+  int quiet = false;\n+};\n+\n+/* The options used by the 'info types' command.  */\n+\n+static const gdb::option::option_def info_types_options_defs[] = {\n+  gdb::option::boolean_option_def<info_types_options> {\n+    \"q\",\n+    [] (info_types_options *opt) { return &opt->quiet; },\n+    nullptr, /* show_cmd_cb */\n+    nullptr /* set_doc */\n+  }\n+};\n+\n+/* Returns the option group used by 'info types'.  */\n+\n+static gdb::option::option_def_group\n+make_info_types_options_def_group (info_types_options *opts)\n+{\n+  return {{info_types_options_defs}, opts};\n+}\n+\n+/* Implement the 'info types' command.  */\n \n static void\n-info_types_command (const char *regexp, int from_tty)\n+info_types_command (const char *args, int from_tty)\n {\n-  symtab_symbol_info (false, regexp, TYPES_DOMAIN, NULL, from_tty);\n+  info_types_options opts;\n+\n+  auto grp = make_info_types_options_def_group (&opts);\n+  gdb::option::process_options\n+    (&args, gdb::option::PROCESS_OPTIONS_UNKNOWN_IS_OPERAND, grp);\n+  if (args != nullptr && *args == '\\0')\n+    args = nullptr;\n+  symtab_symbol_info (opts.quiet, args, TYPES_DOMAIN, NULL, from_tty);\n+}\n+\n+/* Command completer for 'info types' command.  */\n+\n+static void\n+info_types_command_completer (struct cmd_list_element *ignore,\n+\t\t\t      completion_tracker &tracker,\n+\t\t\t      const char *text, const char * /* word */)\n+{\n+  const auto group\n+    = make_info_types_options_def_group (nullptr);\n+  if (gdb::option::complete_options\n+      (tracker, &text, gdb::option::PROCESS_OPTIONS_UNKNOWN_IS_OPERAND, group))\n+    return;\n+\n+  const char *word = advance_to_expression_complete_word_point (tracker, text);\n+  symbol_completer (ignore, tracker, text, word);\n }\n \n /* Breakpoint all functions matching regular expression.  */\n@@ -6041,8 +6092,12 @@ Prints the functions.\\n\"),\n      print \"struct foo *\".\n      I also think \"ptype\" or \"whatis\" is more likely to be useful (but if\n      there is much disagreement \"info types\" can be fixed).  */\n-  add_info (\"types\", info_types_command,\n-\t    _(\"All type names, or those matching REGEXP.\"));\n+  c = add_info (\"types\", info_types_command, _(\"\\\n+All type names, or those matching REGEXP.\\n\\\n+Usage: info types [-q] [REGEXP]\\n\\\n+Print information about all types matching REGEXP, or all types if no\\n\\\n+REGEXP is given.  The optional flag -q disables printing of headers.\"));\n+  set_cmd_completer_handle_brkchars (c, info_types_command_completer);\n \n   add_info (\"sources\", info_sources_command,\n \t    _(\"Source files in the program.\"));"
    }
  ]
}