{
  "sha": "404ec93359eaaf6a4284613e9c3ac014eea9383b",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDA0ZWM5MzM1OWVhYWY2YTQyODQ2MTNlOWMzYWMwMTRlZWE5MzgzYg==",
  "commit": {
    "author": {
      "name": "Jon Turney",
      "email": "jon.turney@dronecode.org.uk",
      "date": "2020-07-17T14:25:47Z"
    },
    "committer": {
      "name": "Jon Turney",
      "email": "jon.turney@dronecode.org.uk",
      "date": "2020-08-12T14:08:30Z"
    },
    "message": "Only warn about malformed win32pstatus notes\n\nbfd/ChangeLog:\n\n2020-07-21  Jon Turney  <jon.turney@dronecode.org.uk>\n\n\t* elf.c (elfcore_grok_win32pstatus): Warn on malformed\n\twin32pstatus notes, and return TRUE so we continue rather than\n\tstopping as if it was an error.",
    "tree": {
      "sha": "972b8ec1103241478684182473a417969ec30150",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/972b8ec1103241478684182473a417969ec30150"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/404ec93359eaaf6a4284613e9c3ac014eea9383b",
    "comment_count": 0,
    "verification": {
      "verified": true,
      "reason": "valid",
      "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABAgAGBQJfM/feAAoJEMfIbwNwKFyBZBAQAJ5YzgeWgisWSLOKE/m4kONZ\nlD/AaglHJAzDLF1nO7V4dpxZJcFbqVbD8LEOorLar1Rr01r53mmaQErxaNM0Jq3U\nCdIaAUgGBpr8nCHBu5MGOVAAD26OmL8j4G0Ud80/B0NZuFpIHfrdYEabBj3m0a90\ndHty6IsQmp/eQP8T0ClGOq9fjyXf+zw7nWqtmeJ8SmX9NYEI9iwtQJnxgxutXQg8\nX8Klx5FSoMixuZskejtU0AuyvOX7r5kTcg9k6zExHNvpl+5kt+AdbL32CjXT6H08\n++nMff/ClrGQnyJtw9qDsUu3ccF3lNwLvTapGV6DBkEKwuKLHm52eAlvdqSyr8Ax\nSbLOMVKog9ri8fm+1yxu0Ybpa44FC7VssVnw/IS2+T4XwRiz0Jza5aHBpCclxXeD\nrntg4E93kaZ0D2nGKntYp4dnI99TycfyAgzchRLK+2tFkV1Pag6eRaJC7NmGNKsV\nzKuGOwoQ/nYq7ZpQo3aCEkla7t0md19WU0TBHYZtbfS/feRU+mhHCGNmOIjXISyk\nfuGFITXNrRU2EMW8wE3GdvcGyWkza2KvH/oRrIAEbD1oZt/7cUsHj4OJJGsyhGz4\noAgq+GY2JlIgtIgYGXVlvDNxOkVjEVYxBGUogiarmMhkK296USB215EsjChQ1kc6\nGjr+XYJKTrZH1bV33a8h\n=BoTX\n-----END PGP SIGNATURE-----",
      "payload": "tree 972b8ec1103241478684182473a417969ec30150\nparent d61f3d038344734da3eb4b1cb085f387f8ad4ffa\nauthor Jon Turney <jon.turney@dronecode.org.uk> 1594995947 +0100\ncommitter Jon Turney <jon.turney@dronecode.org.uk> 1597241310 +0100\n\nOnly warn about malformed win32pstatus notes\n\nbfd/ChangeLog:\n\n2020-07-21  Jon Turney  <jon.turney@dronecode.org.uk>\n\n\t* elf.c (elfcore_grok_win32pstatus): Warn on malformed\n\twin32pstatus notes, and return TRUE so we continue rather than\n\tstopping as if it was an error.\n"
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/404ec93359eaaf6a4284613e9c3ac014eea9383b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/404ec93359eaaf6a4284613e9c3ac014eea9383b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/404ec93359eaaf6a4284613e9c3ac014eea9383b/comments",
  "author": {
    "login": "jon-turney",
    "id": 3497232,
    "node_id": "MDQ6VXNlcjM0OTcyMzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3497232?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jon-turney",
    "html_url": "https://github.com/jon-turney",
    "followers_url": "https://api.github.com/users/jon-turney/followers",
    "following_url": "https://api.github.com/users/jon-turney/following{/other_user}",
    "gists_url": "https://api.github.com/users/jon-turney/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jon-turney/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jon-turney/subscriptions",
    "organizations_url": "https://api.github.com/users/jon-turney/orgs",
    "repos_url": "https://api.github.com/users/jon-turney/repos",
    "events_url": "https://api.github.com/users/jon-turney/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jon-turney/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jon-turney",
    "id": 3497232,
    "node_id": "MDQ6VXNlcjM0OTcyMzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3497232?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jon-turney",
    "html_url": "https://github.com/jon-turney",
    "followers_url": "https://api.github.com/users/jon-turney/followers",
    "following_url": "https://api.github.com/users/jon-turney/following{/other_user}",
    "gists_url": "https://api.github.com/users/jon-turney/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jon-turney/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jon-turney/subscriptions",
    "organizations_url": "https://api.github.com/users/jon-turney/orgs",
    "repos_url": "https://api.github.com/users/jon-turney/repos",
    "events_url": "https://api.github.com/users/jon-turney/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jon-turney/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d61f3d038344734da3eb4b1cb085f387f8ad4ffa",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d61f3d038344734da3eb4b1cb085f387f8ad4ffa",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d61f3d038344734da3eb4b1cb085f387f8ad4ffa"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 32,
    "deletions": 13
  },
  "files": [
    {
      "sha": "5539e980d6d78fdb767a3a0430f75d668acaf9e7",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/404ec93359eaaf6a4284613e9c3ac014eea9383b/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/404ec93359eaaf6a4284613e9c3ac014eea9383b/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=404ec93359eaaf6a4284613e9c3ac014eea9383b",
      "patch": "@@ -1,3 +1,9 @@\n+2020-07-21  Jon Turney  <jon.turney@dronecode.org.uk>\n+\n+\t* elf.c (elfcore_grok_win32pstatus): Warn on malformed\n+\twin32pstatus notes, and return TRUE so we continue rather than\n+\tstopping as if it was an error.\n+\n 2020-07-01  Jon Turney  <jon.turney@dronecode.org.uk>\n \n \t* elf.c (elfcore_grok_win32pstatus): Handle NOTE_INFO_MODULE64."
    },
    {
      "sha": "e8c457cd5d52e9b1f77f3ac9bcee7cf2c376938e",
      "filename": "bfd/elf.c",
      "status": "modified",
      "additions": 26,
      "deletions": 13,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/404ec93359eaaf6a4284613e9c3ac014eea9383b/bfd/elf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/404ec93359eaaf6a4284613e9c3ac014eea9383b/bfd/elf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf.c?ref=404ec93359eaaf6a4284613e9c3ac014eea9383b",
      "patch": "@@ -10154,21 +10154,36 @@ elfcore_grok_win32pstatus (bfd *abfd, Elf_Internal_Note *note)\n \n   type = bfd_get_32 (abfd, note->descdata);\n \n+  struct {\n+    const char *type_name;\n+    unsigned long min_size;\n+  } size_check[] =\n+      {\n+       { \"NOTE_INFO_PROCESS\", 12 },\n+       { \"NOTE_INFO_THREAD\", 12 },\n+       { \"NOTE_INFO_MODULE\", 12 },\n+       { \"NOTE_INFO_MODULE64\", 16 },\n+      };\n+\n+  if (type > (sizeof(size_check)/sizeof(size_check[0])))\n+      return TRUE;\n+\n+  if (note->descsz < size_check[type - 1].min_size)\n+    {\n+      _bfd_error_handler (_(\"%pB: warning: win32pstatus %s of size %lu bytes is too small\"),\n+                          abfd, size_check[type - 1].type_name, note->descsz);\n+      return TRUE;\n+    }\n+\n   switch (type)\n     {\n     case NOTE_INFO_PROCESS:\n-      if (note->descsz < 12)\n-        return FALSE;\n-\n       /* FIXME: need to add ->core->command.  */\n       elf_tdata (abfd)->core->pid = bfd_get_32 (abfd, note->descdata + 4);\n       elf_tdata (abfd)->core->signal = bfd_get_32 (abfd, note->descdata + 8);\n       break;\n \n     case NOTE_INFO_THREAD:\n-      if (note->descsz < 12)\n-        return FALSE;\n-\n       /* Make a \".reg/<tid>\" section containing the Win32 API thread CONTEXT\n          structure. */\n       /* thread_info.tid */\n@@ -10204,9 +10219,6 @@ elfcore_grok_win32pstatus (bfd *abfd, Elf_Internal_Note *note)\n       /* Make a \".module/xxxxxxxx\" section.  */\n       if (type == NOTE_INFO_MODULE)\n         {\n-          if (note->descsz < 12)\n-            return FALSE;\n-\n           /* module_info.base_address */\n           base_addr = bfd_get_32 (abfd, note->descdata + 4);\n           sprintf (buf, \".module/%08lx\", (unsigned long) base_addr);\n@@ -10215,9 +10227,6 @@ elfcore_grok_win32pstatus (bfd *abfd, Elf_Internal_Note *note)\n         }\n       else /* NOTE_INFO_MODULE64 */\n         {\n-          if (note->descsz < 16)\n-            return FALSE;\n-\n           /* module_info.base_address */\n           base_addr = bfd_get_64 (abfd, note->descdata + 4);\n           sprintf (buf, \".module/%016lx\", (unsigned long) base_addr);\n@@ -10238,7 +10247,11 @@ elfcore_grok_win32pstatus (bfd *abfd, Elf_Internal_Note *note)\n \treturn FALSE;\n \n       if (note->descsz < 12 + name_size)\n-        return FALSE;\n+        {\n+          _bfd_error_handler (_(\"%pB: win32pstatus NOTE_INFO_MODULE of size %lu is too small to contain a name of size %zu\"),\n+                              abfd, note->descsz, name_size);\n+          return TRUE;\n+        }\n \n       sect->size = note->descsz;\n       sect->filepos = note->descpos;"
    }
  ]
}