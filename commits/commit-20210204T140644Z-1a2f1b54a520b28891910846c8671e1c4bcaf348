{
  "sha": "1a2f1b54a520b28891910846c8671e1c4bcaf348",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MWEyZjFiNTRhNTIwYjI4ODkxOTEwODQ2Yzg2NzFlMWM0YmNhZjM0OA==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-02-04T14:02:13Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-02-04T14:06:44Z"
    },
    "message": "x86-64: Provide more info when failed to convert GOTPCREL\n\nProvide\n\n[hjl@gnu-cfl-2 ld]$ ./ld-new -z norelro  -L/export/gnu/import/git/gitlab/x86-binutils/ld/testsuite/ld-x86-64  -melf32_x86_64 -Ttext=0x80000000 -o tmpdir/dump tmpdir/pr19609-7.o\ntmpdir/pr19609-7.o: in function `_start':\n(.text+0x2): failed to convert GOTPCREL relocation against 'foobar'; relink with --no-relax\n[hjl@gnu-cfl-2 ld]$\n\ninstead of\n\n[hjl@gnu-cfl-2 ld]$ ld -z norelro  -L/export/gnu/import/git/gitlab/x86-binutils/ld/testsuite/ld-x86-64  -melf32_x86_64 -Ttext=0x80000000 -o tmpdir/dump tmpdir/pr19609-7.o\nld: failed to convert GOTPCREL relocation; relink with --no-relax\n[hjl@gnu-cfl-2 ld]$\n\nbfd/\n\n\tPR ld/19609\n\t* elf64-x86-64.c (elf_x86_64_relocate_section): Provide more\n\tinfo when failed to convert GOTPCREL relocation.\n\nld/\n\n\tPR ld/19609\n\t* testsuite/ld-x86-64/pr19609-2a.d: Updated.\n\t* testsuite/ld-x86-64/pr19609-2b.d: Likewise.\n\t* testsuite/ld-x86-64/pr19609-4a.d: Likewise.\n\t* testsuite/ld-x86-64/pr19609-4c.d: Likewise.\n\t* testsuite/ld-x86-64/pr19609-5d.d: Likewise.\n\t* testsuite/ld-x86-64/pr19609-7a.d: Likewise.\n\t* testsuite/ld-x86-64/pr19609-7c.d: Likewise.",
    "tree": {
      "sha": "b61a6448f833763aac399ceb12ff22d71ef6e2ec",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/b61a6448f833763aac399ceb12ff22d71ef6e2ec"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/1a2f1b54a520b28891910846c8671e1c4bcaf348",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1a2f1b54a520b28891910846c8671e1c4bcaf348",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/1a2f1b54a520b28891910846c8671e1c4bcaf348",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1a2f1b54a520b28891910846c8671e1c4bcaf348/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "37707bd8221c2e3f7676de8bee0c42ce3ab38c77",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/37707bd8221c2e3f7676de8bee0c42ce3ab38c77",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/37707bd8221c2e3f7676de8bee0c42ce3ab38c77"
    }
  ],
  "stats": {
    "total": 44,
    "additions": 34,
    "deletions": 10
  },
  "files": [
    {
      "sha": "ba608e1e77f22eb52aad61ae5d56b168b66b847b",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,3 +1,9 @@\n+2021-02-04  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/19609\n+\t* elf64-x86-64.c (elf_x86_64_relocate_section): Provide more\n+\tinfo when failed to convert GOTPCREL relocation.\n+\n 2021-02-04  Nelson Chu  <nelson.chu@sifive.com>\n \n \t* elfxx-riscv.c (riscv_parse_prefixed_ext): Removed zb*."
    },
    {
      "sha": "bba22008c0642f6c8fe1e65d98ff5c8ba3ef2a5a",
      "filename": "bfd/elf64-x86-64.c",
      "status": "modified",
      "additions": 10,
      "deletions": 3,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/bfd/elf64-x86-64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/bfd/elf64-x86-64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf64-x86-64.c?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -2430,6 +2430,7 @@ elf_x86_64_relocate_section (bfd *output_bfd,\n   Elf_Internal_Rela *wrel;\n   Elf_Internal_Rela *relend;\n   unsigned int plt_entry_size;\n+  bfd_boolean status;\n \n   /* Skip if check_relocs failed.  */\n   if (input_section->check_relocs_failed)\n@@ -2453,6 +2454,7 @@ elf_x86_64_relocate_section (bfd *output_bfd,\n \n   _bfd_x86_elf_set_tls_module_base (info);\n \n+  status = TRUE;\n   rel = wrel = relocs;\n   relend = relocs + input_section->reloc_count;\n   for (; rel < relend; wrel++, rel++)\n@@ -4118,8 +4120,13 @@ elf_x86_64_relocate_section (bfd *output_bfd,\n \t      if (converted_reloc)\n \t\t{\n \t\t  info->callbacks->einfo\n-\t\t    (_(\"%F%P: failed to convert GOTPCREL relocation; relink with --no-relax\\n\"));\n-\t\t  return FALSE;\n+\t\t    (\"%X%H:\", input_bfd, input_section, rel->r_offset);\n+\t\t  info->callbacks->einfo\n+\t\t    (_(\" failed to convert GOTPCREL relocation against \"\n+\t\t       \"'%s'; relink with --no-relax\\n\"),\n+\t\t     name);\n+\t\t  status = FALSE;\n+\t\t  continue;\n \t\t}\n \t      (*info->callbacks->reloc_overflow)\n \t\t(info, (h ? &h->root : NULL), name, howto->name,\n@@ -4160,7 +4167,7 @@ elf_x86_64_relocate_section (bfd *output_bfd,\n       input_section->reloc_count -= deleted;\n     }\n \n-  return TRUE;\n+  return status;\n }\n \n /* Finish up dynamic symbol handling.  We set the contents of various"
    },
    {
      "sha": "52639f30b2007cb1c24d083af082c133c47245dc",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,3 +1,14 @@\n+2021-02-04  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\tPR ld/19609\n+\t* testsuite/ld-x86-64/pr19609-2a.d: Updated.\n+\t* testsuite/ld-x86-64/pr19609-2b.d: Likewise.\n+\t* testsuite/ld-x86-64/pr19609-4a.d: Likewise.\n+\t* testsuite/ld-x86-64/pr19609-4c.d: Likewise.\n+\t* testsuite/ld-x86-64/pr19609-5d.d: Likewise.\n+\t* testsuite/ld-x86-64/pr19609-7a.d: Likewise.\n+\t* testsuite/ld-x86-64/pr19609-7c.d: Likewise.\n+\n 2021-02-04  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR ld/15146"
    },
    {
      "sha": "6d3db92afb71b6eb3eb457949946fdf64ef06cd7",
      "filename": "ld/testsuite/ld-x86-64/pr19609-2a.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-2a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-2a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-2a.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-2.s\n #as: --64 -mrelax-relocations=yes\n #ld: -melf_x86_64 -Ttext=0x70000000 -Tdata=0xa0000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'foo'; relink with --no-relax.*"
    },
    {
      "sha": "4fee93d7034d7c218ad658acb49a1535e1ea9fa3",
      "filename": "ld/testsuite/ld-x86-64/pr19609-2b.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-2b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-2b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-2b.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-2.s\n #as: --x32 -mrelax-relocations=yes\n #ld: -melf32_x86_64 -Ttext=0x70000000 -Tdata=0xa0000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'foo'; relink with --no-relax.*"
    },
    {
      "sha": "eb37d0c8729b56489da2fa165f7811582870a7f2",
      "filename": "ld/testsuite/ld-x86-64/pr19609-4a.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-4a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-4a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-4a.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-4.s\n #as: --64 -mrelax-relocations=yes\n #ld: -melf_x86_64 -Ttext=0x70000000 -Tdata=0xa0000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'foo'; relink with --no-relax.*failed to convert GOTPCREL relocation against 'foo'; relink with --no-relax.*"
    },
    {
      "sha": "eb37d0c8729b56489da2fa165f7811582870a7f2",
      "filename": "ld/testsuite/ld-x86-64/pr19609-4c.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-4c.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-4c.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-4c.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-4.s\n #as: --64 -mrelax-relocations=yes\n #ld: -melf_x86_64 -Ttext=0x70000000 -Tdata=0xa0000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'foo'; relink with --no-relax.*failed to convert GOTPCREL relocation against 'foo'; relink with --no-relax.*"
    },
    {
      "sha": "0ab28efff1efd3ec23ee613af8c358903313a087",
      "filename": "ld/testsuite/ld-x86-64/pr19609-5d.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-5d.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-5d.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-5d.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-5.s\n #as: --64 -mrelax-relocations=yes\n #ld: -melf_x86_64 -Ttext=0x80000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'bar'; relink with --no-relax"
    },
    {
      "sha": "34704a94c16408eedc1b52b9cb78d7d2de94adc9",
      "filename": "ld/testsuite/ld-x86-64/pr19609-7a.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-7a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-7a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-7a.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-7.s\n #as: --64 -mrelax-relocations=yes\n #ld: -melf_x86_64 -Ttext=0x80000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'foobar'; relink with --no-relax"
    },
    {
      "sha": "09488e22a8e5473ec618058e96fe70d9f612cbbd",
      "filename": "ld/testsuite/ld-x86-64/pr19609-7c.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-7c.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/1a2f1b54a520b28891910846c8671e1c4bcaf348/ld/testsuite/ld-x86-64/pr19609-7c.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-x86-64/pr19609-7c.d?ref=1a2f1b54a520b28891910846c8671e1c4bcaf348",
      "patch": "@@ -1,4 +1,4 @@\n #source: pr19609-7.s\n #as: --x32 -mrelax-relocations=yes\n #ld: -melf32_x86_64 -Ttext=0x80000000\n-#error: failed to convert GOTPCREL relocation; relink with --no-relax\n+#error: .*failed to convert GOTPCREL relocation against 'foobar'; relink with --no-relax"
    }
  ]
}