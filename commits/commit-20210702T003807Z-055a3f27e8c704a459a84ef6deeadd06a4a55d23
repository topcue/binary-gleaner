{
  "sha": "055a3f27e8c704a459a84ef6deeadd06a4a55d23",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MDU1YTNmMjdlOGM3MDRhNDU5YTg0ZWY2ZGVlYWRkMDZhNGE1NWQyMw==",
  "commit": {
    "author": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-07-01T00:30:43Z"
    },
    "committer": {
      "name": "Mike Frysinger",
      "email": "vapier@gentoo.org",
      "date": "2021-07-02T00:38:07Z"
    },
    "message": "sim: m32r: fix virtual environment with Linux targets\n\nWe don't want to handle Linux syscalls when in the virtual environment,\njust the user environment, so adjust the Linux traps logic to check for\nthat specifically (instead of just skipping the operating environment).\n\nAlso tweak some testcases to explicitly specify the environment they run\nunder rather than relying on the default matching their needs.  This gets\nthe tests passing for all m32r targets.",
    "tree": {
      "sha": "829e3b6af9bcef984e5e5054eadae517926d06f3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/829e3b6af9bcef984e5e5054eadae517926d06f3"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/055a3f27e8c704a459a84ef6deeadd06a4a55d23",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/055a3f27e8c704a459a84ef6deeadd06a4a55d23",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/055a3f27e8c704a459a84ef6deeadd06a4a55d23",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/055a3f27e8c704a459a84ef6deeadd06a4a55d23/comments",
  "author": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vapier",
    "id": 176950,
    "node_id": "MDQ6VXNlcjE3Njk1MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vapier",
    "html_url": "https://github.com/vapier",
    "followers_url": "https://api.github.com/users/vapier/followers",
    "following_url": "https://api.github.com/users/vapier/following{/other_user}",
    "gists_url": "https://api.github.com/users/vapier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vapier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vapier/subscriptions",
    "organizations_url": "https://api.github.com/users/vapier/orgs",
    "repos_url": "https://api.github.com/users/vapier/repos",
    "events_url": "https://api.github.com/users/vapier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vapier/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "33b477e1c7fc12b21934e5f8fa799c163a554b20",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/33b477e1c7fc12b21934e5f8fa799c163a554b20",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/33b477e1c7fc12b21934e5f8fa799c163a554b20"
    }
  ],
  "stats": {
    "total": 23,
    "additions": 15,
    "deletions": 8
  },
  "files": [
    {
      "sha": "19ddf8f56002dc874a7935fbf2e0c7047a6ccc92",
      "filename": "sim/m32r/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/m32r/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/m32r/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32r/ChangeLog?ref=055a3f27e8c704a459a84ef6deeadd06a4a55d23",
      "patch": "@@ -1,3 +1,8 @@\n+2021-07-01  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* traps-linux.c (m32r_trap): Change OPERATING_ENVIRONMENT check to\n+\t!USER_ENVIRONMENT.  Jump to default switch case.\n+\n 2021-07-01  Mike Frysinger  <vapier@gentoo.org>\n \n \t* syscall.h: Change __NR_ prefix on all symbols to TARGET_LINUX_SYS_."
    },
    {
      "sha": "7aec04b5116f7df9b4da34b65b1b04a6b6652e18",
      "filename": "sim/m32r/traps-linux.c",
      "status": "modified",
      "additions": 3,
      "deletions": 8,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/m32r/traps-linux.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/m32r/traps-linux.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/m32r/traps-linux.c?ref=055a3f27e8c704a459a84ef6deeadd06a4a55d23",
      "patch": "@@ -231,14 +231,8 @@ m32r_trap (SIM_CPU *current_cpu, PCADDR pc, int num)\n         unsigned int func, arg1, arg2, arg3, arg4, arg5, arg6, arg7;\n         int result, result2, errcode;\n \n-        if (STATE_ENVIRONMENT (sd) == OPERATING_ENVIRONMENT)\n-          {\n-            /* The new pc is the trap vector entry.\n-               We assume there's a branch there to some handler.\n-\t       Use cr5 as EVB (EIT Vector Base) register.  */\n-            USI new_pc = m32rbf_h_cr_get (current_cpu, 5) + 0x40 + num * 4;\n-            return new_pc;\n-          }\n+\tif (STATE_ENVIRONMENT (sd) != USER_ENVIRONMENT)\n+\t  goto case_default;\n \n \tfunc = m32rbf_h_gr_get (current_cpu, 7);\n \targ1 = m32rbf_h_gr_get (current_cpu, 0);\n@@ -1344,6 +1338,7 @@ m32r_trap (SIM_CPU *current_cpu, PCADDR pc, int num)\n       /* Do nothing.  */\n       break;\n \n+    case_default:\n     default :\n       {\n \t/* Use cr5 as EVB (EIT Vector Base) register.  */"
    },
    {
      "sha": "535435ac3f889ae4002f9e1cda5a4542ec9de1f5",
      "filename": "sim/testsuite/m32r/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/testsuite/m32r/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/testsuite/m32r/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/testsuite/m32r/ChangeLog?ref=055a3f27e8c704a459a84ef6deeadd06a4a55d23",
      "patch": "@@ -1,3 +1,8 @@\n+2021-07-01  Mike Frysinger  <vapier@gentoo.org>\n+\n+\t* hw-trap.ms: Run sim with --environment virtual.\n+\t* trap.cgs: Likewise.\n+\n 2021-04-08  Mike Frysinger  <vapier@gentoo.org>\n \n \t* allinsn.exp (arch): Delete."
    },
    {
      "sha": "09790248d10d3100626c7403b1f14518d63191b5",
      "filename": "sim/testsuite/m32r/hw-trap.ms",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/testsuite/m32r/hw-trap.ms",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/testsuite/m32r/hw-trap.ms",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/testsuite/m32r/hw-trap.ms?ref=055a3f27e8c704a459a84ef6deeadd06a4a55d23",
      "patch": "@@ -1,4 +1,5 @@\n # mach(): m32r m32rx\n+# sim: --environment virtual\n # output(): pass\\n\n \n \t.include \"testutils.inc\""
    },
    {
      "sha": "f132d165367ffda30f849cbf125227b548852e77",
      "filename": "sim/testsuite/m32r/trap.cgs",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/testsuite/m32r/trap.cgs",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/055a3f27e8c704a459a84ef6deeadd06a4a55d23/sim/testsuite/m32r/trap.cgs",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/sim/testsuite/m32r/trap.cgs?ref=055a3f27e8c704a459a84ef6deeadd06a4a55d23",
      "patch": "@@ -1,5 +1,6 @@\n # m32r testcase for trap #$uimm4\n # mach(): m32r m32rx\n+# sim: --environment virtual\n \n \t.include \"testutils.inc\"\n "
    }
  ]
}