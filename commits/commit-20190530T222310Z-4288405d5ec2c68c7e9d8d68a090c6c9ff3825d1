{
  "sha": "4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDI4ODQwNWQ1ZWMyYzY4YzdlOWQ4ZDY4YTA5MGM2YzlmZjM4MjVkMQ==",
  "commit": {
    "author": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-05-30T22:23:10Z"
    },
    "committer": {
      "name": "Jim Wilson",
      "email": "jimw@sifive.com",
      "date": "2019-05-30T22:23:10Z"
    },
    "message": "RISC-V: Fix lui argument parsing.\n\nThis fixes a bug reported on the riscv.org sw-dev mailing list.  This\nrejects \"lui x1,symbol\", as a symbol should only be accepted here when\nused inside %hi().  Without the fix, this gets assembled as \"lui x1,0\"\nwith no relocation which is clearly wrong.\n\n\tgas/\n\t* config/tc-riscv.c (riscv_ip) <'u'>: Move O_constant check inside if\n\tstatement.  Delete O_symbol and O_constant check after if statement.\n\t* testsuite/gas/riscv/auipc-parsing.s: Test lui with missing %hi.\n\t* testsuite/gas/riscv/auipc-parsing.l: Update.",
    "tree": {
      "sha": "06921438e37620645355d10a780474480f4b59ce",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/06921438e37620645355d10a780474480f4b59ce"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "bfcdb85206cd3c3b8ad73b13db6bfb2ec608239b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bfcdb85206cd3c3b8ad73b13db6bfb2ec608239b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bfcdb85206cd3c3b8ad73b13db6bfb2ec608239b"
    }
  ],
  "stats": {
    "total": 21,
    "additions": 16,
    "deletions": 5
  },
  "files": [
    {
      "sha": "d46026565c38088337ec0ed00212a3acf405276a",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
      "patch": "@@ -1,3 +1,10 @@\n+2019-05-30  Jim Wilson  <jimw@sifive.com>\n+\n+\t* config/tc-riscv.c (riscv_ip) <'u'>: Move O_constant check inside if\n+\tstatement.  Delete O_symbol and O_constant check after if statement.\n+\t* testsuite/gas/riscv/auipc-parsing.s: Test lui with missing %hi.\n+\t* testsuite/gas/riscv/auipc-parsing.l: Update.\n+\n 2019-05-28  H.J. Lu  <hongjiu.lu@intel.com>\n \n \tPR gas/24625"
    },
    {
      "sha": "f0c1f4ca75cd65203778083270d7af6f806d33c7",
      "filename": "gas/config/tc-riscv.c",
      "status": "modified",
      "additions": 4,
      "deletions": 5,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/config/tc-riscv.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/config/tc-riscv.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-riscv.c?ref=4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
      "patch": "@@ -1952,19 +1952,18 @@ riscv_ip (char *str, struct riscv_cl_insn *ip, expressionS *imm_expr,\n \n \t    case 'u':\t\t/* Upper 20 bits.  */\n \t      p = percent_op_utype;\n-\t      if (!my_getSmallExpression (imm_expr, imm_reloc, s, p)\n-\t\t  && imm_expr->X_op == O_constant)\n+\t      if (!my_getSmallExpression (imm_expr, imm_reloc, s, p))\n \t\t{\n+\t\t  if (imm_expr->X_op != O_constant)\n+\t\t    break;\n+\n \t\t  if (imm_expr->X_add_number < 0\n \t\t      || imm_expr->X_add_number >= (signed)RISCV_BIGIMM_REACH)\n \t\t    as_bad (_(\"lui expression not in range 0..1048575\"));\n \n \t\t  *imm_reloc = BFD_RELOC_RISCV_HI20;\n \t\t  imm_expr->X_add_number <<= RISCV_IMM_BITS;\n \t\t}\n-\t      /* The 'u' format specifier must be a symbol or a constant.  */\n-\t      if (imm_expr->X_op != O_symbol && imm_expr->X_op != O_constant)\n-\t        break;\n \t      s = expr_end;\n \t      continue;\n "
    },
    {
      "sha": "54eedcbf04fab862c735f58ac4a6d5824e7a5ac5",
      "filename": "gas/testsuite/gas/riscv/auipc-parsing.l",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/testsuite/gas/riscv/auipc-parsing.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/testsuite/gas/riscv/auipc-parsing.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/auipc-parsing.l?ref=4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
      "patch": "@@ -1,3 +1,5 @@\n .*: Assembler messages:\n .*: Error: illegal operands `auipc x8,x9'\n .*: Error: illegal operands `lui x10,x11'\n+.*: Error: illegal operands `auipc x12,symbol'\n+.*: Error: illegal operands `lui x13,symbol'"
    },
    {
      "sha": "7af4df9ede1472186e4dbb52dd795a3cbd05a343",
      "filename": "gas/testsuite/gas/riscv/auipc-parsing.s",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/testsuite/gas/riscv/auipc-parsing.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1/gas/testsuite/gas/riscv/auipc-parsing.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/riscv/auipc-parsing.s?ref=4288405d5ec2c68c7e9d8d68a090c6c9ff3825d1",
      "patch": "@@ -1,3 +1,6 @@\n # Don't accept a register for 'u' operands.\n \tauipc\tx8,x9\n \tlui\tx10,x11\n+# Don't accept a symbol without %hi() for 'u' operands.\n+\tauipc\tx12,symbol\n+\tlui\tx13,symbol"
    }
  ]
}