{
  "sha": "f936bca26dd7593a3b792e76eba37c5de2374961",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZjkzNmJjYTI2ZGQ3NTkzYTNiNzkyZTc2ZWJhMzdjNWRlMjM3NDk2MQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-06-17T21:45:14Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2019-06-25T13:48:42Z"
    },
    "message": "Remove some TUI static allocations\n\nThe TUI statically allocates the \"execution_info\" for the source and\ndisassembly windows.  However, there's no deep reason to do this, and\nthis approach makes it harder to allow multiple such windows.\n\nThis patch removes the static data and changes the code to simply\nallocate these windows as needed.  This required pushing some code\ninto the tui_gen_win_info destructor, but that seems like a good idea\nanyhow.\n\ngdb/ChangeLog\n2019-06-25  Tom Tromey  <tom@tromey.com>\n\n\t* tui/tui-layout.c (make_source_or_disasm_window): Always use\n\tinit_and_make_win for EXEC_INFO_WIN.\n\t* tui/tui-data.h (struct tui_gen_win_info) <~tui_gen_win_info>: No\n\tlonger inline.\n\t(struct tui_win_info) <~tui_win_info>: Inline.\n\t(tui_source_exec_info_win_ptr, tui_disassem_exec_info_win_ptr):\n\tDon't declare.\n\t* tui/tui-data.c (source_win, disasm_win): Remove globals.\n\t(tui_source_exec_info_win_ptr, tui_disassem_exec_info_win_ptr):\n\tRemove.\n\t(tui_initialize_static_data): Update.\n\t(~tui_gen_win_info): Handle more cleanup here.\n\t(~tui_source_window_base): Delete \"execution_info\".\n\t(~tui_win_info): Move code to ~tui_gen_win_info; remove.",
    "tree": {
      "sha": "2f76d11fd8f646ff531eb926ea69cc3b2e4c16df",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/2f76d11fd8f646ff531eb926ea69cc3b2e4c16df"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f936bca26dd7593a3b792e76eba37c5de2374961",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f936bca26dd7593a3b792e76eba37c5de2374961",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f936bca26dd7593a3b792e76eba37c5de2374961",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f936bca26dd7593a3b792e76eba37c5de2374961/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d6ba6a11642cdbec4ce91fefe455920b5c073f60",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d6ba6a11642cdbec4ce91fefe455920b5c073f60",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d6ba6a11642cdbec4ce91fefe455920b5c073f60"
    }
  ],
  "stats": {
    "total": 103,
    "additions": 41,
    "deletions": 62
  },
  "files": [
    {
      "sha": "db769282a22ceffe62c2748d920c67a576b5f863",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=f936bca26dd7593a3b792e76eba37c5de2374961",
      "patch": "@@ -1,3 +1,20 @@\n+2019-06-25  Tom Tromey  <tom@tromey.com>\n+\n+\t* tui/tui-layout.c (make_source_or_disasm_window): Always use\n+\tinit_and_make_win for EXEC_INFO_WIN.\n+\t* tui/tui-data.h (struct tui_gen_win_info) <~tui_gen_win_info>: No\n+\tlonger inline.\n+\t(struct tui_win_info) <~tui_win_info>: Inline.\n+\t(tui_source_exec_info_win_ptr, tui_disassem_exec_info_win_ptr):\n+\tDon't declare.\n+\t* tui/tui-data.c (source_win, disasm_win): Remove globals.\n+\t(tui_source_exec_info_win_ptr, tui_disassem_exec_info_win_ptr):\n+\tRemove.\n+\t(tui_initialize_static_data): Update.\n+\t(~tui_gen_win_info): Handle more cleanup here.\n+\t(~tui_source_window_base): Delete \"execution_info\".\n+\t(~tui_win_info): Move code to ~tui_gen_win_info; remove.\n+\n 2019-06-25  Tom Tromey  <tom@tromey.com>\n \n \t* tui/tui-layout.c (make_command_window): Don't set"
    },
    {
      "sha": "3d1e0e6ff0e642ac4872e4de7e620dfbf830bbe2",
      "filename": "gdb/tui/tui-data.c",
      "status": "modified",
      "additions": 12,
      "deletions": 40,
      "changes": 52,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/tui/tui-data.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/tui/tui-data.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-data.c?ref=f936bca26dd7593a3b792e76eba37c5de2374961",
      "patch": "@@ -37,8 +37,6 @@ struct tui_win_info *tui_win_list[MAX_MAJOR_WINDOWS];\n static enum tui_layout_type current_layout = UNDEFINED_LAYOUT;\n static int term_height, term_width;\n static struct tui_gen_win_info _locator (LOCATOR_WIN);\n-static struct tui_gen_win_info source_win (EXEC_INFO_WIN);\n-static struct tui_gen_win_info disasm_win (EXEC_INFO_WIN);\n static std::vector<tui_source_window_base *> source_windows;\n static struct tui_win_info *win_with_focus = NULL;\n static struct tui_layout_def layout_def = {\n@@ -185,22 +183,6 @@ tui_data_window::clear_detail ()\n   display_regs = false;\n }\n \n-/* Accessor for the source execution info ptr.  */\n-struct tui_gen_win_info *\n-tui_source_exec_info_win_ptr (void)\n-{\n-  return &source_win;\n-}\n-\n-\n-/* Accessor for the disassem execution info ptr.  */\n-struct tui_gen_win_info *\n-tui_disassem_exec_info_win_ptr (void)\n-{\n-  return &disasm_win;\n-}\n-\n-\n /* Accessor for the locator win info.  Answers a pointer to the static\n    locator win info struct.  */\n struct tui_gen_win_info *\n@@ -354,8 +336,6 @@ tui_partial_win_by_name (const char *name)\n void\n tui_initialize_static_data (void)\n {\n-  tui_init_generic_part (tui_source_exec_info_win_ptr ());\n-  tui_init_generic_part (tui_disassem_exec_info_win_ptr ());\n   tui_init_generic_part (tui_locator_win_info_ptr ());\n }\n \n@@ -525,16 +505,21 @@ tui_add_content_elements (struct tui_gen_win_info *win_info,\n   return index_start;\n }\n \n-tui_source_window_base::~tui_source_window_base ()\n+tui_gen_win_info::~tui_gen_win_info ()\n {\n-  xfree (fullname);\n-  struct tui_gen_win_info *generic_win = execution_info;\n-  if (generic_win != NULL)\n+  if (handle != NULL)\n     {\n-      tui_delete_win (generic_win->handle);\n-      generic_win->handle = NULL;\n-      tui_free_win_content (generic_win);\n+      tui_delete_win (handle);\n+      handle = NULL;\n+      tui_free_win_content (this);\n     }\n+  xfree (title);\n+}\n+\n+tui_source_window_base::~tui_source_window_base ()\n+{\n+  xfree (fullname);\n+  delete execution_info;\n }  \n \n tui_data_window::~tui_data_window ()\n@@ -554,19 +539,6 @@ tui_data_window::~tui_data_window ()\n     }\n }  \n \n-tui_win_info::~tui_win_info ()\n-{\n-  if (handle != NULL)\n-    {\n-      tui_delete_win (handle);\n-      handle = NULL;\n-      tui_free_win_content (this);\n-    }\n-  if (title)\n-    xfree (title);\n-}\n-\n-\n void\n tui_free_all_source_wins_content ()\n {"
    },
    {
      "sha": "9c45d6f63768432e8a660c920418463893fd86cd",
      "filename": "gdb/tui/tui-data.h",
      "status": "modified",
      "additions": 4,
      "deletions": 6,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/tui/tui-data.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/tui/tui-data.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-data.h?ref=f936bca26dd7593a3b792e76eba37c5de2374961",
      "patch": "@@ -44,9 +44,7 @@ struct tui_gen_win_info\n   {\n   }\n \n-  virtual ~tui_gen_win_info ()\n-  {\n-  }\n+  virtual ~tui_gen_win_info ();\n \n   /* Call to refresh this window.  */\n   virtual void refresh_window ();\n@@ -272,7 +270,9 @@ struct tui_win_info : public tui_gen_win_info\n \n public:\n \n-  ~tui_win_info () override;\n+  ~tui_win_info () override\n+  {\n+  }\n \n   /* Clear the pertinent detail in the window.  */\n   virtual void clear_detail () = 0;\n@@ -524,8 +524,6 @@ extern void tui_set_term_height_to (int);\n extern int tui_term_width (void);\n extern void tui_set_term_width_to (int);\n extern struct tui_gen_win_info *tui_locator_win_info_ptr (void);\n-extern struct tui_gen_win_info *tui_source_exec_info_win_ptr (void);\n-extern struct tui_gen_win_info *tui_disassem_exec_info_win_ptr (void);\n extern std::vector<tui_source_window_base *> &tui_source_windows ();\n extern void tui_clear_source_windows (void);\n extern void tui_clear_source_windows_detail (void);"
    },
    {
      "sha": "695fa3560b210d99a81bfc13e3ec20d33cfb54e2",
      "filename": "gdb/tui/tui-layout.c",
      "status": "modified",
      "additions": 8,
      "deletions": 16,
      "changes": 24,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/tui/tui-layout.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f936bca26dd7593a3b792e76eba37c5de2374961/gdb/tui/tui-layout.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/tui/tui-layout.c?ref=f936bca26dd7593a3b792e76eba37c5de2374961",
      "patch": "@@ -814,22 +814,14 @@ static struct tui_win_info *\n make_source_or_disasm_window (enum tui_win_type type,\n \t\t\t      int height, int origin_y)\n {\n-  struct tui_gen_win_info *execution_info = NULL;\n-\n-  /* Create the exeuction info window.  */\n-  if (type == SRC_WIN)\n-    execution_info = tui_source_exec_info_win_ptr ();\n-  else\n-    execution_info = tui_disassem_exec_info_win_ptr ();\n-  execution_info\n-    = ((struct tui_gen_win_info *)\n-       init_and_make_win (execution_info,\n-\t\t\t  EXEC_INFO_WIN,\n-\t\t\t  height,\n-\t\t\t  3,\n-\t\t\t  0,\n-\t\t\t  origin_y,\n-\t\t\t  DONT_BOX_WINDOW));\n+  struct tui_gen_win_info *execution_info\n+    = init_and_make_win (nullptr,\n+\t\t\t EXEC_INFO_WIN,\n+\t\t\t height,\n+\t\t\t 3,\n+\t\t\t 0,\n+\t\t\t origin_y,\n+\t\t\t DONT_BOX_WINDOW);\n \n   /* Now create the source window.  */\n   struct tui_source_window_base *result"
    }
  ]
}