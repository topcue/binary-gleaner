{
  "sha": "7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzczNDEwMmQ2ZDhiNWEwY2NlYTE2NmY4ZTk0NGY4NGRjODk2YjlhZQ==",
  "commit": {
    "author": {
      "name": "Eli Zaretskii",
      "email": "eliz@gnu.org",
      "date": "2019-03-30T09:58:33Z"
    },
    "committer": {
      "name": "Eli Zaretskii",
      "email": "eliz@gnu.org",
      "date": "2019-03-30T09:58:33Z"
    },
    "message": "Introduce new convenience variables $_gdb_major and $_gdb_minor\n\ngdb/ChangeLog:\n2019-03-30  Eli Zaretskii  <eliz@gnu.org>\n\n\t* NEWS: Announce $_gdb_major and $_gdb_minor.\n\n\t* top.c (init_gdb_version_vars): New function.\n\t(gdb_init): Call init_gdb_version_vars.\n\ngdb/testsuite/ChangeLog:\n2019-03-30  Simon Marchi <simark@simark.ca>\n\n\t* gdb.base/default.exp: Add values for $_gdb_major and\n\t$_gdb_minor.\n\ngdb/doc/ChangeLog:\n2019-03-30  Eli Zaretskii  <eliz@gnu.org>\n\n\t* gdb.texinfo (Convenience Vars): Document $_gdb_major and\n\t$_gdb_minor.",
    "tree": {
      "sha": "d5badcb54e32b5979a785ef7ead0254d5fc2658d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/d5badcb54e32b5979a785ef7ead0254d5fc2658d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/comments",
  "author": {
    "login": "Eli-Zaretskii",
    "id": 20908835,
    "node_id": "MDQ6VXNlcjIwOTA4ODM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/20908835?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Eli-Zaretskii",
    "html_url": "https://github.com/Eli-Zaretskii",
    "followers_url": "https://api.github.com/users/Eli-Zaretskii/followers",
    "following_url": "https://api.github.com/users/Eli-Zaretskii/following{/other_user}",
    "gists_url": "https://api.github.com/users/Eli-Zaretskii/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Eli-Zaretskii/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Eli-Zaretskii/subscriptions",
    "organizations_url": "https://api.github.com/users/Eli-Zaretskii/orgs",
    "repos_url": "https://api.github.com/users/Eli-Zaretskii/repos",
    "events_url": "https://api.github.com/users/Eli-Zaretskii/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Eli-Zaretskii/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "Eli-Zaretskii",
    "id": 20908835,
    "node_id": "MDQ6VXNlcjIwOTA4ODM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/20908835?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Eli-Zaretskii",
    "html_url": "https://github.com/Eli-Zaretskii",
    "followers_url": "https://api.github.com/users/Eli-Zaretskii/followers",
    "following_url": "https://api.github.com/users/Eli-Zaretskii/following{/other_user}",
    "gists_url": "https://api.github.com/users/Eli-Zaretskii/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Eli-Zaretskii/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Eli-Zaretskii/subscriptions",
    "organizations_url": "https://api.github.com/users/Eli-Zaretskii/orgs",
    "repos_url": "https://api.github.com/users/Eli-Zaretskii/repos",
    "events_url": "https://api.github.com/users/Eli-Zaretskii/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Eli-Zaretskii/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "c6f03bce79fd93f152749e2a299a03ab78421f5f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c6f03bce79fd93f152749e2a299a03ab78421f5f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/c6f03bce79fd93f152749e2a299a03ab78421f5f"
    }
  ],
  "stats": {
    "total": 77,
    "additions": 64,
    "deletions": 13
  },
  "files": [
    {
      "sha": "a3dfd3169873113365687defd15902e7d8ffe730",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -1,3 +1,10 @@\n+2019-03-30  Eli Zaretskii  <eliz@gnu.org>\n+\n+\t* NEWS: Announce $_gdb_major and $_gdb_minor.\n+\n+\t* top.c (init_gdb_version_vars): New function.\n+\t(gdb_init): Call init_gdb_version_vars.\n+\n 2019-03-29  Tom Tromey  <tromey@adacore.com>\n \n \t* printcmd.c (_initialize_printcmd): Add usage lines.  Update some"
    },
    {
      "sha": "4bfa15becf5bece01aa62b5768073b29a3b2394e",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -3,6 +3,12 @@\n \n *** Changes since GDB 8.3\n \n+* New built-in convenience variables $_gdb_major and $_gdb_minor\n+  provide the GDB version.  They are handy for conditionally using\n+  features available only in or since specific GDB versions, in\n+  scripts that should work error-free with many different versions,\n+  such as in system-wide init files.\n+\n * GDB now supports Thread Local Storage (TLS) variables on several\n   FreeBSD architectures (amd64, i386, powerpc, riscv).  Other\n   architectures require kernel changes.  TLS is not yet supported for"
    },
    {
      "sha": "c0d5aac176455e13fa99ebf664e65ca64b957591",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -1,3 +1,8 @@\n+2019-03-30  Eli Zaretskii  <eliz@gnu.org>\n+\n+\t* gdb.texinfo (Convenience Vars): Document $_gdb_major and\n+\t$_gdb_minor.\n+\n 2019-03-26  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* python.texi (Pretty Printing API): Document use of None for the"
    },
    {
      "sha": "bb958cf25ddaad87e44131af6c173ae22dc76cf2",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 12,
      "deletions": 1,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -11197,7 +11197,7 @@ For example, it will be empty before you execute the @code{run} command.\n @vindex $_tlb@r{, convenience variable}\n The variable @code{$_tlb} is automatically set when debugging\n applications running on MS-Windows in native mode or connected to\n-gdbserver that supports the @code{qGetTIBAddr} request. \n+gdbserver that supports the @code{qGetTIBAddr} request.\n @xref{General Query Packets}.\n This variable contains the address of the thread information block.\n \n@@ -11211,6 +11211,17 @@ The thread number of the current thread.  @xref{thread numbers}.\n @item $_gthread\n The global number of the current thread.  @xref{global thread numbers}.\n \n+@item $_gdb_major\n+@itemx $_gdb_minor\n+@vindex $_gdb_major@r{, convenience variable}\n+@vindex $_gdb_minor@r{, convenience variable}\n+The major and minor version numbers of the running @value{GDBN}.\n+Development snapshots and pretest versions have their minor version\n+incremented by one; thus, @value{GDBN} pretest 9.11.90 will produce\n+the value 12 for @code{$_gdb_minor}.  These variables allow you to\n+write scripts that work with different versions of @value{GDBN}\n+without errors caused by features unavailable in some of those\n+versions.\n @end table\n \n @node Convenience Funs"
    },
    {
      "sha": "75bb6c6123f18cf1c2fa1cf5d94cf8e1a125b97a",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -1,3 +1,8 @@\n+2019-03-30  Simon Marchi <simark@simark.ca>\n+\n+\t* gdb.base/default.exp: Add values for $_gdb_major and\n+\t$_gdb_minor.\n+\n 2019-03-29  Tom Tromey  <tromey@adacore.com>\n \n \t* gdb.base/help.exp: Tighten apropos regexp."
    },
    {
      "sha": "9ff5144448d8402e337ff5efbd88f1eb1ebc0542",
      "filename": "gdb/testsuite/gdb.base/default.exp",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/testsuite/gdb.base/default.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/testsuite/gdb.base/default.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/default.exp?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -602,6 +602,8 @@ set show_conv_list \\\n \t{$_probe_arg10 = <error: No frame selected>} \\\n \t{$_probe_arg11 = <error: No frame selected>} \\\n \t{$_isvoid = <internal function _isvoid>} \\\n+\t{$_gdb_major = 8} \\\n+\t{$_gdb_minor = 4} \\\n     }\n if ![skip_python_tests] {\n     append show_conv_list \\"
    },
    {
      "sha": "afb77c0ec956f40726a33d0c987e8e4fe22c39a0",
      "filename": "gdb/top.c",
      "status": "modified",
      "additions": 27,
      "deletions": 12,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/top.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7734102d6d8b5a0ccea166f8e944f84dc896b9ae/gdb/top.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/top.c?ref=7734102d6d8b5a0ccea166f8e944f84dc896b9ae",
      "patch": "@@ -147,22 +147,22 @@ int server_command;\n \n /* Timeout limit for response from target.  */\n \n-/* The default value has been changed many times over the years.  It \n-   was originally 5 seconds.  But that was thought to be a long time \n+/* The default value has been changed many times over the years.  It\n+   was originally 5 seconds.  But that was thought to be a long time\n    to sit and wait, so it was changed to 2 seconds.  That was thought\n-   to be plenty unless the connection was going through some terminal \n+   to be plenty unless the connection was going through some terminal\n    server or multiplexer or other form of hairy serial connection.\n \n-   In mid-1996, remote_timeout was moved from remote.c to top.c and \n+   In mid-1996, remote_timeout was moved from remote.c to top.c and\n    it began being used in other remote-* targets.  It appears that the\n    default was changed to 20 seconds at that time, perhaps because the\n    Renesas E7000 ICE didn't always respond in a timely manner.\n \n    But if 5 seconds is a long time to sit and wait for retransmissions,\n-   20 seconds is far worse.  This demonstrates the difficulty of using \n+   20 seconds is far worse.  This demonstrates the difficulty of using\n    a single variable for all protocol timeouts.\n \n-   As remote.c is used much more than remote-e7000.c, it was changed \n+   As remote.c is used much more than remote-e7000.c, it was changed\n    back to 2 seconds in 1999.  */\n \n int remote_timeout = 2;\n@@ -188,9 +188,9 @@ int (*deprecated_ui_loop_hook) (int);\n \n /* Called from print_frame_info to list the line we stopped in.  */\n \n-void (*deprecated_print_frame_info_listing_hook) (struct symtab * s, \n+void (*deprecated_print_frame_info_listing_hook) (struct symtab * s,\n \t\t\t\t\t\t  int line,\n-\t\t\t\t\t\t  int stopline, \n+\t\t\t\t\t\t  int stopline,\n \t\t\t\t\t\t  int noerror);\n /* Replaces most of query.  */\n \n@@ -237,7 +237,7 @@ ptid_t (*deprecated_target_wait_hook) (ptid_t ptid,\n /* Used by UI as a wrapper around command execution.  May do various\n    things like enabling/disabling buttons, etc...  */\n \n-void (*deprecated_call_command_hook) (struct cmd_list_element * c, \n+void (*deprecated_call_command_hook) (struct cmd_list_element * c,\n \t\t\t\t      const char *cmd, int from_tty);\n \n /* Called when the current thread changes.  Argument is thread id.  */\n@@ -1339,8 +1339,9 @@ There is NO WARRANTY, to the extent permitted by law.\");\n resources online at:\\n    <http://www.gnu.org/software/gdb/documentation/>.\"));\n   fprintf_filtered (stream, \"\\n\\n\");\n   fprintf_filtered (stream, _(\"For help, type \\\"help\\\".\\n\"));\n-  fprintf_filtered (stream, _(\"Type \\\"apropos word\\\" to search for \\\n-commands related to \\\"word\\\".\"));\n+  fprintf_filtered (stream,\n+\t\t    _(\"Type \\\"apropos word\\\" to search for commands \\\n+related to \\\"word\\\".\"));\n }\n \n /* Print the details of GDB build-time configuration.  */\n@@ -1608,7 +1609,7 @@ quit_force (int *exit_arg, int from_tty)\n \n   undo_terminal_modifications_before_exit ();\n \n-  /* An optional expression may be used to cause gdb to terminate with the \n+  /* An optional expression may be used to cause gdb to terminate with the\n      value of that expression.  */\n   if (exit_arg)\n     exit_code = *exit_arg;\n@@ -2002,6 +2003,17 @@ set_history_filename (const char *args,\n \t\t\t\t history_filename, (char *) NULL);\n }\n \n+static void\n+init_gdb_version_vars (void)\n+{\n+  struct internalvar *major_version_var = create_internalvar (\"_gdb_major\");\n+  struct internalvar *minor_version_var = create_internalvar (\"_gdb_minor\");\n+  int vmajor = 0, vminor = 0, vrevision = 0;\n+  sscanf (version, \"%d.%d.%d\", &vmajor, &vminor, &vrevision);\n+  set_internalvar_integer (major_version_var, vmajor);\n+  set_internalvar_integer (minor_version_var, vminor + (vrevision > 0));\n+}\n+\n static void\n init_main (void)\n {\n@@ -2206,4 +2218,7 @@ gdb_init (char *argv0)\n      prefix to be installed.  Keep things simple and just do final\n      script initialization here.  */\n   finish_ext_lang_initialization ();\n+\n+  /* Create $_gdb_major and $_gdb_minor convenience variables.  */\n+  init_gdb_version_vars ();\n }"
    }
  ]
}