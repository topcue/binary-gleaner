{
  "sha": "4d1823674eedf267c7cafac2b923256db0b10ac8",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGQxODIzNjc0ZWVkZjI2N2M3Y2FmYWMyYjkyMzI1NmRiMGIxMGFjOA==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-08-15T00:12:44Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2020-08-15T04:46:02Z"
    },
    "message": "PR26389, nm prints \"c\" for a common symbol with -flto and -fcommon\n\ngit commit 49d9fd42acef chose to make nm print 'C' for the normal\ncommon section, and 'c' for other commons.  This was an attempt to\nmake common symbols in .scommon and other small common sections show\na 'c' type without a section name comparison, but it failed for\nnm --plugin on lto objects where normal common symbols are stashed in\na \"plug\" section.  It's also wrong for large common symbols.  So\ninstead set SEC_SMALL_DATA on sections created for small commons, and\nkey off that flag to show 'c' type.  If your ELF target doesn't have\nan elf_backend_symbol_processing function, then you won't see 'c' for\nsymbols in .scommon.\n\nNote that due to bfd_decode_symclass decoding common symbols without\na chance for coff_section_type to treat .scommon specially, then\nhaving .scommon in the array of special sections handled by\ncoff_section_type prior to 49d9fd42acef was entirely ineffective.\nThat fact escaped me when writing 49d9fd42acef.  Unless .scommon\ndidn't have SEC_IS_COMMON set, which would be a little weird.\n\n\tPR 26389\n\t* syms.c (bfd_decode_symclass): Choose 'c' for commons only when\n\tSEC_SMALL_DATA.\n\t* elf32-m32r.c (_bfd_m32r_elf_symbol_processing): Set SEC_SMALL_DATA\n\ton small common section.\n\t* elf32-score.c (s3_bfd_score_elf_symbol_processing): Likewise.\n\t* elf32-score7.c (s7_bfd_score_elf_symbol_processing): Likewise.\n\t* elf32-tic6x.c (elf32_tic6x_symbol_processing): Likewise.\n\t* elf32-v850.c (v850_elf_symbol_processing): Likewise.\n\t* elfxx-mips.c (_bfd_mips_elf_symbol_processing): Likewise.\n\t* ecoff.c (ecoff_set_symbol_info, ecoff_link_add_externals): Likewise.",
    "tree": {
      "sha": "f9c342023c7521c374baebe719774048d95a2895",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/f9c342023c7521c374baebe719774048d95a2895"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4d1823674eedf267c7cafac2b923256db0b10ac8",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4d1823674eedf267c7cafac2b923256db0b10ac8",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4d1823674eedf267c7cafac2b923256db0b10ac8",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4d1823674eedf267c7cafac2b923256db0b10ac8/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "a9ca57d09a0b7bffb583e42b8b49541727ce676b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/a9ca57d09a0b7bffb583e42b8b49541727ce676b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/a9ca57d09a0b7bffb583e42b8b49541727ce676b"
    }
  ],
  "stats": {
    "total": 41,
    "additions": 28,
    "deletions": 13
  },
  "files": [
    {
      "sha": "85fb61887a7cbc647106349bf2924e604a267b72",
      "filename": "bfd/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ChangeLog?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -1,3 +1,17 @@\n+2020-08-15  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 26389\n+\t* syms.c (bfd_decode_symclass): Choose 'c' for commons only when\n+\tSEC_SMALL_DATA.\n+\t* elf32-m32r.c (_bfd_m32r_elf_symbol_processing): Set SEC_SMALL_DATA\n+\ton small common section.\n+\t* elf32-score.c (s3_bfd_score_elf_symbol_processing): Likewise.\n+\t* elf32-score7.c (s7_bfd_score_elf_symbol_processing): Likewise.\n+\t* elf32-tic6x.c (elf32_tic6x_symbol_processing): Likewise.\n+\t* elf32-v850.c (v850_elf_symbol_processing): Likewise.\n+\t* elfxx-mips.c (_bfd_mips_elf_symbol_processing): Likewise.\n+\t* ecoff.c (ecoff_set_symbol_info, ecoff_link_add_externals): Likewise.\n+\n 2020-08-14  Alan Modra  <amodra@gmail.com>\n \n \t* hash.c (bfd_hash_set_default_size): Use higher_prime_number"
    },
    {
      "sha": "2e4bf888bea6a7bfa6c875278c9e04790ee8eaa5",
      "filename": "bfd/ecoff.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/ecoff.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/ecoff.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/ecoff.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -791,7 +791,7 @@ ecoff_set_symbol_info (bfd *abfd,\n \t{\n \t  /* Initialize the small common section.  */\n \t  ecoff_scom_section.name = SCOMMON;\n-\t  ecoff_scom_section.flags = SEC_IS_COMMON;\n+\t  ecoff_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  ecoff_scom_section.output_section = &ecoff_scom_section;\n \t  ecoff_scom_section.symbol = &ecoff_scom_symbol;\n \t  ecoff_scom_section.symbol_ptr_ptr = &ecoff_scom_symbol_ptr;\n@@ -3404,7 +3404,7 @@ ecoff_link_add_externals (bfd *abfd,\n \t    {\n \t      /* Initialize the small common section.  */\n \t      ecoff_scom_section.name = SCOMMON;\n-\t      ecoff_scom_section.flags = SEC_IS_COMMON;\n+\t      ecoff_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t      ecoff_scom_section.output_section = &ecoff_scom_section;\n \t      ecoff_scom_section.symbol = &ecoff_scom_symbol;\n \t      ecoff_scom_section.symbol_ptr_ptr = &ecoff_scom_symbol_ptr;"
    },
    {
      "sha": "ea8e3376512c81ce52bd8abf2697e5a89d7fb6d2",
      "filename": "bfd/elf32-m32r.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-m32r.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-m32r.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-m32r.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -1354,7 +1354,7 @@ _bfd_m32r_elf_symbol_processing (bfd *abfd ATTRIBUTE_UNUSED, asymbol *asym)\n \t{\n \t  /* Initialize the small common section.  */\n \t  m32r_elf_scom_section.name = \".scommon\";\n-\t  m32r_elf_scom_section.flags = SEC_IS_COMMON;\n+\t  m32r_elf_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  m32r_elf_scom_section.output_section = &m32r_elf_scom_section;\n \t  m32r_elf_scom_section.symbol = &m32r_elf_scom_symbol;\n \t  m32r_elf_scom_section.symbol_ptr_ptr = &m32r_elf_scom_symbol_ptr;"
    },
    {
      "sha": "4be656102f25fc640fb203dcc1a553d50021c572",
      "filename": "bfd/elf32-score.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-score.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-score.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-score.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -3035,7 +3035,7 @@ s3_bfd_score_elf_symbol_processing (bfd *abfd, asymbol *asym)\n \t{\n \t  /* Initialize the small common section.  */\n \t  score_elf_scom_section.name = \".scommon\";\n-\t  score_elf_scom_section.flags = SEC_IS_COMMON;\n+\t  score_elf_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  score_elf_scom_section.output_section = &score_elf_scom_section;\n \t  score_elf_scom_section.symbol = &score_elf_scom_symbol;\n \t  score_elf_scom_section.symbol_ptr_ptr = &score_elf_scom_symbol_ptr;"
    },
    {
      "sha": "c9746905b230f12c2c45ba35e7c23f8a91df0cd4",
      "filename": "bfd/elf32-score7.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-score7.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-score7.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-score7.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -2840,7 +2840,7 @@ s7_bfd_score_elf_symbol_processing (bfd *abfd, asymbol *asym)\n \t{\n \t  /* Initialize the small common section.  */\n \t  score_elf_scom_section.name = \".scommon\";\n-\t  score_elf_scom_section.flags = SEC_IS_COMMON;\n+\t  score_elf_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  score_elf_scom_section.output_section = &score_elf_scom_section;\n \t  score_elf_scom_section.symbol = &score_elf_scom_symbol;\n \t  score_elf_scom_section.symbol_ptr_ptr = &score_elf_scom_symbol_ptr;"
    },
    {
      "sha": "a37ae293175c8532cc014ff12ee40217852c2ba2",
      "filename": "bfd/elf32-tic6x.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-tic6x.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-tic6x.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-tic6x.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -2974,7 +2974,7 @@ elf32_tic6x_symbol_processing (bfd *abfd ATTRIBUTE_UNUSED, asymbol *asym)\n \t{\n \t  /* Initialize the small common section.  */\n \t  tic6x_elf_scom_section.name = \".scommon\";\n-\t  tic6x_elf_scom_section.flags = SEC_IS_COMMON;\n+\t  tic6x_elf_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  tic6x_elf_scom_section.output_section = &tic6x_elf_scom_section;\n \t  tic6x_elf_scom_section.symbol = &tic6x_elf_scom_symbol;\n \t  tic6x_elf_scom_section.symbol_ptr_ptr = &tic6x_elf_scom_symbol_ptr;"
    },
    {
      "sha": "c1e959e6c2d2b58a0ddd304f7d64a41131789f69",
      "filename": "bfd/elf32-v850.c",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-v850.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elf32-v850.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elf32-v850.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -3001,7 +3001,8 @@ v850_elf_symbol_processing (bfd *abfd, asymbol *asym)\n \t{\n \t  /* Initialize the small common section.  */\n \t  v850_elf_scom_section.name\t       = \".scommon\";\n-\t  v850_elf_scom_section.flags\t       = SEC_IS_COMMON | SEC_ALLOC | SEC_DATA;\n+\t  v850_elf_scom_section.flags\n+\t    = SEC_IS_COMMON | SEC_SMALL_DATA | SEC_ALLOC | SEC_DATA;\n \t  v850_elf_scom_section.output_section = & v850_elf_scom_section;\n \t  v850_elf_scom_section.symbol\t       = & v850_elf_scom_symbol;\n \t  v850_elf_scom_section.symbol_ptr_ptr = & v850_elf_scom_symbol_ptr;\n@@ -3019,7 +3020,7 @@ v850_elf_symbol_processing (bfd *abfd, asymbol *asym)\n \t{\n \t  /* Initialize the tcommon section.  */\n \t  v850_elf_tcom_section.name\t       = \".tcommon\";\n-\t  v850_elf_tcom_section.flags\t       = SEC_IS_COMMON;\n+\t  v850_elf_tcom_section.flags\t       = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  v850_elf_tcom_section.output_section = & v850_elf_tcom_section;\n \t  v850_elf_tcom_section.symbol\t       = & v850_elf_tcom_symbol;\n \t  v850_elf_tcom_section.symbol_ptr_ptr = & v850_elf_tcom_symbol_ptr;\n@@ -3037,7 +3038,7 @@ v850_elf_symbol_processing (bfd *abfd, asymbol *asym)\n \t{\n \t  /* Initialize the zcommon section.  */\n \t  v850_elf_zcom_section.name\t       = \".zcommon\";\n-\t  v850_elf_zcom_section.flags\t       = SEC_IS_COMMON;\n+\t  v850_elf_zcom_section.flags\t       = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  v850_elf_zcom_section.output_section = & v850_elf_zcom_section;\n \t  v850_elf_zcom_section.symbol\t       = & v850_elf_zcom_symbol;\n \t  v850_elf_zcom_section.symbol_ptr_ptr = & v850_elf_zcom_symbol_ptr;"
    },
    {
      "sha": "5b985a493d84239b7d69ca582f5db450cb1ca728",
      "filename": "bfd/elfxx-mips.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elfxx-mips.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/elfxx-mips.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elfxx-mips.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -7113,7 +7113,7 @@ _bfd_mips_elf_symbol_processing (bfd *abfd, asymbol *asym)\n \t{\n \t  /* Initialize the small common section.  */\n \t  mips_elf_scom_section.name = \".scommon\";\n-\t  mips_elf_scom_section.flags = SEC_IS_COMMON;\n+\t  mips_elf_scom_section.flags = SEC_IS_COMMON | SEC_SMALL_DATA;\n \t  mips_elf_scom_section.output_section = &mips_elf_scom_section;\n \t  mips_elf_scom_section.symbol = &mips_elf_scom_symbol;\n \t  mips_elf_scom_section.symbol_ptr_ptr = &mips_elf_scom_symbol_ptr;"
    },
    {
      "sha": "cb25af17fa1da372a2b46c154e5d201e01fda8be",
      "filename": "bfd/syms.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/syms.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4d1823674eedf267c7cafac2b923256db0b10ac8/bfd/syms.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/syms.c?ref=4d1823674eedf267c7cafac2b923256db0b10ac8",
      "patch": "@@ -653,10 +653,10 @@ bfd_decode_symclass (asymbol *symbol)\n \n   if (symbol->section && bfd_is_com_section (symbol->section))\n     {\n-      if (symbol->section == bfd_com_section_ptr)\n-\treturn 'C';\n-      else\n+      if (symbol->section->flags & SEC_SMALL_DATA)\n \treturn 'c';\n+      else\n+\treturn 'C';\n     }\n   if (bfd_is_und_section (symbol->section))\n     {"
    }
  ]
}