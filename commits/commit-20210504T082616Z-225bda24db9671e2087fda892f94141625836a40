{
  "sha": "225bda24db9671e2087fda892f94141625836a40",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjI1YmRhMjRkYjk2NzFlMjA4N2ZkYTg5MmY5NDE0MTYyNTgzNmE0MA==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-05-04T08:26:16Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-05-04T08:26:16Z"
    },
    "message": "[gdb/guile] Don't allow libguile to change libgmp mem fns\n\nSince gdb commit 880ae75a2b7 \"gdb delay guile initialization until\ngdbscm_finish_initialization\" I'm running into:\n...\n(gdb) print My_Var > 10.0^M\nfree(): invalid pointer^M\nERROR: GDB process no longer exists\nGDB process exited with wait status 5995 exp9 0 0 CHILDKILLED SIGABRT SIGABRT\nUNRESOLVED: gdb.ada/fixed_cmp.exp: gnat_encodings=all: print My_Var > 10.0\n...\n\nThe problem is that both gdb and libguile try to set the libgmp memory functions,\nand since the gdb commit the ones from libguile are effective, which results\nin gdb freeing some memory in a way that is not compatible with the way that\nmemory was actually allocated.\n\nThe fact that libguile tries to set the libgmp memory functions is a bug which\nshould be fixed starting version v3.0.6.\n\nMeanwhile, work around this in gdb by not allowing libguile to set the libgomp\nmemory functions.\n\nTested on x86_64-linux.\n\ngdb/ChangeLog:\n\n2021-05-04  Tom de Vries  <tdevries@suse.de>\n\n\tPR guile/27806\n\t* guile/guile.c\t(gdbscm_initialize): Don't let guile change libgmp\n\tmemory functions.",
    "tree": {
      "sha": "e260ed095456050e49153baf5aac58ef6c79111e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/e260ed095456050e49153baf5aac58ef6c79111e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/225bda24db9671e2087fda892f94141625836a40",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/225bda24db9671e2087fda892f94141625836a40",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/225bda24db9671e2087fda892f94141625836a40",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/225bda24db9671e2087fda892f94141625836a40/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ae0373ce077724b52ceab6e095cc6509a7eea48f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ae0373ce077724b52ceab6e095cc6509a7eea48f",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ae0373ce077724b52ceab6e095cc6509a7eea48f"
    }
  ],
  "stats": {
    "total": 22,
    "additions": 22,
    "deletions": 0
  },
  "files": [
    {
      "sha": "674817cc1b6443c6c84ff800be686a1e71ac4db4",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/225bda24db9671e2087fda892f94141625836a40/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/225bda24db9671e2087fda892f94141625836a40/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=225bda24db9671e2087fda892f94141625836a40",
      "patch": "@@ -1,3 +1,9 @@\n+2021-05-04  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR guile/27806\n+\t* guile/guile.c\t(gdbscm_initialize): Don't let guile change libgmp\n+\tmemory functions.\n+\n 2021-04-30  Tom Tromey  <tom@tromey.com>\n \n \t* dwarf2/read.c (dwarf2_initialize_objfile): Update."
    },
    {
      "sha": "c6959f5b713166efd049c7a2be6134bb0931f637",
      "filename": "gdb/guile/guile.c",
      "status": "modified",
      "additions": 16,
      "deletions": 0,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/225bda24db9671e2087fda892f94141625836a40/gdb/guile/guile.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/225bda24db9671e2087fda892f94141625836a40/gdb/guile/guile.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/guile/guile.c?ref=225bda24db9671e2087fda892f94141625836a40",
      "patch": "@@ -662,6 +662,22 @@ gdbscm_initialize (const struct extension_language_defn *extlang)\n   {\n     gdb::block_signals blocker;\n \n+    /* There are libguile versions (f.i. v3.0.5) that by default call\n+       mp_get_memory_functions during initialization to install custom\n+       libgmp memory functions.  This is considered a bug and should be\n+       fixed starting v3.0.6.\n+       Before gdb commit 880ae75a2b7 \"gdb delay guile initialization until\n+       gdbscm_finish_initialization\", that bug had no effect for gdb,\n+       because gdb subsequently called mp_get_memory_functions to install\n+       its own custom functions in _initialize_gmp_utils.  However, since\n+       aforementioned gdb commit the initialization order is reversed,\n+       allowing libguile to install a custom malloc that is incompatible\n+       with the custom free as used in gmp-utils.c, resulting in a\n+       \"double free or corruption (out)\" error.\n+       Work around the libguile bug by disabling the installation of the\n+       libgmp memory functions by guile initialization.  */\n+    scm_install_gmp_memory_functions = 0;\n+\n     /* scm_with_guile is the most portable way to initialize Guile.  Plus\n        we need to initialize the Guile support while in Guile mode (e.g.,\n        called from within a call to scm_with_guile).  */"
    }
  ]
}