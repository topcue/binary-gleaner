{
  "sha": "4993045d18d69ecee41ca341cde6bbed220dc8a4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDk5MzA0NWQxOGQ2OWVjZWU0MWNhMzQxY2RlNmJiZWQyMjBkYzhhNA==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-06-08T17:47:51Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-09-12T19:57:10Z"
    },
    "message": "Output the Ada task name in more messages.\n\nWith this patch, we e.g. get:\n      [Switching to task 2 \"task_list(1)\"]\n      [Current task is 2 \"task_list(1)\"]\n    instead of\n      [Switching to task 2]\n      [Current task is 2]\n\nThe logic to produce the taskno optionally followed\nby the task name has been factorized in the task_to_str function.\n\nTask names are output between double quotes in the new messages,\nsimilarly to what GDB does for thread names.\nHowever, no quotes are put around task names in 'info tasks' Name column.\nThis was discussed with Tom, that preferred no quotes there, while I\nwas more in favour of visual consistency.\nI discussed with a few more users, which led to (exactly) 50% preferring\nquotes and 50% preferring no quotes :).\nTo arrive to the decision to remove the quotes, the following \"killing args\"\nwere used:\n * To have quotes or to not have quotes, that is the question; yes\n   but not *THE* question :).\n * If there is not a clear majority that prefers quotes, better to\n   not disturb the existing user basis for a (somewhat) irrelevant\n   aspect.\n * The opinion of the reviewer has more weight.\n\nSo, compared to the previous version, this version remotes the quotes\nin 'info tasks'.\n\nIt improves the alignement of 'info tasks' output.\nWith this patch, we get:\n      (gdb) info task\n         ID           TID P-ID Pri State                  Name\n      *   1  555555759030       48 Runnable               main_task\n          2  555555759e30    1  48 Selective Wait         mit\n      (gdb)\n   instead of\n      (gdb) info task\n         ID       TID P-ID Pri State                  Name\n      *   1 555555759030       48 Runnable               main_task\n          2 555555759e30    1  48 Selective Wait         mit\n      (gdb)\n(e.g. the first one properly shows parent and priority under the\ncorrect header).\n\nThis is version 4 of the 'task name' patch.\nCompared to version 3, the changes are:\n   output task names between quotes but not in 'info tasks'\n\ngdb/ChangeLog\n2019-09-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* NEWS: Announce that Ada task names are now shown at more places,\n\tand between quotes (except in info task output).\n\t* gdb/ada-tasks.c (task_to_str): New function.\n\t(display_current_task_id): Call task_to_str.\n\t(task_command_1): Likewise.\n\t(print_ada_task_info): In non-mi mode, Properly align headers and data\n\twhen task-id length is > 9 (9 is the default for a 32 bits CORE_ADDR).\n\ngdb/doc/ChangeLog\n2019-09-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* gdb.texinfo (Ada Tasks): Tell the task name is printed, update\n\texamples.\n\ngdb/testsuite/ChangeLog\n2019-09-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* gdb.ada/rdv_wait.exp: Update to new task names.\n\t* gdb.base/task_switch_in_core.exp: Likewise.\n\t* gdb.base/info_sources_base.c: Likewise.",
    "tree": {
      "sha": "45c461f5ed3751b96e92d99064128f57ca3d76c6",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/45c461f5ed3751b96e92d99064128f57ca3d76c6"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4993045d18d69ecee41ca341cde6bbed220dc8a4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4993045d18d69ecee41ca341cde6bbed220dc8a4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4993045d18d69ecee41ca341cde6bbed220dc8a4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4993045d18d69ecee41ca341cde6bbed220dc8a4/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "0d41d9a2aa059e89d46e549d7d3a367a35a4b739",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/0d41d9a2aa059e89d46e549d7d3a367a35a4b739",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/0d41d9a2aa059e89d46e549d7d3a367a35a4b739"
    }
  ],
  "stats": {
    "total": 108,
    "additions": 87,
    "deletions": 21
  },
  "files": [
    {
      "sha": "986a701c2fa7f864999945f72ebb2aa95d93b9ba",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -1,3 +1,13 @@\n+2019-09-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* NEWS: Announce that Ada task names are now shown at more places,\n+\tand between quotes (except in info task output).\n+\t* gdb/ada-tasks.c (task_to_str): New function.\n+\t(display_current_task_id): Call task_to_str.\n+\t(task_command_1): Likewise.\n+\t(print_ada_task_info): In non-mi mode, Properly align headers and data\n+\twhen task-id length is > 9 (9 is the default for a 32 bits CORE_ADDR).\n+\n 2019-09-12  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n \n \t* procfs.c (procfs_target::wait) <PR_FAULTED>: Get signal from"
    },
    {
      "sha": "d502f08984cd06ed6197d8e21c0aebd369aa6e1d",
      "filename": "gdb/NEWS",
      "status": "modified",
      "additions": 3,
      "deletions": 0,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/NEWS",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/NEWS",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/NEWS?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -29,6 +29,9 @@\n \n * The RX port now supports XML target descriptions.\n \n+* GDB now shows the Ada task names at more places, e.g. in task switching\n+  messages.\n+\n * Python API\n \n   ** The gdb.Value type has a new method 'format_string' which returns a"
    },
    {
      "sha": "34da786eb7cd8374aef778e1c7ed39a79af282de",
      "filename": "gdb/ada-tasks.c",
      "status": "modified",
      "additions": 54,
      "deletions": 12,
      "changes": 66,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/ada-tasks.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/ada-tasks.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ada-tasks.c?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -240,6 +240,18 @@ struct ada_tasks_inferior_data\n static const struct inferior_key<ada_tasks_inferior_data>\n   ada_tasks_inferior_data_handle;\n \n+/* Return a string with TASKNO followed by the task name if TASK_INFO\n+   contains a name.  */\n+\n+static std::string\n+task_to_str (int taskno, const ada_task_info *task_info)\n+{\n+  if (task_info->name[0] == '\\0')\n+    return string_printf (\"%d\", taskno);\n+  else\n+    return string_printf (\"%d \\\"%s\\\"\", taskno, task_info->name);\n+}\n+\n /* Return the ada-tasks module's data for the given program space (PSPACE).\n    If none is found, add a zero'ed one now.\n \n@@ -1047,7 +1059,26 @@ print_ada_task_info (struct ui_out *uiout,\n   ui_out_emit_table table_emitter (uiout, nb_columns, nb_tasks, \"tasks\");\n   uiout->table_header (1, ui_left, \"current\", \"\");\n   uiout->table_header (3, ui_right, \"id\", \"ID\");\n-  uiout->table_header (9, ui_right, \"task-id\", \"TID\");\n+  {\n+    size_t tid_width = 9;\n+    /* Grown below in case the largest entry is bigger.  */\n+\n+    if (!uiout->is_mi_like_p ())\n+      {\n+\tfor (taskno = 1; taskno <= data->task_list.size (); taskno++)\n+\t  {\n+\t    const struct ada_task_info *const task_info\n+\t      = &data->task_list[taskno - 1];\n+\n+\t    gdb_assert (task_info != NULL);\n+\n+\t    tid_width = std::max (tid_width,\n+\t\t\t\t  1 + strlen (phex_nz (task_info->task_id,\n+\t\t\t\t\t\t       sizeof (CORE_ADDR))));\n+\t  }\n+      }\n+    uiout->table_header (tid_width, ui_right, \"task-id\", \"TID\");\n+  }\n   /* The following column is provided in GDB/MI mode only because\n      it is only really useful in that mode, and also because it\n      allows us to keep the CLI output shorter and more compact.  */\n@@ -1129,10 +1160,12 @@ print_ada_task_info (struct ui_out *uiout,\n       else\n \tuiout->field_string (\"state\", task_states[task_info->state]);\n \n-      /* Finally, print the task name.  */\n+      /* Finally, print the task name, without quotes around it, as mi like\n+\t is not expecting quotes, and in non mi-like no need for quotes\n+         as there is a specific column for the name.  */\n       uiout->field_string (\"name\",\n-\t\t\t   task_info->name[0] != '\\0' ? task_info->name\n-\t\t\t   : _(\"<no name>\"));\n+                          task_info->name[0] != '\\0' ? task_info->name\n+                          : _(\"<no name>\"));\n \n       uiout->text (\"\\n\");\n     }\n@@ -1166,7 +1199,7 @@ info_task (struct ui_out *uiout, const char *taskno_str, struct inferior *inf)\n \n   /* Print the name of the task.  */\n   if (task_info->name[0] != '\\0')\n-    printf_filtered (_(\"Name: %s\\n\"), task_info->name);\n+    printf_filtered (_(\"Name: \\\"%s\\\"\\n\"), task_info->name);\n   else\n     printf_filtered (_(\"<no name>\\n\"));\n \n@@ -1187,7 +1220,7 @@ info_task (struct ui_out *uiout, const char *taskno_str, struct inferior *inf)\n \n       printf_filtered (_(\"Parent: %d\"), parent_taskno);\n       if (parent->name[0] != '\\0')\n-        printf_filtered (\" (%s)\", parent->name);\n+        printf_filtered (\" (\\\"%s\\\")\", parent->name);\n       printf_filtered (\"\\n\");\n     }\n   else\n@@ -1220,7 +1253,7 @@ info_task (struct ui_out *uiout, const char *taskno_str, struct inferior *inf)\n         ada_task_info *target_task_info = &data->task_list[target_taskno - 1];\n \n         if (target_task_info->name[0] != '\\0')\n-          printf_filtered (\" (%s)\", target_task_info->name);\n+          printf_filtered (\" (\\\"%s\\\")\", target_task_info->name);\n       }\n \n     printf_filtered (\"\\n\");\n@@ -1255,7 +1288,14 @@ display_current_task_id (void)\n   if (current_task == 0)\n     printf_filtered (_(\"[Current task is unknown]\\n\"));\n   else\n-    printf_filtered (_(\"[Current task is %d]\\n\"), current_task);\n+    {\n+      struct ada_tasks_inferior_data *data\n+\t= get_ada_tasks_inferior_data (current_inferior ());\n+      struct ada_task_info *task_info = &data->task_list[current_task - 1];\n+\n+      printf_filtered (_(\"[Current task is %s]\\n\"),\n+\t\t       task_to_str (current_task, task_info).c_str ());\n+    }\n }\n \n /* Parse and evaluate TIDSTR into a task id, and try to switch to\n@@ -1274,7 +1314,8 @@ task_command_1 (const char *taskno_str, int from_tty, struct inferior *inf)\n   task_info = &data->task_list[taskno - 1];\n \n   if (!ada_task_is_alive (task_info))\n-    error (_(\"Cannot switch to task %d: Task is no longer running\"), taskno);\n+    error (_(\"Cannot switch to task %s: Task is no longer running\"),\n+\t   task_to_str (taskno, task_info).c_str ());\n    \n   /* On some platforms, the thread list is not updated until the user\n      performs a thread-related operation (by using the \"info threads\"\n@@ -1295,13 +1336,14 @@ task_command_1 (const char *taskno_str, int from_tty, struct inferior *inf)\n      it's nicer for the user to just refuse to perform the task switch.  */\n   thread_info *tp = find_thread_ptid (task_info->ptid);\n   if (tp == NULL)\n-    error (_(\"Unable to compute thread ID for task %d.\\n\"\n+    error (_(\"Unable to compute thread ID for task %s.\\n\"\n              \"Cannot switch to this task.\"),\n-           taskno);\n+           task_to_str (taskno, task_info).c_str ());\n \n   switch_to_thread (tp);\n   ada_find_printable_frame (get_selected_frame (NULL));\n-  printf_filtered (_(\"[Switching to task %d]\\n\"), taskno);\n+  printf_filtered (_(\"[Switching to task %s]\\n\"),\n+\t\t   task_to_str (taskno, task_info).c_str ());\n   print_stack_frame (get_selected_frame (NULL),\n                      frame_relative_level (get_selected_frame (NULL)),\n \t\t     SRC_AND_LOC, 1);"
    },
    {
      "sha": "4705fbc54103e586858b197b539bae2e33f19cae",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -1,3 +1,8 @@\n+2019-09-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* gdb.texinfo (Ada Tasks): Tell the task name is printed, update\n+\texamples.\n+\n 2019-09-10  Tom Tromey  <tromey@adacore.com>\n \n \t* gdb.texinfo (Index Files): Update Ada text."
    },
    {
      "sha": "eee0c9d4dd79666f288f6cc796f5b5ee4d27df47",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 7,
      "deletions": 7,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -17751,18 +17751,18 @@ the following example:\n *  2   807c468    1  15 Runnable               task_1\n (@value{GDBP}) info task 2\n Ada Task: 0x807c468\n-Name: task_1\n+Name: \"task_1\"\n Thread: 0\n LWP: 0x1fac\n-Parent: 1 (main_task)\n+Parent: 1 (\"main_task\")\n Base Priority: 15\n State: Runnable\n @end smallexample\n \n @item task\n @kindex task@r{ (Ada)}\n @cindex current Ada task ID\n-This command prints the ID of the current task.\n+This command prints the ID and name of the current task.\n \n @smallexample\n @iftex\n@@ -17771,9 +17771,9 @@ This command prints the ID of the current task.\n (@value{GDBP}) info tasks\n   ID       TID P-ID Pri State                  Name\n    1   8077870    0  15 Child Activation Wait  main_task\n-*  2   807c458    1  15 Runnable               t\n+*  2   807c458    1  15 Runnable               some_task\n (@value{GDBP}) task\n-[Current task is 2]\n+[Current task is 2 \"some_task\"]\n @end smallexample\n \n @item task @var{taskno}\n@@ -17789,9 +17789,9 @@ from the current task to the given task.\n (@value{GDBP}) info tasks\n   ID       TID P-ID Pri State                  Name\n    1   8077870    0  15 Child Activation Wait  main_task\n-*  2   807c458    1  15 Runnable               t\n+*  2   807c458    1  15 Runnable               some_task\n (@value{GDBP}) task 1\n-[Switching to task 1]\n+[Switching to task 1 \"main_task\"]\n #0  0x8067726 in pthread_cond_wait ()\n (@value{GDBP}) bt\n #0  0x8067726 in pthread_cond_wait ()"
    },
    {
      "sha": "bf3fcc7d844bc34d4d403125f5926e665fb5fa89",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -1,3 +1,9 @@\n+2019-09-12  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* gdb.ada/rdv_wait.exp: Update to new task names.\n+\t* gdb.base/task_switch_in_core.exp: Likewise.\n+\t* gdb.base/info_sources_base.c: Likewise.\n+\n 2019-09-10  Tom Tromey  <tromey@adacore.com>\n \n \t* boards/cc-with-tweaks.exp: Set GNATMAKE_FOR_TARGET."
    },
    {
      "sha": "fe6aec3bcda34bf5a14cb5c71c904ec21c5a3d19",
      "filename": "gdb/testsuite/gdb.ada/rdv_wait.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/testsuite/gdb.ada/rdv_wait.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/testsuite/gdb.ada/rdv_wait.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/rdv_wait.exp?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -31,5 +31,5 @@ runto \"break_me\"\n # Switch to task 2, and verify that GDB is able to unwind all the way\n # to foo.T.\n gdb_test \"task 2\" \\\n-         [join {\"\\\\\\[Switching to task 2\\\\\\].*\" \\\n+         [join {\"\\\\\\[Switching to task 2 \\\"mit\\\"\\\\\\].*\" \\\n                 \".*foo\\\\.t \\\\(.*\\\\).*foo\\\\.adb:.*\"} \"\"]"
    },
    {
      "sha": "fb9aef284096dfb372fbbd881afc48dc5f9f351f",
      "filename": "gdb/testsuite/gdb.ada/task_switch_in_core.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/testsuite/gdb.ada/task_switch_in_core.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4993045d18d69ecee41ca341cde6bbed220dc8a4/gdb/testsuite/gdb.ada/task_switch_in_core.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/task_switch_in_core.exp?ref=4993045d18d69ecee41ca341cde6bbed220dc8a4",
      "patch": "@@ -71,7 +71,7 @@ gdb_test \"info tasks\" \\\n # we will verify right after with an additional test that the current\n # task is now task 2.\n gdb_test \"task 2\" \\\n-         \"\\\\\\[Switching to task 2\\\\\\].*\"\n+         \"\\\\\\[Switching to task 2 \\\"my_t\\\"\\\\\\].*\"\n \n gdb_test \"info tasks\" \\\n          [multi_line \"\\\\s+ID\\\\s+TID\\\\s+P-ID\\\\s+Pri\\\\s+State\\\\s+Name\" \\"
    }
  ]
}