{
  "sha": "cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2MwZjk2MzU3ZTBiNWJjZTRhMWYwMjkxMGNlYzJkZDY2ZTg5OTBjNQ==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-06-15T05:57:11Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2021-06-15T05:57:11Z"
    },
    "message": "x86: permit parenthesized expressions again as addressing scale factor\n\nThe description of e68c3d59acd0 (\"x86: better respect quotes in\nparse_operands()\") wrongly states:\n\n\"In i386_att_operand(), which needs adjustment to remain in sync, besides\n respecting double quotes now, also change the logic such that we don't\n count parentheses anymore: Finding any opening or closing parenthesis or\n any double quote means we're done, because the subsequent parsing code\n wouldn't accept (extra) instances of these anyway.\"\n\nI didn't pay attention to the possibility of the scale factor being\nspecified as an expression, which may contain parentheses. Thanks to\nMartin for pointing this out. Restore prior behavior or matching\nparentheses (backwards), while giving the variable a more suitable name.\nNote that this simple and immediate fix is not ging to be enough: This\nexpression could itself involve quoted symbols. However, to address this\nbackwards parsing needs to be done away with altogether here (such that\nparentheses which are part of such a quoted symbol name can also\nproperly be accounted for), which is going to be a more intrusive\nchange.",
    "tree": {
      "sha": "5acb7dbf985bd464e6c24e64ab02a49fd4fb4780",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5acb7dbf985bd464e6c24e64ab02a49fd4fb4780"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "93df3340fd5ad32f784214fc125de71811da72ff",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/93df3340fd5ad32f784214fc125de71811da72ff",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/93df3340fd5ad32f784214fc125de71811da72ff"
    }
  ],
  "stats": {
    "total": 28,
    "additions": 26,
    "deletions": 2
  },
  "files": [
    {
      "sha": "d766fd1a28c79ef23692b8007d4fc8b3298f4bd0",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
      "patch": "@@ -1,3 +1,11 @@\n+2021-06-15  Jan Beulich  <jbeulich@suse.com>\n+\n+\t* config/tc-i386.c (i386_att_operand): Re-introduce (now\n+\tproperly named) parens_not_balanced.\n+\t* testsuite/gas/i386/sib.s: Add more cases.\n+\t* testsuite/gas/i386/sib.d, testsuite/gas/i386/sib-intel.d:\n+\tAdjust expectations.\n+\n 2021-06-14  Jan Beulich  <jbeulich@suse.com>\n \n \t* read.c (emit_expr_with_reloc): Fold three as_warn()."
    },
    {
      "sha": "858538055116b0c33d3edf235a18b7ba3ccbfc5a",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 6,
      "deletions": 2,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
      "patch": "@@ -11566,15 +11566,19 @@ i386_att_operand (char *operand_string)\n       if (*base_string == ')')\n \t{\n \t  char *temp_string;\n+\t  unsigned int parens_not_balanced = 1;\n \n \t  /* We've already checked that the number of left & right ()'s are\n \t     equal, so this loop will not be infinite.  */\n \t  do\n \t    {\n \t      base_string--;\n+\t      if (*base_string == ')')\n+\t\tparens_not_balanced++;\n+\t      if (*base_string == '(')\n+\t\tparens_not_balanced--;\n \t    }\n-\t  while (*base_string != '(' && *base_string != ')'\n-\t\t && *base_string != '\"');\n+\t  while (parens_not_balanced && *base_string != '\"');\n \n \t  temp_string = base_string;\n "
    },
    {
      "sha": "ccd2ea9643e517c9231114f322361efc9764b8c3",
      "filename": "gas/testsuite/gas/i386/sib-intel.d",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/testsuite/gas/i386/sib-intel.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/testsuite/gas/i386/sib-intel.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/sib-intel.d?ref=cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
      "patch": "@@ -30,6 +30,10 @@ Disassembly of section .text:\n [ \t]*[a-f0-9]+:\t8b 04 64             \tmov    eax,DWORD PTR \\[esp\\+eiz\\*2\\]\n [ \t]*[a-f0-9]+:\t8b 04 a4             \tmov    eax,DWORD PTR \\[esp\\+eiz\\*4\\]\n [ \t]*[a-f0-9]+:\t8b 04 e4             \tmov    eax,DWORD PTR \\[esp\\+eiz\\*8\\]\n+[ \t]*[a-f0-9]+:\t8b 04 00             \tmov    eax,DWORD PTR \\[eax\\+eax\\*1\\]\n+[ \t]*[a-f0-9]+:\t8b 04 40             \tmov    eax,DWORD PTR \\[eax\\+eax\\*2\\]\n+[ \t]*[a-f0-9]+:\t8b 04 80             \tmov    eax,DWORD PTR \\[eax\\+eax\\*4\\]\n+[ \t]*[a-f0-9]+:\t8b 04 c0             \tmov    eax,DWORD PTR \\[eax\\+eax\\*8\\]\n [ \t]*[a-f0-9]+:\t8b 04 25 e2 ff ff ff \tmov    eax,DWORD PTR \\[eiz\\*1-0x1e\\]\n [ \t]*[a-f0-9]+:\t8b 04 65 e2 ff ff ff \tmov    eax,DWORD PTR \\[eiz\\*2-0x1e\\]\n [ \t]*[a-f0-9]+:\t8b 04 a5 e2 ff ff ff \tmov    eax,DWORD PTR \\[eiz\\*4-0x1e\\]"
    },
    {
      "sha": "151935c62ec166d44f5d8d5d1e0696c815a54b25",
      "filename": "gas/testsuite/gas/i386/sib.d",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/testsuite/gas/i386/sib.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/testsuite/gas/i386/sib.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/sib.d?ref=cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
      "patch": "@@ -29,6 +29,10 @@ Disassembly of section .text:\n [ \t]*[a-f0-9]+:\t8b 04 64             \tmov    \\(%esp,%eiz,2\\),%eax\n [ \t]*[a-f0-9]+:\t8b 04 a4             \tmov    \\(%esp,%eiz,4\\),%eax\n [ \t]*[a-f0-9]+:\t8b 04 e4             \tmov    \\(%esp,%eiz,8\\),%eax\n+[ \t]*[a-f0-9]+:\t8b 04 00             \tmov    \\(%eax,%eax,1\\),%eax\n+[ \t]*[a-f0-9]+:\t8b 04 40             \tmov    \\(%eax,%eax,2\\),%eax\n+[ \t]*[a-f0-9]+:\t8b 04 80             \tmov    \\(%eax,%eax,4\\),%eax\n+[ \t]*[a-f0-9]+:\t8b 04 c0             \tmov    \\(%eax,%eax,8\\),%eax\n [ \t]*[a-f0-9]+:\t8b 04 25 e2 ff ff ff \tmov    -0x1e\\(,%eiz,1\\),%eax\n [ \t]*[a-f0-9]+:\t8b 04 65 e2 ff ff ff \tmov    -0x1e\\(,%eiz,2\\),%eax\n [ \t]*[a-f0-9]+:\t8b 04 a5 e2 ff ff ff \tmov    -0x1e\\(,%eiz,4\\),%eax"
    },
    {
      "sha": "c0e007f3108ebf8b8dc876c3dc4695398fac746b",
      "filename": "gas/testsuite/gas/i386/sib.s",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/testsuite/gas/i386/sib.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cc0f96357e0b5bce4a1f02910cec2dd66e8990c5/gas/testsuite/gas/i386/sib.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/sib.s?ref=cc0f96357e0b5bce4a1f02910cec2dd66e8990c5",
      "patch": "@@ -26,6 +26,10 @@ foo:\n \tmov\t(%esp,%eiz,2),%eax\n \tmov\t(%esp,%eiz,4),%eax\n \tmov\t(%esp,%eiz,8),%eax\n+\tmov\t(%eax, %eax, (1 << 0)), %eax\n+\tmov\t(%eax, %eax, (1 << 1)), %eax\n+\tmov\t(%eax, %eax, (1 << 2)), %eax\n+\tmov\t(%eax, %eax, (1 << 3)), %eax\n \t.intel_syntax noprefix\n         mov    eax,DWORD PTR [eiz*1-30]\n         mov    eax,DWORD PTR [eiz*2-30]"
    }
  ]
}