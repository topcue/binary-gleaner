{
  "sha": "2a3ad588e0758bc2c753dfa216c344036e5a22bc",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MmEzYWQ1ODhlMDc1OGJjMmM3NTNkZmEyMTZjMzQ0MDM2ZTVhMjJiYw==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-08-01T08:48:11Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-08-01T08:48:11Z"
    },
    "message": "[gdb/testsuite] Fix gdb.base/structs.exp timeout with check-read1\n\nWith gdb.base/structs.exp and check-read1 we get:\n...\nFAIL: gdb.base/structs.exp: p chartest (timeout)\n...\n\nFix this by using gdb_test_sequence.\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2019-08-01  Tom de Vries  <tdevries@suse.de>\n\n\tPR testsuite/24863\n\t* gdb.base/structs.exp: Fix check-read1 timeout using\n\tgdb_test_sequence.\n\t* lib/gdb.exp (tcl_version_at_least, lrepeat): New proc.",
    "tree": {
      "sha": "52ee93595102ac3ce0ce201802f1cb5d61773e1d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/52ee93595102ac3ce0ce201802f1cb5d61773e1d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/2a3ad588e0758bc2c753dfa216c344036e5a22bc",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2a3ad588e0758bc2c753dfa216c344036e5a22bc",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/2a3ad588e0758bc2c753dfa216c344036e5a22bc",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2a3ad588e0758bc2c753dfa216c344036e5a22bc/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "117eb594228cf5447e49475e4fb33480c1f717a7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/117eb594228cf5447e49475e4fb33480c1f717a7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/117eb594228cf5447e49475e4fb33480c1f717a7"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 44,
    "deletions": 1
  },
  "files": [
    {
      "sha": "09921e0296837271aad83e8733d595d4aad91514",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2a3ad588e0758bc2c753dfa216c344036e5a22bc/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2a3ad588e0758bc2c753dfa216c344036e5a22bc/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=2a3ad588e0758bc2c753dfa216c344036e5a22bc",
      "patch": "@@ -1,3 +1,10 @@\n+2019-08-01  Tom de Vries  <tdevries@suse.de>\n+\n+\tPR testsuite/24863\n+\t* gdb.base/structs.exp: Fix check-read1 timeout using\n+\tgdb_test_sequence.\n+\t* lib/gdb.exp (tcl_version_at_least, lrepeat): New proc.\n+\n 2019-08-01  Tom de Vries  <tdevries@suse.de>\n \n \tPR testsuite/24863"
    },
    {
      "sha": "0e9b8d2e02c81f8cbc491b4622400303c28120e7",
      "filename": "gdb/testsuite/gdb.base/structs.exp",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2a3ad588e0758bc2c753dfa216c344036e5a22bc/gdb/testsuite/gdb.base/structs.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2a3ad588e0758bc2c753dfa216c344036e5a22bc/gdb/testsuite/gdb.base/structs.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/structs.exp?ref=2a3ad588e0758bc2c753dfa216c344036e5a22bc",
      "patch": "@@ -102,7 +102,11 @@ proc start_structs_test { types } {\n \t# Verify $anychar_re can match all the values of `char' type.\n \tgdb_breakpoint [gdb_get_line_number \"chartest-done\"]\n \tgdb_continue_to_breakpoint \"chartest-done\" \".*chartest-done.*\"\n-\tgdb_test \"p chartest\" \"= {({c = ${anychar_re}}, ){255}{c = ${anychar_re}}}\"\n+\tgdb_test_sequence \"p chartest\" \"\" \\\n+\t    [concat \\\n+\t\t [list \"= \\{\"] \\\n+\t\t [lrepeat 255 \"^\\{c = ${anychar_re}\\}, \"] \\\n+\t\t [list \"^\\{c = ${anychar_re}\\}\\}\"]]\n     }\n \n     # check that at the struct containing all the relevant types is correct"
    },
    {
      "sha": "9ca34d8b153f448250bb1de33c56572e27050716",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 32,
      "deletions": 0,
      "changes": 32,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/2a3ad588e0758bc2c753dfa216c344036e5a22bc/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/2a3ad588e0758bc2c753dfa216c344036e5a22bc/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=2a3ad588e0758bc2c753dfa216c344036e5a22bc",
      "patch": "@@ -1103,6 +1103,38 @@ proc gdb_test { args } {\n      }]\n }\n \n+# Return 1 if tcl version used is at least MAJOR.MINOR\n+proc tcl_version_at_least { major minor } {\n+    global tcl_version\n+    regexp {^([0-9]+)\\.([0-9]+)$} $tcl_version \\\n+\tdummy tcl_version_major tcl_version_minor\n+    if { $tcl_version_major > $major } {\n+        return 1\n+    } elseif { $tcl_version_major == $major \\\n+\t\t   && $tcl_version_major >= $minor } {\n+        return 1\n+    } else {\n+        return 0\n+    }\n+}\n+\n+if { [tcl_version_at_least 8 5] == 0 } {\n+    # lrepeat was added in tcl 8.5.  Only add if missing.\n+    proc lrepeat { n element } {\n+        if { [string is integer -strict $n] == 0 } {\n+            error \"expected integer but got \\\"$n\\\"\"\n+        }\n+        if { $n < 0 } {\n+            error \"bad count \\\"$n\\\": must be integer >= 0\"\n+        }\n+        set res [list]\n+        for {set i 0} {$i < $n} {incr i} {\n+            lappend res $element\n+        }\n+        return $res\n+    }\n+}\n+\n # gdb_test_no_output COMMAND MESSAGE\n # Send a command to GDB and verify that this command generated no output.\n #"
    }
  ]
}