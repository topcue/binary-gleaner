{
  "sha": "4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NGE2OGZjZDdmN2RhOTJkNDdmMGY0MWRmMTVmZWEzMGY3OTBlZDA2Yw==",
  "commit": {
    "author": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2021-02-09T12:53:32Z"
    },
    "committer": {
      "name": "Nick Clifton",
      "email": "nickc@redhat.com",
      "date": "2021-02-09T12:53:32Z"
    },
    "message": "Prevent a bad .Psize expression from triggering a memory access violation.\n\n\tPR 27384\n\t* listing.c (listing_psize): Check the result of the width\n\texpression before assigning it to paper_width.\n\t* testsuite/gas/all/pr27384.s: New test source file.\n\t* testsuite/gas/all/pr27384.d: New test control file.\n\t* testsuite/gas/all/pr27384.err: Expected errors from new test.\n\t* testsuite/gas/all/gas.exp: Run the new test.",
    "tree": {
      "sha": "fea666ca189d56117d8ff25a6dbb2a53738f3553",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/fea666ca189d56117d8ff25a6dbb2a53738f3553"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/comments",
  "author": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nickclifton",
    "id": 31441682,
    "node_id": "MDQ6VXNlcjMxNDQxNjgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/31441682?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nickclifton",
    "html_url": "https://github.com/nickclifton",
    "followers_url": "https://api.github.com/users/nickclifton/followers",
    "following_url": "https://api.github.com/users/nickclifton/following{/other_user}",
    "gists_url": "https://api.github.com/users/nickclifton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nickclifton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nickclifton/subscriptions",
    "organizations_url": "https://api.github.com/users/nickclifton/orgs",
    "repos_url": "https://api.github.com/users/nickclifton/repos",
    "events_url": "https://api.github.com/users/nickclifton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nickclifton/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "52563b0f1c5516930b4507861d261529483a5e83",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/52563b0f1c5516930b4507861d261529483a5e83",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/52563b0f1c5516930b4507861d261529483a5e83"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 44,
    "deletions": 1
  },
  "files": [
    {
      "sha": "8ab1d35d14458bb0b37bffbd804c240958aaf48c",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 10,
      "deletions": 0,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
      "patch": "@@ -1,3 +1,13 @@\n+2021-02-09  Nick Clifton  <nickc@redhat.com>\n+\n+\tPR 27384\n+\t* listing.c (listing_psize): Check the result of the width\n+\texpression before assigning it to paper_width.\n+\t* testsuite/gas/all/pr27384.s: New test source file.\n+\t* testsuite/gas/all/pr27384.d: New test control file.\n+\t* testsuite/gas/all/pr27384.err: Expected errors from new test.\n+\t* testsuite/gas/all/gas.exp: Run the new test.\n+\n 2021-02-09  Nick Clifton  <nickc@redhat.com>\n \n \tPR 27355"
    },
    {
      "sha": "f86fb000f939dc79833affbd41a1c6a45fde5097",
      "filename": "gas/listing.c",
      "status": "modified",
      "additions": 21,
      "deletions": 1,
      "changes": 22,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/listing.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/listing.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/listing.c?ref=4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
      "patch": "@@ -484,6 +484,8 @@ buffer_line (file_info_type *file, char *line, unsigned int size)\n   if (file->at_end)\n     return \"\";\n \n+if (size == (unsigned int) -7) exit (1);\n+  \n   /* Check the cache and see if we last used this file.  */\n   if (!last_open_file_info || file != last_open_file_info)\n     {\n@@ -1511,7 +1513,25 @@ listing_psize (int width_only)\n       ++input_line_pointer;\n     }\n \n-  paper_width = get_absolute_expression ();\n+  {\n+    expressionS exp;\n+\n+    (void) expression_and_evaluate (& exp);\n+\n+    if (exp.X_op == O_constant)\n+      {\n+\toffsetT new_width = exp.X_add_number;\n+\n+\tif (new_width > 7)\n+\t  paper_width = new_width;\n+\telse\n+\t  as_bad (_(\"new paper width is too small\"));\n+      }\n+    else if (exp.X_op != O_absent)\n+      as_bad (_(\"bad or irreducible expression for paper width\"));\n+    else\n+      as_bad (_(\"missing expression for paper width\"));\n+  }\n \n   demand_empty_rest_of_line ();\n }"
    },
    {
      "sha": "af36b095e85d17d4ade7d6258737cffe46ef61b1",
      "filename": "gas/testsuite/gas/all/gas.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/gas.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/gas.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/gas.exp?ref=4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
      "patch": "@@ -469,3 +469,4 @@ gas_test \"pr23938.s\" \"\" \"\" \".xstabs\"\n \n run_dump_test \"nop\"\n run_dump_test \"asciz\"\n+run_dump_test \"pr27384\""
    },
    {
      "sha": "5426c918c25a32e86de6684e7b637d862af0d9f8",
      "filename": "gas/testsuite/gas/all/pr27384.d",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/pr27384.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/pr27384.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/pr27384.d?ref=4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
      "patch": "@@ -0,0 +1,4 @@\n+#as: -a\n+#error_output: pr27384.err\n+# The metag target does not support the .Psize directive.\n+#notarget: metag-* rx-*"
    },
    {
      "sha": "2d5954f91ed22f97e10446d9c4f3043e7cd5cccf",
      "filename": "gas/testsuite/gas/all/pr27384.err",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/pr27384.err",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/pr27384.err",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/pr27384.err?ref=4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
      "patch": "@@ -0,0 +1,4 @@\n+.*pr27384.s: Assembler messages:\n+.*pr27384.s:2: Error: bad or irreducible absolute expression\n+.*pr27384.s:2: Error: new paper width is too small\n+#pass"
    },
    {
      "sha": "6d831b0d5f9cf51d6968b56f53d60f1f4283463e",
      "filename": "gas/testsuite/gas/all/pr27384.s",
      "status": "added",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/pr27384.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/4a68fcd7f7da92d47f0f41df15fea30f790ed06c/gas/testsuite/gas/all/pr27384.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/all/pr27384.s?ref=4a68fcd7f7da92d47f0f41df15fea30f790ed06c",
      "patch": "@@ -0,0 +1,4 @@\n+\t.nop\n+\t.Psize\tf,-7\n+\t.nop\n+\t"
    }
  ]
}