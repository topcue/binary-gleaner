{
  "sha": "e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZTQ2NzVhNTgxMGZjM2QwYTdkMGIxYzc0NGYwYTE4MzdjY2MwNTA3ZQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-09-18T16:12:27Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2021-09-19T14:19:39Z"
    },
    "message": "elf: Don't set version info on unversioned symbols\n\nDon't set version info on unversioned symbols when seeing a hidden\nversioned symbol after an unversioned definition and the default\nversioned symbol.\n\nbfd/\n\n\tPR ld/28348\n\t* elflink.c (elf_link_add_object_symbols): Don't set version info\n\ton unversioned symbols.\n\nld/\n\n\tPR ld/28348\n\t* testsuite/ld-elf/pr28348.rd: New file.\n\t* testsuite/ld-elf/pr28348.t: Likewise.\n\t* testsuite/ld-elf/pr28348a.c: Likewise.\n\t* testsuite/ld-elf/pr28348b.c: Likewise.\n\t* testsuite/ld-elf/pr28348c.c: Likewise.\n\t* testsuite/ld-elf/shared.exp: Run PR ld/28348 tests.",
    "tree": {
      "sha": "0b4614c66e6c46feb1d0bf3b7252d0c771139724",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/0b4614c66e6c46feb1d0bf3b7252d0c771139724"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "034ce7b42a1da639979fd743d8b9b1fb86c22d1c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/034ce7b42a1da639979fd743d8b9b1fb86c22d1c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/034ce7b42a1da639979fd743d8b9b1fb86c22d1c"
    }
  ],
  "stats": {
    "total": 74,
    "additions": 73,
    "deletions": 1
  },
  "files": [
    {
      "sha": "dc38548b23b07a394ef131c34aa2206cd6730562",
      "filename": "bfd/elflink.c",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/bfd/elflink.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/bfd/elflink.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/bfd/elflink.c?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -4987,7 +4987,8 @@ elf_link_add_object_symbols (bfd *abfd, struct bfd_link_info *info)\n \t\t || h->root.type == bfd_link_hash_warning)\n \t    h = (struct elf_link_hash_entry *) h->root.u.i.link;\n \n-\t  if (elf_tdata (abfd)->verdef != NULL\n+\t  if (h->versioned != unversioned\n+\t      && elf_tdata (abfd)->verdef != NULL\n \t      && vernum > 1\n \t      && definition)\n \t    h->verinfo.verdef = &elf_tdata (abfd)->verdef[vernum - 1];"
    },
    {
      "sha": "6e6ac0424981760ac63a8b5f7da327a114cdad49",
      "filename": "ld/testsuite/ld-elf/pr28348.rd",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348.rd",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348.rd",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28348.rd?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -0,0 +1,8 @@\n+#ld: -shared\n+#readelf: --dyn-syms --wide\n+#target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n+#xfail: ![check_shared_lib_support]\n+\n+#...\n+ +[0-9]+: +[0-9a-f]+ +[0-9a-f]+ +FUNC +WEAK +DEFAULT (\\[NOPV\\]|) +[0-9]+ +_?foo\n+#pass"
    },
    {
      "sha": "89ea6ef3275730341f4ccfb329437b6613142461",
      "filename": "ld/testsuite/ld-elf/pr28348.t",
      "status": "added",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348.t",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348.t",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28348.t?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -0,0 +1,6 @@\n+VERS_2.0 {\n+global:\n+  foo; bar;\n+local:\n+  *;\n+};"
    },
    {
      "sha": "3d54205ea4db2bac85b7d9bef51d577a95ed6128",
      "filename": "ld/testsuite/ld-elf/pr28348a.c",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348a.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348a.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28348a.c?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -0,0 +1,5 @@\n+__attribute__ ((weak))\n+void\n+foo (void)\n+{\n+}"
    },
    {
      "sha": "b4aab59274373f360b043f3adfb580ec06feb9da",
      "filename": "ld/testsuite/ld-elf/pr28348b.c",
      "status": "added",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348b.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348b.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28348b.c?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -0,0 +1,5 @@\n+void\n+foo (void)\n+{\n+}\n+asm (\".symver foo,foo@VERS_2.0\");"
    },
    {
      "sha": "cbb9d564d63977fda199b200419ba30e92914e2b",
      "filename": "ld/testsuite/ld-elf/pr28348c.c",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348c.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/pr28348c.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr28348c.c?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -0,0 +1,8 @@\n+extern void foo (void);\n+\n+int\n+main ()\n+{\n+  foo ();\n+  return 0;\n+}"
    },
    {
      "sha": "19a8e49c7de2e222d8262a5e5733c933dd5a798c",
      "filename": "ld/testsuite/ld-elf/shared.exp",
      "status": "modified",
      "additions": 39,
      "deletions": 0,
      "changes": 39,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e/ld/testsuite/ld-elf/shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/shared.exp?ref=e4675a5810fc3d0a7d0b1c744f0a1837ccc0507e",
      "patch": "@@ -868,6 +868,45 @@ run_cc_link_tests [list \\\n \t{} \\\n \t\"pr26590\" \\\n     ] \\\n+    [list \\\n+\t\"Build libpr28348a.so\" \\\n+\t\"-shared -Wl,--version-script=pr28348.t\" \\\n+\t\"-fPIC\" \\\n+\t{pr28348a.c} \\\n+\t{} \\\n+\t\"libpr28348a.so\" \\\n+    ] \\\n+    [list \\\n+\t\"Build pr28348b.o\" \\\n+\t\"\" \\\n+\t\"-fPIC\" \\\n+\t{pr28348b.c} \\\n+    ] \\\n+    [list \\\n+\t\"Build pr28348c.o\" \\\n+\t\"\" \\\n+\t\"\" \\\n+\t{pr28348c.c} \\\n+    ] \\\n+    [list \\\n+\t\"Build libpr28348b.so\" \\\n+\t\"-shared -Wl,--version-script=pr28348.t \\\n+\t -Wl,--no-as-needed tmpdir/pr28348b.o tmpdir/libpr28348a.so\" \\\n+\t\"-fPIC\" \\\n+\t{dummy.c} \\\n+\t{} \\\n+\t\"libpr28348b.so\" \\\n+    ] \\\n+    [list \\\n+\t\"Build pr28348\" \\\n+\t\"-Wl,--no-as-needed tmpdir/pr28348c.o \\\n+\t tmpdir/pr28348a.o tmpdir/libpr28348a.so tmpdir/libpr28348b.so \\\n+\t tmpdir/libpr28348a.so\" \\\n+\t\"\" \\\n+\t{dummy.c} \\\n+\t{{readelf {--dyn-syms --wide} pr28348.rd}} \\\n+\t\"pr28348\" \\\n+    ] \\\n ]\n \n # pr19073.s uses .set, which has a different meaning on alpha."
    }
  ]
}