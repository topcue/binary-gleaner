{
  "sha": "c4f5871457222f2c4a99e662dfa16b7c662f750a",
  "node_id": "C_kwDOANOeidoAKGM0ZjU4NzE0NTcyMjJmMmM0YTk5ZTY2MmRmYTE2YjdjNjYyZjc1MGE",
  "commit": {
    "author": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@axis.com",
      "date": "2022-01-12T04:41:09Z"
    },
    "committer": {
      "name": "Hans-Peter Nilsson",
      "email": "hp@bitrange.com",
      "date": "2022-01-12T04:51:25Z"
    },
    "message": "objdump, readelf: Emit \"CU:\" format only when wide output is requested\n\nAs pre-approved by Alan in\nhttps://sourceware.org/pipermail/binutils/2021-September/118019.html\nand I believe people have run into getting testsuite failures for\ntest-environments with \"long\" directory names, at least once more\nsince that time.  Enough.  I grepped the gas, binutils and ld\ntestsuites for \"CU:\" to catch target-specific occurrences, but I\nnoticed none.  I chose to remove \"CU:\" on the objdump tests instead of\nchanging options to get the wide format, so as to keep the name of the\ntest consistent with actual options; but added it to the readelf\noptions for the gas test as I believe the \"CU:\" format is preferable.\n\nTested for cris-elf and native x86_64-pc-linux-gnu.\n\nbinutils:\n\t* dwarf.c (display_debug_lines_decoded): Don't check the\n\tstring length of the directory, instead emit the \"CU: dir/name\"\n\tformat only if wide output is requested.\n\t* testsuite/binutils-all/dw5.W, testsuite/binutils-all/objdump.WL:\n\tAdjust accordingly.\n\ngas:\n\t* testsuite/gas/elf/dwarf-5-loc0.d: Add -W to readelf options.",
    "tree": {
      "sha": "8429d04530256acaab9ec6e9cd35964a9d2cea04",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8429d04530256acaab9ec6e9cd35964a9d2cea04"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c4f5871457222f2c4a99e662dfa16b7c662f750a",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c4f5871457222f2c4a99e662dfa16b7c662f750a",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c4f5871457222f2c4a99e662dfa16b7c662f750a",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c4f5871457222f2c4a99e662dfa16b7c662f750a/comments",
  "author": {
    "login": "hpataxisdotcom",
    "id": 80339731,
    "node_id": "MDQ6VXNlcjgwMzM5NzMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/80339731?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hpataxisdotcom",
    "html_url": "https://github.com/hpataxisdotcom",
    "followers_url": "https://api.github.com/users/hpataxisdotcom/followers",
    "following_url": "https://api.github.com/users/hpataxisdotcom/following{/other_user}",
    "gists_url": "https://api.github.com/users/hpataxisdotcom/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hpataxisdotcom/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hpataxisdotcom/subscriptions",
    "organizations_url": "https://api.github.com/users/hpataxisdotcom/orgs",
    "repos_url": "https://api.github.com/users/hpataxisdotcom/repos",
    "events_url": "https://api.github.com/users/hpataxisdotcom/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hpataxisdotcom/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": null,
  "parents": [
    {
      "sha": "b02db37812bef6e12772bfbddd004e50534eaed1",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b02db37812bef6e12772bfbddd004e50534eaed1",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b02db37812bef6e12772bfbddd004e50534eaed1"
    }
  ],
  "stats": {
    "total": 8,
    "additions": 4,
    "deletions": 4
  },
  "files": [
    {
      "sha": "bc33e9f0814383d4fe6299549bc303cbcf480659",
      "filename": "binutils/dwarf.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c4f5871457222f2c4a99e662dfa16b7c662f750a/binutils/dwarf.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c4f5871457222f2c4a99e662dfa16b7c662f750a/binutils/dwarf.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/dwarf.c?ref=c4f5871457222f2c4a99e662dfa16b7c662f750a",
      "patch": "@@ -5137,7 +5137,7 @@ display_debug_lines_decoded (struct dwarf_section *  section,\n \t      else\n \t\tdirectory = (char *) directory_table[ix - 1];\n \n-\t      if (do_wide || strlen (directory) < 76)\n+\t      if (do_wide)\n \t\tprintf (_(\"CU: %s/%s:\\n\"), directory, file_table[0].name);\n \t      else\n \t\tprintf (\"%s:\\n\", file_table[0].name);"
    },
    {
      "sha": "ebab8b7d3b093525ed9d9e1c201afd4ce060e2b8",
      "filename": "binutils/testsuite/binutils-all/dw5.W",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c4f5871457222f2c4a99e662dfa16b7c662f750a/binutils/testsuite/binutils-all/dw5.W",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c4f5871457222f2c4a99e662dfa16b7c662f750a/binutils/testsuite/binutils-all/dw5.W",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/testsuite/binutils-all/dw5.W?ref=c4f5871457222f2c4a99e662dfa16b7c662f750a",
      "patch": "@@ -347,7 +347,7 @@ Raw dump of debug contents of section .debug_line:\n \n Contents of the .debug_line section:\n \n-CU: ./main.c:\n+main.c:\n File name                            Line number    Starting address    View    Stmt\n main.c                                         6              0x1234               x\n main.c                                         6             0x12346               x"
    },
    {
      "sha": "f02a9e638398818c20022dd81ceafea1a24faea5",
      "filename": "binutils/testsuite/binutils-all/objdump.WL",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c4f5871457222f2c4a99e662dfa16b7c662f750a/binutils/testsuite/binutils-all/objdump.WL",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c4f5871457222f2c4a99e662dfa16b7c662f750a/binutils/testsuite/binutils-all/objdump.WL",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/testsuite/binutils-all/objdump.WL?ref=c4f5871457222f2c4a99e662dfa16b7c662f750a",
      "patch": "@@ -3,7 +3,7 @@\n \n Contents of the \\.debug_line section:\n \n-CU: \\./dw2-decodedline\\.c:\n+dw2-decodedline\\.c:\n File name                            Line number    Starting address    View    Stmt\n \n directory/file1\\.c:"
    },
    {
      "sha": "7e8473a486f50bb2598bebdf790e83d11a4ff180",
      "filename": "gas/testsuite/gas/elf/dwarf-5-loc0.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c4f5871457222f2c4a99e662dfa16b7c662f750a/gas/testsuite/gas/elf/dwarf-5-loc0.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c4f5871457222f2c4a99e662dfa16b7c662f750a/gas/testsuite/gas/elf/dwarf-5-loc0.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/dwarf-5-loc0.d?ref=c4f5871457222f2c4a99e662dfa16b7c662f750a",
      "patch": "@@ -1,5 +1,5 @@\n #as: -gdwarf-5\n-#readelf: -wL\n+#readelf: -W -wL\n #name: DWARF5 .loc 0\n # The am33 cr16 crx ft32 mn10 msp430 nds32 and rl78 targets do not evaluate the subtraction of symbols at assembly time.\n # The riscv targets do not support the subtraction of symbols."
    }
  ]
}