{
  "sha": "6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NmExMjI0ZWM3NjJmN2RkNTlkN2FiZDJlNWRjM2JlMjZiYjE1N2NkMQ==",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-02-27T05:09:05Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-03-01T03:56:39Z"
    },
    "message": "PR27128, nm -P portable output format regression\n\nAdd nm --without-symbol-versions.\n\nbinutils/\n\tPR 27128\n\t* doc/binutils.texi: Add nm --with-symbol-versions and\n\t--without-symbol-versions documentation.\n\t* nm.c (with_symbol_versions): New variable.\n\t(enum long_option_values): Delete OPTION_WITH_SYMBOL_VERSIONS.\n\t(long_options): Make --with-symbol-versions entry twiddle the flag.\n\tAdd --without-symbol-versions.\n\t(print_symname): Strip version when !with_symbol_versions.  Add\n\tdynamic version info under control of with_symbol_versions.\n\t(main): Remove OPTION_WITH_SYMBOL_VERSIONS case.\nld/\n\t* testsuite/ld-elf/pr25708.d: Add --with-symbol-versions to nm.\n\t* testsuite/ld-elf/pr27128a.d: Likewise.\n\t* testsuite/ld-elf/pr27128b.d: Likewise.\n\t* testsuite/ld-elf/pr27128c.d: Likewise.\n\t* testsuite/ld-elf/pr27128d.d: Likewise.\n\t* testsuite/ld-elf/pr27128e.d: Likewise.",
    "tree": {
      "sha": "1e35d6d43b5efe25d4b7fc5e5ee818eb38e0742b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/1e35d6d43b5efe25d4b7fc5e5ee818eb38e0742b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "cf850febf6d2e3945670386c707a86363919e9ee",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cf850febf6d2e3945670386c707a86363919e9ee",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/cf850febf6d2e3945670386c707a86363919e9ee"
    }
  ],
  "stats": {
    "total": 68,
    "additions": 54,
    "deletions": 14
  },
  "files": [
    {
      "sha": "419be6410347af1a44ae75aff5c314a3c946eb36",
      "filename": "binutils/ChangeLog",
      "status": "modified",
      "additions": 13,
      "deletions": 0,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/binutils/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/binutils/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/ChangeLog?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,3 +1,16 @@\n+2021-03-01  Alan Modra  <amodra@gmail.com>\n+\n+\tPR 27128\n+\t* doc/binutils.texi: Add nm --with-symbol-versions and\n+\t--without-symbol-versions documentation.\n+\t* nm.c (with_symbol_versions): New variable.\n+\t(enum long_option_values): Delete OPTION_WITH_SYMBOL_VERSIONS.\n+\t(long_options): Make --with-symbol-versions entry twiddle the flag.\n+\tAdd --without-symbol-versions.\n+\t(print_symname): Strip version when !with_symbol_versions.  Add\n+\tdynamic version info under control of with_symbol_versions.\n+\t(main): Remove OPTION_WITH_SYMBOL_VERSIONS case.\n+\n 2021-02-26  Fangrui Song  <maskray@google.com>\n \n \tPR 27408"
    },
    {
      "sha": "ee898331dd886a0c732c663f537ecf7af92f7409",
      "filename": "binutils/doc/binutils.texi",
      "status": "modified",
      "additions": 12,
      "deletions": 1,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/binutils/doc/binutils.texi",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/binutils/doc/binutils.texi",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/doc/binutils.texi?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -808,7 +808,8 @@ nm [@option{-A}|@option{-o}|@option{--print-file-name}] [@option{-a}|@option{--d\n    [@option{--plugin} @var{name}]\n    [@option{--no-recurse-limit}|@option{--recurse-limit}]]\n    [@option{--size-sort}] [@option{--special-syms}]\n-   [@option{--synthetic}] [@option{--target=}@var{bfdname}]\n+   [@option{--synthetic}] [@option{--with-symbol-versions}]\n+   [@option{--without-symbol-versions}] [@option{--target=}@var{bfdname}]\n    [@var{objfile}@dots{}]\n @c man end\n @end smallexample\n@@ -1169,6 +1170,16 @@ Include synthetic symbols in the output.  These are special symbols\n created by the linker for various purposes.  They are not shown by\n default since they are not part of the binary's original source code.\n \n+@item --with-symbol-versions\n+@item --without-symbol-versions\n+Enables or disables the display of symbol version information.  The\n+version string is displayed as a suffix to the symbol name, preceded\n+by an @@ character.  For example @samp{foo@@VER_1}.  If the version is\n+the default version to be used when resolving unversioned references\n+to the symbol then it is displayed as a suffix preceded by two @@\n+characters.  For example @samp{foo@@@@VER_2}.  By default, symbol\n+version information is displayed.\n+\n @item --target=@var{bfdname}\n @cindex object code format\n Specify an object code format other than your system's default format."
    },
    {
      "sha": "2637756c6475694808c30d3f404832ebf69dcb47",
      "filename": "binutils/nm.c",
      "status": "modified",
      "additions": 14,
      "deletions": 7,
      "changes": 21,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/binutils/nm.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/binutils/nm.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/binutils/nm.c?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -161,6 +161,7 @@ static int show_version = 0;\t/* Show the version number.  */\n static int show_synthetic = 0;\t/* Display synthesized symbols too.  */\n static int line_numbers = 0;\t/* Print line numbers for symbols.  */\n static int allow_special_symbols = 0;  /* Allow special symbols.  */\n+static int with_symbol_versions = -1; /* Output symbol version information.  */\n static int quiet = 0;\t\t/* Suppress \"no symbols\" diagnostic.  */\n \n /* The characters to use for global and local ifunc symbols.  */\n@@ -201,7 +202,6 @@ enum long_option_values\n   OPTION_RECURSE_LIMIT,\n   OPTION_NO_RECURSE_LIMIT,\n   OPTION_IFUNC_CHARS,\n-  OPTION_WITH_SYMBOL_VERSIONS,\n   OPTION_QUIET\n };\n \n@@ -238,8 +238,8 @@ static struct option long_options[] =\n   {\"defined-only\", no_argument, &defined_only, 1},\n   {\"undefined-only\", no_argument, &undefined_only, 1},\n   {\"version\", no_argument, &show_version, 1},\n-  {\"with-symbol-versions\", no_argument, NULL,\n-   OPTION_WITH_SYMBOL_VERSIONS},\n+  {\"with-symbol-versions\", no_argument, &with_symbol_versions, 1},\n+  {\"without-symbol-versions\", no_argument, &with_symbol_versions, 0},\n   {0, no_argument, 0, 0}\n };\n \f\n@@ -412,17 +412,25 @@ print_symname (const char *form, struct extended_symbol_info *info,\n \t       const char *name, bfd *abfd)\n {\n   char *alloc = NULL;\n+  char *atver = NULL;\n \n   if (name == NULL)\n     name = info->sinfo->name;\n+  if (!with_symbol_versions\n+      && bfd_get_flavour (abfd) == bfd_target_elf_flavour)\n+    {\n+      atver = strchr (name, '@');\n+      if (atver)\n+\t*atver = 0;\n+    }\n   if (do_demangle && *name)\n     {\n       alloc = bfd_demangle (abfd, name, demangle_flags);\n       if (alloc != NULL)\n \tname = alloc;\n     }\n \n-  if (info != NULL && info->elfinfo)\n+  if (info != NULL && info->elfinfo && with_symbol_versions)\n     {\n       const char *version_string;\n       bfd_boolean hidden;\n@@ -441,6 +449,8 @@ print_symname (const char *form, struct extended_symbol_info *info,\n \t}\n     }\n   printf (form, name);\n+  if (atver)\n+    *atver = '@';\n   free (alloc);\n }\n \n@@ -1780,9 +1790,6 @@ main (int argc, char **argv)\n \tcase OPTION_NO_RECURSE_LIMIT:\n \t  demangle_flags |= DMGL_NO_RECURSE_LIMIT;\n \t  break;\n-\tcase OPTION_WITH_SYMBOL_VERSIONS:\n-\t  /* Ignored for backward compatibility.  */\n-\t  break;\n \tcase OPTION_QUIET:\n \t  quiet = 1;\n \t  break;"
    },
    {
      "sha": "873928608bdbb7dd2af01ceb7d3de05757cbe3e6",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,3 +1,12 @@\n+2021-03-01  Alan Modra  <amodra@gmail.com>\n+\n+\t* testsuite/ld-elf/pr25708.d: Add --with-symbol-versions to nm.\n+\t* testsuite/ld-elf/pr27128a.d: Likewise.\n+\t* testsuite/ld-elf/pr27128b.d: Likewise.\n+\t* testsuite/ld-elf/pr27128c.d: Likewise.\n+\t* testsuite/ld-elf/pr27128d.d: Likewise.\n+\t* testsuite/ld-elf/pr27128e.d: Likewise.\n+\n 2021-02-26  Alan Modra  <amodra@gmail.com>\n \n \tPR 27441"
    },
    {
      "sha": "60b8e31807a407df6ae6d13e46d234ccf0c80f1c",
      "filename": "ld/testsuite/ld-elf/pr25708.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr25708.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr25708.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr25708.d?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,6 +1,6 @@\n #source: pr13195.s\n #ld: -shared -version-script pr13195.t\n-#nm: -D\n+#nm: -D --with-symbol-versions\n #target: *-*-linux* *-*-gnu* arm*-*-uclinuxfdpiceabi\n #xfail: hppa64-*-* ![check_shared_lib_support] \n # h8300 doesn't support -shared, and hppa64 creates .foo"
    },
    {
      "sha": "645d0ccf01ccae4aff1599996afec0c48d14105f",
      "filename": "ld/testsuite/ld-elf/pr27128a.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128a.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128a.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128a.d?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,6 +1,6 @@\n #source: pr27128.s\n #ld: -shared -version-script pr27128.t\n-#nm: -n -P\n+#nm: -n -P --with-symbol-versions\n #target: [check_shared_lib_support]\n #notarget: [is_underscore_target]\n # _Zrm1XS_ doesn't have an extra underscore."
    },
    {
      "sha": "0721117edfa5a8adeb829ef5bc695abb9e2ab7a6",
      "filename": "ld/testsuite/ld-elf/pr27128b.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128b.d?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,6 +1,6 @@\n #source: pr27128.s\n #ld: -shared -version-script pr27128.t\n-#nm: -n -D --format=posix\n+#nm: -n -D --format=posix --with-symbol-versions\n #target: [check_shared_lib_support]\n #notarget: [is_underscore_target]\n # _Zrm1XS_ doesn't have an extra underscore."
    },
    {
      "sha": "d9cee44a718224d476360d0f73de6c03a1cf8dff",
      "filename": "ld/testsuite/ld-elf/pr27128c.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128c.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128c.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128c.d?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,6 +1,6 @@\n #source: pr27128.s\n #ld: -shared -version-script pr27128.t\n-#nm: -n --format=sysv\n+#nm: -n --format=sysv --with-symbol-versions\n #target: [check_shared_lib_support]\n #notarget: [is_underscore_target]\n # _Zrm1XS_ doesn't have an extra underscore."
    },
    {
      "sha": "45d19729483d4cdb08cab07759c4a1f4c6f7c837",
      "filename": "ld/testsuite/ld-elf/pr27128d.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128d.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128d.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128d.d?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,6 +1,6 @@\n #source: pr27128.s\n #ld: -shared -version-script pr27128.t\n-#nm: -n -D --format=sysv\n+#nm: -n -D --format=sysv --with-symbol-versions\n #target: [check_shared_lib_support]\n #notarget: [is_underscore_target]\n # _Zrm1XS_ doesn't have an extra underscore."
    },
    {
      "sha": "4263a059b57621fa5032999cfb9c0859560926a0",
      "filename": "ld/testsuite/ld-elf/pr27128e.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128e.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1/ld/testsuite/ld-elf/pr27128e.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/pr27128e.d?ref=6a1224ec762f7dd59d7abd2e5dc3be26bb157cd1",
      "patch": "@@ -1,6 +1,6 @@\n #source: pr27128.s\n #ld: -shared -version-script pr27128.t\n-#nm: -n --demangle -D --format=posix\n+#nm: -n --demangle -D --format=posix --with-symbol-versions\n #target: [check_shared_lib_support]\n #notarget: [is_underscore_target]\n # _Zrm1XS_ doesn't have an extra underscore."
    }
  ]
}