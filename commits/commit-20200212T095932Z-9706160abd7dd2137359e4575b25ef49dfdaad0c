{
  "sha": "9706160abd7dd2137359e4575b25ef49dfdaad0c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTcwNjE2MGFiZDdkZDIxMzczNTllNDU3NWIyNWVmNDlkZmRhYWQwYw==",
  "commit": {
    "author": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-02-12T09:59:32Z"
    },
    "committer": {
      "name": "Jan Beulich",
      "email": "jbeulich@suse.com",
      "date": "2020-02-12T09:59:32Z"
    },
    "message": "x86: also disallow non-byte/-word registers with byte/word suffix\n\nAlong the lines of be4c5e58bd (\"x86: Always disallow double word suffix\nwith word general register\") also adjust check_{byte,word}_reg(), to make\noverall behavior consistent again in this regard.",
    "tree": {
      "sha": "785cfce41f0a7b5f8c30d91f69d4dc1b07b8f9db",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/785cfce41f0a7b5f8c30d91f69d4dc1b07b8f9db"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9706160abd7dd2137359e4575b25ef49dfdaad0c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9706160abd7dd2137359e4575b25ef49dfdaad0c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9706160abd7dd2137359e4575b25ef49dfdaad0c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9706160abd7dd2137359e4575b25ef49dfdaad0c/comments",
  "author": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "jbeulich",
    "id": 5610135,
    "node_id": "MDQ6VXNlcjU2MTAxMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5610135?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jbeulich",
    "html_url": "https://github.com/jbeulich",
    "followers_url": "https://api.github.com/users/jbeulich/followers",
    "following_url": "https://api.github.com/users/jbeulich/following{/other_user}",
    "gists_url": "https://api.github.com/users/jbeulich/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jbeulich/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jbeulich/subscriptions",
    "organizations_url": "https://api.github.com/users/jbeulich/orgs",
    "repos_url": "https://api.github.com/users/jbeulich/repos",
    "events_url": "https://api.github.com/users/jbeulich/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jbeulich/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "5de4d9ef71d5233026d8e9fbd74ec87cca4d220a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5de4d9ef71d5233026d8e9fbd74ec87cca4d220a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5de4d9ef71d5233026d8e9fbd74ec87cca4d220a"
    }
  ],
  "stats": {
    "total": 133,
    "additions": 62,
    "deletions": 71
  },
  "files": [
    {
      "sha": "3e08345377b448fa93768e193c1cbd09719bd196",
      "filename": "gas/ChangeLog",
      "status": "modified",
      "additions": 15,
      "deletions": 0,
      "changes": 15,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/ChangeLog?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -1,3 +1,18 @@\n+2020-02-12  Jan Beulich  <jbeulich@suse.com>\n+\n+\tPR gas/25438\n+\t* config/tc-i386.c (REGISTER_WARNINGS): Delete.\n+\t(check_byte_reg): Skip only source operand of CRC32. Drop Non-\n+\t64-bit-only warning.\n+\t(check_word_reg): Consistently error on mismatching register\n+\tsize and suffix.\n+\t* testsuite/gas/i386/general.s: Replace dword GPR with word one\n+\tfor movw. Replace suffix / GPR for orb.\n+\t* testsuite/gas/i386/inval.s: Add tests for movw with dword and\n+\tbyte GPRs as well as ones for inb/outb with a word accumulator.\n+\t* testsuite/gas/i386/general.l, testsuite/gas/i386/intelbad.l,\n+\ttestsuite/gas/i386/inval.l: Adjust expectations.\n+\n 2020-02-12  Jan Beulich  <jbeulich@suse.com>\n \n \t* config/tc-i386.c (operand_type_register_match): Also fall"
    },
    {
      "sha": "314fd7274bf8fb70e55659c3be89cb32a25b3730",
      "filename": "gas/config/tc-i386.c",
      "status": "modified",
      "additions": 8,
      "deletions": 45,
      "changes": 53,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/config/tc-i386.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/config/tc-i386.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-i386.c?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -44,10 +44,6 @@\n #endif\n #endif\n \n-#ifndef REGISTER_WARNINGS\n-#define REGISTER_WARNINGS 1\n-#endif\n-\n #ifndef INFER_ADDR_PREFIX\n #define INFER_ADDR_PREFIX 1\n #endif\n@@ -6638,31 +6634,10 @@ check_byte_reg (void)\n \t  && i.tm.operand_types[op].bitfield.word)\n \tcontinue;\n \n-      /* crc32 doesn't generate this warning.  */\n-      if (i.tm.base_opcode == 0xf20f38f0)\n+      /* crc32 only wants its source operand checked here.  */\n+      if (i.tm.base_opcode == 0xf20f38f0 && op)\n \tcontinue;\n \n-      if ((i.types[op].bitfield.word\n-\t   || i.types[op].bitfield.dword\n-\t   || i.types[op].bitfield.qword)\n-\t  && i.op[op].regs->reg_num < 4\n-\t  /* Prohibit these changes in 64bit mode, since the lowering\n-\t     would be more complicated.  */\n-\t  && flag_code != CODE_64BIT)\n-\t{\n-#if REGISTER_WARNINGS\n-\t  if (!quiet_warnings)\n-\t    as_warn (_(\"using `%s%s' instead of `%s%s' due to `%c' suffix\"),\n-\t\t     register_prefix,\n-\t\t     (i.op[op].regs + (i.types[op].bitfield.word\n-\t\t\t\t       ? REGNAM_AL - REGNAM_AX\n-\t\t\t\t       : REGNAM_AL - REGNAM_EAX))->reg_name,\n-\t\t     register_prefix,\n-\t\t     i.op[op].regs->reg_name,\n-\t\t     i.suffix);\n-#endif\n-\t  continue;\n-\t}\n       /* Any other register is bad.  */\n       if (i.types[op].bitfield.class == Reg\n \t  || i.types[op].bitfield.class == RegMMX\n@@ -6818,29 +6793,17 @@ check_word_reg (void)\n \t\ti.suffix);\n \treturn 0;\n       }\n-    /* Warn if the e or r prefix on a general reg is present.  */\n-    else if ((!quiet_warnings || flag_code == CODE_64BIT)\n-\t     && (i.types[op].bitfield.dword\n+    /* Error if the e or r prefix on a general reg is present.  */\n+    else if ((i.types[op].bitfield.dword\n \t\t || i.types[op].bitfield.qword)\n \t     && (i.tm.operand_types[op].bitfield.class == Reg\n \t\t || i.tm.operand_types[op].bitfield.instance == Accum)\n \t     && i.tm.operand_types[op].bitfield.word)\n       {\n-\t/* Prohibit these changes in the 64bit mode, since the\n-\t   lowering is more complicated.  */\n-\tif (flag_code == CODE_64BIT)\n-\t  {\n-\t    as_bad (_(\"incorrect register `%s%s' used with `%c' suffix\"),\n-\t\t    register_prefix, i.op[op].regs->reg_name,\n-\t\t    i.suffix);\n-\t    return 0;\n-\t  }\n-#if REGISTER_WARNINGS\n-\tas_warn (_(\"using `%s%s' instead of `%s%s' due to `%c' suffix\"),\n-\t\t register_prefix,\n-\t\t (i.op[op].regs + REGNAM_AX - REGNAM_EAX)->reg_name,\n-\t\t register_prefix, i.op[op].regs->reg_name, i.suffix);\n-#endif\n+\tas_bad (_(\"incorrect register `%s%s' used with `%c' suffix\"),\n+\t\tregister_prefix, i.op[op].regs->reg_name,\n+\t\ti.suffix);\n+\treturn 0;\n       }\n   return 1;\n }"
    },
    {
      "sha": "79da1acc7a5c26255b02ab85c41cd34217329893",
      "filename": "gas/testsuite/gas/i386/general.l",
      "status": "modified",
      "additions": 7,
      "deletions": 19,
      "changes": 26,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/general.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/general.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/general.l?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -9,12 +9,6 @@\n .*:25: Warning:.*\n .*:27: Warning:.*\n .*:29: Warning:.*\n-.*:48: Warning:.*\n-.*:51: Warning:.*\n-.*:124: Warning:.*\n-.*:125: Warning:.*\n-.*:126: Warning:.*\n-.*:127: Warning:.*\n .*:128: Warning:.*\n .*:129: Warning:.*\n .*:130: Warning:.*\n@@ -90,12 +84,10 @@\n   45 008d 661F              \t\tpopw\t%ds\n   46 008f 668CD8            \t\tmov\t%ds,%ax\n   47 0092 668CD8            \t\tmovw\t%ds,%ax\n-  48 0095 668CD8            \t\tmovw\t%ds,%eax\n-.*Warning:.*\n+  48 0095 668CDF            \t\tmovw\t%ds,%di\n   49 0098 8ED8              \t\tmov\t%ax,%ds\n   50 009a 8ED8              \t\tmovw\t%ax,%ds\n-  51 009c 8ED8              \t\tmovw\t%eax,%ds\n-.*Warning:.*\n+  51 009c 8EDF              \t\tmovw\t%di,%ds\n   52                       \t\n   53                       \t# test various pushes\n   54 009e 6A0A              \t\tpushl\t\\$10\n@@ -167,15 +159,11 @@\n  120 012e 0F9303            \t\tsetaeb\t\\(%ebx\\)\n  121 0131 0F93C0            \t\tsetae\t%al\n  122                       \t\n- 123                       \t#these should give warnings\n- 124 0134 0C01              \t\torb\t\\$1,%ax\n-.*Warning:.*\n- 125 0136 0C01              \t\torb\t\\$1,%eax\n-.*Warning:.*\n- 126 0138 80CB01            \t\torb\t\\$1,%bx\n-.*Warning:.*\n- 127 013b 80CB01            \t\torb\t\\$1,%ebx\n-.*Warning:.*\n+ 123 0134 0C01              \t\torb\t\\$1,%al\n+ 124 0136 0D000100 00       \t\torl\t\\$0x100,%eax\n+ 125 013b 80CB01            \t\torb\t\\$1,%bl\n+ 126                       \t\n+ 127                       \t#these should give warnings\n  128 013e D9C1              \t\tfldl\t%st\\(1\\)\n .*Warning:.*\n  129 0140 DDD2              \t\tfstl\t%st\\(2\\)"
    },
    {
      "sha": "472924d221ed45d749907b61ce8b2879ad1462a0",
      "filename": "gas/testsuite/gas/i386/general.s",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/general.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/general.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/general.s?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -45,10 +45,10 @@\n \tpopw\t%ds\n \tmov\t%ds,%ax\n \tmovw\t%ds,%ax\n-\tmovw\t%ds,%eax\n+\tmovw\t%ds,%di\n \tmov\t%ax,%ds\n \tmovw\t%ax,%ds\n-\tmovw\t%eax,%ds\n+\tmovw\t%di,%ds\n \n # test various pushes\n \tpushl\t$10\n@@ -120,11 +120,11 @@\n \tsetaeb\t(%ebx)\n \tsetae\t%al\n \n+\torb\t$1,%al\n+\torl\t$0x100,%eax\n+\torb\t$1,%bl\n+\n #these should give warnings\n-\torb\t$1,%ax\n-\torb\t$1,%eax\n-\torb\t$1,%bx\n-\torb\t$1,%ebx\n \tfldl\t%st(1)\n \tfstl\t%st(2)\n \tfstpl\t%st(3)"
    },
    {
      "sha": "b872fb5c9ccdc74eecf453f64d43413f26834bf9",
      "filename": "gas/testsuite/gas/i386/intelbad.l",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/intelbad.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/intelbad.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/intelbad.l?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -154,7 +154,7 @@\n .*:172: Error: .*\n .*:174: Error: .*\n .*:175: Error: .*\n-.*:176: Warning: .*\n+.*:176: Error: .*\n .*:177: Error: .*\n .*:178: Error: .*\n .*:180: Error: .*"
    },
    {
      "sha": "abe220620b7537769e735d436b5809c6f891e3a7",
      "filename": "gas/testsuite/gas/i386/inval.l",
      "status": "modified",
      "additions": 17,
      "deletions": 0,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/inval.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/inval.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/inval.l?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -91,6 +91,12 @@\n .*:104: Error: .*\n .*:105: Error: .*\n .*:106: Error: .*\n+.*:108: Error: .*\n+.*:109: Error: .*\n+.*:110: Error: .*\n+.*:112: Error: .*\n+.*:113: Error: .*\n+.*:114: Error: .*\n GAS LISTING .*\n \n \n@@ -203,3 +209,14 @@ GAS LISTING .*\n [ \t]*[1-9][0-9]*[ \t]+movl\t%ds, %ax\n [ \t]*[1-9][0-9]*[ \t]+movl\t%ax, %ds\n [ \t]*[1-9][0-9]*[ \t]+movl\t%ax, %bx\n+[ \t]*[1-9][0-9]*[ \t]+\n+[ \t]*[1-9][0-9]*[ \t]+movw\t%ds, %eax\n+[ \t]*[1-9][0-9]*[ \t]+movw\t%eax, %ds\n+[ \t]*[1-9][0-9]*[ \t]+movw\t%eax, %ebx\n+[ \t]*[1-9][0-9]*[ \t]+\n+[ \t]*[1-9][0-9]*[ \t]+inb\t%dx, %ax\n+[ \t]*[1-9][0-9]*[ \t]+outb\t%ax, %dx\n+[ \t]*[1-9][0-9]*[ \t]+movb\t%ax, %bx\n+\fGAS LISTING .*\n+\n+"
    },
    {
      "sha": "7adfec64600a453430c2883e1115fec13e386426",
      "filename": "gas/testsuite/gas/i386/inval.s",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/inval.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9706160abd7dd2137359e4575b25ef49dfdaad0c/gas/testsuite/gas/i386/inval.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/i386/inval.s?ref=9706160abd7dd2137359e4575b25ef49dfdaad0c",
      "patch": "@@ -104,3 +104,11 @@ movnti word ptr [eax], ax\n \tmovl\t%ds, %ax\n \tmovl\t%ax, %ds\n \tmovl\t%ax, %bx\n+\n+\tmovw\t%ds, %eax\n+\tmovw\t%eax, %ds\n+\tmovw\t%eax, %ebx\n+\n+\tinb\t%dx, %ax\n+\toutb\t%ax, %dx\n+\tmovb\t%ax, %bx"
    }
  ]
}