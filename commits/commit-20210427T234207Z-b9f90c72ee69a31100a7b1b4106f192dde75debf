{
  "sha": "b9f90c72ee69a31100a7b1b4106f192dde75debf",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YjlmOTBjNzJlZTY5YTMxMTAwYTdiMWI0MTA2ZjE5MmRkZTc1ZGViZg==",
  "commit": {
    "author": {
      "name": "Luis Machado",
      "email": "luis.machado@linaro.org",
      "date": "2021-04-01T20:00:43Z"
    },
    "committer": {
      "name": "Luis Machado",
      "email": "luis.machado@linaro.org",
      "date": "2021-04-27T23:42:07Z"
    },
    "message": "Fix timeout with maint print objfiles\n\nI'm seeing timeouts from gdb.rust/traits.exp when we attempt to print\nthings with \"maint print objfiles\".\n\nThis happens for two reasons:\n\n1 - GDB does not explicitly split each entry into its own line, but rather\n    relies on the terminal's width to insert line breaks.\n\n2 - When running the GDB testsuite, such width may be unlimited, which will\n    prevent GDB from inserting any line breaks.\n\nAs a result, the output may be too lengthy and will come in big lines.  Tweak\nthe support library to match the patterns line-by-line, which gives us more\ntime to match things. Also fix GDB's output to print one entry per line,\nregardless of the terminal width.\n\nA similar approach was used in another testcase using the same command (commit\neaeaf44cfdc9a4096a0dd52fa0606f29d4bfd48e). With the new line breaks, we don't\nneed a particular pattern, so clean up that test as well.\n\ngdb/ChangeLog:\n\n2021-04-27  Luis Machado  <luis.machado@linaro.org>\n\n\t* psymtab.c (psymbol_functions::dump): Output newline.\n\t* symmisc.c (dump_objfile): Likewise.\n\ngdb/testsuite/ChangeLog:\n\n2021-04-27  Luis Machado  <luis.machado@linaro.org>\n\n\t* gdb.base/maint.exp: Drop a pattern that is not needed.\n\t* lib/gdb.exp (readnow): Match line-by-line.",
    "tree": {
      "sha": "a631f7f6cfa087618bfa73126e24e59db68f63ce",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a631f7f6cfa087618bfa73126e24e59db68f63ce"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/b9f90c72ee69a31100a7b1b4106f192dde75debf",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b9f90c72ee69a31100a7b1b4106f192dde75debf",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/b9f90c72ee69a31100a7b1b4106f192dde75debf",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b9f90c72ee69a31100a7b1b4106f192dde75debf/comments",
  "author": {
    "login": "luislinaro",
    "id": 53092780,
    "node_id": "MDQ6VXNlcjUzMDkyNzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/53092780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luislinaro",
    "html_url": "https://github.com/luislinaro",
    "followers_url": "https://api.github.com/users/luislinaro/followers",
    "following_url": "https://api.github.com/users/luislinaro/following{/other_user}",
    "gists_url": "https://api.github.com/users/luislinaro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luislinaro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luislinaro/subscriptions",
    "organizations_url": "https://api.github.com/users/luislinaro/orgs",
    "repos_url": "https://api.github.com/users/luislinaro/repos",
    "events_url": "https://api.github.com/users/luislinaro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luislinaro/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "luislinaro",
    "id": 53092780,
    "node_id": "MDQ6VXNlcjUzMDkyNzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/53092780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luislinaro",
    "html_url": "https://github.com/luislinaro",
    "followers_url": "https://api.github.com/users/luislinaro/followers",
    "following_url": "https://api.github.com/users/luislinaro/following{/other_user}",
    "gists_url": "https://api.github.com/users/luislinaro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luislinaro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luislinaro/subscriptions",
    "organizations_url": "https://api.github.com/users/luislinaro/orgs",
    "repos_url": "https://api.github.com/users/luislinaro/repos",
    "events_url": "https://api.github.com/users/luislinaro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luislinaro/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "4b62a30d5b4dcb24e73c1369d8c0da3dc10a4146",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/4b62a30d5b4dcb24e73c1369d8c0da3dc10a4146",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/4b62a30d5b4dcb24e73c1369d8c0da3dc10a4146"
    }
  ],
  "stats": {
    "total": 41,
    "additions": 26,
    "deletions": 15
  },
  "files": [
    {
      "sha": "6d7b341dc22ea25cd04977aa28cebeac25999967",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=b9f90c72ee69a31100a7b1b4106f192dde75debf",
      "patch": "@@ -1,3 +1,9 @@\n+2021-04-27  Luis Machado  <luis.machado@linaro.org>\n+\n+\t* psymtab.c (psymbol_functions::dump): Output newline.\n+\tRemove wrap.\n+\t* symmisc.c (dump_objfile): Likewise.\n+\n 2021-04-27  Michael Weghorn  <m.weghorn@posteo.de>\n \t    Simon Marchi  <simon.marchi@polymtl.ca>\n "
    },
    {
      "sha": "fe32486e2fc54ca4073cac426fddac99d420b349",
      "filename": "gdb/psymtab.c",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/psymtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/psymtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/psymtab.c?ref=b9f90c72ee69a31100a7b1b4106f192dde75debf",
      "patch": "@@ -885,8 +885,7 @@ psymbol_functions::dump (struct objfile *objfile)\n \t  printf_filtered (\"%s at \",\n \t\t\t   psymtab->filename);\n \t  gdb_print_host_address (psymtab, gdb_stdout);\n-\t  printf_filtered (\", \");\n-\t  wrap_here (\"  \");\n+\t  printf_filtered (\"\\n\");\n \t}\n       printf_filtered (\"\\n\\n\");\n     }"
    },
    {
      "sha": "e38ceb6bda12e944e0ea8ca5665e21e2e7df4b7f",
      "filename": "gdb/symmisc.c",
      "status": "modified",
      "additions": 2,
      "deletions": 5,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/symmisc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/symmisc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symmisc.c?ref=b9f90c72ee69a31100a7b1b4106f192dde75debf",
      "patch": "@@ -131,12 +131,9 @@ dump_objfile (struct objfile *objfile)\n \t      printf_filtered (\"%s at \",\n \t\t\t       symtab_to_filename_for_display (symtab));\n \t      gdb_print_host_address (symtab, gdb_stdout);\n-\t      printf_filtered (\", \");\n \t      if (SYMTAB_OBJFILE (symtab) != objfile)\n-\t\t{\n-\t\t  printf_filtered (\"NOT ON CHAIN!  \");\n-\t\t}\n-\t      wrap_here (\"  \");\n+\t\tprintf_filtered (\", NOT ON CHAIN!\");\n+\t      printf_filtered (\"\\n\");\n \t    }\n \t}\n       printf_filtered (\"\\n\\n\");"
    },
    {
      "sha": "d4e02d1539f5584f743c93b58633e3bbc1677ace",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=b9f90c72ee69a31100a7b1b4106f192dde75debf",
      "patch": "@@ -1,3 +1,8 @@\n+2021-04-27  Luis Machado  <luis.machado@linaro.org>\n+\n+\t* gdb.base/maint.exp: Drop a pattern that is not needed.\n+\t* lib/gdb.exp (readnow): Match line-by-line.\n+\n 2021-04-27  Luis Machado  <luis.machado@linaro.org>\n \n \t* gdb.xml/tdesc-reload.exp: Pass -lbl."
    },
    {
      "sha": "6831d1ba72065ed717adc2e85dd2e4e125e1e430",
      "filename": "gdb/testsuite/gdb.base/maint.exp",
      "status": "modified",
      "additions": 0,
      "deletions": 3,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/testsuite/gdb.base/maint.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/testsuite/gdb.base/maint.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/maint.exp?ref=b9f90c72ee69a31100a7b1b4106f192dde75debf",
      "patch": "@@ -230,9 +230,6 @@ gdb_test_multiple \"maint print objfiles\" \"\" -lbl {\n \tset symtabs 1\n \texp_continue\n     }\n-    -re \" at $hex,\" {\n-\texp_continue\n-    }\n     -re -wrap \"\" {\n \tpass $gdb_test_name\n     }"
    },
    {
      "sha": "36a5fd4feb7cf9738db8daa7b30f550757bbf87c",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 12,
      "deletions": 5,
      "changes": 17,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/b9f90c72ee69a31100a7b1b4106f192dde75debf/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=b9f90c72ee69a31100a7b1b4106f192dde75debf",
      "patch": "@@ -7511,17 +7511,24 @@ proc readnow { args } {\n     } else {\n \tset re \"\"\n     }\n+\n+    set readnow_p 0\n+    # Given the listing from the following command can be very verbose, match\n+    # the patterns line-by-line.  This prevents timeouts from waiting for\n+    # too much data to come at once.\n     set cmd \"maint print objfiles $re\"\n-    gdb_test_multiple $cmd \"\" {\n-\t-re -wrap \"\\r\\n.gdb_index: faked for \\\"readnow\\\"\\r\\n.*\" {\n-\t    return 1\n+    gdb_test_multiple $cmd \"\" -lbl {\n+\t-re \"\\r\\n.gdb_index: faked for \\\"readnow\\\"\" {\n+\t    # Record the we've seen the above pattern.\n+\t    set readnow_p 1\n+\t    exp_continue\n \t}\n \t-re -wrap \"\" {\n-\t    return 0\n+\t    # We don't care about any other input.\n \t}\n     }\n \n-    return 0\n+    return $readnow_p\n }\n \n # Return 1 if partial symbols are available.  Otherwise, return 0."
    }
  ]
}