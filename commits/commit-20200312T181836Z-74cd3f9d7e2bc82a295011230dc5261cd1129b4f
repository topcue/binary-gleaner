{
  "sha": "74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzRjZDNmOWQ3ZTJiYzgyYTI5NTAxMTIzMGRjNTI2MWNkMTEyOWI0Zg==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-03-12T18:18:21Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-03-12T18:18:36Z"
    },
    "message": "Don't include selftests objects in build when unit tests are disabled\n\nWhile working on the preceding selftests patches, I noticed that some\nselftests-specific files are included in the build even when selftests\nare disabled, namely disasm-selftest.c and gdbarch-selftests.c.  These\nfiles are entirely #if'ed out when building with selftests disabled.\n\nThis is not a huge problem, but I think it would make more sense if\nthese files were simply not built.\n\nWith this patch, I propose to put all the selftests-specific source\nfiles into a SELFTESTS_SRCS Makefile variable (even selftest-arch.c,\nwhich is currently added by the configure script).\n\ngdb/ChangeLog:\n\n\t* Makefile.in (SUBDIR_UNITTESTS_SRCS): Rename to...\n\t(SELFTESTS_SRCS): ... this.  Add disasm-selftests.c,\n\tgdbarch-selfselftests.c and selftest-arch.c.\n\t(SUBDIR_UNITTESTS_OBS): Rename to...\n\t(SELFTESTS_OBS): ... this.\n\t(COMMON_SFILES): Remove disasm-selftests.c and\n\tgdbarch-selftests.c.\n\t* configure.ac: Don't add selftest-arch.{c,o} to\n\tCONFIG_{SRCS,OBS}.\n\t* disasm-selftests.c, gdbarch-selftests.c: Remove GDB_SELF_TEST\n\tpreprocessor conditions.",
    "tree": {
      "sha": "5dcac5dfb53824783d1ec65828c90e3197c2bbd2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5dcac5dfb53824783d1ec65828c90e3197c2bbd2"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "db6878ac5538661c8d66c916a533bd4268217fcb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/db6878ac5538661c8d66c916a533bd4268217fcb",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/db6878ac5538661c8d66c916a533bd4268217fcb"
    }
  ],
  "stats": {
    "total": 40,
    "additions": 23,
    "deletions": 17
  },
  "files": [
    {
      "sha": "c592b5614232b4a2140f3c44c4919fd3d7d1530f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
      "patch": "@@ -1,3 +1,17 @@\n+2020-03-12  Simon Marchi  <simon.marchi@efficios.com>\n+\n+\t* Makefile.in (SUBDIR_UNITTESTS_SRCS): Rename to...\n+\t(SELFTESTS_SRCS): ... this.  Add disasm-selftests.c,\n+\tgdbarch-selfselftests.c and selftest-arch.c.\n+\t(SUBDIR_UNITTESTS_OBS): Rename to...\n+\t(SELFTESTS_OBS): ... this.\n+\t(COMMON_SFILES): Remove disasm-selftests.c and\n+\tgdbarch-selftests.c.\n+\t* configure.ac: Don't add selftest-arch.{c,o} to\n+\tCONFIG_{SRCS,OBS}.\n+\t* disasm-selftests.c, gdbarch-selftests.c: Remove GDB_SELF_TEST\n+\tpreprocessor conditions.\n+\n 2020-03-12  Simon Marchi  <simon.marchi@efficios.com>\n \n \t* configure.ac: Don't source bfd/development.sh."
    },
    {
      "sha": "1db02c07ac280f18a9bfab2f7b5bc2cdadc13cc3",
      "filename": "gdb/Makefile.in",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/Makefile.in?ref=74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
      "patch": "@@ -420,7 +420,10 @@ SUBDIR_PYTHON_DEPS =\n SUBDIR_PYTHON_LDFLAGS =\n SUBDIR_PYTHON_CFLAGS =\n \n-SUBDIR_UNITTESTS_SRCS = \\\n+SELFTESTS_SRCS = \\\n+\tdisasm-selftests.c \\\n+\tgdbarch-selftests.c \\\n+\tselftest-arch.c \\\n \tunittests/array-view-selftests.c \\\n \tunittests/child-path-selftests.c \\\n \tunittests/cli-utils-selftests.c \\\n@@ -454,7 +457,7 @@ SUBDIR_UNITTESTS_SRCS = \\\n \tunittests/vec-utils-selftests.c \\\n \tunittests/xml-utils-selftests.c\n \n-SUBDIR_UNITTESTS_OBS = $(patsubst %.c,%.o,$(SUBDIR_UNITTESTS_SRCS))\n+SELFTESTS_OBS = $(patsubst %.c,%.o,$(SELFTESTS_SRCS))\n \n SUBDIR_TARGET_SRCS = target/waitstatus.c\n SUBDIR_TARGET_OBS = $(patsubst %.c,%.o,$(SUBDIR_TARGET_SRCS))\n@@ -995,7 +998,6 @@ COMMON_SFILES = \\\n \tdebuginfod-support.c \\\n \tdictionary.c \\\n \tdisasm.c \\\n-\tdisasm-selftests.c \\\n \tdummy-frame.c \\\n \tdwarf2/abbrev.c \\\n \tdwarf2/attribute.c \\\n@@ -1034,7 +1036,6 @@ COMMON_SFILES = \\\n \tgdb_obstack.c \\\n \tgdb_regex.c \\\n \tgdbarch.c \\\n-\tgdbarch-selftests.c \\\n \tgdbtypes.c \\\n \tgnu-v2-abi.c \\\n \tgnu-v3-abi.c \\"
    },
    {
      "sha": "614f3402c3d681967311c8c5bcfaa834753e0b06",
      "filename": "gdb/configure",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/configure",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/configure",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure?ref=74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
      "patch": "@@ -19210,8 +19210,8 @@ if $enable_unittests; then\n $as_echo \"#define GDB_SELF_TEST 1\" >>confdefs.h\n \n \n-  CONFIG_OBS=\"$CONFIG_OBS \\$(SUBDIR_UNITTESTS_OBS) selftest-arch.o\"\n-  CONFIG_SRCS=\"$CONFIG_SRCS \\$(SUBDIR_UNITTESTS_SRCS) selftest-arch.c\"\n+  CONFIG_OBS=\"$CONFIG_OBS \\$(SELFTESTS_OBS)\"\n+  CONFIG_SRCS=\"$CONFIG_SRCS \\$(SELFTESTS_SRCS)\"\n \n fi\n "
    },
    {
      "sha": "b9dbe13232a1bb0916b4787ed3c6d5d78799f91b",
      "filename": "gdb/configure.ac",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/configure.ac",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/configure.ac",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/configure.ac?ref=74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
      "patch": "@@ -2124,8 +2124,8 @@ AC_DEFINE(GDB_DEFAULT_HOST_CHARSET, \"UTF-8\",\n           [Define to be a string naming the default host character set.])\n \n GDB_AC_SELFTEST([\n-  CONFIG_OBS=\"$CONFIG_OBS \\$(SUBDIR_UNITTESTS_OBS) selftest-arch.o\"\n-  CONFIG_SRCS=\"$CONFIG_SRCS \\$(SUBDIR_UNITTESTS_SRCS) selftest-arch.c\"\n+  CONFIG_OBS=\"$CONFIG_OBS \\$(SELFTESTS_OBS)\"\n+  CONFIG_SRCS=\"$CONFIG_SRCS \\$(SELFTESTS_SRCS)\"\n ])\n \n GDB_AC_TRANSFORM([gdb], [GDB_TRANSFORM_NAME])"
    },
    {
      "sha": "a24db7f224ff983fa3cc0746e547043243e7ee40",
      "filename": "gdb/disasm-selftests.c",
      "status": "modified",
      "additions": 0,
      "deletions": 5,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/disasm-selftests.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/disasm-selftests.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/disasm-selftests.c?ref=74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
      "patch": "@@ -19,8 +19,6 @@\n \n #include \"defs.h\"\n #include \"disasm.h\"\n-\n-#if GDB_SELF_TEST\n #include \"gdbsupport/selftest.h\"\n #include \"selftest-arch.h\"\n #include \"gdbarch.h\"\n@@ -208,16 +206,13 @@ memory_error_test (struct gdbarch *gdbarch)\n }\n \n } // namespace selftests\n-#endif /* GDB_SELF_TEST */\n \n void _initialize_disasm_selftests ();\n void\n _initialize_disasm_selftests ()\n {\n-#if GDB_SELF_TEST\n   selftests::register_test_foreach_arch (\"print_one_insn\",\n \t\t\t\t\t selftests::print_one_insn_test);\n   selftests::register_test_foreach_arch (\"memory_error\",\n \t\t\t\t\t selftests::memory_error_test);\n-#endif\n }"
    },
    {
      "sha": "787a3f40589fc1bb9bac4feefe3010f839daa199",
      "filename": "gdb/gdbarch-selftests.c",
      "status": "modified",
      "additions": 0,
      "deletions": 4,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/gdbarch-selftests.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/74cd3f9d7e2bc82a295011230dc5261cd1129b4f/gdb/gdbarch-selftests.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbarch-selftests.c?ref=74cd3f9d7e2bc82a295011230dc5261cd1129b4f",
      "patch": "@@ -18,7 +18,6 @@\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.  */\n \n #include \"defs.h\"\n-#if GDB_SELF_TEST\n #include \"gdbsupport/selftest.h\"\n #include \"selftest-arch.h\"\n #include \"inferior.h\"\n@@ -158,14 +157,11 @@ register_to_value_test (struct gdbarch *gdbarch)\n }\n \n } // namespace selftests\n-#endif /* GDB_SELF_TEST */\n \n void _initialize_gdbarch_selftests ();\n void\n _initialize_gdbarch_selftests ()\n {\n-#if GDB_SELF_TEST\n   selftests::register_test_foreach_arch (\"register_to_value\",\n \t\t\t\t\t selftests::register_to_value_test);\n-#endif\n }"
    }
  ]
}