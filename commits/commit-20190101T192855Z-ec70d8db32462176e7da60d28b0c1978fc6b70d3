{
  "sha": "ec70d8db32462176e7da60d28b0c1978fc6b70d3",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6ZWM3MGQ4ZGIzMjQ2MjE3NmU3ZGE2MGQyOGIwYzE5NzhmYzZiNzBkMw==",
  "commit": {
    "author": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-01-01T13:12:30Z"
    },
    "committer": {
      "name": "Philippe Waroquiers",
      "email": "philippe.waroquiers@skynet.be",
      "date": "2019-01-01T19:28:55Z"
    },
    "message": "Fix leak in record-full.c\n\nvalgrind detects leaks in several gdb.reverse tests,\nsuch as the below in gdb.reverse/watch-precsave.exp.\n\nFix the leak by rewriting the loop that frees\nrecord_full_core_buf_list.\n\ngdb/ChangeLog\n2019-01-01  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n\n\t* record-full.c (record_full_base_target::close): Rewrite\n\trecord_full_core_buf_list free logic.\n\n==18847== VALGRIND_GDB_ERROR_BEGIN\n==18847== 4,120 (24 direct, 4,096 indirect) bytes in 1 blocks are definitely lost in loss record 3,094 of 3,199\n==18847==    at 0x4C2BE6D: malloc (vg_replace_malloc.c:309)\n==18847==    by 0x405097: xmalloc (common-utils.c:44)\n==18847==    by 0x5AF8EA: xnew<record_full_core_buf_entry> (poison.h:110)\n==18847==    by 0x5AF8EA: record_full_core_target::xfer_partial(target_object, char const*, unsigned char*, unsigned char const*, unsigned long, unsigned long, unsigned long*) (record-full.c:2182)\n==18847==    by 0x64677D: raw_memory_xfer_partial(target_ops*, unsigned char*, unsigned char const*, unsigned long, long, unsigned long*) (target.c:956)\n==18847==    by 0x64691E: memory_xfer_partial_1(target_ops*, target_object, unsigned char*, unsigned char const*, unsigned long, unsigned long, unsigned long*) (target.c:1086)",
    "tree": {
      "sha": "a184ba43e15f764b3a12e76646b6932871697ab9",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a184ba43e15f764b3a12e76646b6932871697ab9"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ec70d8db32462176e7da60d28b0c1978fc6b70d3",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ec70d8db32462176e7da60d28b0c1978fc6b70d3",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ec70d8db32462176e7da60d28b0c1978fc6b70d3",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ec70d8db32462176e7da60d28b0c1978fc6b70d3/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "5b38f9c16e5b3f5f4b5d7772bfef59b1c97e2d05",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/5b38f9c16e5b3f5f4b5d7772bfef59b1c97e2d05",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/5b38f9c16e5b3f5f4b5d7772bfef59b1c97e2d05"
    }
  ],
  "stats": {
    "total": 17,
    "additions": 9,
    "deletions": 8
  },
  "files": [
    {
      "sha": "a2d36017b0997771059c16cf81e3e4f987389143",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ec70d8db32462176e7da60d28b0c1978fc6b70d3/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ec70d8db32462176e7da60d28b0c1978fc6b70d3/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=ec70d8db32462176e7da60d28b0c1978fc6b70d3",
      "patch": "@@ -1,3 +1,8 @@\n+2019-01-01  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n+\n+\t* record-full.c (record_full_base_target::close): Rewrite\n+\trecord_full_core_buf_list free logic.\n+\n 2019-01-01  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n \n \t* break-catch-syscall.c (print_one_catch_syscall): xfree"
    },
    {
      "sha": "8738512f288aee3c9e923f860605d2ebd66c5e60",
      "filename": "gdb/record-full.c",
      "status": "modified",
      "additions": 4,
      "deletions": 8,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ec70d8db32462176e7da60d28b0c1978fc6b70d3/gdb/record-full.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ec70d8db32462176e7da60d28b0c1978fc6b70d3/gdb/record-full.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/record-full.c?ref=ec70d8db32462176e7da60d28b0c1978fc6b70d3",
      "patch": "@@ -1014,15 +1014,11 @@ record_full_base_target::close ()\n     }\n \n   /* Release record_full_core_buf_list.  */\n-  if (record_full_core_buf_list)\n+  while (record_full_core_buf_list)\n     {\n-      for (entry = record_full_core_buf_list->prev; entry;\n-\t   entry = entry->prev)\n-\t{\n-\t  xfree (record_full_core_buf_list);\n-\t  record_full_core_buf_list = entry;\n-\t}\n-      record_full_core_buf_list = NULL;\n+      entry = record_full_core_buf_list;\n+      record_full_core_buf_list = record_full_core_buf_list->prev;\n+      xfree (entry);\n     }\n \n   if (record_full_async_inferior_event_token)"
    }
  ]
}