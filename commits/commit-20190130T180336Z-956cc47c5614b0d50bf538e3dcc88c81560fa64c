{
  "sha": "956cc47c5614b0d50bf538e3dcc88c81560fa64c",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6OTU2Y2M0N2M1NjE0YjBkNTBiZjUzOGUzZGNjODhjODE1NjBmYTY0Yw==",
  "commit": {
    "author": {
      "name": "Szabolcs Nagy",
      "email": "szabolcs.nagy@arm.com",
      "date": "2018-12-14T14:02:54Z"
    },
    "committer": {
      "name": "Szabolcs Nagy",
      "email": "szabolcs.nagy@arm.com",
      "date": "2019-01-30T18:03:36Z"
    },
    "message": "[PR gdb/23985] Fix libinproctrace.so build\n\nThe IPA objects currently may use gnulib replacement apis, which is\nwrong: gnulib is not linked into the produced dso and it cannot be\nbecause it is not built with -fPIC -fvisibility=hidden.\n\nThe gnulib replacement detection is broken under cross compilation:\nfor targets other than *-gnu*, replacements are enabled that depend\non execution time detection. This causes unnecessary build failure\nwhen the target has proper support for the replaced api.\n\nThis fix tries to undo the replacements, which is tricky because the\ngnulib headers are still used for various compile time fixups and\nthere is no simple knob in gnulib to only turn the replacements off.\n\nWithout this workaround gdb fails to cross build to non-gnu targets:\n\n  ld: tracepoint-ipa.o: in function `gdb_agent_helper_thread(void*)':\n  gdb/gdbserver/tracepoint.c:7221: undefined reference to `rpl_strerror'\n  ...\n  Makefile:434: recipe for target 'libinproctrace.so' failed\n\ngdb/gdbserver/ChangeLog:\n\n\tPR gdb/23985\n\t* Makefile.in (IPAGENT_CFLAGS): Add UNDO_GNULIB_CFLAGS.\n\t(UNDO_GNULIB_CFLAGS): Undo gnulib replacements.",
    "tree": {
      "sha": "3b4cbf2ed6892542e1ee4e9c2b35b0fddeee1412",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/3b4cbf2ed6892542e1ee4e9c2b35b0fddeee1412"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/956cc47c5614b0d50bf538e3dcc88c81560fa64c",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/956cc47c5614b0d50bf538e3dcc88c81560fa64c",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/956cc47c5614b0d50bf538e3dcc88c81560fa64c",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/956cc47c5614b0d50bf538e3dcc88c81560fa64c/comments",
  "author": {
    "login": "nsz-arm",
    "id": 30925343,
    "node_id": "MDQ6VXNlcjMwOTI1MzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nsz-arm",
    "html_url": "https://github.com/nsz-arm",
    "followers_url": "https://api.github.com/users/nsz-arm/followers",
    "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/nsz-arm/orgs",
    "repos_url": "https://api.github.com/users/nsz-arm/repos",
    "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nsz-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "nsz-arm",
    "id": 30925343,
    "node_id": "MDQ6VXNlcjMwOTI1MzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/30925343?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nsz-arm",
    "html_url": "https://github.com/nsz-arm",
    "followers_url": "https://api.github.com/users/nsz-arm/followers",
    "following_url": "https://api.github.com/users/nsz-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/nsz-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nsz-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nsz-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/nsz-arm/orgs",
    "repos_url": "https://api.github.com/users/nsz-arm/repos",
    "events_url": "https://api.github.com/users/nsz-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nsz-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b5eba2d8c050b39943918057283470959a5d18c3",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b5eba2d8c050b39943918057283470959a5d18c3",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b5eba2d8c050b39943918057283470959a5d18c3"
    }
  ],
  "stats": {
    "total": 12,
    "additions": 12,
    "deletions": 0
  },
  "files": [
    {
      "sha": "be9a26302b2bc42140dfa8170ad4103565e3b8dd",
      "filename": "gdb/gdbserver/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/956cc47c5614b0d50bf538e3dcc88c81560fa64c/gdb/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/956cc47c5614b0d50bf538e3dcc88c81560fa64c/gdb/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/ChangeLog?ref=956cc47c5614b0d50bf538e3dcc88c81560fa64c",
      "patch": "@@ -1,3 +1,9 @@\n+2018-01-30  Szabolcs Nagy  <szabolcs.nagy@arm.com>\n+\n+\tPR gdb/23985\n+\t* Makefile.in (IPAGENT_CFLAGS): Add UNDO_GNULIB_CFLAGS.\n+\t(UNDO_GNULIB_CFLAGS): Undo gnulib replacements.\n+\n 2019-01-25  Tom Tromey  <tom@tromey.com>\n \n \t* Makefile.in (INCLUDE_CFLAGS): Don't add -I for common."
    },
    {
      "sha": "f5fc55034ee9bb66018a9478e594f6f43cd0feba",
      "filename": "gdb/gdbserver/Makefile.in",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/956cc47c5614b0d50bf538e3dcc88c81560fa64c/gdb/gdbserver/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/956cc47c5614b0d50bf538e3dcc88c81560fa64c/gdb/gdbserver/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbserver/Makefile.in?ref=956cc47c5614b0d50bf538e3dcc88c81560fa64c",
      "patch": "@@ -544,9 +544,15 @@ regdat_sh = $(srcdir)/../regformats/regdat.sh\n \n UST_CFLAGS = $(ustinc) -DCONFIG_UST_GDB_INTEGRATION\n \n+# Undo gnulib replacements for the IPA shared library build.\n+# The gnulib headers are still needed, but gnulib is not linked\n+# into the IPA lib so replacement apis don't work.\n+UNDO_GNULIB_CFLAGS = -Drpl_strerror=strerror\n+\n # Note, we only build the IPA if -fvisibility=hidden is supported in\n # the first place.\n IPAGENT_CFLAGS = $(INTERNAL_CFLAGS) $(UST_CFLAGS) \\\n+\t$(UNDO_GNULIB_CFLAGS) \\\n \t-fPIC -DIN_PROCESS_AGENT \\\n \t-fvisibility=hidden\n "
    }
  ]
}