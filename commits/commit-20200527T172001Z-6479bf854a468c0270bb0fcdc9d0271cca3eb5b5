{
  "sha": "6479bf854a468c0270bb0fcdc9d0271cca3eb5b5",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NjQ3OWJmODU0YTQ2OGMwMjcwYmIwZmNkYzlkMDI3MWNjYTNlYjViNQ==",
  "commit": {
    "author": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-05-24T22:18:25Z"
    },
    "committer": {
      "name": "Hannes Domani",
      "email": "ssbssa@yahoo.de",
      "date": "2020-05-27T17:20:01Z"
    },
    "message": "Don't close process handle provided by WaitForDebugEvent\n\nOnly the process handle returned by OpenProcess or CreateProcess needs to\nbe closed, the one provided by WaitForDebugEvent is closed automatically.\n\ngdbserver/ChangeLog:\n\n2020-05-27  Hannes Domani  <ssbssa@yahoo.de>\n\n\t* win32-low.cc (do_initial_child_stuff): Set open_process_used.\n\t(win32_clear_inferiors): Use open_process_used.\n\t(get_child_debug_event): Likewise.",
    "tree": {
      "sha": "653c599a9ba675c34edcc46c90fdc8cdd97ada4e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/653c599a9ba675c34edcc46c90fdc8cdd97ada4e"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5/comments",
  "author": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "ssbssa",
    "id": 40947,
    "node_id": "MDQ6VXNlcjQwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ssbssa",
    "html_url": "https://github.com/ssbssa",
    "followers_url": "https://api.github.com/users/ssbssa/followers",
    "following_url": "https://api.github.com/users/ssbssa/following{/other_user}",
    "gists_url": "https://api.github.com/users/ssbssa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ssbssa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ssbssa/subscriptions",
    "organizations_url": "https://api.github.com/users/ssbssa/orgs",
    "repos_url": "https://api.github.com/users/ssbssa/repos",
    "events_url": "https://api.github.com/users/ssbssa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ssbssa/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ac637ec30dd9a3b19a02d1967a80e4ddf739706e",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ac637ec30dd9a3b19a02d1967a80e4ddf739706e",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ac637ec30dd9a3b19a02d1967a80e4ddf739706e"
    }
  ],
  "stats": {
    "total": 25,
    "additions": 21,
    "deletions": 4
  },
  "files": [
    {
      "sha": "678689530faff75d0722943f00787e7f5acd7d73",
      "filename": "gdbserver/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/ChangeLog?ref=6479bf854a468c0270bb0fcdc9d0271cca3eb5b5",
      "patch": "@@ -1,3 +1,9 @@\n+2020-05-27  Hannes Domani  <ssbssa@yahoo.de>\n+\n+\t* win32-low.cc (do_initial_child_stuff): Set open_process_used.\n+\t(win32_clear_inferiors): Use open_process_used.\n+\t(get_child_debug_event): Likewise.\n+\n 2020-05-25  Michael Weghorn  <m.weghorn@posteo.de>\n \n \tPR gdbserver/25893"
    },
    {
      "sha": "a42fe25a2205a21f570fd80e07b887797f116669",
      "filename": "gdbserver/win32-low.cc",
      "status": "modified",
      "additions": 15,
      "deletions": 4,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5/gdbserver/win32-low.cc",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/6479bf854a468c0270bb0fcdc9d0271cca3eb5b5/gdbserver/win32-low.cc",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/win32-low.cc?ref=6479bf854a468c0270bb0fcdc9d0271cca3eb5b5",
      "patch": "@@ -88,6 +88,9 @@ static int soft_interrupt_requested = 0;\n    by suspending all the threads.  */\n static int faked_breakpoint = 0;\n \n+/* True if current_process_handle needs to be closed.  */\n+static bool open_process_used = false;\n+\n #ifdef __x86_64__\n bool wow64_process = false;\n #endif\n@@ -383,6 +386,7 @@ do_initial_child_stuff (HANDLE proch, DWORD pid, int attached)\n \n   soft_interrupt_requested = 0;\n   faked_breakpoint = 0;\n+  open_process_used = true;\n \n   memset (&current_event, 0, sizeof (current_event));\n \n@@ -859,8 +863,11 @@ windows_nat::handle_output_debug_string (struct target_waitstatus *ourstatus)\n static void\n win32_clear_inferiors (void)\n {\n-  if (current_process_handle != NULL)\n-    CloseHandle (current_process_handle);\n+  if (open_process_used)\n+    {\n+      CloseHandle (current_process_handle);\n+      open_process_used = false;\n+    }\n \n   for_each_thread (delete_thread_info);\n   siginfo_er.ExceptionCode = 0;\n@@ -1513,6 +1520,12 @@ get_child_debug_event (DWORD *continue_status,\n \t\t(unsigned) current_event.dwThreadId));\n       CloseHandle (current_event.u.CreateProcessInfo.hFile);\n \n+      if (open_process_used)\n+\t{\n+\t  CloseHandle (current_process_handle);\n+\t  open_process_used = false;\n+\t}\n+\n       current_process_handle = current_event.u.CreateProcessInfo.hProcess;\n       main_thread_id = current_event.dwThreadId;\n \n@@ -1560,8 +1573,6 @@ get_child_debug_event (DWORD *continue_status,\n \t  }\n       }\n       child_continue (DBG_CONTINUE, desired_stop_thread_id);\n-      CloseHandle (current_process_handle);\n-      current_process_handle = NULL;\n       break;\n \n     case LOAD_DLL_DEBUG_EVENT:"
    }
  ]
}