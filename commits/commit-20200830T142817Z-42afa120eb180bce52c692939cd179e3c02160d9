{
  "sha": "42afa120eb180bce52c692939cd179e3c02160d9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NDJhZmExMjBlYjE4MGJjZTUyYzY5MjkzOWNkMTc5ZTNjMDIxNjBkOQ==",
  "commit": {
    "author": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-08-30T14:27:02Z"
    },
    "committer": {
      "name": "H.J. Lu",
      "email": "hjl.tools@gmail.com",
      "date": "2020-08-30T14:28:17Z"
    },
    "message": "ld: Add $NOSANTIZE_CFLAGS to more linker tests\n\n\t* testsuite/ld-elf/dwarf.exp: Append $NOSANTIZE_CFLAGS to CFLAGS.\n\t* testsuite/ld-elf/shared.exp: Likewise.\n\t* testsuite/ld-elfvsb/elfvsb.exp: Likewise.\n\t* testsuite/ld-shared/shared.exp: Likewise.\n\t* testsuite/ld-size/size.exp: Likewise.",
    "tree": {
      "sha": "55f0aacbec693d08a5517f8f1529b51c232c6b2d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/55f0aacbec693d08a5517f8f1529b51c232c6b2d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/42afa120eb180bce52c692939cd179e3c02160d9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/42afa120eb180bce52c692939cd179e3c02160d9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/42afa120eb180bce52c692939cd179e3c02160d9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/42afa120eb180bce52c692939cd179e3c02160d9/comments",
  "author": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "hjl-tools",
    "id": 1072356,
    "node_id": "MDQ6VXNlcjEwNzIzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1072356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hjl-tools",
    "html_url": "https://github.com/hjl-tools",
    "followers_url": "https://api.github.com/users/hjl-tools/followers",
    "following_url": "https://api.github.com/users/hjl-tools/following{/other_user}",
    "gists_url": "https://api.github.com/users/hjl-tools/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hjl-tools/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hjl-tools/subscriptions",
    "organizations_url": "https://api.github.com/users/hjl-tools/orgs",
    "repos_url": "https://api.github.com/users/hjl-tools/repos",
    "events_url": "https://api.github.com/users/hjl-tools/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hjl-tools/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "d0ed6fddfac5c54c50fa17f960d51efc0f111cae",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/d0ed6fddfac5c54c50fa17f960d51efc0f111cae",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/d0ed6fddfac5c54c50fa17f960d51efc0f111cae"
    }
  ],
  "stats": {
    "total": 42,
    "additions": 33,
    "deletions": 9
  },
  "files": [
    {
      "sha": "0138e88db0adb99eabe2f9b251f337851d2023d1",
      "filename": "ld/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/42afa120eb180bce52c692939cd179e3c02160d9/ld/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/42afa120eb180bce52c692939cd179e3c02160d9/ld/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/ChangeLog?ref=42afa120eb180bce52c692939cd179e3c02160d9",
      "patch": "@@ -1,3 +1,11 @@\n+2020-08-30  H.J. Lu  <hongjiu.lu@intel.com>\n+\n+\t* testsuite/ld-elf/dwarf.exp: Append $NOSANTIZE_CFLAGS to CFLAGS.\n+\t* testsuite/ld-elf/shared.exp: Likewise.\n+\t* testsuite/ld-elfvsb/elfvsb.exp: Likewise.\n+\t* testsuite/ld-shared/shared.exp: Likewise.\n+\t* testsuite/ld-size/size.exp: Likewise.\n+\n 2020-08-28  Jozef Lawrynowicz  <jozef.l@mittosystems.com>\n \n \t* emultempl/msp430.em (input_section_exists): New."
    },
    {
      "sha": "93fd21d8f3523d4e5443a4a9ca1f9b267ff52bbf",
      "filename": "ld/testsuite/ld-elf/dwarf.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-elf/dwarf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-elf/dwarf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/dwarf.exp?ref=42afa120eb180bce52c692939cd179e3c02160d9",
      "patch": "@@ -68,8 +68,12 @@ set run_tests {\n      \"-g -feliminate-dwarf2-dups\"}\n }\n \n+# Disable all sanitizers.\n+set old_CFLAGS \"$CFLAGS\"\n+append CFLAGS \" $NOSANTIZE_CFLAGS\"\n run_cc_link_tests $build_tests\n run_ld_link_exec_tests $run_tests\n+set CFLAGS \"$old_CFLAGS\"\n \n proc strip_test {} {\n     global ld"
    },
    {
      "sha": "fb04cc3ac89f289be37ed0358a196fc5380a7d1a",
      "filename": "ld/testsuite/ld-elf/shared.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-elf/shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-elf/shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elf/shared.exp?ref=42afa120eb180bce52c692939cd179e3c02160d9",
      "patch": "@@ -1102,7 +1102,11 @@ set dlopen_run_tests [list \\\n if [check_libdl_available] {\n   # XFAIL on NetBSD ELF systems as they do not currently support the .*_array\n   # sections.\n+  # Disable all sanitizers.\n+  set old_CFLAGS \"$CFLAGS\"\n+  append CFLAGS \" $NOSANTIZE_CFLAGS\"\n   run_ld_link_exec_tests $dlopen_run_tests \"*-*-netbsdelf*\"\n+  set CFLAGS \"$old_CFLAGS\"\n }\n \n # Check --no-add-needed and --no-copy-dt-needed-entries"
    },
    {
      "sha": "673e0a01557106a9961f5e5210976238529000eb",
      "filename": "ld/testsuite/ld-elfvsb/elfvsb.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-elfvsb/elfvsb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-elfvsb/elfvsb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-elfvsb/elfvsb.exp?ref=42afa120eb180bce52c692939cd179e3c02160d9",
      "patch": "@@ -197,6 +197,7 @@ proc visibility_run {visibility} {\n     global PLT_CFLAGS\n     global NOPIE_CFLAGS\n     global COMPRESS_LDFLAG\n+    global NOSANTIZE_CFLAGS\n \n     if [ string match $visibility \"hidden\" ] {\n \tset VSBCFLAG \"-DHIDDEN_TEST\"\n@@ -235,7 +236,7 @@ proc visibility_run {visibility} {\n     } else {\n     # Compile the main program.  Make sure that PLT is used since PLT\n     # is expected.\n-    if ![ld_compile \"$CC -g $PLT_CFLAGS $CFLAGS $SHCFLAG $VSBCFLAG\" $srcdir/$subdir/main.c $tmpdir/mainnp.o] {\n+    if ![ld_compile \"$CC -g $PLT_CFLAGS $CFLAGS $SHCFLAG $VSBCFLAG $NOSANTIZE_CFLAGS\" $srcdir/$subdir/main.c $tmpdir/mainnp.o] {\n \tunresolved \"visibility ($visibility) (non PIC)\"\n \tunresolved \"visibility ($visibility)\"\n     } else {\n@@ -245,8 +246,8 @@ proc visibility_run {visibility} {\n \t# will need to do more relocation work.  However, note that not\n \t# using -fpic will cause some of the tests to return different\n \t# results.  Make sure that PLT is used since PLT is expected.\n-\tif { ![ld_compile \"$CC -g $NOPIE_CFLAGS $PLT_CFLAGS $CFLAGS $SHCFLAG $VSBCFLAG\" $srcdir/$subdir/sh1.c $tmpdir/sh1np.o]\n-\t     || ![ld_compile \"$CC -g $NOPIE_CFLAGS $PLT_CFLAGS $CFLAGS $SHCFLAG $VSBCFLAG\" $srcdir/$subdir/sh2.c $tmpdir/sh2np.o] } {\n+\tif { ![ld_compile \"$CC -g $NOPIE_CFLAGS $PLT_CFLAGS $CFLAGS $SHCFLAG $VSBCFLAG $NOSANTIZE_CFLAGS\" $srcdir/$subdir/sh1.c $tmpdir/sh1np.o]\n+\t     || ![ld_compile \"$CC -g $NOPIE_CFLAGS $PLT_CFLAGS $CFLAGS $SHCFLAG $VSBCFLAG $NOSANTIZE_CFLAGS\" $srcdir/$subdir/sh2.c $tmpdir/sh2np.o] } {\n \t    unresolved \"visibility ($visibility) (non PIC)\"\n \t} else {\n \t    # SunOS non PIC shared libraries don't permit some cases of\n@@ -334,8 +335,8 @@ proc visibility_run {visibility} {\n \n \t# Now compile the code using -fpic.\n \n-\tif { ![ld_compile \"$CC -g $CFLAGS $SHCFLAG $VSBCFLAG -DSHARED $picflag\" $srcdir/$subdir/sh1.c $tmpdir/sh1p.o]\n-\t    || ![ld_compile \"$CC -g $CFLAGS $SHCFLAG $VSBCFLAG -DSHARED $picflag\" $srcdir/$subdir/sh2.c $tmpdir/sh2p.o] } {\n+\tif { ![ld_compile \"$CC -g $CFLAGS $SHCFLAG $VSBCFLAG $NOSANTIZE_CFLAGS -DSHARED $picflag\" $srcdir/$subdir/sh1.c $tmpdir/sh1p.o]\n+\t    || ![ld_compile \"$CC -g $CFLAGS $SHCFLAG $VSBCFLAG $NOSANTIZE_CFLAGS -DSHARED $picflag\" $srcdir/$subdir/sh2.c $tmpdir/sh2p.o] } {\n \t    unresolved \"visibility ($visibility)\"\n \t} else {\n \t    if { [ string match $visibility \"protected\" ]\n@@ -352,7 +353,7 @@ proc visibility_run {visibility} {\n \t# Don't bother.\n     } else {\n     # Now do the same tests again, but this time compile main.c PIC.\n-    if ![ld_compile \"$CC -g $CFLAGS $SHCFLAG $VSBCFLAG -DSHARED $picflag\" $srcdir/$subdir/main.c $tmpdir/mainp.o] {\n+    if ![ld_compile \"$CC -g $CFLAGS $SHCFLAG $VSBCFLAG $NOSANTIZE_CFLAGS -DSHARED $picflag\" $srcdir/$subdir/main.c $tmpdir/mainp.o] {\n \tunresolved \"visibility ($visibility) (PIC main, non PIC so)\"\n \tunresolved \"visibility ($visibility) (PIC main)\"\n     } else {"
    },
    {
      "sha": "eb346e9c6ada8101279b026f345623a7ea3db748",
      "filename": "ld/testsuite/ld-shared/shared.exp",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-shared/shared.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-shared/shared.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-shared/shared.exp?ref=42afa120eb180bce52c692939cd179e3c02160d9",
      "patch": "@@ -65,6 +65,10 @@ set tmpdir tmpdir\n set SHCFLAG \"\"\n set shared_needs_pic \"no\"\n \n+# Disable all sanitizers.\n+set old_CFLAGS \"$CFLAGS\"\n+append CFLAGS \" $NOSANTIZE_CFLAGS\"\n+\n if { [istarget rs6000*-*-aix*] || [istarget powerpc*-*-aix*] } {\n \n     # AIX shared libraries do not seem to support useful features,\n@@ -343,6 +347,8 @@ if ![ld_compile \"$CC $CFLAGS $SHCFLAG $picflag\" $srcdir/$subdir/main.c $tmpdir/m\n     }\n }\n \n+set CFLAGS \"$old_CFLAGS\"\n+\n if { [istarget rs6000*-*-aix*] || [istarget powerpc*-*-aix*] } {\n     # Remove the temporary directory.\n     catch \"exec rm -rf $tmpdir\" exec_status"
    },
    {
      "sha": "40d8cda90c786dbe2f0edea8bae1780dc594c701",
      "filename": "ld/testsuite/ld-size/size.exp",
      "status": "modified",
      "additions": 4,
      "deletions": 3,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-size/size.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/42afa120eb180bce52c692939cd179e3c02160d9/ld/testsuite/ld-size/size.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/ld/testsuite/ld-size/size.exp?ref=42afa120eb180bce52c692939cd179e3c02160d9",
      "patch": "@@ -134,8 +134,8 @@ run_cc_link_tests [list \\\n     ] \\\n     [list \\\n \t\"Build libsize-9.so\" \\\n-\t\"-shared\" \\\n-\t\"-fPIC\" \\\n+\t\"-shared $NOSANTIZE_CFLAGS\" \\\n+\t\"-fPIC $NOSANTIZE_CFLAGS\" \\\n \t{size-9b.c} \\\n \t{{readelf -rW size-9.rd}} \\\n \t\"libsize-9.so\" \\\n@@ -284,11 +284,12 @@ run_ld_link_exec_tests [list \\\n     ] \\\n     [list \\\n \t\"Run size-9\" \\\n-\t\"-Wl,--no-as-needed tmpdir/libsize-9.so\" \\\n+\t\"-Wl,--no-as-needed tmpdir/libsize-9.so $NOSANTIZE_CFLAGS\" \\\n \t\"\" \\\n \t{size-9a.c} \\\n \t\"size-9\" \\\n \t\"size-9.out\" \\\n+\t\"$NOSANTIZE_CFLAGS\" \\\n     ] \\\n     [list \\\n \t\"Run size-10\" \\"
    }
  ]
}