{
  "sha": "30331a6ca014f6b51b17627aa968c6b79627ce21",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MzAzMzFhNmNhMDE0ZjZiNTFiMTc2MjdhYTk2OGM2Yjc5NjI3Y2UyMQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-09-05T12:33:10Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2019-09-05T12:33:10Z"
    },
    "message": "[gdb/testsuite] Restore breakpoint command in ui-redirect.exp\n\nIn gdb.base/ui-redirect.exp, the \"save breakpoint\" command is used to write\nthe current breakpoints to a file, but the actual output is not verified.\n\nConsequently, the test has regressed in that the \"print 1\" command associated\nwith a breakpoint on main is removed by a subsequent runto_main, which first\ndeletes all breakpoints:\n...\n(gdb) break main\nBreakpoint 1 at 0x4004d7: file start.c, line 34.\n(gdb) commands\nType commands for breakpoint(s) 1, one per line.\nEnd with a line saying just \"end\".\n> PASS: gdb.base/ui-redirect.exp: commands\nprint 1\n> PASS: gdb.base/ui-redirect.exp: print 1\nend\n(gdb) PASS: gdb.base/ui-redirect.exp: end\ndelete breakpoints\nDelete all breakpoints? (y or n) y\n...\nand consequently the \"save breakpoint\" output is missing the breakpoint\ncommand for main:\n...\n break main\n-  commands\n-    print 1\n-  end\n break foo\n break bar\n...\n\nFix this by replacing \"gdb_breakpoint main\" with runto_main, and verifying the\n\"save breakpoints\" output.\n\nTested on x86_64-linux.\n\ngdb/testsuite/ChangeLog:\n\n2019-09-05  Tom de Vries  <tdevries@suse.de>\n\n\t* lib/gdb.exp (cmp_file_string): New proc.\n\t* gdb.base/ui-redirect.exp: Replace \"gdb_breakpoint main\" with\n\trunto_main.  Verify save breakpoints output.",
    "tree": {
      "sha": "6966a4e816ce52a4fc9ab07861646f5376d90034",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/6966a4e816ce52a4fc9ab07861646f5376d90034"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/30331a6ca014f6b51b17627aa968c6b79627ce21",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/30331a6ca014f6b51b17627aa968c6b79627ce21",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/30331a6ca014f6b51b17627aa968c6b79627ce21",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/30331a6ca014f6b51b17627aa968c6b79627ce21/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "e47d413a2c8a8710eaff12510bab64d128930d7c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/e47d413a2c8a8710eaff12510bab64d128930d7c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/e47d413a2c8a8710eaff12510bab64d128930d7c"
    }
  ],
  "stats": {
    "total": 64,
    "additions": 56,
    "deletions": 8
  },
  "files": [
    {
      "sha": "0f6917a5a045d3eca20a81613654b0601d0a0287",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30331a6ca014f6b51b17627aa968c6b79627ce21/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30331a6ca014f6b51b17627aa968c6b79627ce21/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=30331a6ca014f6b51b17627aa968c6b79627ce21",
      "patch": "@@ -1,3 +1,9 @@\n+2019-09-05  Tom de Vries  <tdevries@suse.de>\n+\n+\t* lib/gdb.exp (cmp_file_string): New proc.\n+\t* gdb.base/ui-redirect.exp: Replace \"gdb_breakpoint main\" with\n+\trunto_main.  Verify save breakpoints output.\n+\n 2019-09-04  Philippe Waroquiers  <philippe.waroquiers@skynet.be>\n \n \t* gdb.base/info-var.exp: Test info variables without running"
    },
    {
      "sha": "efcac14b7ccbb05b08250ff2793e59c414c8b312",
      "filename": "gdb/testsuite/gdb.base/ui-redirect.exp",
      "status": "modified",
      "additions": 23,
      "deletions": 8,
      "changes": 31,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30331a6ca014f6b51b17627aa968c6b79627ce21/gdb/testsuite/gdb.base/ui-redirect.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30331a6ca014f6b51b17627aa968c6b79627ce21/gdb/testsuite/gdb.base/ui-redirect.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.base/ui-redirect.exp?ref=30331a6ca014f6b51b17627aa968c6b79627ce21",
      "patch": "@@ -23,7 +23,10 @@ if { [prepare_for_testing \"failed to prepare\" ui-redirect start.c] } {\n     return -1\n }\n \n-gdb_breakpoint main\n+if ![runto_main] {\n+    fail \"can't run to main\"\n+    return -1\n+}\n \n set test \"commands\"\n gdb_test_multiple $test $test {\n@@ -40,18 +43,27 @@ gdb_test_multiple $test $test {\n }\n gdb_test_no_output \"end\"\n \n-if ![runto_main] {\n-    fail \"can't run to main\"\n-    return -1\n-}\n gdb_breakpoint \"foo\"\n gdb_breakpoint \"bar\"\n \n+set cmds [multi_line_input \\\n+\t      \"break main\" \\\n+\t      \"  commands\" \\\n+\t      \"    print 1\" \\\n+\t      \"  end\" \\\n+\t      \"break foo\" \\\n+\t      \"break bar\"]\n+set cmds \"$cmds\\n\"\n+set outdir [standard_output_file {}]\n+set cmds_file \"$outdir/cmds.txt\"\n+\n with_test_prefix \"logging\" {\n     gdb_test_no_output \"set logging file /dev/null\"\n     gdb_test \"set logging on\" \\\n     \"Copying output to /dev/null.*Copying debug output to /dev/null\\\\.\"\n-    gdb_test \"save breakpoints /dev/null\" \"Saved to file '/dev/null'\\\\.\"\n+    gdb_test \"save breakpoints $cmds_file\" \"Saved to file '$cmds_file'\\\\.\" \\\n+\t\"save breakpoints cmds.txt\"\n+    cmp_file_string \"$cmds_file\" \"$cmds\" \"cmds.txt\"\n     gdb_test \"set logging off\" \"Done logging to /dev/null\\\\.\"\n     gdb_test \"help\" \"List of classes of commands:.*\"\n }\n@@ -60,7 +72,8 @@ with_test_prefix \"redirect\" {\n     gdb_test \"set logging redirect on\"\n     gdb_test \"set logging on\" \\\n     \"Redirecting output to /dev/null.*Copying debug output to /dev/null\\\\.\"\n-    gdb_test_no_output \"save breakpoints /dev/null\"\n+    gdb_test_no_output \"save breakpoints $cmds_file\" \"save breakpoints cmds.txt\"\n+    cmp_file_string \"$cmds_file\" \"$cmds\" \"cmds.txt\"\n     gdb_test \"set logging off\" \"Done logging to /dev/null\\\\.\"\n     gdb_test \"help\" \"List of classes of commands:.*\"\n }\n@@ -71,7 +84,9 @@ with_test_prefix \"redirect while already logging\" {\n     \"Copying output to /dev/null.*Copying debug output to /dev/null\\\\.\"\n     gdb_test \"set logging redirect on\" \\\n     \".*warning: Currently logging .*Turn the logging off and on to make the new setting effective.*\"\n-    gdb_test \"save breakpoints /dev/null\" \"Saved to file '/dev/null'\\\\.\"\n+    gdb_test \"save breakpoints $cmds_file\" \"Saved to file '$cmds_file'\\\\.\" \\\n+\t\"save breakpoints cmds.txt\"\n+    cmp_file_string \"$cmds_file\" \"$cmds\" \"cmds.txt\"\n     gdb_test \"set logging off\" \"Done logging to /dev/null\\\\.\"\n     gdb_test \"help\" \"List of classes of commands:.*\"\n     gdb_test_no_output \"set logging redirect off\""
    },
    {
      "sha": "acbeb01376830cd0171d259ad4fbc417eb968157",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 27,
      "deletions": 0,
      "changes": 27,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/30331a6ca014f6b51b17627aa968c6b79627ce21/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/30331a6ca014f6b51b17627aa968c6b79627ce21/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=30331a6ca014f6b51b17627aa968c6b79627ce21",
      "patch": "@@ -6668,5 +6668,32 @@ proc gdb_write_cmd_file { cmdline } {\n     catch \"close $cmd_file\"\n }\n \n+# Compare contents of FILE to string STR.  Pass with MSG if equal, otherwise\n+# fail with MSG.\n+\n+proc cmp_file_string { file str msg } {\n+    if { ![file exists $file]} {\n+\tfail \"$msg\"\n+\treturn\n+    }\n+\n+    set caught_error [catch {\n+\tset fp [open \"$file\" r]\n+\tset file_contents [read $fp]\n+\tclose $fp\n+    } error_message]\n+    if { $caught_error } then {\n+\terror \"$error_message\"\n+\tfail \"$msg\"\n+\treturn\n+    }\n+\n+    if { $file_contents == $str } {\n+\tpass \"$msg\"\n+    } else {\n+\tfail \"$msg\"\n+    }\n+}\n+\n # Always load compatibility stuff.\n load_lib future.exp"
    }
  ]
}