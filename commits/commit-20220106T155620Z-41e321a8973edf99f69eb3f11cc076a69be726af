{
  "sha": "41e321a8973edf99f69eb3f11cc076a69be726af",
  "node_id": "C_kwDOANOeidoAKDQxZTMyMWE4OTczZWRmOTlmNjllYjNmMTFjYzA3NmE2OWJlNzI2YWY",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2021-12-27T05:03:09Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tom@tromey.com",
      "date": "2022-01-06T15:56:20Z"
    },
    "message": "Use target_announce_detach in more targets\n\ntarget_announce_detach was added in commit 0f48b757 (\"Factor out\n\"Detaching from program\" message printing\").  There, Pedro wrote:\n\n    (For now, I left the couple targets that print this a bit differently\n    alone.  Maybe this could be further pulled out into infcmd.c.  If we\n    did that, and those targets want to continue printing differently,\n    this new function could be converted to a target method.)\n\nIt seems to me that the differences aren't very big, and in some cases\nother targets handled the output a bit more nicely.  In particular,\nsome targets will print a different message when exec_file==NULL,\nrather than printing the same output with an empty string as\nexec_file.\n\nThis patch incorporates the nicer output into target_announce_detach,\nthen changes the remaining ports to use this function.",
    "tree": {
      "sha": "449b72055dc8ecd8394d052cfda9a1947240272b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/449b72055dc8ecd8394d052cfda9a1947240272b"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/41e321a8973edf99f69eb3f11cc076a69be726af",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/41e321a8973edf99f69eb3f11cc076a69be726af",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/41e321a8973edf99f69eb3f11cc076a69be726af",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/41e321a8973edf99f69eb3f11cc076a69be726af/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/bc521517b7058a231a08bf8f3deae7cd41cd62d7",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/bc521517b7058a231a08bf8f3deae7cd41cd62d7"
    }
  ],
  "stats": {
    "total": 48,
    "additions": 11,
    "deletions": 37
  },
  "files": [
    {
      "sha": "1d3b5f1a357725b31f1d69aca8edf0036c139c83",
      "filename": "gdb/gnu-nat.c",
      "status": "modified",
      "additions": 1,
      "deletions": 10,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/gnu-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/gnu-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gnu-nat.c?ref=41e321a8973edf99f69eb3f11cc076a69be726af",
      "patch": "@@ -2215,16 +2215,7 @@ gnu_nat_target::attach (const char *args, int from_tty)\n void\n gnu_nat_target::detach (inferior *inf, int from_tty)\n {\n-  if (from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-\n-      if (exec_file)\n-\tprintf_unfiltered (\"Detaching from program `%s' pid %d\\n\",\n-\t\t\t   exec_file, gnu_current_inf->pid);\n-      else\n-\tprintf_unfiltered (\"Detaching from pid %d\\n\", gnu_current_inf->pid);\n-    }\n+  target_announce_detach (from_tty);\n \n   inf_detach (gnu_current_inf);\n "
    },
    {
      "sha": "840201d18975d367327d0635c6bb2ee41325b245",
      "filename": "gdb/procfs.c",
      "status": "modified",
      "additions": 1,
      "deletions": 13,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/procfs.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/procfs.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/procfs.c?ref=41e321a8973edf99f69eb3f11cc076a69be726af",
      "patch": "@@ -1786,19 +1786,7 @@ procfs_target::attach (const char *args, int from_tty)\n void\n procfs_target::detach (inferior *inf, int from_tty)\n {\n-  int pid = inferior_ptid.pid ();\n-\n-  if (from_tty)\n-    {\n-      const char *exec_file;\n-\n-      exec_file = get_exec_file (0);\n-      if (exec_file == NULL)\n-\texec_file = \"\";\n-\n-      printf_filtered (_(\"Detaching from program: %s, %s\\n\"), exec_file,\n-\t\t       target_pid_to_str (ptid_t (pid)).c_str ());\n-    }\n+  target_announce_detach (from_tty);\n \n   do_detach ();\n "
    },
    {
      "sha": "c25ce6925380c015acdd031e956d5d51ae4f13e2",
      "filename": "gdb/target.c",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/target.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/target.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target.c?ref=41e321a8973edf99f69eb3f11cc076a69be726af",
      "patch": "@@ -3628,13 +3628,14 @@ target_announce_detach (int from_tty)\n   if (!from_tty)\n     return;\n \n-  exec_file = get_exec_file (0);\n-  if (exec_file == NULL)\n-    exec_file = \"\";\n-\n   pid = inferior_ptid.pid ();\n-  printf_unfiltered (_(\"Detaching from program: %s, %s\\n\"), exec_file,\n-\t\t     target_pid_to_str (ptid_t (pid)).c_str ());\n+  exec_file = get_exec_file (0);\n+  if (exec_file == nullptr)\n+    printf_unfiltered (\"Detaching from pid %s\\n\",\n+\t\t       target_pid_to_str (ptid_t (pid)).c_str ());\n+  else\n+    printf_unfiltered (_(\"Detaching from program: %s, %s\\n\"), exec_file,\n+\t\t       target_pid_to_str (ptid_t (pid)).c_str ());\n }\n \n /* See target.h  */"
    },
    {
      "sha": "bdf6ac93c49ebb955c6026f2ad065435805ca35f",
      "filename": "gdb/windows-nat.c",
      "status": "modified",
      "additions": 2,
      "deletions": 8,
      "changes": 10,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/windows-nat.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/41e321a8973edf99f69eb3f11cc076a69be726af/gdb/windows-nat.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/windows-nat.c?ref=41e321a8973edf99f69eb3f11cc076a69be726af",
      "patch": "@@ -1962,14 +1962,8 @@ windows_nat_target::detach (inferior *inf, int from_tty)\n     }\n   DebugSetProcessKillOnExit (FALSE);\n \n-  if (detached && from_tty)\n-    {\n-      const char *exec_file = get_exec_file (0);\n-      if (exec_file == 0)\n-\texec_file = \"\";\n-      printf_unfiltered (\"Detaching from program: %s, Pid %u\\n\", exec_file,\n-\t\t\t (unsigned) current_event.dwProcessId);\n-    }\n+  if (detached)\n+    target_announce_detach (from_tty);\n \n   x86_cleanup_dregs ();\n   switch_to_no_thread ();"
    }
  ]
}