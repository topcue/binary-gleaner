{
  "sha": "f96093c1f53bf4a930073f6ae862910583d79866",
  "node_id": "C_kwDOANOeidoAKGY5NjA5M2MxZjUzYmY0YTkzMDA3M2Y2YWU4NjI5MTA1ODNkNzk4NjY",
  "commit": {
    "author": {
      "name": "Richard Sandiford",
      "email": "richard.sandiford@arm.com",
      "date": "2021-12-02T15:00:56Z"
    },
    "committer": {
      "name": "Richard Sandiford",
      "email": "richard.sandiford@arm.com",
      "date": "2021-12-02T15:00:56Z"
    },
    "message": "aarch64: Add maximum immediate value to aarch64_sys_reg\n\nThe immediate form of MSR has a 4-bit immediate field (in CRm).\nHowever, many forms of MSR require a smaller immediate.  These cases\nare identified by value in operand_general_constraint_met_p,\nbut they're now the common case rather than the exception.\n\nThis patch therefore adds the maximum value to the sys_reg\ndescription and gets the range from there.  It also enforces\nthe minimum of 0, which avoids a situation in which:\n\n  msr dit, #2\n\nwould give the expected:\n\n  Error: immediate value out of range 0 to 1\n\nwhereas:\n\n  msr dit, #-1\n\nwould give:\n\n  Error: immediate value out of range 0 to 15\n\n(from the later UIMM4 checking).\n\nAlso:\n\n- we were reporting the first error above against the wrong operand\n- TCO takes a single-bit immediate, but we previously allowed\n  all 16 values.\n  [https://developer.arm.com/documentation/ddi0596/2021-09/Base-Instructions/MSR--immediate---Move-immediate-value-to-Special-Register-?lang=en]\n\nopcodes/\n\t* aarch64-opc.h (F_REG_MAX_VALUE, F_GET_REG_MAX_VALUE): New macros.\n\t* aarch64-opc.c (operand_general_constraint_met_p): Read the\n\tmaximum MSR immediate value from aarch64_pstatefields.\n\t(aarch64_pstatefields): Add the maximum immediate value\n\tfor each register.\n\ngas/\n\t* testsuite/gas/aarch64/sysreg-4.s: Use an immediate value of 1\n\trather than 8 for the TCO test.\n\t* testsuite/gas/aarch64/sysreg-4.d: Update accordingly.\n\t* testsuite/gas/aarch64/armv8_2-a-illegal.l: Fix operand number\n\tin MSR immediate error messages.\n\t* testsuite/gas/aarch64/diagnostic.l: Likewise.\n\t* testsuite/gas/aarch64/pan-illegal.l: Likewise.\n\t* testsuite/gas/aarch64/ssbs-illegal1.l: Likewise.\n\t* testsuite/gas/aarch64/illegal-sysreg-4b.s,\n\t* testsuite/gas/aarch64/illegal-sysreg-4b.d,\n\t* testsuite/gas/aarch64/illegal-sysreg-4b.l: New test.",
    "tree": {
      "sha": "71262503d92f328c81d83dc3d576b136e638d8ad",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/71262503d92f328c81d83dc3d576b136e638d8ad"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/f96093c1f53bf4a930073f6ae862910583d79866",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f96093c1f53bf4a930073f6ae862910583d79866",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/f96093c1f53bf4a930073f6ae862910583d79866",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f96093c1f53bf4a930073f6ae862910583d79866/comments",
  "author": {
    "login": "rsandifo-arm",
    "id": 28043039,
    "node_id": "MDQ6VXNlcjI4MDQzMDM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rsandifo-arm",
    "html_url": "https://github.com/rsandifo-arm",
    "followers_url": "https://api.github.com/users/rsandifo-arm/followers",
    "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs",
    "repos_url": "https://api.github.com/users/rsandifo-arm/repos",
    "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "rsandifo-arm",
    "id": 28043039,
    "node_id": "MDQ6VXNlcjI4MDQzMDM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/28043039?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rsandifo-arm",
    "html_url": "https://github.com/rsandifo-arm",
    "followers_url": "https://api.github.com/users/rsandifo-arm/followers",
    "following_url": "https://api.github.com/users/rsandifo-arm/following{/other_user}",
    "gists_url": "https://api.github.com/users/rsandifo-arm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rsandifo-arm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rsandifo-arm/subscriptions",
    "organizations_url": "https://api.github.com/users/rsandifo-arm/orgs",
    "repos_url": "https://api.github.com/users/rsandifo-arm/repos",
    "events_url": "https://api.github.com/users/rsandifo-arm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rsandifo-arm/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "96c7115a9a1669c70331f594eca40eebeb5f2d2c",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/96c7115a9a1669c70331f594eca40eebeb5f2d2c",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/96c7115a9a1669c70331f594eca40eebeb5f2d2c"
    }
  ],
  "stats": {
    "total": 166,
    "additions": 92,
    "deletions": 74
  },
  "files": [
    {
      "sha": "380ec514fd8f674d1c42b56f5ea6f0983e2b0cc4",
      "filename": "gas/testsuite/gas/aarch64/armv8_2-a-illegal.l",
      "status": "modified",
      "additions": 8,
      "deletions": 8,
      "changes": 16,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/armv8_2-a-illegal.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/armv8_2-a-illegal.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/armv8_2-a-illegal.l?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -1,9 +1,9 @@\n [^:]+: Assembler messages:\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#2'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#3'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#4'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#5'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#8'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#15'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#19'\n-[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr uao,#31'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#2'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#3'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#4'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#5'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#8'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#15'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#19'\n+[^:]+:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr uao,#31'"
    },
    {
      "sha": "87cc4feee6fa9a29ec9d413f5dd586b14332716e",
      "filename": "gas/testsuite/gas/aarch64/diagnostic.l",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/diagnostic.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/diagnostic.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/diagnostic.l?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -15,7 +15,7 @@\n [^:]*:17: Error: extraneous register at operand 2 -- `tlbi alle3is,x0'\n [^:]*:18: Error: missing register at operand 2 -- `tlbi vaale1is'\n [^:]*:19: Error: comma expected between operands at operand 2 -- `tlbi vaale1is x0'\n-[^:]*:20: Error: immediate value out of range 0 to 1 at operand 1 -- `msr spsel,3'\n+[^:]*:20: Error: immediate value out of range 0 to 1 at operand 2 -- `msr spsel,3'\n [^:]*:21: Error: immediate value out of range 1 to 64 at operand 3 -- `fcvtzu x15,d31,#66'\n [^:]*:22: Error: immediate value out of range 1 to 32 at operand 3 -- `scvtf s0,w0,33'\n [^:]*:23: Error: immediate value out of range 1 to 32 at operand 3 -- `scvtf s0,w0,0'"
    },
    {
      "sha": "1504f5f4637dbeb3b604cd894d24f103d9b21bad",
      "filename": "gas/testsuite/gas/aarch64/illegal-sysreg-4b.d",
      "status": "added",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/illegal-sysreg-4b.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/illegal-sysreg-4b.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/illegal-sysreg-4b.d?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -0,0 +1,2 @@\n+#as: -march=armv8-a\n+#error_output: illegal-sysreg-4b.l"
    },
    {
      "sha": "69987b4122f170ed37f7fc0a4b746def889511b0",
      "filename": "gas/testsuite/gas/aarch64/illegal-sysreg-4b.l",
      "status": "added",
      "additions": 11,
      "deletions": 0,
      "changes": 11,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/illegal-sysreg-4b.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/illegal-sysreg-4b.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/illegal-sysreg-4b.l?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -0,0 +1,11 @@\n+[^:]*: Assembler messages:\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr TCO,#-1'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr TCO,#2'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr TCO,#15'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr TCO,#0x100000000'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 15 at operand 2 -- `msr daifclr,#-1'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 15 at operand 2 -- `msr daifclr,#16'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 15 at operand 2 -- `msr daifclr,#0x200000000'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 15 at operand 2 -- `msr daifset,#-1'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 15 at operand 2 -- `msr daifset,#16'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 15 at operand 2 -- `msr daifset,#0x200000000'"
    },
    {
      "sha": "d7e84767ec1a5293f3467ae6e96ae821e3079876",
      "filename": "gas/testsuite/gas/aarch64/illegal-sysreg-4b.s",
      "status": "added",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/illegal-sysreg-4b.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/illegal-sysreg-4b.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/illegal-sysreg-4b.s?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -0,0 +1,14 @@\n+\t.arch armv8.5-a+memtag\n+\n+\tmsr TCO, #-1\n+\tmsr TCO, #2\n+\tmsr TCO, #15\n+\tmsr TCO, #0x100000000\n+\n+\tmsr daifclr, #-1\n+\tmsr daifclr, #16\n+\tmsr daifclr, #0x200000000\n+\n+\tmsr daifset, #-1\n+\tmsr daifset, #16\n+\tmsr daifset, #0x200000000"
    },
    {
      "sha": "5ba76f5480c67fc6e4c8a2a2e4c39684550c6383",
      "filename": "gas/testsuite/gas/aarch64/pan-illegal.l",
      "status": "modified",
      "additions": 14,
      "deletions": 14,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/pan-illegal.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/pan-illegal.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/pan-illegal.l?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -1,15 +1,15 @@\n [^:]*: Assembler messages:\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#2'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#3'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#4'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#5'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#6'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#7'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#8'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#9'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#10'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#11'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#12'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#13'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#14'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr pan,#15'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#2'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#3'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#4'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#5'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#6'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#7'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#8'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#9'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#10'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#11'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#12'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#13'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#14'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr pan,#15'"
    },
    {
      "sha": "6f7c5dcc23cd2a626f01185658070cca56ee0bf0",
      "filename": "gas/testsuite/gas/aarch64/ssbs-illegal1.l",
      "status": "modified",
      "additions": 14,
      "deletions": 14,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/ssbs-illegal1.l",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/ssbs-illegal1.l",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/ssbs-illegal1.l?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -1,15 +1,15 @@\n [^:]*: Assembler messages:\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#2'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#3'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#4'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#5'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#6'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#7'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#8'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#9'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#10'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#11'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#12'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#13'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#14'\n-[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 1 -- `msr ssbs,#15'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#2'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#3'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#4'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#5'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#6'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#7'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#8'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#9'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#10'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#11'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#12'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#13'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#14'\n+[^:]*:[0-9]+: Error: immediate value out of range 0 to 1 at operand 2 -- `msr ssbs,#15'"
    },
    {
      "sha": "f0fffbee9f5e026b9ff7627c5de6946d88d25d6b",
      "filename": "gas/testsuite/gas/aarch64/sysreg-4.d",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/sysreg-4.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/sysreg-4.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/sysreg-4.d?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -38,7 +38,7 @@ Disassembly of section \\.text:\n .*:\td51d560c \tmsr\ttfsr_el12, x12\n .*:\td51810a1 \tmsr\trgsr_el1, x1\n .*:\td51810c3 \tmsr\tgcr_el1, x3\n-.*:\td503489f \tmsr\ttco, #0x8\n+.*:\td503419f \tmsr\ttco, #0x1\n .*:\td5087661 \tdc\tigvac, x1\n .*:\td5087682 \tdc\tigsw, x2\n .*:\td5087a83 \tdc\tcgsw, x3"
    },
    {
      "sha": "769f0a668a99a301b0e6ce23dbadfd060a630047",
      "filename": "gas/testsuite/gas/aarch64/sysreg-4.s",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/sysreg-4.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/gas/testsuite/gas/aarch64/sysreg-4.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/aarch64/sysreg-4.s?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -38,7 +38,7 @@ func:\n \tmsr gcr_el1, x3\n \n \t# MSR (immediate)\n-\tmsr TCO, #8\n+\tmsr TCO, #1\n \n \t# Data cache\n \tdc igvac, x1"
    },
    {
      "sha": "b7076cdbf35f7ae5e5f86aafe95ec2c019770735",
      "filename": "opcodes/aarch64-opc.c",
      "status": "modified",
      "additions": 22,
      "deletions": 35,
      "changes": 57,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/opcodes/aarch64-opc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/opcodes/aarch64-opc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/aarch64-opc.c?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -1474,6 +1474,7 @@ operand_general_constraint_met_p (const aarch64_opnd_info *opnds, int idx,\n   uint64_t uvalue, mask;\n   const aarch64_opnd_info *opnd = opnds + idx;\n   aarch64_opnd_qualifier_t qualifier = opnd->qualifier;\n+  int i;\n \n   assert (opcode->operands[idx] == opnd->type && opnd->type == type);\n \n@@ -2592,32 +2593,15 @@ operand_general_constraint_met_p (const aarch64_opnd_info *opnds, int idx,\n       switch (type)\n \t{\n \tcase AARCH64_OPND_PSTATEFIELD:\n+\t  for (i = 0; aarch64_pstatefields[i].name; ++i)\n+\t    if (aarch64_pstatefields[i].value == opnd->pstatefield)\n+\t      break;\n+\t  assert (aarch64_pstatefields[i].name);\n \t  assert (idx == 0 && opnds[1].type == AARCH64_OPND_UIMM4);\n-\t  /* MSR UAO, #uimm4\n-\t     MSR PAN, #uimm4\n-\t     MSR SSBS,#uimm4\n-\t     MSR SVCRSM, #uimm4\n-\t     MSR SVCRZA, #uimm4\n-\t     MSR SVCRSMZA, #uimm4\n-\t     The immediate must be #0 or #1.  */\n-\t  if ((opnd->pstatefield == 0x03\t/* UAO.  */\n-\t       || opnd->pstatefield == 0x04\t/* PAN.  */\n-\t       || opnd->pstatefield == 0x19     /* SSBS.  */\n-\t       || opnd->pstatefield == 0x1a\t/* DIT.  */\n-\t       || opnd->pstatefield == 0x1b)\t/* SVCRSM, SVCRZA or SVCRSMZA.  */\n-\t      && opnds[1].imm.value > 1)\n-\t    {\n-\t      set_imm_out_of_range_error (mismatch_detail, idx, 0, 1);\n-\t      return 0;\n-\t    }\n-\t  /* MSR SPSel, #uimm4\n-\t     Uses uimm4 as a control value to select the stack pointer: if\n-\t     bit 0 is set it selects the current exception level's stack\n-\t     pointer, if bit 0 is clear it selects shared EL0 stack pointer.\n-\t     Bits 1 to 3 of uimm4 are reserved and should be zero.  */\n-\t  if (opnd->pstatefield == 0x05 /* spsel */ && opnds[1].imm.value > 1)\n+\t  max_value = F_GET_REG_MAX_VALUE (aarch64_pstatefields[i].flags);\n+\t  if (opnds[1].imm.value < 0 || opnds[1].imm.value > max_value)\n \t    {\n-\t      set_imm_out_of_range_error (mismatch_detail, idx, 0, 1);\n+\t      set_imm_out_of_range_error (mismatch_detail, 1, 0, max_value);\n \t      return 0;\n \t    }\n \t  break;\n@@ -5033,17 +5017,20 @@ aarch64_sys_reg_deprecated_p (const uint32_t reg_flags)\n    0b011010 (0x1a).  */\n const aarch64_sys_reg aarch64_pstatefields [] =\n {\n-  SR_CORE (\"spsel\",\t  0x05,\t0),\n-  SR_CORE (\"daifset\",\t  0x1e,\t0),\n-  SR_CORE (\"daifclr\",\t  0x1f,\t0),\n-  SR_PAN  (\"pan\",\t  0x04, 0),\n-  SR_V8_2 (\"uao\",\t  0x03, 0),\n-  SR_SSBS (\"ssbs\",\t  0x19, 0),\n-  SR_V8_4 (\"dit\",\t  0x1a,\t0),\n-  SR_MEMTAG (\"tco\",\t  0x1c,\t0),\n-  SR_SME  (\"svcrsm\",\t  0x1b, PSTATE_ENCODE_CRM_AND_IMM(0x2,0x1)),\n-  SR_SME  (\"svcrza\",\t  0x1b, PSTATE_ENCODE_CRM_AND_IMM(0x4,0x1)),\n-  SR_SME  (\"svcrsmza\",\t  0x1b, PSTATE_ENCODE_CRM_AND_IMM(0x6,0x1)),\n+  SR_CORE (\"spsel\",\t  0x05,\tF_REG_MAX_VALUE (1)),\n+  SR_CORE (\"daifset\",\t  0x1e,\tF_REG_MAX_VALUE (15)),\n+  SR_CORE (\"daifclr\",\t  0x1f,\tF_REG_MAX_VALUE (15)),\n+  SR_PAN  (\"pan\",\t  0x04, F_REG_MAX_VALUE (1)),\n+  SR_V8_2 (\"uao\",\t  0x03, F_REG_MAX_VALUE (1)),\n+  SR_SSBS (\"ssbs\",\t  0x19, F_REG_MAX_VALUE (1)),\n+  SR_V8_4 (\"dit\",\t  0x1a,\tF_REG_MAX_VALUE (1)),\n+  SR_MEMTAG (\"tco\",\t  0x1c,\tF_REG_MAX_VALUE (1)),\n+  SR_SME  (\"svcrsm\",\t  0x1b, PSTATE_ENCODE_CRM_AND_IMM(0x2,0x1)\n+\t\t\t\t| F_REG_MAX_VALUE (1)),\n+  SR_SME  (\"svcrza\",\t  0x1b, PSTATE_ENCODE_CRM_AND_IMM(0x4,0x1)\n+\t\t\t\t| F_REG_MAX_VALUE (1)),\n+  SR_SME  (\"svcrsmza\",\t  0x1b, PSTATE_ENCODE_CRM_AND_IMM(0x6,0x1)\n+\t\t\t\t| F_REG_MAX_VALUE (1)),\n   { 0,\t  CPENC (0,0,0,0,0), 0, 0 },\n };\n "
    },
    {
      "sha": "c7599fb897203de7115827dd42532da459e86403",
      "filename": "opcodes/aarch64-opc.h",
      "status": "modified",
      "additions": 4,
      "deletions": 0,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/f96093c1f53bf4a930073f6ae862910583d79866/opcodes/aarch64-opc.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/f96093c1f53bf4a930073f6ae862910583d79866/opcodes/aarch64-opc.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/opcodes/aarch64-opc.h?ref=f96093c1f53bf4a930073f6ae862910583d79866",
      "patch": "@@ -273,6 +273,10 @@ verify_constraints (const struct aarch64_inst *, const aarch64_insn, bfd_vma,\n         (F_REG_IN_CRM | PSTATE_ENCODE_CRM(CVAL) \\\n          | F_IMM_IN_CRM | PSTATE_ENCODE_CRM_IMM(IMASK))\n \n+/* Bits [15, 18] contain the maximum value for an immediate MSR.  */\n+#define F_REG_MAX_VALUE(X) ((X) << 15)\n+#define F_GET_REG_MAX_VALUE(X) (((X) >> 15) & 0x0f)\n+\n /* HINT operand flags.  */\n #define HINT_OPD_F_NOPRINT\t(1 << 0)  /* Should not be printed.  */\n "
    }
  ]
}