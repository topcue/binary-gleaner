{
  "sha": "ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YWIzM2IxNTI1NTQ2MGFjNDVhMDAxYzhlYmY2OWVmNzNmNmYxZmJhNA==",
  "commit": {
    "author": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-10-11T18:26:59Z"
    },
    "committer": {
      "name": "Andrew Burgess",
      "email": "andrew.burgess@embecosm.com",
      "date": "2020-11-12T09:44:00Z"
    },
    "message": "gdb: add an option flag to 'maint print c-tdesc'\n\nGDB has two approaches to generating the target descriptions found in\ngdb/features/, the whole description approach, where the XML file\ncontains a complete target description which is then used to generate\na single C file that builds that target description.  Or, the split\nfeature approach, where the XML files contain a single target feature,\neach feature results in a single C file to create that one feature,\nand then a manually written C file is used to build a complete target\ndescription from individual features.\n\nThere's a Makefile, gdb/features/Makefile, which is responsible for\nmanaging the regeneration of the C files from the XML files.\n\nHowever, some of the logic that selects between the whole description\napproach, or the split feature approach, is actually hard-coded into\nGDB, inside target-descriptions.c:maint_print_c_tdesc_cmd we check the\npath to the incoming XML file and use this to choose which type of C\nfile we should generate.\n\nThis commit removes this hard coding from GDB, and makes the Makefile\nentirely responsible for choosing the approach.  This makes sense as\nthe Makefile already has the XML files partitioned based on which\napproach they should use.\n\nIn order to allow this change the 'maint print c-tdesc' command is\ngiven a new command option '-single-feature', which tells GDB which\ntype of C file should be created.  The makefile now supplies this flag\nto GDB.\n\nThis did reveal a bug in features/Makefile, the rx.xml file was in the\nwrong list, this didn't matter previously as the actual choice of\nwhich approach to use was done in GDB.  Now the Makefile decides, so\nplacing each XML file in the correct list is critical.\n\nTested this by doing 'make GDB=/path/to/gdb clean-cfiles cfiles' to\nregenerate all the C files from their XML source.  There are no\nchanges after this commit.\n\ngdb/ChangeLog:\n\n\t* features/Makefile (XMLTOC): Add rx.xml.\n\t(FEATURE_XMLFILES): Remove rx.xml.\n\t(FEATURE_CFILES rule): Pass '-single-feature' flag.\n\t* features/rx.c: Regenerate.\n\t* features/rx.xml: Wrap in `target` tags, and reindent.\n\t* target-descriptions.c (struct maint_print_c_tdesc_options): New\n\tstructure.\n\t(maint_print_c_tdesc_opt_def): New typedef.\n\t(maint_print_c_tdesc_opt_defs): New static global.\n\t(make_maint_print_c_tdesc_options_def_group): New function.\n\t(maint_print_c_tdesc_cmd): Make use of command line flags, only\n\tprint single feature C file for target descriptions containing a\n\tsingle feature.\n\t(maint_print_c_tdesc_cmd_completer): New function.\n\t(_initialize_target_descriptions): Update call to register command\n\tcompleter, and include command line flag in help text.\n\ngdb/doc/ChangeLog:\n\n\t* gdb.texinfo (Maintenance Commands): Update description of 'maint\n\tprint c-tdesc'.",
    "tree": {
      "sha": "dba8d576f56297fe9a2c35ccedf7bf77c390bc35",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/dba8d576f56297fe9a2c35ccedf7bf77c390bc35"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/comments",
  "author": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "T-J-Teru",
    "id": 475372,
    "node_id": "MDQ6VXNlcjQ3NTM3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/475372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/T-J-Teru",
    "html_url": "https://github.com/T-J-Teru",
    "followers_url": "https://api.github.com/users/T-J-Teru/followers",
    "following_url": "https://api.github.com/users/T-J-Teru/following{/other_user}",
    "gists_url": "https://api.github.com/users/T-J-Teru/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/T-J-Teru/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/T-J-Teru/subscriptions",
    "organizations_url": "https://api.github.com/users/T-J-Teru/orgs",
    "repos_url": "https://api.github.com/users/T-J-Teru/repos",
    "events_url": "https://api.github.com/users/T-J-Teru/events{/privacy}",
    "received_events_url": "https://api.github.com/users/T-J-Teru/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "b8b0c108c75bd957660b9cada31378d95de4ec5a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/b8b0c108c75bd957660b9cada31378d95de4ec5a",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/b8b0c108c75bd957660b9cada31378d95de4ec5a"
    }
  ],
  "stats": {
    "total": 254,
    "additions": 173,
    "deletions": 81
  },
  "files": [
    {
      "sha": "b24fdb5ea7e2e0880f96ca323d3142d873597654",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 19,
      "deletions": 0,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -1,3 +1,22 @@\n+2020-11-12  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* features/Makefile (XMLTOC): Add rx.xml.\n+\t(FEATURE_XMLFILES): Remove rx.xml.\n+\t(FEATURE_CFILES rule): Pass '-single-feature' flag.\n+\t* features/rx.c: Regenerate.\n+\t* features/rx.xml: Wrap in `target` tags, and reindent.\n+\t* target-descriptions.c (struct maint_print_c_tdesc_options): New\n+\tstructure.\n+\t(maint_print_c_tdesc_opt_def): New typedef.\n+\t(maint_print_c_tdesc_opt_defs): New static global.\n+\t(make_maint_print_c_tdesc_options_def_group): New function.\n+\t(maint_print_c_tdesc_cmd): Make use of command line flags, only\n+\tprint single feature C file for target descriptions containing a\n+\tsingle feature.\n+\t(maint_print_c_tdesc_cmd_completer): New function.\n+\t(_initialize_target_descriptions): Update call to register command\n+\tcompleter, and include command line flag in help text.\n+\n 2020-11-11  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* riscv-tdep.c (riscv_dwarf_reg_to_regnum): Decode DWARF CSR"
    },
    {
      "sha": "e7cec1a81d4976d98dfb85909f1e7d0bda29da38",
      "filename": "gdb/doc/ChangeLog",
      "status": "modified",
      "additions": 5,
      "deletions": 0,
      "changes": 5,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/doc/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/doc/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/ChangeLog?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -1,3 +1,8 @@\n+2020-11-12  Andrew Burgess  <andrew.burgess@embecosm.com>\n+\n+\t* gdb.texinfo (Maintenance Commands): Update description of 'maint\n+\tprint c-tdesc'.\n+\n 2020-11-02  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.texinfo (Mode Options): Descriptions of initialization files"
    },
    {
      "sha": "7092331de4ec7032f46ff02c49548347dfba36f2",
      "filename": "gdb/doc/gdb.texinfo",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/doc/gdb.texinfo",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/doc/gdb.texinfo",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/doc/gdb.texinfo?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -38716,8 +38716,8 @@ checksum.\n Print the entire architecture configuration.  The optional argument\n @var{file} names the file where the output goes.\n \n-@kindex maint print c-tdesc @r{[}@var{file}@r{]}\n-@item maint print c-tdesc\n+@kindex maint print c-tdesc\n+@item maint print c-tdesc @r{[}-single-feature@r{]} @r{[}@var{file}@r{]}\n Print the target description (@pxref{Target Descriptions}) as\n a C source file.  By default, the target description is for the current\n target, but if the optional argument @var{file} is provided, that file\n@@ -38727,6 +38727,11 @@ The created source file is built into @value{GDBN} when @value{GDBN} is\n built again.  This command is used by developers after they add or\n modify XML target descriptions.\n \n+When the optional flag @samp{-single-feature} is provided then the\n+target description being processed (either the default, or from\n+@var{file}) must only contain a single feature.  The source file\n+produced is different in this case.\n+\n @kindex maint print xml-tdesc\n @item maint print xml-tdesc  @r{[}@var{file}@r{]}\n Print the target description (@pxref{Target Descriptions}) as an XML"
    },
    {
      "sha": "d5b3236242d1fd006b5312da1cbf4739d598220e",
      "filename": "gdb/features/Makefile",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/features/Makefile",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/features/Makefile",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/Makefile?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -153,6 +153,7 @@ XMLTOC = \\\n \trs6000/powerpc-vsx64.xml \\\n \trs6000/powerpc-vsx64l.xml \\\n \trs6000/rs6000.xml \\\n+\trx.xml \\\n \ts390-linux32.xml \\\n \ts390-linux32v1.xml \\\n \ts390-linux32v2.xml \\\n@@ -232,7 +233,6 @@ FEATURE_XMLFILES = aarch64-core.xml \\\n \triscv/32bit-fpu.xml \\\n \triscv/64bit-cpu.xml \\\n \triscv/64bit-fpu.xml \\\n-\trx.xml \\\n \ttic6x-c6xp.xml \\\n \ttic6x-core.xml \\\n \ttic6x-gp.xml\n@@ -247,7 +247,7 @@ $(TDESC_CFILES): %.c: %.xml\n \n $(FEATURE_CFILES): %.c: %.xml.tmp\n \t$(GDB) -nx -q -batch \\\n-\t  -ex 'maint print c-tdesc $<' > $@.tmp\n+\t  -ex 'maint print c-tdesc -single-feature $<' > $@.tmp\n \tsh ../../move-if-change $@.tmp $@\n \trm $<\n "
    },
    {
      "sha": "dd765c2c63af8bebefe7cd104ea2ddb798965a89",
      "filename": "gdb/features/rx.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/features/rx.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/features/rx.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/rx.c?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -1,5 +1,5 @@\n /* THIS FILE IS GENERATED.  -*- buffer-read-only: t -*- vi:set ro:\n-  Original: rx.xml.tmp */\n+  Original: rx.xml */\n \n #include \"defs.h\"\n #include \"osabi.h\""
    },
    {
      "sha": "35348e8b3e5e4efcba4ad9d82c1710937998cba2",
      "filename": "gdb/features/rx.xml",
      "status": "modified",
      "additions": 66,
      "deletions": 64,
      "changes": 130,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/features/rx.xml",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/features/rx.xml",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/features/rx.xml?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -5,70 +5,72 @@\n      are permitted in any medium without royalty provided the copyright\n      notice and this notice are preserved.  -->\n \n-<!DOCTYPE feature SYSTEM \"gdb-target.dtd\">\n-<feature name=\"org.gnu.gdb.rx.core\">\n-  <reg name=\"r0\" bitsize=\"32\" type=\"data_ptr\"/>\n-  <reg name=\"r1\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r2\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r3\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r4\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r5\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r6\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r7\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r8\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r9\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r10\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r11\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r12\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r13\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r14\" bitsize=\"32\" type=\"uint32\"/>\n-  <reg name=\"r15\" bitsize=\"32\" type=\"uint32\"/>\n+<!DOCTYPE target SYSTEM \"gdb-target.dtd\">\n+<target>\n+  <feature name=\"org.gnu.gdb.rx.core\">\n+    <reg name=\"r0\" bitsize=\"32\" type=\"data_ptr\"/>\n+    <reg name=\"r1\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r2\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r3\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r4\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r5\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r6\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r7\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r8\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r9\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r10\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r11\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r12\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r13\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r14\" bitsize=\"32\" type=\"uint32\"/>\n+    <reg name=\"r15\" bitsize=\"32\" type=\"uint32\"/>\n \n-  <flags id=\"psw_flags\" size=\"4\">\n-    <field name=\"C\" start=\"0\" end=\"0\"/>\n-    <field name=\"Z\" start=\"1\" end=\"1\"/>\n-    <field name=\"S\" start=\"2\" end=\"2\"/>\n-    <field name=\"O\" start=\"3\" end=\"3\"/>\n-    <field name=\"I\" start=\"16\" end=\"16\"/>\n-    <field name=\"U\" start=\"17\" end=\"17\"/>\n-    <field name=\"PM\" start=\"20\" end=\"20\"/>\n-    <field name=\"IPL0\" start=\"24\" end=\"24\"/>\n-    <field name=\"IPL1\" start=\"25\" end=\"25\"/>\n-    <field name=\"IPL2\" start=\"26\" end=\"26\"/>\n-    <field name=\"IPL3\" start=\"27\" end=\"27\"/>\n-  </flags>\n+    <flags id=\"psw_flags\" size=\"4\">\n+      <field name=\"C\" start=\"0\" end=\"0\"/>\n+      <field name=\"Z\" start=\"1\" end=\"1\"/>\n+      <field name=\"S\" start=\"2\" end=\"2\"/>\n+      <field name=\"O\" start=\"3\" end=\"3\"/>\n+      <field name=\"I\" start=\"16\" end=\"16\"/>\n+      <field name=\"U\" start=\"17\" end=\"17\"/>\n+      <field name=\"PM\" start=\"20\" end=\"20\"/>\n+      <field name=\"IPL0\" start=\"24\" end=\"24\"/>\n+      <field name=\"IPL1\" start=\"25\" end=\"25\"/>\n+      <field name=\"IPL2\" start=\"26\" end=\"26\"/>\n+      <field name=\"IPL3\" start=\"27\" end=\"27\"/>\n+    </flags>\n \n-  <flags id=\"fpsw_flags\" size=\"4\">\n-    <field name=\"RM0\" start=\"0\" end=\"0\"/>\n-    <field name=\"RM1\" start=\"1\" end=\"1\"/>\n-    <field name=\"CV\" start=\"2\" end=\"2\"/>\n-    <field name=\"CO\" start=\"3\" end=\"3\"/>\n-    <field name=\"CZ\" start=\"4\" end=\"4\"/>\n-    <field name=\"CU\" start=\"5\" end=\"5\"/>\n-    <field name=\"CX\" start=\"6\" end=\"6\"/>\n-    <field name=\"CE\" start=\"7\" end=\"7\"/>\n-    <field name=\"DN\" start=\"8\" end=\"8\"/>\n-    <field name=\"EV\" start=\"10\" end=\"10\"/>\n-    <field name=\"EO\" start=\"11\" end=\"11\"/>\n-    <field name=\"EZ\" start=\"12\" end=\"12\"/>\n-    <field name=\"EU\" start=\"13\" end=\"13\"/>\n-    <field name=\"EX\" start=\"14\" end=\"14\"/>\n-    <field name=\"FV\" start=\"26\" end=\"26\"/>\n-    <field name=\"FO\" start=\"27\" end=\"27\"/>\n-    <field name=\"FZ\" start=\"28\" end=\"28\"/>\n-    <field name=\"FU\" start=\"29\" end=\"29\"/>\n-    <field name=\"FX\" start=\"30\" end=\"30\"/>\n-    <field name=\"FS\" start=\"31\" end=\"31\"/>\n-  </flags>\n+    <flags id=\"fpsw_flags\" size=\"4\">\n+      <field name=\"RM0\" start=\"0\" end=\"0\"/>\n+      <field name=\"RM1\" start=\"1\" end=\"1\"/>\n+      <field name=\"CV\" start=\"2\" end=\"2\"/>\n+      <field name=\"CO\" start=\"3\" end=\"3\"/>\n+      <field name=\"CZ\" start=\"4\" end=\"4\"/>\n+      <field name=\"CU\" start=\"5\" end=\"5\"/>\n+      <field name=\"CX\" start=\"6\" end=\"6\"/>\n+      <field name=\"CE\" start=\"7\" end=\"7\"/>\n+      <field name=\"DN\" start=\"8\" end=\"8\"/>\n+      <field name=\"EV\" start=\"10\" end=\"10\"/>\n+      <field name=\"EO\" start=\"11\" end=\"11\"/>\n+      <field name=\"EZ\" start=\"12\" end=\"12\"/>\n+      <field name=\"EU\" start=\"13\" end=\"13\"/>\n+      <field name=\"EX\" start=\"14\" end=\"14\"/>\n+      <field name=\"FV\" start=\"26\" end=\"26\"/>\n+      <field name=\"FO\" start=\"27\" end=\"27\"/>\n+      <field name=\"FZ\" start=\"28\" end=\"28\"/>\n+      <field name=\"FU\" start=\"29\" end=\"29\"/>\n+      <field name=\"FX\" start=\"30\" end=\"30\"/>\n+      <field name=\"FS\" start=\"31\" end=\"31\"/>\n+    </flags>\n \n-  <reg name=\"usp\" bitsize=\"32\" type=\"data_ptr\"/>\n-  <reg name=\"isp\" bitsize=\"32\" type=\"data_ptr\"/>\n-  <reg name=\"psw\" bitsize=\"32\" type=\"psw_flags\"/>\n-  <reg name=\"pc\" bitsize=\"32\" type=\"code_ptr\"/>\n-  <reg name=\"intb\" bitsize=\"32\" type=\"data_ptr\"/>\n-  <reg name=\"bpsw\" bitsize=\"32\" type=\"psw_flags\"/>\n-  <reg name=\"bpc\" bitsize=\"32\" type=\"code_ptr\"/>\n-  <reg name=\"fintv\" bitsize=\"32\" type=\"code_ptr\"/>\n-  <reg name=\"fpsw\" bitsize=\"32\" type=\"fpsw_flags\"/>\n-  <reg name=\"acc\" bitsize=\"64\" type=\"uint64\"/>\n-</feature>\n+    <reg name=\"usp\" bitsize=\"32\" type=\"data_ptr\"/>\n+    <reg name=\"isp\" bitsize=\"32\" type=\"data_ptr\"/>\n+    <reg name=\"psw\" bitsize=\"32\" type=\"psw_flags\"/>\n+    <reg name=\"pc\" bitsize=\"32\" type=\"code_ptr\"/>\n+    <reg name=\"intb\" bitsize=\"32\" type=\"data_ptr\"/>\n+    <reg name=\"bpsw\" bitsize=\"32\" type=\"psw_flags\"/>\n+    <reg name=\"bpc\" bitsize=\"32\" type=\"code_ptr\"/>\n+    <reg name=\"fintv\" bitsize=\"32\" type=\"code_ptr\"/>\n+    <reg name=\"fpsw\" bitsize=\"32\" type=\"fpsw_flags\"/>\n+    <reg name=\"acc\" bitsize=\"64\" type=\"uint64\"/>\n+  </feature>\n+</target>"
    },
    {
      "sha": "d21f6fdb63cb094f1e2c127f6211b168620fbead",
      "filename": "gdb/target-descriptions.c",
      "status": "modified",
      "additions": 73,
      "deletions": 12,
      "changes": 85,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/target-descriptions.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/ab33b15255460ac45a001c8ebf69ef73f6f1fba4/gdb/target-descriptions.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/target-descriptions.c?ref=ab33b15255460ac45a001c8ebf69ef73f6f1fba4",
      "patch": "@@ -1731,12 +1731,45 @@ tdesc_get_features_xml (const target_desc *tdesc)\n   return tdesc->xmltarget;\n }\n \n+/* Data structures and functions to setup the option flags for 'maintenance\n+   print c-tdesc command.  */\n+\n+struct maint_print_c_tdesc_options\n+{\n+  /* True when the '-single-feature' flag was passed.  */\n+  bool single_feature = false;\n+};\n+\n+using maint_print_c_tdesc_opt_def\n+  = gdb::option::flag_option_def<maint_print_c_tdesc_options>;\n+\n+static const gdb::option::option_def maint_print_c_tdesc_opt_defs[] = {\n+  maint_print_c_tdesc_opt_def {\n+    \"single-feature\",\n+    [] (maint_print_c_tdesc_options *opt) { return &opt->single_feature; },\n+    N_(\"Print C description of just a single feature.\")\n+  },\n+};\n+\n+static inline gdb::option::option_def_group\n+make_maint_print_c_tdesc_options_def_group (maint_print_c_tdesc_options *opts)\n+{\n+  return {{maint_print_c_tdesc_opt_defs}, opts};\n+}\n+\n+/* Implement 'maintenance print c-tdesc' command.  */\n+\n static void\n maint_print_c_tdesc_cmd (const char *args, int from_tty)\n {\n   const struct target_desc *tdesc;\n   const char *filename;\n \n+  maint_print_c_tdesc_options opts;\n+  auto grp = make_maint_print_c_tdesc_options_def_group (&opts);\n+  gdb::option::process_options\n+    (&args, gdb::option::PROCESS_OPTIONS_UNKNOWN_IS_ERROR, grp);\n+\n   if (args == NULL)\n     {\n       /* Use the global target-supplied description, not the current\n@@ -1768,15 +1801,12 @@ maint_print_c_tdesc_cmd (const char *args, int from_tty)\n   /* Print c files for target features instead of target descriptions,\n      because c files got from target features are more flexible than the\n      counterparts.  */\n-  if (startswith (filename_after_features.c_str (), \"i386/32bit-\")\n-      || startswith (filename_after_features.c_str (), \"i386/64bit-\")\n-      || startswith (filename_after_features.c_str (), \"i386/x32-core.xml\")\n-      || startswith (filename_after_features.c_str (), \"riscv/\")\n-      || startswith (filename_after_features.c_str (), \"tic6x-\")\n-      || startswith (filename_after_features.c_str (), \"aarch64\")\n-      || startswith (filename_after_features.c_str (), \"arm/\")\n-      || startswith (filename_after_features.c_str (), \"arc/\"))\n+  if (opts.single_feature)\n     {\n+      if (tdesc->features.size () != 1)\n+\terror (_(\"only target descriptions with 1 feature can be used \"\n+\t\t \"with -single-feature option\"));\n+\n       print_c_feature v (filename_after_features);\n \n       tdesc->accept (v);\n@@ -1789,6 +1819,22 @@ maint_print_c_tdesc_cmd (const char *args, int from_tty)\n     }\n }\n \n+/* Completer for the \"backtrace\" command.  */\n+\n+static void\n+maint_print_c_tdesc_cmd_completer (struct cmd_list_element *ignore,\n+\t\t\t\t   completion_tracker &tracker,\n+\t\t\t\t   const char *text, const char *word)\n+{\n+  auto grp = make_maint_print_c_tdesc_options_def_group (nullptr);\n+  if (gdb::option::complete_options\n+      (tracker, &text, gdb::option::PROCESS_OPTIONS_UNKNOWN_IS_ERROR, grp))\n+    return;\n+\n+  word = advance_to_filename_complete_word_point (tracker, text);\n+  filename_completer (ignore, tracker, text, word);\n+}\n+\n /* Implement the maintenance print xml-tdesc command.  */\n \n static void\n@@ -1951,10 +1997,25 @@ Unset the file to read for an XML target description.\\n\\\n When unset, GDB will read the description from the target.\"),\n \t   &tdesc_unset_cmdlist);\n \n-  cmd = add_cmd (\"c-tdesc\", class_maintenance, maint_print_c_tdesc_cmd, _(\"\\\n-Print the current target description as a C source file.\"),\n-\t   &maintenanceprintlist);\n-  set_cmd_completer (cmd, filename_completer);\n+  auto grp = make_maint_print_c_tdesc_options_def_group (nullptr);\n+  static std::string help_text\n+    = gdb::option::build_help (_(\"\\\n+Print the current target description as a C source file.\\n\\\n+Usage: maintenance print c-tdesc [OPTION] [FILENAME]\\n\\\n+\\n\\\n+Options:\\n\\\n+%OPTIONS%\\n\\\n+\\n\\\n+When FILENAME is not provided then print the current target\\n\\\n+description, otherwise an XML target description is read from\\n\\\n+FILENAME and printed as a C function.\\n\\\n+\\n\\\n+When '-single-feature' is used then the target description should\\n\\\n+contain a single feature and the generated C code will only create\\n\\\n+that feature within an already existing target_desc object.\"), grp);\n+  cmd = add_cmd (\"c-tdesc\", class_maintenance, maint_print_c_tdesc_cmd,\n+\t\t help_text.c_str (), &maintenanceprintlist);\n+  set_cmd_completer_handle_brkchars (cmd, maint_print_c_tdesc_cmd_completer);\n \n   cmd = add_cmd (\"xml-tdesc\", class_maintenance, maint_print_xml_tdesc_cmd, _(\"\\\n Print the current target description as an XML file.\"),"
    }
  ]
}