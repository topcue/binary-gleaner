{
  "sha": "cf11ebea1206a7c459a94fef8e0880087dd9f38f",
  "node_id": "C_kwDOANOeidoAKGNmMTFlYmVhMTIwNmE3YzQ1OWE5NGZlZjhlMDg4MDA4N2RkOWYzOGY",
  "commit": {
    "author": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-09-21T23:34:00Z"
    },
    "committer": {
      "name": "Alan Modra",
      "email": "amodra@gmail.com",
      "date": "2021-09-22T00:54:05Z"
    },
    "message": "dwarf2 sub-section test\n\nThis is a testcase for the bug fixed by commit 5b4846283c3d.  When\nrunning the testcase on ia64 targets I found timeouts along with lots\nof memory being consumed, due to ia64 gas not tracking text\nsub-sections.  Trying to add nops for \".nop 16\" in \".text 1\" resulting\nin them being added to subsegment 0, with no increase to subsegment 1\nsize.  This patch also fixes that problem.\n\nNote that the testcase fails on ft32-elf, mn10200-elf, score-elf,\ntic5x-elf, and xtensa-elf.  The first two are relocation errors, the\nlast three appear to be the .nop directive failing to emit the right\nnumber of nops.  I didn't XFAIL any of them.\n\n\t* config/tc-ia64.c (md): Add last_text_subseg.\n\t(ia64_flush_insns, dot_endp): Use last_text_subseg.\n\t(ia64_frob_label, md_assemble): Set last_text_subseg.\n\t* testsuite/gas/elf/dwarf2-21.d,\n\t* testsuite/gas/elf/dwarf2-21.s: New test.\n\t* testsuite/gas/elf/elf.exp: Run it.",
    "tree": {
      "sha": "40ac307ae5a4110f0516a5e19b43e65c81bd7d2a",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/40ac307ae5a4110f0516a5e19b43e65c81bd7d2a"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/cf11ebea1206a7c459a94fef8e0880087dd9f38f",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cf11ebea1206a7c459a94fef8e0880087dd9f38f",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/cf11ebea1206a7c459a94fef8e0880087dd9f38f",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cf11ebea1206a7c459a94fef8e0880087dd9f38f/comments",
  "author": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "amodra",
    "id": 6006325,
    "node_id": "MDQ6VXNlcjYwMDYzMjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6006325?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/amodra",
    "html_url": "https://github.com/amodra",
    "followers_url": "https://api.github.com/users/amodra/followers",
    "following_url": "https://api.github.com/users/amodra/following{/other_user}",
    "gists_url": "https://api.github.com/users/amodra/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/amodra/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/amodra/subscriptions",
    "organizations_url": "https://api.github.com/users/amodra/orgs",
    "repos_url": "https://api.github.com/users/amodra/repos",
    "events_url": "https://api.github.com/users/amodra/events{/privacy}",
    "received_events_url": "https://api.github.com/users/amodra/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "ed41b9cdb293630d57d294d756f8d08b0cff983d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/ed41b9cdb293630d57d294d756f8d08b0cff983d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/ed41b9cdb293630d57d294d756f8d08b0cff983d"
    }
  ],
  "stats": {
    "total": 34,
    "additions": 32,
    "deletions": 2
  },
  "files": [
    {
      "sha": "4fa7f767f123949d4579c0254e930cfcda829c36",
      "filename": "gas/config/tc-ia64.c",
      "status": "modified",
      "additions": 5,
      "deletions": 2,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/config/tc-ia64.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/config/tc-ia64.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/config/tc-ia64.c?ref=cf11ebea1206a7c459a94fef8e0880087dd9f38f",
      "patch": "@@ -306,6 +306,7 @@ static struct\n     slot[NUM_SLOTS];\n \n     segT last_text_seg;\n+    subsegT last_text_subseg;\n \n     struct dynreg\n       {\n@@ -952,7 +953,7 @@ ia64_flush_insns (void)\n   saved_seg = now_seg;\n   saved_subseg = now_subseg;\n \n-  subseg_set (md.last_text_seg, 0);\n+  subseg_set (md.last_text_seg, md.last_text_subseg);\n \n   while (md.num_slots_in_use > 0)\n     emit_one_bundle ();\t\t/* force out queued instructions */\n@@ -4410,7 +4411,7 @@ dot_endp (int dummy ATTRIBUTE_UNUSED)\n     {\n       symbolS *proc_end;\n \n-      subseg_set (md.last_text_seg, 0);\n+      subseg_set (md.last_text_seg, md.last_text_subseg);\n       proc_end = expr_build_dot ();\n \n       start_unwind_section (saved_seg, SPECIAL_SECTION_UNWIND);\n@@ -7767,6 +7768,7 @@ ia64_frob_label (struct symbol *sym)\n   if (bfd_section_flags (now_seg) & SEC_CODE)\n     {\n       md.last_text_seg = now_seg;\n+      md.last_text_subseg = now_subseg;\n       fix = XOBNEW (&notes, struct label_fix);\n       fix->sym = sym;\n       fix->next = CURR_SLOT.label_fixups;\n@@ -10854,6 +10856,7 @@ md_assemble (char *str)\n     insn_group_break (1, 0, 0);\n \n   md.last_text_seg = now_seg;\n+  md.last_text_subseg = now_subseg;\n \n  done:\n   input_line_pointer = saved_input_line_pointer;"
    },
    {
      "sha": "16fa317be6643d354a59b528893c712ad26e1f20",
      "filename": "gas/testsuite/gas/elf/dwarf2-21.d",
      "status": "added",
      "additions": 18,
      "deletions": 0,
      "changes": 18,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/testsuite/gas/elf/dwarf2-21.d",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/testsuite/gas/elf/dwarf2-21.d",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/dwarf2-21.d?ref=cf11ebea1206a7c459a94fef8e0880087dd9f38f",
      "patch": "@@ -0,0 +1,18 @@\n+#name: DWARF2 21\n+#as: -gdwarf-2\n+#readelf: -wL\n+# Note that non-zero view numbers are allowed here.  This doesn't really\n+# make much sense, but DW_LNS_fixed_advance_pc is defined to not set the\n+# view back to zero in contrast with all other changes in PC.  A number\n+# of targets always use DW_LNS_fixed_advance_pc in their gas-generated\n+# line info.\n+\n+Contents of the \\.debug_line section:\n+\n+CU: (.*/elf/dwarf2-21|tmpdir/asm)\\.s:\n+File name +Line number +Starting address +View +Stmt\n+(dwarf2-21|asm)\\.s +2 +0 +x\n+(dwarf2-21|asm)\\.s +4 +0x10(| +1) +x\n+(dwarf2-21|asm)\\.s +8 +0x20(| +2) +x\n+(dwarf2-21|asm)\\.s +6 +0x30(| +3) +x\n+(dwarf2-21|asm)\\.s +- +0x40"
    },
    {
      "sha": "8c91043a054e7cf32f826865b2c4d2601f29359e",
      "filename": "gas/testsuite/gas/elf/dwarf2-21.s",
      "status": "added",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/testsuite/gas/elf/dwarf2-21.s",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/testsuite/gas/elf/dwarf2-21.s",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/dwarf2-21.s?ref=cf11ebea1206a7c459a94fef8e0880087dd9f38f",
      "patch": "@@ -0,0 +1,8 @@\n+\t.text\n+\t.nop 16\n+\t.text 1\n+\t.nop 16\n+\t.text 3\n+\t.nop 16\n+\t.text 2\n+\t.nop 16"
    },
    {
      "sha": "ab86264097470ca104f613fa023002ed0e3d3bbb",
      "filename": "gas/testsuite/gas/elf/elf.exp",
      "status": "modified",
      "additions": 1,
      "deletions": 0,
      "changes": 1,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/testsuite/gas/elf/elf.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cf11ebea1206a7c459a94fef8e0880087dd9f38f/gas/testsuite/gas/elf/elf.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gas/testsuite/gas/elf/elf.exp?ref=cf11ebea1206a7c459a94fef8e0880087dd9f38f",
      "patch": "@@ -296,6 +296,7 @@ if { [is_elf_format] } then {\n     run_dump_test \"dwarf2-18\" $dump_opts\n     run_dump_test \"dwarf2-19\" $dump_opts\n     run_dump_test \"dwarf2-20\" $dump_opts\n+    run_dump_test \"dwarf2-21\" $dump_opts\n     run_dump_test \"dwarf-5-file0\" $dump_opts\n     run_dump_test \"dwarf-5-file0-2\" $dump_opts\n     run_dump_test \"dwarf-5-dir0\" $dump_opts"
    }
  ]
}