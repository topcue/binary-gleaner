{
  "sha": "c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
  "node_id": "C_kwDOANOeidoAKGMxZTM1YmM5YzZiOWQ3ZWZlMGY3MjAzOTRiMWZlYmU3MWJiYzcyOGI",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-11-20T03:31:55Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2022-02-06T20:48:19Z"
    },
    "message": "gdb: remove COMPUNIT_BLOCK_LINE_SECTION macro, add getter/setter\n\nAdd a getter and a setter for a compunit_symtab's block line section.  Remove\nthe corresponding macro and adjust all callers.\n\nChange-Id: I3eb1a323388ad55eae8bfa45f5bc4a08dc3df455",
    "tree": {
      "sha": "8b0481da88602b1f00848f161d7493612ca179c8",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8b0481da88602b1f00848f161d7493612ca179c8"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "af39c5c8749757724a0f62dcb51be59cf3ecc678",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/af39c5c8749757724a0f62dcb51be59cf3ecc678",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/af39c5c8749757724a0f62dcb51be59cf3ecc678"
    }
  ],
  "stats": {
    "total": 25,
    "additions": 17,
    "deletions": 8
  },
  "files": [
    {
      "sha": "1b162dac9e07e87039b22649936ade969cbd84b5",
      "filename": "gdb/buildsym.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/buildsym.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/buildsym.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/buildsym.c?ref=c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
      "patch": "@@ -1022,7 +1022,7 @@ buildsym_compunit::end_symtab_with_blockvector (struct block *static_block,\n     set_block_compunit_symtab (b, cu);\n   }\n \n-  COMPUNIT_BLOCK_LINE_SECTION (cu) = section;\n+  cu->set_block_line_section (section);\n \n   COMPUNIT_MACRO_TABLE (cu) = release_macros ();\n "
    },
    {
      "sha": "bf3cadba87eefc6c47258d193b8b5206d9d9d4b9",
      "filename": "gdb/dwarf2/loc.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/dwarf2/loc.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/dwarf2/loc.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/loc.c?ref=c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
      "patch": "@@ -717,7 +717,7 @@ call_site_to_target_addr (struct gdbarch *call_site_gdbarch,\n       {\n \tdwarf2_per_objfile *per_objfile = call_site->per_objfile;\n \tcompunit_symtab *cust = per_objfile->get_symtab (call_site->per_cu);\n-\tint sect_idx = COMPUNIT_BLOCK_LINE_SECTION (cust);\n+\tint sect_idx = cust->block_line_section ();\n \tCORE_ADDR delta = per_objfile->objfile->section_offsets[sect_idx];\n \n \treturn call_site->target.loc_physaddr () + delta;"
    },
    {
      "sha": "7958447331055be51d56626fbb3a31547fe14916",
      "filename": "gdb/gdbtypes.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/gdbtypes.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/gdbtypes.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/gdbtypes.c?ref=c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
      "patch": "@@ -6285,7 +6285,7 @@ call_site::pc () const\n {\n   compunit_symtab *cust = this->per_objfile->get_symtab (this->per_cu);\n   CORE_ADDR delta\n-\t= this->per_objfile->objfile->section_offsets[COMPUNIT_BLOCK_LINE_SECTION (cust)];\n+\t= this->per_objfile->objfile->section_offsets[cust->block_line_section ()];\n   return m_unrelocated_pc + delta;\n }\n "
    },
    {
      "sha": "7e1ec6ca92dddbfe94ee9c6f7981c1b3b938a74f",
      "filename": "gdb/objfiles.c",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/objfiles.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/objfiles.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/objfiles.c?ref=c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
      "patch": "@@ -660,15 +660,15 @@ objfile_relocate1 (struct objfile *objfile,\n \t    if (l)\n \t      {\n \t\tfor (int i = 0; i < l->nitems; ++i)\n-\t\t  l->item[i].pc += delta[COMPUNIT_BLOCK_LINE_SECTION (cust)];\n+\t\t  l->item[i].pc += delta[cust->block_line_section ()];\n \t      }\n \t  }\n       }\n \n     for (compunit_symtab *cust : objfile->compunits ())\n       {\n \tconst struct blockvector *bv = cust->blockvector ();\n-\tint block_line_section = COMPUNIT_BLOCK_LINE_SECTION (cust);\n+\tint block_line_section = cust->block_line_section ();\n \n \tif (BLOCKVECTOR_MAP (bv))\n \t  addrmap_relocate (BLOCKVECTOR_MAP (bv), delta[block_line_section]);"
    },
    {
      "sha": "70a9f10ea4b6b4133bd878908745d261fc78e323",
      "filename": "gdb/symtab.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/symtab.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/symtab.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.c?ref=c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
      "patch": "@@ -338,7 +338,7 @@ compunit_symtab::find_call_site (CORE_ADDR pc) const\n     return nullptr;\n \n   CORE_ADDR delta\n-    = this->objfile ()->section_offsets[COMPUNIT_BLOCK_LINE_SECTION (this)];\n+    = this->objfile ()->section_offsets[this->block_line_section ()];\n   CORE_ADDR unrelocated_pc = pc - delta;\n \n   struct call_site call_site_local (unrelocated_pc, nullptr, nullptr);"
    },
    {
      "sha": "c59e3c3457c7d7879bbd61d1f6e75cdb0cf36f74",
      "filename": "gdb/symtab.h",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/symtab.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c1e35bc9c6b9d7efe0f720394b1febe71bbc728b/gdb/symtab.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.h?ref=c1e35bc9c6b9d7efe0f720394b1febe71bbc728b",
      "patch": "@@ -1521,6 +1521,16 @@ struct compunit_symtab\n     m_blockvector = blockvector;\n   }\n \n+  int block_line_section () const\n+  {\n+    return m_block_line_section;\n+  }\n+\n+  void set_block_line_section (int block_line_section)\n+  {\n+    m_block_line_section = block_line_section;\n+  }\n+\n   /* Make PRIMARY_FILETAB the primary filetab of this compunit symtab.\n \n      PRIMARY_FILETAB must already be a filetab of this compunit symtab.  */\n@@ -1578,7 +1588,7 @@ struct compunit_symtab\n \n   /* Section in objfile->section_offsets for the blockvector and\n      the linetable.  Probably always SECT_OFF_TEXT.  */\n-  int block_line_section;\n+  int m_block_line_section;\n \n   /* Symtab has been compiled with both optimizations and debug info so that\n      GDB may stop skipping prologues as variables locations are valid already\n@@ -1616,7 +1626,6 @@ struct compunit_symtab\n \n using compunit_symtab_range = next_range<compunit_symtab>;\n \n-#define COMPUNIT_BLOCK_LINE_SECTION(cust) ((cust)->block_line_section)\n #define COMPUNIT_LOCATIONS_VALID(cust) ((cust)->locations_valid)\n #define COMPUNIT_EPILOGUE_UNWIND_VALID(cust) ((cust)->epilogue_unwind_valid)\n #define COMPUNIT_MACRO_TABLE(cust) ((cust)->macro_table)"
    }
  ]
}