{
  "sha": "7bede82892a06e6c26989803e70f53697392dcf9",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6N2JlZGU4Mjg5MmEwNmU2YzI2OTg5ODAzZTcwZjUzNjk3MzkyZGNmOQ==",
  "commit": {
    "author": {
      "name": "Sergio Durigan Junior",
      "email": "sergiodj@redhat.com",
      "date": "2019-05-10T20:57:26Z"
    },
    "committer": {
      "name": "Sergio Durigan Junior",
      "email": "sergiodj@redhat.com",
      "date": "2019-05-15T13:57:45Z"
    },
    "message": "Don't crash if dwarf_decode_macro_bytes's 'body' is NULL\n\nHi,\n\nRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1708192\n      https://bugzilla.redhat.com/show_bug.cgi?id=1708786\n\nDuring the Fedora RPM build process, gdb-add-index is invoked to\nextract the DWARF index from the binary, and GDB will segfault because\ndwarf2read.c:parse_definition_macro's 'body' variable is NULL.\n\nThe underlying problem is that Fedora's rpm-build's \"debugedit\"\nprogram will silently corrupt .debug_macro strings when a binary is\ncompiled with -g3.  This is being taken care of by Mark Wielaard,\nhere:\n\n  https://bugzilla.redhat.com/show_bug.cgi?id=1708786\n\nHowever, I still feel it's important to make GDB more resilient\nagainst invalid DWARF input, so I'm proposing this rather simple patch\nto catch the situation when \"body == NULL\" (i.e., it's probably been\ncorrupted) and issue a complaint.  This is not a real fix to the\nproblem, of course, but at least GDB is able to finish without\nsegfaulting.\n\nOK for master?\n\ngdb/ChangeLog:\n2019-05-15  Sergio Durigan Junior  <sergiodj@redhat.com>\n\n\tRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1708192\n\t* dwarf2read.c (dwarf_decode_macro_bytes): Check whether 'body' is\n\tNULL, and complain if that's the case.",
    "tree": {
      "sha": "5edec90b19a8c81d37c6903d0b563bcbe289a724",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/5edec90b19a8c81d37c6903d0b563bcbe289a724"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/7bede82892a06e6c26989803e70f53697392dcf9",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7bede82892a06e6c26989803e70f53697392dcf9",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/7bede82892a06e6c26989803e70f53697392dcf9",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/7bede82892a06e6c26989803e70f53697392dcf9/comments",
  "author": null,
  "committer": null,
  "parents": [
    {
      "sha": "905f5b3f1d20569e2788add66687e6de11130159",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/905f5b3f1d20569e2788add66687e6de11130159",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/905f5b3f1d20569e2788add66687e6de11130159"
    }
  ],
  "stats": {
    "total": 25,
    "additions": 24,
    "deletions": 1
  },
  "files": [
    {
      "sha": "3aaeb927543d897548109f7db0c9fcd5c1f4ece7",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7bede82892a06e6c26989803e70f53697392dcf9/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7bede82892a06e6c26989803e70f53697392dcf9/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=7bede82892a06e6c26989803e70f53697392dcf9",
      "patch": "@@ -1,3 +1,9 @@\n+2019-05-15  Sergio Durigan Junior  <sergiodj@redhat.com>\n+\n+\tRef.: https://bugzilla.redhat.com/show_bug.cgi?id=1708192\n+\t* dwarf2read.c (parse_macro_definition): Check whether 'body' is\n+\tNULL, and complain/return if that's the case.\n+\n 2019-05-15  John Darrington <john@darrington.wattle.id.au>\n \n \t* s12z-tdep.c (push_pull_get_stack_adjustment): New function."
    },
    {
      "sha": "0e3f37ff742d91d6ab08ba6c90485cec783fc1ca",
      "filename": "gdb/dwarf2read.c",
      "status": "modified",
      "additions": 18,
      "deletions": 1,
      "changes": 19,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/7bede82892a06e6c26989803e70f53697392dcf9/gdb/dwarf2read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/7bede82892a06e6c26989803e70f53697392dcf9/gdb/dwarf2read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2read.c?ref=7bede82892a06e6c26989803e70f53697392dcf9",
      "patch": "@@ -24609,7 +24609,24 @@ dwarf_decode_macro_bytes (struct dwarf2_cu *cu,\n \t\t\t line == 0 ? _(\"zero\") : _(\"non-zero\"), line, body);\n \n \t    if (is_define)\n-\t      parse_macro_definition (current_file, line, body);\n+\t      {\n+\t\tif (body != NULL)\n+\t\t  parse_macro_definition (current_file, line, body);\n+\t\telse\n+\t\t  {\n+\t\t    /* Fedora's rpm-build's \"debugedit\" binary\n+\t\t       corrupted .debug_macro sections.\n+\n+\t\t       For more info, see\n+\t\t       https://bugzilla.redhat.com/show_bug.cgi?id=1708786 */\n+\t\t    complaint (_(\"debug info gives %s invalid macro definition \"\n+\t\t\t\t \"without body (corrupted?) at line %d\"\n+\t\t\t\t \"on file %s\"),\n+\t\t\t       at_commandline ? _(\"command-line\")\n+\t\t\t       : _(\"in-file\"),\n+\t\t\t       line, current_file->filename);\n+\t\t  }\n+\t      }\n \t    else\n \t      {\n \t\tgdb_assert (macinfo_type == DW_MACRO_undef"
    }
  ]
}