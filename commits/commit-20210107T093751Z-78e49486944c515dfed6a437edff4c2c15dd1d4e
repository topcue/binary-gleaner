{
  "sha": "78e49486944c515dfed6a437edff4c2c15dd1d4e",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6NzhlNDk0ODY5NDRjNTE1ZGZlZDZhNDM3ZWRmZjRjMmMxNWRkMWQ0ZQ==",
  "commit": {
    "author": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-01-07T09:37:51Z"
    },
    "committer": {
      "name": "Tom de Vries",
      "email": "tdevries@suse.de",
      "date": "2021-01-07T09:37:51Z"
    },
    "message": "[gdb/build] Fix gdbserver build with -fsanitize=address\n\nWhen doing a gdbserver build with CFLAGS/CXXFLAGS/LDFLAGS=-fsanitize=address\nwe run into:\n...\nld: ../libiberty/libiberty.a(safe-ctype.o):\nrelocation R_X86_64_32 against `.data' can not be used when making a\nshared object; recompile with -fPIC\ncollect2: error: ld returned 1 exit status\nmake[1]: *** [libinproctrace.so] Error 1\n...\n\nThis started with commit 96648494173 \"gdbsupport: make use of safe-ctype\nfunctions from libiberty\", which introduced a dependency of libinproctrace.so\non libiberty.\n\nFix this in gdbserver/Makefile.in by using a setup similar to what is done in\ngcc-repo/src/libcc1/Makefile.am, such that ../libiberty/noasan/libiberty.a is\nused instead.\n\nBuild on x86_64-linux, both with and without -fsanitize=address.\n\ngdbserver/ChangeLog:\n\n2021-01-07  Tom de Vries  <tdevries@suse.de>\n\n\t* Makefile.in (LIBIBERTY_NORMAL, LIBIBERTY_NOASAN, LIBIBERTY_PIC):\n\t(LIBIBERTY_FOR_SHLIB): New var.\n\t(LIBIBERTY): Set using $(LIBIBERTY_NORMAL).\n\t(IPA_LIB): Use LIBIBERTY_FOR_SHLIB instead of LIBIBERTY in target rule.",
    "tree": {
      "sha": "db3a1596978393a781df04f97d552bd9ab524305",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/db3a1596978393a781df04f97d552bd9ab524305"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/78e49486944c515dfed6a437edff4c2c15dd1d4e",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/78e49486944c515dfed6a437edff4c2c15dd1d4e",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/78e49486944c515dfed6a437edff4c2c15dd1d4e",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/78e49486944c515dfed6a437edff4c2c15dd1d4e/comments",
  "author": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "vries",
    "id": 4057235,
    "node_id": "MDQ6VXNlcjQwNTcyMzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4057235?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vries",
    "html_url": "https://github.com/vries",
    "followers_url": "https://api.github.com/users/vries/followers",
    "following_url": "https://api.github.com/users/vries/following{/other_user}",
    "gists_url": "https://api.github.com/users/vries/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vries/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vries/subscriptions",
    "organizations_url": "https://api.github.com/users/vries/orgs",
    "repos_url": "https://api.github.com/users/vries/repos",
    "events_url": "https://api.github.com/users/vries/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vries/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "aa881ecde48c7a0224b92e2cfa43b37ee9ec9fa2",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/aa881ecde48c7a0224b92e2cfa43b37ee9ec9fa2",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/aa881ecde48c7a0224b92e2cfa43b37ee9ec9fa2"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 18,
    "deletions": 2
  },
  "files": [
    {
      "sha": "3323ecfbf895c4f03c10d0e664517eebf418b4b9",
      "filename": "gdbserver/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/78e49486944c515dfed6a437edff4c2c15dd1d4e/gdbserver/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/78e49486944c515dfed6a437edff4c2c15dd1d4e/gdbserver/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/ChangeLog?ref=78e49486944c515dfed6a437edff4c2c15dd1d4e",
      "patch": "@@ -1,3 +1,10 @@\n+2021-01-07  Tom de Vries  <tdevries@suse.de>\n+\n+\t* Makefile.in (LIBIBERTY_NORMAL, LIBIBERTY_NOASAN, LIBIBERTY_PIC):\n+\t(LIBIBERTY_FOR_SHLIB): New var.\n+\t(LIBIBERTY): Set using $(LIBIBERTY_NORMAL).\n+\t(IPA_LIB): Use LIBIBERTY_FOR_SHLIB instead of LIBIBERTY in target rule.\n+\n 2021-01-04  Simon Marchi  <simon.marchi@efficios.com>\n \n \t* debug.cc (debug_print_depth): New."
    },
    {
      "sha": "a14d3a7bc18fbd75330e1eb427c6d484c2304f9c",
      "filename": "gdbserver/Makefile.in",
      "status": "modified",
      "additions": 11,
      "deletions": 2,
      "changes": 13,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/78e49486944c515dfed6a437edff4c2c15dd1d4e/gdbserver/Makefile.in",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/78e49486944c515dfed6a437edff4c2c15dd1d4e/gdbserver/Makefile.in",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdbserver/Makefile.in?ref=78e49486944c515dfed6a437edff4c2c15dd1d4e",
      "patch": "@@ -103,7 +103,16 @@ INCLUDE_DIR = ${srcdir}/../include\n INCLUDE_DEP = $$(INCLUDE_DIR)\n \n LIBIBERTY_BUILDDIR = ../libiberty\n-LIBIBERTY = $(LIBIBERTY_BUILDDIR)/libiberty.a\n+LIBIBERTY_NORMAL = $(LIBIBERTY_BUILDDIR)/libiberty.a\n+LIBIBERTY_NOASAN = $(LIBIBERTY_BUILDDIR)/noasan/libiberty.a\n+LIBIBERTY_PIC = $(LIBIBERTY_BUILDDIR)/pic/libiberty.a\n+LIBIBERTY_FOR_SHLIB = \\\n+  $(if $(wildcard $(LIBIBERTY_NOASAN)),\\\n+       $(LIBIBERTY_NOASAN),\\\n+       $(if $(wildcard $(LIBIBERTY_PIC)),\\\n+\t    $(LIBIBERTY_PIC),\\\n+\t    $(LIBIBERTY_NORMAL)))\n+LIBIBERTY = $(LIBIBERTY_NORMAL)\n \n GDBSUPPORT_BUILDDIR = ../gdbsupport\n GDBSUPPORT = $(GDBSUPPORT_BUILDDIR)/libgdbsupport.a\n@@ -395,7 +404,7 @@ $(IPA_LIB): $(sort $(IPA_OBJS)) ${CDEPS}\n \t$(ECHO_CXXLD) $(CC_LD) -shared -fPIC -Wl,--soname=$(IPA_LIB) \\\n \t\t-Wl,--no-undefined $(INTERNAL_CFLAGS) $(INTERNAL_LDFLAGS) \\\n \t\t $(CXXFLAGS) \\\n-\t\t-o $(IPA_LIB) ${IPA_OBJS} $(LIBIBERTY) -ldl -pthread\n+\t\t-o $(IPA_LIB) ${IPA_OBJS} $(LIBIBERTY_FOR_SHLIB) -ldl -pthread\n \n # Put the proper machine-specific files first, so M-. on a machine\n # specific routine gets the one for the correct machine."
    }
  ]
}