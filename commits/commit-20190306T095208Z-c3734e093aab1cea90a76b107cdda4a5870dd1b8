{
  "sha": "c3734e093aab1cea90a76b107cdda4a5870dd1b8",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6YzM3MzRlMDkzYWFiMWNlYTkwYTc2YjEwN2NkZGE0YTU4NzBkZDFiOA==",
  "commit": {
    "author": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-03-06T09:52:08Z"
    },
    "committer": {
      "name": "Alan Hayward",
      "email": "alan.hayward@arm.com",
      "date": "2019-03-06T09:52:08Z"
    },
    "message": "Testsuite: Ensure changing directory does not break the log file\n\nget_compiler_info switches to a new log file before checking the compiler\nto ensure the checks are not logged. Afterwards it restores back to using\nthe original log file. However, the logfile uses a relative path name -\nif the current test has changed the current directory then all further\noutput for the test will be lost.  This can confuse the code that collates\nthe main gdb.log file at the end of a FORCE_PARALLEL run.\n\nfullpath-expand.exp calls gdb_compile after changing the current directory.\n\nThe \"Ensure stack protection is off for GCC\" patch added a call to\nget_compiler_info from inside of gdb_compile, causing log file collection\nto break for FORCE_PARALLEL runs.\n\nThe ideal solution would be to ensure the log file is always created using\nan absolute path name. However, this is set at multiple points in\nMakefile.in and in some instances just relies on dejagnu common code to set\nthe log file directory to \".\"\n\nThe simpler and safer solution is to override the builtin cd function. The\nnew function checks the current log file and if the path is relative, then\nit resets the logging using an absolute path. Finally it calls the builtin\ncd.  This ensures get_compiler_info (and any other code) can correctly\nbackup and restore the current log file.\n\ngdb/testsuite/ChangeLog:\n\n\t* lib/gdb.exp (builtin_cd): rename of cd.\n\t(cd): Override builtin.",
    "tree": {
      "sha": "a57fbe6009b8e2601c283f90ee332a8d52b114e4",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/a57fbe6009b8e2601c283f90ee332a8d52b114e4"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/c3734e093aab1cea90a76b107cdda4a5870dd1b8",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c3734e093aab1cea90a76b107cdda4a5870dd1b8",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/c3734e093aab1cea90a76b107cdda4a5870dd1b8",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/c3734e093aab1cea90a76b107cdda4a5870dd1b8/comments",
  "author": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "a74nh",
    "id": 4146708,
    "node_id": "MDQ6VXNlcjQxNDY3MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4146708?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/a74nh",
    "html_url": "https://github.com/a74nh",
    "followers_url": "https://api.github.com/users/a74nh/followers",
    "following_url": "https://api.github.com/users/a74nh/following{/other_user}",
    "gists_url": "https://api.github.com/users/a74nh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/a74nh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/a74nh/subscriptions",
    "organizations_url": "https://api.github.com/users/a74nh/orgs",
    "repos_url": "https://api.github.com/users/a74nh/repos",
    "events_url": "https://api.github.com/users/a74nh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/a74nh/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "219d6836e939d2cd1a8c5574bfa3a101daa31cbb",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/219d6836e939d2cd1a8c5574bfa3a101daa31cbb",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/219d6836e939d2cd1a8c5574bfa3a101daa31cbb"
    }
  ],
  "stats": {
    "total": 45,
    "additions": 43,
    "deletions": 2
  },
  "files": [
    {
      "sha": "ea98977ad1a1bdc7dd44447a4a2694a0388c8615",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3734e093aab1cea90a76b107cdda4a5870dd1b8/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3734e093aab1cea90a76b107cdda4a5870dd1b8/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=c3734e093aab1cea90a76b107cdda4a5870dd1b8",
      "patch": "@@ -1,3 +1,8 @@\n+2019-03-06  Alan Hayward  <alan.hayward@arm.com>\n+\n+\t* lib/gdb.exp (builtin_cd): rename of cd.\n+\t(cd): Override builtin.\n+\n 2019-03-06  Richard Bunt  <richard.bunt@arm.com>\n \n \t* gdb.fortran/function-calls.exp: New file.\n@@ -12,8 +17,8 @@\n \n 2019-02-28  Alan Hayward  <alan.hayward@arm.com>\n \n-        * lib/gdbserver-support.exp (gdbserver_start): Check for listen\n-        failure.\n+\t* lib/gdbserver-support.exp (gdbserver_start): Check for listen\n+\tfailure.\n \n 2019-02-28  Rainer Orth  <ro@CeBiTec.Uni-Bielefeld.DE>\n "
    },
    {
      "sha": "f13f909c34418c9f4dee2e8e7920e4be6e90a73b",
      "filename": "gdb/testsuite/lib/gdb.exp",
      "status": "modified",
      "additions": 36,
      "deletions": 0,
      "changes": 36,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/c3734e093aab1cea90a76b107cdda4a5870dd1b8/gdb/testsuite/lib/gdb.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/c3734e093aab1cea90a76b107cdda4a5870dd1b8/gdb/testsuite/lib/gdb.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/lib/gdb.exp?ref=c3734e093aab1cea90a76b107cdda4a5870dd1b8",
      "patch": "@@ -6272,5 +6272,41 @@ proc gdb_define_cmd {command command_list} {\n     }\n }\n \n+# Override the 'cd' builtin with a version that ensures that the\n+# log file keeps pointing at the same file.  We need this because\n+# unfortunately the path to the log file is recorded using an\n+# relative path name, and, we sometimes need to close/reopen the log\n+# after changing the current directory.  See get_compiler_info.\n+\n+rename cd builtin_cd\n+\n+proc cd { dir } {\n+\n+    # Get the existing log file flags.\n+    set log_file_info [log_file -info]\n+\n+    # Split the flags into args and file name.\n+    set log_file_flags \"\"\n+    set log_file_file \"\"\n+    foreach arg [ split \"$log_file_info\" \" \"] {\n+\tif [string match \"-*\" $arg] {\n+\t    lappend log_file_flags $arg\n+\t} else {\n+\t    lappend log_file_file $arg\n+\t}\n+    }\n+\n+    # If there was an existing file, ensure it is an absolute path, and then\n+    # reset logging.\n+    if { $log_file_file != \"\" } {\n+\tset log_file_file [file normalize $log_file_file]\n+\tlog_file\n+\tlog_file $log_file_flags \"$log_file_file\"\n+    }\n+\n+    # Call the builtin version of cd.\n+    builtin_cd $dir\n+}\n+\n # Always load compatibility stuff.\n load_lib future.exp"
    }
  ]
}