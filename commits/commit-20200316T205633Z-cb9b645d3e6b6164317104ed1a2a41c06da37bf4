{
  "sha": "cb9b645d3e6b6164317104ed1a2a41c06da37bf4",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6Y2I5YjY0NWQzZTZiNjE2NDMxNzEwNGVkMWEyYTQxYzA2ZGEzN2JmNA==",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2020-03-16T20:56:33Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2020-03-16T20:56:33Z"
    },
    "message": "gdb: recognize 64 bits Windows executables as Cygwin osabi\n\nIf I generate two Windows PE executables, one 32 bits and one 64 bits:\n\n    $ x86_64-w64-mingw32-gcc test.c -g3 -O0 -o test_64\n    $ i686-w64-mingw32-gcc test.c -g3 -O0 -o test_32\n    $ file test_64\n    test_64: PE32+ executable (console) x86-64, for MS Windows\n    $ file test_32\n    test_32: PE32 executable (console) Intel 80386, for MS Windows\n\nWhen I load the 32 bits binary in my GNU/Linux-hosted GDB, the osabi is\ncorrectly recognized as \"Cygwin\":\n\n    $ ./gdb --data-directory=data-directory -nx test_32\n    (gdb) show osabi\n    The current OS ABI is \"auto\" (currently \"Cygwin\").\n\nWhen I load the 64 bits binary in GDB, the osabi is incorrectly\nrecognized as \"GNU/Linux\":\n\n    $ ./gdb --data-directory=data-directory -nx test_64\n    (gdb) show osabi\n    The current OS ABI is \"auto\" (currently \"GNU/Linux\").\n\nThe 32 bits one gets recognized by the i386_cygwin_osabi_sniffer\nfunction, by its target name:\n\n    if (strcmp (target_name, \"pei-i386\") == 0)\n      return GDB_OSABI_CYGWIN;\n\nThe target name for the 64 bits binaries is \"pei-x86-64\".  It doesn't\nget recognized by any osabi sniffer, so GDB falls back on its default\nosabi, \"GNU/Linux\".\n\nThis patch adds an osabi sniffer function for the Windows 64 bits\nexecutables in amd64-windows-tdep.c.  With it, the osabi is recognized\nas \"Cygwin\", just like with the 32 bits binary.\n\nNote that it may seems strange to have a binary generated by MinGW\n(which has nothing to do with Cygwin) be recognized as a Cygwin binary.\nThis is indeed not accurate, but at the moment GDB uses the Cygwin for\neverything Windows.  Subsequent patches will add a separate \"Windows\" OS\nABI for Windows binaries that are not Cygwin binaries.\n\ngdb/ChangeLog:\n\n\t* amd64-windows-tdep.c (amd64_windows_osabi_sniffer): New\n\tfunction.\n\t(_initialize_amd64_windows_tdep): Register osabi sniffer.",
    "tree": {
      "sha": "45fe09407b97acdcd964c6cce7ce328feb949736",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/45fe09407b97acdcd964c6cce7ce328feb949736"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/cb9b645d3e6b6164317104ed1a2a41c06da37bf4",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cb9b645d3e6b6164317104ed1a2a41c06da37bf4",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/cb9b645d3e6b6164317104ed1a2a41c06da37bf4",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/cb9b645d3e6b6164317104ed1a2a41c06da37bf4/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "2f89101fe8b6a2423116a1ad1891f56bf6fc9510",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/2f89101fe8b6a2423116a1ad1891f56bf6fc9510",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/2f89101fe8b6a2423116a1ad1891f56bf6fc9510"
    }
  ],
  "stats": {
    "total": 20,
    "additions": 20,
    "deletions": 0
  },
  "files": [
    {
      "sha": "1b83f4226d2dbb85e9e25c6ef8d44181e956b1fe",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 6,
      "deletions": 0,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cb9b645d3e6b6164317104ed1a2a41c06da37bf4/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cb9b645d3e6b6164317104ed1a2a41c06da37bf4/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=cb9b645d3e6b6164317104ed1a2a41c06da37bf4",
      "patch": "@@ -1,3 +1,9 @@\n+2020-03-16  Simon Marchi  <simon.marchi@efficios.com>\n+\n+\t* amd64-windows-tdep.c (amd64_windows_osabi_sniffer): New\n+\tfunction.\n+\t(_initialize_amd64_windows_tdep): Register osabi sniffer.\n+\n 2020-03-14  Tom Tromey  <tom@tromey.com>\n \n \t* c-typeprint.c (cp_type_print_method_args): Print \"__restrict__\""
    },
    {
      "sha": "2ca979513cd7c08b3febeeb858c01b829e27afee",
      "filename": "gdb/amd64-windows-tdep.c",
      "status": "modified",
      "additions": 14,
      "deletions": 0,
      "changes": 14,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/cb9b645d3e6b6164317104ed1a2a41c06da37bf4/gdb/amd64-windows-tdep.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/cb9b645d3e6b6164317104ed1a2a41c06da37bf4/gdb/amd64-windows-tdep.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/amd64-windows-tdep.c?ref=cb9b645d3e6b6164317104ed1a2a41c06da37bf4",
      "patch": "@@ -1244,10 +1244,24 @@ amd64_windows_init_abi (struct gdbarch_info info, struct gdbarch *gdbarch)\n   set_gdbarch_auto_wide_charset (gdbarch, amd64_windows_auto_wide_charset);\n }\n \n+static gdb_osabi\n+amd64_windows_osabi_sniffer (bfd *abfd)\n+{\n+  const char *target_name = bfd_get_target (abfd);\n+\n+  if (strcmp (target_name, \"pei-x86-64\") == 0)\n+    return GDB_OSABI_CYGWIN;\n+\n+  return GDB_OSABI_UNKNOWN;\n+}\n+\n void _initialize_amd64_windows_tdep ();\n void\n _initialize_amd64_windows_tdep ()\n {\n   gdbarch_register_osabi (bfd_arch_i386, bfd_mach_x86_64, GDB_OSABI_CYGWIN,\n                           amd64_windows_init_abi);\n+\n+  gdbarch_register_osabi_sniffer (bfd_arch_i386, bfd_target_coff_flavour,\n+\t\t\t\t  amd64_windows_osabi_sniffer);\n }"
    }
  ]
}