{
  "sha": "9821f3fa56de3e2c13c234357421ae1839ce27f7",
  "node_id": "C_kwDOANOeidoAKDk4MjFmM2ZhNTZkZTNlMmMxM2MyMzQzNTc0MjFhZTE4MzljZTI3Zjc",
  "commit": {
    "author": {
      "name": "Simon Marchi",
      "email": "simon.marchi@efficios.com",
      "date": "2021-11-19T18:15:24Z"
    },
    "committer": {
      "name": "Simon Marchi",
      "email": "simon.marchi@polymtl.ca",
      "date": "2022-02-06T20:48:18Z"
    },
    "message": "gdb: remove COMPUNIT_OBJFILE macro\n\nRemove the macro, update all users to use the getter directly.\n\nChange-Id: I3f0fd6f4455d1c4ebd5da73b561eb18a979ef1f6",
    "tree": {
      "sha": "8c6ee2bcce75dce1d9b7b13b102fd373be93569f",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/8c6ee2bcce75dce1d9b7b13b102fd373be93569f"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/9821f3fa56de3e2c13c234357421ae1839ce27f7",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9821f3fa56de3e2c13c234357421ae1839ce27f7",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/9821f3fa56de3e2c13c234357421ae1839ce27f7",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/9821f3fa56de3e2c13c234357421ae1839ce27f7/comments",
  "author": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "simark",
    "id": 1758287,
    "node_id": "MDQ6VXNlcjE3NTgyODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1758287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/simark",
    "html_url": "https://github.com/simark",
    "followers_url": "https://api.github.com/users/simark/followers",
    "following_url": "https://api.github.com/users/simark/following{/other_user}",
    "gists_url": "https://api.github.com/users/simark/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/simark/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/simark/subscriptions",
    "organizations_url": "https://api.github.com/users/simark/orgs",
    "repos_url": "https://api.github.com/users/simark/repos",
    "events_url": "https://api.github.com/users/simark/events{/privacy}",
    "received_events_url": "https://api.github.com/users/simark/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "f1f58f102ee5f3dda04853582fcb6f22cc00329b",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/f1f58f102ee5f3dda04853582fcb6f22cc00329b",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/f1f58f102ee5f3dda04853582fcb6f22cc00329b"
    }
  ],
  "stats": {
    "total": 27,
    "additions": 13,
    "deletions": 14
  },
  "files": [
    {
      "sha": "617164584578c94310195c1386dad2f5928f8d08",
      "filename": "gdb/block.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/block.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/block.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/block.c?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -51,7 +51,7 @@ block_objfile (const struct block *block)\n     return symbol_objfile (BLOCK_FUNCTION (block));\n \n   global_block = (struct global_block *) block_global_block (block);\n-  return COMPUNIT_OBJFILE (global_block->compunit_symtab);\n+  return global_block->compunit_symtab->objfile ();\n }\n \n /* See block.  */"
    },
    {
      "sha": "aa7b8b56b89a5c05b885c7ed083ad720319f120d",
      "filename": "gdb/buildsym-legacy.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/buildsym-legacy.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/buildsym-legacy.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/buildsym-legacy.c?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -301,7 +301,7 @@ restart_symtab (struct compunit_symtab *cust,\n   gdb_assert (buildsym_compunit == nullptr);\n \n   buildsym_compunit\n-    = new struct buildsym_compunit (COMPUNIT_OBJFILE (cust),\n+    = new struct buildsym_compunit (cust->objfile (),\n \t\t\t\t    name,\n \t\t\t\t    COMPUNIT_DIRNAME (cust),\n \t\t\t\t    compunit_language (cust),"
    },
    {
      "sha": "fe274ed3a1f8bf0dadfc216c3c8915d262052c90",
      "filename": "gdb/dwarf2/read.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/dwarf2/read.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/dwarf2/read.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/dwarf2/read.c?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -10722,7 +10722,7 @@ dwarf2_cu::setup_type_unit_groups (struct die_info *die)\n \t  gdb_assert (m_builder == nullptr);\n \t  struct compunit_symtab *cust = tug_unshare->compunit_symtab;\n \t  m_builder.reset (new struct buildsym_compunit\n-\t\t\t   (COMPUNIT_OBJFILE (cust), \"\",\n+\t\t\t   (cust->objfile (), \"\",\n \t\t\t    COMPUNIT_DIRNAME (cust),\n \t\t\t    compunit_language (cust),\n \t\t\t    0, cust));\n@@ -10744,7 +10744,7 @@ dwarf2_cu::setup_type_unit_groups (struct die_info *die)\n \t time.  */\n \n       tug_unshare->symtabs\n-\t= XOBNEWVEC (&COMPUNIT_OBJFILE (cust)->objfile_obstack,\n+\t= XOBNEWVEC (&cust->objfile ()->objfile_obstack,\n \t\t     struct symtab *, line_header->file_names_size ());\n \n       auto &file_names = line_header->file_names ();\n@@ -10774,7 +10774,7 @@ dwarf2_cu::setup_type_unit_groups (struct die_info *die)\n       gdb_assert (m_builder == nullptr);\n       struct compunit_symtab *cust = tug_unshare->compunit_symtab;\n       m_builder.reset (new struct buildsym_compunit\n-\t\t       (COMPUNIT_OBJFILE (cust), \"\",\n+\t\t       (cust->objfile (), \"\",\n \t\t\tCOMPUNIT_DIRNAME (cust),\n \t\t\tcompunit_language (cust),\n \t\t\t0, cust));"
    },
    {
      "sha": "0c63dfb25f82a78334e05451e8e79b6d4db50e31",
      "filename": "gdb/guile/scm-block.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/guile/scm-block.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/guile/scm-block.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/guile/scm-block.c?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -685,7 +685,7 @@ gdbscm_lookup_block (SCM pc_scm)\n     {\n       cust = find_pc_compunit_symtab (pc);\n \n-      if (cust != NULL && COMPUNIT_OBJFILE (cust) != NULL)\n+      if (cust != NULL && cust->objfile () != NULL)\n \tblock = block_for_pc (pc);\n     }\n   catch (const gdb_exception &except)\n@@ -694,14 +694,14 @@ gdbscm_lookup_block (SCM pc_scm)\n     }\n \n   GDBSCM_HANDLE_GDB_EXCEPTION (exc);\n-  if (cust == NULL || COMPUNIT_OBJFILE (cust) == NULL)\n+  if (cust == NULL || cust->objfile () == NULL)\n     {\n       gdbscm_out_of_range_error (FUNC_NAME, SCM_ARG1, pc_scm,\n \t\t\t\t _(\"cannot locate object file for block\"));\n     }\n \n   if (block != NULL)\n-    return bkscm_scm_from_block (block, COMPUNIT_OBJFILE (cust));\n+    return bkscm_scm_from_block (block, cust->objfile ());\n   return SCM_BOOL_F;\n }\n \f"
    },
    {
      "sha": "1e01068c59b0f82423262d6fa8374153dc90898f",
      "filename": "gdb/python/py-progspace.c",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/python/py-progspace.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/python/py-progspace.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/python/py-progspace.c?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -388,19 +388,19 @@ pspy_block_for_pc (PyObject *o, PyObject *args)\n       set_current_program_space (self->pspace);\n       cust = find_pc_compunit_symtab (pc);\n \n-      if (cust != NULL && COMPUNIT_OBJFILE (cust) != NULL)\n+      if (cust != NULL && cust->objfile () != NULL)\n \tblock = block_for_pc (pc);\n     }\n   catch (const gdb_exception &except)\n     {\n       GDB_PY_HANDLE_EXCEPTION (except);\n     }\n \n-  if (cust == NULL || COMPUNIT_OBJFILE (cust) == NULL)\n+  if (cust == NULL || cust->objfile () == NULL)\n     Py_RETURN_NONE;\n \n   if (block)\n-    return block_to_block_object (block, COMPUNIT_OBJFILE (cust));\n+    return block_to_block_object (block, cust->objfile ());\n \n   Py_RETURN_NONE;\n }"
    },
    {
      "sha": "73c1c1d5188faf7757b46008ae64ec0c38d9a71c",
      "filename": "gdb/source.c",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/source.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/source.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/source.c?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -1186,7 +1186,7 @@ open_source_file (struct symtab *s)\n     {\n       if (SYMTAB_COMPUNIT (s) != nullptr)\n \t{\n-\t  const objfile *ofp = COMPUNIT_OBJFILE (SYMTAB_COMPUNIT (s));\n+\t  const objfile *ofp = SYMTAB_COMPUNIT (s)->objfile ();\n \n \t  std::string srcpath;\n \t  if (IS_ABSOLUTE_PATH (s->filename))"
    },
    {
      "sha": "dc15c49ec8ecc493a4f45617b6f8491b078f7ed5",
      "filename": "gdb/symtab.h",
      "status": "modified",
      "additions": 1,
      "deletions": 2,
      "changes": 3,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/symtab.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/9821f3fa56de3e2c13c234357421ae1839ce27f7/gdb/symtab.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/symtab.h?ref=9821f3fa56de3e2c13c234357421ae1839ce27f7",
      "patch": "@@ -1407,7 +1407,7 @@ struct symtab\n #define SYMTAB_BLOCKVECTOR(symtab) \\\n   COMPUNIT_BLOCKVECTOR (SYMTAB_COMPUNIT (symtab))\n #define SYMTAB_OBJFILE(symtab) \\\n-  COMPUNIT_OBJFILE (SYMTAB_COMPUNIT (symtab))\n+  (SYMTAB_COMPUNIT (symtab)->objfile ())\n #define SYMTAB_PSPACE(symtab) (SYMTAB_OBJFILE (symtab)->pspace)\n #define SYMTAB_DIRNAME(symtab) \\\n   COMPUNIT_DIRNAME (SYMTAB_COMPUNIT (symtab))\n@@ -1545,7 +1545,6 @@ struct compunit_symtab\n \n using compunit_symtab_range = next_range<compunit_symtab>;\n \n-#define COMPUNIT_OBJFILE(cust) ((cust)->objfile ())\n #define COMPUNIT_FILETABS(cust) ((cust)->filetabs)\n #define COMPUNIT_DEBUGFORMAT(cust) ((cust)->debugformat)\n #define COMPUNIT_PRODUCER(cust) ((cust)->producer)"
    }
  ]
}