{
  "sha": "207582c0758738447d2df8f778aeebf126c73b31",
  "node_id": "MDY6Q29tbWl0MTM4Njg2ODE6MjA3NTgyYzA3NTg3Mzg0NDdkMmRmOGY3NzhhZWViZjEyNmM3M2IzMQ==",
  "commit": {
    "author": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-03-15T12:23:12Z"
    },
    "committer": {
      "name": "Tom Tromey",
      "email": "tromey@adacore.com",
      "date": "2021-03-15T12:23:12Z"
    },
    "message": "Fix bug in Ada aggregate assignment\n\nThe expression rewrite caused a regression in the internal AdaCore\ntest suite.  The bug was that I had dropped a bit of code from\naggregate assignment -- assign_aggregate used to return the container,\nwhich I thought was redundant, but which can actually change during\nthe call.  There was no test for this case in the tree, so I've added\none.\n\ngdb/ChangeLog\n2021-03-15  Tom Tromey  <tromey@adacore.com>\n\n\t* ada-lang.c (ada_aggregate_operation::assign_aggregate): Return\n\tcontainer.\n\t(ada_assign_operation::evaluate): Update.\n\t* ada-exp.h (class ada_aggregate_operation) <assign_aggregate>:\n\tChange return type.\n\ngdb/testsuite/ChangeLog\n2021-03-15  Tom Tromey  <tromey@adacore.com>\n\n\t* gdb.ada/assign_arr/target_wrapper.ads (IArray, Put, Do_Nothing):\n\tDeclare.\n\t* gdb.ada/assign_arr/target_wrapper.adb: New file.\n\t* gdb.ada/assign_arr/main_p324_051.adb (IValue): New variable.\n\tCall Put.\n\t* gdb.ada/assign_arr.exp: Update.",
    "tree": {
      "sha": "986f9fbcef047e24e6742cb3f95e81102d4ec83d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/git/trees/986f9fbcef047e24e6742cb3f95e81102d4ec83d"
    },
    "url": "https://api.github.com/repos/bminor/binutils-gdb/git/commits/207582c0758738447d2df8f778aeebf126c73b31",
    "comment_count": 0,
    "verification": {
      "verified": false,
      "reason": "unsigned",
      "signature": null,
      "payload": null
    }
  },
  "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/207582c0758738447d2df8f778aeebf126c73b31",
  "html_url": "https://github.com/bminor/binutils-gdb/commit/207582c0758738447d2df8f778aeebf126c73b31",
  "comments_url": "https://api.github.com/repos/bminor/binutils-gdb/commits/207582c0758738447d2df8f778aeebf126c73b31/comments",
  "author": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "committer": {
    "login": "tromey",
    "id": 1557670,
    "node_id": "MDQ6VXNlcjE1NTc2NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1557670?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tromey",
    "html_url": "https://github.com/tromey",
    "followers_url": "https://api.github.com/users/tromey/followers",
    "following_url": "https://api.github.com/users/tromey/following{/other_user}",
    "gists_url": "https://api.github.com/users/tromey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tromey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tromey/subscriptions",
    "organizations_url": "https://api.github.com/users/tromey/orgs",
    "repos_url": "https://api.github.com/users/tromey/repos",
    "events_url": "https://api.github.com/users/tromey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tromey/received_events",
    "type": "User",
    "site_admin": false
  },
  "parents": [
    {
      "sha": "1996d0f12cd57391e01e0eebe32e44510e6ec17d",
      "url": "https://api.github.com/repos/bminor/binutils-gdb/commits/1996d0f12cd57391e01e0eebe32e44510e6ec17d",
      "html_url": "https://github.com/bminor/binutils-gdb/commit/1996d0f12cd57391e01e0eebe32e44510e6ec17d"
    }
  ],
  "stats": {
    "total": 83,
    "additions": 72,
    "deletions": 11
  },
  "files": [
    {
      "sha": "da5c36b6813823e281c85a5a965f7755b949826f",
      "filename": "gdb/ChangeLog",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ChangeLog?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -1,3 +1,11 @@\n+2021-03-15  Tom Tromey  <tromey@adacore.com>\n+\n+\t* ada-lang.c (ada_aggregate_operation::assign_aggregate): Return\n+\tcontainer.\n+\t(ada_assign_operation::evaluate): Update.\n+\t* ada-exp.h (class ada_aggregate_operation) <assign_aggregate>:\n+\tChange return type.\n+\n 2021-03-15  Felix Willgerodt  <felix.willgerodt@intel.com>\n \n \t* i386-tdep.c (i386_floatformat_for_type): Add COMPLEX*32 and REAL*16."
    },
    {
      "sha": "82941dd063421d7cc6f38951cb6fcd1862ea78df",
      "filename": "gdb/ada-exp.h",
      "status": "modified",
      "additions": 5,
      "deletions": 4,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/ada-exp.h",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/ada-exp.h",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ada-exp.h?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -510,11 +510,12 @@ class ada_aggregate_operation\n      type, evaluate an assignment of this aggregate's value to LHS.\n      CONTAINER is an lvalue containing LHS (possibly LHS itself).\n      Does not modify the inferior's memory, nor does it modify the\n-     contents of LHS (unless == CONTAINER).  */\n+     contents of LHS (unless == CONTAINER).  Returns the modified\n+     CONTAINER.  */\n \n-  void assign_aggregate (struct value *container,\n-\t\t\t struct value *lhs,\n-\t\t\t struct expression *exp);\n+  value *assign_aggregate (struct value *container,\n+\t\t\t   struct value *lhs,\n+\t\t\t   struct expression *exp);\n \n   value *evaluate (struct type *expect_type,\n \t\t   struct expression *exp,"
    },
    {
      "sha": "ea43a259f5139ccfa9785405f0605276ad97778c",
      "filename": "gdb/ada-lang.c",
      "status": "modified",
      "additions": 5,
      "deletions": 7,
      "changes": 12,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/ada-lang.c",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/ada-lang.c",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/ada-lang.c?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -9101,13 +9101,9 @@ ada_aggregate_component::assign (struct value *container,\n     item->assign (container, lhs, exp, indices, low, high);\n }\n \n-/* Assuming that LHS represents an lvalue having a record or array\n-   type, evaluate an assignment of this aggregate's value to LHS.\n-   CONTAINER is an lvalue containing LHS (possibly LHS itself).  Does\n-   not modify the inferior's memory, nor does it modify the contents\n-   of LHS (unless == CONTAINER).  */\n+/* See ada-exp.h.  */\n \n-void\n+value *\n ada_aggregate_operation::assign_aggregate (struct value *container,\n \t\t\t\t\t   struct value *lhs,\n \t\t\t\t\t   struct expression *exp)\n@@ -9144,6 +9140,8 @@ ada_aggregate_operation::assign_aggregate (struct value *container,\n \n   std::get<0> (m_storage)->assign (container, lhs, exp, indices,\n \t\t\t\t   low_index, high_index);\n+\n+  return container;\n }\n \n bool\n@@ -9349,7 +9347,7 @@ ada_assign_operation::evaluate (struct type *expect_type,\n       if (noside != EVAL_NORMAL)\n \treturn arg1;\n \n-      ag_op->assign_aggregate (arg1, arg1, exp);\n+      arg1 = ag_op->assign_aggregate (arg1, arg1, exp);\n       return ada_value_assign (arg1, arg1);\n     }\n   /* Force the evaluation of the rhs ARG2 to the type of the lhs ARG1,"
    },
    {
      "sha": "25f072d6105b2a1d5a1a050c6897b8badffdbdea",
      "filename": "gdb/testsuite/ChangeLog",
      "status": "modified",
      "additions": 9,
      "deletions": 0,
      "changes": 9,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/ChangeLog",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/ChangeLog",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/ChangeLog?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -1,3 +1,12 @@\n+2021-03-15  Tom Tromey  <tromey@adacore.com>\n+\n+\t* gdb.ada/assign_arr/target_wrapper.ads (IArray, Put, Do_Nothing):\n+\tDeclare.\n+\t* gdb.ada/assign_arr/target_wrapper.adb: New file.\n+\t* gdb.ada/assign_arr/main_p324_051.adb (IValue): New variable.\n+\tCall Put.\n+\t* gdb.ada/assign_arr.exp: Update.\n+\n 2021-03-15  Andrew Burgess  <andrew.burgess@embecosm.com>\n \n \t* gdb.python/py-auto-load-chaining-f1.c: New file."
    },
    {
      "sha": "08090271afcee6dae4266fd33104723577613025",
      "filename": "gdb/testsuite/gdb.ada/assign_arr.exp",
      "status": "modified",
      "additions": 7,
      "deletions": 0,
      "changes": 7,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr.exp",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr.exp",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/assign_arr.exp?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -33,3 +33,10 @@ gdb_test \"print assign_arr_input.u2 :=(0.25,0.5,0.75)\" \\\n \n gdb_test \"print assign_arr_input.u2 :=(0.25, others => 0.125)\" \\\n          \" = \\\\(0\\\\.25, 0\\\\.125, 0\\\\.125\\\\)\"\n+\n+set line [gdb_get_line_number \"STOP2\" ${testdir}/target_wrapper.adb]\n+gdb_breakpoint target_wrapper.adb:$line\n+gdb_continue_to_breakpoint STOP2\n+\n+gdb_test \"print a\" \" = \\\\(8, 10, 12\\\\)\"\n+gdb_test \"print a := (2, 4, 6)\" \" = \\\\(2, 4, 6\\\\)\" \"assign to a\""
    },
    {
      "sha": "f352d91cdf9bd72fee3b67e7670f6dcaf19b2e2c",
      "filename": "gdb/testsuite/gdb.ada/assign_arr/main_p324_051.adb",
      "status": "modified",
      "additions": 2,
      "deletions": 0,
      "changes": 2,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr/main_p324_051.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr/main_p324_051.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/assign_arr/main_p324_051.adb?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -16,6 +16,8 @@\n with target_wrapper; use target_wrapper;\n \n procedure Main_P324_051 is\n+   IValue : IArray (1 .. 3) := (8, 10, 12);\n begin\n    Assign_Arr_Input.u2 := (0.2,0.3,0.4);  -- STOP\n+   Put (IValue);\n end Main_P324_051;"
    },
    {
      "sha": "888c5e4a5c31f4f4e6d3cfbea94efd4d92a99c86",
      "filename": "gdb/testsuite/gdb.ada/assign_arr/target_wrapper.adb",
      "status": "added",
      "additions": 28,
      "deletions": 0,
      "changes": 28,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr/target_wrapper.adb",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr/target_wrapper.adb",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/assign_arr/target_wrapper.adb?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -0,0 +1,28 @@\n+--  Copyright 2021 Free Software Foundation, Inc.\n+--\n+--  This program is free software; you can redistribute it and/or modify\n+--  it under the terms of the GNU General Public License as published by\n+--  the Free Software Foundation; either version 3 of the License, or\n+--  (at your option) any later version.\n+--\n+--  This program is distributed in the hope that it will be useful,\n+--  but WITHOUT ANY WARRANTY; without even the implied warranty of\n+--  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+--  GNU General Public License for more details.\n+--\n+--  You should have received a copy of the GNU General Public License\n+--  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n+\n+package body target_wrapper is\n+\n+   procedure Do_Nothing (A : System.Address) is\n+   begin\n+      null;\n+   end Do_Nothing;\n+\n+   procedure Put (A : in out IArray) is\n+   begin\n+      Do_Nothing (A'Address); -- STOP2\n+   end Put;\n+\n+end target_wrapper;"
    },
    {
      "sha": "743964a2ecd3ec5cbd914bcb255e03c55f75e4a3",
      "filename": "gdb/testsuite/gdb.ada/assign_arr/target_wrapper.ads",
      "status": "modified",
      "additions": 8,
      "deletions": 0,
      "changes": 8,
      "blob_url": "https://github.com/bminor/binutils-gdb/blob/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr/target_wrapper.ads",
      "raw_url": "https://github.com/bminor/binutils-gdb/raw/207582c0758738447d2df8f778aeebf126c73b31/gdb/testsuite/gdb.ada/assign_arr/target_wrapper.ads",
      "contents_url": "https://api.github.com/repos/bminor/binutils-gdb/contents/gdb/testsuite/gdb.ada/assign_arr/target_wrapper.ads?ref=207582c0758738447d2df8f778aeebf126c73b31",
      "patch": "@@ -13,6 +13,8 @@\n --  You should have received a copy of the GNU General Public License\n --  along with this program.  If not, see <http://www.gnu.org/licenses/>.\n \n+with System;\n+\n package target_wrapper is\n \n    type Float_Array_3 is array (1 .. 3) of Float;\n@@ -23,4 +25,10 @@ package target_wrapper is\n \n    Assign_Arr_Input : parameters;\n \n+   type IArray is array (Integer range <>) of Integer;\n+\n+   procedure Put (A : in out IArray);\n+\n+   procedure Do_Nothing (A : System.Address);\n+\n end target_wrapper;"
    }
  ]
}